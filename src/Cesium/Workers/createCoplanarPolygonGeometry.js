define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian3-2b5b9afe","./Cartesian2-577f67dc","./Transforms-18f02e2b","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./GeometryAttribute-5eb995bc","./JulianDate-53cdb307","./RequestType-beb1291d","./GeometryAttributes-fbf888b4","./AttributeCompression-c335d1ea","./GeometryPipeline-282a4062","./EncodedCartesian3-f0c89625","./IndexDatatype-c5295474","./IntersectionTests-8ff35218","./Plane-5b30f0ff","./VertexFormat-89c0971b","./GeometryInstance-18f1f5f5","./arrayRemoveDuplicates-a7dee4b8","./BoundingRectangle-a11f7177","./EllipsoidTangentPlane-51ba1d6b","./OrientedBoundingBox-c229c76c","./CoplanarPolygonGeometryLibrary-59a53e5a","./ArcType-46047bc6","./EllipsoidRhumbLine-b4761ded","./PolygonPipeline-6cd12a44","./PolygonGeometryLibrary-faa86917"],function(s,e,V,R,I,M,t,a,H,B,n,r,O,o,w,i,z,l,p,y,A,F,c,u,m,G,d,g,S,L){"use strict";var N=new R.Cartesian3,E=new c.BoundingRectangle,Q=new I.Cartesian2,j=new I.Cartesian2,T=new R.Cartesian3,D=new R.Cartesian3,_=new R.Cartesian3,k=new R.Cartesian3,q=new R.Cartesian3,J=new R.Cartesian3,U=new M.Quaternion,Y=new M.Matrix3,W=new M.Matrix3,Z=new R.Cartesian3;function K(e,t,a,n,r,o,i,l){var s=e.positions,p=S.PolygonPipeline.triangulate(e.positions2D,e.holes);p.length<3&&(p=[0,1,2]);var y=z.IndexDatatype.createTypedArray(s.length,p.length);y.set(p);var c,u,m=Y;0!==n?(c=M.Quaternion.fromAxisAngle(o,n,U),m=M.Matrix3.fromQuaternion(c,m),(t.tangent||t.bitangent)&&(c=M.Quaternion.fromAxisAngle(o,-n,U),u=M.Matrix3.fromQuaternion(c,W),i=R.Cartesian3.normalize(M.Matrix3.multiplyByVector(u,i,i),i),t.bitangent&&(l=R.Cartesian3.normalize(R.Cartesian3.cross(o,i,l),l)))):m=M.Matrix3.clone(M.Matrix3.IDENTITY,m);var d=j;t.st&&(d.x=a.x,d.y=a.y);for(var g=s.length,b=3*g,f=new Float64Array(b),h=t.normal?new Float32Array(b):void 0,v=t.tangent?new Float32Array(b):void 0,C=t.bitangent?new Float32Array(b):void 0,x=t.st?new Float32Array(2*g):void 0,P=0,w=0,A=0,F=0,G=0,L=0;L<g;L++){var E,T,D,_=s[L];f[P++]=_.x,f[P++]=_.y,f[P++]=_.z,t.st&&(E=r(M.Matrix3.multiplyByVector(m,_,N),Q),I.Cartesian2.subtract(E,d,E),T=V.CesiumMath.clamp(E.x/a.width,0,1),D=V.CesiumMath.clamp(E.y/a.height,0,1),x[G++]=T,x[G++]=D),t.normal&&(h[w++]=o.x,h[w++]=o.y,h[w++]=o.z),t.tangent&&(v[F++]=i.x,v[F++]=i.y,v[F++]=i.z),t.bitangent&&(C[A++]=l.x,C[A++]=l.y,C[A++]=l.z)}var k=new O.GeometryAttributes;return t.position&&(k.position=new B.GeometryAttribute({componentDatatype:H.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})),t.normal&&(k.normal=new B.GeometryAttribute({componentDatatype:H.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:h})),t.tangent&&(k.tangent=new B.GeometryAttribute({componentDatatype:H.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:v})),t.bitangent&&(k.bitangent=new B.GeometryAttribute({componentDatatype:H.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:C})),t.st&&(k.st=new B.GeometryAttribute({componentDatatype:H.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:x})),new B.Geometry({attributes:k,indices:y,primitiveType:B.PrimitiveType.TRIANGLES})}function b(e){var t=(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=s.defaultValue(e.vertexFormat,y.VertexFormat.DEFAULT);this._vertexFormat=y.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=s.defaultValue(e.stRotation,0),this._ellipsoid=I.Ellipsoid.clone(s.defaultValue(e.ellipsoid,I.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=L.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+y.VertexFormat.packedLength+I.Ellipsoid.packedLength+2}b.fromPositions=function(e){return new b({polygonHierarchy:{positions:(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},b.pack=function(e,t,a){return a=s.defaultValue(a,0),a=L.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),I.Ellipsoid.pack(e._ellipsoid,t,a),a+=I.Ellipsoid.packedLength,y.VertexFormat.pack(e._vertexFormat,t,a),a+=y.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var f=I.Ellipsoid.clone(I.Ellipsoid.UNIT_SPHERE),h=new y.VertexFormat,v={polygonHierarchy:{}};return b.unpack=function(e,t,a){t=s.defaultValue(t,0);var n=L.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=n.startingIndex,delete n.startingIndex;var r=I.Ellipsoid.unpack(e,t,f);t+=I.Ellipsoid.packedLength;var o=y.VertexFormat.unpack(e,t,h);t+=y.VertexFormat.packedLength;var i=e[t++],l=e[t];return s.defined(a)||(a=new b(v)),a._polygonHierarchy=n,a._ellipsoid=I.Ellipsoid.clone(r,a._ellipsoid),a._vertexFormat=y.VertexFormat.clone(o,a._vertexFormat),a._stRotation=i,a.packedLength=l,a},b.createGeometry=function(e){var t=e._vertexFormat,a=e._polygonHierarchy,n=e._stRotation,r=a.positions;if(!((r=F.arrayRemoveDuplicates(r,R.Cartesian3.equalsEpsilon,!0)).length<3)){var o=T,i=D,l=_,s=q,p=J;if(G.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(r,k,s,p)){var y,o=R.Cartesian3.cross(s,p,o);o=R.Cartesian3.normalize(o,o),R.Cartesian3.equalsEpsilon(k,R.Cartesian3.ZERO,V.CesiumMath.EPSILON6)||(y=e._ellipsoid.geodeticSurfaceNormal(k,Z),R.Cartesian3.dot(o,y)<0&&(o=R.Cartesian3.negate(o,o),s=R.Cartesian3.negate(s,s)));var c=G.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(k,s,p),u=G.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(k,s,p);t.tangent&&(i=R.Cartesian3.clone(s,i)),t.bitangent&&(l=R.Cartesian3.clone(p,l));var m=L.PolygonGeometryLibrary.polygonsFromHierarchy(a,c,!1),d=m.hierarchy,g=m.polygons;if(0!==d.length){r=d[0].outerRing;for(var b=M.BoundingSphere.fromPoints(r),f=L.PolygonGeometryLibrary.computeBoundingRectangle(o,u,r,n,E),h=[],v=0;v<g.length;v++){var C=new A.GeometryInstance({geometry:K(g[v],t,f,n,u,o,i,l)});h.push(C)}var x=w.GeometryPipeline.combineInstances(h)[0];x.attributes.position.values=new Float64Array(x.attributes.position.values),x.indices=z.IndexDatatype.createTypedArray(x.attributes.position.values.length/3,x.indices);var P=x.attributes;return t.position||delete P.position,new B.Geometry({attributes:P,indices:x.indices,primitiveType:x.primitiveType,boundingSphere:b})}}}},function(e,t){return s.defined(t)&&(e=b.unpack(e,t)),b.createGeometry(e)}});
