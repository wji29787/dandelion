define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian3-2b5b9afe","./Cartesian2-577f67dc","./Transforms-18f02e2b","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./JulianDate-53cdb307","./RequestType-beb1291d","./AttributeCompression-c335d1ea","./IndexDatatype-c5295474","./IntersectionTests-8ff35218","./Plane-5b30f0ff","./createTaskProcessorWorker","./EllipsoidTangentPlane-51ba1d6b","./OrientedBoundingBox-c229c76c","./TerrainEncoding-3a09cff0"],function(C,e,ce,ge,me,xe,t,i,n,s,r,h,ve,u,o,a,p,Ce,we){"use strict";var ye={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,s,r){var h,u,o;C.defined(r)?r.length=0:r=[],o=t?(h=i<e,u=n<e,s<e):(h=e<i,u=e<n,e<s);var a,p,d,f,l,c,g=h+u+o;return 1===g?h?(a=(e-i)/(n-i),p=(e-i)/(s-i),r.push(1),r.push(2),1!==p&&(r.push(-1),r.push(0),r.push(2),r.push(p)),1!==a&&(r.push(-1),r.push(0),r.push(1),r.push(a))):u?(d=(e-n)/(s-n),f=(e-n)/(i-n),r.push(2),r.push(0),1!==f&&(r.push(-1),r.push(1),r.push(0),r.push(f)),1!==d&&(r.push(-1),r.push(1),r.push(2),r.push(d))):o&&(l=(e-s)/(i-s),c=(e-s)/(n-s),r.push(0),r.push(1),1!==c&&(r.push(-1),r.push(2),r.push(1),r.push(c)),1!==l&&(r.push(-1),r.push(2),r.push(0),r.push(l))):2===g?h||i===e?u||n===e?o||s===e||(p=(e-i)/(s-i),d=(e-n)/(s-n),r.push(2),r.push(-1),r.push(0),r.push(2),r.push(p),r.push(-1),r.push(1),r.push(2),r.push(d)):(c=(e-s)/(n-s),a=(e-i)/(n-i),r.push(1),r.push(-1),r.push(2),r.push(1),r.push(c),r.push(-1),r.push(0),r.push(1),r.push(a)):(f=(e-n)/(i-n),l=(e-s)/(i-s),r.push(0),r.push(-1),r.push(1),r.push(0),r.push(f),r.push(-1),r.push(2),r.push(0),r.push(l)):3!==g&&(r.push(0),r.push(1),r.push(2)),r},computeBarycentricCoordinates:function(e,t,i,n,s,r,h,u,o){var a=i-h,p=h-s,d=r-u,f=n-u,l=1/(d*a+p*f),c=t-u,g=e-h,m=(d*g+p*c)*l,x=(-f*g+a*c)*l,v=1-m-x;return C.defined(o)?(o.x=m,o.y=x,o.z=v,o):new ge.Cartesian3(m,x,v)},computeLineSegmentLineSegmentIntersection:function(e,t,i,n,s,r,h,u,o){var a=(u-r)*(i-e)-(h-s)*(n-t);if(0!=a){var p=((h-s)*(t-r)-(u-r)*(e-s))/a,d=((i-e)*(t-r)-(n-t)*(e-s))/a;return 0<=p&&p<=1&&0<=d&&d<=1?(C.defined(o)||(o=new me.Cartesian2),o.x=e+p*(i-e),o.y=t+p*(n-t),o):void 0}}},Be=32767,be=16383,Ie=[],Ae=[],Te=[],ze=new me.Cartographic,Me=new ge.Cartesian3,Ne=[],Ve=[],Ee=[],Re=[],He=[],Oe=new ge.Cartesian3,Se=new xe.BoundingSphere,Ue=new Ce.OrientedBoundingBox,Fe=new me.Cartesian2,Pe=new ge.Cartesian3;function De(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}De.prototype.clone=function(e){return C.defined(e)||(e=new De),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},De.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},De.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},De.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},De.prototype.isIndexed=function(){return C.defined(this.index)},De.prototype.getH=function(){return C.defined(this.index)?this.heightBuffer[this.index]:ce.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},De.prototype.getU=function(){return C.defined(this.index)?this.uBuffer[this.index]:ce.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},De.prototype.getV=function(){return C.defined(this.index)?this.vBuffer[this.index]:ce.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var d=new me.Cartesian2,f=-1,l=[new ge.Cartesian3,new ge.Cartesian3],c=[new ge.Cartesian3,new ge.Cartesian3];function g(e,t){var i=l[++f],n=c[f],i=h.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),n=h.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),n);return Me=ge.Cartesian3.lerp(i,n,e.ratio,Me),ge.Cartesian3.normalize(Me,Me),h.AttributeCompression.octEncode(Me,t),--f,t}De.prototype.getNormalX=function(){return C.defined(this.index)?this.normalBuffer[2*this.index]:(d=g(this,d)).x},De.prototype.getNormalY=function(){return C.defined(this.index)?this.normalBuffer[2*this.index+1]:(d=g(this,d)).y};var m=[];function ke(e,t,i,n,s,r,h,u,o){if(0!==h.length){for(var a=0,p=0;p<h.length;)p=m[a++].initializeFromClipResult(h,p,u);for(var d=0;d<a;++d){var f,l,c=m[d];c.isIndexed()?(c.newIndex=r[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,o&&(c.normalBuffer=n)):(f=c.getKey(),C.defined(r[f])?c.newIndex=r[f]:(l=e.length,e.push(c.getU()),t.push(c.getV()),i.push(c.getH()),o&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=l,r[f]=l))}3===a?(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex)):4===a&&(s.push(m[0].newIndex),s.push(m[1].newIndex),s.push(m[2].newIndex),s.push(m[0].newIndex),s.push(m[2].newIndex),s.push(m[3].newIndex))}}return m.push(new De),m.push(new De),m.push(new De),m.push(new De),a(function(e,t){var i=e.isEastChild,n=e.isNorthChild,s=i?be:0,r=i?Be:be,h=n?be:0,u=n?Be:be,o=Ne,a=Ve,p=Ee,d=He;o.length=0,a.length=0,p.length=0,d.length=0;var f=Re;f.length=0;for(var l={},c=e.vertices,g=(g=e.indices).subarray(0,e.indexCountWithoutSkirts),m=we.TerrainEncoding.clone(e.encoding),x=m.hasVertexNormals,v=e.exaggeration,C=0,w=e.vertexCountWithoutSkirts,y=e.minimumHeight,B=e.maximumHeight,b=new Array(w),I=new Array(w),A=new Array(w),T=x?new Array(2*w):void 0,z=0,M=0;z<w;++z,M+=2){var N,V=m.decodeTextureCoordinates(c,z,Fe),E=m.decodeHeight(c,z)/v,R=ce.CesiumMath.clamp(V.x*Be|0,0,Be),H=ce.CesiumMath.clamp(V.y*Be|0,0,Be);A[z]=ce.CesiumMath.clamp((E-y)/(B-y)*Be|0,0,Be),R<20&&(R=0),H<20&&(H=0),Be-R<20&&(R=Be),Be-H<20&&(H=Be),b[z]=R,I[z]=H,x&&(N=m.getOctEncodedNormal(c,z,Pe),T[M]=N.x,T[M+1]=N.y),(i&&be<=R||!i&&R<=be)&&(n&&be<=H||!n&&H<=be)&&(l[z]=C,o.push(R),a.push(H),p.push(A[z]),x&&(d.push(T[M]),d.push(T[M+1])),++C)}var O=[];O.push(new De),O.push(new De),O.push(new De);var S=[];for(S.push(new De),S.push(new De),S.push(new De),z=0;z<g.length;z+=3){var U=g[z],F=g[z+1],P=g[z+2],D=b[U],k=b[F],W=b[P];O[0].initializeIndexed(b,I,A,T,U),O[1].initializeIndexed(b,I,A,T,F),O[2].initializeIndexed(b,I,A,T,P);var X,K=ye.clipTriangleAtAxisAlignedThreshold(be,i,D,k,W,Ie);(X=0)>=K.length||(X=S[0].initializeFromClipResult(K,X,O))>=K.length||(X=S[1].initializeFromClipResult(K,X,O))>=K.length||(X=S[2].initializeFromClipResult(K,X,O),ke(o,a,p,d,f,l,ye.clipTriangleAtAxisAlignedThreshold(be,n,S[0].getV(),S[1].getV(),S[2].getV(),Ae),S,x),X<K.length&&(S[2].clone(S[1]),S[2].initializeFromClipResult(K,X,O),ke(o,a,p,d,f,l,ye.clipTriangleAtAxisAlignedThreshold(be,n,S[0].getV(),S[1].getV(),S[2].getV(),Ae),S,x)))}var L=i?-Be:0,Y=n?-Be:0,J=[],_=[],q=[],G=[],Z=Number.MAX_VALUE,j=-Z,Q=Te;Q.length=0;var $=me.Ellipsoid.clone(e.ellipsoid),ee=me.Rectangle.clone(e.childRectangle),te=ee.north,ie=ee.south,ne=ee.east,se=ee.west;for(ne<se&&(ne+=ce.CesiumMath.TWO_PI),z=0;z<o.length;++z)R=(R=Math.round(o[z]))<=s?(J.push(z),0):r<=R?(q.push(z),Be):2*R+L,o[z]=R,H=(H=Math.round(a[z]))<=h?(_.push(z),0):u<=H?(G.push(z),Be):2*H+Y,a[z]=H,(E=ce.CesiumMath.lerp(y,B,p[z]/Be))<Z&&(Z=E),j<E&&(j=E),p[z]=E,ze.longitude=ce.CesiumMath.lerp(se,ne,R/Be),ze.latitude=ce.CesiumMath.lerp(ie,te,H/Be),ze.height=E,$.cartographicToCartesian(ze,Me),Q.push(Me.x),Q.push(Me.y),Q.push(Me.z);var re=xe.BoundingSphere.fromVertices(Q,ge.Cartesian3.ZERO,3,Se),he=Ce.OrientedBoundingBox.fromRectangle(ee,Z,j,$,Ue),ue=new we.EllipsoidalOccluder($).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(re.center,Q,3,re.center,Z,Oe),oe=j-Z,ae=new Uint16Array(o.length+a.length+p.length);for(z=0;z<o.length;++z)ae[z]=o[z];var pe=o.length;for(z=0;z<a.length;++z)ae[pe+z]=a[z];for(pe+=a.length,z=0;z<p.length;++z)ae[pe+z]=Be*(p[z]-Z)/oe;var de,fe,le=ve.IndexDatatype.createTypedArray(o.length,f);return x?(fe=new Uint8Array(d),t.push(ae.buffer,le.buffer,fe.buffer),de=fe.buffer):t.push(ae.buffer,le.buffer),{vertices:ae.buffer,encodedNormals:de,indices:le.buffer,minimumHeight:Z,maximumHeight:j,westIndices:J,southIndices:_,eastIndices:q,northIndices:G,boundingSphere:re,orientedBoundingBox:he,horizonOcclusionPoint:ue}})});
