define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian3-2b5b9afe","./Cartesian2-577f67dc","./Transforms-18f02e2b","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./GeometryAttribute-5eb995bc","./JulianDate-53cdb307","./RequestType-beb1291d","./GeometryAttributes-fbf888b4","./IndexDatatype-c5295474","./createTaskProcessorWorker","./GeometryOffsetAttribute-9f7392ac","./VertexFormat-89c0971b","./BoxGeometry-a11d8738","./CylinderGeometryLibrary-e4433c22","./CylinderGeometry-81b72bf7","./EllipsoidGeometry-34794a23","./Color-b5533cf2"],function(Z,e,t,q,n,P,r,a,i,o,s,d,c,W,f,l,u,_,h,J,N,S){"use strict";function T(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var b=new q.Cartesian3,p=P.Matrix4.packedLength+q.Cartesian3.packedLength,y=P.Matrix4.packedLength+2,x=P.Matrix4.packedLength+q.Cartesian3.packedLength,g=q.Cartesian3.packedLength+1,v={modelMatrix:new P.Matrix4,boundingVolume:new P.BoundingSphere};function Y(e,t){var n=t*p,r=q.Cartesian3.unpack(e,n,b);n+=q.Cartesian3.packedLength;var a=P.Matrix4.unpack(e,n,v.modelMatrix);P.Matrix4.multiplyByScale(a,r,a);var i=v.boundingVolume;return q.Cartesian3.clone(q.Cartesian3.ZERO,i.center),i.radius=Math.sqrt(3),v}function j(e,t){var n=t*y,r=e[n++],a=e[n++],i=q.Cartesian3.fromElements(r,r,a,b),o=P.Matrix4.unpack(e,n,v.modelMatrix);P.Matrix4.multiplyByScale(o,i,o);var s=v.boundingVolume;return q.Cartesian3.clone(q.Cartesian3.ZERO,s.center),s.radius=Math.sqrt(2),v}function z(e,t){var n=t*x,r=q.Cartesian3.unpack(e,n,b);n+=q.Cartesian3.packedLength;var a=P.Matrix4.unpack(e,n,v.modelMatrix);P.Matrix4.multiplyByScale(a,r,a);var i=v.boundingVolume;return q.Cartesian3.clone(q.Cartesian3.ZERO,i.center),i.radius=1,v}function H(e,t){var n=t*g,r=e[n++],a=q.Cartesian3.unpack(e,n,b),i=P.Matrix4.fromTranslation(a,v.modelMatrix);P.Matrix4.multiplyByUniformScale(i,r,i);var o=v.boundingVolume;return q.Cartesian3.clone(q.Cartesian3.ZERO,o.center),o.radius=1,v}var V=new q.Cartesian3;function K(e,t,n,r,a){if(Z.defined(t)){for(var i=n.length,o=r.attributes.position.values,s=r.indices,d=e.positions,c=e.vertexBatchIds,f=e.indices,l=e.batchIds,u=e.batchTableColors,h=e.batchedIndices,b=e.indexOffsets,p=e.indexCounts,y=e.boundingVolumes,x=e.modelMatrix,g=e.center,v=e.positionOffset,C=e.batchIdIndex,m=e.indexOffset,I=e.batchedIndicesOffset,k=0;k<i;++k){var M=a(t,k),B=M.modelMatrix;P.Matrix4.multiply(x,B,B);for(var w=n[k],A=o.length,O=0;O<A;O+=3){var L=q.Cartesian3.unpack(o,O,V);P.Matrix4.multiplyByPoint(B,L,L),q.Cartesian3.subtract(L,g,L),q.Cartesian3.pack(L,d,3*v+O),c[C++]=w}for(var E=s.length,U=0;U<E;++U)f[m+U]=s[U]+v;var G=k+I;h[G]=new T({offset:m,count:E,color:S.Color.fromRgba(u[w]),batchIds:[w]}),l[G]=w,b[G]=m,p[G]=E,y[G]=P.BoundingSphere.transform(M.boundingVolume,B),v+=A/3,m+=E}e.positionOffset=v,e.batchIdIndex=C,e.indexOffset=m,e.batchedIndicesOffset+=i}}var Q=new q.Cartesian3,X=new P.Matrix4;function $(e,t,n){var r=n.length,a=2+r*P.BoundingSphere.packedLength+1+function(e){for(var t=e.length,n=0,r=0;r<t;++r)n+=S.Color.packedLength+3+e[r].batchIds.length;return n}(t),i=new Float64Array(a),o=0;i[o++]=e,i[o++]=r;for(var s=0;s<r;++s)P.BoundingSphere.pack(n[s],i,o),o+=P.BoundingSphere.packedLength;var d=t.length;i[o++]=d;for(var c=0;c<d;++c){var f=t[c];S.Color.pack(f.color,i,o),o+=S.Color.packedLength,i[o++]=f.offset,i[o++]=f.count;var l=f.batchIds,u=l.length;i[o++]=u;for(var h=0;h<u;++h)i[o++]=l[h]}return i}return f(function(e,t){var n=Z.defined(e.boxes)?new Float32Array(e.boxes):void 0,r=Z.defined(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,a=Z.defined(e.cylinders)?new Float32Array(e.cylinders):void 0,i=Z.defined(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,o=Z.defined(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,s=Z.defined(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,d=Z.defined(e.spheres)?new Float32Array(e.spheres):void 0,c=Z.defined(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,f=Z.defined(n)?r.length:0,l=Z.defined(a)?i.length:0,u=Z.defined(o)?s.length:0,h=Z.defined(d)?c.length:0,b=_.BoxGeometry.getUnitBox(),p=J.CylinderGeometry.getUnitCylinder(),y=N.EllipsoidGeometry.getUnitEllipsoid(),x=b.attributes.position.values,g=p.attributes.position.values,v=y.attributes.position.values,C=x.length*f;C+=g.length*l,C+=v.length*(u+h);var m=b.indices,I=p.indices,k=y.indices,M=m.length*f;M+=I.length*l,M+=k.length*(u+h);var B,w,A,O=new Float32Array(C),L=new Uint16Array(C/3),E=W.IndexDatatype.createTypedArray(C/3,M),U=f+l+u+h,G=new Uint16Array(U),S=new Array(U),T=new Uint32Array(U),V=new Uint32Array(U),F=new Array(U);B=e.packedBuffer,w=new Float64Array(B),A=0,q.Cartesian3.unpack(w,A,Q),A+=q.Cartesian3.packedLength,P.Matrix4.unpack(w,A,X);var R={batchTableColors:new Uint32Array(e.batchTableColors),positions:O,vertexBatchIds:L,indices:E,batchIds:G,batchedIndices:S,indexOffsets:T,indexCounts:V,boundingVolumes:F,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:X,center:Q};K(R,n,r,b,Y),K(R,a,i,p,j),K(R,o,s,y,z),K(R,d,c,y,H);var D=$(E.BYTES_PER_ELEMENT,S,F);return t.push(O.buffer,L.buffer,E.buffer),t.push(G.buffer,T.buffer,V.buffer),t.push(D.buffer),{positions:O.buffer,vertexBatchIds:L.buffer,indices:E.buffer,indexOffsets:T.buffer,indexCounts:V.buffer,batchIds:G.buffer,packedBuffer:D.buffer}})});
