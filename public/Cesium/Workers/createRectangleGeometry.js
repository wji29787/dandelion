define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian3-2b5b9afe","./Cartesian2-577f67dc","./Transforms-18f02e2b","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./GeometryAttribute-5eb995bc","./JulianDate-53cdb307","./RequestType-beb1291d","./GeometryAttributes-fbf888b4","./AttributeCompression-c335d1ea","./GeometryPipeline-282a4062","./EncodedCartesian3-f0c89625","./IndexDatatype-c5295474","./IntersectionTests-8ff35218","./Plane-5b30f0ff","./GeometryOffsetAttribute-9f7392ac","./VertexFormat-89c0971b","./GeometryInstance-18f1f5f5","./EllipsoidRhumbLine-b4761ded","./PolygonPipeline-6cd12a44","./RectangleGeometryLibrary-3daf6937"],function(mt,t,dt,pt,_,k,e,a,gt,yt,r,n,i,o,ft,s,ht,l,u,bt,vt,_t,c,At,H){"use strict";var xt=new pt.Cartesian3,wt=new pt.Cartesian3,Ct=new pt.Cartesian3,Rt=new pt.Cartesian3,A=new _.Rectangle,z=new _.Cartesian2,x=new k.BoundingSphere,w=new k.BoundingSphere;function Et(t,e){var a=new yt.Geometry({attributes:new i.GeometryAttributes,primitiveType:yt.PrimitiveType.TRIANGLES});return a.attributes.position=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e.positions}),t.normal&&(a.attributes.normal=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.normals})),t.tangent&&(a.attributes.tangent=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.tangents})),t.bitangent&&(a.attributes.bitangent=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:e.bitangents})),a}var Ft=new pt.Cartesian3,Gt=new pt.Cartesian3;function Pt(t,e){var a=t._vertexFormat,r=t._ellipsoid,n=e.height,i=e.width,o=e.northCap,s=e.southCap,l=0,u=n,c=n,m=0;o&&(--c,m+=l=1),s&&(--u,--c,m+=1),m+=i*c;for(var d=a.position?new Float64Array(3*m):void 0,p=a.st?new Float32Array(2*m):void 0,g=0,y=0,f=xt,h=z,b=Number.MAX_VALUE,v=Number.MAX_VALUE,_=-Number.MAX_VALUE,A=-Number.MAX_VALUE,x=l;x<u;++x)for(var w=0;w<i;++w)H.RectangleGeometryLibrary.computePosition(e,r,a.st,x,w,f,h),d[g++]=f.x,d[g++]=f.y,d[g++]=f.z,a.st&&(p[y++]=h.x,p[y++]=h.y,b=Math.min(b,h.x),v=Math.min(v,h.y),_=Math.max(_,h.x),A=Math.max(A,h.y));if(o&&(H.RectangleGeometryLibrary.computePosition(e,r,a.st,0,0,f,h),d[g++]=f.x,d[g++]=f.y,d[g++]=f.z,a.st&&(p[y++]=h.x,p[y++]=h.y,b=h.x,v=h.y,_=h.x,A=h.y)),s&&(H.RectangleGeometryLibrary.computePosition(e,r,a.st,n-1,0,f,h),d[g++]=f.x,d[g++]=f.y,d[g]=f.z,a.st&&(p[y++]=h.x,p[y]=h.y,b=Math.min(b,h.x),v=Math.min(v,h.y),_=Math.max(_,h.x),A=Math.max(A,h.y))),a.st&&(b<0||v<0||1<_||1<A))for(var C=0;C<p.length;C+=2)p[C]=(p[C]-b)/(_-b),p[C+1]=(p[C+1]-v)/(A-v);var R=function(t,e,a,r){var n=t.length,i=e.normal?new Float32Array(n):void 0,o=e.tangent?new Float32Array(n):void 0,s=e.bitangent?new Float32Array(n):void 0,l=0,u=Rt,c=Ct,m=wt;if(e.normal||e.tangent||e.bitangent)for(var d=0;d<n;d+=3){var p=pt.Cartesian3.fromArray(t,d,xt),g=l+1,y=l+2,m=a.geodeticSurfaceNormal(p,m);(e.tangent||e.bitangent)&&(pt.Cartesian3.cross(pt.Cartesian3.UNIT_Z,m,c),k.Matrix3.multiplyByVector(r,c,c),pt.Cartesian3.normalize(c,c),e.bitangent&&pt.Cartesian3.normalize(pt.Cartesian3.cross(m,c,u),u)),e.normal&&(i[l]=m.x,i[g]=m.y,i[y]=m.z),e.tangent&&(o[l]=c.x,o[g]=c.y,o[y]=c.z),e.bitangent&&(s[l]=u.x,s[g]=u.y,s[y]=u.z),l+=3}return Et(e,{positions:t,normals:i,tangents:o,bitangents:s})}(d,a,r,e.tangentRotationMatrix),E=6*(i-1)*(c-1);o&&(E+=3*(i-1)),s&&(E+=3*(i-1));for(var F=ht.IndexDatatype.createTypedArray(m,E),G=0,P=0,V=0;V<c-1;++V){for(var L=0;L<i-1;++L){var D=G+i,M=D+1,T=G+1;F[P++]=G,F[P++]=D,F[P++]=T,F[P++]=T,F[P++]=D,F[P++]=M,++G}++G}if(o||s){var O,N,S=m-1,I=m-1;if(o&&s&&(S=m-2),G=0,o)for(V=0;V<i-1;V++)N=(O=G)+1,F[P++]=S,F[P++]=O,F[P++]=N,++G;if(s)for(G=(c-1)*i,V=0;V<i-1;V++)N=(O=G)+1,F[P++]=O,F[P++]=I,F[P++]=N,++G}return R.indices=F,a.st&&(R.attributes.st=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:p})),R}function Vt(t,e,a,r,n){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a+2],t[e++]=n[a],t[e++]=n[a+1],t[e]=n[a+2],t}function Lt(t,e,a,r){return t[e++]=r[a],t[e++]=r[a+1],t[e++]=r[a],t[e]=r[a+1],t}var Dt=new vt.VertexFormat;function C(t,e){var a,r=t._shadowVolume,n=t._offsetAttribute,i=t._vertexFormat,o=t._extrudedHeight,s=t._surfaceHeight,l=t._ellipsoid,u=e.height,c=e.width;r&&((a=vt.VertexFormat.clone(i,Dt)).normal=!0,t._vertexFormat=a);var m=Pt(t,e);r&&(t._vertexFormat=i);var d=At.PolygonPipeline.scaleToGeodeticHeight(m.attributes.position.values,s,l,!1),p=2*(st=(d=new Float64Array(d)).length),g=new Float64Array(p);g.set(d);var y=At.PolygonPipeline.scaleToGeodeticHeight(m.attributes.position.values,o,l);g.set(y,st),m.attributes.position.values=g;var f,h,b,v=i.normal?new Float32Array(p):void 0,_=i.tangent?new Float32Array(p):void 0,A=i.bitangent?new Float32Array(p):void 0,x=i.st?new Float32Array(p/3*2):void 0;if(i.normal){for(h=m.attributes.normal.values,v.set(h),C=0;C<st;C++)h[C]=-h[C];v.set(h,st),m.attributes.normal.values=v}if(r){h=m.attributes.normal.values,i.normal||(m.attributes.normal=void 0);for(var w=new Float32Array(p),C=0;C<st;C++)h[C]=-h[C];w.set(h,st),m.attributes.extrudeDirection=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})}var R,E,F,G=mt.defined(n);if(G&&(R=st/3*2,E=new Uint8Array(R),E=n===bt.GeometryOffsetAttribute.TOP?bt.arrayFill(E,1,0,R/2):(b=n===bt.GeometryOffsetAttribute.NONE?0:1,bt.arrayFill(E,b)),m.attributes.applyOffset=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:E})),i.tangent){var P=m.attributes.tangent.values;for(_.set(P),C=0;C<st;C++)P[C]=-P[C];_.set(P,st),m.attributes.tangent.values=_}i.bitangent&&(F=m.attributes.bitangent.values,A.set(F),A.set(F,st),m.attributes.bitangent.values=A),i.st&&(f=m.attributes.st.values,x.set(f),x.set(f,st/3*2),m.attributes.st.values=x);var V=m.indices,L=V.length,D=st/3,M=ht.IndexDatatype.createTypedArray(p/3,2*L);for(M.set(V),C=0;C<L;C+=3)M[C+L]=V[C+2]+D,M[C+1+L]=V[C+1]+D,M[C+2+L]=V[C]+D;m.indices=M;var T=e.northCap,O=e.southCap,N=u,S=2,I=0,k=4,H=4;T&&(--S,--N,I+=1,k-=2,--H),O&&(--S,--N,I+=1,k-=2,--H);var z=2*((I+=S*c+2*N-k)+H),B=new Float64Array(3*z),U=r?new Float32Array(3*z):void 0,Y=G?new Uint8Array(z):void 0,q=i.st?new Float32Array(2*z):void 0,X=n===bt.GeometryOffsetAttribute.TOP;G&&!X&&(b=n===bt.GeometryOffsetAttribute.ALL?1:0,Y=bt.arrayFill(Y,b));var J=0,Q=0,W=0,j=0,Z=c*N;for(C=0;C<Z;C+=c)B=Vt(B,J,$=3*C,d,y),J+=6,i.st&&(q=Lt(q,Q,2*C,f),Q+=4),r&&(W+=3,U[W++]=h[$],U[W++]=h[$+1],U[W++]=h[$+2]),X&&(Y[j++]=1,j+=1);if(O){var K=T?1+Z:Z,$=3*K;for(C=0;C<2;C++)B=Vt(B,J,$,d,y),J+=6,i.st&&(q=Lt(q,Q,2*K,f),Q+=4),r&&(W+=3,U[W++]=h[$],U[W++]=h[$+1],U[W++]=h[$+2]),X&&(Y[j++]=1,j+=1)}else for(C=Z-c;C<Z;C++)B=Vt(B,J,$=3*C,d,y),J+=6,i.st&&(q=Lt(q,Q,2*C,f),Q+=4),r&&(W+=3,U[W++]=h[$],U[W++]=h[$+1],U[W++]=h[$+2]),X&&(Y[j++]=1,j+=1);for(C=Z-1;0<C;C-=c)B=Vt(B,J,$=3*C,d,y),J+=6,i.st&&(q=Lt(q,Q,2*C,f),Q+=4),r&&(W+=3,U[W++]=h[$],U[W++]=h[$+1],U[W++]=h[$+2]),X&&(Y[j++]=1,j+=1);if(T){var tt=Z;for($=3*tt,C=0;C<2;C++)B=Vt(B,J,$,d,y),J+=6,i.st&&(q=Lt(q,Q,2*tt,f),Q+=4),r&&(W+=3,U[W++]=h[$],U[W++]=h[$+1],U[W++]=h[$+2]),X&&(Y[j++]=1,j+=1)}else for(C=c-1;0<=C;C--)B=Vt(B,J,$=3*C,d,y),J+=6,i.st&&(q=Lt(q,Q,2*C,f),Q+=4),r&&(W+=3,U[W++]=h[$],U[W++]=h[$+1],U[W++]=h[$+2]),X&&(Y[j++]=1,j+=1);var et=function(t,e,a){var r=t.length,n=e.normal?new Float32Array(r):void 0,i=e.tangent?new Float32Array(r):void 0,o=e.bitangent?new Float32Array(r):void 0,s=0,l=0,u=0,c=!0,m=Rt,d=Ct,p=wt;if(e.normal||e.tangent||e.bitangent)for(var g=0;g<r;g+=6){var y,f=pt.Cartesian3.fromArray(t,g,xt),h=pt.Cartesian3.fromArray(t,(g+6)%r,Ft);c&&(y=pt.Cartesian3.fromArray(t,(g+3)%r,Gt),pt.Cartesian3.subtract(h,f,h),pt.Cartesian3.subtract(y,f,y),p=pt.Cartesian3.normalize(pt.Cartesian3.cross(y,h,p),p),c=!1),pt.Cartesian3.equalsEpsilon(h,f,dt.CesiumMath.EPSILON10)&&(c=!0),(e.tangent||e.bitangent)&&(m=a.geodeticSurfaceNormal(f,m),e.tangent&&(d=pt.Cartesian3.normalize(pt.Cartesian3.cross(m,p,d),d))),e.normal&&(n[s++]=p.x,n[s++]=p.y,n[s++]=p.z,n[s++]=p.x,n[s++]=p.y,n[s++]=p.z),e.tangent&&(i[l++]=d.x,i[l++]=d.y,i[l++]=d.z,i[l++]=d.x,i[l++]=d.y,i[l++]=d.z),e.bitangent&&(o[u++]=m.x,o[u++]=m.y,o[u++]=m.z,o[u++]=m.x,o[u++]=m.y,o[u++]=m.z)}return Et(e,{positions:t,normals:n,tangents:i,bitangents:o})}(B,i,l);i.st&&(et.attributes.st=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:q})),r&&(et.attributes.extrudeDirection=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U})),G&&(et.attributes.applyOffset=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y}));var at,rt,nt,it,ot=ht.IndexDatatype.createTypedArray(z,6*I),st=B.length/3,lt=0;for(C=0;C<st-1;C+=2){it=((at=C)+2)%st;var ut=pt.Cartesian3.fromArray(B,3*at,Ft),ct=pt.Cartesian3.fromArray(B,3*it,Gt);pt.Cartesian3.equalsEpsilon(ut,ct,dt.CesiumMath.EPSILON10)||(nt=(2+(rt=(at+1)%st))%st,ot[lt++]=at,ot[lt++]=rt,ot[lt++]=it,ot[lt++]=it,ot[lt++]=rt,ot[lt++]=nt)}return et.indices=ot,(et=ft.GeometryPipeline.combineInstances([new _t.GeometryInstance({geometry:m}),new _t.GeometryInstance({geometry:et})]))[0]}var m=[new pt.Cartesian3,new pt.Cartesian3,new pt.Cartesian3,new pt.Cartesian3],R=new _.Cartographic,E=new _.Cartographic;function y(t,e,a,r,n){if(0===a)return _.Rectangle.clone(t,n);var i=H.RectangleGeometryLibrary.computeOptions(t,e,a,0,A,R),o=i.height,s=i.width,l=m;return H.RectangleGeometryLibrary.computePosition(i,r,!1,0,0,l[0]),H.RectangleGeometryLibrary.computePosition(i,r,!1,0,s-1,l[1]),H.RectangleGeometryLibrary.computePosition(i,r,!1,o-1,0,l[2]),H.RectangleGeometryLibrary.computePosition(i,r,!1,o-1,s-1,l[3]),_.Rectangle.fromCartesianArray(l,r,n)}function p(t){var e=(t=mt.defaultValue(t,mt.defaultValue.EMPTY_OBJECT)).rectangle,a=mt.defaultValue(t.height,0),r=mt.defaultValue(t.extrudedHeight,a);this._rectangle=_.Rectangle.clone(e),this._granularity=mt.defaultValue(t.granularity,dt.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=_.Ellipsoid.clone(mt.defaultValue(t.ellipsoid,_.Ellipsoid.WGS84)),this._surfaceHeight=Math.max(a,r),this._rotation=mt.defaultValue(t.rotation,0),this._stRotation=mt.defaultValue(t.stRotation,0),this._vertexFormat=vt.VertexFormat.clone(mt.defaultValue(t.vertexFormat,vt.VertexFormat.DEFAULT)),this._extrudedHeight=Math.min(a,r),this._shadowVolume=mt.defaultValue(t.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=t.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}p.packedLength=_.Rectangle.packedLength+_.Ellipsoid.packedLength+vt.VertexFormat.packedLength+7,p.pack=function(t,e,a){return a=mt.defaultValue(a,0),_.Rectangle.pack(t._rectangle,e,a),a+=_.Rectangle.packedLength,_.Ellipsoid.pack(t._ellipsoid,e,a),a+=_.Ellipsoid.packedLength,vt.VertexFormat.pack(t._vertexFormat,e,a),a+=vt.VertexFormat.packedLength,e[a++]=t._granularity,e[a++]=t._surfaceHeight,e[a++]=t._rotation,e[a++]=t._stRotation,e[a++]=t._extrudedHeight,e[a++]=t._shadowVolume?1:0,e[a]=mt.defaultValue(t._offsetAttribute,-1),e};var g=new _.Rectangle,f=_.Ellipsoid.clone(_.Ellipsoid.UNIT_SPHERE),h={rectangle:g,ellipsoid:f,vertexFormat:Dt,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};p.unpack=function(t,e,a){e=mt.defaultValue(e,0);var r=_.Rectangle.unpack(t,e,g);e+=_.Rectangle.packedLength;var n=_.Ellipsoid.unpack(t,e,f);e+=_.Ellipsoid.packedLength;var i=vt.VertexFormat.unpack(t,e,Dt);e+=vt.VertexFormat.packedLength;var o=t[e++],s=t[e++],l=t[e++],u=t[e++],c=t[e++],m=1===t[e++],d=t[e];return mt.defined(a)?(a._rectangle=_.Rectangle.clone(r,a._rectangle),a._ellipsoid=_.Ellipsoid.clone(n,a._ellipsoid),a._vertexFormat=vt.VertexFormat.clone(i,a._vertexFormat),a._granularity=o,a._surfaceHeight=s,a._rotation=l,a._stRotation=u,a._extrudedHeight=c,a._shadowVolume=m,a._offsetAttribute=-1===d?void 0:d,a):(h.granularity=o,h.height=s,h.rotation=l,h.stRotation=u,h.extrudedHeight=c,h.shadowVolume=m,h.offsetAttribute=-1===d?void 0:d,new p(h))},p.computeRectangle=function(t,e){var a=(t=mt.defaultValue(t,mt.defaultValue.EMPTY_OBJECT)).rectangle,r=mt.defaultValue(t.granularity,dt.CesiumMath.RADIANS_PER_DEGREE),n=mt.defaultValue(t.ellipsoid,_.Ellipsoid.WGS84);return y(a,r,mt.defaultValue(t.rotation,0),n,e)};var F=new k.Matrix3,G=new k.Quaternion,P=new _.Cartographic;p.createGeometry=function(t){if(!dt.CesiumMath.equalsEpsilon(t._rectangle.north,t._rectangle.south,dt.CesiumMath.EPSILON10)&&!dt.CesiumMath.equalsEpsilon(t._rectangle.east,t._rectangle.west,dt.CesiumMath.EPSILON10)){var e,a,r=t._rectangle,n=t._ellipsoid,i=t._rotation,o=t._stRotation,s=t._vertexFormat,l=H.RectangleGeometryLibrary.computeOptions(r,t._granularity,i,o,A,R,E),u=F;0!==o||0!==i?(e=_.Rectangle.center(r,P),a=n.geodeticSurfaceNormalCartographic(e,Ft),k.Quaternion.fromAxisAngle(a,-o,G),k.Matrix3.fromQuaternion(G,u)):k.Matrix3.clone(k.Matrix3.IDENTITY,u);var c,m,d,p,g,y,f,h=t._surfaceHeight,b=t._extrudedHeight,v=!dt.CesiumMath.equalsEpsilon(h,b,0,dt.CesiumMath.EPSILON2);return l.lonScalar=1/t._rectangle.width,l.latScalar=1/t._rectangle.height,l.tangentRotationMatrix=u,r=t._rectangle,d=v?(f=C(t,l),c=k.BoundingSphere.fromRectangle3D(r,n,h,w),m=k.BoundingSphere.fromRectangle3D(r,n,b,x),k.BoundingSphere.union(c,m)):((f=Pt(t,l)).attributes.position.values=At.PolygonPipeline.scaleToGeodeticHeight(f.attributes.position.values,h,n,!1),mt.defined(t._offsetAttribute)&&(p=f.attributes.position.values.length,g=new Uint8Array(p/3),y=t._offsetAttribute===bt.GeometryOffsetAttribute.NONE?0:1,bt.arrayFill(g,y),f.attributes.applyOffset=new yt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})),k.BoundingSphere.fromRectangle3D(r,n,h)),s.position||delete f.attributes.position,new yt.Geometry({attributes:f.attributes,indices:f.indices,primitiveType:f.primitiveType,boundingSphere:d,offsetAttribute:t._offsetAttribute})}},p.createShadowVolume=function(t,e,a){var r=t._granularity,n=t._ellipsoid,i=e(r,n),o=a(r,n);return new p({rectangle:t._rectangle,rotation:t._rotation,ellipsoid:n,stRotation:t._stRotation,granularity:r,extrudedHeight:o,height:i,vertexFormat:vt.VertexFormat.POSITION_ONLY,shadowVolume:!0})};var b=new _.Rectangle,v=[new _.Cartesian2,new _.Cartesian2,new _.Cartesian2],V=new yt.Matrix2,L=new _.Cartographic;return Object.defineProperties(p.prototype,{rectangle:{get:function(){return mt.defined(this._rotatedRectangle)||(this._rotatedRectangle=y(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return mt.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){if(0===t._stRotation)return[0,0,0,1,1,0];var e=_.Rectangle.clone(t._rectangle,b),a=t._granularity,r=t._ellipsoid,n=y(e,a,t._rotation-t._stRotation,r,b),i=v;i[0].x=n.west,i[0].y=n.south,i[1].x=n.west,i[1].y=n.north,i[2].x=n.east,i[2].y=n.south;for(var o=t.rectangle,s=yt.Matrix2.fromRotation(t._stRotation,V),l=_.Rectangle.center(o,L),u=0;u<3;++u){var c=i[u];c.x-=l.longitude,c.y-=l.latitude,yt.Matrix2.multiplyByVector(s,c,c),c.x+=l.longitude,c.y+=l.latitude,c.x=(c.x-o.west)/o.width,c.y=(c.y-o.south)/o.height}var m=i[0],d=i[1],p=i[2],g=new Array(6);return _.Cartesian2.pack(m,g),_.Cartesian2.pack(d,g,2),_.Cartesian2.pack(p,g,4),g}(this)),this._textureCoordinateRotationPoints}}}),function(t,e){return mt.defined(e)&&(t=p.unpack(t,e)),t._ellipsoid=_.Ellipsoid.clone(t._ellipsoid),t._rectangle=_.Rectangle.clone(t._rectangle),p.createGeometry(t)}});
