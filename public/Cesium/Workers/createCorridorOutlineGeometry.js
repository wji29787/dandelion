define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian3-2b5b9afe","./Cartesian2-577f67dc","./Transforms-18f02e2b","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./GeometryAttribute-5eb995bc","./JulianDate-53cdb307","./RequestType-beb1291d","./GeometryAttributes-fbf888b4","./IndexDatatype-c5295474","./IntersectionTests-8ff35218","./Plane-5b30f0ff","./GeometryOffsetAttribute-9f7392ac","./arrayRemoveDuplicates-a7dee4b8","./EllipsoidTangentPlane-51ba1d6b","./EllipsoidRhumbLine-b4761ded","./PolygonPipeline-6cd12a44","./PolylineVolumeGeometryLibrary-8765c50e","./EllipsoidGeodesic-47c65dee","./PolylinePipeline-76ef9442","./CorridorGeometryLibrary-63ed7059"],function(M,e,c,B,h,b,t,i,U,F,r,o,q,Y,a,n,E,g,s,l,C,J,d,u,W){"use strict";var j=new B.Cartesian3,z=new B.Cartesian3,K=new B.Cartesian3;function G(e,t){var i,r=[],o=e.positions,a=e.corners,n=e.endPositions,s=new q.GeometryAttributes,l=0,d=0,u=0;for(L=0;L<o.length;L+=2)l+=i=o[L].length-3,u+=i/3*4,d+=o[L+1].length-3;for(l+=3,d+=3,L=0;L<a.length;L++){V=a[L];var p=a[L].leftPositions;M.defined(p)?l+=i=p.length:d+=i=a[L].rightPositions.length,u+=i/3*2}var f,h=M.defined(n);h&&(l+=f=n[0].length-3,d+=f,u+=4*(f/=3));var y,c,b,g,m,v,A=l+d,_=new Float64Array(A),E=0,C=A-1,G=f/2,T=Y.IndexDatatype.createTypedArray(A/3,u+4),P=0;if(T[P++]=E/3,T[P++]=(C-2)/3,h){r.push(E/3),v=j,m=z;for(var w=n[0],L=0;L<G;L++)v=B.Cartesian3.fromArray(w,3*(G-1-L),v),m=B.Cartesian3.fromArray(w,3*(G+L),m),W.CorridorGeometryLibrary.addAttribute(_,m,E),W.CorridorGeometryLibrary.addAttribute(_,v,void 0,C),g=(c=E/3)+1,b=(y=(C-2)/3)-1,T[P++]=y,T[P++]=b,T[P++]=c,T[P++]=g,E+=3,C-=3}var D=0,k=o[D++],N=o[D++];for(_.set(k,E),_.set(N,C-N.length+1),i=N.length-3,r.push(E/3,(C-2)/3),L=0;L<i;L+=3)g=(c=E/3)+1,b=(y=(C-2)/3)-1,T[P++]=y,T[P++]=b,T[P++]=c,T[P++]=g,E+=3,C-=3;for(L=0;L<a.length;L++){var O,V,x,H=(V=a[L]).leftPositions,I=V.rightPositions,R=K;if(M.defined(H)){for(C-=3,x=b,r.push(g),O=0;O<H.length/3;O++)R=B.Cartesian3.fromArray(H,3*O,R),T[P++]=x-O-1,T[P++]=x-O,W.CorridorGeometryLibrary.addAttribute(_,R,void 0,C),C-=3;r.push(x-Math.floor(H.length/6)),t===J.CornerType.BEVELED&&r.push((C-2)/3+1),E+=3}else{for(E+=3,x=g,r.push(b),O=0;O<I.length/3;O++)R=B.Cartesian3.fromArray(I,3*O,R),T[P++]=x+O,T[P++]=x+O+1,W.CorridorGeometryLibrary.addAttribute(_,R,E),E+=3;r.push(x+Math.floor(I.length/6)),t===J.CornerType.BEVELED&&r.push(E/3-1),C-=3}for(k=o[D++],N=o[D++],k.splice(0,3),N.splice(N.length-3,3),_.set(k,E),_.set(N,C-N.length+1),i=N.length-3,O=0;O<N.length;O+=3)c=(g=E/3)-1,y=(b=(C-2)/3)+1,T[P++]=y,T[P++]=b,T[P++]=c,T[P++]=g,E+=3,C-=3;E-=3,C+=3,r.push(E/3,(C-2)/3)}if(h){E+=3,C-=3,v=j,m=z;var S=n[1];for(L=0;L<G;L++)v=B.Cartesian3.fromArray(S,3*(f-L-1),v),m=B.Cartesian3.fromArray(S,3*L,m),W.CorridorGeometryLibrary.addAttribute(_,v,void 0,C),W.CorridorGeometryLibrary.addAttribute(_,m,E),c=(g=E/3)-1,y=(b=(C-2)/3)+1,T[P++]=y,T[P++]=b,T[P++]=c,T[P++]=g,E+=3,C-=3;r.push(E/3)}else r.push(E/3,(C-2)/3);return T[P++]=E/3,T[P++]=(C-2)/3,s.position=new F.GeometryAttribute({componentDatatype:U.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:_}),{attributes:s,indices:T,wallIndices:r}}function y(e){var t=(e=M.defaultValue(e,M.defaultValue.EMPTY_OBJECT)).positions,i=e.width,r=M.defaultValue(e.height,0),o=M.defaultValue(e.extrudedHeight,r);this._positions=t,this._ellipsoid=h.Ellipsoid.clone(M.defaultValue(e.ellipsoid,h.Ellipsoid.WGS84)),this._width=i,this._height=Math.max(r,o),this._extrudedHeight=Math.min(r,o),this._cornerType=M.defaultValue(e.cornerType,J.CornerType.ROUNDED),this._granularity=M.defaultValue(e.granularity,c.CesiumMath.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*B.Cartesian3.packedLength+h.Ellipsoid.packedLength+6}y.pack=function(e,t,i){i=M.defaultValue(i,0);var r=e._positions,o=r.length;t[i++]=o;for(var a=0;a<o;++a,i+=B.Cartesian3.packedLength)B.Cartesian3.pack(r[a],t,i);return h.Ellipsoid.pack(e._ellipsoid,t,i),i+=h.Ellipsoid.packedLength,t[i++]=e._width,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._cornerType,t[i++]=e._granularity,t[i]=M.defaultValue(e._offsetAttribute,-1),t};var m=h.Ellipsoid.clone(h.Ellipsoid.UNIT_SPHERE),v={positions:void 0,ellipsoid:m,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};return y.unpack=function(e,t,i){t=M.defaultValue(t,0);for(var r=e[t++],o=new Array(r),a=0;a<r;++a,t+=B.Cartesian3.packedLength)o[a]=B.Cartesian3.unpack(e,t);var n=h.Ellipsoid.unpack(e,t,m);t+=h.Ellipsoid.packedLength;var s=e[t++],l=e[t++],d=e[t++],u=e[t++],p=e[t++],f=e[t];return M.defined(i)?(i._positions=o,i._ellipsoid=h.Ellipsoid.clone(n,i._ellipsoid),i._width=s,i._height=l,i._extrudedHeight=d,i._cornerType=u,i._granularity=p,i._offsetAttribute=-1===f?void 0:f,i):(v.positions=o,v.width=s,v.height=l,v.extrudedHeight=d,v.cornerType=u,v.granularity=p,v.offsetAttribute=-1===f?void 0:f,new y(v))},y.createGeometry=function(e){var t=e._positions,i=e._width,r=e._ellipsoid,t=function(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}(t,r),o=g.arrayRemoveDuplicates(t,B.Cartesian3.equalsEpsilon);if(!(o.length<2||i<=0)){var a,n,s,l,d=e._height,u=e._extrudedHeight,p=!c.CesiumMath.equalsEpsilon(d,u,0,c.CesiumMath.EPSILON2),f={ellipsoid:r,positions:o,width:i,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};p?(f.height=d,f.extrudedHeight=u,f.offsetAttribute=e._offsetAttribute,l=function(e){var t=e.ellipsoid,i=G(W.CorridorGeometryLibrary.computePositions(e),e.cornerType),r=i.wallIndices,o=e.height,a=e.extrudedHeight,n=i.attributes,s=i.indices,l=(f=n.position.values).length;(h=new Float64Array(l)).set(f);var d,u,p=new Float64Array(2*l),f=C.PolygonPipeline.scaleToGeodeticHeight(f,o,t),h=C.PolygonPipeline.scaleToGeodeticHeight(h,a,t);p.set(f),p.set(h,l),n.position.values=p,l/=3,M.defined(e.offsetAttribute)&&(u=new Uint8Array(2*l),u=e.offsetAttribute===E.GeometryOffsetAttribute.TOP?E.arrayFill(u,1,0,l):(d=e.offsetAttribute===E.GeometryOffsetAttribute.NONE?0:1,E.arrayFill(u,d)),n.applyOffset=new F.GeometryAttribute({componentDatatype:U.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:u}));var y=s.length,c=Y.IndexDatatype.createTypedArray(p.length/3,2*(y+r.length));c.set(s);for(var b,g,m=y,v=0;v<y;v+=2){var A=s[v],_=s[v+1];c[m++]=A+l,c[m++]=_+l}for(v=0;v<r.length;v++)g=(b=r[v])+l,c[m++]=b,c[m++]=g;return{attributes:n,indices:c}}(f)):((l=G(W.CorridorGeometryLibrary.computePositions(f),f.cornerType)).attributes.position.values=C.PolygonPipeline.scaleToGeodeticHeight(l.attributes.position.values,d,r),M.defined(e._offsetAttribute)&&(a=l.attributes.position.values.length,n=new Uint8Array(a/3),s=e._offsetAttribute===E.GeometryOffsetAttribute.NONE?0:1,E.arrayFill(n,s),l.attributes.applyOffset=new F.GeometryAttribute({componentDatatype:U.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:n})));var h=l.attributes,y=b.BoundingSphere.fromVertices(h.position.values,void 0,3);return new F.Geometry({attributes:h,indices:l.indices,primitiveType:F.PrimitiveType.LINES,boundingSphere:y,offsetAttribute:e._offsetAttribute})}},function(e,t){return M.defined(t)&&(e=y.unpack(e,t)),e._ellipsoid=h.Ellipsoid.clone(e._ellipsoid),y.createGeometry(e)}});
