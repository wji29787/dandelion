define(["./when-b43ff45e","./Check-d404a0fe","./Math-336da716","./Cartesian3-2b5b9afe","./Cartesian2-577f67dc","./Transforms-18f02e2b","./RuntimeError-bf10f3d5","./WebGLConstants-56de22c0","./ComponentDatatype-8956ad9a","./GeometryAttribute-5eb995bc","./JulianDate-53cdb307","./RequestType-beb1291d","./GeometryAttributes-fbf888b4","./AttributeCompression-c335d1ea","./GeometryPipeline-282a4062","./EncodedCartesian3-f0c89625","./IndexDatatype-c5295474","./IntersectionTests-8ff35218","./Plane-5b30f0ff","./GeometryOffsetAttribute-9f7392ac","./VertexFormat-89c0971b","./GeometryInstance-18f1f5f5","./arrayRemoveDuplicates-a7dee4b8","./BoundingRectangle-a11f7177","./EllipsoidTangentPlane-51ba1d6b","./ArcType-46047bc6","./EllipsoidRhumbLine-b4761ded","./PolygonPipeline-6cd12a44","./PolygonGeometryLibrary-faa86917","./EllipsoidGeodesic-47c65dee"],function(Y,e,U,j,Q,q,t,r,J,K,a,o,i,n,F,s,L,l,u,Z,b,N,p,c,H,y,m,R,M,g){"use strict";var d=new Q.Cartographic,h=new Q.Cartographic;function X(e,t,r,a){var o=a.cartesianToCartographic(e,d).height,i=a.cartesianToCartographic(t,h);i.height=o,a.cartographicToCartesian(i,t);var n=a.cartesianToCartographic(r,h);n.height=o-100,a.cartographicToCartesian(n,r)}var S=new c.BoundingRectangle,$=new j.Cartesian3,ee=new j.Cartesian3,te=new j.Cartesian3,re=new j.Cartesian3,ae=new j.Cartesian3,oe=new j.Cartesian3,ie=new j.Cartesian3,ne=new j.Cartesian3,se=new j.Cartesian3,le=new Q.Cartesian2,ue=new Q.Cartesian2,pe=new j.Cartesian3,ce=new q.Quaternion,ye=new q.Matrix3,me=new q.Matrix3;function B(e){var t,r,a,o=e.vertexFormat,i=e.geometry,n=e.shadowVolume,s=i.attributes.position.values,l=s.length,u=e.wall,p=e.top||u,c=e.bottom||u;if(o.st||o.normal||o.tangent||o.bitangent||n){var y=e.boundingRectangle,m=e.tangentPlane,g=e.ellipsoid,d=e.stRotation,h=e.perPositionHeight,f=le;f.x=y.x,f.y=y.y;var b,v=o.st?new Float32Array(l/3*2):void 0;o.normal&&(b=h&&p&&!u?i.attributes.normal.values:new Float32Array(l));var _,P=o.tangent?new Float32Array(l):void 0,C=o.bitangent?new Float32Array(l):void 0,w=n?new Float32Array(l):void 0,T=0,x=0,I=ee,A=te,E=re,G=!0,O=ye,V=me;V=0!==d?(_=q.Quaternion.fromAxisAngle(m._plane.normal,d,ce),O=q.Matrix3.fromQuaternion(_,O),_=q.Quaternion.fromAxisAngle(m._plane.normal,-d,ce),q.Matrix3.fromQuaternion(_,V)):(O=q.Matrix3.clone(q.Matrix3.IDENTITY,O),q.Matrix3.clone(q.Matrix3.IDENTITY,V));var D=0,F=0;p&&c&&(D=l/2,F=l/3,l/=2);for(var L=0;L<l;L+=3){var N,H,R,M,S,B,k,z,W=j.Cartesian3.fromArray(s,L,pe);o.st&&(N=q.Matrix3.multiplyByVector(O,W,$),N=g.scaleToGeodeticSurface(N,N),H=m.projectPointOntoPlane(N,ue),Q.Cartesian2.subtract(H,f,H),R=U.CesiumMath.clamp(H.x/y.width,0,1),M=U.CesiumMath.clamp(H.y/y.height,0,1),c&&(v[T+F]=R,v[T+1+F]=M),p&&(v[T]=R,v[T+1]=M),T+=2),(o.normal||o.tangent||o.bitangent||n)&&(S=x+1,B=x+2,u?(L+3<l&&(k=j.Cartesian3.fromArray(s,L+3,ae),G&&(z=j.Cartesian3.fromArray(s,L+l,oe),h&&X(W,k,z,g),j.Cartesian3.subtract(k,W,k),j.Cartesian3.subtract(z,W,z),I=j.Cartesian3.normalize(j.Cartesian3.cross(z,k,I),I),G=!1),j.Cartesian3.equalsEpsilon(k,W,U.CesiumMath.EPSILON10)&&(G=!0)),(o.tangent||o.bitangent)&&(E=g.geodeticSurfaceNormal(W,E),o.tangent&&(A=j.Cartesian3.normalize(j.Cartesian3.cross(E,I,A),A)))):(I=g.geodeticSurfaceNormal(W,I),(o.tangent||o.bitangent)&&(h&&(ie=j.Cartesian3.fromArray(b,x,ie),ne=j.Cartesian3.cross(j.Cartesian3.UNIT_Z,ie,ne),ne=j.Cartesian3.normalize(q.Matrix3.multiplyByVector(V,ne,ne),ne),o.bitangent&&(se=j.Cartesian3.normalize(j.Cartesian3.cross(ie,ne,se),se))),A=j.Cartesian3.cross(j.Cartesian3.UNIT_Z,I,A),A=j.Cartesian3.normalize(q.Matrix3.multiplyByVector(V,A,A),A),o.bitangent&&(E=j.Cartesian3.normalize(j.Cartesian3.cross(I,A,E),E)))),o.normal&&(e.wall?(b[x+D]=I.x,b[S+D]=I.y,b[B+D]=I.z):c&&(b[x+D]=-I.x,b[S+D]=-I.y,b[B+D]=-I.z),(p&&!h||u)&&(b[x]=I.x,b[S]=I.y,b[B]=I.z)),n&&(u&&(I=g.geodeticSurfaceNormal(W,I)),w[x+D]=-I.x,w[S+D]=-I.y,w[B+D]=-I.z),o.tangent&&(e.wall?(P[x+D]=A.x,P[S+D]=A.y,P[B+D]=A.z):c&&(P[x+D]=-A.x,P[S+D]=-A.y,P[B+D]=-A.z),p&&(h?(P[x]=ne.x,P[S]=ne.y,P[B]=ne.z):(P[x]=A.x,P[S]=A.y,P[B]=A.z))),o.bitangent&&(c&&(C[x+D]=E.x,C[S+D]=E.y,C[B+D]=E.z),p&&(h?(C[x]=se.x,C[S]=se.y,C[B]=se.z):(C[x]=E.x,C[S]=E.y,C[B]=E.z))),x+=3)}o.st&&(i.attributes.st=new K.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:v})),o.normal&&(i.attributes.normal=new K.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:b})),o.tangent&&(i.attributes.tangent=new K.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P})),o.bitangent&&(i.attributes.bitangent=new K.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:C})),n&&(i.attributes.extrudeDirection=new K.GeometryAttribute({componentDatatype:J.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w}))}return e.extrude&&Y.defined(e.offsetAttribute)&&(t=s.length/3,a=new Uint8Array(t),e.offsetAttribute===Z.GeometryOffsetAttribute.TOP?p&&c||u?a=Z.arrayFill(a,1,0,t/2):p&&(a=Z.arrayFill(a,1)):(r=e.offsetAttribute===Z.GeometryOffsetAttribute.NONE?0:1,a=Z.arrayFill(a,r)),i.attributes.applyOffset=new K.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:a})),i}var f=new Q.Cartographic,v=new Q.Cartographic,_={westOverIDL:0,eastOverIDL:0},P=new g.EllipsoidGeodesic;function C(e,t,r,a,o){if(o=Y.defaultValue(o,new Q.Rectangle),!Y.defined(e)||e.length<3)return o.west=0,o.north=0,o.south=0,o.east=0,o;if(r===y.ArcType.RHUMB)return Q.Rectangle.fromCartesianArray(e,t,o);P.ellipsoid.equals(t)||(P=new g.EllipsoidGeodesic(void 0,void 0,t)),o.west=Number.POSITIVE_INFINITY,o.east=Number.NEGATIVE_INFINITY,o.south=Number.POSITIVE_INFINITY,o.north=Number.NEGATIVE_INFINITY,_.westOverIDL=Number.POSITIVE_INFINITY,_.eastOverIDL=Number.NEGATIVE_INFINITY;for(var i,n=1/U.CesiumMath.chordLength(a,t.maximumRadius),s=e.length,l=t.cartesianToCartographic(e[0],v),u=f,p=1;p<s;p++)i=u,u=l,l=t.cartesianToCartographic(e[p],i),P.setEndPoints(u,l),T(P,n,o,_);return i=u,u=l,l=t.cartesianToCartographic(e[0],i),P.setEndPoints(u,l),T(P,n,o,_),o.east-o.west>_.eastOverIDL-_.westOverIDL&&(o.west=_.westOverIDL,o.east=_.eastOverIDL,o.east>U.CesiumMath.PI&&(o.east=o.east-U.CesiumMath.TWO_PI),o.west>U.CesiumMath.PI&&(o.west=o.west-U.CesiumMath.TWO_PI)),o}var w=new Q.Cartographic;function T(e,t,r,a){for(var o=e.surfaceDistance,i=Math.ceil(o*t),n=0<i?o/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,w);s+=n;var p=u.longitude,c=u.latitude;r.west=Math.min(r.west,p),r.east=Math.max(r.east,p),r.south=Math.min(r.south,c),r.north=Math.max(r.north,c);var y=0<=p?p:p+U.CesiumMath.TWO_PI;a.westOverIDL=Math.min(a.westOverIDL,y),a.eastOverIDL=Math.max(a.eastOverIDL,y)}}var E=[];function k(e,t,r,a,o,i,n,s,l){var u={walls:[]};if(i||n){var p=M.PolygonGeometryLibrary.createGeometryFromPositions(e,t,r,o,s,l),c=p.attributes.position.values,y=p.indices;if(i&&n){var m,g=c.concat(c),d=g.length/3;(m=L.IndexDatatype.createTypedArray(d,2*y.length)).set(y);for(var h,f=y.length,b=d/2,v=0;v<f;v+=3){var _=m[v]+b,P=m[v+1]+b,C=m[v+2]+b;m[v+f]=C,m[v+1+f]=P,m[v+2+f]=_}p.attributes.position.values=g,o&&s.normal&&(h=p.attributes.normal.values,p.attributes.normal.values=new Float32Array(g.length),p.attributes.normal.values.set(h)),p.indices=m}else if(n){for(d=c.length/3,m=L.IndexDatatype.createTypedArray(d,y.length),v=0;v<y.length;v+=3)m[v]=y[v+2],m[v+1]=y[v+1],m[v+2]=y[v];p.indices=m}u.topAndBottom=new N.GeometryInstance({geometry:p})}var w=a.outerRing,T=H.EllipsoidTangentPlane.fromPoints(w,e).projectPointsOntoPlane(w,E);R.PolygonPipeline.computeWindingOrder2D(T)===R.WindingOrder.CLOCKWISE&&(w=w.slice().reverse());var x=M.PolygonGeometryLibrary.computeWallGeometry(w,e,r,o,l);u.walls.push(new N.GeometryInstance({geometry:x}));var I=a.holes;for(v=0;v<I.length;v++){var A=I[v],T=H.EllipsoidTangentPlane.fromPoints(A,e).projectPointsOntoPlane(A,E);R.PolygonPipeline.computeWindingOrder2D(T)===R.WindingOrder.COUNTER_CLOCKWISE&&(A=A.slice().reverse()),x=M.PolygonGeometryLibrary.computeWallGeometry(A,e,r,o,l),u.walls.push(new N.GeometryInstance({geometry:x}))}return u}function x(e){var t,r=e.polygonHierarchy,a=Y.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT),o=Y.defaultValue(e.ellipsoid,Q.Ellipsoid.WGS84),i=Y.defaultValue(e.granularity,U.CesiumMath.RADIANS_PER_DEGREE),n=Y.defaultValue(e.stRotation,0),s=Y.defaultValue(e.perPositionHeight,!1),l=s&&Y.defined(e.extrudedHeight),u=Y.defaultValue(e.height,0),p=Y.defaultValue(e.extrudedHeight,u);l||(t=Math.max(u,p),p=Math.min(u,p),u=t),this._vertexFormat=b.VertexFormat.clone(a),this._ellipsoid=Q.Ellipsoid.clone(o),this._granularity=i,this._stRotation=n,this._height=u,this._extrudedHeight=p,this._closeTop=Y.defaultValue(e.closeTop,!0),this._closeBottom=Y.defaultValue(e.closeBottom,!0),this._polygonHierarchy=r,this._perPositionHeight=s,this._perPositionHeightExtrude=l,this._shadowVolume=Y.defaultValue(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=Y.defaultValue(e.arcType,y.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=M.PolygonGeometryLibrary.computeHierarchyPackedLength(r)+Q.Ellipsoid.packedLength+b.VertexFormat.packedLength+12}x.fromPositions=function(e){return new x({polygonHierarchy:{positions:(e=Y.defaultValue(e,Y.defaultValue.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},x.pack=function(e,t,r){return r=Y.defaultValue(r,0),r=M.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,r),Q.Ellipsoid.pack(e._ellipsoid,t,r),r+=Q.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,t,r),r+=b.VertexFormat.packedLength,t[r++]=e._height,t[r++]=e._extrudedHeight,t[r++]=e._granularity,t[r++]=e._stRotation,t[r++]=e._perPositionHeightExtrude?1:0,t[r++]=e._perPositionHeight?1:0,t[r++]=e._closeTop?1:0,t[r++]=e._closeBottom?1:0,t[r++]=e._shadowVolume?1:0,t[r++]=Y.defaultValue(e._offsetAttribute,-1),t[r++]=e._arcType,t[r]=e.packedLength,t};var I=Q.Ellipsoid.clone(Q.Ellipsoid.UNIT_SPHERE),A=new b.VertexFormat,G={polygonHierarchy:{}};return x.unpack=function(e,t,r){t=Y.defaultValue(t,0);var a=M.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=a.startingIndex,delete a.startingIndex;var o=Q.Ellipsoid.unpack(e,t,I);t+=Q.Ellipsoid.packedLength;var i=b.VertexFormat.unpack(e,t,A);t+=b.VertexFormat.packedLength;var n=e[t++],s=e[t++],l=e[t++],u=e[t++],p=1===e[t++],c=1===e[t++],y=1===e[t++],m=1===e[t++],g=1===e[t++],d=e[t++],h=e[t++],f=e[t];return Y.defined(r)||(r=new x(G)),r._polygonHierarchy=a,r._ellipsoid=Q.Ellipsoid.clone(o,r._ellipsoid),r._vertexFormat=b.VertexFormat.clone(i,r._vertexFormat),r._height=n,r._extrudedHeight=s,r._granularity=l,r._stRotation=u,r._perPositionHeightExtrude=p,r._perPositionHeight=c,r._closeTop=y,r._closeBottom=m,r._shadowVolume=g,r._offsetAttribute=-1===d?void 0:d,r._arcType=h,r.packedLength=f,r},x.computeRectangle=function(e,t){var r=Y.defaultValue(e.granularity,U.CesiumMath.RADIANS_PER_DEGREE),a=Y.defaultValue(e.arcType,y.ArcType.GEODESIC),o=e.polygonHierarchy,i=Y.defaultValue(e.ellipsoid,Q.Ellipsoid.WGS84);return C(o.positions,i,a,r,t)},x.createGeometry=function(e){var t=e._vertexFormat,r=e._ellipsoid,a=e._granularity,o=e._stRotation,i=e._polygonHierarchy,n=e._perPositionHeight,s=e._closeTop,l=e._closeBottom,u=e._arcType,p=i.positions;if(!(p.length<3)){var c=H.EllipsoidTangentPlane.fromPoints(p,r),y=M.PolygonGeometryLibrary.polygonsFromHierarchy(i,c.projectPointsOntoPlane.bind(c),!n,r),m=y.hierarchy,g=y.polygons;if(0!==m.length){p=m[0].outerRing;var d,h=M.PolygonGeometryLibrary.computeBoundingRectangle(c.plane.normal,c.projectPointOntoPlane.bind(c),p,o,S),f=[],b=e._height,v=e._extrudedHeight,_={perPositionHeight:n,vertexFormat:t,geometry:void 0,tangentPlane:c,boundingRectangle:h,ellipsoid:r,stRotation:o,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:u};if(e._perPositionHeightExtrude||!U.CesiumMath.equalsEpsilon(b,v,0,U.CesiumMath.EPSILON2))for(_.extrude=!0,_.top=s,_.bottom=l,_.shadowVolume=e._shadowVolume,_.offsetAttribute=e._offsetAttribute,d=0;d<g.length;d++){var P,C=k(r,g[d],a,m[d],n,s,l,t,u);s&&l?(P=C.topAndBottom,_.geometry=M.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(P.geometry,b,v,r,n)):s?((P=C.topAndBottom).geometry.attributes.position.values=R.PolygonPipeline.scaleToGeodeticHeight(P.geometry.attributes.position.values,b,r,!n),_.geometry=P.geometry):l&&((P=C.topAndBottom).geometry.attributes.position.values=R.PolygonPipeline.scaleToGeodeticHeight(P.geometry.attributes.position.values,v,r,!0),_.geometry=P.geometry),(s||l)&&(_.wall=!1,P.geometry=B(_),f.push(P));var w=C.walls;_.wall=!0;for(var T=0;T<w.length;T++){var x=w[T];_.geometry=M.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(x.geometry,b,v,r,n),x.geometry=B(_),f.push(x)}}else for(d=0;d<g.length;d++){var I,A,E,G=new N.GeometryInstance({geometry:M.PolygonGeometryLibrary.createGeometryFromPositions(r,g[d],a,n,t,u)});G.geometry.attributes.position.values=R.PolygonPipeline.scaleToGeodeticHeight(G.geometry.attributes.position.values,b,r,!n),_.geometry=G.geometry,G.geometry=B(_),Y.defined(e._offsetAttribute)&&(I=G.geometry.attributes.position.values.length,A=new Uint8Array(I/3),E=e._offsetAttribute===Z.GeometryOffsetAttribute.NONE?0:1,Z.arrayFill(A,E),G.geometry.attributes.applyOffset=new K.GeometryAttribute({componentDatatype:J.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:A})),f.push(G)}var O=F.GeometryPipeline.combineInstances(f)[0];O.attributes.position.values=new Float64Array(O.attributes.position.values),O.indices=L.IndexDatatype.createTypedArray(O.attributes.position.values.length/3,O.indices);var V=O.attributes,D=q.BoundingSphere.fromVertices(V.position.values);return t.position||delete V.position,new K.Geometry({attributes:V,indices:O.indices,primitiveType:O.primitiveType,boundingSphere:D,offsetAttribute:e._offsetAttribute})}}},x.createShadowVolume=function(e,t,r){var a=e._granularity,o=e._ellipsoid,i=t(a,o),n=r(a,o);return new x({polygonHierarchy:e._polygonHierarchy,ellipsoid:o,stRotation:e._stRotation,granularity:a,perPositionHeight:!1,extrudedHeight:i,height:n,vertexFormat:b.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(x.prototype,{rectangle:{get:function(){var e;return Y.defined(this._rectangle)||(e=this._polygonHierarchy.positions,this._rectangle=C(e,this._ellipsoid,this._arcType,this._granularity)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Y.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0==t)return[0,0,0,1,1,0];var r=e._ellipsoid,a=e._polygonHierarchy.positions,o=e.rectangle;return K.Geometry._textureCoordinateRotationPoints(a,t,r,o)}(this)),this._textureCoordinateRotationPoints}}}),function(e,t){return Y.defined(t)&&(e=x.unpack(e,t)),e._ellipsoid=Q.Ellipsoid.clone(e._ellipsoid),x.createGeometry(e)}});
