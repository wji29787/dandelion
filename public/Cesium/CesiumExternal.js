!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).CesiumExternal={})}(this,function(e){"use strict";function o(e){var t;e instanceof o?(this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment):e&&(t=n.exec(e),this.scheme=t[1],this.authority=t[2],this.path=t[3],this.query=t[4],this.fragment=t[5])}o.prototype.scheme=null,o.prototype.authority=null,o.prototype.path="",o.prototype.query=null,o.prototype.fragment=null;var n=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");o.prototype.getScheme=function(){return this.scheme},o.prototype.getAuthority=function(){return this.authority},o.prototype.getPath=function(){return this.path},o.prototype.getQuery=function(){return this.query},o.prototype.getFragment=function(){return this.fragment},o.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},o.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},o.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},o.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(s,l).replace(t,u)),this.path&&(this.path=this.path.replace(t,u)),this.query&&(this.query=this.query.replace(t,u)),this.fragment&&(this.fragment=this.fragment.replace(t,u))};var r,i,c,t=/%[0-9a-z]{2}/gi,a=/[a-zA-Z0-9\-\._~]/,s=/(.*@)?([^@:]*)(:.*)?/;function u(e){var t=unescape(e);return a.test(t)?t:e.toUpperCase()}function l(e,t,n,r){return(t||"")+n.toLowerCase()+(r||"")}function D(e,t,n,r){return h(e).then(t,n,r)}function h(e){var t,n,r=e instanceof f?e:d(e)?(t=g(),e.then(function(e){t.resolve(e)},function(e){t.reject(e)},function(e){t.progress(e)}),t.promise):(n=e,new f(function(e){try{return h(e?e(n):n)}catch(e){return p(e)}}));return r}function f(e){this.then=e}function p(n){return new f(function(e,t){try{return t?h(t(n)):p(n)}catch(e){return p(e)}})}function g(){var e=new f(i),a=[],s=[],r=function(t,n,r){var i=g(),o="function"==typeof r?function(e){try{i.progress(r(e))}catch(e){i.progress(e)}}:function(e){i.progress(e)};return a.push(function(e){e.then(t,n).then(i.resolve,i.reject,o)}),s.push(o),i.promise},t=function(e){return v(s,e),e},n=function(e){return e=h(e),r=e.then,n=h,t=b,v(a,e),s=a=c,e};return{then:i,resolve:o,reject:u,progress:l,promise:e,resolver:{resolve:o,reject:u,progress:l}};function i(e,t,n){return r(e,t,n)}function o(e){return n(e)}function u(e){return n(p(e))}function l(e){return t(e)}}function d(e){return e&&"function"==typeof e.then}function m(e,p,d,m,_){return x(2,arguments),D(e,function(e){var t,n,r,i,o=e.length>>>0,a=Math.max(0,Math.min(p,o)),s=[],u=o-a+1,l=[],c=g();if(a)for(r=c.progress,n=function(e){l.push(e),--u||(t=n=b,c.reject(l))},t=function(e){s.push(e),--a||(t=n=b,c.resolve(s))},i=0;i<o;++i)i in e&&D(e[i],f,h,r);else c.resolve(s);return c.then(d,m,_);function h(e){n(e)}function f(e){t(e)}})}function _(e,t,n,r){return x(1,arguments),y(e,E).then(t,n,r)}function y(e,s){return D(e,function(e){var t,n,r,i=t=e.length>>>0,o=[],a=g();if(i)for(n=function(e,t){D(e,s).then(function(e){o[t]=e,--i||a.resolve(o)},a.reject)},r=0;r<t;r++)r in e?n(e[r],r):--i;else a.resolve(o);return a.promise})}function v(e,t){for(var n,r=0;n=e[r++];)n(t)}function x(e,t){for(var n,r=t.length;e<r;)if(null!=(n=t[--r])&&"function"!=typeof n)throw new Error("arg "+r+" must be a function")}function b(){}function E(e){return e}function T(e){return 0!==e.length&&"/"===e[e.length-1]||(e+="/"),e}function Ze(e){return null!=e}function fe(e){var t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(e){t=e.stack}this.stack=t}o.prototype.resolve=function(e){var t=new o;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?t.path=this.path:e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments(),t.query=this.query))),t.fragment=this.fragment,t},o.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),n=[],r=""==t[0];r&&t.shift();for(""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?n.pop():"."!=e&&n.push(e);"."!=e&&".."!=e||n.push(""),r&&n.unshift(""),this.path=n.join("/")},o.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},D.defer=g,D.resolve=h,D.reject=function(e){return D(e,p)},D.join=function(){return y(arguments,E)},D.all=_,D.map=y,D.reduce=function(e,o){var t=i.call(arguments,1);return D(e,function(e){var i=e.length;return t[0]=function(e,n,r){return D(e,function(t){return D(n,function(e){return o(t,e,r,i)})})},r.apply(e,t)})},D.any=function(e,t,n,r){return m(e,1,function(e){return t?t(e[0]):e[0]},n,r)},D.some=m,D.chain=function(e,t,n){var r=2<arguments.length;return D(e,function(e){return e=r?n:e,t.resolve(e),e},function(e){return t.reject(e),p(e)},t.progress)},D.isPromise=d,f.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(c,e)},yield:function(e){return this.then(function(){return e})},spread:function(t){return this.then(function(e){return _(e,function(e){return t.apply(c,e)})})}},i=[].slice,r=[].reduce||function(e){var t,n=0,r=Object(this),i=r.length>>>0,o=arguments;if(o.length<=1)for(;;){if(n in r){t=r[n++];break}if(++n>=i)throw new TypeError}else t=o[1];for(;n<i;++n)n in r&&(t=e(t,r[n],n,r));return t},Ze(Object.create)&&((fe.prototype=Object.create(Error.prototype)).constructor=fe),fe.prototype.toString=function(){var e=this.name+": "+this.message;return Ze(this.stack)&&(e+="\n"+this.stack.toString()),e},fe.throwInstantiationError=function(){throw new fe("This function defines an interface and should not be called directly.")};var S={};function C(e,t,n){return"Expected "+n+" to be typeof "+t+", actual typeof was "+e}function Je(e,t){return null!=e?e:t}function $e(e,t){if(null===e||"object"!=typeof e)return e;t=Je(t,!1);var n,r=new e.constructor;for(var i in e){e.hasOwnProperty(i)&&(n=e[i],t&&(n=$e(n,t)),r[i]=n)}return r}function ne(e,t,n){n=Je(n,!1);var r,i,o,a={},s=Ze(e),u=Ze(t);if(s)for(r in e)e.hasOwnProperty(r)&&(i=e[r],u&&n&&"object"==typeof i&&t.hasOwnProperty(r)?(o=t[r],a[r]="object"==typeof o?ne(i,o,n):i):a[r]=i);if(u)for(r in t)t.hasOwnProperty(r)&&!a.hasOwnProperty(r)&&(o=t[r],a[r]=o);return a}function w(e,t){var n;return"undefined"!=typeof document&&(n=document),w._implementation(e,t,n)}S.typeOf={},S.defined=function(e,t){if(!Ze(t))throw new fe(e+" is required, actual value was undefined")},S.typeOf.func=function(e,t){if("function"!=typeof t)throw new fe(C(typeof t,"function",e))},S.typeOf.string=function(e,t){if("string"!=typeof t)throw new fe(C(typeof t,"string",e))},S.typeOf.number=function(e,t){if("number"!=typeof t)throw new fe(C(typeof t,"number",e))},S.typeOf.number.lessThan=function(e,t,n){if(S.typeOf.number(e,t),n<=t)throw new fe("Expected "+e+" to be less than "+n+", actual value was "+t)},S.typeOf.number.lessThanOrEquals=function(e,t,n){if(S.typeOf.number(e,t),n<t)throw new fe("Expected "+e+" to be less than or equal to "+n+", actual value was "+t)},S.typeOf.number.greaterThan=function(e,t,n){if(S.typeOf.number(e,t),t<=n)throw new fe("Expected "+e+" to be greater than "+n+", actual value was "+t)},S.typeOf.number.greaterThanOrEquals=function(e,t,n){if(S.typeOf.number(e,t),t<n)throw new fe("Expected "+e+" to be greater than or equal to"+n+", actual value was "+t)},S.typeOf.object=function(e,t){if("object"!=typeof t)throw new fe(C(typeof t,"object",e))},S.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new fe(C(typeof t,"boolean",e))},S.typeOf.number.equals=function(e,t,n,r){if(S.typeOf.number(e,n),S.typeOf.number(t,r),n!==r)throw new fe(e+" must be equal to "+t+", the actual values are "+n+" and "+r)},Je.EMPTY_OBJECT=Object.freeze({}),w._implementation=function(e,t,n){if(!Ze(t)){if(void 0===n)return e;t=Je(n.baseURI,n.location.href)}var r=new o(t);return new o(e).resolve(r).toString()};var A,I=/^blob:/i;function P(e){return I.test(e)}function O(e){Ze(A)||(A=document.createElement("a")),A.href=window.location.href;var t=A.host,n=A.protocol;return A.href=e,A.href=A.href,n!==A.protocol||t!==A.host}var L=/^data:/i;function N(e){return L.test(e)}function R(e){var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=encodeURIComponent(n)+"=";if(Array.isArray(r))for(var o=0,a=r.length;o<a;++o)t+=i+encodeURIComponent(r[o])+"&";else t+=i+encodeURIComponent(r)+"&"}return t=t.slice(0,-1)}function M(e){var t={};if(""===e)return t;for(var n=e.replace(/\+/g,"%20").split(/[&;]/),r=0,i=n.length;r<i;++r){var o=n[r].split("="),a=decodeURIComponent(o[0]),s=Ze(s=o[1])?decodeURIComponent(s):"",u=t[a];"string"==typeof u?t[a]=[u,s]:Array.isArray(u)?u.push(s):t[a]=s}return t}var F=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),pe=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3});function z(e){e=Je(e,Je.EMPTY_OBJECT);var t=Je(e.throttleByServer,!1),n=Je(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=Je(e.priority,0),this.throttle=n,this.throttleByServer=t,this.type=Je(e.type,pe.OTHER),this.serverKey=void 0,this.state=F.UNISSUED,this.deferred=void 0,this.cancelled=!1}function B(e,t,n){this.statusCode=e,this.response=t,this.responseHeaders=n,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var n=e.split("\r\n"),r=0;r<n.length;++r){var i,o,a=n[r],s=a.indexOf(": ");0<s&&(i=a.substring(0,s),o=a.substring(s+2),t[i]=o)}return t}(this.responseHeaders))}function U(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function V(e,t){return t-e}function k(e){this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function G(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}z.prototype.cancel=function(){this.cancelled=!0},z.prototype.clone=function(e){return Ze(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new z(this)},B.prototype.toString=function(){var e="Request has failed.";return Ze(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e},Object.defineProperties(U.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),U.prototype.addEventListener=function(e,t){this._listeners.push(e),this._scopes.push(t);var n=this;return function(){n.removeEventListener(e,t)}},U.prototype.removeEventListener=function(e,t){for(var n=this._listeners,r=this._scopes,i=-1,o=0;o<n.length;o++)if(n[o]===e&&r[o]===t){i=o;break}return-1!==i&&(this._insideRaiseEvent?(this._toRemove.push(i),n[i]=void 0,r[i]=void 0):(n.splice(i,1),r.splice(i,1)),!0)},U.prototype.raiseEvent=function(){this._insideRaiseEvent=!0;for(var e=this._listeners,t=this._scopes,n=e.length,r=0;r<n;r++){Ze(e[r])&&e[r].apply(t[r],arguments)}var i=this._toRemove;if(0<(n=i.length)){for(i.sort(V),r=0;r<n;r++){var o=i[r];e.splice(o,1),t.splice(o,1)}i.length=0}this._insideRaiseEvent=!1},Object.defineProperties(k.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){this._maximumLength=e,this._length>e&&0<e&&(this._length=e,this._array.length=e)}},comparator:{get:function(){return this._comparator}}}),k.prototype.reserve=function(e){e=Je(e,this._length),this._array.length=e},k.prototype.heapify=function(e){e=Je(e,0);for(var t=this._length,n=this._comparator,r=this._array,i=-1,o=!0;o;){var a=2*(e+1),s=a-1,i=s<t&&n(r[s],r[e])<0?s:e;a<t&&n(r[a],r[i])<0&&(i=a),i!==e?(G(r,i,e),e=i):o=!1}},k.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);0<=t;--t)this.heapify(t)},k.prototype.insert=function(e){var t,n=this._array,r=this._comparator,i=this._maximumLength,o=this._length++;for(o<n.length?n[o]=e:n.push(e);0!==o;){var a=Math.floor((o-1)/2);if(!(r(n[o],n[a])<0))break;G(n,o,a),o=a}return Ze(i)&&this._length>i&&(t=n[i],this._length=i),t},k.prototype.pop=function(e){if(e=Je(e,0),0!==this._length){var t=this._array,n=t[e];return G(t,e,--this._length),this.heapify(e),n}};var q={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},H=2e4,W=new k({comparator:function(e,t){return e.priority-t.priority}});W.maximumLength=H,W.reserve(H);var Y=[],X={},j="undefined"!=typeof document?new o(document.location.href):new o,K=new U;function Q(){}function Z(e){Ze(e.priorityFunction)&&(e.priority=e.priorityFunction())}function J(e){var t=Je(Q.requestsByServer[e],Q.maximumRequestsPerServer);return X[e]<t}function $(e){return e.state===F.UNISSUED&&(e.state=F.ISSUED,e.deferred=D.defer()),e.deferred.promise}function ee(e){var t,n,r=$(e);return e.state=F.ACTIVE,Y.push(e),++q.numberOfActiveRequests,++q.numberOfActiveRequestsEver,++X[e.serverKey],e.requestFunction().then((n=e,function(e){n.state!==F.CANCELLED&&(--q.numberOfActiveRequests,--X[n.serverKey],K.raiseEvent(),n.state=F.RECEIVED,n.deferred.resolve(e))})).otherwise((t=e,function(e){t.state!==F.CANCELLED&&(++q.numberOfFailedRequests,--q.numberOfActiveRequests,--X[t.serverKey],K.raiseEvent(e),t.state=F.FAILED,t.deferred.reject(e))})),r}function te(e){var t=e.state===F.ACTIVE;e.state=F.CANCELLED,++q.numberOfCancelledRequests,e.deferred.reject(),t&&(--q.numberOfActiveRequests,--X[e.serverKey],++q.numberOfCancelledActiveRequests),Ze(e.cancelFunction)&&e.cancelFunction()}function de(e){var t;this.name="RuntimeError",this.message=e;try{throw new Error}catch(e){t=e.stack}this.stack=t}Q.maximumRequests=5e4,Q.maximumRequestsPerServer=6e3,Q.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},Q.throttleRequests=!0,Q.debugShowStatistics=!1,Q.requestCompletedEvent=K,Object.defineProperties(Q,{statistics:{get:function(){return q}},priorityHeapLength:{get:function(){return H},set:function(e){if(e<H)for(;W.length>e;){te(W.pop())}H=e,W.maximumLength=e,W.reserve(e)}}}),Q.update=function(){for(var e,t=0,n=Y.length,r=0;r<n;++r)(e=Y[r]).cancelled&&te(e),e.state===F.ACTIVE?0<t&&(Y[r-t]=e):++t;Y.length-=t;var i=W.internalArray,o=W.length;for(r=0;r<o;++r)Z(i[r]);W.resort();for(var a=Math.max(Q.maximumRequests-Y.length,0),s=0;s<a&&0<W.length;)!(e=W.pop()).cancelled&&(!e.throttleByServer||J(e.serverKey))?(ee(e),++s):te(e);!function(){if(!Q.debugShowStatistics)return;0===q.numberOfActiveRequests&&0<q.lastNumberOfActiveRequests&&(0<q.numberOfAttemptedRequests&&(console.log("Number of attempted requests: "+q.numberOfAttemptedRequests),q.numberOfAttemptedRequests=0),0<q.numberOfCancelledRequests&&(console.log("Number of cancelled requests: "+q.numberOfCancelledRequests),q.numberOfCancelledRequests=0),0<q.numberOfCancelledActiveRequests&&(console.log("Number of cancelled active requests: "+q.numberOfCancelledActiveRequests),q.numberOfCancelledActiveRequests=0),0<q.numberOfFailedRequests&&(console.log("Number of failed requests: "+q.numberOfFailedRequests),q.numberOfFailedRequests=0));q.lastNumberOfActiveRequests=q.numberOfActiveRequests}()},Q.getServerKey=function(e){var t=new o(e).resolve(j);t.normalize();var n=t.authority;return/:/.test(n)||(n=n+":"+("https"===t.scheme?"443":"80")),Ze(X[n])||(X[n]=0),n},Q.request=function(e){if(N(e.url)||P(e.url))return K.raiseEvent(),e.state=F.RECEIVED,e.requestFunction();if(++q.numberOfAttemptedRequests,Ze(e.serverKey)||(e.serverKey=Q.getServerKey(e.url)),!Q.throttleRequests||!e.throttleByServer||J(e.serverKey)){if(!Q.throttleRequests||!e.throttle)return ee(e);if(!(Y.length>=Q.maximumRequests)){Z(e);var t=W.insert(e);if(Ze(t)){if(t===e)return;te(t)}return $(e)}}},Q.clearForSpecs=function(){for(;0<W.length;){te(W.pop())}for(var e=Y.length,t=0;t<e;++t)te(Y[t]);Y.length=0,X={},q.numberOfAttemptedRequests=0,q.numberOfActiveRequests=0,q.numberOfCancelledRequests=0,q.numberOfCancelledActiveRequests=0,q.numberOfFailedRequests=0,q.numberOfActiveRequestsEver=0,q.lastNumberOfActiveRequests=0},Q.numberOfActiveRequestsByServer=function(e){return X[e]},Q.requestHeap=W,Ze(Object.create)&&((de.prototype=Object.create(Error.prototype)).constructor=de),de.prototype.toString=function(){var e=this.name+": "+this.message;return Ze(this.stack)&&(e+="\n"+this.stack.toString()),e};var re,ie={},oe={};ie.add=function(e,t){var n=e.toLowerCase()+":"+t;Ze(oe[n])||(oe[n]=!0)},ie.remove=function(e,t){var n=e.toLowerCase()+":"+t;Ze(oe[n])&&delete oe[n]},ie.contains=function(e){var t=function(e){var t=new o(e);t.normalize();var n=t.getAuthority();if(Ze(n)){if(-1!==n.indexOf("@")&&(n=n.split("@")[1]),-1===n.indexOf(":")){var r=t.getScheme();if(Ze(r)||(r=(r=window.location.protocol).substring(0,r.length-1)),"http"===r)n+=":80";else{if("https"!==r)return;n+=":443"}}return n}}(e);return!(!Ze(t)||!Ze(oe[t]))},ie.clear=function(){oe={}};var ae,se,ue,le,ce,he,me,_e,ge,ye,ve,xe,be,Ee,Te,Se,Ce,we={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},Ae={};function Ie(e){for(var t=e.split("."),n=0,r=t.length;n<r;++n)t[n]=parseInt(t[n],10);return t}function Pe(){var e;return Ze(se)||(se=!1,Re()||null!==(e=/ Chrome\/([\.0-9]+)/.exec(ae.userAgent))&&(se=!0,ue=Ie(e[1]))),se}function Oe(){var e;return Ze(le)||(le=!1,Pe()||Re()||!/ Safari\/[\.0-9]+/.test(ae.userAgent)||null!==(e=/ Version\/([\.0-9]+)/.exec(ae.userAgent))&&(le=!0,ce=Ie(e[1]))),le}function Le(){var e;return Ze(he)||(he=!1,null!==(e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(ae.userAgent))&&(he=!0,(me=Ie(e[1])).isNightly=!!e[2])),he}function Ne(){var e;return Ze(_e)||(_e=!1,"Microsoft Internet Explorer"===ae.appName?null!==(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(ae.userAgent))&&(_e=!0,ge=Ie(e[1])):"Netscape"===ae.appName&&null!==(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(ae.userAgent))&&(_e=!0,ge=Ie(e[1]))),_e}function Re(){var e;return Ze(ye)||(ye=!1,null!==(e=/ Edge\/([\.0-9]+)/.exec(ae.userAgent))&&(ye=!0,ve=Ie(e[1]))),ye}function De(){var e;return Ze(xe)||(xe=!1,null!==(e=/Firefox\/([\.0-9]+)/.exec(ae.userAgent))&&(xe=!0,be=Ie(e[1]))),xe}function Me(){var e,t;return Ze(Ce)||((e=document.createElement("canvas")).setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;"),t=e.style.imageRendering,(Ce=Ze(t)&&""!==t)&&(Se=t)),Ce}function Fe(){return Fe._result}Object.defineProperties(Ae,{element:{get:function(){if(Ae.supportsFullscreen())return document[we.fullscreenElement]}},changeEventName:{get:function(){if(Ae.supportsFullscreen())return we.fullscreenchange}},errorEventName:{get:function(){if(Ae.supportsFullscreen())return we.fullscreenerror}},enabled:{get:function(){if(Ae.supportsFullscreen())return document[we.fullscreenEnabled]}},fullscreen:{get:function(){if(Ae.supportsFullscreen())return null!==Ae.element}}}),Ae.supportsFullscreen=function(){if(Ze(re))return re;re=!1;var e=document.body;if("function"==typeof e.requestFullscreen)return we.requestFullscreen="requestFullscreen",we.exitFullscreen="exitFullscreen",we.fullscreenEnabled="fullscreenEnabled",we.fullscreenElement="fullscreenElement",we.fullscreenchange="fullscreenchange",we.fullscreenerror="fullscreenerror",re=!0;for(var t=["webkit","moz","o","ms","khtml"],n=0,r=t.length;n<r;++n){var i,o=t[n];"function"!=typeof e[i=o+"RequestFullscreen"]&&"function"!=typeof e[i=o+"RequestFullScreen"]||(we.requestFullscreen=i,re=!0),i=o+"ExitFullscreen","function"==typeof document[i]?we.exitFullscreen=i:(i=o+"CancelFullScreen","function"==typeof document[i]&&(we.exitFullscreen=i)),i=o+"FullscreenEnabled",void 0!==document[i]?we.fullscreenEnabled=i:(i=o+"FullScreenEnabled",void 0!==document[i]&&(we.fullscreenEnabled=i)),i=o+"FullscreenElement",void 0!==document[i]?we.fullscreenElement=i:(i=o+"FullScreenElement",void 0!==document[i]&&(we.fullscreenElement=i)),i=o+"fullscreenchange",void 0!==document["on"+i]&&("ms"===o&&(i="MSFullscreenChange"),we.fullscreenchange=i),i=o+"fullscreenerror",void 0!==document["on"+i]&&("ms"===o&&(i="MSFullscreenError"),we.fullscreenerror=i)}return re},Ae.requestFullscreen=function(e,t){Ae.supportsFullscreen()&&e[we.requestFullscreen]({vrDisplay:t})},Ae.exitFullscreen=function(){Ae.supportsFullscreen()&&document[we.exitFullscreen]()},Ae._names=we,ae="undefined"!=typeof navigator?navigator:{},Fe._promise=void 0,Fe._result=void 0,Fe.initialize=function(){if(Ze(Fe._promise))return Fe._promise;var e=D.defer();if(Fe._promise=e.promise,Re())return Fe._result=!1,e.resolve(Fe._result),e.promise;var t=new Image;return t.onload=function(){Fe._result=0<t.width&&0<t.height,e.resolve(Fe._result)},t.onerror=function(){Fe._result=!1,e.resolve(Fe._result)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.promise},Object.defineProperties(Fe,{initialized:{get:function(){return Ze(Fe._result)}}});var ze=[];"undefined"!=typeof ArrayBuffer&&(ze.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&ze.push(Uint8ClampedArray),"undefined"!=typeof CanvasPixelArray&&ze.push(CanvasPixelArray));var Be,Ue,et={isChrome:Pe,chromeVersion:function(){return Pe()&&ue},isSafari:Oe,safariVersion:function(){return Oe()&&ce},isWebkit:Le,webkitVersion:function(){return Le()&&me},isInternetExplorer:Ne,internetExplorerVersion:function(){return Ne()&&ge},isEdge:Re,edgeVersion:function(){return Re()&&ve},isFirefox:De,firefoxVersion:function(){return De()&&be},isWindows:function(){return Ze(Ee)||(Ee=/Windows/i.test(ae.appVersion)),Ee},hardwareConcurrency:Je(ae.hardwareConcurrency,3),supportsPointerEvents:function(){return Ze(Te)||(Te=!De()&&"undefined"!=typeof PointerEvent&&(!Ze(ae.pointerEnabled)||ae.pointerEnabled)),Te},supportsImageRenderingPixelated:Me,supportsWebP:Fe,imageRenderingValue:function(){return Me()?Se:void 0},typedArrayTypes:ze,supportsFullscreen:function(){return Ae.supportsFullscreen()},supportsTypedArrays:function(){return"undefined"!=typeof ArrayBuffer},supportsWebWorkers:function(){return"undefined"!=typeof Worker},supportsWebAssembly:function(){return"undefined"!=typeof WebAssembly&&!et.isEdge()}},Ve=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),(e.responseType="blob")===e.responseType}catch(e){return!1}}();function ke(e,t,n,r){var i,o=e.query,a=e.path,s={};if("string"!=typeof(i=a)||-1===i.indexOf("earthview")&&-1===i.indexOf("EV_WebService")||("string"==typeof rt.extraRequestParam&&(s=M(rt.extraRequestParam)),s=We(rt._evServerQueryParam,s,!1)),!Ze(o)||0===o.length)return t._queryParameters=We(t._queryParameters,s,!1);-1===o.indexOf("=")?s[o]=void 0:s=We(M(o),s,!1),t._queryParameters=n?We(s,t._queryParameters,r):s,e.query=void 0}function Ge(e,t){var n=t._queryParameters,r=Object.keys(n);1!==r.length||Ze(n[r[0]])?Array.isArray(n.layer)?e.query=function(e){var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=encodeURIComponent(n)+"=";if(Array.isArray(r)){t+=i+encodeURIComponent(r[0]);for(var o=1,a=r.length;o<a;++o)t+=","+encodeURIComponent(r[o]);t+="&"}else t+=i+encodeURIComponent(r)+"&"}return t=t.slice(0,-1)}(n):e.query=R(n):e.query=r[0]}function qe(e,t){return Ze(e)?Ze(e.clone)?e.clone():$e(e):t}function He(e){if(e.state===F.ISSUED||e.state===F.ACTIVE)throw new de("The Resource is already being fetched.");e.state=F.UNISSUED,e.deferred=void 0}function We(e,t,n){if(!n)return ne(e,t);var r,i,o=$e(e,!0);for(var a in t){t.hasOwnProperty(a)&&(r=o[a],i=t[a],Ze(r)?(Array.isArray(r)||(r=o[a]=[r]),o[a]=r.concat(i)):o[a]=Array.isArray(i)?i.slice():i)}return o}function Ye(e){return Ze(Be)||(Be="object"==typeof define&&Ze(define.amd)&&!define.amd.toUrlUndefined&&Ze(require.toUrl)?je:nt),Be(e)}function Xe(e){return"undefined"==typeof document?e:(Ze(Ue)||(Ue=document.createElement("a")),Ue.href=e,Ue.href=Ue.href,Ue.href)}function je(e){return Xe(require.toUrl("../"+e))}var Ke,Qe=/((?:.*\/)|^)cesium[\w-]*\.js(?:\W|$)/i;function tt(){var e="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&Ze(define.amd)&&!define.amd.toUrlUndefined&&Ze(require.toUrl)?w("..",Ye("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,n=e.length;t<n;++t){var r=e[t].getAttribute("src"),i=Qe.exec(r);if(null!==i)return i[1]}}();return T(Xe(e))}function nt(e){return tt()+e}function rt(e){"string"==typeof(e=Je(e,Je.EMPTY_OBJECT))&&(e={url:e}),this._url=void 0,this._templateValues=qe(e.templateValues,{}),this._queryParameters=qe(e.queryParameters,{}),this.headers=qe(e.headers,{}),this.request=Je(e.request,new z),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=Je(e.retryAttempts,0),this._retryCount=0;var t=new o(e.url);if(ke(t,this,!0,!0),t.fragment=void 0,this._url=t.toString(),Ze(self.window)&&0==rt._ajaxWorkers.length&&rt._sendAjaxFromWebWorker)for(var n=0;n<rt._ajaxMaxRequestConcurrency;n++){var l=n;rt._ajaxWorkers.push(new Worker(Ye("Workers/sendAjaxRequest.js"))),rt._ajaxWorkers[l].onmessage=function(e){var t;0<rt._ajaxExtraRequestArray.length&&(t=rt._ajaxExtraRequestArray.shift(),rt._ajaxWorkers[l].postMessage(t));var n,r,i,o=e.data,a=o.status,s=o.requestParam,u=rt._ajaxMap.get(s.url+s.ajaxRequestCount);0==a?(n=o.xhrStatus,r=o.xhrResponse,i=o.browserResponseType,!(n<200||300<=n)||s.localFile&&0===n||(console.log("url : "+s.url+" failed! status : "+n),u.reject(new B(n,o.xhrResponse,o.xhrResponseHeaders))),"HEAD"!==s.method&&"OPTIONS"!==s.method||u.resolve(o.xhrResponseHeaders),204===n?u.resolve():!Ze(r)||Ze(s.responseType)&&i!==s.responseType?"json"===s.responseType&&Ze(o.jsonStatus)?0==o.jsonStatus?u.resolve(r):u.reject(r):""!==i&&"document"!==i||!Ze(o.responseXML)?""!==i&&"text"!==i||!Ze(o.responseText)?u.reject(new de("Invalid XMLHttpRequest response type.")):u.resolve(o.responseText):u.resolve(o.responseXML):u.resolve(r)):u.reject(new B),u=o.xhrResponse=void 0,rt._ajaxMap.delete(s.url+s.ajaxRequestCount)}}}function it(e){var n=e.resource,r=e.flipY,i=e.preferImageBitmap,o=n.request;o.url=n.url,o.requestFunction=function(){var e=!1;n.isDataUri||n.isBlobUri||(e=n.isCrossOriginUrl);var t=D.defer();return rt._Implementations.createImage(o,e,t,r,i),t.promise};var t=Q.request(o);if(Ze(t))return t.otherwise(function(t){return o.state!==F.FAILED?D.reject(t):n.retryOnError(t).then(function(e){return e?(o.state=F.UNISSUED,o.deferred=void 0,it({resource:n,flipY:r,preferImageBitmap:i})):D.reject(t)})})}rt.createIfNeeded=function(e){return e instanceof rt?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new rt({url:e})},rt.supportsImageBitmapOptions=function(){if(Ze(Ke))return Ke;if("function"!=typeof createImageBitmap)return Ke=D.resolve(!1);return Ke=rt.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then(function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none"})}).then(function(e){return!0}).otherwise(function(){return!1})},Object.defineProperties(rt,{isBlobSupported:{get:function(){return Ve}}}),Object.defineProperties(rt.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){var t=new o(e);ke(t,this,!1),t.fragment=void 0,this._url=t.toString()}},extension:{get:function(){return function(e){var t=new o(e);t.normalize();var n=t.path,r=n.lastIndexOf("/");return-1!==r&&(n=n.substr(r+1)),n=-1===(r=n.lastIndexOf("."))?"":n.substr(r+1)}(this._url)}},isDataUri:{get:function(){return N(this._url)}},isBlobUri:{get:function(){return P(this._url)}},isCrossOriginUrl:{get:function(){return O(this._url)}},hasHeaders:{get:function(){return 0<Object.keys(this.headers).length}}}),rt.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;var n=new o(this._url);e&&Ge(n,this);var r=n.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),i=this._templateValues,r=r.replace(/{(.*?)}/g,function(e,t){var n=i[t];return Ze(n)?encodeURIComponent(n):e});return t&&Ze(this.proxy)&&(r=this.proxy.getURL(r)),r},rt.prototype.setQueryParameters=function(e,t){this._queryParameters=t?We(this._queryParameters,e,!1):We(e,this._queryParameters,!1)},rt.prototype.appendQueryParameters=function(e){this._queryParameters=We(e,this._queryParameters,!0)},rt.prototype.setTemplateValues=function(e,t){this._templateValues=t?ne(this._templateValues,e):ne(e,this._templateValues)},rt.prototype.getDerivedResource=function(e){var t,n=this.clone();return n._retryCount=0,Ze(e.url)&&(ke(t=new o(e.url),n,!0,Je(e.preserveQueryParameters,!1)),t.fragment=void 0,n._url=t.resolve(new o(w(this._url))).toString()),Ze(e.queryParameters)&&(n._queryParameters=ne(e.queryParameters,n._queryParameters)),Ze(e.templateValues)&&(n._templateValues=ne(e.templateValues,n.templateValues)),Ze(e.headers)&&(n.headers=ne(e.headers,n.headers)),Ze(e.proxy)&&(n.proxy=e.proxy),Ze(e.request)&&(n.request=e.request),Ze(e.retryCallback)&&(n.retryCallback=e.retryCallback),Ze(e.retryAttempts)&&(n.retryAttempts=e.retryAttempts),n},rt.prototype.retryOnError=function(e){var t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return D(!1);var n=this;return D(t(this,e)).then(function(e){return++n._retryCount,e})},rt.prototype.clone=function(e){return Ze(e)||(e=new rt({url:this._url})),e._url=this._url,e._queryParameters=$e(this._queryParameters),e._templateValues=$e(this._templateValues),e.headers=$e(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e},rt.prototype.getBaseUri=function(e){return t=this.getUrlComponent(e),n=e,r="",-1!==(i=t.lastIndexOf("/"))&&(r=t.substring(0,i+1)),n&&(Ze((t=new o(t)).query)&&(r+="?"+t.query),Ze(t.fragment)&&(r+="#"+t.fragment)),r;var t,n,r,i},rt.prototype.appendForwardSlash=function(){this._url=T(this._url)},rt.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},rt.fetchArrayBuffer=function(e){return new rt(e).fetchArrayBuffer()},rt.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},rt.fetchBlob=function(e){return new rt(e).fetchBlob()},rt.prototype.fetchImage=function(e){e=Je(e,Je.EMPTY_OBJECT);var t=Je(e.preferImageBitmap,!1),n=Je(e.preferBlob,!1),r=Je(e.flipY,!1);if(He(this.request),!Ve||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!n)return it({resource:this,flipY:r,preferImageBitmap:t});var i,o,a,s=this.fetchBlob();return Ze(s)?rt.supportsImageBitmapOptions().then(function(e){return i=e&&t,s}).then(function(e){if(Ze(e)){if(a=e,i)return rt.createImageBitmapFromBlob(e,{flipY:r,premultiplyAlpha:!1});var t=window.URL.createObjectURL(e);return it({resource:o=new rt({url:t}),flipY:r,preferImageBitmap:!1})}}).then(function(e){if(Ze(e))return e.blob=a,i||window.URL.revokeObjectURL(o.url),e}).otherwise(function(e){return Ze(o)&&window.URL.revokeObjectURL(o.url),e.blob=a,D.reject(e)}):void 0},rt.fetchImage=function(e){return new rt(e).fetchImage({flipY:e.flipY,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},rt.prototype.fetchText=function(){return this.fetch({responseType:"text"})},rt.fetchText=function(e){return new rt(e).fetchText()},rt.prototype.fetchJson=function(){var e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(Ze(e))return e.then(function(e){if(Ze(e))return JSON.parse(e)})},rt.fetchJson=function(e){return new rt(e).fetchJson()},rt.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},rt.fetchXML=function(e){return new rt(e).fetchXML()},rt.prototype.fetchJsonp=function(e){var t;for(e=Je(e,"callback"),He(this.request);t="loadJsonp"+Math.random().toString().substring(2,8),Ze(window[t]););return function n(r,i,o){var e={};e[i]=o;r.setQueryParameters(e);var a=r.request;a.url=r.url;a.requestFunction=function(){var t=D.defer();return window[o]=function(e){t.resolve(e);try{delete window[o]}catch(e){window[o]=void 0}},rt._Implementations.loadAndExecuteScript(r.url,o,t),t.promise};var t=Q.request(a);if(!Ze(t))return;return t.otherwise(function(t){return a.state!==F.FAILED?D.reject(t):r.retryOnError(t).then(function(e){return e?(a.state=F.UNISSUED,a.deferred=void 0,n(r,i,o)):D.reject(t)})})}(this,e,t)},rt.fetchJsonp=function(e){return new rt(e).fetchJsonp(e.callbackParameterName)},rt.prototype._makeRequest=function(s){var u=this;He(u.request);var l=u.request;l.url=u.url,l.requestFunction=function(){var e,t=s.responseType,n=ne(s.headers,u.headers),r=s.overrideMimeType,i=s.method,o=s.data,a=D.defer();return 0!=rt._ajaxWorkers.length&&"document"!=t&&-1!=u.url.indexOf("http")&&rt._sendAjaxFromWebWorker?rt._Implementations.loadWithWebWorkerXhr(u.url,t,i,o,n,a,r):Ze(e=rt._Implementations.loadWithXhr(u.url,t,i,o,n,a,r))&&Ze(e.abort)&&(l.cancelFunction=function(){e.abort()}),a.promise};var e=Q.request(l);if(Ze(e))return e.then(function(e){return e}).otherwise(function(t){return l.state!==F.FAILED?D.reject(t):u.retryOnError(t).then(function(e){return e?(l.state=F.UNISSUED,l.deferred=void 0,u.fetch(s)):D.reject(t)})})};var ot=/^data:(.*?)(;base64)?,(.*)$/;function at(e,t){var n=decodeURIComponent(t);return e?atob(n):n}function st(e,t){for(var n=at(e,t),r=new ArrayBuffer(n.length),i=new Uint8Array(r),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);return r}function ut(e,t){t=Je(t,"");var n=e[1],r=!!e[2],i=e[3];switch(t){case"":case"text":return at(r,i);case"arraybuffer":return st(r,i);case"blob":var o=st(r,i);return new Blob([o],{type:n});case"document":return(new DOMParser).parseFromString(at(r,i),n);case"json":return JSON.parse(at(r,i))}}function lt(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}function ct(e,r,t,n,i,o){var a=require("url").parse(e),s="https:"===a.protocol?require("https"):require("http"),u=require("zlib"),l={protocol:a.protocol,hostname:a.hostname,port:a.port,path:a.path,query:a.query,method:t,headers:i};s.request(l).on("response",function(t){var n;t.statusCode<200||300<=t.statusCode?o.reject(new B(t.statusCode,t,t.headers)):(n=[],t.on("data",function(e){n.push(e)}),t.on("end",function(){var e=Buffer.concat(n);"gzip"===t.headers["content-encoding"]?u.gunzip(e,function(e,t){e?o.reject(new de("Error decompressing response.")):o.resolve(lt(t,r))}):o.resolve(lt(e,r))}))}).on("error",function(e){o.reject(new B)}).end()}rt.prototype.fetch=function(e){return(e=qe(e,{})).method="GET",this._makeRequest(e)},rt.fetch=function(e){return new rt(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},rt.prototype.delete=function(e){return(e=qe(e,{})).method="DELETE",this._makeRequest(e)},rt.delete=function(e){return new rt(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},rt.prototype.head=function(e){return(e=qe(e,{})).method="HEAD",this._makeRequest(e)},rt.head=function(e){return new rt(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},rt.prototype.options=function(e){return(e=qe(e,{})).method="OPTIONS",this._makeRequest(e)},rt.options=function(e){return new rt(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},rt.prototype.post=function(e,t){return S.defined("data",e),(t=qe(t,{})).method="POST",t.data=e,this._makeRequest(t)},rt.post=function(e){return new rt(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},rt.prototype.put=function(e,t){return S.defined("data",e),(t=qe(t,{})).method="PUT",t.data=e,this._makeRequest(t)},rt.put=function(e){return new rt(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},rt.prototype.patch=function(e,t){return S.defined("data",e),(t=qe(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},rt.patch=function(e){return new rt(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},rt._Implementations={},rt._Implementations.createImage=function(s,u,l,c,h){var f=s.url;rt.supportsImageBitmapOptions().then(function(e){if(!e||!h)return t=f,n=u,r=l,(i=new Image).onload=function(){r.resolve(i)},i.onerror=function(e){r.reject(e)},n&&(ie.contains(t)?i.crossOrigin="use-credentials":i.crossOrigin=""),void(i.src=t);var t,n,r,i,o,a=D.defer();return 0!=rt._ajaxWorkers.length&&-1!=f.indexOf("http")&&rt._sendAjaxFromWebWorker?rt._Implementations.loadWithWebWorkerXhr(f,"blob","GET",void 0,void 0,a,void 0):Ze(o=rt._Implementations.loadWithXhr(f,"blob","GET",void 0,void 0,a,void 0,void 0,void 0))&&Ze(o.abort)&&(s.cancelFunction=function(){o.abort()}),a.promise.then(function(e){if(Ze(e))return rt.createImageBitmapFromBlob(e,{flipY:c,premultiplyAlpha:!1});l.reject(new de("Successfully retrieved "+f+" but it contained no content."))}).then(l.resolve)}).otherwise(l.reject)},rt.createImageBitmapFromBlob=function(e,t){return S.defined("options",t),S.typeOf.bool("options.flipY",t.flipY),S.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none"})};var ht="undefined"==typeof XMLHttpRequest;function ft(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(e)}rt._Implementations.loadWithXhr=function(e,i,o,t,n,a,r){var s=ot.exec(e);if(null===s){if(!ht){var u=new XMLHttpRequest;if(ie.contains(e)&&(u.withCredentials=!0),u.open(o,e,!0),Ze(r)&&Ze(u.overrideMimeType)&&u.overrideMimeType(r),Ze(n))for(var l in n)n.hasOwnProperty(l)&&u.setRequestHeader(l,n[l]);Ze(i)&&(u.responseType=i);var c=!1;return"string"==typeof e&&(c=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),u.onload=function(){if(!(u.status<200||300<=u.status)||c&&0===u.status){var e=u.response,t=u.responseType;if("HEAD"===o||"OPTIONS"===o){var n=u.getAllResponseHeaders().trim().split(/[\r\n]+/),r={};return n.forEach(function(e){var t=e.split(": "),n=t.shift();r[n]=t.join(": ")}),void a.resolve(r)}if(204===u.status)a.resolve();else if(!Ze(e)||Ze(i)&&t!==i)if("json"===i&&"string"==typeof e)try{a.resolve(JSON.parse(e))}catch(e){a.reject(e)}else(""===t||"document"===t)&&Ze(u.responseXML)&&u.responseXML.hasChildNodes()?a.resolve(u.responseXML):""!==t&&"text"!==t||!Ze(u.responseText)?a.reject(new de("Invalid XMLHttpRequest response type.")):a.resolve(u.responseText);else a.resolve(e)}else a.reject(new B(u.status,u.response,u.getAllResponseHeaders()))},u.onerror=function(e){a.reject(new B)},u.send(t),u}ct(e,i,o,0,n,a)}else a.resolve(ut(s,i))},rt._Implementations.loadWithWebWorkerXhr=function(e,t,n,r,i,o,a){var s,u,l,c,h=ot.exec(e);null===h?ht?ct(e,t,n,0,i,o):(s=!1,"string"==typeof e&&(s=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),u=!1,ie.contains(e)&&(u=!0),rt._ajaxRequestCount++,rt._ajaxMap.set(e+rt._ajaxRequestCount,o),l=0,1<rt._ajaxMaxRequestConcurrency&&(l=rt._ajaxRequestCount%rt._ajaxMaxRequestConcurrency),c={url:e,method:n,overrideMimeType:a,headers:i,responseType:t,localFile:s,withCredentials:u,data:r,ajaxRequestCount:rt._ajaxRequestCount},1e3<rt._ajaxMap.size?rt._ajaxExtraRequestArray.push(c):rt._ajaxWorkers[l].postMessage(c)):o.resolve(ut(h,t))},rt._Implementations.loadAndExecuteScript=function(e,t,n){return function(e){var t=D.defer(),n=document.createElement("script");n.async=!0,n.src=e;var r=document.getElementsByTagName("head")[0];return n.onload=function(){n.onload=void 0,r.removeChild(n),t.resolve()},n.onerror=function(e){t.reject(e)},r.appendChild(n),t.promise}(e).otherwise(n.reject)},rt._DefaultImplementations={},rt._DefaultImplementations.createImage=rt._Implementations.createImage,rt._DefaultImplementations.loadWithXhr=rt._Implementations.loadWithXhr,rt._DefaultImplementations.loadAndExecuteScript=rt._Implementations.loadAndExecuteScript,rt._ajaxWorkers=[],rt._ajaxMap=new Map,rt._ajaxExtraRequestArray=new Array,rt._ajaxRequestCount=0,rt._ajaxMaxRequestConcurrency=Math.max(parseInt(.5*et.hardwareConcurrency),3),rt._sendAjaxFromWebWorker=!0,rt.extraRequestParam=void 0,rt.DEFAULT=Object.freeze(new rt({url:"undefined"==typeof document?"":document.location.href.split("?")[0]})),rt._evServerQueryParam={},rt.addEVServerQueryParam=function(e){for(var t in e)e.hasOwnProperty(t)&&(rt._evServerQueryParam[t]=e[t])},rt.removeEVServerQueryParam=function(e){rt._evServerQueryParam.hasOwnProperty(e)&&delete rt._evServerQueryParam[e]},rt.removeAllEVServerQueryParam=function(){rt._evServerQueryParam={}},ft.prototype.init_genrand=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},ft.prototype.genrand_int32=function(){var e,t,n=new Array(0,this.MATRIX_A);if(this.mti>=this.N){for(this.mti==this.N+1&&this.init_genrand(5489),t=0;t<this.N-this.M;t++)e=this.mt[t]&this.UPPER_MASK|this.mt[t+1]&this.LOWER_MASK,this.mt[t]=this.mt[t+this.M]^e>>>1^n[1&e];for(;t<this.N-1;t++)e=this.mt[t]&this.UPPER_MASK|this.mt[t+1]&this.LOWER_MASK,this.mt[t]=this.mt[t+(this.M-this.N)]^e>>>1^n[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^n[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},ft.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};var pt={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296};pt.sign=Je(Math.sign,function(e){return 0===(e=+e)||e!=e?e:0<e?1:-1}),pt.signNotZero=function(e){return e<0?-1:1},pt.toSNorm=function(e,t){return t=Je(t,255),Math.round((.5*pt.clamp(e,-1,1)+.5)*t)},pt.fromSNorm=function(e,t){return t=Je(t,255),pt.clamp(e,0,t)/t*2-1},pt.normalize=function(e,t,n){return 0===(n=Math.max(n-t,0))?0:pt.clamp((e-t)/n,0,1)},pt.sinh=Je(Math.sinh,function(e){return(Math.exp(e)-Math.exp(-e))/2}),pt.cosh=Je(Math.cosh,function(e){return(Math.exp(e)+Math.exp(-e))/2}),pt.lerp=function(e,t,n){return(1-n)*e+n*t},pt.PI=Math.PI,pt.ONE_OVER_PI=1/Math.PI,pt.PI_OVER_TWO=Math.PI/2,pt.PI_OVER_THREE=Math.PI/3,pt.PI_OVER_FOUR=Math.PI/4,pt.PI_OVER_SIX=Math.PI/6,pt.THREE_PI_OVER_TWO=3*Math.PI/2,pt.TWO_PI=2*Math.PI,pt.ONE_OVER_TWO_PI=1/(2*Math.PI),pt.RADIANS_PER_DEGREE=Math.PI/180,pt.DEGREES_PER_RADIAN=180/Math.PI,pt.RADIANS_PER_ARCSECOND=pt.RADIANS_PER_DEGREE/3600,pt.toRadians=function(e){return e*pt.RADIANS_PER_DEGREE},pt.toDegrees=function(e){return e*pt.DEGREES_PER_RADIAN},pt.convertLongitudeRange=function(e){var t=pt.TWO_PI,n=e-Math.floor(e/t)*t;return n<-Math.PI?n+t:n>=Math.PI?n-t:n},pt.clampToLatitudeRange=function(e){return pt.clamp(e,-1*pt.PI_OVER_TWO,pt.PI_OVER_TWO)},pt.negativePiToPi=function(e){return pt.zeroToTwoPi(e+pt.PI)-pt.PI},pt.zeroToTwoPi=function(e){var t=pt.mod(e,pt.TWO_PI);return Math.abs(t)<pt.EPSILON14&&Math.abs(e)>pt.EPSILON14?pt.TWO_PI:t},pt.mod=function(e,t){return(e%t+t)%t},pt.equalsEpsilon=function(e,t,n,r){r=Je(r,n);var i=Math.abs(e-t);return i<=r||i<=n*Math.max(Math.abs(e),Math.abs(t))},pt.lessThan=function(e,t,n){return e-t<-n},pt.lessThanOrEquals=function(e,t,n){return e-t<n},pt.greaterThan=function(e,t,n){return n<e-t},pt.greaterThanOrEquals=function(e,t,n){return-n<e-t};var dt=[1];pt.factorial=function(e){var t=dt.length;if(t<=e)for(var n=dt[t-1],r=t;r<=e;r++){var i=n*r;dt.push(i),n=i}return dt[e]},pt.incrementWrap=function(e,t,n){return n=Je(n,0),t<++e&&(e=n),e},pt.isPowerOfTwo=function(e){return 0!==e&&0==(e&e-1)},pt.nextPowerOfTwo=function(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},pt.clamp=function(e,t,n){return e<t?t:n<e?n:e};var mt=new ft;function _t(e,t,n){this.x=Je(e,0),this.y=Je(t,0),this.z=Je(n,0)}pt.setRandomNumberSeed=function(e){mt=new ft(e)},pt.nextRandomNumber=function(){return mt.random()},pt.randomBetween=function(e,t){return pt.nextRandomNumber()*(t-e)+e},pt.acosClamped=function(e){return Math.acos(pt.clamp(e,-1,1))},pt.asinClamped=function(e){return Math.asin(pt.clamp(e,-1,1))},pt.chordLength=function(e,t){return 2*t*Math.sin(.5*e)},pt.logBase=function(e,t){return Math.log(e)/Math.log(t)},pt.cbrt=Je(Math.cbrt,function(e){var t=Math.pow(Math.abs(e),1/3);return e<0?-t:t}),pt.log2=Je(Math.log2,function(e){return Math.log(e)*Math.LOG2E}),pt.fog=function(e,t){var n=e*t;return 1-Math.exp(-n*n)},pt.fastApproximateAtan=function(e){return e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)},pt.fastApproximateAtan2=function(e,t){var n=Math.abs(e),r=Math.abs(t),i=Math.max(n,r),o=(r=Math.min(n,r))/i,n=pt.fastApproximateAtan(o);return n=Math.abs(t)>Math.abs(e)?pt.PI_OVER_TWO-n:n,n=e<0?pt.PI-n:n,n=t<0?-n:n},_t.fromSpherical=function(e,t){Ze(t)||(t=new _t);var n=e.clock,r=e.cone,i=Je(e.magnitude,1),o=i*Math.sin(r);return t.x=o*Math.cos(n),t.y=o*Math.sin(n),t.z=i*Math.cos(r),t},_t.fromElements=function(e,t,n,r){return Ze(r)?(r.x=e,r.y=t,r.z=n,r):new _t(e,t,n)},_t.fromCartesian4=_t.clone=function(e,t){if(Ze(e))return Ze(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t):new _t(e.x,e.y,e.z)},_t.packedLength=3,_t.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.x,t[n++]=e.y,t[n]=e.z,t},_t.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new _t),n.x=e[t++],n.y=e[t++],n.z=e[t],n},_t.packArray=function(e,t){var n=e.length,r=3*n;if(Ze(t)){if(!Array.isArray(t)&&t.length!==r)throw new fe("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==r&&(t.length=r)}else t=new Array(r);for(var i=0;i<n;++i)_t.pack(e[i],t,3*i);return t},_t.unpackArray=function(e,t){var n=e.length;Ze(t)?t.length=n/3:t=new Array(n/3);for(var r=0;r<n;r+=3){var i=r/3;t[i]=_t.unpack(e,r,t[i])}return t},_t.fromArray=_t.unpack,_t.maximumComponent=function(e){return Math.max(e.x,e.y,e.z)},_t.minimumComponent=function(e){return Math.min(e.x,e.y,e.z)},_t.minimumByComponent=function(e,t,n){return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n},_t.maximumByComponent=function(e,t,n){return n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n},_t.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},_t.magnitude=function(e){return Math.sqrt(_t.magnitudeSquared(e))};var gt=new _t;_t.distance=function(e,t){return _t.subtract(e,t,gt),_t.magnitude(gt)},_t.distanceSquared=function(e,t){return _t.subtract(e,t,gt),_t.magnitudeSquared(gt)},_t.normalize=function(e,t){var n=_t.magnitude(e);return Ze(t)||(t=new _t),t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},_t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},_t.multiplyComponents=function(e,t,n){return n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n},_t.divideComponents=function(e,t,n){return n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n},_t.add=function(e,t,n){return Ze(n)||(n=new _t),n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n},_t.subtract=function(e,t,n){return Ze(n)||(n=new _t),n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n},_t.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n},_t.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n},_t.negate=function(e,t){return Ze(t)||(t=new _t),t.x=-e.x,t.y=-e.y,t.z=-e.z,t},_t.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t};var yt=new _t;_t.lerp=function(e,t,n,r){return _t.multiplyByScalar(t,n,yt),r=_t.multiplyByScalar(e,1-n,r),_t.add(yt,r,r)};var vt=new _t,xt=new _t;_t.angleBetween=function(e,t){_t.normalize(e,vt),_t.normalize(t,xt);var n=_t.dot(vt,xt),r=_t.magnitude(_t.cross(vt,xt,vt));return Math.atan2(r,n)};var bt=new _t;_t.mostOrthogonalAxis=function(e,t){var n=_t.normalize(e,bt);return _t.abs(n,n),t=n.x<=n.y?n.x<=n.z?_t.clone(_t.UNIT_X,t):_t.clone(_t.UNIT_Z,t):n.y<=n.z?_t.clone(_t.UNIT_Y,t):_t.clone(_t.UNIT_Z,t)},_t.projectVector=function(e,t,n){var r=_t.dot(e,t)/_t.dot(t,t);return _t.multiplyByScalar(t,r,n)},_t.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z},_t.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]},_t.equalsEpsilon=function(e,t,n,r){return e===t||Ze(e)&&Ze(t)&&pt.equalsEpsilon(e.x,t.x,n,r)&&pt.equalsEpsilon(e.y,t.y,n,r)&&pt.equalsEpsilon(e.z,t.z,n,r)},_t.cross=function(e,t,n){var r=e.x,i=e.y,o=e.z,a=t.x,s=t.y,u=t.z,l=i*u-o*s,c=o*a-r*u,h=r*s-i*a;return n.x=l,n.y=c,n.z=h,n},_t.midpoint=function(e,t,n){return n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n},_t.fromDegrees=function(e,t,n,r,i){return e=pt.toRadians(e),t=pt.toRadians(t),_t.fromRadians(e,t,n,r,i)};var Et,Tt,St,Ct=new _t,wt=new _t;function At(e,t,n){return n<0&&(n+=1),1<n&&--n,6*n<1?e+6*(t-e)*n:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function It(e,t,n,r){this.red=Je(e,1),this.green=Je(t,1),this.blue=Je(n,1),this.alpha=Je(r,1)}_t.wgs84RadiiSquared=new _t(40680631590769,40680631590769,40408299984661.445),_t.fromRadians=function(e,t,n,r,i){n=Je(n,0);var o=Ze(r)?r.radiiSquared:this.wgs84RadiiSquared,a=Math.cos(t);Ct.x=a*Math.cos(e),Ct.y=a*Math.sin(e),Ct.z=Math.sin(t),Ct=_t.normalize(Ct,Ct),_t.multiplyComponents(o,Ct,wt);var s=Math.sqrt(_t.dot(Ct,wt));return wt=_t.divideByScalar(wt,s,wt),Ct=_t.multiplyByScalar(Ct,n,Ct),Ze(i)||(i=new _t),_t.add(wt,Ct,i)},_t.fromDegreesArray=function(e,t,n){var r=e.length;Ze(n)?n.length=r/2:n=new Array(r/2);for(var i=0;i<r;i+=2){var o=e[i],a=e[i+1],s=i/2;n[s]=_t.fromDegrees(o,a,0,t,n[s])}return n},_t.fromRadiansArray=function(e,t,n){var r=e.length;Ze(n)?n.length=r/2:n=new Array(r/2);for(var i=0;i<r;i+=2){var o=e[i],a=e[i+1],s=i/2;n[s]=_t.fromRadians(o,a,0,t,n[s])}return n},_t.fromDegreesArrayHeights=function(e,t,n){var r=e.length;Ze(n)?n.length=r/3:n=new Array(r/3);for(var i=0;i<r;i+=3){var o=e[i],a=e[i+1],s=e[i+2],u=i/3;n[u]=_t.fromDegrees(o,a,s,t,n[u])}return n},_t.fromRadiansArrayHeights=function(e,t,n){var r=e.length;Ze(n)?n.length=r/3:n=new Array(r/3);for(var i=0;i<r;i+=3){var o=e[i],a=e[i+1],s=e[i+2],u=i/3;n[u]=_t.fromRadians(o,a,s,t,n[u])}return n},_t.ZERO=Object.freeze(new _t(0,0,0)),_t.UNIT_X=Object.freeze(new _t(1,0,0)),_t.UNIT_Y=Object.freeze(new _t(0,1,0)),_t.UNIT_Z=Object.freeze(new _t(0,0,1)),_t.prototype.clone=function(e){return _t.clone(this,e)},_t.prototype.equals=function(e){return _t.equals(this,e)},_t.prototype.equalsEpsilon=function(e,t,n){return _t.equalsEpsilon(this,e,t,n)},_t.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},It.fromCartesian4=function(e,t){return Ze(t)?(t.red=e.x,t.green=e.y,t.blue=e.z,t.alpha=e.w,t):new It(e.x,e.y,e.z,e.w)},It.fromBytes=function(e,t,n,r,i){return e=It.byteToFloat(Je(e,255)),t=It.byteToFloat(Je(t,255)),n=It.byteToFloat(Je(n,255)),r=It.byteToFloat(Je(r,255)),Ze(i)?(i.red=e,i.green=t,i.blue=n,i.alpha=r,i):new It(e,t,n,r)},It.fromAlpha=function(e,t,n){return Ze(n)?(n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=t,n):new It(e.red,e.green,e.blue,t)},et.supportsTypedArrays()&&(Et=new ArrayBuffer(4),Tt=new Uint32Array(Et),St=new Uint8Array(Et)),It.fromRgba=function(e,t){return Tt[0]=e,It.fromBytes(St[0],St[1],St[2],St[3],t)},It.fromHsl=function(e,t,n,r,i){e=Je(e,0)%1,t=Je(t,0),n=Je(n,0),r=Je(r,1);var o,a,s=n,u=n,l=n;return 0!==t&&(s=At(a=2*n-(o=n<.5?n*(1+t):n+t-n*t),o,e+1/3),u=At(a,o,e),l=At(a,o,e-1/3)),Ze(i)?(i.red=s,i.green=u,i.blue=l,i.alpha=r,i):new It(s,u,l,r)},It.fromRandom=function(e,t){var n,r,i=(e=Je(e,Je.EMPTY_OBJECT)).red;Ze(i)||(n=Je(e.minimumRed,0),r=Je(e.maximumRed,1),i=n+pt.nextRandomNumber()*(r-n));var o,a,s=e.green;Ze(s)||(o=Je(e.minimumGreen,0),a=Je(e.maximumGreen,1),s=o+pt.nextRandomNumber()*(a-o));var u,l,c=e.blue;Ze(c)||(u=Je(e.minimumBlue,0),l=Je(e.maximumBlue,1),c=u+pt.nextRandomNumber()*(l-u));var h,f,p=e.alpha;return Ze(p)||(h=Je(e.minimumAlpha,0),f=Je(e.maximumAlpha,1),p=h+pt.nextRandomNumber()*(f-h)),Ze(t)?(t.red=i,t.green=s,t.blue=c,t.alpha=p,t):new It(i,s,c,p)};var Pt=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,Ot=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,Lt=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,Nt=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;It.fromCssColorString=function(e,t){Ze(t)||(t=new It);var n=It[e.toUpperCase()];if(Ze(n))return It.clone(n,t),t;var r=Pt.exec(e);return null!==r?(t.red=parseInt(r[1],16)/15,t.green=parseInt(r[2],16)/15,t.blue=parseInt(r[3],16)/15,t.alpha=1,t):null!==(r=Ot.exec(e))?(t.red=parseInt(r[1],16)/255,t.green=parseInt(r[2],16)/255,t.blue=parseInt(r[3],16)/255,t.alpha=1,t):null!==(r=Lt.exec(e))?(t.red=parseFloat(r[1])/("%"===r[1].substr(-1)?100:255),t.green=parseFloat(r[2])/("%"===r[2].substr(-1)?100:255),t.blue=parseFloat(r[3])/("%"===r[3].substr(-1)?100:255),t.alpha=parseFloat(Je(r[4],"1.0")),t):null!==(r=Nt.exec(e))?It.fromHsl(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,parseFloat(Je(r[4],"1.0")),t):t=void 0},It.packedLength=4,It.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.red,t[n++]=e.green,t[n++]=e.blue,t[n]=e.alpha,t},It.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new It),n.red=e[t++],n.green=e[t++],n.blue=e[t++],n.alpha=e[t],n},It.byteToFloat=function(e){return e/255},It.floatToByte=function(e){return 1===e?255:256*e|0},It.clone=function(e,t){if(Ze(e))return Ze(t)?(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t):new It(e.red,e.green,e.blue,e.alpha)},It.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha},It.equalsArray=function(e,t,n){return e.red===t[n]&&e.green===t[n+1]&&e.blue===t[n+2]&&e.alpha===t[n+3]},It.prototype.clone=function(e){return It.clone(this,e)},It.prototype.equals=function(e){return It.equals(this,e)},It.prototype.equalsEpsilon=function(e,t){return this===e||Ze(e)&&Math.abs(this.red-e.red)<=t&&Math.abs(this.green-e.green)<=t&&Math.abs(this.blue-e.blue)<=t&&Math.abs(this.alpha-e.alpha)<=t},It.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},It.prototype.toCssColorString=function(){var e=It.floatToByte(this.red),t=It.floatToByte(this.green),n=It.floatToByte(this.blue);return 1===this.alpha?"rgb("+e+","+t+","+n+")":"rgba("+e+","+t+","+n+","+this.alpha+")"},It.prototype.toBytes=function(e){var t=It.floatToByte(this.red),n=It.floatToByte(this.green),r=It.floatToByte(this.blue),i=It.floatToByte(this.alpha);return Ze(e)?(e[0]=t,e[1]=n,e[2]=r,e[3]=i,e):[t,n,r,i]},It.prototype.toRgba=function(){return St[0]=It.floatToByte(this.red),St[1]=It.floatToByte(this.green),St[2]=It.floatToByte(this.blue),St[3]=It.floatToByte(this.alpha),Tt[0]},It.prototype.brighten=function(e,t){return e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t},It.prototype.darken=function(e,t){return e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t},It.prototype.withAlpha=function(e,t){return It.fromAlpha(this,e,t)},It.add=function(e,t,n){return n.red=e.red+t.red,n.green=e.green+t.green,n.blue=e.blue+t.blue,n.alpha=e.alpha+t.alpha,n},It.subtract=function(e,t,n){return n.red=e.red-t.red,n.green=e.green-t.green,n.blue=e.blue-t.blue,n.alpha=e.alpha-t.alpha,n},It.multiply=function(e,t,n){return n.red=e.red*t.red,n.green=e.green*t.green,n.blue=e.blue*t.blue,n.alpha=e.alpha*t.alpha,n},It.divide=function(e,t,n){return n.red=e.red/t.red,n.green=e.green/t.green,n.blue=e.blue/t.blue,n.alpha=e.alpha/t.alpha,n},It.mod=function(e,t,n){return n.red=e.red%t.red,n.green=e.green%t.green,n.blue=e.blue%t.blue,n.alpha=e.alpha%t.alpha,n},It.lerp=function(e,t,n,r){return r.red=pt.lerp(e.red,t.red,n),r.green=pt.lerp(e.green,t.green,n),r.blue=pt.lerp(e.blue,t.blue,n),r.alpha=pt.lerp(e.alpha,t.alpha,n),r},It.multiplyByScalar=function(e,t,n){return n.red=e.red*t,n.green=e.green*t,n.blue=e.blue*t,n.alpha=e.alpha*t,n},It.divideByScalar=function(e,t,n){return n.red=e.red/t,n.green=e.green/t,n.blue=e.blue/t,n.alpha=e.alpha/t,n},It.ALICEBLUE=Object.freeze(It.fromCssColorString("#F0F8FF")),It.ANTIQUEWHITE=Object.freeze(It.fromCssColorString("#FAEBD7")),It.AQUA=Object.freeze(It.fromCssColorString("#00FFFF")),It.AQUAMARINE=Object.freeze(It.fromCssColorString("#7FFFD4")),It.AZURE=Object.freeze(It.fromCssColorString("#F0FFFF")),It.BEIGE=Object.freeze(It.fromCssColorString("#F5F5DC")),It.BISQUE=Object.freeze(It.fromCssColorString("#FFE4C4")),It.BLACK=Object.freeze(It.fromCssColorString("#000000")),It.BLANCHEDALMOND=Object.freeze(It.fromCssColorString("#FFEBCD")),It.BLUE=Object.freeze(It.fromCssColorString("#0000FF")),It.BLUEVIOLET=Object.freeze(It.fromCssColorString("#8A2BE2")),It.BROWN=Object.freeze(It.fromCssColorString("#A52A2A")),It.BURLYWOOD=Object.freeze(It.fromCssColorString("#DEB887")),It.CADETBLUE=Object.freeze(It.fromCssColorString("#5F9EA0")),It.CHARTREUSE=Object.freeze(It.fromCssColorString("#7FFF00")),It.CHOCOLATE=Object.freeze(It.fromCssColorString("#D2691E")),It.CORAL=Object.freeze(It.fromCssColorString("#FF7F50")),It.CORNFLOWERBLUE=Object.freeze(It.fromCssColorString("#6495ED")),It.CORNSILK=Object.freeze(It.fromCssColorString("#FFF8DC")),It.CRIMSON=Object.freeze(It.fromCssColorString("#DC143C")),It.CYAN=Object.freeze(It.fromCssColorString("#00FFFF")),It.DARKBLUE=Object.freeze(It.fromCssColorString("#00008B")),It.DARKCYAN=Object.freeze(It.fromCssColorString("#008B8B")),It.DARKGOLDENROD=Object.freeze(It.fromCssColorString("#B8860B")),It.DARKGRAY=Object.freeze(It.fromCssColorString("#A9A9A9")),It.DARKGREEN=Object.freeze(It.fromCssColorString("#006400")),It.DARKGREY=It.DARKGRAY,It.DARKKHAKI=Object.freeze(It.fromCssColorString("#BDB76B")),It.DARKMAGENTA=Object.freeze(It.fromCssColorString("#8B008B")),It.DARKOLIVEGREEN=Object.freeze(It.fromCssColorString("#556B2F")),It.DARKORANGE=Object.freeze(It.fromCssColorString("#FF8C00")),It.DARKORCHID=Object.freeze(It.fromCssColorString("#9932CC")),It.DARKRED=Object.freeze(It.fromCssColorString("#8B0000")),It.DARKSALMON=Object.freeze(It.fromCssColorString("#E9967A")),It.DARKSEAGREEN=Object.freeze(It.fromCssColorString("#8FBC8F")),It.DARKSLATEBLUE=Object.freeze(It.fromCssColorString("#483D8B")),It.DARKSLATEGRAY=Object.freeze(It.fromCssColorString("#2F4F4F")),It.DARKSLATEGREY=It.DARKSLATEGRAY,It.DARKTURQUOISE=Object.freeze(It.fromCssColorString("#00CED1")),It.DARKVIOLET=Object.freeze(It.fromCssColorString("#9400D3")),It.DEEPPINK=Object.freeze(It.fromCssColorString("#FF1493")),It.DEEPSKYBLUE=Object.freeze(It.fromCssColorString("#00BFFF")),It.DIMGRAY=Object.freeze(It.fromCssColorString("#696969")),It.DIMGREY=It.DIMGRAY,It.DODGERBLUE=Object.freeze(It.fromCssColorString("#1E90FF")),It.FIREBRICK=Object.freeze(It.fromCssColorString("#B22222")),It.FLORALWHITE=Object.freeze(It.fromCssColorString("#FFFAF0")),It.FORESTGREEN=Object.freeze(It.fromCssColorString("#228B22")),It.FUCHSIA=Object.freeze(It.fromCssColorString("#FF00FF")),It.GAINSBORO=Object.freeze(It.fromCssColorString("#DCDCDC")),It.GHOSTWHITE=Object.freeze(It.fromCssColorString("#F8F8FF")),It.GOLD=Object.freeze(It.fromCssColorString("#FFD700")),It.GOLDENROD=Object.freeze(It.fromCssColorString("#DAA520")),It.GRAY=Object.freeze(It.fromCssColorString("#808080")),It.GREEN=Object.freeze(It.fromCssColorString("#008000")),It.GREENYELLOW=Object.freeze(It.fromCssColorString("#ADFF2F")),It.GREY=It.GRAY,It.HONEYDEW=Object.freeze(It.fromCssColorString("#F0FFF0")),It.HOTPINK=Object.freeze(It.fromCssColorString("#FF69B4")),It.INDIANRED=Object.freeze(It.fromCssColorString("#CD5C5C")),It.INDIGO=Object.freeze(It.fromCssColorString("#4B0082")),It.IVORY=Object.freeze(It.fromCssColorString("#FFFFF0")),It.KHAKI=Object.freeze(It.fromCssColorString("#F0E68C")),It.LAVENDER=Object.freeze(It.fromCssColorString("#E6E6FA")),It.LAVENDAR_BLUSH=Object.freeze(It.fromCssColorString("#FFF0F5")),It.LAWNGREEN=Object.freeze(It.fromCssColorString("#7CFC00")),It.LEMONCHIFFON=Object.freeze(It.fromCssColorString("#FFFACD")),It.LIGHTBLUE=Object.freeze(It.fromCssColorString("#ADD8E6")),It.LIGHTCORAL=Object.freeze(It.fromCssColorString("#F08080")),It.LIGHTCYAN=Object.freeze(It.fromCssColorString("#E0FFFF")),It.LIGHTGOLDENRODYELLOW=Object.freeze(It.fromCssColorString("#FAFAD2")),It.LIGHTGRAY=Object.freeze(It.fromCssColorString("#D3D3D3")),It.LIGHTGREEN=Object.freeze(It.fromCssColorString("#90EE90")),It.LIGHTGREY=It.LIGHTGRAY,It.LIGHTPINK=Object.freeze(It.fromCssColorString("#FFB6C1")),It.LIGHTSEAGREEN=Object.freeze(It.fromCssColorString("#20B2AA")),It.LIGHTSKYBLUE=Object.freeze(It.fromCssColorString("#87CEFA")),It.LIGHTSLATEGRAY=Object.freeze(It.fromCssColorString("#778899")),It.LIGHTSLATEGREY=It.LIGHTSLATEGRAY,It.LIGHTSTEELBLUE=Object.freeze(It.fromCssColorString("#B0C4DE")),It.LIGHTYELLOW=Object.freeze(It.fromCssColorString("#FFFFE0")),It.LIME=Object.freeze(It.fromCssColorString("#00FF00")),It.LIMEGREEN=Object.freeze(It.fromCssColorString("#32CD32")),It.LINEN=Object.freeze(It.fromCssColorString("#FAF0E6")),It.MAGENTA=Object.freeze(It.fromCssColorString("#FF00FF")),It.MAROON=Object.freeze(It.fromCssColorString("#800000")),It.MEDIUMAQUAMARINE=Object.freeze(It.fromCssColorString("#66CDAA")),It.MEDIUMBLUE=Object.freeze(It.fromCssColorString("#0000CD")),It.MEDIUMORCHID=Object.freeze(It.fromCssColorString("#BA55D3")),It.MEDIUMPURPLE=Object.freeze(It.fromCssColorString("#9370DB")),It.MEDIUMSEAGREEN=Object.freeze(It.fromCssColorString("#3CB371")),It.MEDIUMSLATEBLUE=Object.freeze(It.fromCssColorString("#7B68EE")),It.MEDIUMSPRINGGREEN=Object.freeze(It.fromCssColorString("#00FA9A")),It.MEDIUMTURQUOISE=Object.freeze(It.fromCssColorString("#48D1CC")),It.MEDIUMVIOLETRED=Object.freeze(It.fromCssColorString("#C71585")),It.MIDNIGHTBLUE=Object.freeze(It.fromCssColorString("#191970")),It.MINTCREAM=Object.freeze(It.fromCssColorString("#F5FFFA")),It.MISTYROSE=Object.freeze(It.fromCssColorString("#FFE4E1")),It.MOCCASIN=Object.freeze(It.fromCssColorString("#FFE4B5")),It.NAVAJOWHITE=Object.freeze(It.fromCssColorString("#FFDEAD")),It.NAVY=Object.freeze(It.fromCssColorString("#000080")),It.OLDLACE=Object.freeze(It.fromCssColorString("#FDF5E6")),It.OLIVE=Object.freeze(It.fromCssColorString("#808000")),It.OLIVEDRAB=Object.freeze(It.fromCssColorString("#6B8E23")),It.ORANGE=Object.freeze(It.fromCssColorString("#FFA500")),It.ORANGERED=Object.freeze(It.fromCssColorString("#FF4500")),It.ORCHID=Object.freeze(It.fromCssColorString("#DA70D6")),It.PALEGOLDENROD=Object.freeze(It.fromCssColorString("#EEE8AA")),It.PALEGREEN=Object.freeze(It.fromCssColorString("#98FB98")),It.PALETURQUOISE=Object.freeze(It.fromCssColorString("#AFEEEE")),It.PALEVIOLETRED=Object.freeze(It.fromCssColorString("#DB7093")),It.PAPAYAWHIP=Object.freeze(It.fromCssColorString("#FFEFD5")),It.PEACHPUFF=Object.freeze(It.fromCssColorString("#FFDAB9")),It.PERU=Object.freeze(It.fromCssColorString("#CD853F")),It.PINK=Object.freeze(It.fromCssColorString("#FFC0CB")),It.PLUM=Object.freeze(It.fromCssColorString("#DDA0DD")),It.POWDERBLUE=Object.freeze(It.fromCssColorString("#B0E0E6")),It.PURPLE=Object.freeze(It.fromCssColorString("#800080")),It.RED=Object.freeze(It.fromCssColorString("#FF0000")),It.ROSYBROWN=Object.freeze(It.fromCssColorString("#BC8F8F")),It.ROYALBLUE=Object.freeze(It.fromCssColorString("#4169E1")),It.SADDLEBROWN=Object.freeze(It.fromCssColorString("#8B4513")),It.SALMON=Object.freeze(It.fromCssColorString("#FA8072")),It.SANDYBROWN=Object.freeze(It.fromCssColorString("#F4A460")),It.SEAGREEN=Object.freeze(It.fromCssColorString("#2E8B57")),It.SEASHELL=Object.freeze(It.fromCssColorString("#FFF5EE")),It.SIENNA=Object.freeze(It.fromCssColorString("#A0522D")),It.SILVER=Object.freeze(It.fromCssColorString("#C0C0C0")),It.SKYBLUE=Object.freeze(It.fromCssColorString("#87CEEB")),It.SLATEBLUE=Object.freeze(It.fromCssColorString("#6A5ACD")),It.SLATEGRAY=Object.freeze(It.fromCssColorString("#708090")),It.SLATEGREY=It.SLATEGRAY,It.SNOW=Object.freeze(It.fromCssColorString("#FFFAFA")),It.SPRINGGREEN=Object.freeze(It.fromCssColorString("#00FF7F")),It.STEELBLUE=Object.freeze(It.fromCssColorString("#4682B4")),It.TAN=Object.freeze(It.fromCssColorString("#D2B48C")),It.TEAL=Object.freeze(It.fromCssColorString("#008080")),It.THISTLE=Object.freeze(It.fromCssColorString("#D8BFD8")),It.TOMATO=Object.freeze(It.fromCssColorString("#FF6347")),It.TURQUOISE=Object.freeze(It.fromCssColorString("#40E0D0")),It.VIOLET=Object.freeze(It.fromCssColorString("#EE82EE")),It.WHEAT=Object.freeze(It.fromCssColorString("#F5DEB3")),It.WHITE=Object.freeze(It.fromCssColorString("#FFFFFF")),It.WHITESMOKE=Object.freeze(It.fromCssColorString("#F5F5F5")),It.YELLOW=Object.freeze(It.fromCssColorString("#FFFF00")),It.YELLOWGREEN=Object.freeze(It.fromCssColorString("#9ACD32")),It.TRANSPARENT=Object.freeze(new It(0,0,0,0));var Rt=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),Dt={BYTE:Rt.BYTE,UNSIGNED_BYTE:Rt.UNSIGNED_BYTE,SHORT:Rt.SHORT,UNSIGNED_SHORT:Rt.UNSIGNED_SHORT,INT:Rt.INT,UNSIGNED_INT:Rt.UNSIGNED_INT,FLOAT:Rt.FLOAT,DOUBLE:Rt.DOUBLE,getSizeInBytes:function(e){switch(e){case Dt.BYTE:return Int8Array.BYTES_PER_ELEMENT;case Dt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Dt.SHORT:return Int16Array.BYTES_PER_ELEMENT;case Dt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Dt.INT:return Int32Array.BYTES_PER_ELEMENT;case Dt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Dt.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case Dt.DOUBLE:return Float64Array.BYTES_PER_ELEMENT}},fromTypedArray:function(e){return e instanceof Int8Array?Dt.BYTE:e instanceof Uint8Array?Dt.UNSIGNED_BYTE:e instanceof Int16Array?Dt.SHORT:e instanceof Uint16Array?Dt.UNSIGNED_SHORT:e instanceof Int32Array?Dt.INT:e instanceof Uint32Array?Dt.UNSIGNED_INT:e instanceof Float32Array?Dt.FLOAT:e instanceof Float64Array?Dt.DOUBLE:void 0},validate:function(e){return Ze(e)&&(e===Dt.BYTE||e===Dt.UNSIGNED_BYTE||e===Dt.SHORT||e===Dt.UNSIGNED_SHORT||e===Dt.INT||e===Dt.UNSIGNED_INT||e===Dt.FLOAT||e===Dt.DOUBLE)},createTypedArray:function(e,t){switch(e){case Dt.BYTE:return new Int8Array(t);case Dt.UNSIGNED_BYTE:return new Uint8Array(t);case Dt.SHORT:return new Int16Array(t);case Dt.UNSIGNED_SHORT:return new Uint16Array(t);case Dt.INT:return new Int32Array(t);case Dt.UNSIGNED_INT:return new Uint32Array(t);case Dt.FLOAT:return new Float32Array(t);case Dt.DOUBLE:return new Float64Array(t)}},createArrayBufferView:function(e,t,n,r){switch(n=Je(n,0),r=Je(r,(t.byteLength-n)/Dt.getSizeInBytes(e)),e){case Dt.BYTE:return new Int8Array(t,n,r);case Dt.UNSIGNED_BYTE:return new Uint8Array(t,n,r);case Dt.SHORT:return new Int16Array(t,n,r);case Dt.UNSIGNED_SHORT:return new Uint16Array(t,n,r);case Dt.INT:return new Int32Array(t,n,r);case Dt.UNSIGNED_INT:return new Uint32Array(t,n,r);case Dt.FLOAT:return new Float32Array(t,n,r);case Dt.DOUBLE:return new Float64Array(t,n,r)}},fromName:function(e){switch(e){case"BYTE":return Dt.BYTE;case"UNSIGNED_BYTE":return Dt.UNSIGNED_BYTE;case"SHORT":return Dt.SHORT;case"UNSIGNED_SHORT":return Dt.UNSIGNED_SHORT;case"INT":return Dt.INT;case"UNSIGNED_INT":return Dt.UNSIGNED_INT;case"FLOAT":return Dt.FLOAT;case"DOUBLE":return Dt.DOUBLE}}},Mt=Object.freeze(Dt),Ft={};function zt(e,t){Ze(Ft[e])||(Ft[e]=!0,console.warn(Je(t,e)))}function Bt(e,t){zt(e,t)}function Ut(){return!0}function Vt(e){function t(){}for(var n in e)"function"==typeof e[n]&&(e[n]=t);e.isDestroyed=Ut}function kt(e,t,n){return t=Je(t,0),n=Je(n,e.byteLength-t),e=e.subarray(t,t+n),kt.decode(e)}function Gt(e,t,n){return t<=e&&e<=n}function qt(e,t,n,r){this.x=Je(e,0),this.y=Je(t,0),this.z=Je(n,0),this.w=Je(r,0)}zt.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",zt.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",zt.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",zt.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored",kt.decodeWithTextDecoder=function(e){return new TextDecoder("utf-8").decode(e)},kt.decodeWithFromCharCode=function(e){for(var t="",n=function(e){for(var t=0,n=0,r=0,i=128,o=191,a=[],s=e.length,u=0;u<s;++u){var l=e[u];if(0===r){if(Gt(l,0,127)){a.push(l);continue}if(Gt(l,194,223)){r=1,t=31&l;continue}if(Gt(l,224,239)){224===l&&(i=160),237===l&&(o=159),r=2,t=15&l;continue}if(Gt(l,240,244)){240===l&&(i=144),244===l&&(o=143),r=3,t=7&l;continue}throw new de("String decoding failed.")}Gt(l,i,o)?(i=128,o=191,t=t<<6|63&l,++n===r&&(a.push(t),t=r=n=0)):(t=r=n=0,i=128,o=191,--u)}return a}(e),r=n.length,i=0;i<r;++i){var o=n[i];o<=65535?t+=String.fromCharCode(o):(o-=65536,t+=String.fromCharCode(55296+(o>>10),56320+(1023&o)))}return t},"undefined"!=typeof TextDecoder?kt.decode=kt.decodeWithTextDecoder:kt.decode=kt.decodeWithFromCharCode,qt.fromElements=function(e,t,n,r,i){return Ze(i)?(i.x=e,i.y=t,i.z=n,i.w=r,i):new qt(e,t,n,r)},qt.fromColor=function(e,t){return Ze(t)?(t.x=e.red,t.y=e.green,t.z=e.blue,t.w=e.alpha,t):new qt(e.red,e.green,e.blue,e.alpha)},qt.clone=function(e,t){if(Ze(e))return Ze(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new qt(e.x,e.y,e.z,e.w)},qt.packedLength=4,qt.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t},qt.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new qt),n.x=e[t++],n.y=e[t++],n.z=e[t++],n.w=e[t],n},qt.packArray=function(e,t){var n=e.length,r=4*n;if(Ze(t)){if(!Array.isArray(t)&&t.length!==r)throw new fe("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==r&&(t.length=r)}else t=new Array(r);for(var i=0;i<n;++i)qt.pack(e[i],t,4*i);return t},qt.unpackArray=function(e,t){var n=e.length;Ze(t)?t.length=n/4:t=new Array(n/4);for(var r=0;r<n;r+=4){var i=r/4;t[i]=qt.unpack(e,r,t[i])}return t},qt.fromArray=qt.unpack,qt.maximumComponent=function(e){return Math.max(e.x,e.y,e.z,e.w)},qt.minimumComponent=function(e){return Math.min(e.x,e.y,e.z,e.w)},qt.minimumByComponent=function(e,t,n){return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.z=Math.min(e.z,t.z),n.w=Math.min(e.w,t.w),n},qt.maximumByComponent=function(e,t,n){return n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n.z=Math.max(e.z,t.z),n.w=Math.max(e.w,t.w),n},qt.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},qt.magnitude=function(e){return Math.sqrt(qt.magnitudeSquared(e))};var Ht=new qt;qt.distance=function(e,t){return qt.subtract(e,t,Ht),qt.magnitude(Ht)},qt.distanceSquared=function(e,t){return qt.subtract(e,t,Ht),qt.magnitudeSquared(Ht)},qt.normalize=function(e,t){var n=qt.magnitude(e);return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t.w=e.w/n,t},qt.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},qt.multiplyComponents=function(e,t,n){return n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z,n.w=e.w*t.w,n},qt.divideComponents=function(e,t,n){return n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z,n.w=e.w/t.w,n},qt.add=function(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n},qt.subtract=function(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n},qt.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n},qt.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n},qt.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},qt.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t};var Wt=new qt;qt.lerp=function(e,t,n,r){return qt.multiplyByScalar(t,n,Wt),r=qt.multiplyByScalar(e,1-n,r),qt.add(Wt,r,r)};var Yt=new qt;qt.mostOrthogonalAxis=function(e,t){var n=qt.normalize(e,Yt);return qt.abs(n,n),t=n.x<=n.y?n.x<=n.z?n.x<=n.w?qt.clone(qt.UNIT_X,t):qt.clone(qt.UNIT_W,t):n.z<=n.w?qt.clone(qt.UNIT_Z,t):qt.clone(qt.UNIT_W,t):n.y<=n.z?n.y<=n.w?qt.clone(qt.UNIT_Y,t):qt.clone(qt.UNIT_W,t):n.z<=n.w?qt.clone(qt.UNIT_Z,t):qt.clone(qt.UNIT_W,t)},qt.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},qt.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]&&e.z===t[n+2]&&e.w===t[n+3]},qt.equalsEpsilon=function(e,t,n,r){return e===t||Ze(e)&&Ze(t)&&pt.equalsEpsilon(e.x,t.x,n,r)&&pt.equalsEpsilon(e.y,t.y,n,r)&&pt.equalsEpsilon(e.z,t.z,n,r)&&pt.equalsEpsilon(e.w,t.w,n,r)},qt.ZERO=Object.freeze(new qt(0,0,0,0)),qt.UNIT_X=Object.freeze(new qt(1,0,0,0)),qt.UNIT_Y=Object.freeze(new qt(0,1,0,0)),qt.UNIT_Z=Object.freeze(new qt(0,0,1,0)),qt.UNIT_W=Object.freeze(new qt(0,0,0,1)),qt.prototype.clone=function(e){return qt.clone(this,e)},qt.prototype.equals=function(e){return qt.equals(this,e)},qt.prototype.equalsEpsilon=function(e,t,n){return qt.equalsEpsilon(this,e,t,n)},qt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var Xt=new Float32Array(1);function jt(e,t,n,r,i,o,a,s,u){this[0]=Je(e,0),this[1]=Je(r,0),this[2]=Je(a,0),this[3]=Je(t,0),this[4]=Je(i,0),this[5]=Je(s,0),this[6]=Je(n,0),this[7]=Je(o,0),this[8]=Je(u,0)}qt.packFloat=function(e,t){if(Ze(t)||(t=new qt),Xt[0]=e,0===(e=Xt[0]))return qt.clone(qt.ZERO,t);var n,r=e<0?1:0;isFinite(e)?(e=Math.abs(e),n=Math.floor(pt.logBase(e,10))+1,e/=Math.pow(10,n)):(e=.1,n=38);var i=256*e;return t.x=Math.floor(i),i=256*(i-t.x),t.y=Math.floor(i),i=256*(i-t.y),t.z=Math.floor(i),t.w=2*(n+38)+r,t},qt.unpackFloat=function(e){var t=e.w/2,n=Math.floor(t),r=-(r=2*(r=2*(t-n))-1);if(38<=(n-=38))return r<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;var i=r*e.x*(1/256);return i+=r*e.y*(1/65536),(i+=r*e.z*(1/16777216))*Math.pow(10,n)},jt.packedLength=9,jt.pack=function(e,t,n){return n=Je(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t},jt.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new jt),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n},jt.clone=function(e,t){if(Ze(e))return Ze(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):new jt(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},jt.fromArray=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new jt),n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],n[8]=e[t+8],n},jt.fromColumnMajorArray=function(e,t){return jt.clone(e,t)},jt.fromRowMajorArray=function(e,t){return Ze(t)?(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t):new jt(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},jt.fromQuaternion=function(e,t){var n=e.x*e.x,r=e.x*e.y,i=e.x*e.z,o=e.x*e.w,a=e.y*e.y,s=e.y*e.z,u=e.y*e.w,l=e.z*e.z,c=e.z*e.w,h=e.w*e.w,f=n-a-l+h,p=2*(r-c),d=2*(i+u),m=2*(r+c),_=a-n-l+h,g=2*(s-o),y=2*(i-u),v=2*(s+o),x=-n-a+l+h;return Ze(t)?(t[0]=f,t[1]=m,t[2]=y,t[3]=p,t[4]=_,t[5]=v,t[6]=d,t[7]=g,t[8]=x,t):new jt(f,p,d,m,_,g,y,v,x)},jt.fromHeadingPitchRoll=function(e,t){var n=Math.cos(-e.pitch),r=Math.cos(-e.heading),i=Math.cos(e.roll),o=Math.sin(-e.pitch),a=Math.sin(-e.heading),s=Math.sin(e.roll),u=n*r,l=-i*a+s*o*r,c=s*a+i*o*r,h=n*a,f=i*r+s*o*a,p=-s*r+i*o*a,d=-o,m=s*n,_=i*n;return Ze(t)?(t[0]=u,t[1]=h,t[2]=d,t[3]=l,t[4]=f,t[5]=m,t[6]=c,t[7]=p,t[8]=_,t):new jt(u,l,c,h,f,p,d,m,_)},jt.fromScale=function(e,t){return Ze(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t):new jt(e.x,0,0,0,e.y,0,0,0,e.z)},jt.fromUniformScale=function(e,t){return Ze(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t):new jt(e,0,0,0,e,0,0,0,e)},jt.fromCrossProduct=function(e,t){return Ze(t)?(t[0]=0,t[1]=e.z,t[2]=-e.y,t[3]=-e.z,t[4]=0,t[5]=e.x,t[6]=e.y,t[7]=-e.x,t[8]=0,t):new jt(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)},jt.fromRotationX=function(e,t){var n=Math.cos(e),r=Math.sin(e);return Ze(t)?(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=n,t[5]=r,t[6]=0,t[7]=-r,t[8]=n,t):new jt(1,0,0,0,n,-r,0,r,n)},jt.fromRotationY=function(e,t){var n=Math.cos(e),r=Math.sin(e);return Ze(t)?(t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=1,t[5]=0,t[6]=r,t[7]=0,t[8]=n,t):new jt(n,0,r,0,1,0,-r,0,n)},jt.fromRotationZ=function(e,t){var n=Math.cos(e),r=Math.sin(e);return Ze(t)?(t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new jt(n,-r,0,r,n,0,0,0,1)},jt.toArray=function(e,t){return Ze(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},jt.getElementIndex=function(e,t){return 3*e+t},jt.getColumn=function(e,t,n){var r=3*t,i=e[r],o=e[1+r],a=e[2+r];return n.x=i,n.y=o,n.z=a,n},jt.setColumn=function(e,t,n,r){var i=3*t;return(r=jt.clone(e,r))[i]=n.x,r[1+i]=n.y,r[2+i]=n.z,r},jt.getRow=function(e,t,n){var r=e[t],i=e[t+3],o=e[t+6];return n.x=r,n.y=i,n.z=o,n},jt.setRow=function(e,t,n,r){return(r=jt.clone(e,r))[t]=n.x,r[t+3]=n.y,r[t+6]=n.z,r};var Kt=new _t;jt.getScale=function(e,t){return t.x=_t.magnitude(_t.fromElements(e[0],e[1],e[2],Kt)),t.y=_t.magnitude(_t.fromElements(e[3],e[4],e[5],Kt)),t.z=_t.magnitude(_t.fromElements(e[6],e[7],e[8],Kt)),t};var Qt=new _t;jt.getMaximumScale=function(e){return jt.getScale(e,Qt),_t.maximumComponent(Qt)},jt.multiply=function(e,t,n){var r=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],i=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],o=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],a=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],s=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],u=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],l=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],c=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],h=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return n[0]=r,n[1]=i,n[2]=o,n[3]=a,n[4]=s,n[5]=u,n[6]=l,n[7]=c,n[8]=h,n},jt.add=function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n},jt.subtract=function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n},jt.multiplyByVector=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=e[0]*r+e[3]*i+e[6]*o,s=e[1]*r+e[4]*i+e[7]*o,u=e[2]*r+e[5]*i+e[8]*o;return n.x=a,n.y=s,n.z=u,n},jt.multiplyByScalar=function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n},jt.multiplyByScale=function(e,t,n){return n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.x,n[3]=e[3]*t.y,n[4]=e[4]*t.y,n[5]=e[5]*t.y,n[6]=e[6]*t.z,n[7]=e[7]*t.z,n[8]=e[8]*t.z,n},jt.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t},jt.transpose=function(e,t){var n=e[0],r=e[3],i=e[6],o=e[1],a=e[4],s=e[7],u=e[2],l=e[5],c=e[8];return t[0]=n,t[1]=r,t[2]=i,t[3]=o,t[4]=a,t[5]=s,t[6]=u,t[7]=l,t[8]=c,t};var Zt=new _t(1,1,1);jt.getRotation=function(e,t){var n=_t.divideComponents(Zt,jt.getScale(e,Qt),Qt);return t=jt.multiplyByScale(e,n,t)};var Jt=[1,0,0],$t=[2,2,1];function en(e){for(var t=0,n=0;n<3;++n){var r=e[jt.getElementIndex($t[n],Jt[n])];t+=2*r*r}return Math.sqrt(t)}function tn(e,t){for(var n=pt.EPSILON15,r=0,i=1,o=0;o<3;++o){var a=Math.abs(e[jt.getElementIndex($t[o],Jt[o])]);r<a&&(i=o,r=a)}var s,u,l=1,c=0,h=Jt[i],f=$t[i];return Math.abs(e[jt.getElementIndex(f,h)])>n&&(c=(u=(s=(e[jt.getElementIndex(f,f)]-e[jt.getElementIndex(h,h)])/2/e[jt.getElementIndex(f,h)])<0?-1/(-s+Math.sqrt(1+s*s)):1/(s+Math.sqrt(1+s*s)))*(l=1/Math.sqrt(1+u*u))),(t=jt.clone(jt.IDENTITY,t))[jt.getElementIndex(h,h)]=t[jt.getElementIndex(f,f)]=l,t[jt.getElementIndex(f,h)]=c,t[jt.getElementIndex(h,f)]=-c,t}var nn=new jt,rn=new jt;function on(e,t,n,r,i,o,a,s,u,l,c,h,f,p,d,m){this[0]=Je(e,0),this[1]=Je(i,0),this[2]=Je(u,0),this[3]=Je(f,0),this[4]=Je(t,0),this[5]=Je(o,0),this[6]=Je(l,0),this[7]=Je(p,0),this[8]=Je(n,0),this[9]=Je(a,0),this[10]=Je(c,0),this[11]=Je(d,0),this[12]=Je(r,0),this[13]=Je(s,0),this[14]=Je(h,0),this[15]=Je(m,0)}function an(e){return 0<e?1:e<0?-1:0}jt.computeEigenDecomposition=function(e,t){var n=pt.EPSILON20,r=0,i=0;Ze(t)||(t={});for(var o=t.unitary=jt.clone(jt.IDENTITY,t.unitary),a=t.diagonal=jt.clone(e,t.diagonal),s=n*function(e){for(var t=0,n=0;n<9;++n){var r=e[n];t+=r*r}return Math.sqrt(t)}(a);i<10&&en(a)>s;)tn(a,nn),jt.transpose(nn,rn),jt.multiply(a,nn,a),jt.multiply(rn,a,a),jt.multiply(o,nn,o),2<++r&&(++i,r=0);return t},jt.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t},jt.determinant=function(e){var t=e[0],n=e[3],r=e[6],i=e[1],o=e[4],a=e[7],s=e[2],u=e[5],l=e[8];return t*(o*l-u*a)+i*(u*r-n*l)+s*(n*a-o*r)},jt.inverse=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=jt.determinant(e);return t[0]=a*c-l*s,t[1]=l*i-r*c,t[2]=r*s-a*i,t[3]=u*s-o*c,t[4]=n*c-u*i,t[5]=o*i-n*s,t[6]=o*l-u*a,t[7]=u*r-n*l,t[8]=n*a-o*r,jt.multiplyByScalar(t,1/h,t)},jt.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},jt.equalsEpsilon=function(e,t,n){return e===t||Ze(e)&&Ze(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n},jt.IDENTITY=Object.freeze(new jt(1,0,0,0,1,0,0,0,1)),jt.ZERO=Object.freeze(new jt(0,0,0,0,0,0,0,0,0)),jt.COLUMN0ROW0=0,jt.COLUMN0ROW1=1,jt.COLUMN0ROW2=2,jt.COLUMN1ROW0=3,jt.COLUMN1ROW1=4,jt.COLUMN1ROW2=5,jt.COLUMN2ROW0=6,jt.COLUMN2ROW1=7,jt.COLUMN2ROW2=8,Object.defineProperties(jt.prototype,{length:{get:function(){return jt.packedLength}}}),jt.prototype.clone=function(e){return jt.clone(this,e)},jt.prototype.equals=function(e){return jt.equals(this,e)},jt.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]},jt.prototype.equalsEpsilon=function(e,t){return jt.equalsEpsilon(this,e,t)},jt.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"},on.packedLength=16,on.computeReflection=function(e,t,n,r,i){return Ze(i)||(i=new on),i[0]=1-2*e*e,i[1]=-2*e*t,i[2]=-2*e*n,i[3]=0,i[4]=-2*t*e,i[5]=1-2*t*t,i[6]=-2*t*n,i[7]=0,i[8]=-2*n*e,i[9]=-2*n*t,i[10]=1-2*n*n,i[11]=0,i[12]=-2*r*e,i[13]=-2*r*t,i[14]=-2*r*n,i[15]=1,i},on.computeObliquePerspective=function(e,t,n){var r=on.inverse(n,new on),i=on.inverseTranspose(t,new on),o=on.multiplyByVector(i,e,new qt),a=new qt(an(o.x),an(o.y),1,1),s=on.multiplyByVector(r,a,new qt),u=2/qt.dot(o,s),l=[o.x*u,o.y*u,o.z*u+1,o.w*u];return new on(n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],l[0],l[1],l[2],l[3],n[3],n[7],n[11],n[15])},on.inverseTranspose=function(e,t){return on.inverse(on.transpose(e,new on),t)},on.pack=function(e,t,n){return n=Je(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t[n++]=e[4],t[n++]=e[5],t[n++]=e[6],t[n++]=e[7],t[n++]=e[8],t[n++]=e[9],t[n++]=e[10],t[n++]=e[11],t[n++]=e[12],t[n++]=e[13],t[n++]=e[14],t[n]=e[15],t},on.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new on),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n[4]=e[t++],n[5]=e[t++],n[6]=e[t++],n[7]=e[t++],n[8]=e[t++],n[9]=e[t++],n[10]=e[t++],n[11]=e[t++],n[12]=e[t++],n[13]=e[t++],n[14]=e[t++],n[15]=e[t],n},on.clone=function(e,t){if(Ze(e))return Ze(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):new on(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},on.fromArray=on.unpack,on.fromColumnMajorArray=function(e,t){return on.clone(e,t)},on.fromRowMajorArray=function(e,t){return Ze(t)?(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t):new on(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},on.fromRotationTranslation=function(e,t,n){return t=Je(t,_t.ZERO),Ze(n)?(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=0,n[4]=e[3],n[5]=e[4],n[6]=e[5],n[7]=0,n[8]=e[6],n[9]=e[7],n[10]=e[8],n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,n):new on(e[0],e[3],e[6],t.x,e[1],e[4],e[7],t.y,e[2],e[5],e[8],t.z,0,0,0,1)},on.fromTranslationQuaternionRotationScale=function(e,t,n,r){Ze(r)||(r=new on);var i=n.x,o=n.y,a=n.z,s=t.x*t.x,u=t.x*t.y,l=t.x*t.z,c=t.x*t.w,h=t.y*t.y,f=t.y*t.z,p=t.y*t.w,d=t.z*t.z,m=t.z*t.w,_=t.w*t.w,g=s-h-d+_,y=2*(u-m),v=2*(l+p),x=2*(u+m),b=h-s-d+_,E=2*(f-c),T=2*(l-p),S=2*(f+c),C=-s-h+d+_;return r[0]=g*i,r[1]=x*i,r[2]=T*i,r[3]=0,r[4]=y*o,r[5]=b*o,r[6]=S*o,r[7]=0,r[8]=v*a,r[9]=E*a,r[10]=C*a,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,r},on.fromTranslationRotationScale=function(e,t){return on.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)},on.fromTranslation=function(e,t){return on.fromRotationTranslation(jt.IDENTITY,e,t)},on.fromScale=function(e,t){return Ze(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new on(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)},on.fromUniformScale=function(e,t){return Ze(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new on(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1)};var sn=new _t,un=new _t,ln=new _t;on.fromCamera=function(e,t){var n=e.position,r=e.direction,i=e.up;_t.normalize(r,sn),_t.normalize(_t.cross(sn,i,un),un),_t.normalize(_t.cross(un,sn,ln),ln);var o=un.x,a=un.y,s=un.z,u=sn.x,l=sn.y,c=sn.z,h=ln.x,f=ln.y,p=ln.z,d=n.x,m=n.y,_=n.z,g=o*-d+a*-m+s*-_,y=h*-d+f*-m+p*-_,v=u*d+l*m+c*_;return Ze(t)?(t[0]=o,t[1]=h,t[2]=-u,t[3]=0,t[4]=a,t[5]=f,t[6]=-l,t[7]=0,t[8]=s,t[9]=p,t[10]=-c,t[11]=0,t[12]=g,t[13]=y,t[14]=v,t[15]=1,t):new on(o,a,s,g,h,f,p,y,-u,-l,-c,v,0,0,0,1)},on.computePerspectiveFieldOfView=function(e,t,n,r,i){var o=1/Math.tan(.5*e),a=o/t,s=(r+n)/(n-r),u=2*r*n/(n-r);return i[0]=a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s,i[11]=-1,i[12]=0,i[13]=0,i[14]=u,i[15]=0,i},on.computeOrthographicOffCenter=function(e,t,n,r,i,o,a){var s=1/(t-e),u=1/(r-n),l=1/(o-i),c=-(t+e)*s,h=-(r+n)*u,f=-(o+i)*l;return s*=2,u*=2,l*=-2,a[0]=s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=l,a[11]=0,a[12]=c,a[13]=h,a[14]=f,a[15]=1,a},on.computePerspectiveOffCenter=function(e,t,n,r,i,o,a){var s=2*i/(t-e),u=2*i/(r-n),l=(t+e)/(t-e),c=(r+n)/(r-n),h=-(o+i)/(o-i),f=-2*o*i/(o-i);return a[0]=s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=u,a[6]=0,a[7]=0,a[8]=l,a[9]=c,a[10]=h,a[11]=-1,a[12]=0,a[13]=0,a[14]=f,a[15]=0,a},on.computeInfinitePerspectiveOffCenter=function(e,t,n,r,i,o){var a=2*i/(t-e),s=2*i/(r-n),u=(t+e)/(t-e),l=(r+n)/(r-n),c=-2*i;return o[0]=a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=u,o[9]=l,o[10]=-1,o[11]=-1,o[12]=0,o[13]=0,o[14]=c,o[15]=0,o},on.computeViewportTransformation=function(e,t,n,r){e=Je(e,Je.EMPTY_OBJECT);var i=Je(e.x,0),o=Je(e.y,0),a=Je(e.width,0),s=Je(e.height,0);t=Je(t,0);var u=.5*a,l=.5*s,c=.5*((n=Je(n,1))-t),h=l,f=c,p=i+u,d=o+l,m=t+c;return r[0]=u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=f,r[11]=0,r[12]=p,r[13]=d,r[14]=m,r[15]=1,r},on.computeView=function(e,t,n,r,i){return i[0]=r.x,i[1]=n.x,i[2]=-t.x,i[3]=0,i[4]=r.y,i[5]=n.y,i[6]=-t.y,i[7]=0,i[8]=r.z,i[9]=n.z,i[10]=-t.z,i[11]=0,i[12]=-_t.dot(r,e),i[13]=-_t.dot(n,e),i[14]=_t.dot(t,e),i[15]=1,i},on.toArray=function(e,t){return Ze(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},on.getElementIndex=function(e,t){return 4*e+t},on.getColumn=function(e,t,n){var r=4*t,i=e[r],o=e[1+r],a=e[2+r],s=e[3+r];return n.x=i,n.y=o,n.z=a,n.w=s,n},on.setColumn=function(e,t,n,r){var i=4*t;return(r=on.clone(e,r))[i]=n.x,r[1+i]=n.y,r[2+i]=n.z,r[3+i]=n.w,r},on.setTranslation=function(e,t,n){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=e[15],n};var cn=new _t;on.setScale=function(e,t,n){var r=on.getScale(e,cn),i=_t.divideComponents(t,r,cn);return on.multiplyByScale(e,i,n)},on.getRow=function(e,t,n){var r=e[t],i=e[t+4],o=e[t+8],a=e[t+12];return n.x=r,n.y=i,n.z=o,n.w=a,n},on.setRow=function(e,t,n,r){return(r=on.clone(e,r))[t]=n.x,r[t+4]=n.y,r[t+8]=n.z,r[t+12]=n.w,r};var hn=new _t;on.getScale=function(e,t){return t.x=_t.magnitude(_t.fromElements(e[0],e[1],e[2],hn)),t.y=_t.magnitude(_t.fromElements(e[4],e[5],e[6],hn)),t.z=_t.magnitude(_t.fromElements(e[8],e[9],e[10],hn)),t};var fn=new _t;on.getMaximumScale=function(e){return on.getScale(e,fn),_t.maximumComponent(fn)},on.multiply=function(e,t,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],d=e[11],m=e[12],_=e[13],g=e[14],y=e[15],v=t[0],x=t[1],b=t[2],E=t[3],T=t[4],S=t[5],C=t[6],w=t[7],A=t[8],I=t[9],P=t[10],O=t[11],L=t[12],N=t[13],R=t[14],D=t[15],M=r*v+s*x+h*b+m*E,F=i*v+u*x+f*b+_*E,z=o*v+l*x+p*b+g*E,B=a*v+c*x+d*b+y*E,U=r*T+s*S+h*C+m*w,V=i*T+u*S+f*C+_*w,k=o*T+l*S+p*C+g*w,G=a*T+c*S+d*C+y*w,q=r*A+s*I+h*P+m*O,H=i*A+u*I+f*P+_*O,W=o*A+l*I+p*P+g*O,Y=a*A+c*I+d*P+y*O,X=r*L+s*N+h*R+m*D,j=i*L+u*N+f*R+_*D,K=o*L+l*N+p*R+g*D,Q=a*L+c*N+d*R+y*D;return n[0]=M,n[1]=F,n[2]=z,n[3]=B,n[4]=U,n[5]=V,n[6]=k,n[7]=G,n[8]=q,n[9]=H,n[10]=W,n[11]=Y,n[12]=X,n[13]=j,n[14]=K,n[15]=Q,n},on.add=function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n},on.subtract=function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n},on.multiplyTransformation=function(e,t,n){var r=e[0],i=e[1],o=e[2],a=e[4],s=e[5],u=e[6],l=e[8],c=e[9],h=e[10],f=e[12],p=e[13],d=e[14],m=t[0],_=t[1],g=t[2],y=t[4],v=t[5],x=t[6],b=t[8],E=t[9],T=t[10],S=t[12],C=t[13],w=t[14],A=r*m+a*_+l*g,I=i*m+s*_+c*g,P=o*m+u*_+h*g,O=r*y+a*v+l*x,L=i*y+s*v+c*x,N=o*y+u*v+h*x,R=r*b+a*E+l*T,D=i*b+s*E+c*T,M=o*b+u*E+h*T,F=r*S+a*C+l*w+f,z=i*S+s*C+c*w+p,B=o*S+u*C+h*w+d;return n[0]=A,n[1]=I,n[2]=P,n[3]=0,n[4]=O,n[5]=L,n[6]=N,n[7]=0,n[8]=R,n[9]=D,n[10]=M,n[11]=0,n[12]=F,n[13]=z,n[14]=B,n[15]=1,n},on.multiplyByMatrix3=function(e,t,n){var r=e[0],i=e[1],o=e[2],a=e[4],s=e[5],u=e[6],l=e[8],c=e[9],h=e[10],f=t[0],p=t[1],d=t[2],m=t[3],_=t[4],g=t[5],y=t[6],v=t[7],x=t[8],b=r*f+a*p+l*d,E=i*f+s*p+c*d,T=o*f+u*p+h*d,S=r*m+a*_+l*g,C=i*m+s*_+c*g,w=o*m+u*_+h*g,A=r*y+a*v+l*x,I=i*y+s*v+c*x,P=o*y+u*v+h*x;return n[0]=b,n[1]=E,n[2]=T,n[3]=0,n[4]=S,n[5]=C,n[6]=w,n[7]=0,n[8]=A,n[9]=I,n[10]=P,n[11]=0,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},on.multiplyByTranslation=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=r*e[0]+i*e[4]+o*e[8]+e[12],s=r*e[1]+i*e[5]+o*e[9]+e[13],u=r*e[2]+i*e[6]+o*e[10]+e[14];return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=a,n[13]=s,n[14]=u,n[15]=e[15],n};var pn=new _t;on.multiplyByUniformScale=function(e,t,n){return pn.x=t,pn.y=t,pn.z=t,on.multiplyByScale(e,pn,n)},on.multiplyByScale=function(e,t,n){var r=t.x,i=t.y,o=t.z;return 1===r&&1===i&&1===o?on.clone(e,n):(n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=0,n[4]=i*e[4],n[5]=i*e[5],n[6]=i*e[6],n[7]=0,n[8]=o*e[8],n[9]=o*e[9],n[10]=o*e[10],n[11]=0,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=1,n)},on.multiplyByVector=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=t.w,s=e[0]*r+e[4]*i+e[8]*o+e[12]*a,u=e[1]*r+e[5]*i+e[9]*o+e[13]*a,l=e[2]*r+e[6]*i+e[10]*o+e[14]*a,c=e[3]*r+e[7]*i+e[11]*o+e[15]*a;return n.x=s,n.y=u,n.z=l,n.w=c,n},on.multiplyByPointAsVector=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=e[0]*r+e[4]*i+e[8]*o,s=e[1]*r+e[5]*i+e[9]*o,u=e[2]*r+e[6]*i+e[10]*o;return n.x=a,n.y=s,n.z=u,n},on.multiplyByPoint=function(e,t,n){var r=t.x,i=t.y,o=t.z,a=e[0]*r+e[4]*i+e[8]*o+e[12],s=e[1]*r+e[5]*i+e[9]*o+e[13],u=e[2]*r+e[6]*i+e[10]*o+e[14];return n.x=a,n.y=s,n.z=u,n},on.multiplyByScalar=function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n},on.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},on.transpose=function(e,t){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[10]=e[10],t[11]=e[14],t[12]=i,t[13]=a,t[14]=s,t[15]=e[15],t},on.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t[9]=Math.abs(e[9]),t[10]=Math.abs(e[10]),t[11]=Math.abs(e[11]),t[12]=Math.abs(e[12]),t[13]=Math.abs(e[13]),t[14]=Math.abs(e[14]),t[15]=Math.abs(e[15]),t},on.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]},on.equalsEpsilon=function(e,t,n){return e===t||Ze(e)&&Ze(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n&&Math.abs(e[9]-t[9])<=n&&Math.abs(e[10]-t[10])<=n&&Math.abs(e[11]-t[11])<=n&&Math.abs(e[12]-t[12])<=n&&Math.abs(e[13]-t[13])<=n&&Math.abs(e[14]-t[14])<=n&&Math.abs(e[15]-t[15])<=n},on.getTranslation=function(e,t){return t.x=e[12],t.y=e[13],t.z=e[14],t},on.getMatrix3=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t};var dn=new jt,mn=new jt,_n=new qt,gn=new qt(0,0,0,1);on.inverse=function(e,t){var n=e[0],r=e[4],i=e[8],o=e[12],a=e[1],s=e[5],u=e[9],l=e[13],c=e[2],h=e[6],f=e[10],p=e[14],d=e[3],m=e[7],_=e[11],g=e[15],y=f*g,v=p*_,x=h*g,b=p*m,E=h*_,T=f*m,S=c*g,C=p*d,w=c*_,A=f*d,I=c*m,P=h*d,O=y*s+b*u+E*l-(v*s+x*u+T*l),L=v*a+S*u+A*l-(y*a+C*u+w*l),N=x*a+C*s+I*l-(b*a+S*s+P*l),R=T*a+w*s+P*u-(E*a+A*s+I*u),D=v*r+x*i+T*o-(y*r+b*i+E*o),M=y*n+C*i+w*o-(v*n+S*i+A*o),F=b*n+S*r+P*o-(x*n+C*r+I*o),z=E*n+A*r+I*i-(T*n+w*r+P*i),B=(y=i*l)*m+(b=o*s)*_+(E=r*u)*g-((v=o*u)*m+(x=r*l)*_+(T=i*s)*g),U=v*d+(S=n*l)*_+(A=i*a)*g-(y*d+(C=o*a)*_+(w=n*u)*g),V=x*d+C*m+(I=n*s)*g-(b*d+S*m+(P=r*a)*g),k=T*d+w*m+P*_-(E*d+A*m+I*_),G=x*f+T*p+v*h-(E*p+y*h+b*f),q=w*p+y*c+C*f-(S*f+A*p+v*c),H=S*h+P*p+b*c-(I*p+x*c+C*h),W=I*f+E*c+A*h-(w*h+P*f+T*c),Y=n*O+r*L+i*N+o*R;if(Math.abs(Y)<pt.EPSILON21){if(jt.equalsEpsilon(on.getMatrix3(e,dn),mn,pt.EPSILON7)&&qt.equals(on.getRow(e,3,_n),gn))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new de("matrix is not invertible because its determinate is zero.")}return Y=1/Y,t[0]=O*Y,t[1]=L*Y,t[2]=N*Y,t[3]=R*Y,t[4]=D*Y,t[5]=M*Y,t[6]=F*Y,t[7]=z*Y,t[8]=B*Y,t[9]=U*Y,t[10]=V*Y,t[11]=k*Y,t[12]=G*Y,t[13]=q*Y,t[14]=H*Y,t[15]=W*Y,t},on.inverseTransformation=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9],c=e[10],h=e[12],f=e[13],p=e[14],d=-n*h-r*f-i*p,m=-o*h-a*f-s*p,_=-u*h-l*f-c*p;return t[0]=n,t[1]=o,t[2]=u,t[3]=0,t[4]=r,t[5]=a,t[6]=l,t[7]=0,t[8]=i,t[9]=s,t[10]=c,t[11]=0,t[12]=d,t[13]=m,t[14]=_,t[15]=1,t},on.IDENTITY=Object.freeze(new on(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),on.ZERO=Object.freeze(new on(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),on.COLUMN0ROW0=0,on.COLUMN0ROW1=1,on.COLUMN0ROW2=2,on.COLUMN0ROW3=3,on.COLUMN1ROW0=4,on.COLUMN1ROW1=5,on.COLUMN1ROW2=6,on.COLUMN1ROW3=7,on.COLUMN2ROW0=8,on.COLUMN2ROW1=9,on.COLUMN2ROW2=10,on.COLUMN2ROW3=11,on.COLUMN3ROW0=12,on.COLUMN3ROW1=13,on.COLUMN3ROW2=14,on.COLUMN3ROW3=15,Object.defineProperties(on.prototype,{length:{get:function(){return on.packedLength}}}),on.prototype.clone=function(e){return on.clone(this,e)},on.prototype.equals=function(e){return on.equals(this,e)},on.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]&&e[4]===t[n+4]&&e[5]===t[n+5]&&e[6]===t[n+6]&&e[7]===t[n+7]&&e[8]===t[n+8]&&e[9]===t[n+9]&&e[10]===t[n+10]&&e[11]===t[n+11]&&e[12]===t[n+12]&&e[13]===t[n+13]&&e[14]===t[n+14]&&e[15]===t[n+15]},on.prototype.equalsEpsilon=function(e,t){return on.equalsEpsilon(this,e,t)},on.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"};var yn=Object.freeze({ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,OPAQUE:7,TRANSLUCENT:8,OVERLAY:9,NUMBER_OF_PASSES:10}),vn={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:on.fromRotationTranslation(jt.fromRotationX(pt.PI_OVER_TWO)),Z_UP_TO_Y_UP:on.fromRotationTranslation(jt.fromRotationX(-pt.PI_OVER_TWO)),X_UP_TO_Z_UP:on.fromRotationTranslation(jt.fromRotationY(-pt.PI_OVER_TWO)),Z_UP_TO_X_UP:on.fromRotationTranslation(jt.fromRotationY(pt.PI_OVER_TWO)),X_UP_TO_Y_UP:on.fromRotationTranslation(jt.fromRotationZ(pt.PI_OVER_TWO)),Y_UP_TO_X_UP:on.fromRotationTranslation(jt.fromRotationZ(-pt.PI_OVER_TWO)),fromName:function(e){return vn[e]}},xn=Object.freeze(vn);function bn(e,t,n,r){if("function"==typeof e.fill)return e.fill(t,n,r);for(var i=e.length>>>0,o=Je(n,0),a=o<0?Math.max(i+o,0):Math.min(o,i),s=Je(r,i),u=s<0?Math.max(i+s,0):Math.min(s,i);a<u;)e[a]=t,a++;return e}function En(e,t){this.x=Je(e,0),this.y=Je(t,0)}En.fromElements=function(e,t,n){return Ze(n)?(n.x=e,n.y=t,n):new En(e,t)},En.fromCartesian3=En.clone=function(e,t){if(Ze(e))return Ze(t)?(t.x=e.x,t.y=e.y,t):new En(e.x,e.y)},En.fromCartesian4=En.clone,En.packedLength=2,En.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.x,t[n]=e.y,t},En.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new En),n.x=e[t++],n.y=e[t],n},En.packArray=function(e,t){var n=e.length,r=2*n;if(Ze(t)){if(!Array.isArray(t)&&t.length!==r)throw new fe("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==r&&(t.length=r)}else t=new Array(r);for(var i=0;i<n;++i)En.pack(e[i],t,2*i);return t},En.unpackArray=function(e,t){var n=e.length;Ze(t)?t.length=n/2:t=new Array(n/2);for(var r=0;r<n;r+=2){var i=r/2;t[i]=En.unpack(e,r,t[i])}return t},En.fromArray=En.unpack,En.maximumComponent=function(e){return Math.max(e.x,e.y)},En.minimumComponent=function(e){return Math.min(e.x,e.y)},En.minimumByComponent=function(e,t,n){return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n},En.maximumByComponent=function(e,t,n){return n.x=Math.max(e.x,t.x),n.y=Math.max(e.y,t.y),n},En.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},En.magnitude=function(e){return Math.sqrt(En.magnitudeSquared(e))};var Tn=new En;En.distance=function(e,t){return En.subtract(e,t,Tn),En.magnitude(Tn)},En.distanceSquared=function(e,t){return En.subtract(e,t,Tn),En.magnitudeSquared(Tn)},En.normalize=function(e,t){var n=En.magnitude(e);return t.x=e.x/n,t.y=e.y/n,t},En.dot=function(e,t){return e.x*t.x+e.y*t.y},En.multiplyComponents=function(e,t,n){return n.x=e.x*t.x,n.y=e.y*t.y,n},En.divideComponents=function(e,t,n){return n.x=e.x/t.x,n.y=e.y/t.y,n},En.add=function(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n},En.subtract=function(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n},En.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n},En.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n},En.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t},En.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t};var Sn=new En;En.lerp=function(e,t,n,r){return En.multiplyByScalar(t,n,Sn),r=En.multiplyByScalar(e,1-n,r),En.add(Sn,r,r)};var Cn=new En,wn=new En;En.angleBetween=function(e,t){return En.normalize(e,Cn),En.normalize(t,wn),pt.acosClamped(En.dot(Cn,wn))};var An=new En;En.mostOrthogonalAxis=function(e,t){var n=En.normalize(e,An);return En.abs(n,n),t=n.x<=n.y?En.clone(En.UNIT_X,t):En.clone(En.UNIT_Y,t)},En.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.x===t.x&&e.y===t.y},En.equalsArray=function(e,t,n){return e.x===t[n]&&e.y===t[n+1]},En.equalsEpsilon=function(e,t,n,r){return e===t||Ze(e)&&Ze(t)&&pt.equalsEpsilon(e.x,t.x,n,r)&&pt.equalsEpsilon(e.y,t.y,n,r)},En.ZERO=Object.freeze(new En(0,0)),En.UNIT_X=Object.freeze(new En(1,0)),En.UNIT_Y=Object.freeze(new En(0,1)),En.prototype.clone=function(e){return En.clone(this,e)},En.prototype.equals=function(e){return En.equals(this,e)},En.prototype.equalsEpsilon=function(e,t,n){return En.equalsEpsilon(this,e,t,n)},En.prototype.toString=function(){return"("+this.x+", "+this.y+")"};var In={UNSIGNED_BYTE:Rt.UNSIGNED_BYTE,UNSIGNED_SHORT:Rt.UNSIGNED_SHORT,UNSIGNED_INT:Rt.UNSIGNED_INT,FLOAT:Rt.FLOAT,HALF_FLOAT:Rt.HALF_FLOAT_OES,UNSIGNED_INT_24_8:Rt.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:Rt.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:Rt.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:Rt.UNSIGNED_SHORT_5_6_5,isPacked:function(e){return e===In.UNSIGNED_INT_24_8||e===In.UNSIGNED_SHORT_4_4_4_4||e===In.UNSIGNED_SHORT_5_5_5_1||e===In.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(e){switch(e){case In.UNSIGNED_BYTE:return 1;case In.UNSIGNED_SHORT:case In.UNSIGNED_SHORT_4_4_4_4:case In.UNSIGNED_SHORT_5_5_5_1:case In.UNSIGNED_SHORT_5_6_5:case In.HALF_FLOAT:return 2;case In.UNSIGNED_INT:case In.FLOAT:case In.UNSIGNED_INT_24_8:return 4}},validate:function(e){return e===In.UNSIGNED_BYTE||e===In.UNSIGNED_SHORT||e===In.UNSIGNED_INT||e===In.FLOAT||e===In.HALF_FLOAT||e===In.UNSIGNED_INT_24_8||e===In.UNSIGNED_SHORT_4_4_4_4||e===In.UNSIGNED_SHORT_5_5_5_1||e===In.UNSIGNED_SHORT_5_6_5}},Pn=Object.freeze(In),On={DEPTH_COMPONENT:Rt.DEPTH_COMPONENT,DEPTH_STENCIL:Rt.DEPTH_STENCIL,ALPHA:Rt.ALPHA,RGB:Rt.RGB,RGBA:Rt.RGBA,LUMINANCE:Rt.LUMINANCE,LUMINANCE_ALPHA:Rt.LUMINANCE_ALPHA,RGB_DXT1:Rt.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:Rt.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:Rt.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:Rt.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:Rt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:Rt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:Rt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:Rt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:Rt.COMPRESSED_RGB_ETC1_WEBGL,RGB_ETC2:Rt.COMPRESSED_RGB8_ETC2,RGBA_ETC2:Rt.COMPRESSED_RGBA8_ETC2_EAC,componentsLength:function(e){switch(e){case On.RGB:return 3;case On.RGBA:return 4;case On.LUMINANCE_ALPHA:return 2;case On.ALPHA:case On.LUMINANCE:default:return 1}},validate:function(e){return e===On.DEPTH_COMPONENT||e===On.DEPTH_STENCIL||e===On.ALPHA||e===On.RGB||e===On.RGBA||e===On.LUMINANCE||e===On.LUMINANCE_ALPHA||e===On.RGB_DXT1||e===On.RGBA_DXT1||e===On.RGBA_DXT3||e===On.RGBA_DXT5||e===On.RGB_PVRTC_4BPPV1||e===On.RGB_PVRTC_2BPPV1||e===On.RGBA_PVRTC_4BPPV1||e===On.RGBA_PVRTC_2BPPV1||e===On.RGB_ETC1||e===On.RGB_ETC2||e===On.RGBA_ETC2},isColorFormat:function(e){return e===On.ALPHA||e===On.RGB||e===On.RGBA||e===On.LUMINANCE||e===On.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===On.DEPTH_COMPONENT||e===On.DEPTH_STENCIL},isCompressedFormat:function(e){return e===On.RGB_DXT1||e===On.RGBA_DXT1||e===On.RGBA_DXT3||e===On.RGBA_DXT5||e===On.RGB_PVRTC_4BPPV1||e===On.RGB_PVRTC_2BPPV1||e===On.RGBA_PVRTC_4BPPV1||e===On.RGBA_PVRTC_2BPPV1||e===On.RGB_ETC1||e===On.RGB_ETC2||e===On.RGBA_ETC2},isDXTFormat:function(e){return e===On.RGB_DXT1||e===On.RGBA_DXT1||e===On.RGBA_DXT3||e===On.RGBA_DXT5},isPVRTCFormat:function(e){return e===On.RGB_PVRTC_4BPPV1||e===On.RGB_PVRTC_2BPPV1||e===On.RGBA_PVRTC_4BPPV1||e===On.RGBA_PVRTC_2BPPV1},isETC1Format:function(e){return e===On.RGB_ETC1},compressedTextureSizeInBytes:function(e,t,n,r){var i=void 0!==r?r:1;switch(e){case On.RGB_DXT1:case On.RGBA_DXT1:case On.RGB_ETC1:case On.RGB_ETC2:for(var o=0;0<i;){o+=Math.floor((t+3)/4)*Math.floor((n+3)/4)*8,1!=t&&(t/=2),1!=n&&(n/=2),i--}return o;case On.RGBA_DXT3:case On.RGBA_DXT5:for(o=0;0<i;){o+=Math.floor((t+3)/4)*Math.floor((n+3)/4)*16,1!=t&&(t/=2),1!=n&&(n/=2),i--}return o;case On.RGB_PVRTC_4BPPV1:case On.RGBA_PVRTC_4BPPV1:for(o=0;0<i;){o+=Math.floor((Math.max(t,8)*Math.max(n,8)*4+7)/8),1!=t&&(t/=2),1!=n&&(n/=2),i--}return o;case On.RGB_PVRTC_2BPPV1:case On.RGBA_PVRTC_2BPPV1:for(o=0;0<i;){o+=Math.floor((Math.max(t,16)*Math.max(n,8)*2+7)/8),1!=t&&(t/=2),1!=n&&(n/=2),i--}return o;case On.RGBA_ETC2:for(o=0;0<i;){o+=Math.floor((t+3)/4)*Math.floor((n+3)/4)*16,1!=t&&(t/=2),1!=n&&(n/=2),i--}return o;default:return 0}},textureSizeInBytes:function(e,t,n,r){var i=On.componentsLength(e);return Pn.isPacked(t)&&(i=1),i*Pn.sizeInBytes(t)*n*r},alignmentInBytes:function(e,t,n){var r=On.textureSizeInBytes(e,t,n,1)%4;return 0==r?4:2==r?2:1},createTypedArray:function(e,t,n,r){var i=Pn.sizeInBytes(t),o=i===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:i===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:i===Float32Array.BYTES_PER_ELEMENT&&t===Pn.FLOAT?Float32Array:Uint32Array;return new o(On.componentsLength(e)*n*r)},flipY:function(e,t,n,r,i){if(1===i)return e;for(var o=On.createTypedArray(t,n,r,i),a=On.componentsLength(t),s=r*a,u=0;u<i;++u)for(var l=u*i*a,c=(i-u-1)*i*a,h=0;h<s;++h)o[c+h]=e[l+h];return o}},Ln=Object.freeze(On),Nn={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(Nn,{maximumCombinedTextureImageUnits:{get:function(){return Nn._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return Nn._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return Nn._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return Nn._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return Nn._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return Nn._maximumTextureSize}},maximumVaryingVectors:{get:function(){return Nn._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return Nn._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return Nn._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return Nn._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return Nn._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return Nn._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return Nn._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return Nn._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return Nn._maximumViewportWidth}},maximumViewportHeight:{get:function(){return Nn._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return Nn._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return Nn._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return Nn._maximumColorAttachments}},highpFloatSupported:{get:function(){return Nn._highpFloatSupported}},highpIntSupported:{get:function(){return Nn._highpIntSupported}}});var Rn={POINTS:Rt.POINTS,LINES:Rt.LINES,LINE_LOOP:Rt.LINE_LOOP,LINE_STRIP:Rt.LINE_STRIP,TRIANGLES:Rt.TRIANGLES,TRIANGLE_STRIP:Rt.TRIANGLE_STRIP,TRIANGLE_FAN:Rt.TRIANGLE_FAN,validate:function(e){return e===Rn.POINTS||e===Rn.LINES||e===Rn.LINE_LOOP||e===Rn.LINE_STRIP||e===Rn.TRIANGLES||e===Rn.TRIANGLE_STRIP||e===Rn.TRIANGLE_FAN}},Dn=Object.freeze(Rn);function Mn(e){e=Je(e,Je.EMPTY_OBJECT),this._boundingVolume=e.boundingVolume,this._orientedBoundingBox=e.orientedBoundingBox,this._cull=Je(e.cull,!0),this._occlude=Je(e.occlude,!0),this._modelMatrix=e.modelMatrix,this._primitiveType=Je(e.primitiveType,Dn.TRIANGLES),this._vertexArray=e.vertexArray,this._count=e.count,this._offset=Je(e.offset,0),this._instanceCount=Je(e.instanceCount,0),this._shaderProgram=e.shaderProgram,this._uniformMap=e.uniformMap,this._renderState=e.renderState,this._framebuffer=e.framebuffer,this._pass=e.pass,this._executeInClosestFrustum=Je(e.executeInClosestFrustum,!1),this._owner=e.owner,this._debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this._debugOverlappingFrustums=0,this._castShadows=Je(e.castShadows,!1),this._receiveShadows=Je(e.receiveShadows,!1),this._pickId=e.pickId,this._pickOnly=Je(e.pickOnly,!1),this.dirty=!0,this.lastDirtyTime=0,this.derivedCommands={}}Object.defineProperties(Mn.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(e){this._boundingVolume!==e&&(this._boundingVolume=e,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(e){this._orientedBoundingBox!==e&&(this._orientedBoundingBox=e,this.dirty=!0)}},cull:{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this.dirty=!0)}},occlude:{get:function(){return this._occlude},set:function(e){this._occlude!==e&&(this._occlude=e,this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix!==e&&(this._modelMatrix=e,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(e){this._primitiveType!==e&&(this._primitiveType=e,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(e){this._vertexArray!==e&&(this._vertexArray=e,this.dirty=!0)}},count:{get:function(){return this._count},set:function(e){this._count!==e&&(this._count=e,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(e){this._offset!==e&&(this._offset=e,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(e){this._instanceCount!==e&&(this._instanceCount=e,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(e){this._shaderProgram!==e&&(this._shaderProgram=e,this.dirty=!0)}},castShadows:{get:function(){return this._castShadows},set:function(e){this._castShadows!==e&&(this._castShadows=e,this.dirty=!0)}},receiveShadows:{get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(e){this._uniformMap!==e&&(this._uniformMap=e,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(e){this._renderState!==e&&(this._renderState=e,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(e){this._framebuffer!==e&&(this._framebuffer=e,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(e){this._pass!==e&&(this._pass=e,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return this._executeInClosestFrustum},set:function(e){this._executeInClosestFrustum!==e&&(this._executeInClosestFrustum=e,this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(e){this._owner!==e&&(this._owner=e,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolume=e,this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(e){this._debugOverlappingFrustums!==e&&(this._debugOverlappingFrustums=e,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(e){this._pickId!==e&&(this._pickId=e,this.dirty=!0)}},pickOnly:{get:function(){return this._pickOnly},set:function(e){this._pickOnly!==e&&(this._pickOnly=e,this.dirty=!0)}}}),Mn.shallowClone=function(e,t){if(Ze(e))return Ze(t)||(t=new Mn),t._boundingVolume=e._boundingVolume,t._orientedBoundingBox=e._orientedBoundingBox,t._cull=e._cull,t._occlude=e._occlude,t._modelMatrix=e._modelMatrix,t._primitiveType=e._primitiveType,t._vertexArray=e._vertexArray,t._count=e._count,t._offset=e._offset,t._instanceCount=e._instanceCount,t._shaderProgram=e._shaderProgram,t._uniformMap=e._uniformMap,t._renderState=e._renderState,t._framebuffer=e._framebuffer,t._pass=e._pass,t._executeInClosestFrustum=e._executeInClosestFrustum,t._owner=e._owner,t._debugShowBoundingVolume=e._debugShowBoundingVolume,t._debugOverlappingFrustums=e._debugOverlappingFrustums,t._castShadows=e._castShadows,t._receiveShadows=e._receiveShadows,t._pickId=e._pickId,t._pickOnly=e._pickOnly,t.dirty=!0,t.lastDirtyTime=0,t},Mn.prototype.execute=function(e,t){e.draw(this,t)};var Fn=new _t,zn=new _t;function Bn(e,t,n,r,i){var o=e.x,a=e.y,s=e.z,u=t.x,l=t.y,c=t.z,h=o*o*u*u,f=a*a*l*l,p=s*s*c*c,d=h+f+p,m=Math.sqrt(1/d),_=_t.multiplyByScalar(e,m,Fn);if(d<r)return isFinite(m)?_t.clone(_,i):void 0;var g=n.x,y=n.y,v=n.z,x=zn;x.x=_.x*g*2,x.y=_.y*y*2,x.z=_.z*v*2;var b,E,T,S,C,w,A,I=(1-m)*_t.magnitude(e)/(.5*_t.magnitude(x)),P=0;do{P=(b=h*(C=(E=1/(1+(I-=P)*g))*E)+f*(w=(T=1/(1+I*y))*T)+p*(A=(S=1/(1+I*v))*S)-1)/(-2*(h*(C*E)*g+f*(w*T)*y+p*(A*S)*v))}while(Math.abs(b)>pt.EPSILON12);return Ze(i)?(i.x=o*E,i.y=a*T,i.z=s*S,i):new _t(o*E,a*T,s*S)}function Un(e,t,n){this.longitude=Je(e,0),this.latitude=Je(t,0),this.height=Je(n,0)}Un.fromRadians=function(e,t,n,r){return n=Je(n,0),Ze(r)?(r.longitude=e,r.latitude=t,r.height=n,r):new Un(e,t,n)},Un.fromDegrees=function(e,t,n,r){return e=pt.toRadians(e),t=pt.toRadians(t),Un.fromRadians(e,t,n,r)};var Vn=new _t,kn=new _t,Gn=new _t;Un.wgs84OneOverRadii=new _t(1/6378137,1/6378137,1/6356752.314245179),Un.wgs84OneOverRadiiSquared=new _t(1/40680631590769,1/40680631590769,1/40408299984661.445);var qn=pt.EPSILON1;function Hn(e,t,n,r){t=Je(t,0),n=Je(n,0),r=Je(r,0),e._radii=new _t(t,n,r),e._radiiSquared=new _t(t*t,n*n,r*r),e._radiiToTheFourth=new _t(t*t*t*t,n*n*n*n,r*r*r*r),e._oneOverRadii=new _t(0===t?0:1/t,0===n?0:1/n,0===r?0:1/r),e._oneOverRadiiSquared=new _t(0===t?0:1/(t*t),0===n?0:1/(n*n),0===r?0:1/(r*r)),e._minimumRadius=Math.min(t,n,r),e._maximumRadius=Math.max(t,n,r),e._centerToleranceSquared=pt.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function Wn(e,t,n){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,Hn(this,e,t,n)}Un.fromCartesian=function(e,t,n){var r=Ze(t)?t.oneOverRadii:this.wgs84OneOverRadii,i=Ze(t)?t.oneOverRadiiSquared:this.wgs84OneOverRadiiSquared,o=Bn(e,r,i,Ze(t)?t._centerToleranceSquared:qn,kn);if(Ze(o)){var a=_t.multiplyComponents(o,i,Vn),a=_t.normalize(a,a),s=_t.subtract(e,o,Gn),u=Math.atan2(a.y,a.x),l=Math.asin(a.z),c=pt.sign(_t.dot(s,e))*_t.magnitude(s);return Ze(n)?(n.longitude=u,n.latitude=l,n.height=c,n):new Un(u,l,c)}},Un.toCartesian=function(e,t,n){return _t.fromRadians(e.longitude,e.latitude,e.height,t,n)},Un.clone=function(e,t){if(Ze(e))return Ze(t)?(t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t):new Un(e.longitude,e.latitude,e.height)},Un.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height},Un.equalsEpsilon=function(e,t,n){return e===t||Ze(e)&&Ze(t)&&Math.abs(e.longitude-t.longitude)<=n&&Math.abs(e.latitude-t.latitude)<=n&&Math.abs(e.height-t.height)<=n},Un.ZERO=Object.freeze(new Un(0,0,0)),Un.prototype.clone=function(e){return Un.clone(this,e)},Un.prototype.equals=function(e){return Un.equals(this,e)},Un.prototype.equalsEpsilon=function(e,t){return Un.equalsEpsilon(this,e,t)},Un.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"},Object.defineProperties(Wn.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),Wn.clone=function(e,t){if(Ze(e)){var n=e._radii;return Ze(t)?(_t.clone(n,t._radii),_t.clone(e._radiiSquared,t._radiiSquared),_t.clone(e._radiiToTheFourth,t._radiiToTheFourth),_t.clone(e._oneOverRadii,t._oneOverRadii),_t.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t):new Wn(n.x,n.y,n.z)}},Wn.fromCartesian3=function(e,t){return Ze(t)||(t=new Wn),Ze(e)&&Hn(t,e.x,e.y,e.z),t},Wn.WGS84=Object.freeze(new Wn(6378137,6378137,6356752.314245179)),Wn.CGCS2000=Object.freeze(new Wn(6378137,6378137,6356752.314140356)),Wn.UNIT_SPHERE=Object.freeze(new Wn(1,1,1)),Wn.MOON=Object.freeze(new Wn(pt.LUNAR_RADIUS,pt.LUNAR_RADIUS,pt.LUNAR_RADIUS)),Wn.prototype.clone=function(e){return Wn.clone(this,e)},Wn.packedLength=_t.packedLength,Wn.pack=function(e,t,n){return n=Je(n,0),_t.pack(e._radii,t,n),t},Wn.unpack=function(e,t,n){t=Je(t,0);var r=_t.unpack(e,t);return Wn.fromCartesian3(r,n)},Wn.prototype.geocentricSurfaceNormal=_t.normalize,Wn.prototype.geodeticSurfaceNormalCartographic=function(e,t){var n=e.longitude,r=e.latitude,i=Math.cos(r),o=i*Math.cos(n),a=i*Math.sin(n),s=Math.sin(r);return Ze(t)||(t=new _t),t.x=o,t.y=a,t.z=s,_t.normalize(t,t)},Wn.prototype.geodeticSurfaceNormal=function(e,t){return Ze(t)||(t=new _t),t=_t.multiplyComponents(e,this._oneOverRadiiSquared,t),_t.normalize(t,t)};var Yn=new _t,Xn=new _t;Wn.prototype.cartographicToCartesian=function(e,t){var n=Yn,r=Xn;this.geodeticSurfaceNormalCartographic(e,n),_t.multiplyComponents(this._radiiSquared,n,r);var i=Math.sqrt(_t.dot(n,r));return _t.divideByScalar(r,i,r),_t.multiplyByScalar(n,e.height,n),Ze(t)||(t=new _t),_t.add(r,n,t)},Wn.prototype.cartographicArrayToCartesianArray=function(e,t){var n=e.length;Ze(t)?t.length=n:t=new Array(n);for(var r=0;r<n;r++)t[r]=this.cartographicToCartesian(e[r],t[r]);return t};var jn=new _t,Kn=new _t,Qn=new _t;function Zn(e){this._ellipsoid=Je(e,Wn.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}Wn.prototype.cartesianToCartographic=function(e,t){var n=this.scaleToGeodeticSurface(e,Kn);if(Ze(n)){var r=this.geodeticSurfaceNormal(n,jn),i=_t.subtract(e,n,Qn),o=Math.atan2(r.y,r.x),a=Math.asin(r.z),s=pt.sign(_t.dot(i,e))*_t.magnitude(i);return Ze(t)?(t.longitude=o,t.latitude=a,t.height=s,t):new Un(o,a,s)}},Wn.prototype.cartesianArrayToCartographicArray=function(e,t){var n=e.length;Ze(t)?t.length=n:t=new Array(n);for(var r=0;r<n;++r)t[r]=this.cartesianToCartographic(e[r],t[r]);return t},Wn.prototype.scaleToGeodeticSurface=function(e,t){return Bn(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},Wn.prototype.scaleToGeocentricSurface=function(e,t){Ze(t)||(t=new _t);var n=e.x,r=e.y,i=e.z,o=this._oneOverRadiiSquared,a=1/Math.sqrt(n*n*o.x+r*r*o.y+i*i*o.z);return _t.multiplyByScalar(e,a,t)},Wn.prototype.transformPositionToScaledSpace=function(e,t){return Ze(t)||(t=new _t),_t.multiplyComponents(e,this._oneOverRadii,t)},Wn.prototype.transformPositionFromScaledSpace=function(e,t){return Ze(t)||(t=new _t),_t.multiplyComponents(e,this._radii,t)},Wn.prototype.equals=function(e){return this===e||Ze(e)&&_t.equals(this._radii,e._radii)},Wn.prototype.toString=function(){return this._radii.toString()},Wn.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,t,n){t=Je(t,0);var r=this._squaredXOverSquaredZ;if(Ze(n)||(n=new _t),n.x=0,n.y=0,n.z=e.z*(1-r),!(Math.abs(n.z)>=this._radii.z-t))return n},Object.defineProperties(Zn.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Zn.prototype.project=function(e,t){var n=this._semimajorAxis,r=e.longitude*n,i=e.latitude*n,o=e.height;return Ze(t)?(t.x=r,t.y=i,t.z=o,t):new _t(r,i,o)},Zn.prototype.unproject=function(e,t){var n=this._oneOverSemimajorAxis,r=e.x*n,i=e.y*n,o=e.z;return Ze(t)?(t.longitude=r,t.latitude=i,t.height=o,t):new Un(r,i,o)};var Jn=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function $n(e,t,n,r){this.west=Je(e,0),this.south=Je(t,0),this.east=Je(n,0),this.north=Je(r,0)}Object.defineProperties($n.prototype,{width:{get:function(){return $n.computeWidth(this)}},height:{get:function(){return $n.computeHeight(this)}}}),$n.packedLength=4,$n.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.west,t[n++]=e.south,t[n++]=e.east,t[n]=e.north,t},$n.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new $n),n.west=e[t++],n.south=e[t++],n.east=e[t++],n.north=e[t],n},$n.computeWidth=function(e){var t=e.east,n=e.west;return t<n&&(t+=pt.TWO_PI),t-n},$n.computeHeight=function(e){return e.north-e.south},$n.fromDegrees=function(e,t,n,r,i){return e=pt.toRadians(Je(e,0)),t=pt.toRadians(Je(t,0)),n=pt.toRadians(Je(n,0)),r=pt.toRadians(Je(r,0)),Ze(i)?(i.west=e,i.south=t,i.east=n,i.north=r,i):new $n(e,t,n,r)},$n.fromRadians=function(e,t,n,r,i){return Ze(i)?(i.west=Je(e,0),i.south=Je(t,0),i.east=Je(n,0),i.north=Je(r,0),i):new $n(e,t,n,r)},$n.fromCartographicArray=function(e,t){for(var n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=Number.MAX_VALUE,s=-Number.MAX_VALUE,u=0,l=e.length;u<l;u++)var c=e[u],n=Math.min(n,c.longitude),r=Math.max(r,c.longitude),a=Math.min(a,c.latitude),s=Math.max(s,c.latitude),h=0<=c.longitude?c.longitude:c.longitude+pt.TWO_PI,i=Math.min(i,h),o=Math.max(o,h);return o-i<r-n&&(n=i,(r=o)>pt.PI&&(r-=pt.TWO_PI),n>pt.PI&&(n-=pt.TWO_PI)),Ze(t)?(t.west=n,t.south=a,t.east=r,t.north=s,t):new $n(n,a,r,s)},$n.fromCartesianArray=function(e,t,n){t=Je(t,Wn.WGS84);for(var r=Number.MAX_VALUE,i=-Number.MAX_VALUE,o=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=Number.MAX_VALUE,u=-Number.MAX_VALUE,l=0,c=e.length;l<c;l++)var h=t.cartesianToCartographic(e[l]),r=Math.min(r,h.longitude),i=Math.max(i,h.longitude),s=Math.min(s,h.latitude),u=Math.max(u,h.latitude),f=0<=h.longitude?h.longitude:h.longitude+pt.TWO_PI,o=Math.min(o,f),a=Math.max(a,f);return a-o<i-r&&(r=o,(i=a)>pt.PI&&(i-=pt.TWO_PI),r>pt.PI&&(r-=pt.TWO_PI)),Ze(n)?(n.west=r,n.south=s,n.east=i,n.north=u,n):new $n(r,s,i,u)},$n.clone=function(e,t){if(Ze(e))return Ze(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new $n(e.west,e.south,e.east,e.north)},$n.equalsEpsilon=function(e,t,n){return e===t||Ze(e)&&Ze(t)&&Math.abs(e.west-t.west)<=n&&Math.abs(e.south-t.south)<=n&&Math.abs(e.east-t.east)<=n&&Math.abs(e.north-t.north)<=n},$n.prototype.clone=function(e){return $n.clone(this,e)},$n.prototype.equals=function(e){return $n.equals(this,e)},$n.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north},$n.prototype.equalsEpsilon=function(e,t){return $n.equalsEpsilon(this,e,t)},$n.validate=function(e){},$n.southwest=function(e,t){return Ze(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new Un(e.west,e.south)},$n.northwest=function(e,t){return Ze(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new Un(e.west,e.north)},$n.northeast=function(e,t){return Ze(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new Un(e.east,e.north)},$n.southeast=function(e,t){return Ze(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new Un(e.east,e.south)},$n.center=function(e,t){var n=e.east,r=e.west;n<r&&(n+=pt.TWO_PI);var i=pt.negativePiToPi(.5*(r+n)),o=.5*(e.south+e.north);return Ze(t)?(t.longitude=i,t.latitude=o,t.height=0,t):new Un(i,o)},$n.intersection=function(e,t,n){var r=e.east,i=e.west,o=t.east,a=t.west;r<i&&0<o?r+=pt.TWO_PI:o<a&&0<r&&(o+=pt.TWO_PI),r<i&&a<0?a+=pt.TWO_PI:o<a&&i<0&&(i+=pt.TWO_PI);var s=pt.negativePiToPi(Math.max(i,a)),u=pt.negativePiToPi(Math.min(r,o));if(!((e.west<e.east||t.west<t.east)&&u<=s)){var l=Math.max(e.south,t.south),c=Math.min(e.north,t.north);if(!(c<=l))return Ze(n)?(n.west=s,n.south=l,n.east=u,n.north=c,n):new $n(s,l,u,c)}},$n.simpleIntersection=function(e,t,n){var r=Math.max(e.west,t.west),i=Math.max(e.south,t.south),o=Math.min(e.east,t.east),a=Math.min(e.north,t.north);if(!(a<=i||o<=r))return Ze(n)?(n.west=r,n.south=i,n.east=o,n.north=a,n):new $n(r,i,o,a)},$n.union=function(e,t,n){Ze(n)||(n=new $n);var r=e.east,i=e.west,o=t.east,a=t.west;r<i&&0<o?r+=pt.TWO_PI:o<a&&0<r&&(o+=pt.TWO_PI),r<i&&a<0?a+=pt.TWO_PI:o<a&&i<0&&(i+=pt.TWO_PI);var s=pt.convertLongitudeRange(Math.min(i,a)),u=pt.convertLongitudeRange(Math.max(r,o));return n.west=s,n.south=Math.min(e.south,t.south),n.east=u,n.north=Math.max(e.north,t.north),n},$n.expand=function(e,t,n){return Ze(n)||(n=new $n),n.west=Math.min(e.west,t.longitude),n.south=Math.min(e.south,t.latitude),n.east=Math.max(e.east,t.longitude),n.north=Math.max(e.north,t.latitude),n},$n.contains=function(e,t){var n=t.longitude,r=t.latitude,i=e.west,o=e.east;return o<i&&(o+=pt.TWO_PI,n<0&&(n+=pt.TWO_PI)),(i<n||pt.equalsEpsilon(n,i,pt.EPSILON14))&&(n<o||pt.equalsEpsilon(n,o,pt.EPSILON14))&&r>=e.south&&r<=e.north};var er=new Un;function tr(e,t,n,r){this.x=Je(e,0),this.y=Je(t,0),this.width=Je(n,0),this.height=Je(r,0)}$n.subsample=function(e,t,n,r){t=Je(t,Wn.WGS84),n=Je(n,0),Ze(r)||(r=[]);var i=0,o=e.north,a=e.south,s=e.east,u=e.west,l=er;l.height=n,l.longitude=u,l.latitude=o,r[i]=t.cartographicToCartesian(l,r[i]),i++,l.longitude=s,r[i]=t.cartographicToCartesian(l,r[i]),i++,l.latitude=a,r[i]=t.cartographicToCartesian(l,r[i]),i++,l.longitude=u,r[i]=t.cartographicToCartesian(l,r[i]),i++,l.latitude=o<0?o:0<a?a:0;for(var c=1;c<8;++c)l.longitude=-Math.PI+c*pt.PI_OVER_TWO,$n.contains(e,l)&&(r[i]=t.cartographicToCartesian(l,r[i]),i++);return 0===l.latitude&&(l.longitude=u,r[i]=t.cartographicToCartesian(l,r[i]),i++,l.longitude=s,r[i]=t.cartographicToCartesian(l,r[i]),i++),r.length=i,r},$n.MAX_VALUE=Object.freeze(new $n(-Math.PI,-pt.PI_OVER_TWO,Math.PI,pt.PI_OVER_TWO)),$n.MERCATOR_MAX_VALUE=Object.freeze(new $n(-Math.PI,pt.toRadians(-85),Math.PI,pt.toRadians(85))),tr.packedLength=4,tr.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.width,t[n]=e.height,t},tr.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new tr),n.x=e[t++],n.y=e[t++],n.width=e[t++],n.height=e[t],n},tr.fromPoints=function(e,t){if(Ze(t)||(t=new tr),!Ze(e)||0===e.length)return t.x=0,t.y=0,t.width=0,t.height=0,t;for(var n=e.length,r=e[0].x,i=e[0].y,o=e[0].x,a=e[0].y,s=1;s<n;s++)var u=e[s],l=u.x,c=u.y,r=Math.min(l,r),o=Math.max(l,o),i=Math.min(c,i),a=Math.max(c,a);return t.x=r,t.y=i,t.width=o-r,t.height=a-i,t};var nr=new Zn,rr=new Un,ir=new Un;tr.fromRectangle=function(e,t,n){if(Ze(n)||(n=new tr),!Ze(e))return n.x=0,n.y=0,n.width=0,n.height=0,n;var r=(t=Je(t,nr)).project($n.southwest(e,rr)),i=t.project($n.northeast(e,ir));return En.subtract(i,r,i),n.x=r.x,n.y=r.y,n.width=i.x,n.height=i.y,n},tr.clone=function(e,t){if(Ze(e))return Ze(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new tr(e.x,e.y,e.width,e.height)},tr.union=function(e,t,n){Ze(n)||(n=new tr);var r=Math.min(e.x,t.x),i=Math.min(e.y,t.y),o=Math.max(e.x+e.width,t.x+t.width),a=Math.max(e.y+e.height,t.y+t.height);return n.x=r,n.y=i,n.width=o-r,n.height=a-i,n},tr.expand=function(e,t,n){n=tr.clone(e,n);var r=t.x-n.x,i=t.y-n.y;return r>n.width?n.width=r:r<0&&(n.width-=r,n.x=t.x),i>n.height?n.height=i:i<0&&(n.height-=i,n.y=t.y),n},tr.intersect=function(e,t){var n=e.x,r=e.y,i=t.x,o=t.y;return n>i+t.width||n+e.width<i||r+e.height<o||r>o+t.height?Jn.OUTSIDE:Jn.INTERSECTING},tr.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},tr.prototype.clone=function(e){return tr.clone(this,e)},tr.prototype.intersect=function(e){return tr.intersect(this,e)},tr.prototype.equals=function(e){return tr.equals(this,e)};var or={CLOCKWISE:Rt.CW,COUNTER_CLOCKWISE:Rt.CCW,validate:function(e){return e===or.CLOCKWISE||e===or.COUNTER_CLOCKWISE}},ar=Object.freeze(or);function sr(e){var t=Je(e,Je.EMPTY_OBJECT),n=Je(t.cull,Je.EMPTY_OBJECT),r=Je(t.polygonOffset,Je.EMPTY_OBJECT),i=Je(t.scissorTest,Je.EMPTY_OBJECT),o=Je(i.rectangle,Je.EMPTY_OBJECT),a=Je(t.depthRange,Je.EMPTY_OBJECT),s=Je(t.depthTest,Je.EMPTY_OBJECT),u=Je(t.colorMask,Je.EMPTY_OBJECT),l=Je(t.blending,Je.EMPTY_OBJECT),c=Je(l.color,Je.EMPTY_OBJECT),h=Je(t.stencilTest,Je.EMPTY_OBJECT),f=Je(h.frontOperation,Je.EMPTY_OBJECT),p=Je(h.backOperation,Je.EMPTY_OBJECT),d=Je(t.sampleCoverage,Je.EMPTY_OBJECT),m=t.viewport;this.frontFace=Je(t.frontFace,ar.COUNTER_CLOCKWISE),this.cull={enabled:Je(n.enabled,!1),face:Je(n.face,Rt.BACK)},this.lineWidth=Je(t.lineWidth,1),this.polygonOffset={enabled:Je(r.enabled,!1),factor:Je(r.factor,0),units:Je(r.units,0)},this.scissorTest={enabled:Je(i.enabled,!1),rectangle:tr.clone(o)},this.depthRange={near:Je(a.near,0),far:Je(a.far,1)},this.depthTest={enabled:Je(s.enabled,!1),func:Je(s.func,Rt.LESS)},this.colorMask={red:Je(u.red,!0),green:Je(u.green,!0),blue:Je(u.blue,!0),alpha:Je(u.alpha,!0)},this.depthMask=Je(t.depthMask,!0),this.stencilMask=Je(t.stencilMask,-1),this.blending={enabled:Je(l.enabled,!1),color:new It(Je(c.red,0),Je(c.green,0),Je(c.blue,0),Je(c.alpha,0)),equationRgb:Je(l.equationRgb,Rt.FUNC_ADD),equationAlpha:Je(l.equationAlpha,Rt.FUNC_ADD),functionSourceRgb:Je(l.functionSourceRgb,Rt.ONE),functionSourceAlpha:Je(l.functionSourceAlpha,Rt.ONE),functionDestinationRgb:Je(l.functionDestinationRgb,Rt.ZERO),functionDestinationAlpha:Je(l.functionDestinationAlpha,Rt.ZERO)},this.stencilTest={enabled:Je(h.enabled,!1),frontFunction:Je(h.frontFunction,Rt.ALWAYS),backFunction:Je(h.backFunction,Rt.ALWAYS),reference:Je(h.reference,0),mask:Je(h.mask,-1),frontOperation:{fail:Je(f.fail,Rt.KEEP),zFail:Je(f.zFail,Rt.KEEP),zPass:Je(f.zPass,Rt.KEEP)},backOperation:{fail:Je(p.fail,Rt.KEEP),zFail:Je(p.zFail,Rt.KEEP),zPass:Je(p.zPass,Rt.KEEP)}},this.sampleCoverage={enabled:Je(d.enabled,!1),value:Je(d.value,1),invert:Je(d.invert,!1)},this.viewport=Ze(m)?new tr(m.x,m.y,m.width,m.height):void 0,this.id=0,this._applyFunctions=[]}var ur=0,lr={};function cr(e,t,n){n?e.enable(t):e.disable(t)}function hr(e,t){e.frontFace(t.frontFace)}function fr(e,t){var n=t.cull,r=n.enabled;cr(e,e.CULL_FACE,r),r&&e.cullFace(n.face)}function pr(e,t){e.lineWidth(t.lineWidth)}function dr(e,t){var n=t.polygonOffset,r=n.enabled;cr(e,e.POLYGON_OFFSET_FILL,r),r&&e.polygonOffset(n.factor,n.units)}function mr(e,t,n){var r,i=t.scissorTest,o=Ze(n.scissorTest)?n.scissorTest.enabled:i.enabled;cr(e,e.SCISSOR_TEST,o),o&&(r=Ze(n.scissorTest)?n.scissorTest.rectangle:i.rectangle,e.scissor(r.x,r.y,r.width,r.height))}function _r(e,t){var n=t.depthRange;e.depthRange(n.near,n.far)}function gr(e,t){var n=t.depthTest,r=n.enabled;cr(e,e.DEPTH_TEST,r),r&&e.depthFunc(n.func)}function yr(e,t){var n=t.colorMask;e.colorMask(n.red,n.green,n.blue,n.alpha)}function vr(e,t){e.depthMask(t.depthMask)}function xr(e,t){e.stencilMask(t.stencilMask)}function br(e,t,n){var r,i,o=t.blending,a=Ze(n.blendingEnabled)?n.blendingEnabled:o.enabled;cr(e,e.BLEND,a),a&&(r=e,i=o.color,r.blendColor(i.red,i.green,i.blue,i.alpha),e.blendEquationSeparate(o.equationRgb,o.equationAlpha),e.blendFuncSeparate(o.functionSourceRgb,o.functionDestinationRgb,o.functionSourceAlpha,o.functionDestinationAlpha))}function Er(e,t){var n,r,i,o,a,s,u,l,c,h,f,p,d=t.stencilTest,m=d.enabled;cr(e,e.STENCIL_TEST,m),m&&(n=d.frontFunction,r=d.backFunction,i=d.reference,o=d.mask,e.stencilFunc(n,i,o),e.stencilFuncSeparate(e.BACK,r,i,o),e.stencilFuncSeparate(e.FRONT,n,i,o),s=(a=d.frontOperation).fail,u=a.zFail,l=a.zPass,e.stencilOpSeparate(e.FRONT,s,u,l),h=(c=d.backOperation).fail,f=c.zFail,p=c.zPass,e.stencilOpSeparate(e.BACK,h,f,p))}function Tr(e,t){var n=t.sampleCoverage,r=n.enabled;cr(e,e.SAMPLE_COVERAGE,r),r&&e.sampleCoverage(n.value,n.invert)}sr.fromCache=function(e){var t=JSON.stringify(e),n=lr[t];if(Ze(n))return++n.referenceCount,n.state;var r=new sr(e),i=JSON.stringify(r);return Ze(n=lr[i])||(r.id=ur++,n={referenceCount:0,state:r},lr[i]=n),++n.referenceCount,lr[t]={referenceCount:1,state:n.state},n.state},sr.removeFromCache=function(e){var t=new sr(e),n=JSON.stringify(t),r=lr[n],i=JSON.stringify(e),o=lr[i];Ze(o)&&(--o.referenceCount,0===o.referenceCount&&(delete lr[i],Ze(r)&&--r.referenceCount)),Ze(r)&&0===r.referenceCount&&delete lr[n]},sr.getCache=function(){return lr},sr.clearCache=function(){lr={}};var Sr=new tr;function Cr(e,t,n){var r=Je(t.viewport,n.viewport);Ze(r)||((r=Sr).width=n.context.drawingBufferWidth,r.height=n.context.drawingBufferHeight),n.context.uniformState.viewport=r,e.viewport(r.x,r.y,r.width,r.height)}sr.apply=function(e,t,n){hr(e,t),fr(e,t),pr(e,t),dr(e,t),_r(e,t),gr(e,t),yr(e,t),vr(e,t),xr(e,t),Er(e,t),Tr(e,t),mr(e,t,n),br(e,t,n),Cr(e,t,n)},sr.partialApply=function(e,t,n,r,i,o){if(t!==n){var a=n._applyFunctions[t.id];Ze(a)||(c=n,h=[],(l=t).frontFace!==c.frontFace&&h.push(hr),l.cull.enabled===c.cull.enabled&&l.cull.face===c.cull.face||h.push(fr),l.lineWidth!==c.lineWidth&&h.push(pr),l.polygonOffset.enabled===c.polygonOffset.enabled&&l.polygonOffset.factor===c.polygonOffset.factor&&l.polygonOffset.units===c.polygonOffset.units||h.push(dr),l.depthRange.near===c.depthRange.near&&l.depthRange.far===c.depthRange.far||h.push(_r),l.depthTest.enabled===c.depthTest.enabled&&l.depthTest.func===c.depthTest.func||h.push(gr),l.colorMask.red===c.colorMask.red&&l.colorMask.green===c.colorMask.green&&l.colorMask.blue===c.colorMask.blue&&l.colorMask.alpha===c.colorMask.alpha||h.push(yr),l.depthMask!==c.depthMask&&h.push(vr),l.stencilMask!==c.stencilMask&&h.push(xr),l.stencilTest.enabled===c.stencilTest.enabled&&l.stencilTest.frontFunction===c.stencilTest.frontFunction&&l.stencilTest.backFunction===c.stencilTest.backFunction&&l.stencilTest.reference===c.stencilTest.reference&&l.stencilTest.mask===c.stencilTest.mask&&l.stencilTest.frontOperation.fail===c.stencilTest.frontOperation.fail&&l.stencilTest.frontOperation.zFail===c.stencilTest.frontOperation.zFail&&l.stencilTest.backOperation.fail===c.stencilTest.backOperation.fail&&l.stencilTest.backOperation.zFail===c.stencilTest.backOperation.zFail&&l.stencilTest.backOperation.zPass===c.stencilTest.backOperation.zPass||h.push(Er),l.sampleCoverage.enabled===c.sampleCoverage.enabled&&l.sampleCoverage.value===c.sampleCoverage.value&&l.sampleCoverage.invert===c.sampleCoverage.invert||h.push(Tr),a=h,n._applyFunctions[t.id]=a);for(var s=a.length,u=0;u<s;++u)a[u](e,n)}var l,c,h;(Ze(r.scissorTest)?r.scissorTest:t.scissorTest)===(Ze(i.scissorTest)?i.scissorTest:n.scissorTest)&&!o||mr(e,n,i);var f=Ze(r.blendingEnabled)?r.blendingEnabled:t.blending.enabled,p=Ze(i.blendingEnabled)?i.blendingEnabled:n.blending.enabled;(f!==p||p&&t.blending!==n.blending)&&br(e,n,i),t===n&&r===i&&r.context===i.context||Cr(e,n,i)},sr.getState=function(e){return{frontFace:e.frontFace,cull:{enabled:e.cull.enabled,face:e.cull.face},lineWidth:e.lineWidth,polygonOffset:{enabled:e.polygonOffset.enabled,factor:e.polygonOffset.factor,units:e.polygonOffset.units},scissorTest:{enabled:e.scissorTest.enabled,rectangle:tr.clone(e.scissorTest.rectangle)},depthRange:{near:e.depthRange.near,far:e.depthRange.far},depthTest:{enabled:e.depthTest.enabled,func:e.depthTest.func},colorMask:{red:e.colorMask.red,green:e.colorMask.green,blue:e.colorMask.blue,alpha:e.colorMask.alpha},depthMask:e.depthMask,stencilMask:e.stencilMask,blending:{enabled:e.blending.enabled,color:It.clone(e.blending.color),equationRgb:e.blending.equationRgb,equationAlpha:e.blending.equationAlpha,functionSourceRgb:e.blending.functionSourceRgb,functionSourceAlpha:e.blending.functionSourceAlpha,functionDestinationRgb:e.blending.functionDestinationRgb,functionDestinationAlpha:e.blending.functionDestinationAlpha},stencilTest:{enabled:e.stencilTest.enabled,frontFunction:e.stencilTest.frontFunction,backFunction:e.stencilTest.backFunction,reference:e.stencilTest.reference,mask:e.stencilTest.mask,frontOperation:{fail:e.stencilTest.frontOperation.fail,zFail:e.stencilTest.frontOperation.zFail,zPass:e.stencilTest.frontOperation.zPass},backOperation:{fail:e.stencilTest.backOperation.fail,zFail:e.stencilTest.backOperation.zFail,zPass:e.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:e.sampleCoverage.enabled,value:e.sampleCoverage.value,invert:e.sampleCoverage.invert},viewport:Ze(e.viewport)?tr.clone(e.viewport):void 0}};var wr={NEAREST:Rt.NEAREST,LINEAR:Rt.LINEAR,validate:function(e){return e===wr.NEAREST||e===wr.LINEAR}},Ar=Object.freeze(wr),Ir={NEAREST:Rt.NEAREST,LINEAR:Rt.LINEAR,NEAREST_MIPMAP_NEAREST:Rt.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:Rt.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:Rt.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:Rt.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===Ir.NEAREST||e===Ir.LINEAR||e===Ir.NEAREST_MIPMAP_NEAREST||e===Ir.LINEAR_MIPMAP_NEAREST||e===Ir.NEAREST_MIPMAP_LINEAR||e===Ir.LINEAR_MIPMAP_LINEAR}},Pr=Object.freeze(Ir),Or={CLAMP_TO_EDGE:Rt.CLAMP_TO_EDGE,REPEAT:Rt.REPEAT,MIRRORED_REPEAT:Rt.MIRRORED_REPEAT,validate:function(e){return e===Or.CLAMP_TO_EDGE||e===Or.REPEAT||e===Or.MIRRORED_REPEAT}},Lr=Object.freeze(Or);function Nr(e){e=Je(e,Je.EMPTY_OBJECT);var t=Je(e.wrapS,Lr.CLAMP_TO_EDGE),n=Je(e.wrapT,Lr.CLAMP_TO_EDGE),r=Je(e.minificationFilter,Pr.LINEAR),i=Je(e.magnificationFilter,Ar.LINEAR),o=Ze(e.maximumAnisotropy)?e.maximumAnisotropy:1;this._wrapS=t,this._wrapT=n,this._minificationFilter=r,this._magnificationFilter=i,this._maximumAnisotropy=o}function Rr(e,t){var n=/#define OUTPUT_DECLARATION/,r=e.split("\n");if(/#version 300 es/g.test(e))return e;for(var i,o=-1,a=0;a<r.length;++a)if(i=r[a],n.test(i)){o=a;break}if(-1===o)throw new fe("Could not find a #define OUTPUT_DECLARATION!");var s=[];for(a=0;a<10;a++){var u="gl_FragData\\["+a+"\\]",l="czm_out"+a;new RegExp(u,"g").test(e)&&(Mr(l,s),Dr(u,l,r),r.splice(o,0,"layout(location = "+a+") out vec4 "+l+";"),o+=1)}var c="czm_fragColor";!function(e,t){for(var n=new RegExp("(^|[^\\w])("+e+")($|[^\\w])","g"),r=t.length,i=0;i<r;++i){var o=t[i];if(n.test(o))return 1}return}("gl_FragColor",r)||(Mr(c,s),Dr("gl_FragColor",c,r),r.splice(o,0,"layout(location = 0) out vec4 czm_fragColor;"),o+=1);var h=function(e,t){for(var n={},r=e.length,i=[],o=0;o<t.length;++o){var a=t[o],s=/(#ifdef|#if)/g.test(a),u=/#else/g.test(a),l=/#endif/g.test(a);if(s)i.push(a);else if(u){var c=i[i.length-1].replace("ifdef","ifndef");/if/g.test(c)&&(c=c.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),i.pop(),i.push(c)}else if(l)i.pop();else if(!/layout/g.test(a))for(var h=0;h<r;++h){var f=e[h];-1!==a.indexOf(f)&&(Ze(n[f])?n[f]=n[f].filter(function(e){return 0<=i.indexOf(e)}):n[f]=i.slice())}}return n}(s,r),f={};for(a=0;a<r.length;a++)for(var p in i=r[a],h){h.hasOwnProperty(p)&&new RegExp("(layout)[^]+(out)[^]+("+p+")[^]+","g").test(i)&&(f[i]=p)}for(var d in f)if(f.hasOwnProperty(d)){for(var m=f[d],_=r.indexOf(d),g=h[m],y=g.length,v=0;v<y;v++)r.splice(_,0,g[v]);for(_+=y+1,v=y-1;0<=v;v--)r.splice(_,0,"#endif //"+g[v])}var x="#version 300 es",b=!1;for(a=0;a<r.length;a++)/#version/.test(r[a])&&(r[a]=x,b=!0);return b||r.splice(0,0,x),Fr("EXT_draw_buffers",r),Fr("EXT_frag_depth",r),Fr("OES_standard_derivatives",r),Fr("EXT_shader_texture_lod",r),Dr("texture2DLodEXT","textureLod",r),Dr("texture2D","texture",r),Dr("texture3D","texture",r),Dr("textureCube","texture",r),Dr("gl_FragDepthEXT","gl_FragDepth",r),t?Dr("varying","in",r):(Dr("attribute","in",r),Dr("varying","out",r)),function(e){for(var t="",n=e.length,r=0;r<n;++r)t+=e[r]+"\n";return t}(r)}function Dr(e,t,n){for(var r=new RegExp("(^|[^\\w])("+e+")($|[^\\w])","g"),i=n.length,o=0;o<i;++o){var a=n[o];n[o]=a.replace(r,"$1"+t+"$3")}}function Mr(e,t){-1===t.indexOf(e)&&t.push(e)}function Fr(e,t){!function(e,t,n){for(var r=n.length,i=0;i<r;++i){var o=n[i];n[i]=o.replace(e,t)}}(new RegExp("#extension\\s+GL_"+e+"\\s+:\\s+[a-zA-Z0-9]+\\s*$","g"),"",t)}Object.defineProperties(Nr.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}}),Nr.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy},Nr.NEAREST=Object.freeze(new Nr({wrapS:Lr.CLAMP_TO_EDGE,wrapT:Lr.CLAMP_TO_EDGE,minificationFilter:Pr.NEAREST,magnificationFilter:Ar.NEAREST}));var zr={czm_degreesPerRadian:"const float czm_degreesPerRadian = 57.29577951308232;\n",czm_depthRange:"const czm_depthRangeStruct czm_depthRange = czm_depthRangeStruct(0.0, 1.0);\n",czm_epsilon1:"const float czm_epsilon1 = 0.1;\n",czm_epsilon2:"const float czm_epsilon2 = 0.01;\n",czm_epsilon3:"const float czm_epsilon3 = 0.001;\n",czm_epsilon4:"const float czm_epsilon4 = 0.0001;\n",czm_epsilon5:"const float czm_epsilon5 = 0.00001;\n",czm_epsilon6:"const float czm_epsilon6 = 0.000001;\n",czm_epsilon7:"const float czm_epsilon7 = 0.0000001;\n",czm_infinity:"const float czm_infinity = 5906376272000.0;\n",czm_oneOverPi:"const float czm_oneOverPi = 0.3183098861837907;\n",czm_oneOverTwoPi:"const float czm_oneOverTwoPi = 0.15915494309189535;\n",czm_passCesium3DTile:"const float czm_passCesium3DTile = 4.0;\n",czm_passCesium3DTileClassification:"const float czm_passCesium3DTileClassification = 5.0;\n",czm_passCesium3DTileClassificationIgnoreShow:"const float czm_passCesium3DTileClassificationIgnoreShow = 6.0;\n",czm_passClassification:"const float czm_passClassification = 7.0;\n",czm_passCompute:"const float czm_passCompute = 1.0;\n",czm_passEnvironment:"const float czm_passEnvironment = 0.0;\n",czm_passGlobe:"const float czm_passGlobe = 2.0;\n",czm_passOpaque:"const float czm_passOpaque = 7.0;\n",czm_passOverlay:"const float czm_passOverlay = 9.0;\n",czm_passTerrainClassification:"const float czm_passTerrainClassification = 3.0;\n",czm_passTranslucent:"const float czm_passTranslucent = 8.0;\n",czm_pi:"const float czm_pi = 3.141592653589793;\n",czm_piOverFour:"const float czm_piOverFour = 0.7853981633974483;\n",czm_piOverSix:"const float czm_piOverSix = 0.5235987755982988;\n",czm_piOverThree:"const float czm_piOverThree = 1.0471975511965976;\n",czm_piOverTwo:"const float czm_piOverTwo = 1.5707963267948966;\n",czm_radiansPerDegree:"const float czm_radiansPerDegree = 0.017453292519943295;\n",czm_sceneMode2D:"const float czm_sceneMode2D = 2.0;\n",czm_sceneMode3D:"const float czm_sceneMode3D = 3.0;\n",czm_sceneModeColumbusView:"const float czm_sceneModeColumbusView = 1.0;\n",czm_sceneModeMorphing:"const float czm_sceneModeMorphing = 0.0;\n",czm_solarRadius:"const float czm_solarRadius = 695500000.0;\n",czm_threePiOver2:"const float czm_threePiOver2 = 4.71238898038469;\n",czm_twoPi:"const float czm_twoPi = 6.283185307179586;\n",czm_webMercatorMaxLatitude:"const float czm_webMercatorMaxLatitude = 1.4844222297453324;\n",czm_depthRangeStruct:"struct czm_depthRangeStruct\n{\nfloat near;\nfloat far;\n};\n",czm_material:"struct czm_material\n{\nvec3 diffuse;\nfloat specular;\nfloat shininess;\nvec3 normal;\nvec3 emission;\nfloat alpha;\n};\n",czm_materialInput:"struct czm_materialInput\n{\nfloat s;\nvec2 st;\nvec3 str;\nvec3 normalEC;\nmat3 tangentToEyeMatrix;\nvec3 positionToEyeEC;\nfloat height;\nfloat slope;\nfloat aspect;\n};\n",czm_ray:"struct czm_ray\n{\nvec3 origin;\nvec3 direction;\n};\n",czm_raySegment:"struct czm_raySegment\n{\nfloat start;\nfloat stop;\n};\nconst czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);\nconst czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);\n",czm_shadowParameters:"struct czm_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\nvec3 texCoords;\n#else\nvec2 texCoords;\n#endif\nfloat depthBias;\nfloat depth;\nfloat nDotL;\nvec2 texelStepSize;\nfloat normalShadingSmooth;\nfloat darkness;\n};\n",czm_acesTonemapping:"vec3 czm_acesTonemapping(vec3 color) {\nfloat g = 0.985;\nfloat a = 0.065;\nfloat b = 0.0001;\nfloat c = 0.433;\nfloat d = 0.238;\ncolor = (color * (color + a) - b) / (color * (g * color + c) + d);\ncolor = clamp(color, 0.0, 1.0);\nreturn color;\n}\n",czm_alphaWeight:"float czm_alphaWeight(float a)\n{\nfloat z = (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nreturn pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));\n}\n",czm_antialias:"vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)\n{\nfloat val1 = clamp(dist / fuzzFactor, 0.0, 1.0);\nfloat val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);\nval1 = val1 * (1.0 - val2);\nval1 = val1 * val1 * (3.0 - (2.0 * val1));\nval1 = pow(val1, 0.5);\nvec4 midColor = (color1 + color2) * 0.5;\nreturn mix(midColor, currentColor, val1);\n}\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)\n{\nreturn czm_antialias(color1, color2, currentColor, dist, 0.1);\n}\n",czm_approximateSphericalCoordinates:"vec2 czm_approximateSphericalCoordinates(vec3 normal) {\nfloat latitudeApproximation = czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);\nfloat longitudeApproximation = czm_fastApproximateAtan(normal.x, normal.y);\nreturn vec2(latitudeApproximation, longitudeApproximation);\n}\n",czm_backFacing:"bool czm_backFacing()\n{\nreturn gl_FrontFacing == false;\n}\n",czm_branchFreeTernary:"float czm_branchFreeTernary(bool comparison, float a, float b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\n",czm_cascadeColor:"vec4 czm_cascadeColor(vec4 weights)\n{\nreturn vec4(1.0, 0.0, 0.0, 1.0) * weights.x +\nvec4(0.0, 1.0, 0.0, 1.0) * weights.y +\nvec4(0.0, 0.0, 1.0, 1.0) * weights.z +\nvec4(1.0, 0.0, 1.0, 1.0) * weights.w;\n}\n",czm_cascadeDistance:"uniform vec4 shadowMap_cascadeDistances;\nfloat czm_cascadeDistance(vec4 weights)\n{\nreturn dot(shadowMap_cascadeDistances, weights);\n}\n",czm_cascadeMatrix:"uniform mat4 shadowMap_cascadeMatrices[4];\nmat4 czm_cascadeMatrix(vec4 weights)\n{\nreturn shadowMap_cascadeMatrices[0] * weights.x +\nshadowMap_cascadeMatrices[1] * weights.y +\nshadowMap_cascadeMatrices[2] * weights.z +\nshadowMap_cascadeMatrices[3] * weights.w;\n}\n",czm_cascadeWeights:"uniform vec4 shadowMap_cascadeSplits[2];\nvec4 czm_cascadeWeights(float depthEye)\n{\nvec4 near = step(shadowMap_cascadeSplits[0], vec4(depthEye));\nvec4 far = step(depthEye, shadowMap_cascadeSplits[1]);\nreturn near * far;\n}\n",czm_columbusViewMorph:"vec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)\n{\nvec3 p = mix(position2D.xyz, position3D.xyz, time);\nreturn vec4(p, 1.0);\n}\n",czm_computePosition:"vec4 czm_computePosition();\n",czm_cosineAndSine:"vec2 cordic(float angle)\n{\nvec2 vector = vec2(6.0725293500888267e-1, 0.0);\nfloat sense = (angle < 0.0) ? -1.0 : 1.0;\nmat2 rotation = mat2(1.0, sense, -sense, 1.0);\nvector = rotation * vector;\nangle -= sense * 7.8539816339744828e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfloat factor = sense * 5.0e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.6364760900080609e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.5e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4497866312686414e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.25e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2435499454676144e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.25e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.2418809995957350e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.125e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.1239833430268277e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.5625e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5623728620476831e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.8125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.8123410601011111e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.90625e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.9062301319669718e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.953125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9531225164788188e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.765625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.7656218955931946e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.8828125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.8828121119489829e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.44140625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4414062014936177e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.220703125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2207031189367021e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.103515625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.1035156174208773e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.0517578125e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.0517578115526096e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.52587890625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5258789061315762e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.62939453125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.6293945311019700e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.814697265625e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.8146972656064961e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.9073486328125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9073486328101870e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.5367431640625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.5367431640596084e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.76837158203125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.7683715820308884e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.384185791015625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.3841857910155797e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.1920928955078125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nreturn vector;\n}\nvec2 czm_cosineAndSine(float angle)\n{\nif (angle < -czm_piOverTwo || angle > czm_piOverTwo)\n{\nif (angle < 0.0)\n{\nreturn -cordic(angle + czm_pi);\n}\nelse\n{\nreturn -cordic(angle - czm_pi);\n}\n}\nelse\n{\nreturn cordic(angle);\n}\n}\n",czm_decompressTextureCoordinates:"vec2 czm_decompressTextureCoordinates(float encoded)\n{\nfloat temp = encoded / 4096.0;\nfloat xZeroTo4095 = floor(temp);\nfloat stx = xZeroTo4095 / 4095.0;\nfloat sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;\nreturn vec2(stx, sty);\n}\n",czm_depthClampFarPlane:"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvec4 czm_depthClampFarPlane(vec4 coords)\n{\n#ifndef LOG_DEPTH\nv_WindowZ = (0.5 * (coords.z / coords.w) + 0.5) * coords.w;\ncoords.z = min(coords.z, coords.w);\n#endif\nreturn coords;\n}\n",czm_eastNorthUpToEyeCoordinates:"mat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\nvec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));\nvec3 tangentEC = normalize(czm_normal3D * tangentMC);\nvec3 bitangentEC = normalize(cross(normalEC, tangentEC));\nreturn mat3(\ntangentEC.x,   tangentEC.y,   tangentEC.z,\nbitangentEC.x, bitangentEC.y, bitangentEC.z,\nnormalEC.x,    normalEC.y,    normalEC.z);\n}\n",czm_ellipsoidContainsPoint:"bool czm_ellipsoidContainsPoint(vec3 ellipsoid_inverseRadii, vec3 point)\n{\nvec3 scaled = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\nreturn (dot(scaled, scaled) <= 1.0);\n}\n",czm_ellipsoidWgs84TextureCoordinates:"vec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\nreturn vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\n",czm_equalsEpsilon:"bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec4(epsilon)));\n}\nbool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\nbool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\nreturn (abs(left - right) <= epsilon);\n}\n",czm_eyeOffset:"vec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\nvec4 p = positionEC;\nvec4 zEyeOffset = normalize(p) * eyeOffset.z;\np.xy += eyeOffset.xy + zEyeOffset.xy;\np.z += zEyeOffset.z;\nreturn p;\n}\n",czm_eyeToWindowCoordinates:"vec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\nvec4 q = czm_projection * positionEC;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n",czm_fastApproximateAtan:"float czm_fastApproximateAtan(float x) {\nreturn x * (-0.1784 * x - 0.0663 * x * x + 1.0301);\n}\nfloat czm_fastApproximateAtan(float x, float y) {\nfloat t = abs(x);\nfloat opposite = abs(y);\nfloat adjacent = max(t, opposite);\nopposite = min(t, opposite);\nt = czm_fastApproximateAtan(opposite / adjacent);\nt = czm_branchFreeTernary(abs(y) > abs(x), czm_piOverTwo - t, t);\nt = czm_branchFreeTernary(x < 0.0, czm_pi - t, t);\nt = czm_branchFreeTernary(y < 0.0, -t, t);\nreturn t;\n}\n",czm_fog:"vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)\n{\nfloat scalar = distanceToCamera * czm_fogDensity;\nfloat fog = 1.0 - exp(-(scalar * scalar));\nreturn mix(color, fogColor, fog);\n}\nvec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor, float fogModifierConstant)\n{\nfloat scalar = distanceToCamera * czm_fogDensity;\nfloat fog = 1.0 - exp(-((fogModifierConstant * scalar + fogModifierConstant) * (scalar * (1.0 + fogModifierConstant))));\nreturn mix(color, fogColor, fog);\n}\n",czm_gammaCorrect:"vec3 czm_gammaCorrect(vec3 color) {\n#ifdef HDR\ncolor = pow(color, vec3(czm_gamma));\n#endif\nreturn color;\n}\nvec4 czm_gammaCorrect(vec4 color) {\n#ifdef HDR\ncolor.rgb = pow(color.rgb, vec3(czm_gamma));\n#endif\nreturn color;\n}\n",czm_geodeticSurfaceNormal:"vec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\nreturn normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\n",czm_getDefaultMaterial:"czm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\nczm_material material;\nmaterial.diffuse = vec3(0.0);\nmaterial.specular = 0.0;\nmaterial.shininess = 1.0;\nmaterial.normal = materialInput.normalEC;\nmaterial.emission = vec3(0.0);\nmaterial.alpha = 1.0;\nreturn material;\n}\n",czm_getLambertDiffuse:"float czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)\n{\nreturn max(dot(lightDirectionEC, normalEC), 0.0);\n}\n",czm_getSpecular:"float czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)\n{\nvec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);\nfloat specular = max(dot(toReflectedLight, toEyeEC), 0.0);\nreturn pow(specular, max(shininess, czm_epsilon2));\n}\n",czm_getWaterNoise:"vec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)\n{\nfloat cosAngle = cos(angleInRadians);\nfloat sinAngle = sin(angleInRadians);\nvec2 s0 = vec2(1.0/17.0, 0.0);\nvec2 s1 = vec2(-1.0/29.0, 0.0);\nvec2 s2 = vec2(1.0/101.0, 1.0/59.0);\nvec2 s3 = vec2(-1.0/109.0, -1.0/57.0);\ns0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\ns1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\ns2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\ns3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\nvec2 uv0 = (uv/103.0) + (time * s0);\nvec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);\nvec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\nvec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\nuv0 = fract(uv0);\nuv1 = fract(uv1);\nuv2 = fract(uv2);\nuv3 = fract(uv3);\nvec4 noise = (texture2D(normalMap, uv0)) +\n(texture2D(normalMap, uv1)) +\n(texture2D(normalMap, uv2)) +\n(texture2D(normalMap, uv3));\nreturn ((noise / 4.0) - 0.5) * 2.0;\n}\n",czm_HSBToRGB:"const vec4 K_HSB2RGB = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 czm_HSBToRGB(vec3 hsb)\n{\nvec3 p = abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);\nreturn hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);\n}\n",czm_HSLToRGB:"vec3 hueToRGB(float hue)\n{\nfloat r = abs(hue * 6.0 - 3.0) - 1.0;\nfloat g = 2.0 - abs(hue * 6.0 - 2.0);\nfloat b = 2.0 - abs(hue * 6.0 - 4.0);\nreturn clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 czm_HSLToRGB(vec3 hsl)\n{\nvec3 rgb = hueToRGB(hsl.x);\nfloat c = (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;\nreturn (rgb - 0.5) * c + hsl.z;\n}\n",czm_hue:"vec3 czm_hue(vec3 rgb, float adjustment)\n{\nconst mat3 toYIQ = mat3(0.299,     0.587,     0.114,\n0.595716, -0.274453, -0.321263,\n0.211456, -0.522591,  0.311135);\nconst mat3 toRGB = mat3(1.0,  0.9563,  0.6210,\n1.0, -0.2721, -0.6474,\n1.0, -1.107,   1.7046);\nvec3 yiq = toYIQ * rgb;\nfloat hue = atan(yiq.z, yiq.y) + adjustment;\nfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\nvec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\nreturn toRGB * color;\n}\n",czm_inverseGamma:"vec3 czm_inverseGamma(vec3 color) {\nreturn pow(color, vec3(1.0 / czm_gamma));\n}\n",czm_isEmpty:"bool czm_isEmpty(czm_raySegment interval)\n{\nreturn (interval.stop < 0.0);\n}\n",czm_isFull:"bool czm_isFull(czm_raySegment interval)\n{\nreturn (interval.start == 0.0 && interval.stop == czm_infinity);\n}\n",czm_latitudeToWebMercatorFraction:"float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)\n{\nfloat sinLatitude = sin(latitude);\nfloat mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\nreturn (mercatorY - southMercatorY) * oneOverMercatorHeight;\n}\n",czm_lineDistance:"float czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {\nreturn abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);\n}\n",czm_luminance:"float czm_luminance(vec3 rgb)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nreturn dot(rgb, W);\n}\n",czm_metersPerPixel:"float czm_metersPerPixel(vec4 positionEC, float pixelRatio)\n{\nfloat width = czm_viewport.z;\nfloat height = czm_viewport.w;\nfloat pixelWidth;\nfloat pixelHeight;\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nif (czm_sceneMode == czm_sceneMode2D || czm_orthographicIn3D == 1.0)\n{\nfloat frustumWidth = right - left;\nfloat frustumHeight = top - bottom;\npixelWidth = frustumWidth / width;\npixelHeight = frustumHeight / height;\n}\nelse\n{\nfloat distanceToPixel = -positionEC.z;\nfloat inverseNear = 1.0 / czm_currentFrustum.x;\nfloat tanTheta = top * inverseNear;\npixelHeight = 2.0 * distanceToPixel * tanTheta / height;\ntanTheta = right * inverseNear;\npixelWidth = 2.0 * distanceToPixel * tanTheta / width;\n}\nreturn max(pixelWidth, pixelHeight) * pixelRatio;\n}\nfloat czm_metersPerPixel(vec4 positionEC)\n{\nreturn czm_metersPerPixel(positionEC, czm_pixelRatio);\n}\n",czm_modelToWindowCoordinates:"vec4 czm_modelToWindowCoordinates(vec4 position)\n{\nvec4 q = czm_modelViewProjection * position;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n",czm_multiplyWithColorBalance:"vec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 target = left * right;\nfloat leftLuminance = dot(left, W);\nfloat rightLuminance = dot(right, W);\nfloat targetLuminance = dot(target, W);\nreturn ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\n",czm_nearFarScalar:"float czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)\n{\nfloat valueAtMin = nearFarScalar.y;\nfloat valueAtMax = nearFarScalar.w;\nfloat nearDistanceSq = nearFarScalar.x * nearFarScalar.x;\nfloat farDistanceSq = nearFarScalar.z * nearFarScalar.z;\nfloat t = (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);\nt = pow(clamp(t, 0.0, 1.0), 0.2);\nreturn mix(valueAtMin, valueAtMax, t);\n}\n",czm_octDecode:"vec3 czm_octDecode(vec2 encoded, float range)\n{\nif (encoded.x == 0.0 && encoded.y == 0.0) {\nreturn vec3(0.0, 0.0, 0.0);\n}\nencoded = encoded / range * 2.0 - 1.0;\nvec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\nif (v.z < 0.0)\n{\nv.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n}\nreturn normalize(v);\n}\nvec3 czm_octDecode(vec2 encoded)\n{\nreturn czm_octDecode(encoded, 255.0);\n}\nvec3 czm_octDecode(float encoded)\n{\nfloat temp = encoded / 256.0;\nfloat x = floor(temp);\nfloat y = (temp - x) * 256.0;\nreturn czm_octDecode(vec2(x, y));\n}\nvoid czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)\n{\nfloat temp = encoded.x / 65536.0;\nfloat x = floor(temp);\nfloat encodedFloat1 = (temp - x) * 65536.0;\ntemp = encoded.y / 65536.0;\nfloat y = floor(temp);\nfloat encodedFloat2 = (temp - y) * 65536.0;\nvector1 = czm_octDecode(encodedFloat1);\nvector2 = czm_octDecode(encodedFloat2);\nvector3 = czm_octDecode(vec2(x, y));\n}\n",czm_packDepth:"vec4 czm_packDepth(float depth)\n{\nvec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nenc = fract(enc);\nenc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn enc;\n}\n",czm_phong:"float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\nreturn czm_getLambertDiffuse(lightDirectionEC, material.normal);\n}\nfloat czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\nreturn czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\nvec4 czm_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n}\nfloat specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse * 0.5;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\nvec4 czm_phong(vec3 toEye, czm_material material)\n{\nreturn czm_phong(toEye, material,czm_lightDirectionEC);\n}\nvec4 czm_private_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(lightDirectionEC, material);\nfloat specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\nvec3 ambient = vec3(0.0);\nvec3 color = ambient + material.emission;\ncolor += material.diffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\n",czm_planeDistance:"float czm_planeDistance(vec4 plane, vec3 point) {\nreturn (dot(plane.xyz, point) + plane.w);\n}\nfloat czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {\nreturn (dot(planeNormal, point) + planeDistance);\n}\n",czm_pointAlongRay:"vec3 czm_pointAlongRay(czm_ray ray, float time)\n{\nreturn ray.origin + (time * ray.direction);\n}\n",czm_rayEllipsoidIntersectionInterval:"czm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, vec3 ellipsoid_center, vec3 ellipsoid_inverseRadii)\n{\nvec3 q = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\nvec3 w = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\nq = q - ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ellipsoid_center, 1.0)).xyz;\nfloat q2 = dot(q, q);\nfloat qw = dot(q, w);\nif (q2 > 1.0)\n{\nif (qw >= 0.0)\n{\nreturn czm_emptyRaySegment;\n}\nelse\n{\nfloat qw2 = qw * qw;\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nif (qw2 < product)\n{\nreturn czm_emptyRaySegment;\n}\nelse if (qw2 > product)\n{\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nfloat root0 = temp / w2;\nfloat root1 = difference / temp;\nif (root0 < root1)\n{\nczm_raySegment i = czm_raySegment(root0, root1);\nreturn i;\n}\nelse\n{\nczm_raySegment i = czm_raySegment(root1, root0);\nreturn i;\n}\n}\nelse\n{\nfloat root = sqrt(difference / w2);\nczm_raySegment i = czm_raySegment(root, root);\nreturn i;\n}\n}\n}\nelse if (q2 < 1.0)\n{\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nczm_raySegment i = czm_raySegment(0.0, temp / w2);\nreturn i;\n}\nelse\n{\nif (qw < 0.0)\n{\nfloat w2 = dot(w, w);\nczm_raySegment i = czm_raySegment(0.0, -qw / w2);\nreturn i;\n}\nelse\n{\nreturn czm_emptyRaySegment;\n}\n}\n}\n",czm_readDepth:"float czm_readDepth(sampler2D depthTexture, vec2 texCoords)\n{\nreturn czm_reverseLogDepth(texture2D(depthTexture, texCoords).r);\n}\n",czm_readNonPerspective:"float czm_readNonPerspective(float value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec2 czm_readNonPerspective(vec2 value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec3 czm_readNonPerspective(vec3 value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec4 czm_readNonPerspective(vec4 value, float oneOverW) {\nreturn value * oneOverW;\n}\n",czm_reverseLogDepth:"float czm_reverseLogDepth(float logZ)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nfloat log2Depth = logZ * czm_log2FarDepthFromNearPlusOne;\nfloat depthFromNear = pow(2.0, log2Depth) - 1.0;\nreturn far * (1.0 - near / (depthFromNear + near)) / (far - near);\n#endif\nreturn logZ;\n}\n",czm_RGBToHSB:"const vec4 K_RGB2HSB = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec3 czm_RGBToHSB(vec3 rgb)\n{\nvec4 p = mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));\nvec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));\nfloat d = q.x - min(q.w, q.y);\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);\n}\n",czm_RGBToHSL:"vec3 RGBtoHCV(vec3 rgb)\n{\nvec4 p = (rgb.g < rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);\nvec4 q = (rgb.r < p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);\nfloat c = q.x - min(q.w, q.y);\nfloat h = abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);\nreturn vec3(h, c, q.x);\n}\nvec3 czm_RGBToHSL(vec3 rgb)\n{\nvec3 hcv = RGBtoHCV(rgb);\nfloat l = hcv.z - hcv.y * 0.5;\nfloat s = hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);\nreturn vec3(hcv.x, s, l);\n}\n",czm_RGBToXYZ:"vec3 czm_RGBToXYZ(vec3 rgb)\n{\nconst mat3 RGB2XYZ = mat3(0.4124, 0.2126, 0.0193,\n0.3576, 0.7152, 0.1192,\n0.1805, 0.0722, 0.9505);\nvec3 xyz = RGB2XYZ * rgb;\nvec3 Yxy;\nYxy.r = xyz.g;\nfloat temp = dot(vec3(1.0), xyz);\nYxy.gb = xyz.rg / temp;\nreturn Yxy;\n}\n",czm_rollerShutter:"void czm_rollerShutter(vec2 coord,vec4 region)\n{\nvec2 st = coord / czm_viewport.zw;\nif(st.x < region.x || st.x > region.z){\ndiscard;\n}\nif(st.y < region.y || st.y > region.w){\ndiscard;\n}\n}\n",czm_sampleOctahedralProjection:"vec3 czm_sampleOctahedralProjectionWithFiltering(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod)\n{\ndirection /= dot(vec3(1.0), abs(direction));\nvec2 rev = abs(direction.zx) - vec2(1.0);\nvec2 neg = vec2(direction.x < 0.0 ? rev.x : -rev.x,\ndirection.z < 0.0 ? rev.y : -rev.y);\nvec2 uv = direction.y < 0.0 ? neg : direction.xz;\nvec2 coord = 0.5 * uv + vec2(0.5);\nvec2 pixel = 1.0 / textureSize;\nif (lod > 0.0)\n{\nfloat scale = 1.0 / pow(2.0, lod);\nfloat offset = ((textureSize.y + 1.0) / textureSize.x);\ncoord.x *= offset;\ncoord *= scale;\ncoord.x += offset + pixel.x;\ncoord.y += (1.0 - (1.0 / pow(2.0, lod - 1.0))) + pixel.y * (lod - 1.0) * 2.0;\n}\nelse\n{\ncoord.x *= (textureSize.y / textureSize.x);\n}\n#ifndef OES_texture_float_linear\nvec3 color1 = texture2D(projectedMap, coord + vec2(0.0, pixel.y)).rgb;\nvec3 color2 = texture2D(projectedMap, coord + vec2(pixel.x, 0.0)).rgb;\nvec3 color3 = texture2D(projectedMap, coord + pixel).rgb;\nvec3 color4 = texture2D(projectedMap, coord).rgb;\nvec2 texturePosition = coord * textureSize;\nfloat fu = fract(texturePosition.x);\nfloat fv = fract(texturePosition.y);\nvec3 average1 = mix(color4, color2, fu);\nvec3 average2 = mix(color1, color3, fu);\nvec3 color = mix(average1, average2, fv);\n#else\nvec3 color = texture2D(projectedMap, coord).rgb;\n#endif\nreturn color;\n}\nvec3 czm_sampleOctahedralProjection(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod, float maxLod) {\nfloat currentLod = floor(lod + 0.5);\nfloat nextLod = min(currentLod + 1.0, maxLod);\nvec3 colorCurrentLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, currentLod);\nvec3 colorNextLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, nextLod);\nreturn mix(colorNextLod, colorCurrentLod, nextLod - lod);\n}\n",czm_saturation:"vec3 czm_saturation(vec3 rgb, float adjustment)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 intensity = vec3(dot(rgb, W));\nreturn mix(intensity, rgb, adjustment);\n}\n",czm_shadowDepthCompare:"float czm_sampleShadowMap(samplerCube shadowMap, vec3 d)\n{\nreturn czm_unpackDepth(textureCube(shadowMap, d));\n}\nfloat czm_sampleShadowMap(sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\nreturn texture2D(shadowMap, uv).r;\n#else\nreturn czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\nfloat czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\nfloat czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\n",czm_shadowVisibility:"float czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)\n{\n#ifdef USE_NORMAL_SHADING\n#ifdef USE_NORMAL_SHADING_SMOOTH\nfloat strength = clamp(nDotL / normalShadingSmooth, 0.0, 1.0);\n#else\nfloat strength = step(0.0, nDotL);\n#endif\nvisibility *= strength;\n#endif\nvisibility = max(visibility, darkness);\nreturn visibility;\n}\n#ifdef USE_CUBE_MAP_SHADOW\nfloat czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec3 uvw = shadowParameters.texCoords;\ndepth -= depthBias;\nfloat visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#else\nfloat czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec2 uv = shadowParameters.texCoords;\ndepth -= depthBias;\n#ifdef USE_SOFT_SHADOWS\nvec2 texelStepSize = shadowParameters.texelStepSize;\nfloat radius = 1.0;\nfloat dx0 = -texelStepSize.x * radius;\nfloat dy0 = -texelStepSize.y * radius;\nfloat dx1 = texelStepSize.x * radius;\nfloat dy1 = texelStepSize.y * radius;\nfloat visibility = (\nczm_shadowDepthCompare(shadowMap, uv, depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n) * (1.0 / 9.0);\n#else\nfloat visibility = czm_shadowDepthCompare(shadowMap, uv, depth);\n#endif\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#endif\n",czm_signNotZero:"float czm_signNotZero(float value)\n{\nreturn value >= 0.0 ? 1.0 : -1.0;\n}\nvec2 czm_signNotZero(vec2 value)\n{\nreturn vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n}\nvec3 czm_signNotZero(vec3 value)\n{\nreturn vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));\n}\nvec4 czm_signNotZero(vec4 value)\n{\nreturn vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));\n}\n",czm_sphericalHarmonics:"vec3 czm_sphericalHarmonics(vec3 normal, vec3 coefficients[9])\n{\nconst float c1 = 0.429043;\nconst float c2 = 0.511664;\nconst float c3 = 0.743125;\nconst float c4 = 0.886227;\nconst float c5 = 0.247708;\nvec3 L00 = coefficients[0];\nvec3 L1_1 = coefficients[1];\nvec3 L10 = coefficients[2];\nvec3 L11 = coefficients[3];\nvec3 L2_2 = coefficients[4];\nvec3 L2_1 = coefficients[5];\nvec3 L20 = coefficients[6];\nvec3 L21 = coefficients[7];\nvec3 L22 = coefficients[8];\nfloat x = normal.x;\nfloat y = normal.y;\nfloat z = normal.z;\nreturn c1 * L22 * (x * x - y * y) + c3 * L20 * z * z + c4 * L00 - c5 * L20 +\n2.0 * c1 * (L2_2 * x * y + L21 * x * z + L2_1 * y * z) +\n2.0 * c2 * (L11 * x + L1_1 * y + L10 * z);\n}\n",czm_tangentToEyeSpaceMatrix:"mat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)\n{\nvec3 normal = normalize(normalEC);\nvec3 tangent = normalize(tangentEC);\nvec3 bitangent = normalize(bitangentEC);\nreturn mat3(tangent.x  , tangent.y  , tangent.z,\nbitangent.x, bitangent.y, bitangent.z,\nnormal.x   , normal.y   , normal.z);\n}\n",czm_transformPlane:"vec4 czm_transformPlane(vec4 clippingPlane, mat4 transform) {\nvec3 transformedDirection = normalize((transform * vec4(clippingPlane.xyz, 0.0)).xyz);\nvec3 transformedPosition = (transform * vec4(clippingPlane.xyz * -clippingPlane.w, 1.0)).xyz;\nvec4 transformedPlane;\ntransformedPlane.xyz = transformedDirection;\ntransformedPlane.w = -dot(transformedDirection, transformedPosition);\nreturn transformedPlane;\n}\n",czm_translateRelativeToEye:"vec4 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\nvec3 highDifference = high - czm_encodedCameraPositionMCHigh;\nvec3 lowDifference = low - czm_encodedCameraPositionMCLow;\nreturn vec4(highDifference + lowDifference, 1.0);\n}\n",czm_translucentPhong:"vec4 czm_translucentPhong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n}\ndiffuse = clamp(diffuse, 0.0, 1.0);\nfloat specular = czm_getSpecular(lightDirectionEC, toEye, material.normal, material.shininess);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\nvec4 czm_translucentPhong(vec3 toEye, czm_material material)\n{\nreturn czm_translucentPhong(toEye, material, czm_lightDirectionEC);\n}\n",czm_transpose:"mat2 czm_transpose(mat2 matrix)\n{\nreturn mat2(\nmatrix[0][0], matrix[1][0],\nmatrix[0][1], matrix[1][1]);\n}\nmat3 czm_transpose(mat3 matrix)\n{\nreturn mat3(\nmatrix[0][0], matrix[1][0], matrix[2][0],\nmatrix[0][1], matrix[1][1], matrix[2][1],\nmatrix[0][2], matrix[1][2], matrix[2][2]);\n}\nmat4 czm_transpose(mat4 matrix)\n{\nreturn mat4(\nmatrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\nmatrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\nmatrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\nmatrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\n",czm_unpackDepth:"float czm_unpackDepth(vec4 packedDepth)\n{\nreturn dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n}\n",czm_unpackFloat:"#define SHIFT_RIGHT_8 0.00390625 //1.0 / 256.0\n#define SHIFT_RIGHT_16 0.00001525878 //1.0 / 65536.0\n#define SHIFT_RIGHT_24 5.960464477539063e-8//1.0 / 16777216.0\n#define BIAS 38.0\nfloat czm_unpackFloat(vec4 packedFloat)\n{\npackedFloat *= 255.0;\nfloat temp = packedFloat.w / 2.0;\nfloat exponent = floor(temp);\nfloat sign = (temp - exponent) * 2.0;\nexponent = exponent - float(BIAS);\nsign = sign * 2.0 - 1.0;\nsign = -sign;\nfloat unpacked = sign * packedFloat.x * float(SHIFT_RIGHT_8);\nunpacked += sign * packedFloat.y * float(SHIFT_RIGHT_16);\nunpacked += sign * packedFloat.z * float(SHIFT_RIGHT_24);\nreturn unpacked * pow(10.0, exponent);\n}\n",czm_vertexLogDepth:"#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#ifdef SHADOW_MAP\nvarying vec3 v_logPositionEC;\n#endif\n#endif\nvec4 czm_updatePositionDepth(vec4 coords) {\n#if defined(LOG_DEPTH)\n#ifdef SHADOW_MAP\nvec3 logPositionEC = (czm_inverseProjection * coords).xyz;\nv_logPositionEC = logPositionEC;\n#endif\ncoords.z = clamp(coords.z / coords.w, -1.0, 1.0) * coords.w;\n#endif\nreturn coords;\n}\nvoid czm_vertexLogDepth()\n{\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = (gl_Position.w - czm_currentFrustum.x) + 1.0;\ngl_Position = czm_updatePositionDepth(gl_Position);\n#endif\n}\nvoid czm_vertexLogDepth(vec4 clipCoords)\n{\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = (clipCoords.w - czm_currentFrustum.x) + 1.0;\nczm_updatePositionDepth(clipCoords);\n#endif\n}\n",czm_windowToEyeCoordinates:"vec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\nfloat x = 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\nfloat y = 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\nfloat z = (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nvec4 q = vec4(x, y, z, 1.0);\nq /= fragmentCoordinate.w;\nif (!(czm_inverseProjection == mat4(0.0)))\n{\nq = czm_inverseProjection * q;\n}\nelse\n{\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nq.x = (q.x * (right - left) + left + right) * 0.5;\nq.y = (q.y * (top - bottom) + bottom + top) * 0.5;\nq.z = (q.z * (near - far) - near - far) * 0.5;\nq.w = 1.0;\n}\nreturn q;\n}\nvec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nfloat log2Depth = depthOrLogDepth * czm_log2FarDepthFromNearPlusOne;\nfloat depthFromNear = pow(2.0, log2Depth) - 1.0;\nfloat depthFromCamera = depthFromNear + near;\nvec4 windowCoord = vec4(fragmentCoordinateXY, far * (1.0 - near / depthFromCamera) / (far - near), 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\neyeCoordinate.w = 1.0 / depthFromCamera;\nreturn eyeCoordinate;\n#else\nvec4 windowCoord = vec4(fragmentCoordinateXY, depthOrLogDepth, 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\n#endif\nreturn eyeCoordinate;\n}\n",czm_writeDepthClampedToFarPlane:"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvoid czm_writeDepthClampedToFarPlane()\n{\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\ngl_FragDepthEXT = min(v_WindowZ * gl_FragCoord.w, 1.0);\n#endif\n}\n",czm_writeLogDepth:"#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#ifdef POLYGON_OFFSET\nuniform vec2 u_polygonOffset;\n#endif\n#endif\nvoid czm_writeLogDepth(float depth)\n{\n#if defined(GL_EXT_frag_depth) && defined(LOG_DEPTH)\nif (depth <= 0.9999999 || depth > czm_farDepthFromNearPlusOne) {\ndiscard;\n}\n#ifdef POLYGON_OFFSET\nfloat factor = u_polygonOffset[0];\nfloat units = u_polygonOffset[1];\n#ifdef GL_OES_standard_derivatives\nfloat x = dFdx(depth);\nfloat y = dFdy(depth);\nfloat m = sqrt(x * x + y * y);\ndepth += m * factor;\n#endif\n#endif\ngl_FragDepthEXT = log2(depth) * czm_oneOverLog2FarDepthFromNearPlusOne;\n#ifdef POLYGON_OFFSET\ngl_FragDepthEXT += czm_epsilon7 * units;\n#endif\n#endif\n}\nvoid czm_writeLogDepth() {\n#ifdef LOG_DEPTH\nczm_writeLogDepth(v_depthFromNearPlusOne);\n#endif\n}\n",czm_writeNonPerspective:"float czm_writeNonPerspective(float value, float w) {\nreturn value * w;\n}\nvec2 czm_writeNonPerspective(vec2 value, float w) {\nreturn value * w;\n}\nvec3 czm_writeNonPerspective(vec3 value, float w) {\nreturn value * w;\n}\nvec4 czm_writeNonPerspective(vec4 value, float w) {\nreturn value * w;\n}\n",czm_XYZToRGB:"vec3 czm_XYZToRGB(vec3 Yxy)\n{\nconst mat3 XYZ2RGB = mat3( 3.2405, -0.9693,  0.0556,\n-1.5371,  1.8760, -0.2040,\n-0.4985,  0.0416,  1.0572);\nvec3 xyz;\nxyz.r = Yxy.r * Yxy.g / Yxy.b;\nxyz.g = Yxy.r;\nxyz.b = Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;\nreturn XYZ2RGB * xyz;\n}\n"},Br=new _t;function Ur(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}var Vr={};Vr[Rt.FLOAT]="float",Vr[Rt.FLOAT_VEC2]="vec2",Vr[Rt.FLOAT_VEC3]="vec3",Vr[Rt.FLOAT_VEC4]="vec4",Vr[Rt.INT]="int",Vr[Rt.INT_VEC2]="ivec2",Vr[Rt.INT_VEC3]="ivec3",Vr[Rt.INT_VEC4]="ivec4",Vr[Rt.BOOL]="bool",Vr[Rt.BOOL_VEC2]="bvec2",Vr[Rt.BOOL_VEC3]="bvec3",Vr[Rt.BOOL_VEC4]="bvec4",Vr[Rt.FLOAT_MAT2]="mat2",Vr[Rt.FLOAT_MAT3]="mat3",Vr[Rt.FLOAT_MAT4]="mat4",Vr[Rt.SAMPLER_2D]="sampler2D",Vr[Rt.SAMPLER_CUBE]="samplerCube",Ur.prototype.getDeclaration=function(e){var t="uniform "+Vr[this._datatype]+" "+e,n=this._size;return t+=1===n?";":"["+n.toString()+"];"};var kr,Gr={czm_viewport:new Ur({size:1,datatype:Rt.FLOAT_VEC4,getValue:function(e){return e.viewportCartesian4}}),czm_viewportOrthographic:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.viewportOrthographic}}),czm_viewportTransformation:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.viewportTransformation}}),czm_globeDepthTexture:new Ur({size:1,datatype:Rt.SAMPLER_2D,getValue:function(e){return e.globeDepthTexture}}),czm_model:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.model}}),czm_inverseModel:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseModel}}),czm_view:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.view}}),czm_view3D:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.view3D}}),czm_viewRotation:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.viewRotation}}),czm_viewRotation3D:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.viewRotation3D}}),czm_inverseView:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseView}}),czm_inverseView3D:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseView3D}}),czm_inverseViewRotation:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation}}),czm_inverseViewRotation3D:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation3D}}),czm_projection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.projection}}),czm_inverseProjection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseProjection}}),czm_infiniteProjection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.infiniteProjection}}),czm_modelView:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.modelView}}),czm_modelView3D:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.modelView3D}}),czm_modelViewRelativeToEye:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.modelViewRelativeToEye}}),czm_inverseModelView:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseModelView}}),czm_inverseModelView3D:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseModelView3D}}),czm_viewProjection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.viewProjection}}),czm_inverseViewProjection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseViewProjection}}),czm_modelViewProjection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.modelViewProjection}}),czm_inverseModelViewProjection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new Ur({size:1,datatype:Rt.FLOAT_MAT4,getValue:function(e){return e.modelViewInfiniteProjection}}),czm_orthographicIn3D:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.orthographicIn3D?1:0}}),czm_normal:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.normal}}),czm_normal3D:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.normal3D}}),czm_inverseNormal:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.inverseNormal}}),czm_inverseNormal3D:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.inverseNormal3D}}),czm_eyeHeight:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.eyeHeight}}),czm_eyeHeight2D:new Ur({size:1,datatype:Rt.FLOAT_VEC2,getValue:function(e){return e.eyeHeight2D}}),czm_entireFrustum:new Ur({size:1,datatype:Rt.FLOAT_VEC2,getValue:function(e){return e.entireFrustum}}),czm_currentFrustum:new Ur({size:1,datatype:Rt.FLOAT_VEC2,getValue:function(e){return e.currentFrustum}}),czm_frustumPlanes:new Ur({size:1,datatype:Rt.FLOAT_VEC4,getValue:function(e){return e.frustumPlanes}}),czm_farDepthFromNearPlusOne:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.farDepthFromNearPlusOne}}),czm_log2FarDepthFromNearPlusOne:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.log2FarDepthFromNearPlusOne}}),czm_oneOverLog2FarDepthFromNearPlusOne:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.oneOverLog2FarDepthFromNearPlusOne}}),czm_sunPositionWC:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.sunPositionWC}}),czm_sunPositionColumbusView:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.sunPositionColumbusView}}),czm_sunDirectionEC:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.sunDirectionEC}}),czm_sunDirectionWC:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.sunDirectionWC}}),czm_moonDirectionEC:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.moonDirectionEC}}),czm_lightDirectionEC:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.lightDirectionEC}}),czm_lightDirectionWC:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.lightDirectionWC}}),czm_lightColor:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.lightColor}}),czm_lightColorHdr:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.lightColorHdr}}),czm_encodedCameraPositionMCHigh:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return on.getTranslation(e.inverseView,Br)}}),czm_frameNumber:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.frameState.frameNumber}}),czm_morphTime:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.frameState.morphTime}}),czm_sceneMode:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.frameState.mode}}),czm_pass:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.pass}}),czm_backgroundColor:new Ur({size:1,datatype:Rt.FLOAT_VEC4,getValue:function(e){return e.backgroundColor}}),czm_brdfLut:new Ur({size:1,datatype:Rt.SAMPLER_2D,getValue:function(e){return e.brdfLut}}),czm_environmentMap:new Ur({size:1,datatype:Rt.SAMPLER_CUBE,getValue:function(e){return e.environmentMap}}),czm_specularEnvironmentMaps:new Ur({size:1,datatype:Rt.SAMPLER_2D,getValue:function(e){return e.specularEnvironmentMaps}}),czm_specularEnvironmentMapSize:new Ur({size:1,datatype:Rt.FLOAT_VEC2,getValue:function(e){return e.specularEnvironmentMapsDimensions}}),czm_specularEnvironmentMapsMaximumLOD:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.specularEnvironmentMapsMaximumLOD}}),czm_sphericalHarmonicCoefficients:new Ur({size:9,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.sphericalHarmonicCoefficients}}),czm_temeToPseudoFixed:new Ur({size:1,datatype:Rt.FLOAT_MAT3,getValue:function(e){return e.temeToPseudoFixedMatrix}}),czm_pixelRatio:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.pixelRatio}}),czm_fogDensity:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.fogDensity}}),czm_imagerySplitPosition:new Ur({size:1,datatype:Rt.FLOAT_VEC2,getValue:function(e){return e.imagerySplitPosition}}),czm_geometricToleranceOverMeter:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new Ur({size:1,datatype:Rt.FLOAT_VEC4,getValue:function(e){return e.invertClassificationColor}}),czm_gamma:new Ur({size:1,datatype:Rt.FLOAT,getValue:function(e){return e.gamma}}),czm_ellipsoidRadii:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.radii}}),czm_ellipsoidInverseRadii:new Ur({size:1,datatype:Rt.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.oneOverRadii}})};function qr(e){return(e=e.replace(/\/\/.*/g,"")).replace(/\/\*\*[\s\S]*?\*\//gm,function(e){for(var t=e.match(/\n/gm).length,n="",r=0;r<t;++r)n+="\n";return n})}function Hr(e,t,n){for(var r,i=0;i<n.length;++i)n[i].name===e&&(r=n[i]);return Ze(r)||(r={name:e,glslSource:t=qr(t),dependsOn:[],requiredBy:[],evaluated:!1},n.push(r)),r}function Wr(e){var t=[],n=Hr("main",e,t);!function n(r,i){var o;r.evaluated||(r.evaluated=!0,Ze(o=r.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g))&&null!==o&&(o=o.filter(function(e,t){return o.indexOf(e)===t})).forEach(function(e){var t;e!==r.name&&Xr._czmBuiltinsAndUniforms.hasOwnProperty(e)&&(t=Hr(e,Xr._czmBuiltinsAndUniforms[e],i),r.dependsOn.push(t),t.requiredBy.push(r),n(t,i))}))}(n,t),function(e){for(var t=[],n=[];0<e.length;){var r=e.pop();n.push(r),0===r.requiredBy.length&&t.push(r)}for(;0<t.length;){var i=t.shift();e.push(i);for(var o=0;o<i.dependsOn.length;++o){var a=i.dependsOn[o],s=a.requiredBy.indexOf(i);a.requiredBy.splice(s,1),0===a.requiredBy.length&&t.push(a)}}for(var u=0;u<n.length;++u)n[u].requiredBy.length}(t);for(var r="",i=t.length-1;0<=i;--i)r=r+t[i].glslSource+"\n";return r.replace(n.glslSource,"")}function Yr(e,t,n){var r,i,o="",a=e.sources;if(Ze(a))for(h=0,r=a.length;h<r;++h)o+="\n#line 0\n"+a[h];o=(o=qr(o)).replace(/#version\s+(.*?)\n/gm,function(e,t){return i=t,"\n"});var s=[];o=(o=o.replace(/#extension.*\n/gm,function(e){return s.push(e),"\n"})).replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");var u=e.pickColorQualifier;Ze(u)&&(o=Xr.createPickFragmentShaderSource(o,u));var l="";Ze(i)&&(l="#version "+i+"\n");for(var c=s.length,h=0;h<c;h++)l+=s[h];t&&(l+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n#else\n    precision mediump float;\n#endif\n\n");var f=e.defines;if(Ze(f))for(h=0,r=f.length;h<r;++h){var p=f[h];0!==p.length&&(l+="#define "+p+"\n")}return n.webgl2&&(l+="#define OUTPUT_DECLARATION\n\n"),n.textureFloatLinear&&(l+="#define OES_texture_float_linear\n\n"),e.includeBuiltIns&&(l+=Wr(o)),l+="\n#line 0\n",l+=o,n.webgl2&&(l=Rr(l,t)),l}function Xr(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).pickColorQualifier;this.defines=Ze(e.defines)?e.defines.slice(0):[],this.sources=Ze(e.sources)?e.sources.slice(0):[],this.pickColorQualifier=t,this.includeBuiltIns=Je(e.includeBuiltIns,!0)}for(var jr in Xr.prototype.clone=function(){return new Xr({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})},Xr.replaceMain=function(e,t){return t="void "+t+"()",e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)},Xr.prototype.createCombinedVertexShader=function(e){return Yr(this,!1,e)},Xr.prototype.createCombinedFragmentShader=function(e){return Yr(this,!0,e)},Xr._czmBuiltinsAndUniforms={},zr)zr.hasOwnProperty(jr)&&(Xr._czmBuiltinsAndUniforms[jr]=zr[jr]);for(var Kr in Gr){!Gr.hasOwnProperty(Kr)||"function"==typeof(kr=Gr[Kr]).getDeclaration&&(Xr._czmBuiltinsAndUniforms[Kr]=kr.getDeclaration(Kr))}Xr.createPickVertexShaderSource=function(e){return Xr.replaceMain(e,"czm_old_main")+"\nattribute vec4 pickColor; \nvarying vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    czm_pickColor = pickColor; \n}"},Xr.createPickFragmentShaderSource=function(e,t){return Xr.replaceMain(e,"czm_old_main")+"\n"+(t+" vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    if (gl_FragColor.a == 0.0) { \n       discard; \n    } \n    gl_FragColor = czm_pickColor; \n}")},Xr.findVarying=function(e,t){for(var n=e.sources,r=t.length,i=0;i<r;++i)for(var o=t[i],a=n.length,s=0;s<a;++s)if(-1!==n[s].indexOf(o))return o};var Qr=["v_normalEC","v_normal"];Xr.findNormalVarying=function(e){return Xr.findVarying(e,Qr)};var Zr=["v_positionEC"];function Jr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}Xr.findPositionVarying=function(e){return Xr.findVarying(e,Zr)};var $r={DONT_CARE:Rt.DONT_CARE,FASTEST:Rt.FASTEST,NICEST:Rt.NICEST,validate:function(e){return e===$r.DONT_CARE||e===$r.FASTEST||e===$r.NICEST}},ei=Object.freeze($r);function ti(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).context,n=e.width,r=e.height,i=e.source,o=1;Ze(i)&&Ze(i.length)&&0<i.length&&!Ze(i.arrayBufferView)&&(i.arrayBufferView={},i.arrayBufferView.byteLength=i[0].bufferView.byteLength,o=i.length),Ze(i)&&(Ze(n)||(n=Je(i.videoWidth,i.width)),Ze(r)||(r=Je(i.videoHeight,i.height)));var a=Je(e.pixelFormat,Ln.RGBA),s=Je(e.pixelDatatype,Pn.UNSIGNED_BYTE),u=a,l=Ln.isCompressedFormat(u);if(t.webgl2)if(a===Ln.DEPTH_STENCIL?u=Rt.DEPTH24_STENCIL8:a===Ln.DEPTH_COMPONENT&&(s===Pn.UNSIGNED_SHORT?u=Rt.DEPTH_COMPONENT16:s===Pn.UNSIGNED_INT&&(u=Rt.DEPTH_COMPONENT24)),s===Pn.FLOAT)switch(a){case Ln.RGBA:u=Rt.RGBA32F;break;case Ln.RGB:u=Rt.RGB32F;break;case Ln.RG:u=Rt.RG32F;break;case Ln.R:u=Rt.R32F}else if(s===Pn.HALF_FLOAT)switch(a){case Ln.RGBA:u=Rt.RGBA16F;break;case Ln.RGB:u=Rt.RGB16F;break;case Ln.RG:u=Rt.RG16F;break;case Ln.R:u=Rt.R16F}var c=e.preMultiplyAlpha||a===Ln.RGB||a===Ln.LUMINANCE,h=Je(e.flipY,!0),f=!0,p=t._gl,d=p.TEXTURE_2D,m=p.createTexture();p.activeTexture(p.TEXTURE0),p.bindTexture(d,m),t.webgl2&&s===Pn.HALF_FLOAT&&(s=Rt.HALF_FLOAT);var _,g=4;if(Ze(i)&&Ze(i.arrayBufferView)&&!l&&(g=Ln.alignmentInBytes(a,s,n)),p.pixelStorei(p.UNPACK_ALIGNMENT,g),Ze(i))if(Ze(i.arrayBufferView)){p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,!1);var y=i.arrayBufferView;if(l)if(Ze(i.length)&&0<i.length){var v=n,x=r,b=0;if(t.webgl2){for(var E=0,T=0,S=[],C=v,w=x;1===o||1<=C||1<=w;){var A=Ln.compressedTextureSizeInBytes(u,C,w);if(b<o?(R=i[b].bufferView,S.push({level:b,width:C,height:w,offset:E,imageSize:R.length}),b<o-1&&(E+=R.byteLength),T+=R.byteLength):S.push({level:b,width:C,height:w,offset:E,imageSize:A}),1==C&&1==w||1===o)break;1!=C&&(C/=2),1!=w&&(w/=2),b++}for(var I=0,P=new Uint8Array(T),O=0;O<i.length&&S.length>=i.length;O++)P.set(i[O].bufferView,I),I+=i[O].bufferView.length;var L=p.createBuffer();p.bindBuffer(p.PIXEL_UNPACK_BUFFER,L),p.bufferData(p.PIXEL_UNPACK_BUFFER,P,p.STATIC_DRAW);for(var N=0;N<S.length;N++)p.compressedTexImage2D(d,S[N].level,u,S[N].width,S[N].height,0,S[N].imageSize,S[N].offset);p.bindBuffer(p.PIXEL_UNPACK_BUFFER,null)}else for(;1===o||1<=v||1<=x;){var R,A=Ln.compressedTextureSizeInBytes(u,v,x);if(R=b<o?i[b].bufferView:i[o-1].bufferView.subarray(0,A),p.compressedTexImage2D(d,b,u,v,x,0,R),1==v&&1==x||1===o)break;1!=v&&(v/=2),1!=x&&(x/=2),b++}o=b}else{t.webgl2?(L=p.createBuffer(),p.bindBuffer(p.PIXEL_UNPACK_BUFFER,L),p.bufferData(p.PIXEL_UNPACK_BUFFER,y,p.STATIC_DRAW),p.compressedTexImage2D(d,0,u,n,r,0,y.length,0),p.bindBuffer(p.PIXEL_UNPACK_BUFFER,null)):p.compressedTexImage2D(d,0,u,n,r,0,y)}else if(h&&(y=Ln.flipY(y,a,s,n,r)),p.texImage2D(d,0,u,n,r,0,a,s,y),Ze(i.mipLevels))for(var D=n,M=r,F=0;F<i.mipLevels.length;++F)(D=0|Math.floor(D/2))<1&&(D=1),(M=0|Math.floor(M/2))<1&&(M=1),p.texImage2D(d,F+1,u,D,M,0,a,s,i.mipLevels[F])}else Ze(i.framebuffer)?(p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,!1),i.framebuffer!==t.defaultFramebuffer&&i.framebuffer._bind(),p.copyTexImage2D(d,0,u,i.xOffset,i.yOffset,n,r,0),i.framebuffer!==t.defaultFramebuffer&&i.framebuffer._unBind()):(p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,h),p.texImage2D(d,0,u,a,s,i));else p.texImage2D(d,0,u,n,r,0,a,s,null),f=!1;p.bindTexture(d,null),_=l?Ln.compressedTextureSizeInBytes(a,n,r,o):Ln.textureSizeInBytes(a,s,n,r),this._id=Jr(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=d,this._texture=m,this._pixelFormat=a,this._pixelDatatype=s,this._width=n,this._height=r,this._dimensions=new En(n,r),this._hasMipmap=!1,this._sizeInBytes=_,this._preMultiplyAlpha=c,this._flipY=h,this._initialized=f,this._sampler=void 0,this.sampler=Ze(e.sampler)?e.sampler:new Nr}ti.create=function(e){return new ti(e)},ti.fromFramebuffer=function(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).context,n=t._gl,r=Je(e.pixelFormat,Ln.RGB),i=Je(e.framebufferXOffset,0),o=Je(e.framebufferYOffset,0),a=Je(e.width,n.drawingBufferWidth),s=Je(e.height,n.drawingBufferHeight),u=e.framebuffer;return new ti({context:t,width:a,height:s,pixelFormat:r,source:{framebuffer:Ze(u)?u:t.defaultFramebuffer,xOffset:i,yOffset:o,width:a,height:s}})},Object.defineProperties(ti.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){var t=e.minificationFilter,n=e.magnificationFilter,r=t===Pr.NEAREST_MIPMAP_NEAREST||t===Pr.NEAREST_MIPMAP_LINEAR||t===Pr.LINEAR_MIPMAP_NEAREST||t===Pr.LINEAR_MIPMAP_LINEAR,i=this._context,o=this._pixelDatatype;(o===Pn.FLOAT&&!i.textureFloatLinear||o===Pn.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(t=r?Pr.NEAREST_MIPMAP_NEAREST:Pr.NEAREST,n=Ar.NEAREST);var a=i._gl,s=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this._texture),a.texParameteri(s,a.TEXTURE_MIN_FILTER,t),a.texParameteri(s,a.TEXTURE_MAG_FILTER,n),a.texParameteri(s,a.TEXTURE_WRAP_S,e.wrapS),a.texParameteri(s,a.TEXTURE_WRAP_T,e.wrapT),Ze(this._textureFilterAnisotropic)&&a.texParameteri(s,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),a.bindTexture(s,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}}),ti.prototype.copyFrom=function(e,t,n){t=Je(t,0),n=Je(n,0);var r=this._context._gl,i=this._textureTarget;r.activeTexture(r.TEXTURE0),r.bindTexture(i,this._texture);var o=e.width,a=e.height,s=e.arrayBufferView,u=this._width,l=this._height,c=this._pixelFormat,h=this._pixelDatatype,f=this._preMultiplyAlpha,p=this._flipY,d=4;Ze(s)&&(d=Ln.alignmentInBytes(c,h,o)),r.pixelStorei(r.UNPACK_ALIGNMENT,d);var m,_=!1;this._initialized||(0===t&&0===n&&o===u&&a===l?(Ze(s)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),p&&(s=Ln.flipY(s,c,h,u,l)),r.texImage2D(i,0,c,u,l,0,c,h,s)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,p),r.texImage2D(i,0,c,c,h,e)),_=!0):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),m=Ln.createTypedArray(c,h,u,l),r.texImage2D(i,0,c,u,l,0,c,h,m)),this._initialized=!0),_||(Ze(s)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),p&&(s=Ln.flipY(s,c,h,o,a)),r.texSubImage2D(i,0,t,n,o,a,c,h,s)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,p),0==t&&0==n?r.texImage2D(i,0,c,c,h,e):r.texSubImage2D(i,0,t,n,c,h,e)))},ti.prototype.copyFromFramebuffer=function(e,t,n,r,i,o){e=Je(e,0),t=Je(t,0),n=Je(n,0),r=Je(r,0),i=Je(i,this._width),o=Je(o,this._height);var a=this._context._gl,s=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this._texture),a.copyTexSubImage2D(s,0,e,t,n,r,i,o),a.bindTexture(s,null),this._initialized=!0},ti.prototype.generateMipmap=function(e){e=Je(e,ei.DONT_CARE),this._hasMipmap=!0;var t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)},ti.prototype.isDestroyed=function(){return!1},ti.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),Vt(this)};var ni=Object.freeze({SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"}),ri={ADD:Rt.FUNC_ADD,SUBTRACT:Rt.FUNC_SUBTRACT,REVERSE_SUBTRACT:Rt.FUNC_REVERSE_SUBTRACT,MIN:Rt.MIN,MAX:Rt.MAX},ii=Object.freeze(ri),oi={ZERO:Rt.ZERO,ONE:Rt.ONE,SOURCE_COLOR:Rt.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:Rt.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:Rt.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:Rt.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:Rt.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:Rt.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:Rt.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:Rt.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:Rt.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:Rt.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:Rt.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:Rt.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:Rt.SRC_ALPHA_SATURATE},ai=Object.freeze(oi),si={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:ii.ADD,equationAlpha:ii.ADD,functionSourceRgb:ai.SOURCE_ALPHA,functionSourceAlpha:ai.ONE,functionDestinationRgb:ai.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:ai.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:ii.ADD,equationAlpha:ii.ADD,functionSourceRgb:ai.ONE,functionSourceAlpha:ai.ONE,functionDestinationRgb:ai.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:ai.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:ii.ADD,equationAlpha:ii.ADD,functionSourceRgb:ai.SOURCE_ALPHA,functionSourceAlpha:ai.ONE,functionDestinationRgb:ai.ONE,functionDestinationAlpha:ai.ONE})},ui=Object.freeze(si),li=Object.freeze({HIGHLIGHT:0,REPLACE:1,MIX:2}),ci={FRONT:Rt.FRONT,BACK:Rt.BACK,FRONT_AND_BACK:Rt.FRONT_AND_BACK},hi=Object.freeze(ci);function fi(e,t,n,r){this[0]=Je(e,0),this[1]=Je(n,0),this[2]=Je(t,0),this[3]=Je(r,0)}fi.packedLength=4,fi.pack=function(e,t,n){return n=Je(n,0),t[n++]=e[0],t[n++]=e[1],t[n++]=e[2],t[n++]=e[3],t},fi.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new fi),n[0]=e[t++],n[1]=e[t++],n[2]=e[t++],n[3]=e[t++],n},fi.clone=function(e,t){if(Ze(e))return Ze(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):new fi(e[0],e[2],e[1],e[3])},fi.fromArray=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new fi),n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n},fi.fromColumnMajorArray=function(e,t){return fi.clone(e,t)},fi.fromRowMajorArray=function(e,t){return Ze(t)?(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t):new fi(e[0],e[1],e[2],e[3])},fi.fromScale=function(e,t){return Ze(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=e.y,t):new fi(e.x,0,0,e.y)},fi.fromUniformScale=function(e,t){return Ze(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=e,t):new fi(e,0,0,e)},fi.fromRotation=function(e,t){var n=Math.cos(e),r=Math.sin(e);return Ze(t)?(t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t):new fi(n,-r,r,n)},fi.toArray=function(e,t){return Ze(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):[e[0],e[1],e[2],e[3]]},fi.getElementIndex=function(e,t){return 2*e+t},fi.getColumn=function(e,t,n){var r=2*t,i=e[r],o=e[1+r];return n.x=i,n.y=o,n},fi.setColumn=function(e,t,n,r){var i=2*t;return(r=fi.clone(e,r))[i]=n.x,r[1+i]=n.y,r},fi.getRow=function(e,t,n){var r=e[t],i=e[t+2];return n.x=r,n.y=i,n},fi.setRow=function(e,t,n,r){return(r=fi.clone(e,r))[t]=n.x,r[t+2]=n.y,r};var pi=new En;fi.getScale=function(e,t){return t.x=En.magnitude(En.fromElements(e[0],e[1],pi)),t.y=En.magnitude(En.fromElements(e[2],e[3],pi)),t};var di=new En;fi.getMaximumScale=function(e){return fi.getScale(e,di),En.maximumComponent(di)},fi.multiply=function(e,t,n){var r=e[0]*t[0]+e[2]*t[1],i=e[0]*t[2]+e[2]*t[3],o=e[1]*t[0]+e[3]*t[1],a=e[1]*t[2]+e[3]*t[3];return n[0]=r,n[1]=o,n[2]=i,n[3]=a,n},fi.add=function(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},fi.subtract=function(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},fi.multiplyByVector=function(e,t,n){var r=e[0]*t.x+e[2]*t.y,i=e[1]*t.x+e[3]*t.y;return n.x=r,n.y=i,n},fi.multiplyByScalar=function(e,t,n){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},fi.multiplyByScale=function(e,t,n){return n[0]=e[0]*t.x,n[1]=e[1]*t.x,n[2]=e[2]*t.y,n[3]=e[3]*t.y,n},fi.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},fi.transpose=function(e,t){var n=e[0],r=e[2],i=e[1],o=e[3];return t[0]=n,t[1]=r,t[2]=i,t[3]=o,t},fi.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t},fi.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},fi.equalsArray=function(e,t,n){return e[0]===t[n]&&e[1]===t[n+1]&&e[2]===t[n+2]&&e[3]===t[n+3]},fi.equalsEpsilon=function(e,t,n){return e===t||Ze(e)&&Ze(t)&&Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n},fi.IDENTITY=Object.freeze(new fi(1,0,0,1)),fi.ZERO=Object.freeze(new fi(0,0,0,0)),fi.COLUMN0ROW0=0,fi.COLUMN0ROW1=1,fi.COLUMN1ROW0=2,fi.COLUMN1ROW1=3,Object.defineProperties(fi.prototype,{length:{get:function(){return fi.packedLength}}}),fi.prototype.clone=function(e){return fi.clone(this,e)},fi.prototype.equals=function(e){return fi.equals(this,e)},fi.prototype.equalsEpsilon=function(e,t){return fi.equalsEpsilon(this,e,t)},fi.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n("+this[1]+", "+this[3]+")"};var mi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_i={SCALAR:void 0,VEC2:En,VEC3:_t,VEC4:qt,MAT2:fi,MAT3:jt,MAT4:on};function gi(e){var t=e.componentType,r="string"==typeof t?Mt.fromName(t):t,i=mi[e.type],n=_i[e.type];return{componentsPerAttribute:i,classType:n,createArrayBufferView:function(e,t,n){return Mt.createArrayBufferView(r,e,t,i*n)}}}var yi={NEVER:Rt.NEVER,LESS:Rt.LESS,EQUAL:Rt.EQUAL,LESS_OR_EQUAL:Rt.LEQUAL,GREATER:Rt.GREATER,NOT_EQUAL:Rt.NOTEQUAL,GREATER_OR_EQUAL:Rt.GEQUAL,ALWAYS:Rt.ALWAYS},vi=Object.freeze(yi),xi={ZERO:Rt.ZERO,KEEP:Rt.KEEP,REPLACE:Rt.REPLACE,INCREMENT:Rt.INCR,DECREMENT:Rt.DECR,INVERT:Rt.INVERT,INCREMENT_WRAP:Rt.INCR_WRAP,DECREMENT_WRAP:Rt.DECR_WRAP},bi=Object.freeze(xi),Ei={CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15,setCesium3DTileBit:function(){return{enabled:!0,frontFunction:vi.ALWAYS,frontOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.REPLACE},backFunction:vi.ALWAYS,backOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.REPLACE},reference:Ei.CESIUM_3D_TILE_MASK,mask:Ei.CESIUM_3D_TILE_MASK}}},Ti=Object.freeze(Ei);function Si(e,t,n,r){this.x=Je(e,0),this.y=Je(t,0),this.z=Je(n,0),this.w=Je(r,0)}var Ci=new _t;Si.fromAxisAngle=function(e,t,n){var r=t/2,i=Math.sin(r),o=(Ci=_t.normalize(e,Ci)).x*i,a=Ci.y*i,s=Ci.z*i,u=Math.cos(r);return Ze(n)?(n.x=o,n.y=a,n.z=s,n.w=u,n):new Si(o,a,s,u)};var wi=[1,2,0],Ai=new Array(3);Si.fromRotationMatrix=function(e,t){var n,r,i,o,a,s,u,l,c=e[jt.COLUMN0ROW0],h=e[jt.COLUMN1ROW1],f=e[jt.COLUMN2ROW2],p=c+h+f,d=0<p?(i=.5*(u=Math.sqrt(p+1)),u=.5/u,n=(e[jt.COLUMN1ROW2]-e[jt.COLUMN2ROW1])*u,r=(e[jt.COLUMN2ROW0]-e[jt.COLUMN0ROW2])*u,(e[jt.COLUMN0ROW1]-e[jt.COLUMN1ROW0])*u):(s=wi[a=wi[o=c<f&&h<f?2:c<h?1:0]],u=Math.sqrt(e[jt.getElementIndex(o,o)]-e[jt.getElementIndex(a,a)]-e[jt.getElementIndex(s,s)]+1),(l=Ai)[o]=.5*u,u=.5/u,i=(e[jt.getElementIndex(s,a)]-e[jt.getElementIndex(a,s)])*u,l[a]=(e[jt.getElementIndex(a,o)]+e[jt.getElementIndex(o,a)])*u,l[s]=(e[jt.getElementIndex(s,o)]+e[jt.getElementIndex(o,s)])*u,n=-l[0],r=-l[1],-l[2]);return Ze(t)?(t.x=n,t.y=r,t.z=d,t.w=i,t):new Si(n,r,d,i)};var Ii=new Si,Pi=new Si,Oi=new Si,Li=new Si;Si.fromHeadingPitchRoll=function(e,t){return Li=Si.fromAxisAngle(_t.UNIT_X,e.roll,Ii),Oi=Si.fromAxisAngle(_t.UNIT_Y,-e.pitch,t),t=Si.multiply(Oi,Li,Oi),Pi=Si.fromAxisAngle(_t.UNIT_Z,-e.heading,Ii),Si.multiply(Pi,t,t)};var Ni=new _t,Ri=new _t,Di=new Si,Mi=new Si,Fi=new Si;Si.packedLength=4,Si.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.x,t[n++]=e.y,t[n++]=e.z,t[n]=e.w,t},Si.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new Si),n.x=e[t],n.y=e[t+1],n.z=e[t+2],n.w=e[t+3],n},Si.packedInterpolationLength=3,Si.convertPackedArrayForInterpolation=function(e,t,n,r){Si.unpack(e,4*n,Fi),Si.conjugate(Fi,Fi);for(var i=0,o=n-t+1;i<o;i++){var a=3*i;Si.unpack(e,4*(t+i),Di),Si.multiply(Di,Fi,Di),Di.w<0&&Si.negate(Di,Di),Si.computeAxis(Di,Ni);var s=Si.computeAngle(Di);r[a]=Ni.x*s,r[1+a]=Ni.y*s,r[2+a]=Ni.z*s}},Si.unpackInterpolationResult=function(e,t,n,r,i){Ze(i)||(i=new Si),_t.fromArray(e,0,Ri);var o=_t.magnitude(Ri);return Si.unpack(t,4*r,Mi),0===o?Si.clone(Si.IDENTITY,Di):Si.fromAxisAngle(Ri,o,Di),Si.multiply(Di,Mi,i)},Si.clone=function(e,t){if(Ze(e))return Ze(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new Si(e.x,e.y,e.z,e.w)},Si.conjugate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},Si.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},Si.magnitude=function(e){return Math.sqrt(Si.magnitudeSquared(e))},Si.normalize=function(e,t){var n=1/Si.magnitude(e),r=e.x*n,i=e.y*n,o=e.z*n,a=e.w*n;return t.x=r,t.y=i,t.z=o,t.w=a,t},Si.inverse=function(e,t){var n=Si.magnitudeSquared(e);return t=Si.conjugate(e,t),Si.multiplyByScalar(t,1/n,t)},Si.add=function(e,t,n){return n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,n.w=e.w+t.w,n},Si.subtract=function(e,t,n){return n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z,n.w=e.w-t.w,n},Si.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},Si.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},Si.multiply=function(e,t,n){var r=e.x,i=e.y,o=e.z,a=e.w,s=t.x,u=t.y,l=t.z,c=t.w,h=a*s+r*c+i*l-o*u,f=a*u-r*l+i*c+o*s,p=a*l+r*u-i*s+o*c,d=a*c-r*s-i*u-o*l;return n.x=h,n.y=f,n.z=p,n.w=d,n},Si.multiplyByScalar=function(e,t,n){return n.x=e.x*t,n.y=e.y*t,n.z=e.z*t,n.w=e.w*t,n},Si.divideByScalar=function(e,t,n){return n.x=e.x/t,n.y=e.y/t,n.z=e.z/t,n.w=e.w/t,n},Si.computeAxis=function(e,t){var n=e.w;if(Math.abs(n-1)<pt.EPSILON6)return t.x=t.y=t.z=0,t;var r=1/Math.sqrt(1-n*n);return t.x=e.x*r,t.y=e.y*r,t.z=e.z*r,t},Si.computeAngle=function(e){return Math.abs(e.w-1)<pt.EPSILON6?0:2*Math.acos(e.w)};var zi=new Si;Si.lerp=function(e,t,n,r){return zi=Si.multiplyByScalar(t,n,zi),r=Si.multiplyByScalar(e,1-n,r),Si.add(zi,r,r)};var Bi=new Si,Ui=new Si,Vi=new Si;Si.slerp=function(e,t,n,r){var i=Si.dot(e,t),o=t;if(i<0&&(i=-i,o=Bi=Si.negate(t,Bi)),1-i<pt.EPSILON6)return Si.lerp(e,o,n,r);var a=Math.acos(i);return Ui=Si.multiplyByScalar(e,Math.sin((1-n)*a),Ui),Vi=Si.multiplyByScalar(o,Math.sin(n*a),Vi),r=Si.add(Ui,Vi,r),Si.multiplyByScalar(r,1/Math.sin(a),r)},Si.log=function(e,t){var n=pt.acosClamped(e.w),r=0;return 0!==n&&(r=n/Math.sin(n)),_t.multiplyByScalar(e,r,t)},Si.exp=function(e,t){var n=_t.magnitude(e),r=0;return 0!==n&&(r=Math.sin(n)/n),t.x=e.x*r,t.y=e.y*r,t.z=e.z*r,t.w=Math.cos(n),t};var ki=new _t,Gi=new _t,qi=new Si,Hi=new Si;Si.computeInnerQuadrangle=function(e,t,n,r){var i=Si.conjugate(t,qi);Si.multiply(i,n,Hi);var o=Si.log(Hi,ki);Si.multiply(i,e,Hi);var a=Si.log(Hi,Gi);return _t.add(o,a,o),_t.multiplyByScalar(o,.25,o),_t.negate(o,o),Si.exp(o,qi),Si.multiply(t,qi,r)},Si.squad=function(e,t,n,r,i,o){var a=Si.slerp(e,t,i,qi),s=Si.slerp(n,r,i,Hi);return Si.slerp(a,s,2*i*(1-i),o)};for(var Wi=new Si,Yi=1.9011074535173003,Xi=et.supportsTypedArrays()?new Float32Array(8):[],ji=et.supportsTypedArrays()?new Float32Array(8):[],Ki=et.supportsTypedArrays()?new Float32Array(8):[],Qi=et.supportsTypedArrays()?new Float32Array(8):[],Zi=0;Zi<7;++Zi){var Ji=Zi+1,$i=2*Ji+1;Xi[Zi]=1/(Ji*$i),ji[Zi]=Ji/$i}Xi[7]=Yi/136,ji[7]=8*Yi/17,Si.fastSlerp=function(e,t,n,r){var i,o=Si.dot(e,t);0<=o?i=1:(i=-1,o=-o);for(var a=o-1,s=1-n,u=n*n,l=s*s,c=7;0<=c;--c)Ki[c]=(Xi[c]*u-ji[c])*a,Qi[c]=(Xi[c]*l-ji[c])*a;var h=i*n*(1+Ki[0]*(1+Ki[1]*(1+Ki[2]*(1+Ki[3]*(1+Ki[4]*(1+Ki[5]*(1+Ki[6]*(1+Ki[7])))))))),f=s*(1+Qi[0]*(1+Qi[1]*(1+Qi[2]*(1+Qi[3]*(1+Qi[4]*(1+Qi[5]*(1+Qi[6]*(1+Qi[7])))))))),p=Si.multiplyByScalar(e,f,Wi);return Si.multiplyByScalar(t,h,r),Si.add(p,r,r)},Si.fastSquad=function(e,t,n,r,i,o){var a=Si.fastSlerp(e,t,i,qi),s=Si.fastSlerp(n,r,i,Hi);return Si.fastSlerp(a,s,2*i*(1-i),o)},Si.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},Si.equalsEpsilon=function(e,t,n){return e===t||Ze(e)&&Ze(t)&&Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n&&Math.abs(e.z-t.z)<=n&&Math.abs(e.w-t.w)<=n},Si.ZERO=Object.freeze(new Si(0,0,0,0)),Si.IDENTITY=Object.freeze(new Si(0,0,0,1)),Si.prototype.clone=function(e){return Si.clone(this,e)},Si.prototype.equals=function(e){return Si.equals(this,e)},Si.prototype.equalsEpsilon=function(e,t){return Si.equalsEpsilon(this,e,t)},Si.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var eo=It.WHITE,to=_t.ZERO;function no(e,t,n,r,i){var o;this.featuresLength=t,this._translucentFeaturesLength=0,Ze(n)&&(o=n.extensions),this._extensions=Je(o,{});var a,s,u,l,c,h,f,p,d=function(e){var t={};if(!Ze(e))return t;for(var n in e)e.hasOwnProperty(n)&&"HIERARCHY"!==n&&"extensions"!==n&&"extras"!==n&&(t[n]=$e(e[n],!0));return t}(n);this._properties=d,function(e,t){if(!Ze(e)||!Ze(e.extensions))return;var n=e.extensions["3DTILES_batch_table_EVFORMAT"];{var r,i,o;Ze(n)&&(r=t._tileset,i=t._tile,o=n.children,r.addNode_ev(i,o))}}(n,e),this._batchTableHierarchy=function(e,t,n){if(!Ze(t))return;var r=e._extensions["3DTILES_batch_table_hierarchy"],i=t.HIERARCHY;Ze(i)&&(no._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),e._extensions["3DTILES_batch_table_hierarchy"]=i,r=i);return Ze(r)?function(e,t){var n,r,i,o,a=e.instancesLength,s=e.classes,u=e.classIds,l=e.parentCounts,c=e.parentIds,h=a;Ze(u.byteOffset)&&(u.componentType=Je(u.componentType,Mt.UNSIGNED_SHORT),u.type=ni.SCALAR,i=gi(u),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,a));if(Ze(l))for(Ze(l.byteOffset)&&(l.componentType=Je(l.componentType,Mt.UNSIGNED_SHORT),l.type=ni.SCALAR,i=gi(l),l=i.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,a)),o=new Uint16Array(a),n=h=0;n<a;++n)o[n]=h,h+=l[n];Ze(c)&&Ze(c.byteOffset)&&(c.componentType=Je(c.componentType,Mt.UNSIGNED_SHORT),c.type=ni.SCALAR,i=gi(c),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,h));var f=s.length;for(n=0;n<f;++n){var p=s[n].length,d=s[n].instances,m=ro(p,d,t);s[n].instances=ne(m,d)}var _=bn(new Array(f),0),g=new Uint16Array(a);for(n=0;n<a;++n)r=u[n],g[n]=_[r],++_[r];return{classes:s,classIds:u,classIndexes:g,parentCounts:l,parentIndexes:o,parentIds:c}}(r,n):void 0}(this,n,r),this._batchTableBinaryProperties=ro(t,d,r),this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._transValues=void 0,this._translationTexture=void 0,this._defaultTransTexture=void 0,this._scaleValues=void 0,this._scaleTexture=void 0,this._defaultScaleTexture=void 0,this._rotationValues=void 0,this._rotationTexture=void 0,this._defaultRotationTexture=void 0,this._pickTexture=void 0,this._pickIds=[],this._content=e,this._colorChangedCallback=i,0<t&&(l=.5*(u=1/(a=Math.min(t,Nn.maximumTextureSize))),h=.5*(c=1/(s=Math.ceil(t/Nn.maximumTextureSize))),f=new En(a,s),p=new qt(u,l,c,h)),this._textureDimensions=f,this._textureStep=p}function ro(e,t,n){var r;for(var i in t)if(t.hasOwnProperty(i)){var o=t[i],a=o.byteOffset;if(Ze(a)){var s=o.componentType,u=o.type;if(!Ze(s))throw new de("componentType is required.");if(!Ze(u))throw new de("type is required.");if(!Ze(n))throw new de("Property "+i+" requires a batch table binary.");var l=gi(o),c=l.componentsPerAttribute,h=l.classType,f=l.createArrayBufferView(n.buffer,n.byteOffset+a,e);Ze(r)||(r={}),r[i]={typedArray:f,componentCount:c,type:h}}}return r}function io(e){var t=e._textureDimensions;return t.x*t.y*4}function oo(e){var t,n;return Ze(e._batchValues)||(t=io(e),bn(n=new Uint8Array(t),255),e._batchValues=n),e._batchValues}function ao(e){var t,n;return Ze(e._showAlphaProperties)||(t=2*e.featuresLength,bn(n=new Uint8Array(t),255),e._showAlphaProperties=n),e._showAlphaProperties}no._deprecationWarning=Bt,Object.defineProperties(no.prototype,{memorySizeInBytes:{get:function(){var e=0;return Ze(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),Ze(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),Ze(this._translationTexture)&&(e+=this._translationTexture.sizeInBytes),Ze(this._scaleTexture)&&(e+=this._scaleTexture.sizeInBytes),Ze(this._rotationTexture)&&(e+=this._rotationTexture.sizeInBytes),e}}}),no.getBinaryProperties=ro,no.prototype.setShow=function(e,t){var n,r,i;t&&!Ze(this._showAlphaProperties)||(i=t?255:0,(n=ao(this))[r=2*e]!==i&&(n[r]=i,oo(this)[4*e+3]=t?n[1+r]:0,this._batchValuesDirty=!0))},no.prototype.setAllShow=function(e){for(var t=this.featuresLength,n=0;n<t;++n)this.setShow(n,e)},no.prototype.getShow=function(e){if(!Ze(this._showAlphaProperties))return!0;var t=2*e;return 255===this._showAlphaProperties[t]};var so=new Array(4);no.prototype.setColor=function(e,t){var n,r,i,o,a,s,u,l,c;It.equals(t,eo)&&!Ze(this._batchValues)||(r=(n=t.toBytes(so))[3],i=oo(this),o=4*e,a=ao(this),s=2*e,i[o]===n[0]&&i[1+o]===n[1]&&i[2+o]===n[2]&&a[1+s]===r||(i[o]=n[0],i[1+o]=n[1],i[2+o]=n[2],u=255!==a[1+s],l=0!==a[s],i[3+o]=l?r:0,(c=255!==(a[1+s]=r))&&!u?++this._translucentFeaturesLength:!c&&u&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,Ze(this._colorChangedCallback)&&this._colorChangedCallback(e,t)))},no.prototype.setTranslation=function(e,t){var n,r,i,o,a,s;_t.equals(t,to)&&!Ze(this._transValues)||(Ze(this.upMatrix)&&on.multiplyByPoint(this.upMatrix,t,t),(n=[]).push(+t.x),n.push(+t.y),n.push(+t.z),Ze((i=this)._transValues)||(o=io(i),bn(a=new Float32Array(o),0),i._transValues=a),(r=i._transValues)[s=4*e]===n[0]&&r[1+s]===n[1]&&r[2+s]===n[2]||(r[s]=n[0],r[1+s]=n[1],r[2+s]=n[2],this._batchValuesDirty=!0))};var uo=new _t(1,1,1);no.prototype.setScale=function(e,t){var n,r,i,o,a,s,u;_t.equals(t,uo)&&!Ze(this._scaleValues)||(Ze(this.upMatrix)&&(n=t.y,t.y=t.z,t.z=n),(r=[]).push(+t.x),r.push(+t.y),r.push(+t.z),Ze((o=this)._scaleValues)||(a=io(o),bn(s=new Float32Array(a),1),o._scaleValues=s),(i=o._scaleValues)[u=4*e]===r[0]&&i[1+u]===r[1]&&i[2+u]===r[2]||(i[u]=r[0],i[1+u]=r[1],i[2+u]=r[2],this._batchValuesDirty=!0))};var lo=new qt(0,0,0,1);no.prototype.setRotation=function(e,t){var n,r,i,o,a,s;qt.equals(t,lo)&&!Ze(this._rotationValues)||(Ze(this.upMatrix)&&(n=new Si(t.x,t.y,t.z,t.w),r=Si.computeAngle(n),i=Si.computeAxis(n,new _t),on.multiplyByPoint(this.upMatrix,i,i),t=Si.fromAxisAngle(i,r)),(o=[]).push(t.x),o.push(t.y),o.push(t.z),o.push(t.w),(a=function(e){if(!Ze(e._rotationValues)){for(var t=io(e),n=new Float32Array(t),r=0;r<t;r+=4)n[r]=0,n[r+1]=0,n[r+2]=0,n[r+3]=1;e._rotationValues=n}return e._rotationValues}(this))[s=4*e]===o[0]&&a[1+s]===o[1]&&a[2+s]===o[2]&&a[3+s]===o[3]||(a[s]=o[0],a[1+s]=o[1],a[2+s]=o[2],a[3+s]=o[3],this._batchValuesDirty=!0))},no.prototype.setAllColor=function(e){for(var t=this.featuresLength,n=0;n<t;++n)this.setColor(n,e)},no.prototype.getColor=function(e,t){if(!Ze(this._batchValues))return It.clone(eo,t);var n=this._batchValues,r=4*e,i=this._showAlphaProperties,o=2*e;return It.fromBytes(n[r],n[1+r],n[2+r],i[1+o],t)},no.prototype.getPickColor=function(e){return this._pickIds[e]};var co=new It;function ho(e,t){var n=e.typedArray,r=e.componentCount;return 1===r?n[t]:e.type.unpack(n,t*r)}function fo(e,t,n){var r=e.typedArray,i=e.componentCount;1===i?r[t]=n:e.type.pack(n,r,t*i)}no.prototype.applyStyle=function(e){if(!Ze(e))return this.setAllColor(eo),void this.setAllShow(!0);for(var t=this._content,n=this.featuresLength,r=0;r<n;++r){var i,o,a,s=t.getFeature(r),u=Ze(e.color)?e.color.evaluateColor(s,co):eo,l=!Ze(e.show)||e.show.evaluate(s);this.setColor(r,u),this.setShow(r,l),Ze(e.translation)&&(i=e.translation.evaluate(s),this.setTranslation(r,i)),Ze(e.scale)&&(o=e.scale.evaluate(s),this.setScale(r,o)),Ze(e.rotation)&&(a=e.rotation.evaluate(s),this.setRotation(r,a))}};var po=[],mo=[],_o=0;function go(e,t,n){var r=e.parentCounts;return Ze(e.parentIds)?(Ze(r)?function(e,t,n){var r=e.classIds,i=e.parentCounts,o=e.parentIds,a=e.parentIndexes,s=r.length,u=po;u.length=Math.max(u.length,s);var l=++_o,c=mo;for(c.length=0,c.push(t);0<c.length;)if(u[t=c.pop()]!==l){u[t]=l;var h=n(e,t);if(Ze(h))return h;for(var f=i[t],p=a[t],d=0;d<f;++d){var m=o[p+d];m!==t&&c.push(m)}}}:function(e,t,n){for(var r=!0;r;){var i=n(e,t);if(Ze(i))return i;var o=e.parentIds[t],r=o!==t;t=o}})(e,t,n):n(e,t)}no.prototype.isClass=function(e,r){var t=this._batchTableHierarchy;return!!Ze(t)&&Ze(go(t,e,function(e,t){var n=e.classIds[t];if(e.classes[n].name===r)return!0}))},no.prototype.isExactClass=function(e,t){return this.getExactClassName(e)===t},no.prototype.getExactClassName=function(e){var t=this._batchTableHierarchy;if(Ze(t)){var n=t.classIds[e];return t.classes[n].name}},no.prototype.hasProperty=function(e,t){return Ze(this._properties[t])||Ze(this._batchTableHierarchy)&&(n=e,r=t,i=go(this._batchTableHierarchy,n,function(e,t){var n=e.classIds[t];if(Ze(e.classes[n].instances[r]))return!0}),Ze(i));var n,r,i},no.prototype.getPropertyNames=function(e,t){(t=Ze(t)?t:[]).length=0;var n,o,r=Object.keys(this._properties);return t.push.apply(t,r),Ze(this._batchTableHierarchy)&&(n=e,o=t,go(this._batchTableHierarchy,n,function(e,t){var n=e.classIds[t],r=e.classes[n].instances;for(var i in r)r.hasOwnProperty(i)&&-1===o.indexOf(i)&&o.push(i)})),t},no.prototype.getProperty=function(e,t){if(Ze(this._batchTableBinaryProperties)){var n=this._batchTableBinaryProperties[t];if(Ze(n))return ho(n,e)}var r,a,i=this._properties[t];if(Ze(i))return $e(i[e],!0);if(Ze(this._batchTableHierarchy)){var o=(r=e,a=t,go(this._batchTableHierarchy,r,function(e,t){var n=e.classIds[t],r=e.classes[n],i=e.classIndexes[t],o=r.instances[a];if(Ze(o))return Ze(o.typedArray)?ho(o,i):$e(o[i],!0)}));if(Ze(o))return o}},no.prototype.setProperty=function(e,t,n){var r,a,s,i,o,u=this.featuresLength;if(Ze(this._batchTableBinaryProperties)){var l=this._batchTableBinaryProperties[t];if(Ze(l))return void fo(l,e,n)}Ze(this._batchTableHierarchy)&&(r=e,a=t,s=n,i=go(this._batchTableHierarchy,r,function(e,t){var n=e.classIds[t],r=e.classes[n],i=e.classIndexes[t],o=r.instances[a];if(Ze(o))return Ze(o.typedArray)?fo(o,i,s):o[i]=$e(s,!0),!0}),Ze(i))||(Ze(o=this._properties[t])||(this._properties[t]=new Array(u),o=this._properties[t]),o[e]=$e(n,!0))};var yo="mat4 ev_fromTranslationQuaternionRotationScale(vec3 translation, vec4 quaternion, vec3 scale)\n{\n      float x2 = quaternion.x * quaternion.x;\n      float xy = quaternion.x * quaternion.y;\n      float xz = quaternion.x * quaternion.z;\n      float xw = quaternion.x * quaternion.w;\n      float y2 = quaternion.y * quaternion.y;\n      float yz = quaternion.y * quaternion.z;\n      float yw = quaternion.y * quaternion.w;\n      float z2 = quaternion.z * quaternion.z;\n      float zw = quaternion.z * quaternion.w;\n      float w2 = quaternion.w * quaternion.w;\n\n      float m00 = x2 - y2 - z2 + w2;\n      float m01 = 2.0 * (xy - zw);\n      float m02 = 2.0 * (xz + yw);\n\n      float m10 = 2.0 * (xy + zw);\n      float m11 = -x2 + y2 - z2 + w2;\n      float m12 = 2.0 * (yz - xw);\n\n      float m20 = 2.0 * (xz - yw);\n      float m21 = 2.0 * (yz + xw);\n      float m22 = -x2 - y2 + z2 + w2;\n      return mat4(\n        m00 * scale.x , m01* scale.x, m02* scale.x, 0.0,\n        m10 * scale.y, m11 * scale.y, m12 * scale.y, 0.0,\n        m20 * scale.z, m21 * scale.z, m22 * scale.z, 0.0,\n        translation.x, translation.y, translation.z, 1.0);\n}\n";function vo(e,t){return e=Xr.replaceMain(e,"tile_main"),t?e+"uniform float tile_colorBlend; \nvoid tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n     if(highlight== 0.0 && !all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ \n         gl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4); \n      } \n} \n":e+"void tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n} \n"}function xo(e,t,n){if(!Ze(t))return vo(e,n);var r=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+t+";"),i=e.match(r);if(!Ze(i))return vo(e,n);var o=i[0],a=i[2];e=(e=Xr.replaceMain(e,"tile_main")).replace(o,"");var s,u,l;return"vec3"===a||"vec4"===a?(u="vec3"===a?"vec4("+t+", 1.0)":t,l="vec3"===a?"tile_diffuse.xyz":"tile_diffuse",r=new RegExp(t,"g"),e=e.replace(r,l),s="    vec4 source = "+u+"; \n    tile_diffuse = tile_diffuse_final(source, tile_featureColor); \n    tile_main(); \n"):"sampler2D"===a&&(e=function(e,t){for(var n,r="texture2D("+t,i=0,o=e.indexOf(r,i);-1<o;){for(var a=0,s=o;s<e.length;++s){var u=e.charAt(s);if("("===u)++a;else if(")"===u&&0===--a){n=s+1;break}}var l="tile_diffuse_final("+e.slice(o,n)+", tile_diffuse)";e=e.slice(0,o)+l+e.slice(n),i=o+l.length,o=e.indexOf(r,i)}return e}(e,t),s="    tile_diffuse = tile_featureColor; \n    tile_main(); \n"),e="uniform float tile_colorBlend; \nvec4 tile_diffuse = vec4(1.0); \nbool isWhite(vec3 color) \n{ \n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); \n} \nvec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) \n{ \n    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); \n    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; \n    return vec4(diffuse.rgb, sourceDiffuse.a); \n} \n"+o+"\n"+e+"\nvoid tile_color(vec4 tile_featureColor) \n{ \n"+s,n&&(e+="    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ \n\tif(highlight== 0.0){\n\t\tgl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);\n\t}else if(highlight== 1.0){\n\t\tgl_FragColor.rgb = tile_featureColor.rgb;\n\t}else{\n\t\tgl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);\n\t}\n }"),e+="} \n"}no.prototype.getVertexShaderCallback=function(i,o,a){if(0!==this.featuresLength){var s=this;return function(e){var t,n=xo(e,a,!1),r=!1;return-1!=n.indexOf("gl_Position = u_modelViewProj * vec4(a_position,1.0);")?(r=!0,n=(n=n.replace("attribute vec3 a_position;","attribute vec3 a_position;\nvec4 trans;\nvec4 scale;\nvec4 rotation;")).replace("gl_Position = u_modelViewProj * vec4(a_position,1.0);","gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0));"),n=yo+n):-1!=n.indexOf("vec3 gltf_a_dec_position")?(r=!0,-1!=(n=n.replace("vec3 gltf_a_dec_position;","vec3 gltf_a_dec_position;\nvec4 trans;\nvec4 scale;\nvec4 rotation;")).indexOf("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0)")?n=n.replace("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0);"," gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0));"):-1!=n.indexOf("gl_Position = czm_instanced_modelViewProjection * vec4(gltf_a_dec_position,1.0)")?n=n.replace("gltf_a_dec_position = gltf_u_dec_position_min + a_position * gltf_u_dec_position_normConstant;","gltf_a_dec_position = gltf_u_dec_position_min + (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0)).xyz* gltf_u_dec_position_normConstant;"):-1!=n.indexOf("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0)")&&(n=n.replace("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0);","xlat_temp_input.position = ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0);")),n=yo+n):-1!=n.indexOf("position = u_modelViewMatrix * position")&&(r=!0,n=(n=n.replace("attribute vec3 a_position;","attribute vec3 a_position;\nvec4 trans;\nvec4 scale;\nvec4 rotation;")).replace("position = u_modelViewMatrix * position;","position = u_modelViewMatrix * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * position);"),n=yo+n),0<Nn.maximumVertexTextureImageUnits?(t="",i&&(t+="uniform bool tile_translucentCommand; \n"),t+="uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_transTexture; \nuniform sampler2D tile_scaleTexture; \nuniform sampler2D tile_rotationTexture; \nvarying vec4 tile_featureColor; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec2 st = computeSt("+o+"); \n    vec4 featureProperties = texture2D(tile_batchTexture, st); \n",r&&(t+="    trans = texture2D(tile_transTexture, vec2(st.x,0.0)); \n",t+="    scale = texture2D(tile_scaleTexture, vec2(st.x,0.0)); \n",t+="    rotation = texture2D(tile_rotationTexture, vec2(st.x,0.0)); \n"),t+="    tile_color(featureProperties); \n    float show = ceil(featureProperties.a); \n    gl_Position *= show; \n",i&&(t+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n"),t+="    tile_featureColor = featureProperties; \n    tile_featureSt = st; \n}"):t="varying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_color(vec4(1.0)); \n    tile_featureSt = computeSt("+o+"); \n}",n+"\n"+(1===s._textureDimensions.y?"uniform vec4 tile_textureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    return vec2(centerX + (batchId * stepX), 0.5); \n} \n":"uniform vec4 tile_textureStep; \nuniform vec2 tile_textureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    float stepY = tile_textureStep.z; \n    float centerY = tile_textureStep.w; \n    float xId = mod(batchId, tile_textureDimensions.x); \n    float yId = floor(batchId / tile_textureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n")+t}}},no.prototype.getFragmentShaderCallback=function(t,n){if(0!==this.featuresLength)return function(e){return e=xo(e,n,!0),0<Nn.maximumVertexTextureImageUnits?e+="uniform sampler2D tile_pickTexture; \nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_color(tile_featureColor); \n}":(t&&(e+="uniform bool tile_translucentCommand; \n"),e+="uniform sampler2D tile_pickTexture; \nuniform sampler2D tile_batchTexture; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n",t&&(e+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            discard; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            discard; \n        } \n    } \n"),e+="    tile_color(featureProperties); \n} \n"),e}},no.prototype.getClassificationFragmentShaderCallback=function(){if(0!==this.featuresLength)return function(e){return e=Xr.replaceMain(e,"tile_main"),0<Nn.maximumVertexTextureImageUnits?e+="uniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_main(); \n    gl_FragColor = tile_featureColor; \n}":e+="uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_main(); \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = featureProperties; \n} \n",e}},no.prototype.getUniformMapCallback=function(){if(0!==this.featuresLength){var r=this;return function(e){return ne(e,{tile_batchTexture:function(){return Je(r._batchTexture,r._defaultTexture)},tile_transTexture:function(){return Je(r._translationTexture,r._defaultTransTexture)},tile_scaleTexture:function(){return Je(r._scaleTexture,r._defaultScaleTexture)},tile_rotationTexture:function(){return Je(r._rotationTexture,r._defaultRotationTexture)},tile_textureDimensions:function(){return r._textureDimensions},tile_textureStep:function(){return r._textureStep},tile_colorBlend:function(){return e=r._content.tileset,t=e.colorBlendMode,n=e.colorBlendAmount,t===li.HIGHLIGHT?0:t===li.REPLACE?1:t===li.MIX?pt.clamp(n,pt.EPSILON4,1):void 0;var e,t,n},tile_pickTexture:function(){return Je(r._pickTexture,r._defaultTexture)}})}}},no.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"};var bo=0,Eo=1,To=2;function So(e){var t=Mn.shallowClone(e),n=t.pass===yn.TRANSLUCENT;return t.uniformMap=Ze(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return n},t}function Co(e){var t,n,r=Mn.shallowClone(e);return r.pass=yn.TRANSLUCENT,r.renderState=(t=e.renderState,(n=$e(t,!0)).cull.enabled=!1,n.depthTest.enabled=!0,n.depthMask=!1,n.blending=ui.ALPHA_BLEND,sr.fromCache(n)),r}function wo(e){var t,n,r=Mn.shallowClone(e);return r.renderState=(t=e.renderState,(n=$e(t,!0)).stencilTest=Ti.setCesium3DTileBit(),n.stencilMask=Ti.CESIUM_3D_TILE_MASK,sr.fromCache(n)),r}function Ao(e,t){var n=Mn.shallowClone(t),r=$e(n.renderState,!0);r.cull.enabled=!0,r.cull.face=hi.FRONT,r.colorMask={red:!1,green:!1,blue:!1,alpha:!1},r.polygonOffset={enabled:!0,factor:5,units:5},r.stencilTest=Ti.setCesium3DTileBit(),r.stencilMask=Ti.CESIUM_3D_TILE_MASK,n.renderState=sr.fromCache(r),n.castShadows=!1,n.receiveShadows=!1,n.uniformMap=$e(t.uniformMap);var i,o,a,s,u=new En(5,5);return n.uniformMap.u_polygonOffset=function(){return u},n.shaderProgram=(i=e,o=t.shaderProgram,Ze(s=i.shaderCache.getDerivedShaderProgram(o,"zBackfaceLogDepth"))||((a=o.fragmentShaderSource.clone()).defines=Ze(a.defines)?a.defines.slice(0):[],a.defines.push("POLYGON_OFFSET"),a.sources.unshift("#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"),s=i.shaderCache.createDerivedShaderProgram(o,"zBackfaceLogDepth",{vertexShaderSource:o.vertexShaderSource,fragmentShaderSource:a,attributeLocations:o._attributeLocations})),s),n}function Io(e,t){var n=Mn.shallowClone(e),r=$e(n.renderState,!0);return r.stencilTest.enabled=!0,r.stencilTest.mask=Ti.SKIP_LOD_MASK,r.stencilTest.reference=Ti.CESIUM_3D_TILE_MASK|t<<Ti.SKIP_LOD_BIT_SHIFT,r.stencilTest.frontFunction=vi.GREATER_OR_EQUAL,r.stencilTest.frontOperation.zPass=bi.REPLACE,r.stencilTest.backFunction=vi.GREATER_OR_EQUAL,r.stencilTest.backOperation.zPass=bi.REPLACE,r.stencilMask=Ti.CESIUM_3D_TILE_MASK|Ti.SKIP_LOD_MASK,n.renderState=sr.fromCache(r),n}function Po(e,t,n){var r=e._textureDimensions;return new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.UNSIGNED_BYTE,source:{width:r.x,height:r.y,arrayBufferView:n},flipY:!1,sampler:Nr.NEAREST})}function Oo(e,t,n){var r=e._textureDimensions;return new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.FLOAT,source:{width:r.x,height:r.y,arrayBufferView:n},flipY:!1,sampler:Nr.NEAREST})}function Lo(e,t){var n=e.featuresLength;if(!Ze(e._pickTexture)&&0<n){for(var r=e._pickIds,i=io(e),o=new Uint8Array(i),a=e._content,s=0;s<n;++s){var u=t.createPickId(a.getFeature(s));r.push(u);var l=u.color,c=4*s;o[c]=It.floatToByte(l.red),o[1+c]=It.floatToByte(l.green),o[2+c]=It.floatToByte(l.blue),o[3+c]=It.floatToByte(l.alpha)}e._pickTexture=Po(e,t,o),a.tileset._statistics.batchTableByteLength+=e._pickTexture.sizeInBytes}}function No(e){var t=e._textureDimensions;e._batchTexture.copyFrom({width:t.x,height:t.y,arrayBufferView:e._batchValues})}function Ro(e,t,n){var r=e._textureDimensions;n.copyFrom({width:r.x,height:r.y,arrayBufferView:t})}function Do(e,t){return new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([0,0,0,1])},flipY:!1,sampler:Nr.NEAREST})}function Mo(e,t){return new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([1,1,1,1])},flipY:!1,sampler:Nr.NEAREST})}function Fo(e,t){this._content=e,this._batchId=t,this._color=void 0}function zo(e,t){this.json=e,this.buffer=t,this._cachedTypedArrays={},this.featuresLength=0}function Bo(e,t,n,r,i,o){var a=e._cachedTypedArrays,s=a[t];return Ze(s)||(s=Mt.createArrayBufferView(n,e.buffer.buffer,e.buffer.byteOffset+o,i*r),a[t]=s),s}function Uo(e,t,n){if("function"==typeof e.slice)return e.slice(t,n);for(var r=Array.prototype.slice.call(e,t,n),i=et.typedArrayTypes,o=i.length,a=0;a<o;++a)if(e instanceof i[a]){r=new i[a](r);break}return r}function Vo(e,t){this.start=Je(e,0),this.stop=Je(t,0)}function ko(e,t){this.center=_t.clone(Je(e,_t.ZERO)),this.radius=Je(t,0)}no.prototype.addDerivedCommands=function(e,t){for(var n,r=e.commandList,i=r.length,o=this._content._tile,a=o._finalResolution,s=o.tileset,u=s._skipLevelOfDetail&&s._hasMixedContent&&e.context.stencilBuffer,l=function(e){var t=e._translucentFeaturesLength;{if(0===t)return bo;if(t===e.featuresLength)return Eo}return To}(this),c=t;c<i;++c){var h=r[c],f=h.derivedCommands.tileset;Ze(f)&&!h.dirty||(f={},(h.derivedCommands.tileset=f).originalCommand=So(h),h.dirty=!1);var p=f.originalCommand;l!==bo&&h.pass!==yn.TRANSLUCENT&&(Ze(f.translucent)||(f.translucent=Co(p))),l!==Eo&&h.pass!==yn.TRANSLUCENT&&(Ze(f.opaque)||(f.opaque=wo(p)),u&&(a||(Ze(f.zback)||(f.zback=Ao(e.context,p)),s._backfaceCommands.push(f.zback)),Ze(f.stencil)&&o._selectionDepth===(n=f.stencil,(n.renderState.stencilTest.reference&Ti.SKIP_LOD_MASK)>>>Ti.SKIP_LOD_BIT_SHIFT)||(h.renderState.depthMask?f.stencil=Io(p,o._selectionDepth):f.stencil=f.opaque)));var d=u?f.stencil:f.opaque,m=f.translucent;h.pass!==yn.TRANSLUCENT?(l===bo&&(r[c]=d),l===Eo&&(r[c]=m),l===To&&(r[c]=d,r.push(m))):r[c]=p}},no.prototype.update=function(e,t){var n=t.context;this._defaultTexture=n.defaultTexture,!Ze(this._defaultTransTexture)&&Ze(this._textureDimensions)&&(this._defaultTransTexture=Do(0,n)),!Ze(this._defaultScaleTexture)&&Ze(this._textureDimensions)&&(this._defaultScaleTexture=Mo(0,n)),!Ze(this._defaultRotationTexture)&&Ze(this._textureDimensions)&&(this._defaultRotationTexture=Do(0,n));var r=t.passes;(r.pick||r.postProcess)&&Lo(this,n),this._batchValuesDirty&&(this._batchValuesDirty=!1,!Ze(this._batchTexture)&&Ze(this._batchValues)&&(this._batchTexture=Po(this,n,this._batchValues),e._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes),!Ze(this._translationTexture)&&Ze(this._transValues)&&(this._translationTexture=Oo(this,n,this._transValues)),!Ze(this._scaleTexture)&&Ze(this._scaleValues)&&(this._scaleTexture=Oo(this,n,this._scaleValues)),!Ze(this._rotationTexture)&&Ze(this._rotationValues)&&(this._rotationTexture=Oo(this,n,this._rotationValues)),Ze(this._batchValues)&&No(this),Ze(this._transValues)&&Ro(this,this._transValues,this._translationTexture),Ze(this._scaleValues)&&Ro(this,this._scaleValues,this._scaleTexture),Ze(this._rotationValues)&&Ro(this,this._rotationValues,this._rotationTexture))},no.prototype.updateNoStatistics=function(e,t){var n=t.context;this._defaultTexture=n.defaultTexture,!Ze(this._defaultTransTexture)&&Ze(this._textureDimensions)&&(this._defaultTransTexture=Do(0,n)),!Ze(this._defaultScaleTexture)&&Ze(this._textureDimensions)&&(this._defaultTransTexture=Mo(0,n)),!Ze(this._defaultRotationTexture)&&Ze(this._textureDimensions)&&(this._defaultTransTexture=Do(0,n));var r=t.passes;(r.pick||r.postProcess)&&Lo(this,n),this._batchValuesDirty&&(this._batchValuesDirty=!1,!Ze(this._batchTexture)&&Ze(this._batchValues)&&(this._batchTexture=Po(this,n,this._batchValues)),!Ze(this._translationTexture)&&Ze(this._transValues)&&(this._translationTexture=Oo(this,n,this._transValues)),!Ze(this._scaleTexture)&&Ze(this._scaleValues)&&(this._scaleTexture=Oo(this,n,this._scaleValues)),!Ze(this._rotationTexture)&&Ze(this._rotationValues)&&(this._rotationTexture=Oo(this,n,this._rotationValues)),Ze(this._batchValues)&&No(this),Ze(this._transValues)&&Ro(this,this._transValues,this._translationTexture),Ze(this._scaleValues)&&Ro(this,this._scaleValues,this._scaleTexture),Ze(this._rotationValues)&&Ro(this,this._rotationValues,this._rotationTexture))},no.prototype.isDestroyed=function(){return!1},no.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._translationTexture=this._translationTexture&&this._translationTexture.destroy(),this._scaleTexture=this._scaleTexture&&this._scaleTexture.destroy(),this._rotationTexture=this._rotationTexture&&this._rotationTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();for(var e=this._pickIds,t=e.length,n=0;n<t;++n)e[n].destroy();return Vt(this)},no._DEFAULT_COLOR_VALUE=eo,no._DEFAULT_SHOW_VALUE=!0,Object.defineProperties(Fo.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(e){this._content.batchTable.setShow(this._batchId,e)}},color:{get:function(){return Ze(this._color)||(this._color=new It),this._content.batchTable.getColor(this._batchId,this._color)},set:function(e){this._content.batchTable.setColor(this._batchId,e)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickId:{get:function(){if(!this._content.isDestroyed())return this._content.batchTable.getPickColor(this._batchId)}}}),Fo.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)},Fo.prototype.getPropertyNames=function(e){return this._content.batchTable.getPropertyNames(this._batchId,e)},Fo.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)},Fo.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0},Fo.prototype.setTranslation=function(e){this._content.batchTable.setTranslation(this._batchId,e)},Fo.prototype.setScale=function(e){this._content.batchTable.setScale(this._batchId,e)},Fo.prototype.setRotation=function(e){this._content.batchTable.setRotation(this._batchId,e)},Fo.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)},Fo.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)},Fo.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)},zo.prototype.getGlobalProperty=function(e,t,n){var r=this.json[e];if(Ze(r))return Ze(r.byteOffset)?Bo(this,e,t=Je(t,Mt.UNSIGNED_INT),n=Je(n,1),1,r.byteOffset):r},zo.prototype.getPropertyArray=function(e,t,n){var r,i,o,a,s,u=this.json[e];if(Ze(u))return Ze(u.byteOffset)?(Ze(u.componentType)&&(t=Mt.fromName(u.componentType)),Bo(this,e,t,n,this.featuresLength,u.byteOffset)):(r=e,i=t,o=u,a=this._cachedTypedArrays,Ze(s=a[r])||(s=Mt.createTypedArray(i,o),a[r]=s),s)},zo.prototype.getProperty=function(e,t,n,r,i){if(Ze(this.json[e])){var o=this.getPropertyArray(e,t,n);if(1===n)return o[r];for(var a=0;a<n;++a)i[a]=o[n*r+a];return i}};var Go=new _t,qo=new _t,Ho=new _t,Wo=new _t,Yo=new _t,Xo=new _t,jo=new _t,Ko=new _t,Qo=new _t,Zo=new _t,Jo=new _t,$o=new _t,ea=4/3*pt.PI;ko.fromPoints=function(e,t){if(Ze(t)||(t=new ko),!Ze(e)||0===e.length)return t.center=_t.clone(_t.ZERO,t.center),t.radius=0,t;for(var n=_t.clone(e[0],jo),r=_t.clone(n,Go),i=_t.clone(n,qo),o=_t.clone(n,Ho),a=_t.clone(n,Wo),s=_t.clone(n,Yo),u=_t.clone(n,Xo),l=e.length,c=1;c<l;c++){_t.clone(e[c],n);var h=n.x,f=n.y,p=n.z;h<r.x&&_t.clone(n,r),h>a.x&&_t.clone(n,a),f<i.y&&_t.clone(n,i),f>s.y&&_t.clone(n,s),p<o.z&&_t.clone(n,o),p>u.z&&_t.clone(n,u)}var d=_t.magnitudeSquared(_t.subtract(a,r,Ko)),m=_t.magnitudeSquared(_t.subtract(s,i,Ko)),_=_t.magnitudeSquared(_t.subtract(u,o,Ko)),g=r,y=a,v=d;v<m&&(v=m,g=i,y=s),v<_&&(v=_,g=o,y=u);var x=Qo;x.x=.5*(g.x+y.x),x.y=.5*(g.y+y.y),x.z=.5*(g.z+y.z);var b=_t.magnitudeSquared(_t.subtract(y,x,Ko)),E=Math.sqrt(b),T=Zo;T.x=r.x,T.y=i.y,T.z=o.z;var S=Jo;S.x=a.x,S.y=s.y,S.z=u.z;var C=_t.midpoint(T,S,$o),w=0;for(c=0;c<l;c++){_t.clone(e[c],n);var A=_t.magnitude(_t.subtract(n,C,Ko));w<A&&(w=A);var I,P,O=_t.magnitudeSquared(_t.subtract(n,x,Ko));b<O&&(b=(E=.5*(E+(I=Math.sqrt(O))))*E,P=I-E,x.x=(E*x.x+P*n.x)/I,x.y=(E*x.y+P*n.y)/I,x.z=(E*x.z+P*n.z)/I)}return E<w?(_t.clone(x,t.center),t.radius=E):(_t.clone(C,t.center),t.radius=w),t};var ta=new Zn,na=new _t,ra=new _t,ia=new Un,oa=new Un;ko.fromRectangle2D=function(e,t,n){return ko.fromRectangleWithHeights2D(e,t,0,0,n)},ko.fromRectangleWithHeights2D=function(e,t,n,r,i){if(Ze(i)||(i=new ko),!Ze(e))return i.center=_t.clone(_t.ZERO,i.center),i.radius=0,i;t=Je(t,ta),$n.southwest(e,ia),ia.height=n,$n.northeast(e,oa),oa.height=r;var o=t.project(ia,na),a=t.project(oa,ra),s=a.x-o.x,u=a.y-o.y,l=a.z-o.z;i.radius=.5*Math.sqrt(s*s+u*u+l*l);var c=i.center;return c.x=o.x+.5*s,c.y=o.y+.5*u,c.z=o.z+.5*l,i};var aa=[];ko.fromRectangle3D=function(e,t,n,r){if(t=Je(t,Wn.WGS84),n=Je(n,0),Ze(r)||(r=new ko),!Ze(e))return r.center=_t.clone(_t.ZERO,r.center),r.radius=0,r;var i=$n.subsample(e,t,n,aa);return ko.fromPoints(i,r)},ko.fromVertices=function(e,t,n,r){if(Ze(r)||(r=new ko),!Ze(e)||0===e.length)return r.center=_t.clone(_t.ZERO,r.center),r.radius=0,r;t=Je(t,_t.ZERO),n=Je(n,3);var i=jo;i.x=e[0]+t.x,i.y=e[1]+t.y,i.z=e[2]+t.z;for(var o=_t.clone(i,Go),a=_t.clone(i,qo),s=_t.clone(i,Ho),u=_t.clone(i,Wo),l=_t.clone(i,Yo),c=_t.clone(i,Xo),h=e.length,f=0;f<h;f+=n){var p=e[f]+t.x,d=e[f+1]+t.y,m=e[f+2]+t.z;i.x=p,i.y=d,i.z=m,p<o.x&&_t.clone(i,o),p>u.x&&_t.clone(i,u),d<a.y&&_t.clone(i,a),d>l.y&&_t.clone(i,l),m<s.z&&_t.clone(i,s),m>c.z&&_t.clone(i,c)}var _=_t.magnitudeSquared(_t.subtract(u,o,Ko)),g=_t.magnitudeSquared(_t.subtract(l,a,Ko)),y=_t.magnitudeSquared(_t.subtract(c,s,Ko)),v=o,x=u,b=_;b<g&&(b=g,v=a,x=l),b<y&&(b=y,v=s,x=c);var E=Qo;E.x=.5*(v.x+x.x),E.y=.5*(v.y+x.y),E.z=.5*(v.z+x.z);var T=_t.magnitudeSquared(_t.subtract(x,E,Ko)),S=Math.sqrt(T),C=Zo;C.x=o.x,C.y=a.y,C.z=s.z;var w=Jo;w.x=u.x,w.y=l.y,w.z=c.z;var A=_t.midpoint(C,w,$o),I=0;for(f=0;f<h;f+=n){i.x=e[f]+t.x,i.y=e[f+1]+t.y,i.z=e[f+2]+t.z;var P=_t.magnitude(_t.subtract(i,A,Ko));I<P&&(I=P);var O,L,N=_t.magnitudeSquared(_t.subtract(i,E,Ko));T<N&&(T=(S=.5*(S+(O=Math.sqrt(N))))*S,L=O-S,E.x=(S*E.x+L*i.x)/O,E.y=(S*E.y+L*i.y)/O,E.z=(S*E.z+L*i.z)/O)}return S<I?(_t.clone(E,r.center),r.radius=S):(_t.clone(A,r.center),r.radius=I),r},ko.fromEncodedCartesianVertices=function(e,t,n){if(Ze(n)||(n=new ko),!Ze(e)||!Ze(t)||e.length!==t.length||0===e.length)return n.center=_t.clone(_t.ZERO,n.center),n.radius=0,n;var r=jo;r.x=e[0]+t[0],r.y=e[1]+t[1],r.z=e[2]+t[2];for(var i=_t.clone(r,Go),o=_t.clone(r,qo),a=_t.clone(r,Ho),s=_t.clone(r,Wo),u=_t.clone(r,Yo),l=_t.clone(r,Xo),c=e.length,h=0;h<c;h+=3){var f=e[h]+t[h],p=e[h+1]+t[h+1],d=e[h+2]+t[h+2];r.x=f,r.y=p,r.z=d,f<i.x&&_t.clone(r,i),f>s.x&&_t.clone(r,s),p<o.y&&_t.clone(r,o),p>u.y&&_t.clone(r,u),d<a.z&&_t.clone(r,a),d>l.z&&_t.clone(r,l)}var m=_t.magnitudeSquared(_t.subtract(s,i,Ko)),_=_t.magnitudeSquared(_t.subtract(u,o,Ko)),g=_t.magnitudeSquared(_t.subtract(l,a,Ko)),y=i,v=s,x=m;x<_&&(x=_,y=o,v=u),x<g&&(x=g,y=a,v=l);var b=Qo;b.x=.5*(y.x+v.x),b.y=.5*(y.y+v.y),b.z=.5*(y.z+v.z);var E=_t.magnitudeSquared(_t.subtract(v,b,Ko)),T=Math.sqrt(E),S=Zo;S.x=i.x,S.y=o.y,S.z=a.z;var C=Jo;C.x=s.x,C.y=u.y,C.z=l.z;var w=_t.midpoint(S,C,$o),A=0;for(h=0;h<c;h+=3){r.x=e[h]+t[h],r.y=e[h+1]+t[h+1],r.z=e[h+2]+t[h+2];var I=_t.magnitude(_t.subtract(r,w,Ko));A<I&&(A=I);var P,O,L=_t.magnitudeSquared(_t.subtract(r,b,Ko));E<L&&(E=(T=.5*(T+(P=Math.sqrt(L))))*T,O=P-T,b.x=(T*b.x+O*r.x)/P,b.y=(T*b.y+O*r.y)/P,b.z=(T*b.z+O*r.z)/P)}return T<A?(_t.clone(b,n.center),n.radius=T):(_t.clone(w,n.center),n.radius=A),n},ko.fromCornerPoints=function(e,t,n){Ze(n)||(n=new ko);var r=_t.midpoint(e,t,n.center);return n.radius=_t.distance(r,t),n},ko.fromEllipsoid=function(e,t){return Ze(t)||(t=new ko),_t.clone(_t.ZERO,t.center),t.radius=e.maximumRadius,t};var sa=new _t;ko.fromBoundingSpheres=function(e,t){if(Ze(t)||(t=new ko),!Ze(e)||0===e.length)return t.center=_t.clone(_t.ZERO,t.center),t.radius=0,t;var n=e.length;if(1===n)return ko.clone(e[0],t);if(2===n)return ko.union(e[0],e[1],t);for(var r=[],i=0;i<n;i++)r.push(e[i].center);var o=(t=ko.fromPoints(r,t)).center,a=t.radius;for(i=0;i<n;i++)var s=e[i],a=Math.max(a,_t.distance(o,s.center,sa)+s.radius);return t.radius=a,t};var ua=new _t,la=new _t,ca=new _t;ko.fromOrientedBoundingBox=function(e,t){Ze(t)||(t=new ko);var n=e.halfAxes,r=jt.getColumn(n,0,ua),i=jt.getColumn(n,1,la),o=jt.getColumn(n,2,ca);return _t.add(r,i,r),_t.add(r,o,r),t.center=_t.clone(e.center,t.center),t.radius=_t.magnitude(r),t},ko.clone=function(e,t){if(Ze(e))return Ze(t)?(t.center=_t.clone(e.center,t.center),t.radius=e.radius,t):new ko(e.center,e.radius)},ko.packedLength=4,ko.pack=function(e,t,n){n=Je(n,0);var r=e.center;return t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n]=e.radius,t},ko.unpack=function(e,t,n){t=Je(t,0),Ze(n)||(n=new ko);var r=n.center;return r.x=e[t++],r.y=e[t++],r.z=e[t++],n.radius=e[t],n};var ha=new _t,fa=new _t;ko.union=function(e,t,n){Ze(n)||(n=new ko);var r=e.center,i=e.radius,o=t.center,a=t.radius,s=_t.subtract(o,r,ha),u=_t.magnitude(s);if(u+a<=i)return e.clone(n),n;if(u+i<=a)return t.clone(n),n;var l=.5*(i+u+a),c=_t.multiplyByScalar(s,(l-i)/u,fa);return _t.add(c,r,c),_t.clone(c,n.center),n.radius=l,n};var pa=new _t;ko.expand=function(e,t,n){n=ko.clone(e,n);var r=_t.magnitude(_t.subtract(t,n.center,pa));return r>n.radius&&(n.radius=r),n},ko.intersectPlane=function(e,t){var n=e.center,r=e.radius,i=t.normal,o=_t.dot(i,n)+t.distance;return o<-r?Jn.OUTSIDE:o<r?Jn.INTERSECTING:Jn.INSIDE},ko.transform=function(e,t,n){return Ze(n)||(n=new ko),n.center=on.multiplyByPoint(t,e.center,n.center),n.radius=on.getMaximumScale(t)*e.radius,n};var da=new _t;ko.distanceSquaredTo=function(e,t){var n=_t.subtract(e.center,t,da);return _t.magnitudeSquared(n)-e.radius*e.radius},ko.transformWithoutScale=function(e,t,n){return Ze(n)||(n=new ko),n.center=on.multiplyByPoint(t,e.center,n.center),n.radius=e.radius,n};var ma=new _t;ko.computePlaneDistances=function(e,t,n,r){Ze(r)||(r=new Vo);var i=_t.subtract(e.center,t,ma),o=_t.dot(n,i);return r.start=o-e.radius,r.stop=o+e.radius,r};for(var _a=new _t,ga=new _t,ya=new _t,va=new _t,xa=new _t,ba=new Un,Ea=new Array(8),Ta=0;Ta<8;++Ta)Ea[Ta]=new _t;var Sa=new Zn;ko.projectTo2D=function(e,t,n){var r=(t=Je(t,Sa)).ellipsoid,i=e.center,o=e.radius,a=_t.equals(i,_t.ZERO)?_t.clone(_t.UNIT_X,_a):r.geodeticSurfaceNormal(i,_a),s=_t.cross(_t.UNIT_Z,a,ga);_t.normalize(s,s);var u=_t.cross(a,s,ya);_t.normalize(u,u),_t.multiplyByScalar(a,o,a),_t.multiplyByScalar(u,o,u),_t.multiplyByScalar(s,o,s);var l=_t.negate(u,xa),c=_t.negate(s,va),h=Ea,f=h[0];_t.add(a,u,f),_t.add(f,s,f),f=h[1],_t.add(a,u,f),_t.add(f,c,f),f=h[2],_t.add(a,l,f),_t.add(f,c,f),f=h[3],_t.add(a,l,f),_t.add(f,s,f),_t.negate(a,a),f=h[4],_t.add(a,u,f),_t.add(f,s,f),f=h[5],_t.add(a,u,f),_t.add(f,c,f),f=h[6],_t.add(a,l,f),_t.add(f,c,f),f=h[7],_t.add(a,l,f),_t.add(f,s,f);for(var p=h.length,d=0;d<p;++d){var m=h[d];_t.add(i,m,m);var _=r.cartesianToCartographic(m,ba);t.project(_,m)}var g=(i=(n=ko.fromPoints(h,n)).center).x,y=i.y,v=i.z;return i.x=v,i.y=g,i.z=y,n},ko.isOccluded=function(e,t){return!t.isBoundingSphereVisible(e)},ko.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&_t.equals(e.center,t.center)&&e.radius===t.radius},ko.prototype.intersectPlane=function(e){return ko.intersectPlane(this,e)},ko.prototype.distanceSquaredTo=function(e){return ko.distanceSquaredTo(this,e)},ko.prototype.computePlaneDistances=function(e,t,n){return ko.computePlaneDistances(this,e,t,n)},ko.prototype.isOccluded=function(e){return ko.isOccluded(this,e)},ko.prototype.equals=function(e){return ko.equals(this,e)},ko.prototype.clone=function(e){return ko.clone(this,e)},ko.prototype.volume=function(){var e=this.radius;return ea*e*e*e};var Ca={UNSIGNED_BYTE:Rt.UNSIGNED_BYTE,UNSIGNED_SHORT:Rt.UNSIGNED_SHORT,UNSIGNED_INT:Rt.UNSIGNED_INT,getSizeInBytes:function(e){switch(e){case Ca.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Ca.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Ca.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}},fromSizeInBytes:function(e){switch(e){case 2:return Ca.UNSIGNED_SHORT;case 4:return Ca.UNSIGNED_INT;case 1:return Ca.UNSIGNED_BYTE}},validate:function(e){return Ze(e)&&(e===Ca.UNSIGNED_BYTE||e===Ca.UNSIGNED_SHORT||e===Ca.UNSIGNED_INT)},createTypedArray:function(e,t){return new(e>=pt.SIXTY_FOUR_KILOBYTES?Uint32Array:Uint16Array)(t)},createTypedArrayFromArrayBuffer:function(e,t,n,r){return new(e>=pt.SIXTY_FOUR_KILOBYTES?Uint32Array:Uint16Array)(t,n,r)}},wa=Object.freeze(Ca);function Aa(e,t,n){for(var r,i,o=0,a=e.length-1;o<=a;)if((i=n(e[r=~~((o+a)/2)],t))<0)o=1+r;else{if(!(0<i))return r;a=r-1}return~(a+1)}function Ia(e,t,n,r,i){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=n,this.yPoleOffset=r,this.ut1MinusUtc=i}function Pa(){function v(e,t,n,r){n=n||" ";var i=e.length>=t?"":Array(1+t-e.length>>>0).join(n);return r?e+i:i+e}function x(e,t,n,r,i,o){var a=r-e.length;return 0<a&&(e=n||!i?v(e,r,o,n):e.slice(0,t.length)+v("",a,"0",!0)+e.slice(t.length)),e}function b(e,t,n,r,i,o,a){var s=e>>>0;return e=(n=n&&s&&{2:"0b",8:"0",16:"0x"}[t]||"")+v(s.toString(t),o||0,"0",!1),x(e,n,r,i,a)}function E(e,t,n,r,i,o){return null!=r&&(e=e.slice(0,r)),x(e,"",t,n,i,o)}var T=arguments,S=0,e=T[S++];return e.replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,function(e,t,n,r,i,o,a){var s,u,l,c,h;if("%%"==e)return"%";for(var f=!1,p="",d=!1,m=!1,_=" ",g=n.length,y=0;n&&y<g;y++)switch(n.charAt(y)){case" ":p=" ";break;case"+":p="+";break;case"-":f=!0;break;case"'":_=n.charAt(y+1);break;case"0":d=!0;break;case"#":m=!0}if((r=r?"*"==r?+T[S++]:"*"==r.charAt(0)?+T[r.slice(1,-1)]:+r:0)<0&&(r=-r,f=!0),!isFinite(r))throw new Error("sprintf: (minimum-)width must be finite");switch(o=o?"*"==o?+T[S++]:"*"==o.charAt(0)?+T[o.slice(1,-1)]:+o:-1<"fFeE".indexOf(a)?6:"d"==a?0:void 0,h=t?T[t.slice(0,-1)]:T[S++],a){case"s":return E(String(h),f,r,o,d,_);case"c":return E(String.fromCharCode(+h),f,r,o,d);case"b":return b(h,2,m,f,r,o,d);case"o":return b(h,8,m,f,r,o,d);case"x":return b(h,16,m,f,r,o,d);case"X":return b(h,16,m,f,r,o,d).toUpperCase();case"u":return b(h,10,m,f,r,o,d);case"i":case"d":return s=+h||0,h=(u=(s=Math.round(s-s%1))<0?"-":p)+v(String(Math.abs(s)),o,"0",!1),x(h,u,f,r,d);case"e":case"E":case"f":case"F":case"g":case"G":return u=(s=+h)<0?"-":p,l=["toExponential","toFixed","toPrecision"]["efg".indexOf(a.toLowerCase())],c=["toString","toUpperCase"]["eEfFgG".indexOf(a)%2],h=u+Math.abs(s)[l](o),x(h,u,f,r,d)[c]();default:return e}})}function Oa(e,t,n,r,i,o,a,s){this.year=e,this.month=t,this.day=n,this.hour=r,this.minute=i,this.second=o,this.millisecond=a,this.isLeapSecond=s}function La(e){return e%4==0&&e%100!=0||e%400==0}function Na(e,t){this.julianDate=e,this.offset=t}var Ra=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5}),Da=Object.freeze({UTC:0,TAI:1}),Ma=new Oa,Fa=[31,28,31,30,31,30,31,31,30,31,30,31];function za(e,t){return Ja.compare(e.julianDate,t.julianDate)}var Ba=new Na;function Ua(e){Ba.julianDate=e;var t=Ja.leapSeconds,n=Aa(t,Ba,za);n<0&&(n=~n),n>=t.length&&(n=t.length-1);var r=t[n].offset;0<n&&r<Ja.secondsDifference(t[n].julianDate,e)&&(r=t[--n].offset),Ja.addSeconds(e,r,e)}function Va(e,t){Ba.julianDate=e;var n=Ja.leapSeconds,r=Aa(n,Ba,za);if(r<0&&(r=~r),0===r)return Ja.addSeconds(e,-n[0].offset,t);if(r>=n.length)return Ja.addSeconds(e,-n[r-1].offset,t);var i=Ja.secondsDifference(n[r].julianDate,e);return 0===i?Ja.addSeconds(e,-n[r].offset,t):i<=1?void 0:Ja.addSeconds(e,-n[--r].offset,t)}function ka(e,t,n){var r=t/Ra.SECONDS_PER_DAY|0;return e+=r,(t-=Ra.SECONDS_PER_DAY*r)<0&&(e--,t+=Ra.SECONDS_PER_DAY),n instanceof Ja||(n=new Ja),n.dayNumber=e,n.secondsOfDay=t,n}function Ga(e,t,n,r,i,o,a){var s=(t-14)/12|0,u=e+4800+s,l=(1461*u/4|0)+(367*(t-2-12*s)/12|0)-(3*((u+100)/100|0)/4|0)+n-32075;(r-=12)<0&&(r+=24);var c=o+(r*Ra.SECONDS_PER_HOUR+i*Ra.SECONDS_PER_MINUTE+a*Ra.SECONDS_PER_MILLISECOND);return 43200<=c&&--l,[l,c]}var qa=/^(\d{4})$/,Ha=/^(\d{4})-(\d{2})$/,Wa=/^(\d{4})-?(\d{3})$/,Ya=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,Xa=/^(\d{4})-?(\d{2})-?(\d{2})$/,ja=/([Z+\-])?(\d{2})?:?(\d{2})?$/,Ka=/^(\d{2})(\.\d+)?/.source+ja.source,Qa=/^(\d{2}):?(\d{2})(\.\d+)?/.source+ja.source,Za=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+ja.source;function Ja(e,t,n){this.dayNumber=void 0,this.secondsOfDay=void 0,e=Je(e,0),t=Je(t,0),n=Je(n,Da.UTC);var r=0|e;ka(r,t+=(e-r)*Ra.SECONDS_PER_DAY,this),n===Da.UTC&&Ua(this)}Ja.fromGregorianDate=function(e,t){var n=Ga(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return Ze(t)?(ka(n[0],n[1],t),Ua(t),t):new Ja(n[0],n[1],Da.UTC)},Ja.fromDate=function(e,t){var n=Ga(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return Ze(t)?(ka(n[0],n[1],t),Ua(t),t):new Ja(n[0],n[1],Da.UTC)},Ja.fromIso8601=function(e,t){var n,r,i,o,a,s=(e=e.replace(",",".")).split("T"),u=1,l=1,c=0,h=0,f=0,p=0,d=s[0],m=s[1];if(null!==(s=d.match(Xa))?(n=+s[1],u=+s[2],l=+s[3]):null!==(s=d.match(Ha))?(n=+s[1],u=+s[2]):null!==(s=d.match(qa))?n=+s[1]:(null!==(s=d.match(Wa))?(n=+s[1],o=+s[2],i=La(n)):null!==(s=d.match(Ya))&&(n=+s[1],o=7*+s[2]+(+s[3]||0)-new Date(Date.UTC(n,0,4)).getUTCDay()-3),(r=new Date(Date.UTC(n,0,1))).setUTCDate(o),u=r.getUTCMonth()+1,l=r.getUTCDate()),i=La(n),Ze(m)){null!==(s=m.match(Za))?(c=+s[1],h=+s[2],f=+s[3],p=1e3*(s[4]||0),a=5):null!==(s=m.match(Qa))?(c=+s[1],h=+s[2],f=60*(s[3]||0),a=4):null!==(s=m.match(Ka))&&(c=+s[1],h=60*(s[2]||0),a=3);var _=s[a],g=+s[a+1],y=+(s[a+2]||0);switch(_){case"+":c-=g,h-=y;break;case"-":c+=g,h+=y;break;case"Z":break;default:h+=new Date(Date.UTC(n,u-1,l,c,h)).getTimezoneOffset()}}var v=60===f;for(v&&f--;60<=h;)h-=60,c++;for(;24<=c;)c-=24,l++;for(r=i&&2===u?29:Fa[u-1];r<l;)l-=r,12<++u&&(u-=12,n++),r=i&&2===u?29:Fa[u-1];for(;h<0;)h+=60,c--;for(;c<0;)c+=24,l--;for(;l<1;)--u<1&&(u+=12,n--),l+=r=i&&2===u?29:Fa[u-1];var x=Ga(n,u,l,c,h,f,p);return Ze(t)?(ka(x[0],x[1],t),Ua(t)):t=new Ja(x[0],x[1],Da.UTC),v&&Ja.addSeconds(t,1,t),t},Ja.now=function(e){return Ja.fromDate(new Date,e)};var $a=new Ja(0,0,Da.TAI);function es(e){var t,n;e=Je(e,Je.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=void 0,this._dataError=void 0,this._addNewLeapSeconds=Je(e.addNewLeapSeconds,!0),Ze(e.data)?ns(this,e.data):Ze(e.url)?(t=rt.createIfNeeded(e.url),(n=this)._downloadPromise=t.fetchJson().then(function(e){ns(n,e)}).otherwise(function(){n._dataError="An error occurred while retrieving the EOP data from the URL "+t.url+"."})):ns(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}function ts(e,t){return Ja.compare(e.julianDate,t)}function ns(e,t){if(Ze(t.columnNames))if(Ze(t.samples)){var n=t.columnNames.indexOf("modifiedJulianDateUtc"),r=t.columnNames.indexOf("xPoleWanderRadians"),i=t.columnNames.indexOf("yPoleWanderRadians"),o=t.columnNames.indexOf("ut1MinusUtcSeconds"),a=t.columnNames.indexOf("xCelestialPoleOffsetRadians"),s=t.columnNames.indexOf("yCelestialPoleOffsetRadians"),u=t.columnNames.indexOf("taiMinusUtcSeconds");if(n<0||r<0||i<0||o<0||a<0||s<0||u<0)e._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns";else{var l,c=e._samples=t.samples,h=e._dates=[];e._dateColumn=n,e._xPoleWanderRadiansColumn=r,e._yPoleWanderRadiansColumn=i,e._ut1MinusUtcSecondsColumn=o,e._xCelestialPoleOffsetRadiansColumn=a,e._yCelestialPoleOffsetRadiansColumn=s,e._taiMinusUtcSecondsColumn=u,e._columnCount=t.columnNames.length,e._lastIndex=void 0;for(var f=e._addNewLeapSeconds,p=0,d=c.length;p<d;p+=e._columnCount){var m,_,g,y=c[p+n],v=c[p+u],x=new Ja(y+Ra.MODIFIED_JULIAN_DATE_DIFFERENCE,v,Da.TAI);h.push(x),f&&(v===l||!Ze(l)||(_=Aa(m=Ja.leapSeconds,x,ts))<0&&(g=new Na(x,v),m.splice(~_,0,g)),l=v)}}}else e._dataError="Error in loaded EOP data: The samples property is required.";else e._dataError="Error in loaded EOP data: The columnNames property is required."}function rs(e,t,n,r,i){var o=n*r;i.xPoleWander=t[o+e._xPoleWanderRadiansColumn],i.yPoleWander=t[o+e._yPoleWanderRadiansColumn],i.xPoleOffset=t[o+e._xCelestialPoleOffsetRadiansColumn],i.yPoleOffset=t[o+e._yCelestialPoleOffsetRadiansColumn],i.ut1MinusUtc=t[o+e._ut1MinusUtcSecondsColumn]}function is(e,t,n){return t+e*(n-t)}function os(e,t,n,r,i,o,a){var s=e._columnCount;if(o>t.length-1)return a.xPoleWander=0,a.yPoleWander=0,a.xPoleOffset=0,a.yPoleOffset=0,a.ut1MinusUtc=0,a;var u=t[i],l=t[o];if(u.equals(l)||r.equals(u))return rs(e,n,i,s,a),a;if(r.equals(l))return rs(e,n,o,s,a),a;var c,h,f=Ja.secondsDifference(r,u)/Ja.secondsDifference(l,u),p=i*s,d=o*s,m=n[p+e._ut1MinusUtcSecondsColumn],_=n[d+e._ut1MinusUtcSecondsColumn],g=_-m;return!(.5<g||g<-.5)||(c=n[p+e._taiMinusUtcSecondsColumn])!==(h=n[d+e._taiMinusUtcSecondsColumn])&&(l.equals(r)?m=_:_-=h-c),a.xPoleWander=is(f,n[p+e._xPoleWanderRadiansColumn],n[d+e._xPoleWanderRadiansColumn]),a.yPoleWander=is(f,n[p+e._yPoleWanderRadiansColumn],n[d+e._yPoleWanderRadiansColumn]),a.xPoleOffset=is(f,n[p+e._xCelestialPoleOffsetRadiansColumn],n[d+e._xCelestialPoleOffsetRadiansColumn]),a.yPoleOffset=is(f,n[p+e._yCelestialPoleOffsetRadiansColumn],n[d+e._yCelestialPoleOffsetRadiansColumn]),a.ut1MinusUtc=is(f,m,_),a}function as(e,t,n){this.heading=Je(e,0),this.pitch=Je(t,0),this.roll=Je(n,0)}Ja.toGregorianDate=function(e,t){var n=!1,r=Va(e,$a);Ze(r)||(Ja.addSeconds(e,-1,$a),r=Va($a,$a),n=!0);var i=r.dayNumber,o=r.secondsOfDay;43200<=o&&(i+=1);var a=i+68569|0,s=4*a/146097|0,u=4e3*((a=a-((146097*s+3)/4|0)|0)+1)/1461001|0,l=80*(a=a-(1461*u/4|0)+31|0)/2447|0,c=a-(2447*l/80|0)|0,h=2+l-12*(a=l/11|0)|0,f=100*(s-49)+u+a|0,p=o/Ra.SECONDS_PER_HOUR|0,d=o-p*Ra.SECONDS_PER_HOUR,m=d/Ra.SECONDS_PER_MINUTE|0,_=0|(d-=m*Ra.SECONDS_PER_MINUTE),g=(d-_)/Ra.SECONDS_PER_MILLISECOND;return 23<(p+=12)&&(p-=24),n&&(_+=1),Ze(t)?(t.year=f,t.month=h,t.day=c,t.hour=p,t.minute=m,t.second=_,t.millisecond=g,t.isLeapSecond=n,t):new Oa(f,h,c,p,m,_,g,n)},Ja.toDate=function(e){var t=Ja.toGregorianDate(e,Ma),n=t.second;return t.isLeapSecond&&--n,new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,n,t.millisecond))},Ja.toIso8601=function(e,t){var n=Ja.toGregorianDate(e,Ma),r=n.year,i=n.month,o=n.day,a=n.hour,s=n.minute,u=n.second,l=n.millisecond;return 1e4===r&&1===i&&1===o&&0===a&&0===s&&0===u&&0===l&&(r=9999,i=12,o=31,a=24),Ze(t)||0===l?Ze(t)&&0!==t?Pa("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",r,i,o,a,s,u,(.01*l).toFixed(t).replace(".","").slice(0,t)):Pa("%04d-%02d-%02dT%02d:%02d:%02dZ",r,i,o,a,s,u):Pa("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",r,i,o,a,s,u,(.01*l).toString().replace(".",""))},Ja.clone=function(e,t){if(Ze(e))return Ze(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new Ja(e.dayNumber,e.secondsOfDay,Da.TAI)},Ja.compare=function(e,t){var n=e.dayNumber-t.dayNumber;return 0!=n?n:e.secondsOfDay-t.secondsOfDay},Ja.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay},Ja.equalsEpsilon=function(e,t,n){return e===t||Ze(e)&&Ze(t)&&Math.abs(Ja.secondsDifference(e,t))<=n},Ja.totalDays=function(e){return e.dayNumber+e.secondsOfDay/Ra.SECONDS_PER_DAY},Ja.secondsDifference=function(e,t){return(e.dayNumber-t.dayNumber)*Ra.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)},Ja.daysDifference=function(e,t){return e.dayNumber-t.dayNumber+(e.secondsOfDay-t.secondsOfDay)/Ra.SECONDS_PER_DAY},Ja.computeTaiMinusUtc=function(e){Ba.julianDate=e;var t=Ja.leapSeconds,n=Aa(t,Ba,za);return n<0&&(n=~n,--n<0&&(n=0)),t[n].offset},Ja.addSeconds=function(e,t,n){return ka(e.dayNumber,e.secondsOfDay+t,n)},Ja.addMinutes=function(e,t,n){var r=e.secondsOfDay+t*Ra.SECONDS_PER_MINUTE;return ka(e.dayNumber,r,n)},Ja.addHours=function(e,t,n){var r=e.secondsOfDay+t*Ra.SECONDS_PER_HOUR;return ka(e.dayNumber,r,n)},Ja.addDays=function(e,t,n){return ka(e.dayNumber+t,e.secondsOfDay,n)},Ja.lessThan=function(e,t){return Ja.compare(e,t)<0},Ja.lessThanOrEquals=function(e,t){return Ja.compare(e,t)<=0},Ja.greaterThan=function(e,t){return 0<Ja.compare(e,t)},Ja.greaterThanOrEquals=function(e,t){return 0<=Ja.compare(e,t)},Ja.prototype.clone=function(e){return Ja.clone(this,e)},Ja.prototype.equals=function(e){return Ja.equals(this,e)},Ja.prototype.equalsEpsilon=function(e,t){return Ja.equalsEpsilon(this,e,t)},Ja.prototype.toString=function(){return Ja.toIso8601(this)},Ja.leapSeconds=[new Na(new Ja(2441317,43210,Da.TAI),10),new Na(new Ja(2441499,43211,Da.TAI),11),new Na(new Ja(2441683,43212,Da.TAI),12),new Na(new Ja(2442048,43213,Da.TAI),13),new Na(new Ja(2442413,43214,Da.TAI),14),new Na(new Ja(2442778,43215,Da.TAI),15),new Na(new Ja(2443144,43216,Da.TAI),16),new Na(new Ja(2443509,43217,Da.TAI),17),new Na(new Ja(2443874,43218,Da.TAI),18),new Na(new Ja(2444239,43219,Da.TAI),19),new Na(new Ja(2444786,43220,Da.TAI),20),new Na(new Ja(2445151,43221,Da.TAI),21),new Na(new Ja(2445516,43222,Da.TAI),22),new Na(new Ja(2446247,43223,Da.TAI),23),new Na(new Ja(2447161,43224,Da.TAI),24),new Na(new Ja(2447892,43225,Da.TAI),25),new Na(new Ja(2448257,43226,Da.TAI),26),new Na(new Ja(2448804,43227,Da.TAI),27),new Na(new Ja(2449169,43228,Da.TAI),28),new Na(new Ja(2449534,43229,Da.TAI),29),new Na(new Ja(2450083,43230,Da.TAI),30),new Na(new Ja(2450630,43231,Da.TAI),31),new Na(new Ja(2451179,43232,Da.TAI),32),new Na(new Ja(2453736,43233,Da.TAI),33),new Na(new Ja(2454832,43234,Da.TAI),34),new Na(new Ja(2456109,43235,Da.TAI),35),new Na(new Ja(2457204,43236,Da.TAI),36),new Na(new Ja(2457754,43237,Da.TAI),37)],es.NONE=Object.freeze({getPromiseToLoad:function(){return D.resolve()},compute:function(e,t){return Ze(t)?(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0):t=new Ia(0,0,0,0,0),t}}),es.prototype.getPromiseToLoad=function(){return D(this._downloadPromise)},es.prototype.compute=function(e,t){if(Ze(this._samples)){if(Ze(t)||(t=new Ia(0,0,0,0,0)),0===this._samples.length)return t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0,t;var n=this._dates,r=this._lastIndex,i=0,o=0;if(Ze(r)){var a=n[r],s=n[r+1],u=Ja.lessThanOrEquals(a,e),l=!Ze(s),c=l||Ja.greaterThanOrEquals(s,e);if(u&&c)return i=r,!l&&s.equals(e)&&++i,o=i+1,os(this,n,this._samples,e,i,o,t),t}var h=Aa(n,e,Ja.compare,this._dateColumn);return 0<=h?(h<n.length-1&&n[h+1].equals(e)&&++h,o=i=h):(i=(o=~h)-1)<0&&(i=0),this._lastIndex=i,os(this,n,this._samples,e,i,o,t),t}if(Ze(this._dataError))throw new de(this._dataError)},as.fromQuaternion=function(e,t){Ze(t)||(t=new as);var n=2*(e.w*e.y-e.z*e.x),r=1-2*(e.x*e.x+e.y*e.y),i=2*(e.w*e.x+e.y*e.z),o=1-2*(e.y*e.y+e.z*e.z),a=2*(e.w*e.z+e.x*e.y);return t.heading=-Math.atan2(a,o),t.roll=Math.atan2(i,r),t.pitch=-pt.asinClamped(n),t},as.fromDegrees=function(e,t,n,r){return Ze(r)||(r=new as),r.heading=e*pt.RADIANS_PER_DEGREE,r.pitch=t*pt.RADIANS_PER_DEGREE,r.roll=n*pt.RADIANS_PER_DEGREE,r},as.clone=function(e,t){if(Ze(e))return Ze(t)?(t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t):new as(e.heading,e.pitch,e.roll)},as.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll},as.equalsEpsilon=function(e,t,n,r){return e===t||Ze(e)&&Ze(t)&&pt.equalsEpsilon(e.heading,t.heading,n,r)&&pt.equalsEpsilon(e.pitch,t.pitch,n,r)&&pt.equalsEpsilon(e.roll,t.roll,n,r)},as.prototype.clone=function(e){return as.clone(this,e)},as.prototype.equals=function(e){return as.equals(this,e)},as.prototype.equalsEpsilon=function(e,t,n){return as.equalsEpsilon(this,e,t,n)},as.prototype.toString=function(){return"("+this.heading+", "+this.pitch+", "+this.roll+")"};var ss,us,ls,cs=/((?:.*\/)|^)cesium[\w-]*\.js(?:\W|$)/i;function hs(e){return"undefined"==typeof document?e:(Ze(ss)||(ss=document.createElement("a")),ss.href=e,ss.href=ss.href,ss.href)}function fs(){if(Ze(us))return us;var e="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&Ze(define.amd)&&!define.amd.toUrlUndefined&&Ze(require.toUrl)?w("..",ms("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,n=e.length;t<n;++t){var r=e[t].getAttribute("src"),i=cs.exec(r);if(null!==i)return i[1]}}();return(us=new rt({url:hs(e)})).appendForwardSlash(),us}function ps(e){return hs(require.toUrl("../"+e))}function ds(e){return fs().getDerivedResource({url:e}).url}function ms(e){return Ze(ls)||(ls="object"==typeof define&&Ze(define.amd)&&!define.amd.toUrlUndefined&&Ze(require.toUrl)?ps:ds),ls(e)}function _s(e,t,n){this.x=e,this.y=t,this.s=n}function gs(e){e=Je(e,Je.EMPTY_OBJECT),this._xysFileUrlTemplate=rt.createIfNeeded(e.xysFileUrlTemplate),this._interpolationOrder=Je(e.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=Je(e.sampleZeroJulianEphemerisDate,2442396.5),this._sampleZeroDateTT=new Ja(this._sampleZeroJulianEphemerisDate,0,Da.TAI),this._stepSizeDays=Je(e.stepSizeDays,1),this._samplesPerXysFile=Je(e.samplesPerXysFile,1e3),this._totalSamples=Je(e.totalSamples,27426),this._samples=new Array(3*this._totalSamples),this._chunkDownloadsInProgress=[];for(var t=this._interpolationOrder,n=this._denominators=new Array(t+1),r=this._xTable=new Array(t+1),i=Math.pow(this._stepSizeDays,t),o=0;o<=t;++o){n[o]=i,r[o]=o*this._stepSizeDays;for(var a=0;a<=t;++a)a!==o&&(n[o]*=o-a);n[o]=1/n[o]}this._work=new Array(t+1),this._coef=new Array(t+1)}ms._cesiumScriptRegex=cs,ms._buildModuleUrlFromBaseUrl=ds,ms._clearBaseResource=function(){us=void 0},ms.setBaseUrl=function(e){us=rt.DEFAULT.getDerivedResource({url:e})},ms.getCesiumBaseUrl=fs;var ys=new Ja(0,0,Da.TAI);function vs(e,t,n){var r=ys;return r.dayNumber=t,r.secondsOfDay=n,Ja.daysDifference(r,e._sampleZeroDateTT)}function xs(a,s){if(a._chunkDownloadsInProgress[s])return a._chunkDownloadsInProgress[s];var u=D.defer();a._chunkDownloadsInProgress[s]=u;var e=a._xysFileUrlTemplate;return D((Ze(e)?e.getDerivedResource({templateValues:{0:s}}):new rt({url:ms("Assets/IAU2006_XYS/IAU2006_XYS_"+s+".js")})).fetchJson(),function(e){a._chunkDownloadsInProgress[s]=!1;for(var t=a._samples,n=e.samples,r=s*a._samplesPerXysFile*3,i=0,o=n.length;i<o;++i)t[r+i]=n[i];u.resolve()}),u.promise}gs.prototype.preload=function(e,t,n,r){var i=vs(this,e,t),o=vs(this,n,r),a=i/this._stepSizeDays-this._interpolationOrder/2|0;a<0&&(a=0);var s=o/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;s>=this._totalSamples&&(s=this._totalSamples-1);for(var u=a/this._samplesPerXysFile|0,l=s/this._samplesPerXysFile|0,c=[],h=u;h<=l;++h)c.push(xs(this,h));return D.all(c)},gs.prototype.computeXysRadians=function(e,t,n){var r=vs(this,e,t);if(!(r<0)){var i=r/this._stepSizeDays|0;if(!(i>=this._totalSamples)){var o=this._interpolationOrder,a=i-(o/2|0);a<0&&(a=0);var s=a+o;s>=this._totalSamples&&(a=(s=this._totalSamples-1)-o)<0&&(a=0);var u=!1,l=this._samples;if(Ze(l[3*a])||(xs(this,a/this._samplesPerXysFile|0),u=!0),Ze(l[3*s])||(xs(this,s/this._samplesPerXysFile|0),u=!0),!u){Ze(n)?(n.x=0,n.y=0,n.s=0):n=new _s(0,0,0);for(var c,h=r-a*this._stepSizeDays,f=this._work,p=this._denominators,d=this._coef,m=this._xTable,_=0;_<=o;++_)f[_]=h-m[_];for(_=0;_<=o;++_){for(d[_]=1,c=0;c<=o;++c)c!==_&&(d[_]*=f[c]);d[_]*=p[_];var g=3*(a+_);n.x+=d[_]*l[g++],n.y+=d[_]*l[g++],n.s+=d[_]*l[g]}return n}}}};var bs={},Es={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Ts={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ss={},Cs={east:new _t,north:new _t,up:new _t,west:new _t,south:new _t,down:new _t},ws=new _t,As=new _t,Is=new _t;bs.localFrameToFixedFrameGenerator=function(a,s){if(!Es.hasOwnProperty(a)||!Es[a].hasOwnProperty(s))throw new fe("firstAxis and secondAxis must be east, north, up, west, south or down.");var e,u=Es[a][s],t=a+s;return Ze(Ss[t])?e=Ss[t]:(e=function(e,t,n){var r,i,o;return Ze(n)||(n=new on),_t.equalsEpsilon(e,_t.ZERO,pt.EPSILON14)?(_t.unpack(Ts[a],0,ws),_t.unpack(Ts[s],0,As),_t.unpack(Ts[u],0,Is)):pt.equalsEpsilon(e.x,0,pt.EPSILON14)&&pt.equalsEpsilon(e.y,0,pt.EPSILON14)?(r=pt.sign(e.z),_t.unpack(Ts[a],0,ws),"east"!==a&&"west"!==a&&_t.multiplyByScalar(ws,r,ws),_t.unpack(Ts[s],0,As),"east"!==s&&"west"!==s&&_t.multiplyByScalar(As,r,As),_t.unpack(Ts[u],0,Is),"east"!==u&&"west"!==u&&_t.multiplyByScalar(Is,r,Is)):((t=Je(t,Wn.WGS84)).geodeticSurfaceNormal(e,Cs.up),i=Cs.up,(o=Cs.east).x=-e.y,o.y=e.x,o.z=0,_t.normalize(o,Cs.east),_t.cross(i,o,Cs.north),_t.multiplyByScalar(Cs.up,-1,Cs.down),_t.multiplyByScalar(Cs.east,-1,Cs.west),_t.multiplyByScalar(Cs.north,-1,Cs.south),ws=Cs[a],As=Cs[s],Is=Cs[u]),n[0]=ws.x,n[1]=ws.y,n[2]=ws.z,n[3]=0,n[4]=As.x,n[5]=As.y,n[6]=As.z,n[7]=0,n[8]=Is.x,n[9]=Is.y,n[10]=Is.z,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n},Ss[t]=e),e},bs.eastNorthUpToFixedFrame=bs.localFrameToFixedFrameGenerator("east","north"),bs.northEastDownToFixedFrame=bs.localFrameToFixedFrameGenerator("north","east"),bs.northUpEastToFixedFrame=bs.localFrameToFixedFrameGenerator("north","up"),bs.northWestUpToFixedFrame=bs.localFrameToFixedFrameGenerator("north","west");var Ps=new Si,Os=new _t(1,1,1),Ls=new on;bs.headingPitchRollToFixedFrame=function(e,t,n,r,i){r=Je(r,bs.eastNorthUpToFixedFrame);var o=Si.fromHeadingPitchRoll(t,Ps),a=on.fromTranslationQuaternionRotationScale(_t.ZERO,o,Os,Ls);return i=r(e,n,i),on.multiply(i,a,i)};var Ns=new on,Rs=new jt;bs.headingPitchRollQuaternion=function(e,t,n,r,i){var o=bs.headingPitchRollToFixedFrame(e,t,n,r,Ns),a=on.getMatrix3(o,Rs);return Si.fromRotationMatrix(a,i)};var Ds=new _t(1,1,1),Ms=new _t,Fs=new on,zs=new on,Bs=new jt,Us=new Si;bs.fixedFrameToHeadingPitchRoll=function(e,t,n,r){t=Je(t,Wn.WGS84),n=Je(n,bs.eastNorthUpToFixedFrame),Ze(r)||(r=new as);var i=on.getTranslation(e,Ms);if(_t.equals(i,_t.ZERO))return r.heading=0,r.pitch=0,r.roll=0,r;var o=on.inverseTransformation(n(i,t,Fs),Fs),a=on.setScale(e,Ds,zs),a=on.setTranslation(a,_t.ZERO,a),o=on.multiply(o,a,o),s=Si.fromRotationMatrix(on.getMatrix3(o,Bs),Us),s=Si.normalize(s,s);return as.fromQuaternion(s,r)};var Vs=pt.TWO_PI/86400,ks=new Ja;bs.computeTemeToPseudoFixedMatrix=function(e,t){var n=(ks=Ja.addSeconds(e,-Ja.computeTaiMinusUtc(e),ks)).dayNumber,r=ks.secondsOfDay,i=n-2451545,o=43200<=r?(.5+i)/Ra.DAYS_PER_JULIAN_CENTURY:(i-.5)/Ra.DAYS_PER_JULIAN_CENTURY,a=(24110.54841+o*(8640184.812866+o*(.093104+-62e-7*o)))*Vs%pt.TWO_PI+(72921158553e-15+11772758384668e-32*(n-2451545.5))*((r+.5*Ra.SECONDS_PER_DAY)%Ra.SECONDS_PER_DAY),s=Math.cos(a),u=Math.sin(a);return Ze(t)?(t[0]=s,t[1]=-u,t[2]=0,t[3]=u,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new jt(s,u,0,-u,s,0,0,0,1)},bs.iau2006XysData=new gs,bs.earthOrientationParameters=es.NONE;var Gs=32.184;bs.preloadIcrfFixed=function(e){var t=e.start.dayNumber,n=e.start.secondsOfDay+Gs,r=e.stop.dayNumber,i=e.stop.secondsOfDay+Gs,o=bs.iau2006XysData.preload(t,n,r,i),a=bs.earthOrientationParameters.getPromiseToLoad();return D.all([o,a])},bs.computeIcrfToFixedMatrix=function(e,t){Ze(t)||(t=new jt);var n=bs.computeFixedToIcrfMatrix(e,t);if(Ze(n))return jt.transpose(n,t)};var qs=new _s(0,0,0),Hs=new Ia(0,0,0,0,0),Ws=new jt,Ys=new jt;bs.computeFixedToIcrfMatrix=function(e,t){Ze(t)||(t=new jt);var n=bs.earthOrientationParameters.compute(e,Hs);if(Ze(n)){var r=e.dayNumber,i=e.secondsOfDay+Gs,o=bs.iau2006XysData.computeXysRadians(r,i,qs);if(Ze(o)){var a=o.x+n.xPoleOffset,s=o.y+n.yPoleOffset,u=1/(1+Math.sqrt(1-a*a-s*s)),l=Ws;l[0]=1-u*a*a,l[3]=-u*a*s,l[6]=a,l[1]=-u*a*s,l[4]=1-u*s*s,l[7]=s,l[2]=-a,l[5]=-s,l[8]=1-u*(a*a+s*s);var c=jt.fromRotationZ(-o.s,Ys),h=jt.multiply(l,c,Ws),f=e.dayNumber-2451545,p=(e.secondsOfDay-Ja.computeTaiMinusUtc(e)+n.ut1MinusUtc)/Ra.SECONDS_PER_DAY,d=(d=.779057273264+p+.00273781191135448*(f+p))%1*pt.TWO_PI,m=jt.fromRotationZ(d,Ys),_=jt.multiply(h,m,Ws),g=Math.cos(n.xPoleWander),y=Math.cos(n.yPoleWander),v=Math.sin(n.xPoleWander),x=Math.sin(n.yPoleWander),b=r-2451545+i/Ra.SECONDS_PER_DAY,E=-47e-6*(b/=36525)*pt.RADIANS_PER_DEGREE/3600,T=Math.cos(E),S=Math.sin(E),C=Ys;return C[0]=g*T,C[1]=g*S,C[2]=v,C[3]=-y*S+x*v*T,C[4]=y*T+x*v*S,C[5]=-x*g,C[6]=-x*S-y*v*T,C[7]=x*T-y*v*S,C[8]=y*g,jt.multiply(_,C,t)}}};var Xs=new qt;bs.pointToWindowCoordinates=function(e,t,n,r){return(r=bs.pointToGLWindowCoordinates(e,t,n,r)).y=2*t[5]-r.y,r},bs.pointToGLWindowCoordinates=function(e,t,n,r){Ze(r)||(r=new En);var i=Xs;return on.multiplyByVector(e,qt.fromElements(n.x,n.y,n.z,1,i),i),qt.multiplyByScalar(i,1/i.w,i),on.multiplyByVector(t,i,i),En.fromCartesian4(i,r)};var js=new _t,Ks=new _t,Qs=new _t;bs.rotationMatrixFromPositionVelocity=function(e,t,n,r){var i=Je(n,Wn.WGS84).geodeticSurfaceNormal(e,js),o=_t.cross(t,i,Ks);_t.equalsEpsilon(o,_t.ZERO,pt.EPSILON6)&&(o=_t.clone(_t.UNIT_X,o));var a=_t.cross(o,t,Qs);return _t.normalize(a,a),_t.cross(t,a,o),_t.negate(o,o),_t.normalize(o,o),Ze(r)||(r=new jt),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=o.x,r[4]=o.y,r[5]=o.z,r[6]=a.x,r[7]=a.y,r[8]=a.z,r};var Zs=new on(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),Js=new Un,$s=new _t,eu=new _t,tu=new jt,nu=new on,ru=new on;function iu(e,t,n){if(n=Je(n,!1)){var r=e.indexOf(t);if(-1<r)return r}return e.push(t),e.length-1}function ou(e,t){return Ze(e.extensionsUsed)&&0<=e.extensionsUsed.indexOf(t)}function au(){}function su(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}}function uu(e,t){var n=t.bufferView;if(Ze(n)){var r=e.bufferViews[n];if(Ze(r.byteStride)&&0<r.byteStride)return r.byteStride}return Mt.getSizeInBytes(t.componentType)*su(t.type)}function lu(i){au.accessor(i,function(e){Ze(e.bufferView)&&(e.byteOffset=Je(e.byteOffset,0))}),au.bufferView(i,function(e){Ze(e.buffer)&&(e.byteOffset=Je(e.byteOffset,0))}),au.mesh(i,function(e){au.meshPrimitive(e,function(e){e.mode=Je(e.mode,Rt.TRIANGLES),Ze(e.material)||(Ze(i.materials)||(i.materials=[]),e.material=iu(i.materials,{name:"default"}))})}),au.accessorContainingVertexAttributeData(i,function(e){var t,n=i.accessors[e],r=n.bufferView;n.normalized=Je(n.normalized,!1),Ze(r)&&((t=i.bufferViews[r]).byteStride=uu(i,n),t.target=Rt.ARRAY_BUFFER)}),au.accessorContainingIndexData(i,function(e){var t=i.accessors[e].bufferView;Ze(t)&&(i.bufferViews[t].target=Rt.ELEMENT_ARRAY_BUFFER)}),au.material(i,function(e){var t=Je(e.extensions,Je.EMPTY_OBJECT),n=t.KHR_materials_common;if(Ze(n)){var r=n.technique,i=Ze(n.values)?n.values:{};return(n.values=i).ambient=Ze(i.ambient)?i.ambient:[0,0,0,1],i.emission=Ze(i.emission)?i.emission:[0,0,0,1],i.transparency=Je(i.transparency,1),i.transparent=Je(i.transparent,!1),i.doubleSided=Je(i.doubleSided,!1),void("CONSTANT"!==r&&(i.diffuse=Ze(i.diffuse)?i.diffuse:[0,0,0,1],"LAMBERT"!==r&&(i.specular=Ze(i.specular)?i.specular:[0,0,0,1],i.shininess=Je(i.shininess,0))))}e.emissiveFactor=Je(e.emissiveFactor,[0,0,0]),e.alphaMode=Je(e.alphaMode,"OPAQUE"),e.doubleSided=Je(e.doubleSided,!1),"MASK"===e.alphaMode&&(e.alphaCutoff=Je(e.alphaCutoff,.5)),Ze(t.KHR_techniques_webgl)&&au.materialValue(e,function(e){Ze(e.index)&&cu(e)}),cu(e.emissiveTexture),cu(e.normalTexture),cu(e.occlusionTexture);var o=e.pbrMetallicRoughness;Ze(o)&&(o.baseColorFactor=Je(o.baseColorFactor,[1,1,1,1]),o.metallicFactor=Je(o.metallicFactor,1),o.roughnessFactor=Je(o.roughnessFactor,1),cu(o.baseColorTexture),cu(o.metallicRoughnessTexture));var a=t.pbrSpecularGlossiness;Ze(a)&&(a.diffuseFactor=Je(a.diffuseFactor,[1,1,1,1]),a.specularFactor=Je(a.specularFactor,[1,1,1]),a.glossinessFactor=Je(a.glossinessFactor,1),cu(a.specularGlossinessTexture))}),au.animation(i,function(e){au.animationSampler(e,function(e){e.interpolation=Je(e.interpolation,"LINEAR")})});var o,n=(o={},au.animation(i,function(e){au.animationChannel(e,function(e){var t=e.target,n=t.node,r=t.path;"translation"!==r&&"rotation"!==r&&"scale"!==r||(o[n]=!0)})}),o);return au.node(i,function(e,t){Ze(n[t])||Ze(e.translation)||Ze(e.rotation)||Ze(e.scale)?(e.translation=Je(e.translation,[0,0,0]),e.rotation=Je(e.rotation,[0,0,0,1]),e.scale=Je(e.scale,[1,1,1])):e.matrix=Je(e.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}),au.sampler(i,function(e){e.wrapS=Je(e.wrapS,Rt.REPEAT),e.wrapT=Je(e.wrapT,Rt.REPEAT)}),Ze(i.scenes)&&!Ze(i.scene)&&(i.scene=0),i}function cu(e){Ze(e)&&(e.texCoord=Je(e.texCoord,0))}function hu(e){return au.shader(e,function(e){fu(e)}),au.buffer(e,function(e){fu(e)}),au.image(e,function(e){fu(e),au.compressedImage(e,function(e){fu(e)})}),fu(e),e}function fu(e){e.extras=Ze(e.extras)?e.extras:{},e.extras._pipeline=Ze(e.extras._pipeline)?e.extras._pipeline:{}}function pu(e,t){var n,r,i,o,a,s=e.extensionsUsed;Ze(s)&&(0<=(n=s.indexOf(t))&&s.splice(n,1),i=t,Ze(a=(r=e).extensionsRequired)&&(0<=(o=a.indexOf(i))&&a.splice(o,1),0===a.length&&delete r.extensionsRequired),0===s.length&&delete e.extensionsUsed)}function du(e,t){return kt(e,t=Je(t,0),Math.min(4,e.length))}bs.basisTo2D=function(e,t,n){var r=on.getTranslation(t,eu),i=e.ellipsoid,o=i.cartesianToCartographic(r,Js),a=e.project(o,$s);_t.fromElements(a.z,a.x,a.y,a);var s=bs.eastNorthUpToFixedFrame(r,i,nu),u=on.inverseTransformation(s,ru),l=on.getMatrix3(t,tu),c=on.multiplyByMatrix3(u,l,n);return on.multiply(Zs,c,n),on.setTranslation(n,a,n),n},bs.wgs84To2DModelMatrix=function(e,t,n){var r=e.ellipsoid,i=bs.eastNorthUpToFixedFrame(t,r,nu),o=on.inverseTransformation(i,ru),a=r.cartesianToCartographic(t,Js),s=e.project(a,$s);_t.fromElements(s.z,s.x,s.y,s);var u=on.fromTranslation(s,nu);return on.multiply(Zs,o,n),on.multiply(u,n,n),n},au.objectLegacy=function(e,t){if(Ze(e))for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=t(e[n],n);if(Ze(r))return r}},au.object=function(e,t){if(Ze(e))for(var n=e.length,r=0;r<n;r++){var i=t(e[r],r);if(Ze(i))return i}},au.topLevel=function(e,t,n){var r=e[t];return Ze(r)&&!Array.isArray(r)?au.objectLegacy(r,n):au.object(r,n)},au.accessor=function(e,t){return au.topLevel(e,"accessors",t)},au.accessorWithSemantic=function(e,r,i){var o={};return au.mesh(e,function(e){return au.meshPrimitive(e,function(e){var t=au.meshPrimitiveAttribute(e,function(e,t){if(0===t.indexOf(r)&&!Ze(o[e])){o[e]=!0;var n=i(e);if(Ze(n))return n}});return Ze(t)?t:au.meshPrimitiveTarget(e,function(e){return au.meshPrimitiveTargetAttribute(e,function(e,t){if(0===t.indexOf(r)&&!Ze(o[e])){o[e]=!0;var n=i(e);if(Ze(n))return n}})})})})},au.accessorContainingVertexAttributeData=function(e,n){var r={};return au.mesh(e,function(e){return au.meshPrimitive(e,function(e){var t=au.meshPrimitiveAttribute(e,function(e){if(!Ze(r[e])){r[e]=!0;var t=n(e);if(Ze(t))return t}});return Ze(t)?t:au.meshPrimitiveTarget(e,function(e){return au.meshPrimitiveTargetAttribute(e,function(e){if(!Ze(r[e])){r[e]=!0;var t=n(e);if(Ze(t))return t}})})})})},au.accessorContainingIndexData=function(e,r){var i={};return au.mesh(e,function(e){return au.meshPrimitive(e,function(e){var t=e.indices;if(Ze(t)&&!Ze(i[t])){i[t]=!0;var n=r(t);if(Ze(n))return n}})})},au.animation=function(e,t){return au.topLevel(e,"animations",t)},au.animationChannel=function(e,t){var n=e.channels;return au.object(n,t)},au.animationSampler=function(e,t){var n=e.samplers;return au.object(n,t)},au.buffer=function(e,t){return au.topLevel(e,"buffers",t)},au.bufferView=function(e,t){return au.topLevel(e,"bufferViews",t)},au.camera=function(e,t){return au.topLevel(e,"cameras",t)},au.image=function(e,t){return au.topLevel(e,"images",t)},au.compressedImage=function(e,t){if(Ze(e.extras)){var n=e.extras.compressedImage3DTiles;for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=t(n[r],r);if(Ze(i))return i}}},au.material=function(e,t){return au.topLevel(e,"materials",t)},au.materialValue=function(e,t){var n=e.values;for(var r in Ze(e.extensions)&&Ze(e.extensions.KHR_techniques_webgl)&&(n=e.extensions.KHR_techniques_webgl.values),n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=t(n[r],r);if(Ze(i))return i}},au.mesh=function(e,t){return au.topLevel(e,"meshes",t)},au.meshPrimitive=function(e,t){var n=e.primitives;if(Ze(n))for(var r=n.length,i=0;i<r;i++){var o=t(n[i],i);if(Ze(o))return o}},au.meshPrimitiveAttribute=function(e,t){var n=e.attributes;for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=t(n[r],r);if(Ze(i))return i}},au.meshPrimitiveTarget=function(e,t){var n=e.targets;if(Ze(n))for(var r=n.length,i=0;i<r;++i){var o=t(n[i],i);if(Ze(o))return o}},au.meshPrimitiveTargetAttribute=function(e,t){for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=t(e[n],n);if(Ze(r))return r}},au.node=function(e,t){return au.topLevel(e,"nodes",t)},au.nodeInTree=function(e,t,n){var r=e.nodes;if(Ze(r))for(var i=t.length,o=0;o<i;o++){var a=t[o],s=r[a];if(Ze(s)){var u=n(s,a);if(Ze(u))return u;var l=s.children;if(Ze(l)&&Ze(u=au.nodeInTree(e,l,n)))return u}}},au.nodeInScene=function(e,t,n){var r=t.nodes;if(Ze(r))return au.nodeInTree(e,r,n)},au.program=function(e,t){return ou(e,"KHR_techniques_webgl")?au.object(e.extensions.KHR_techniques_webgl.programs,t):au.topLevel(e,"programs",t)},au.sampler=function(e,t){return au.topLevel(e,"samplers",t)},au.scene=function(e,t){return au.topLevel(e,"scenes",t)},au.shader=function(e,t){return ou(e,"KHR_techniques_webgl")?au.object(e.extensions.KHR_techniques_webgl.shaders,t):au.topLevel(e,"shaders",t)},au.skin=function(e,t){return au.topLevel(e,"skins",t)},au.skinJoint=function(e,t){var n=e.joints;if(Ze(n))for(var r=n.length,i=0;i<r;i++){var o=t(n[i]);if(Ze(o))return o}},au.techniqueAttribute=function(e,t){var n=e.attributes;for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=t(n[r],r);if(Ze(i))return i}},au.techniqueUniform=function(e,t){var n=e.uniforms;for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=t(n[r],r);if(Ze(i))return i}},au.techniqueParameter=function(e,t){var n=e.parameters;for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){var i=t(n[r],r);if(Ze(i))return i}},au.technique=function(e,t){return ou(e,"KHR_techniques_webgl")?au.object(e.extensions.KHR_techniques_webgl.techniques,t):au.topLevel(e,"techniques",t)},au.texture=function(e,t){return au.topLevel(e,"textures",t)};var mu=4;function _u(e){if("glTF"!==du(e))throw new de("File is not valid binary glTF");var t=gu(e,0,5),n=t[1];if(1!==n&&2!==n)throw new de("Binary glTF version is not 1 or 2");return(1===n?function(e,t){var n=t[2],r=t[3];if(0!==t[4])throw new de("Binary glTF scene format is not JSON");var i=20+r,o=kt(e,20,r),a=JSON.parse(o);hu(a);var s=e.subarray(i,n),u=a.buffers;{var l;Ze(u)&&0<Object.keys(u).length&&(Ze(l=Je(u.binary_glTF,u.KHR_binary_glTF))&&(l.extras._pipeline.source=s))}return pu(a,"KHR_binary_glTF"),a}:function(e,t){var n,r,i=t[2],o=12;for(;o<i;){var a=gu(e,o,2),s=a[0],u=a[1];o+=8;var l,c=e.subarray(o,o+s);o+=s,1313821514===u?(l=kt(c),hu(n=JSON.parse(l))):5130562===u&&(r=c)}{var h;Ze(n)&&Ze(r)&&(Ze(h=n.buffers)&&0<h.length&&(h[0].extras._pipeline.source=r))}return n})(e,t)}function gu(e,t,n){for(var r=new DataView(e.buffer),i=new Array(n),o=0;o<n;++o)i[o]=r.getUint32(e.byteOffset+t+o*mu,!0);return i}function yu(e,t){var n=e.extensionsUsed;Ze(n)||(n=[],e.extensionsUsed=n),iu(n,t,!0)}function vu(e){switch(e){case Mt.BYTE:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getInt8(t+o*r)};case Mt.UNSIGNED_BYTE:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getUint8(t+o*r)};case Mt.SHORT:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getInt16(t+o*r,!0)};case Mt.UNSIGNED_SHORT:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getUint16(t+o*r,!0)};case Mt.INT:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getInt32(t+o*r,!0)};case Mt.UNSIGNED_INT:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getUint32(t+o*r,!0)};case Mt.FLOAT:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getFloat32(t+o*r,!0)};case Mt.DOUBLE:return function(e,t,n,r,i){for(var o=0;o<n;++o)i[o]=e.getFloat64(t+o*r,!0)}}}function xu(e,t){var n=e.bufferViews,r=e.buffers,i=t.bufferView,o=su(t.type);if(!Ze(t.bufferView))return{min:bn(new Array(o),0),max:bn(new Array(o),0)};for(var a=bn(new Array(o),Number.POSITIVE_INFINITY),s=bn(new Array(o),Number.NEGATIVE_INFINITY),u=n[i],l=r[u.buffer].extras._pipeline.source,c=t.count,h=uu(e,t),f=t.byteOffset+u.byteOffset+l.byteOffset,p=t.componentType,d=Mt.getSizeInBytes(p),m=new DataView(l.buffer),_=new Array(o),g=vu(p),y=0;y<c;y++){g(m,f,o,d,_);for(var v=0;v<o;v++){var x=_[v];a[v]=Math.min(a[v],x),s[v]=Math.max(s[v],x)}f+=h}return{min:a,max:s}}var bu=[Rt.FUNC_ADD,Rt.FUNC_ADD],Eu=[Rt.ONE,Rt.ZERO,Rt.ONE,Rt.ZERO];function Tu(e,t){var n=e.enable;return Ze(n)&&-1<n.indexOf(t)}var Su=[Rt.ZERO,Rt.ONE,Rt.SRC_COLOR,Rt.ONE_MINUS_SRC_COLOR,Rt.SRC_ALPHA,Rt.ONE_MINUS_SRC_ALPHA,Rt.DST_ALPHA,Rt.ONE_MINUS_DST_ALPHA,Rt.DST_COLOR,Rt.ONE_MINUS_DST_COLOR];function Cu(e){var o={},a={};return Ze(e.techniques)&&(au.technique(e,function(e,t){var n,r,i=e.states;Ze(i)&&(n=a[t]={},Tu(i,Rt.BLEND)&&(n.alphaMode="BLEND",Ze(r=i.functions)&&(Ze(r.blendEquationSeparate)||Ze(r.blendFuncSeparate))&&(o[t]={blendEquation:Je(r.blendEquationSeparate,bu),blendFactors:function(e,t){if(!Ze(e))return t;for(var n=0;n<4;n++)if(-1===Su.indexOf(e[n]))return t;return e}(r.blendFuncSeparate,Eu)})),Tu(i,Rt.CULL_FACE)||(n.doubleSided=!0),delete e.states)}),0<Object.keys(o).length&&(Ze(e.extensions)||(e.extensions={}),yu(e,"KHR_blend")),au.material(e,function(n){var e,t;Ze(n.technique)&&(e=a[n.technique],au.objectLegacy(e,function(e,t){n[t]=e}),Ze(t=o[n.technique])&&(Ze(n.extensions)||(n.extensions={}),n.extensions.KHR_blend=t))})),e}function wu(u){var l,c,e,t,n,r=u.techniques,h={},f={};return Ze(r)&&(l={programs:[],shaders:[],techniques:[]},c=u.glExtensionsUsed,delete u.glExtensionsUsed,au.technique(u,function(n,e){var r,i={name:n.name,program:void 0,attributes:{},uniforms:{}};au.techniqueAttribute(n,function(e,t){r=n.parameters[e],i.attributes[t]={semantic:r.semantic}}),au.techniqueUniform(n,function(e,t){r=n.parameters[e],i.uniforms[t]={count:r.count,node:r.node,type:r.type,semantic:r.semantic,value:r.value},h[e]=t});var t=u.programs[n.program],o={name:t.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:c},a=u.shaders[t.fragmentShader];o.fragmentShader=iu(l.shaders,a,!0);var s=u.shaders[t.vertexShader];o.vertexShader=iu(l.shaders,s,!0),i.program=iu(l.programs,o),f[e]=iu(l.techniques,i)}),0<l.techniques.length&&(Ze(u.extensions)||(u.extensions={}),u.extensions.KHR_techniques_webgl=l,yu(u,"KHR_techniques_webgl"),t="KHR_techniques_webgl",Ze(n=(e=u).extensionsRequired)||(n=[],e.extensionsRequired=n),iu(n,t,!0),yu(e,t))),au.material(u,function(e){var r;Ze(e.technique)&&(r={technique:f[e.technique]},au.objectLegacy(e.values,function(e,t){Ze(r.values)||(r.values={});var n=h[t];r.values[n]=e}),Ze(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl=r),delete e.technique,delete e.values}),delete u.techniques,delete u.programs,delete u.shaders,u}var Au=["mesh","node","material","accessor","bufferView","buffer"];function Iu(t,n){return n=Je(n,Au),Au.forEach(function(e){-1<n.indexOf(e)&&function(e,t){var n=Pu[t],r=e[n];if(Ze(r))for(var i=0,o=Lu[t](e),a=r.length,s=0;s<a;++s)o[s]||(Ou[t](e,s-i),i++)}(t,e)}),t}var Pu={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews",node:"nodes",material:"materials",mesh:"meshes"};function Ou(){}function Lu(){}function Nu(e,t,n){var r,i,o,a,s=Mt.createTypedArray(n,function(e,t){var n=uu(e,t),r=Mt.getSizeInBytes(t.componentType),i=su(t.type),o=t.count,a=new Array(i*o);if(!Ze(t.bufferView))return bn(a,0),a;for(var s=e.bufferViews[t.bufferView],u=e.buffers[s.buffer].extras._pipeline.source,l=t.byteOffset+s.byteOffset+u.byteOffset,c=new DataView(u.buffer),h=new Array(i),f=vu(t.componentType),p=0;p<o;++p){f(c,l,i,r,h);for(var d=0;d<i;++d)a[p*i+d]=h[d];l+=n}return a}(e,t)),u=new Uint8Array(s.buffer);t.bufferView=(r=e,o={byteLength:(i=u).length,extras:{_pipeline:{source:i}}},a={buffer:iu(r.buffers,o),byteOffset:0,byteLength:i.length},iu(r.bufferViews,a)),t.componentType=n,t.byteOffset=0}Ou.accessor=function(e,r){e.accessors.splice(r,1),au.mesh(e,function(e){au.meshPrimitive(e,function(n){au.meshPrimitiveAttribute(n,function(e,t){r<e&&n.attributes[t]--}),au.meshPrimitiveTarget(n,function(n){au.meshPrimitiveTargetAttribute(n,function(e,t){r<e&&n[t]--})});var e=n.indices;Ze(e)&&r<e&&n.indices--})}),au.skin(e,function(e){Ze(e.inverseBindMatrices)&&e.inverseBindMatrices>r&&e.inverseBindMatrices--}),au.animation(e,function(e){au.animationSampler(e,function(e){Ze(e.input)&&e.input>r&&e.input--,Ze(e.output)&&e.output>r&&e.output--})})},Ou.buffer=function(e,t){e.buffers.splice(t,1),au.bufferView(e,function(e){Ze(e.buffer)&&e.buffer>t&&e.buffer--})},Ou.bufferView=function(e,n){e.bufferViews.splice(n,1),au.accessor(e,function(e){Ze(e.bufferView)&&e.bufferView>n&&e.bufferView--}),au.shader(e,function(e){Ze(e.bufferView)&&e.bufferView>n&&e.bufferView--}),au.image(e,function(e){Ze(e.bufferView)&&e.bufferView>n&&e.bufferView--,au.compressedImage(e,function(e){var t=e.bufferView;Ze(t)&&n<t&&e.bufferView--})}),ou(e,"KHR_draco_mesh_compression")&&au.mesh(e,function(e){au.meshPrimitive(e,function(e){Ze(e.extensions)&&Ze(e.extensions.KHR_draco_mesh_compression)&&e.extensions.KHR_draco_mesh_compression.bufferView>n&&e.extensions.KHR_draco_mesh_compression.bufferView--})})},Ou.mesh=function(e,t){e.meshes.splice(t,1),au.node(e,function(e){Ze(e.mesh)&&(e.mesh>t?e.mesh--:e.mesh===t&&delete e.mesh)})},Ou.node=function(e,t){e.nodes.splice(t,1),au.skin(e,function(e){Ze(e.skeleton)&&e.skeleton>t&&e.skeleton--,e.joints=e.joints.map(function(e){return t<e?e-1:e})}),au.animation(e,function(e){au.animationChannel(e,function(e){Ze(e.target)&&Ze(e.target.node)&&e.target.node>t&&e.target.node--})}),au.technique(e,function(e){au.techniqueUniform(e,function(e){Ze(e.node)&&e.node>t&&e.node--})}),au.node(e,function(e){Ze(e.children)&&(e.children=e.children.filter(function(e){return e!==t}).map(function(e){return t<e?e-1:e}))}),au.scene(e,function(e){e.nodes=e.nodes.filter(function(e){return e!==t}).map(function(e){return t<e?e-1:e})})},Ou.material=function(e,t){e.materials.splice(t,1),au.mesh(e,function(e){au.meshPrimitive(e,function(e){Ze(e.material)&&e.material>t&&e.material--})})},Lu.accessor=function(e){var n={};return au.mesh(e,function(e){au.meshPrimitive(e,function(e){au.meshPrimitiveAttribute(e,function(e){n[e]=!0}),au.meshPrimitiveTarget(e,function(e){au.meshPrimitiveTargetAttribute(e,function(e){n[e]=!0})});var t=e.indices;Ze(t)&&(n[t]=!0)})}),au.skin(e,function(e){Ze(e.inverseBindMatrices)&&(n[e.inverseBindMatrices]=!0)}),au.animation(e,function(e){au.animationSampler(e,function(e){Ze(e.input)&&(n[e.input]=!0),Ze(e.output)&&(n[e.output]=!0)})}),n},Lu.buffer=function(e){var t={};return au.bufferView(e,function(e){Ze(e.buffer)&&(t[e.buffer]=!0)}),t},Lu.bufferView=function(e){var t={};return au.accessor(e,function(e){Ze(e.bufferView)&&(t[e.bufferView]=!0)}),au.shader(e,function(e){Ze(e.bufferView)&&(t[e.bufferView]=!0)}),au.image(e,function(e){Ze(e.bufferView)&&(t[e.bufferView]=!0),au.compressedImage(e,function(e){Ze(e.bufferView)&&(t[e.bufferView]=!0)})}),ou(e,"KHR_draco_mesh_compression")&&au.mesh(e,function(e){au.meshPrimitive(e,function(e){Ze(e.extensions)&&Ze(e.extensions.KHR_draco_mesh_compression)&&(t[e.extensions.KHR_draco_mesh_compression.bufferView]=!0)})}),t},Lu.mesh=function(n){var r={};return au.node(n,function(e){var t;!Ze(e.mesh&&Ze(n.meshes))||Ze(t=n.meshes[e.mesh])&&Ze(t.primitives)&&0<t.primitives.length&&(r[e.mesh]=!0)}),r},Lu.node=function(n){var r={};return au.node(n,function(e,t){!function t(n,e){return!(Ze(e.mesh)||Ze(e.camera)||Ze(e.skin)||Ze(e.weights)||Ze(e.extras)||Ze(e.extensions)&&0!==e.extensions.length||Ze(e.children)&&0!==e.children.filter(function(e){return!t(n,n.nodes[e])}).length)}(n,e)&&(r[t]=!0)}),au.skin(n,function(e){Ze(e.skeleton)&&(r[e.skeleton]=!0),au.skinJoint(e,function(e){r[e]=!0})}),au.animation(n,function(e){au.animationChannel(e,function(e){Ze(e.target)&&Ze(e.target.node)&&(r[e.target.node]=!0)})}),au.technique(n,function(e){au.techniqueUniform(e,function(e){Ze(e.node)&&(r[e.node]=!0)})}),r},Lu.material=function(e){var t={};return au.mesh(e,function(e){au.meshPrimitive(e,function(e){Ze(e.material)&&(t[e.material]=!0)})}),t};var Ru={.8:function(e){Ze(e.asset)||(e.asset={});var t=e.asset;{var n;t.version="1.0","string"==typeof t.profile?(n=t.profile.split(" "),t.profile={api:n[0],version:n[1]}):t.profile={}}Ze(e.version)&&delete e.version;Mu(e),function(e){var t=e.meshes;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=t[n].primitives;if(Ze(r))for(var i=r.length,o=0;o<i;++o){var a=r[o],s=Je(a.primitive,Rt.TRIANGLES);a.mode=Je(a.mode,s),delete a.primitive}}}(e),function(e){var t=e.nodes,n=new _t,r=new Si;for(var i in t){var o,a,s;Object.prototype.hasOwnProperty.call(t,i)&&(Ze((o=t[i]).rotation)&&(a=o.rotation,_t.fromArray(a,0,n),Si.fromAxisAngle(n,a[3],r),o.rotation=[r.x,r.y,r.z,r.w]),Ze(s=o.instanceSkin)&&(o.skeletons=s.skeletons,o.skin=s.skin,o.meshes=s.meshes,delete o.instanceSkin))}}(e),function(e){var t=e.animations,n=e.accessors,r=e.bufferViews,i=e.buffers,o={},a=new _t,s=new Si;for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u)){var l=t[u],c=l.channels,h=l.parameters,f=l.samplers;if(Ze(c))for(var p=c.length,d=0;d<p;++d){var m=c[d];if("rotation"===m.target.path){var _=h[f[m.sampler].output];if(Ze(o[_]))continue;o[_]=!0;for(var g=n[_],y=r[g.bufferView],v=i[y.buffer].extras._pipeline.source,x=v.byteOffset+y.byteOffset+g.byteOffset,b=g.componentType,E=g.count,T=su(g.type),S=g.count*T,C=Mt.createArrayBufferView(b,v.buffer,x,S),w=0;w<E;w++){var A=w*T;_t.unpack(C,A,a);var I=C[3+A];Si.fromAxisAngle(a,I,s),Si.pack(s,C,A)}}}}}(e),function(e){var t=e.techniques;for(var n in t){var r,i,o,a,s;Object.prototype.hasOwnProperty.call(t,n)&&(r=t[n],Ze(i=r.passes)&&(o=Je(r.pass,"defaultPass"),Object.prototype.hasOwnProperty.call(i,o)&&(a=i[o],s=a.instanceProgram,r.attributes=Je(r.attributes,s.attributes),r.program=Je(r.program,s.program),r.uniforms=Je(r.uniforms,s.uniforms),r.states=Je(r.states,a.states)),delete r.passes,delete r.pass))}}(e),Ze(e.allExtensions)&&(e.extensionsUsed=e.allExtensions,delete e.allExtensions);{var r,i;Ze(e.lights)&&(r=Je(e.extensions,{}),i=Je((e.extensions=r).KHR_materials_common,{}),(r.KHR_materials_common=i).lights=e.lights,delete e.lights,yu(e,"KHR_materials_common"))}},"1.0":function(e){e.asset=Je(e.asset,{}),e.asset.version="2.0",Mu(e),function(e){var t=e.animations;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=t[n],i=r.parameters;if(Ze(i)){var o,a=r.samplers;for(var s in a){Object.prototype.hasOwnProperty.call(a,s)&&((o=a[s]).input=i[o.input],o.output=i[o.output])}delete r.parameters}}}(e),function(n){au.node(n,function(e,t){ku(e)&&!function r(i,o){au.scene(i,function(e){var t=e.nodes;if(Ze(t))for(var n=t.length,r=n;0<=r;--r)if(t[r]===o)return void t.splice(r,1)});au.node(i,function(e,t){var n;!Ze(e.children)||-1<(n=e.children.indexOf(o))&&(e.children.splice(n,1),ku(e)&&r(i,t))});delete i.nodes[o]}(n,t)})}(e),function(u){var l,e,c={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},i={},t=u.nodes;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&Ze(e=t[n].jointName)&&(i[e]=n);for(var r in u){var o,a;Object.prototype.hasOwnProperty.call(u,r)&&Ze(c[r])&&(o={},a=u[r],u[r]=Fu(a,o),c[r]=o)}for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(i[e]=c.nodes[i[e]]);Ze(u.scene)&&(u.scene=c.scenes[u.scene]);au.bufferView(u,function(e){Ze(e.buffer)&&(e.buffer=c.buffers[e.buffer])}),au.accessor(u,function(e){Ze(e.bufferView)&&(e.bufferView=c.bufferViews[e.bufferView])}),au.shader(u,function(e){var t,n=e.extensions;Ze(n)&&(Ze(t=n.KHR_binary_glTF)&&(e.bufferView=c.bufferViews[t.bufferView],delete n.KHR_binary_glTF),0===Object.keys(n).length&&delete e.extensions)}),au.program(u,function(e){Ze(e.vertexShader)&&(e.vertexShader=c.shaders[e.vertexShader]),Ze(e.fragmentShader)&&(e.fragmentShader=c.shaders[e.fragmentShader])}),au.technique(u,function(e){Ze(e.program)&&(e.program=c.programs[e.program]),au.techniqueParameter(e,function(e){Ze(e.node)&&(e.node=c.nodes[e.node]);var t=e.value;"string"==typeof t&&(e.value={index:c.textures[t]})})}),au.mesh(u,function(e){au.meshPrimitive(e,function(n){Ze(n.indices)&&(n.indices=c.accessors[n.indices]),au.meshPrimitiveAttribute(n,function(e,t){n.attributes[t]=c.accessors[e]}),Ze(n.material)&&(n.material=c.materials[n.material])})}),au.node(u,function(e){var t,n=e.children;if(Ze(n)){var r=n.length;for(l=0;l<r;++l)n[l]=c.nodes[n[l]]}if(Ze(e.meshes)){var i=e.meshes,o=i.length;if(0<o)for(e.mesh=c.meshes[i[0]],l=1;l<o;++l){var a={mesh:c.meshes[i[l]]},s=iu(u.nodes,a);Ze(n)||(n=[],e.children=n),n.push(s)}delete e.meshes}Ze(e.camera)&&(e.camera=c.cameras[e.camera]),Ze(e.skin)&&(e.skin=c.skins[e.skin]),Ze(e.skeletons)&&(0<(t=e.skeletons).length&&Ze(e.skin)&&(u.skins[e.skin].skeleton=c.nodes[t[0]]),delete e.skeletons),Ze(e.jointName)&&delete e.jointName}),au.skin(u,function(e){Ze(e.inverseBindMatrices)&&(e.inverseBindMatrices=c.accessors[e.inverseBindMatrices]);var t=e.jointNames;if(Ze(t)){var n=[],r=t.length;for(l=0;l<r;++l)n[l]=i[t[l]];e.joints=n,delete e.jointNames}}),au.scene(u,function(e){var t=e.nodes;if(Ze(t)){var n=t.length;for(l=0;l<n;++l)t[l]=c.nodes[t[l]]}}),au.animation(u,function(e){var n={};e.samplers=Fu(e.samplers,n),au.animationSampler(e,function(e){e.input=c.accessors[e.input],e.output=c.accessors[e.output]}),au.animationChannel(e,function(e){e.sampler=n[e.sampler];var t=e.target;Ze(t)&&(t.node=c.nodes[t.id],delete t.id)})}),au.material(u,function(n){Ze(n.technique)&&(n.technique=c.techniques[n.technique]),au.materialValue(n,function(e,t){"string"==typeof e&&(n.values[t]={index:c.textures[e]})});var r,e=n.extensions;!Ze(e)||Ze(r=e.KHR_materials_common)&&au.materialValue(r,function(e,t){"string"==typeof e&&(r.values[t]={index:c.textures[e]})})}),au.image(u,function(e){var t,r=e.extensions;Ze(r)&&(Ze(t=r.KHR_binary_glTF)&&(e.bufferView=c.bufferViews[t.bufferView],e.mimeType=t.mimeType,delete r.KHR_binary_glTF),0===Object.keys(r).length&&delete e.extensions),au.compressedImage(e,function(e){var t,n=e.extensions;Ze(n)&&(Ze(t=n.KHR_binary_glTF)&&(e.bufferView=c.bufferViews[t.bufferView],e.mimeType=t.mimeType,delete n.KHR_binary_glTF),0===Object.keys(r).length&&delete e.extensions)})}),au.texture(u,function(e){Ze(e.sampler)&&(e.sampler=c.samplers[e.sampler]),Ze(e.source)&&(e.source=c.images[e.source])})}(e),function(e){au.animation(e,function(e){au.animationSampler(e,function(e){delete e.name})})}(e),function(e){var t=e.asset;delete t.profile,delete t.premultipliedAlpha}(e),function(e){var t=e.extensionsUsed;if(e.extensionsRequired=Je(e.extensionsRequired,[]),Ze(t))for(var n=t.length,r=0;r<n;++r){var i=t[r];Ze(zu[i])&&e.extensionsRequired.push(i)}}(e),function(o){au.buffer(o,function(e){Ze(e.byteLength)||(e.byteLength=e.extras._pipeline.source.length)}),au.accessor(o,function(e){var t,n,r,i=e.bufferView;Ze(i)&&(t=o.bufferViews[i],n=Vu(o,e),r=e.byteOffset+e.count*n,t.byteLength=Math.max(Je(t.byteLength,0),r))})}(e),function(n){var e,t,r,i=n.bufferViews,o={};au.accessorContainingVertexAttributeData(n,function(e){var t=n.accessors[e];Ze(t.bufferView)&&(o[t.bufferView]=!0)});var a={};for(var s in au.accessor(n,function(e){Ze(e.bufferView)&&(a[e.bufferView]=Je(a[e.bufferView],[]),a[e.bufferView].push(e))}),a)if(Object.prototype.hasOwnProperty.call(a,s)){r=i[s];var u=a[s];u.sort(function(e,t){return e.byteOffset-t.byteOffset});var l=0,c=0,h=u.length;for(e=0;e<h;++e){var f=u[e],p=Vu(n,f),d=f.byteOffset,m=f.count*p;delete f.byteStride;var _=e<h-1,g=_?Vu(n,u[e+1]):void 0;if(p!==g){var y=$e(r,!0);o[s]&&(y.byteStride=p),y.byteOffset+=l,y.byteLength=d+m-l;var v=iu(i,y);for(t=c;t<=e;++t)(f=u[t]).bufferView=v,f.byteOffset=f.byteOffset-l;l=_?u[e+1].byteOffset:void 0,c=e+1}}}Iu(n,["accessor","bufferView","buffer"])}(e),function(r){au.accessorWithSemantic(r,"POSITION",function(e){var t,n=r.accessors[e];Ze(n.min)&&Ze(n.max)||(t=xu(r,n),n.min=t.min,n.max=t.max)})}(e),function(r){au.animation(r,function(e){au.animationSampler(e,function(e){var t,n=r.accessors[e.input];Ze(n.min)&&Ze(n.max)||(t=xu(r,n),n.min=t.min,n.max=t.max)})})}(e),function(e){au.buffer(e,function(e){delete e.type})}(e),function(e){au.texture(e,function(e){delete e.format,delete e.internalFormat,delete e.target,delete e.type})}(e),function(e){au.mesh(e,function(e){au.meshPrimitive(e,function(n){au.meshPrimitiveAttribute(n,function(e,t){"TEXCOORD"===t?n.attributes.TEXCOORD_0=e:"COLOR"===t&&(n.attributes.COLOR_0=e)}),delete n.attributes.TEXCOORD,delete n.attributes.COLOR})}),au.technique(e,function(e){au.techniqueParameter(e,function(e){var t=e.semantic;Ze(t)&&("TEXCOORD"===t?e.semantic="TEXCOORD_0":"COLOR"===t&&(e.semantic="COLOR_0"))})})}(e),function(e){var s={};au.mesh(e,function(e){au.meshPrimitive(e,function(e){for(var t in au.meshPrimitiveAttribute(e,function(e,t){var n,r,i,o,a;"_"!==t.charAt(0)&&(n=t.search(/_[0-9]+/g),r=t,i="_0",0<=n&&(r=t.substring(0,n),i=t.substring(n)),Ze(a=Uu[r])?(o=a+i,s[t]=o):Ze(Bu[r])||(o="_"+t,s[t]=o))}),s){var n,r;Object.prototype.hasOwnProperty.call(s,t)&&(n=s[t],Ze(r=e.attributes[t])&&(delete e.attributes[t],e.attributes[n]=r))}})}),au.technique(e,function(e){au.techniqueParameter(e,function(e){var t=s[e.semantic];Ze(t)&&(e.semantic=t)})})}(e),function(n){var r;au.accessorWithSemantic(n,"JOINTS_0",function(e){var t=n.accessors[e];(r=t.componentType)===Rt.BYTE?Nu(n,t,Mt.UNSIGNED_BYTE):r!==Rt.UNSIGNED_BYTE&&r!==Rt.UNSIGNED_SHORT&&Nu(n,t,Mt.UNSIGNED_SHORT)}),au.accessorWithSemantic(n,"WEIGHTS_0",function(e){var t=n.accessors[e];(r=t.componentType)===Rt.BYTE?Nu(n,t,Mt.UNSIGNED_BYTE):r===Rt.SHORT&&Nu(n,t,Mt.UNSIGNED_SHORT)})}(e),function(e){au.camera(e,function(e){var t,n,r=e.perspective;Ze(r)&&(Ze(t=r.aspectRatio)&&0===t&&delete r.aspectRatio,Ze(n=r.yfov)&&0===n&&(r.yfov=1))})}(e),Cu(e),wu(e),function(e){for(var t in e){var n;Object.prototype.hasOwnProperty.call(e,t)&&(n=e[t],Array.isArray(n)&&0===n.length&&delete e[t])}au.node(e,function(e){Ze(e.children)&&0===e.children.length&&delete e.children})}(e)},"2.0":void 0};function Du(e,t){var n=(t=Je(t,Je.EMPTY_OBJECT)).targetVersion,r=e.version;e.asset=Je(e.asset,{version:"1.0"}),e.asset.version=Je(e.asset.version,"1.0"),r=Je(r,e.asset.version).toString(),Object.prototype.hasOwnProperty.call(Ru,r)||(Ze(r)&&(r=r.substring(0,3)),Object.prototype.hasOwnProperty.call(Ru,r)||(r="1.0"));for(var i=Ru[r];Ze(i)&&r!==n;)i(e,t),r=e.asset.version,i=Ru[r];return e}function Mu(e){var t,n,r=e.materials;for(var i in r){!Object.prototype.hasOwnProperty.call(r,i)||Ze(n=(t=r[i]).instanceTechnique)&&(t.technique=n.technique,t.values=n.values,delete t.instanceTechnique)}}function Fu(e,t){var n,r=[];for(var i in e){Object.prototype.hasOwnProperty.call(e,i)&&(n=e[i],t[i]=r.length,r.push(n),Ze(n.name)||(n.name=i))}return r}var zu={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0};var Bu={POSITION:!0,NORMAL:!0,TANGENT:!0},Uu={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};function Vu(e,t){return Ze(t.byteStride)&&0!==t.byteStride?t.byteStride:uu(e,t)}function ku(e){return(!Ze(e.children)||0===e.children.length)&&(!Ze(e.meshes)||0===e.meshes.length)&&!Ze(e.camera)&&!Ze(e.skin)&&!Ze(e.skeletons)&&!Ze(e.jointName)&&(!Ze(e.translation)||_t.fromArray(e.translation).equals(_t.ZERO))&&(!Ze(e.scale)||_t.fromArray(e.scale).equals(new _t(1,1,1)))&&(!Ze(e.rotation)||qt.fromArray(e.rotation).equals(new qt(0,0,0,1)))&&(!Ze(e.matrix)||on.fromColumnMajorArray(e.matrix).equals(on.IDENTITY))&&!Ze(e.extensions)&&!Ze(e.extras)}function Gu(){this._array=[],this._offset=0,this._length=0}function qu(){this.initialized=!1,this.resourcesParsed=!1,this.vertexBuffersToCreate=new Gu,this.indexBuffersToCreate=new Gu,this.buffers={},this.pendingBufferLoads=0,this.programsToCreate=new Gu,this.shaders={},this.pendingShaderLoads=0,this.texturesToCreate=new Gu,this.pendingTextureLoads=0,this.texturesToCreateFromBufferView=new Gu,this.pendingBufferViewToImage=0,this.createSamplers=!0,this.createSkins=!0,this.createRuntimeAnimations=!0,this.createVertexArrays=!0,this.createRenderStates=!0,this.createUniformMaps=!0,this.createRuntimeNodes=!0,this.createdBufferViews={},this.primitivesToDecode=new Gu,this.activeDecodingTasks=0,this.pendingDecodingCache=!1,this.skinnedNodesIds=[]}Object.defineProperties(Gu.prototype,{length:{get:function(){return this._length}}}),Gu.prototype.enqueue=function(e){this._array.push(e),this._length++},Gu.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,n=e[t];return e[t]=void 0,10<++t&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n}},Gu.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},Gu.prototype.contains=function(e){return-1!==this._array.indexOf(e)},Gu.prototype.clear=function(){this._array.length=this._offset=this._length=0},Gu.prototype.sort=function(e){0<this._offset&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)},qu.prototype.getBuffer=function(e){return t=this.buffers[e.buffer],n=e.byteOffset,r=e.byteLength,t.subarray(n,n+r);var t,n,r},qu.prototype.finishedPendingBufferLoads=function(){return 0===this.pendingBufferLoads},qu.prototype.finishedBuffersCreation=function(){return 0===this.pendingBufferLoads&&0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length},qu.prototype.finishedProgramCreation=function(){return 0===this.pendingShaderLoads&&0===this.programsToCreate.length},qu.prototype.finishedTextureCreation=function(){var e=0===this.pendingTextureLoads,t=0===this.texturesToCreate.length&&0===this.texturesToCreateFromBufferView.length;return e&&t},qu.prototype.finishedEverythingButTextureCreation=function(){var e=0===this.pendingBufferLoads&&0===this.pendingShaderLoads,t=0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length&&0===this.programsToCreate.length&&0===this.pendingBufferViewToImage;return this.finishedDecoding()&&e&&t},qu.prototype.finishedDecoding=function(){return 0===this.primitivesToDecode.length&&0===this.activeDecodingTasks&&!this.pendingDecodingCache},qu.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};var Hu={updateForwardAxis:function(e){var t=e.gltf.extras.sourceVersion;(Ze(t)&&"2.0"!==t||"2.0"!==Hu.getAssetVersion(e.gltf))&&(e._gltfForwardAxis=xn.X)},getAssetVersion:function(e){return Ze(e.asset)&&Ze(e.asset.version)?e.asset.version:"1.0"},splitIncompatibleMaterials:function(e){var _=e.accessors,g=e.materials,y={};return au.mesh(e,function(e){au.meshPrimitive(e,function(e){var t,n,r,i=e.material,o=g[i],a=e.attributes.JOINTS_0;Ze(a)&&(n=(t=_[a]).componentType,r=t.type);var s,u=Ze(a),l=Ze(e.attributes.COLOR_0),c=Ze(e.targets),h=Ze(e.attributes.NORMAL),f=Ze(e.attributes.TANGENT),p=Ze(e.attributes.TEXCOORD_0),d=Ze(e.extensions)&&Ze(e.extensions.CESIUM_primitive_outline),m=y[i];Ze(m)?m.skinning.skinned===u&&m.skinning.type===r&&m.hasVertexColors===l&&m.hasMorphTargets===c&&m.hasNormals===h&&m.hasTangents===f&&m.hasTexCoords===p&&m.hasOutline===d||(s=$e(o,!0),i=iu(g,s),e.material=i,y[i]={skinning:{skinned:u,componentType:n,type:r},hasVertexColors:l,hasMorphTargets:c,hasNormals:h,hasTangents:f,hasTexCoords:p,hasOutline:d}):y[i]={skinning:{skinned:u,componentType:n,type:r},hasVertexColors:l,hasMorphTargets:c,hasNormals:h,hasTangents:f,hasTexCoords:p,hasOutline:d}})}),y},getShaderVariable:function(e){return"SCALAR"===e?"float":e.toLowerCase()},ModelState:{NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},getFailedLoadFunction:function(n,r,i){return function(e){n._state=Hu.ModelState.FAILED;var t="Failed to load "+r+": "+i;Ze(e)&&(t+="\n"+e.message),n._readyPromise.reject(new de(t))}},parseBuffers:function(r,i){var o=r._loadResources;au.buffer(r.gltf,function(e,t){var n;Ze(e.extras._pipeline.source)?o.buffers[t]=e.extras._pipeline.source:Ze(i)&&(n=r._resource.getDerivedResource({url:e.uri}),++o.pendingBufferLoads,n.fetchArrayBuffer().then(i(r,t)).otherwise(Hu.getFailedLoadFunction(r,"buffer",n.url)))})}},Wu=new _t,Yu=new _t;function Xu(e,n){return au.techniqueAttribute(e,function(e,t){if(e.semantic===n)return t})}function ju(e,r,i,o){return ou(e,"KHR_techniques_webgl")?function(e,t){if(!(e.semantic!==i||o&&Ze(e.node)))return t}:function(e,t){var n=r.parameters[e];if(!(n.semantic!==i||o&&Ze(n.node)))return t}}Hu.computeBoundingSphere=function(e){for(var t=e.gltf,n=t.nodes,r=t.meshes,i=t.scenes[t.scene].nodes,o=i.length,a=[],s=new _t(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new _t(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=0;l<o;++l){var c=n[i[l]];for(c._transformToRoot=Hu.getTransform(c),a.push(c);0<a.length;){var h=(c=a.pop())._transformToRoot,f=c.mesh;if(Ze(f))for(var p=r[f].primitives,d=p.length,m=0;m<d;++m){var _,g,y,v=p[m].attributes.POSITION;!Ze(v)||Ze((_=Hu.getAccessorMinMax(t,v)).min)&&Ze(_.max)&&(g=_t.fromArray(_.min,0,Wu),y=_t.fromArray(_.max,0,Yu),Ze(s)&&Ze(u)&&(on.multiplyByPoint(h,g,g),on.multiplyByPoint(h,y,y),_t.minimumByComponent(s,g,s),_t.maximumByComponent(u,y,u)))}var x=c.children;if(Ze(x))for(var b=x.length,E=0;E<b;++E){var T=n[x[E]];T._transformToRoot=Hu.getTransform(T),on.multiplyTransformation(h,T._transformToRoot,T._transformToRoot),a.push(T)}delete c._transformToRoot}}var S=ko.fromCornerPoints(s,u);return e._forwardAxis===xn.Z&&ko.transformWithoutScale(S,xn.Z_UP_TO_X_UP,S),e._upAxis===xn.Y?ko.transformWithoutScale(S,xn.Y_UP_TO_Z_UP,S):e._upAxis===xn.X&&ko.transformWithoutScale(S,xn.X_UP_TO_Z_UP,S),S},Hu.ensureSemanticExistence=function(t){return au.mesh(t,function(e){au.meshPrimitive(e,function(e){!function(e,t){var n=e.accessors,r=e.materials,i=e.extensions.KHR_techniques_webgl,o=i.techniques,a=i.programs,s=i.shaders,u=t.targets,l=t.attributes;for(var c in u)if(u.hasOwnProperty(c)){var h=u[c];for(var f in h)"extras"!==f&&(l[f+"_"+c]=h[f])}var p,d,m,_,g,y=o[r[t.material].extensions.KHR_techniques_webgl.technique],v=s[a[y.program].vertexShader];for(var x in l){l.hasOwnProperty(x)&&(Ze(Xu(y,x))||(p=n[l[x]],"_"===(d=x.toLowerCase()).charAt(0)&&(d=d.slice(1)),m="a_"+d,y.attributes[m]={semantic:x,type:p.componentType},g=(_=v.extras._pipeline).source,g="attribute "+Hu.getShaderVariable(p.type)+" "+m+";\n"+g,_.source=g))}}(t,e)})}),t},Hu.createAttributeLocations=function(e,t){var n={},r=!1,i=1;if(au.techniqueAttribute(e,function(e,t){/pos/i.test(t)&&!r?(n[t]=0,r=!0):n[t]=i++}),Ze(t))for(var o in t)t.hasOwnProperty(o)&&(n[o]=i++);return n},Hu.getAccessorMinMax=function(e,t){var n,r=e.accessors[t],i=r.extensions,o=r.min,a=r.max;return!Ze(i)||Ze(n=i.WEB3D_quantized_attributes)&&(o=n.decodedMin,a=n.decodedMax),{min:o,max:a}},Hu.getAttributeOrUniformBySemantic=function(n,r,i,o){return au.technique(n,function(e){if(!Ze(i)||e.program===i){var t=au.techniqueAttribute(e,ju(n,e,r,o));return Ze(t)?t:au.techniqueUniform(e,ju(n,e,r,o))}})},Hu.getDiffuseAttributeOrUniform=function(e,t){var n=Hu.getAttributeOrUniformBySemantic(e,"COLOR_0",t);return Ze(n)||(n=Hu.getAttributeOrUniformBySemantic(e,"_3DTILESDIFFUSE",t)),n};var Ku=new _t,Qu=new Si,Zu=new _t;function Ju(e,t,n){t+="(?!\\w)",t=new RegExp(t,"g");var r=e.search(t);return e.replace(t,function(e,t){return r===t?e:n})}function $u(e,t){var n=e.accessors[t].extensions;if(Ze(n))return n.WEB3D_quantized_attributes}function el(e,t,n){var r=t.material,i=e.materials[r];if(ou(e,"KHR_techniques_webgl")&&Ze(i.extensions)&&Ze(i.extensions.KHR_techniques_webgl)){var o=i.extensions.KHR_techniques_webgl.technique,a=e.extensions.KHR_techniques_webgl.techniques[o];return au.techniqueAttribute(a,function(e,t){if(e.semantic===n)return t})}}function tl(e){var t={value:e,clone:function(e,t){return e},func:function(){return t.value}};return t}function nl(e){var t={value:En.fromArray(e),clone:En.clone,func:function(){return t.value}};return t}function rl(e){var t={value:_t.fromArray(e),clone:_t.clone,func:function(){return t.value}};return t}function il(e){var t={value:qt.fromArray(e),clone:qt.clone,func:function(){return t.value}};return t}function ol(e){var t={value:fi.fromColumnMajorArray(e),clone:fi.clone,func:function(){return t.value}};return t}function al(e){var t={value:jt.fromColumnMajorArray(e),clone:jt.clone,func:function(){return t.value}};return t}function sl(e){var t={value:on.fromColumnMajorArray(e),clone:on.clone,func:function(){return t.value}};return t}function ul(e,t,n){this._value=void 0,this._textureId=e.index,this._textures=t,this._defaultTexture=n}Hu.getTransform=function(e,t){return Ze(e.matrix)?on.fromColumnMajorArray(e.matrix,t):on.fromTranslationQuaternionRotationScale(_t.fromArray(e.translation,0,Ku),Si.unpack(e.rotation,0,Qu),_t.fromArray(e.scale,0,Zu),t)},Hu.getUsedExtensions=function(e){var t=e.extensionsUsed,n={};if(Ze(t))for(var r=t.length,i=0;i<r;i++){n[t[i]]=!0}return n},Hu.getRequiredExtensions=function(e){var t=e.extensionsRequired,n={};if(Ze(t))for(var r=t.length,i=0;i<r;i++){n[t[i]]=!0}return n},Hu.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0},Hu.checkSupportedExtensions=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){if(!Hu.supportedExtensions[n])throw new de("Unsupported glTF Extension: "+n);if("EXT_texture_webp"===n&&!1===t)throw new de("Loaded model requires WebP but browser does not support it.")}},Hu.checkSupportedGlExtensions=function(e,t){if(Ze(e))for(var n=e.length,r=0;r<n;r++){var i=e[r];if("OES_element_index_uint"!==i)throw new de("Unsupported WebGL Extension: "+i);if(!t.elementIndexUint)throw new de("OES_element_index_uint WebGL extension is not enabled.")}},Hu.modifyShaderForDracoQuantizedAttributes=function(e,t,n,r){var i={};for(var o in r)if(r.hasOwnProperty(o)){var a=r[o],s=a.quantization;if(!Ze(s))continue;var u=el(e,t,o);if(!Ze(u))continue;"_"===o.charAt(0)&&(o=o.substring(1));var l,c,h,f,p,d,m,_,g,y="gltf_u_dec_"+o.toLowerCase();Ze(i[y])||(l="gltf_decoded_"+o,c=u.replace("a_","gltf_a_dec_"),h=a.componentsPerAttribute,n=Ju(n,u,c),n=(f=s.octEncoded?"vec3":1<h?"vec"+h:"float")+" "+c+";\n"+n,(p=3===h&&"COLOR_0"===o)&&(n=Ju(n,c,"vec4("+c+", 1.0)")),g="",g=s.octEncoded?(n="uniform float "+(d=y+"_rangeConstant")+";\n"+n,"\nvoid main() {\n    "+c+" = czm_octDecode("+u+".xy, "+d+").zxy;\n    "+l+"();\n}\n"):(n="uniform float "+(m=y+"_normConstant")+";\nuniform "+f+" "+(_=y+"_min")+";\n"+n,"\nvoid main() {\n    "+c+" = "+_+" + "+u+(p?".xyz":"")+" * "+m+";\n    "+l+"();\n}\n"),n=Xr.replaceMain(n,l),n+=g)}return{shader:n}},Hu.modifyShaderForQuantizedAttributes=function(e,t,n){var r,i,o,a,s,u,l,c,h,f,p,d,m={},_=t.attributes;for(var g in _){_.hasOwnProperty(g)&&(r=el(e,t,g),i=t.attributes[g],"_"===g.charAt(0)&&(g=g.substring(1)),a=(o="gltf_u_dec_"+g.toLowerCase())+"_scale",s=o+"_translate",Ze(m[o])||Ze(m[a])||Ze(u=$u(e,i))&&(l=u.decodeMatrix,c="gltf_decoded_"+g,h=r.replace("a_","gltf_a_dec_"),n=(p=2<(f=Math.floor(Math.sqrt(l.length)))?"vec"+(f-1):"float")+" "+h+";\n"+(n=Ju(n,r,h)),d="",5===f?(n="uniform vec4 "+s+";\n"+(n="uniform mat4 "+a+";\n"+n),d="\nvoid main() {\n    "+h+" = "+a+" * "+r+" + "+s+";\n    "+c+"();\n}\n",m[a]={mat:4},m[s]={vec:4}):(n="uniform mat"+f+" "+o+";\n"+n,d="\nvoid main() {\n    "+h+" = "+p+"("+o+" * vec"+f+"("+r+",1.0));\n    "+c+"();\n}\n",m[o]={mat:f}),n=Xr.replaceMain(n,c),n+=d))}return{shader:n,uniforms:m}},Hu.toClipCoordinatesGLSL=function(e,t){var n=Hu.getAttributeOrUniformBySemantic(e,"POSITION"),r=n.replace("a_","gltf_a_dec_");-1!==t.indexOf(r)&&(n=r);var i,o,a=Hu.getAttributeOrUniformBySemantic(e,"MODELVIEWPROJECTION",void 0,!0);return Ze(a)&&-1!==t.indexOf(a)||(i=Hu.getAttributeOrUniformBySemantic(e,"PROJECTION",void 0,!0),o=Hu.getAttributeOrUniformBySemantic(e,"MODELVIEW",void 0,!0),-1!==t.indexOf("czm_instanced_modelView ")?o="czm_instanced_modelView":Ze(o)||(o=Hu.getAttributeOrUniformBySemantic(e,"CESIUM_RTC_MODELVIEW",void 0,!0)),a=i+" * "+o),a+" * vec4("+n+".xyz, 1.0)"},Hu.modifyFragmentShaderForLogDepth=function(e){return e=Xr.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"},Hu.modifyFragmentShaderForLogDepthAddRoller=function(e){return e=Xr.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_rollerShutter(gl_FragCoord.xy,u_rollerRegion); \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"},Hu.modifyVertexShaderForLogDepth=function(e,t){return e=Xr.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_vertexLogDepth("+t+"); \n} \n"},Object.defineProperties(ul.prototype,{value:{get:function(){if(!Ze(this._value)){var e=this._textures[this._textureId];if(!Ze(e))return this._defaultTexture;this._value=e}return this._value},set:function(e){this._value=e}}}),ul.prototype.clone=function(e){return e},ul.prototype.func=void 0;var ll={};ll[Rt.FLOAT]=tl,ll[Rt.FLOAT_VEC2]=nl,ll[Rt.FLOAT_VEC3]=rl,ll[Rt.FLOAT_VEC4]=il,ll[Rt.INT]=tl,ll[Rt.INT_VEC2]=nl,ll[Rt.INT_VEC3]=rl,ll[Rt.INT_VEC4]=il,ll[Rt.BOOL]=tl,ll[Rt.BOOL_VEC2]=nl,ll[Rt.BOOL_VEC3]=rl,ll[Rt.BOOL_VEC4]=il,ll[Rt.FLOAT_MAT2]=ol,ll[Rt.FLOAT_MAT3]=al,ll[Rt.FLOAT_MAT4]=sl,ll[Rt.SAMPLER_2D]=function(e,t,n){var r=new ul(e,t,n);return r.func=function(){return r.value},r},Hu.createUniformFunction=function(e,t,n,r){return ll[e](t,n,r)},Hu.createUniformsForDracoQuantizedAttributes=function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=r.quantization;if(!Ze(i))continue;"_"===n.charAt(0)&&(n=n.substring(1));var o="gltf_u_dec_"+n.toLowerCase();if(i.octEncoded){var a=o+"_rangeConstant",s=(1<<i.quantizationBits)-1;t[a]=tl(s).func;continue}var u=o+"_normConstant",l=i.range/(1<<i.quantizationBits);t[u]=tl(l).func;var c=o+"_min";switch(r.componentsPerAttribute){case 1:t[c]=tl(i.minValues).func;break;case 2:t[c]=nl(i.minValues).func;break;case 3:t[c]=rl(i.minValues).func;break;case 4:t[c]=il(i.minValues).func}}return t},Hu.createUniformsForQuantizedAttributes=function(e,t,n){var r,i,o,a=e.accessors,s={},u={},l=t.attributes;for(var c in l)if(l.hasOwnProperty(c)){var h=a[l[c]],f=h.extensions;if("_"===c.charAt(0)&&(c=c.substring(1)),Ze(f)){var p=f.WEB3D_quantized_attributes;if(Ze(p)){var d=p.decodeMatrix,m="gltf_u_dec_"+c.toLowerCase();switch(h.type){case ni.SCALAR:u[m]=ol(d).func,s[m]=!0;break;case ni.VEC2:u[m]=al(d).func,s[m]=!0;break;case ni.VEC3:u[m]=sl(d).func,s[m]=!0;break;case ni.VEC4:var _=m+"_scale",g=m+"_translate";u[_]=sl([(i=d)[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]]).func,u[g]=il([(r=d)[20],r[21],r[22],r[23]]).func,s[_]=!0,s[g]=!0}}}}for(var y in n){n.hasOwnProperty(y)&&(s[y]||(Ze((o=n[y]).mat)&&(2===o.mat?u[y]=ol(fi.IDENTITY).func:3===o.mat?u[y]=al(jt.IDENTITY).func:4===o.mat&&(u[y]=sl(on.IDENTITY).func)),Ze(o.vec)&&4===o.vec&&(u[y]=il([0,0,0,0]).func)))}return u};var cl=new _t,hl={MODEL:function(e,t){return function(){return e.model}},VIEW:function(e,t){return function(){return e.view}},PROJECTION:function(e,t){return function(){return e.projection}},MODELVIEW:function(e,t){return function(){return e.modelView}},CESIUM_RTC_MODELVIEW:function(e,t){var n=new on;return function(){return Ze(t._rtcCenter)?(on.getTranslation(e.model,cl),_t.add(cl,t._rtcCenter,cl),on.multiplyByPoint(e.view,cl,cl),on.setTranslation(e.modelView,cl,n)):e.modelView}},MODELVIEWPROJECTION:function(e,t){return function(){return e.modelViewProjection}},MODELINVERSE:function(e,t){return function(){return e.inverseModel}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t){return function(){return e.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(e,t){return function(){return e.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(e,t){return function(){return e.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(e,t){return function(){return e.normal}},VIEWPORT:function(e,t){return function(){return e.viewportCartesian4}}};function fl(e){switch(e){case Rt.FLOAT:return"float";case Rt.FLOAT_VEC2:return"vec2";case Rt.FLOAT_VEC3:return"vec3";case Rt.FLOAT_VEC4:return"vec4";case Rt.FLOAT_MAT2:return"mat2";case Rt.FLOAT_MAT3:return"mat3";case Rt.FLOAT_MAT4:return"mat4";case Rt.SAMPLER_2D:return"sampler2D";case Rt.BOOL:return"bool"}}function pl(l,c){if(c=Je(c,Je.EMPTY_OBJECT),Ze(l)&&ou(l,"KHR_materials_common")){ou(l,"KHR_techniques_webgl")||(Ze(l.extensions)||(l.extensions={}),l.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},l.extensionsUsed.push("KHR_techniques_webgl"),l.extensionsRequired.push("KHR_techniques_webgl"));var h=l.extensions.KHR_techniques_webgl;!function(e){var t=e.extensions.KHR_materials_common;if(!Ze(t)||!Ze(t.lights))return;for(var n=t.lights,r=n.length,i=0;i<r;i++){var o,a,s,u,l=n[i];"ambient"===l.type?(Ze(l.ambient)||(l.ambient={}),Ze((o=l.ambient).color)||(o.color=[1,1,1])):"directional"===l.type?(Ze(l.directional)||(l.directional={}),Ze((a=l.directional).color)||(a.color=[1,1,1])):"point"===l.type?(Ze(l.point)||(l.point={}),Ze((s=l.point).color)||(s.color=[1,1,1]),s.constantAttenuation=Je(s.constantAttenuation,1),s.linearAttenuation=Je(s.linearAttenuation,0),s.quadraticAttenuation=Je(s.quadraticAttenuation,0)):"spot"===l.type&&(Ze(l.spot)||(l.spot={}),Ze((u=l.spot).color)||(u.color=[1,1,1]),u.constantAttenuation=Je(u.constantAttenuation,1),u.fallOffAngle=Je(u.fallOffAngle,3.14159265),u.fallOffExponent=Je(u.fallOffExponent,0),u.linearAttenuation=Je(u.linearAttenuation,0),u.quadraticAttenuation=Je(u.quadraticAttenuation,0))}}(l);var f=function(e){var t,n={};Ze(e.extensions)&&Ze(e.extensions.KHR_materials_common)&&(t=e.extensions.KHR_materials_common.lights);if(Ze(t)){var r,i,o=e.nodes;for(var a in o){!o.hasOwnProperty(a)||Ze((r=o[a]).extensions)&&Ze(r.extensions.KHR_materials_common)&&(Ze(i=r.extensions.KHR_materials_common.light)&&Ze(t[i])&&(t[i].node=a),delete r.extensions.KHR_materials_common)}var s=0;for(var u in t)if(t.hasOwnProperty(u)){var l=t[u],c=l.type;if("ambient"!==c&&!Ze(l.node)){delete t[u];continue}var h="light"+s.toString();switch(l.baseName=h,c){case"ambient":var f=l.ambient;n[h+"Color"]={type:Rt.FLOAT_VEC3,value:f.color};break;case"directional":var p=l.directional;n[h+"Color"]={type:Rt.FLOAT_VEC3,value:p.color},Ze(l.node)&&(n[h+"Transform"]={node:l.node,semantic:"MODELVIEW",type:Rt.FLOAT_MAT4});break;case"point":var d=l.point;n[h+"Color"]={type:Rt.FLOAT_VEC3,value:d.color},Ze(l.node)&&(n[h+"Transform"]={node:l.node,semantic:"MODELVIEW",type:Rt.FLOAT_MAT4}),n[h+"Attenuation"]={type:Rt.FLOAT_VEC3,value:[d.constantAttenuation,d.linearAttenuation,d.quadraticAttenuation]};break;case"spot":var m=l.spot;n[h+"Color"]={type:Rt.FLOAT_VEC3,value:m.color},Ze(l.node)&&(n[h+"Transform"]={node:l.node,semantic:"MODELVIEW",type:Rt.FLOAT_MAT4},n[h+"InverseTransform"]={node:l.node,semantic:"MODELVIEWINVERSE",type:Rt.FLOAT_MAT4,useInFragment:!0}),n[h+"Attenuation"]={type:Rt.FLOAT_VEC3,value:[m.constantAttenuation,m.linearAttenuation,m.quadraticAttenuation]},n[h+"FallOff"]={type:Rt.FLOAT_VEC2,value:[m.fallOffAngle,m.fallOffExponent]}}++s}}return n}(l),p=Hu.splitIncompatibleMaterials(l),d={},m=!1;return(au.material(l,function(e,t){if(Ze(e.extensions)&&Ze(e.extensions.KHR_materials_common)){var n=e.extensions.KHR_materials_common,r=p[t],i=function(e,t){var n="";n+="technique:"+e.technique+";";for(var r=e.values,i=Object.keys(r).sort(),o=i.length,a=0;a<o;++a){var s=i[a];r.hasOwnProperty(s)&&(n+=s+":"+dl(s,r[s]),n+=";")}var u=Je(e.jointCount,0);{var l;n+=u.toString()+";",Ze(t)&&(l=t.skinning,0<u&&(n+=l.type+";"),n+=t.hasVertexColors)}return n}(n,r),o=d[i];Ze(o)||(o=function(e,t,n,r,i,o){Ze(r)||(r={});o=Je(o,!1);var a,s=t.techniques,u=t.shaders,l=t.programs,c=r.technique.toUpperCase();Ze(e.extensions)&&Ze(e.extensions.KHR_materials_common)&&(a=e.extensions.KHR_materials_common.lights);var h,f=r.values,p=Je(r.jointCount,0),d=!1,m=!1;Ze(n)&&(h=n.skinning,d=h.skinned,m=n.hasVertexColors);var _,g="precision highp float;\n",y="precision highp float;\n",v="CONSTANT"!==c,x={u_modelViewMatrix:{semantic:ou(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Rt.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Rt.FLOAT_MAT4}};v&&(x.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Rt.FLOAT_MAT3});d&&(x.u_jointMatrix={count:p,semantic:"JOINTMATRIX",type:Rt.FLOAT_MAT4});var b=!1;for(var E in f){var T;f.hasOwnProperty(E)&&"transparent"!==E&&"doubleSided"!==E&&(T=dl(E,f[E]),_="u_"+E.toLowerCase(),b||T!==Rt.SAMPLER_2D||(b=!0),x[_]={type:T})}Ze(x.u_diffuse)&&(x.u_diffuse.semantic="_3DTILESDIFFUSE");if(Ze(i))for(var S in i)i.hasOwnProperty(S)&&(x[_="u_"+S]=i[S]);for(_ in x){var C,w;x.hasOwnProperty(_)&&(C=x[_],w=Ze(C.count)?"["+C.count+"]":"",C.type!==Rt.FLOAT_MAT3&&C.type!==Rt.FLOAT_MAT4||C.useInFragment?(y+="uniform "+fl(C.type)+" "+_+w+";\n",delete C.useInFragment):g+="uniform "+fl(C.type)+" "+_+w+";\n")}var A,I,P="";if(d){var O=su(h.type),L=!1;if(0===h.type.indexOf("MAT")&&(L=!0,O=Math.sqrt(O)),L)for(A=0;A<O;A++)for(I=0;I<O;I++)P+=0===A&&0===I?"  mat4 skinMat = ":"  skinMat += ",P+="a_weight["+A+"]["+I+"] * u_jointMatrix[int(a_joint["+A+"]["+I+"])];\n";else for(A=0;A<O;A++)P+=0===A?"  mat4 skinMat = ":"  skinMat += ",P+="a_weight["+A+"] * u_jointMatrix[int(a_joint["+A+"])];\n"}var N,R={a_position:{semantic:"POSITION"}};g+="attribute vec3 a_position;\n",g+="varying vec3 v_positionEC;\n",P+=d?"  vec4 pos = u_modelViewMatrix * skinMat * vec4(a_position,1.0);\n":"  vec4 pos = u_modelViewMatrix * vec4(a_position,1.0);\n";P+="  v_positionEC = pos.xyz;\n",P+="  gl_Position = u_projectionMatrix * pos;\n",y+="varying vec3 v_positionEC;\n",v&&(R.a_normal={semantic:"NORMAL"},g+="attribute vec3 a_normal;\n",g+="varying vec3 v_normal;\n",P+=d?"  v_normal = u_normalMatrix * mat3(skinMat) * a_normal;\n":"  v_normal = u_normalMatrix * a_normal;\n",y+="varying vec3 v_normal;\n");b&&(R.a_texcoord_0={semantic:"TEXCOORD_0"},g+="attribute vec2 a_texcoord_0;\n",g+="varying vec2 "+(N="v_texcoord_0")+";\n",P+="  "+N+" = a_texcoord_0;\n",y+="varying vec2 "+N+";\n");{var D;d&&(D=Hu.getShaderVariable(h.type),R.a_joint={semantic:"JOINT"},R.a_weight={semantic:"WEIGHT"},g+="attribute "+D+" a_joint;\n",g+="attribute "+D+" a_weight;\n")}m&&(R.a_vertexColor={semantic:"COLOR_0"},g+="attribute vec4 a_vertexColor;\n",g+="varying vec4 v_vertexColor;\n",P+="  v_vertexColor = a_vertexColor;\n",y+="varying vec4 v_vertexColor;\n");o&&(R.a_batchId={semantic:"_BATCHID"},g+="attribute float a_batchId;\n");var M,F,z=v&&("BLINN"===c||"PHONG"===c)&&Ze(x.u_specular)&&Ze(x.u_shininess)&&0<x.u_shininess,B=!1,U=!1,V="";for(var k in a){var G,q,H,W;a.hasOwnProperty(k)&&(G=a[k],q=G.type.toLowerCase(),H=G.baseName,V+="  {\n",W="u_"+H+"Color","ambient"===q?(U=!0,V+="    ambientLight += "+W+";\n"):v&&(B=!0,M="v_"+H+"Direction",F="v_"+H+"Position","point"!==q&&(g+="varying vec3 "+M+";\n",y+="varying vec3 "+M+";\n",P+="  "+M+" = mat3(u_"+H+"Transform) * vec3(0.,0.,1.);\n","directional"===q&&(V+="    vec3 l = normalize("+M+");\n")),"directional"!==q?(g+="varying vec3 "+F+";\n",y+="varying vec3 "+F+";\n",P+="  "+F+" = u_"+H+"Transform[3].xyz;\n",V+="    vec3 VP = "+F+" - v_positionEC;\n",V+="    vec3 l = normalize(VP);\n",V+="    float range = length(VP);\n",V+="    float attenuation = 1.0 / (u_"+H+"Attenuation.x + ",V+="(u_"+H+"Attenuation.y * range) + ",V+="(u_"+H+"Attenuation.z * range * range));\n"):V+="    float attenuation = 1.0;\n","spot"===q&&(V+="    float spotDot = dot(l, normalize("+M+"));\n",V+="    if (spotDot < cos(u_"+H+"FallOff.x * 0.5))\n",V+="    {\n",V+="      attenuation = 0.0;\n",V+="    }\n",V+="    else\n",V+="    {\n",V+="        attenuation *= max(0.0, pow(spotDot, u_"+H+"FallOff.y));\n",V+="    }\n"),V+="    diffuseLight += "+W+"* max(dot(normal,l), 0.) * attenuation;\n",z&&("BLINN"===c?(V+="    vec3 h = normalize(l + viewDir);\n",V+="    float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;\n"):(V+="    vec3 reflectDir = reflect(-l, normal);\n",V+="    float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;\n"),V+="    specularLight += "+W+" * specularIntensity;\n")),V+="  }\n")}U||(V+="  ambientLight += vec3(0.2, 0.2, 0.2);\n");{B||"CONSTANT"===c||(y+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",y+="uniform vec3 gltf_lightColor; \n",y+="#endif \n",V+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",V+="    vec3 lightColor = czm_lightColor;\n",V+="#else \n",V+="    vec3 lightColor = gltf_lightColor;\n",V+="#endif \n",V+="  vec3 l = normalize(czm_lightDirectionEC);\n",V+="  diffuseLight += lightColor * max(dot(normal,l), 0.2);\n",z&&("BLINN"===c?(V+="  vec3 h = normalize(l + viewDir);\n",V+="  float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess));\n"):(V+="  vec3 reflectDir = reflect(-l, normal);\n",V+="  float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));\n"),V+="  specularLight += lightColor * specularIntensity;\n"))}g+="void main(void) {\n",g+=P,g+="}\n",y+="void main(void) {\n";var Y,X="  vec3 color = vec3(0.0, 0.0, 0.0);\n";v&&(y+="  vec3 normal = normalize(v_normal);\n",r.doubleSided&&(y+="  if (gl_FrontFacing == false)\n",y+="  {\n",y+="    normal = -normal;\n",y+="  }\n"));Y="CONSTANT"!==c?(Ze(x.u_diffuse)&&(x.u_diffuse.type===Rt.SAMPLER_2D?y+="  vec4 diffuse = texture2D(u_diffuse, "+N+");\n":y+="  vec4 diffuse = u_diffuse;\n",y+="  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n",X+="  color += diffuse.rgb * diffuseLight;\n"),z&&(x.u_specular.type===Rt.SAMPLER_2D?y+="  vec3 specular = texture2D(u_specular, "+N+").rgb;\n":y+="  vec3 specular = u_specular.rgb;\n",y+="  vec3 specularLight = vec3(0.0, 0.0, 0.0);\n",X+="  color += specular * specularLight;\n"),Ze(x.u_transparency)?"  gl_FragColor = vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);\n":"  gl_FragColor = vec4(color * diffuse.a, diffuse.a);\n"):Ze(x.u_transparency)?"  gl_FragColor = vec4(color * u_transparency, u_transparency);\n":"  gl_FragColor = vec4(color, 1.0);\n";m&&(X+="  color *= v_vertexColor.rgb;\n");Ze(x.u_emission)&&(x.u_emission.type===Rt.SAMPLER_2D?y+="  vec3 emission = texture2D(u_emission, "+N+").rgb;\n":y+="  vec3 emission = u_emission.rgb;\n",X+="  color += emission;\n");!Ze(x.u_ambient)&&"CONSTANT"===c||(Ze(x.u_ambient)?x.u_ambient.type===Rt.SAMPLER_2D?y+="  vec3 ambient = texture2D(u_ambient, "+N+").rgb;\n":y+="  vec3 ambient = u_ambient.rgb;\n":y+="  vec3 ambient = diffuse.rgb;\n",X+="  color += ambient * ambientLight;\n");y+="  vec3 viewDir = -normalize(v_positionEC);\n",y+="  vec3 ambientLight = vec3(0.0, 0.0, 0.0);\n",y+=V,y+=X,y+=Y,y+="}\n";var j=iu(u,{type:Rt.VERTEX_SHADER,extras:{_pipeline:{source:g,extension:".glsl"}}}),K=iu(u,{type:Rt.FRAGMENT_SHADER,extras:{_pipeline:{source:y,extension:".glsl"}}}),Q=iu(l,{fragmentShader:K,vertexShader:j});return iu(s,{attributes:R,program:Q,uniforms:x})}(l,h,r,n,f,c.addBatchIdToGeneratedShaders),d[i]=o,m=!0);var a={},s=n.values;for(var u in s)s.hasOwnProperty(u)&&"transparent"!==u&&"doubleSided"!==u&&(a["u_"+u.toLowerCase()]=s[u]);e.extensions.KHR_techniques_webgl={technique:o,values:a},e.alphaMode="OPAQUE",n.transparent&&(e.alphaMode="BLEND"),n.doubleSided&&(e.doubleSided=!0)}}),m)?(Hu.ensureSemanticExistence(l),l):l}}function dl(e,t){var n=Ze(t.value)?t.value:Ze(t.index)?[t.index]:t;switch(e){case"ambient":case"diffuse":case"emission":case"specular":return 1===n.length?Rt.SAMPLER_2D:Rt.FLOAT_VEC4;case"shininess":case"transparency":return Rt.FLOAT;case"transparent":case"doubleSided":return Rt.BOOL}}function ml(i,o){if(o=Je(o,Je.EMPTY_OBJECT),ou(i,"KHR_techniques_webgl"))return i;if(!Ze(i.materials)||0===i.materials.length)return i;Ze(i.extensions)||(i.extensions={}),Ze(i.extensionsUsed)||(i.extensionsUsed=[]),Ze(i.extensionsRequired)||(i.extensionsRequired=[]),i.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},i.extensionsUsed.push("KHR_techniques_webgl"),i.extensionsRequired.push("KHR_techniques_webgl");var a=Hu.splitIncompatibleMaterials(i);return au.material(i,function(e,t){var n={},r=function(e,t,n,r,i,o){var a,s,u,l=Je(o.addBatchIdToGeneratedShaders,!1),c=Je(o.gradual,!1),h=e.extensions.KHR_techniques_webgl,f=h.techniques,p=h.shaders,d=h.programs,m=function(e){return Ze(e.extensions)&&Ze(e.extensions.KHR_materials_pbrSpecularGlossiness)}(t),_=t.pbrMetallicRoughness;if(Ze(_)&&!m)for(s in _)_.hasOwnProperty(s)&&(u=_[s],r[a="u_"+s]=u,xl(s,u,r));if(m){var g=t.extensions.KHR_materials_pbrSpecularGlossiness;for(s in g)g.hasOwnProperty(s)&&(u=g[s],r[a="u_"+s]=u,xl(s,u,r))}for(var y in t)t.hasOwnProperty(y)&&(0<=y.indexOf("Texture")||0<=y.indexOf("Factor"))&&(u=t[y],r[a="u_"+y]=u,xl(y,u,r));var v,x="precision highp float;\n",b="precision highp float;\n";Ze(e.skins)&&(v=e.skins[0]);var E,T,S=Ze(v)?v.joints:[],C=S.length,w=i[n],A=!1,I=!1,P=!1,O=!1,L=!1,N=!1,R=!1,D=!1;Ze(w)&&(E=w.skinning,A=E.skinned&&0<S.length,I=w.hasVertexColors,P=w.hasMorphTargets,O=w.hasNormals,L=w.hasTangents,N=w.hasTexCoords,R=w.hasOutline);P&&au.mesh(e,function(e){au.meshPrimitive(e,function(e){var t;e.material!==n||Ze(t=e.targets)&&(T=t)})});var M={u_modelViewMatrix:{semantic:ou(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:Rt.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:Rt.FLOAT_MAT4}};Ze(t.extensions)&&Ze(t.extensions.KHR_materials_unlit)&&(L=O=!(D=!0));O&&(M.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:Rt.FLOAT_MAT3});A&&(M.u_jointMatrix={count:C,semantic:"JOINTMATRIX",type:Rt.FLOAT_MAT4});P&&(M.u_morphWeights={count:T.length,semantic:"MORPHWEIGHTS",type:Rt.FLOAT});var F=t.alphaMode;Ze(F)&&"MASK"===F&&(M.u_alphaCutoff={semantic:"ALPHACUTOFF",type:Rt.FLOAT});for(a in r)r.hasOwnProperty(a)&&(M[a]={type:bl(a)});var z=Je(M.u_baseColorTexture,M.u_baseColorFactor);Ze(z)&&(z.semantic="_3DTILESDIFFUSE");for(a in M){var B,U;M.hasOwnProperty(a)&&(B=M[a],U=Ze(B.count)?"["+B.count+"]":"",B.type!==Rt.FLOAT_MAT3&&B.type!==Rt.FLOAT_MAT4&&"u_morphWeights"!==a||B.useInFragment?(b+="uniform "+fl(B.type)+" "+a+U+";\n",delete B.useInFragment):x+="uniform "+fl(B.type)+" "+a+U+";\n")}R&&(b+="uniform sampler2D u_outlineTexture;\n");var V,k,G="";if(A){var q=su(E.type),H=!1;if(0===E.type.indexOf("MAT")&&(H=!0,q=Math.sqrt(q)),H)for(V=0;V<q;V++)for(k=0;k<q;k++)G+=0===V&&0===k?"    mat4 skinMatrix = ":"    skinMatrix += ",G+="a_weight["+V+"]["+k+"] * u_jointMatrix[int(a_joint["+V+"]["+k+"])];\n";else for(V=0;V<q;V++)G+=0===V?"    mat4 skinMatrix = ":"    skinMatrix += ",G+="a_weight["+V+"] * u_jointMatrix[int(a_joint["+V+"])];\n"}var W={a_position:{semantic:"POSITION"}};R&&(W.a_outlineCoordinates={semantic:"_OUTLINE_COORDINATES"});x+="attribute vec3 a_position;\n",O&&(x+="varying vec3 v_positionEC;\n");R&&(x+="attribute vec3 a_outlineCoordinates;\n",x+="varying vec3 v_outlineCoordinates;\n");x+="varying vec3 v_helsing_position;\n",G+="    vec3 weightedPosition = a_position;\n",O&&(G+="    vec3 weightedNormal = a_normal;\n",G+="    v_helsing_position = a_position;\n");L&&(G+="    vec4 weightedTangent = a_tangent;\n");if(P)for(var Y=0;Y<T.length;Y++){var X,j=T[Y];for(var K in j){j.hasOwnProperty(K)&&"extras"!==K&&(W[X="a_"+K+"_"+Y]={semantic:K+"_"+Y},x+="attribute vec3 "+X+";\n","POSITION"===K?G+="    weightedPosition += u_morphWeights["+Y+"] * "+X+";\n":"NORMAL"===K?G+="    weightedNormal += u_morphWeights["+Y+"] * "+X+";\n":L&&"TANGENT"===K&&(G+="    weightedTangent.xyz += u_morphWeights["+Y+"] * "+X+";\n"))}}G+=A?"    vec4 position = skinMatrix * vec4(weightedPosition, 1.0);\n":"    vec4 position = vec4(weightedPosition, 1.0);\n";G+="    position = u_modelViewMatrix * position;\n",O&&(G+="    v_positionEC = position.xyz;\n");G+="    gl_Position = u_projectionMatrix * position;\n",R&&(G+="    v_outlineCoordinates = a_outlineCoordinates;\n");O&&(W.a_normal={semantic:"NORMAL"},x+="attribute vec3 a_normal;\n",x+="varying vec3 v_normal;\n",G+=A?"    v_normal = u_normalMatrix * mat3(skinMatrix) * weightedNormal;\n":"    v_normal = u_normalMatrix * weightedNormal;\n",b+="varying vec3 v_normal;\n",b+="varying vec3 v_positionEC;\n");L&&(W.a_tangent={semantic:"TANGENT"},x+="attribute vec4 a_tangent;\n",x+="varying vec4 v_tangent;\n",G+="    v_tangent.xyz = u_normalMatrix * weightedTangent.xyz;\n",G+="    v_tangent.w = weightedTangent.w;\n",b+="varying vec4 v_tangent;\n");R&&(b+="varying vec3 v_outlineCoordinates;\n");var Q,Z,J,$,ee,te,ne,re,ie="";{var oe;N&&(W.a_texcoord_0={semantic:"TEXCOORD_0"},x+="attribute vec2 a_texcoord_0;\n",x+="varying vec2 "+(Q="v_texcoord_0")+";\n",G+="    "+Q+" = a_texcoord_0;\n",b+="varying vec2 "+Q+";\n",Z=_l(0,"u_normalTexture",r,Q,oe={fragmentShaderMain:ie}),J=_l(0,"u_baseColorTexture",r,Q,oe),$=_l(0,"u_specularGlossinessTexture",r,Q,oe),ee=_l(0,"u_diffuseTexture",r,Q,oe),te=_l(0,"u_metallicRoughnessTexture",r,Q,oe),ne=_l(0,"u_occlusionTexture",r,Q,oe),re=_l(0,"u_emmissiveTexture",r,Q,oe),ie=oe.fragmentShaderMain)}{var ae;A&&(ae=Hu.getShaderVariable(E.type),W.a_joint={semantic:"JOINTS_0"},W.a_weight={semantic:"WEIGHTS_0"},x+="attribute "+ae+" a_joint;\n",x+="attribute "+ae+" a_weight;\n")}I&&(W.a_vertexColor={semantic:"COLOR_0"},x+="attribute vec4 a_vertexColor;\n",x+="varying vec4 v_vertexColor;\n",G+="  v_vertexColor = a_vertexColor;\n",b+="varying vec4 v_vertexColor;\n");l&&(W.a_batchId={semantic:"_BATCHID"},x+="attribute float a_batchId;\n");x+="void main(void) \n{\n",x+=G,x+="}\n",O&&(b+="const float M_PI = 3.141592653589793;\n",b+="vec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\n\n",b+="vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\n",b+="vec3 fresnelSchlick(float metalness, float VdotH) \n{\n    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\n",b+="float smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\n",b+="float smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\n\n",b+="float GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\n\n");b+="vec3 SRGBtoLINEAR3(vec3 srgbIn) \n{\n    return pow(srgbIn, vec3(2.2));\n}\n\n",b+="vec4 SRGBtoLINEAR4(vec4 srgbIn) \n{\n    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n    return vec4(linearOut, srgbIn.a);\n}\n\n",b+="vec3 applyTonemapping(vec3 linearIn) \n{\n#ifndef HDR \n    return czm_acesTonemapping(linearIn);\n#else \n    return linearIn;\n#endif \n}\n\n",b+="vec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\n\n",b+="vec2 computeTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) \n{\n    rotation = -rotation; \n    mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, \n       -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, \n        offset.x, offset.y, 1.0); \n    vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy; \n    return transformedTexCoords; \n}\n\n",b+="#ifdef USE_IBL_LIGHTING \n",b+="uniform vec2 gltf_iblFactor; \n",b+="#endif \n",b+="#ifdef USE_CUSTOM_LIGHT_COLOR \n",b+="uniform vec3 gltf_lightColor; \n",b+="#endif \n",b+="varying vec3 v_helsing_position;\n",b+="void main(void) \n{\n",b+=ie,O&&(b+="    vec3 ng = normalize(v_normal);\n",b+="    vec3 positionWC = vec3(czm_inverseView * vec4(v_positionEC, 1.0));\n",Ze(r.u_normalTexture)?L?(b+="    vec3 t = normalize(v_tangent.xyz);\n",b+="    vec3 b = normalize(cross(ng, t) * v_tangent.w);\n",b+="    mat3 tbn = mat3(t, b, ng);\n",b+="    vec3 n = texture2D(u_normalTexture, "+Z+").rgb;\n",b+="    n = normalize(tbn * (2.0 * n - 1.0));\n"):(b="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"+b,b+="#ifdef GL_OES_standard_derivatives\n",b+="    vec3 pos_dx = dFdx(v_positionEC);\n",b+="    vec3 pos_dy = dFdy(v_positionEC);\n",b+="    vec3 tex_dx = dFdx(vec3("+Z+",0.0));\n",b+="    vec3 tex_dy = dFdy(vec3("+Z+",0.0));\n",b+="    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n",b+="    t = normalize(t - ng * dot(ng, t));\n",b+="    vec3 b = normalize(cross(ng, t));\n",b+="    mat3 tbn = mat3(t, b, ng);\n",b+="    vec3 n = texture2D(u_normalTexture, "+Z+").rgb;\n",b+="    n = normalize(tbn * (2.0 * n - 1.0));\n",b+="#else\n",b+="    vec3 n = ng;\n",b+="#endif\n"):b+="    vec3 n = ng;\n",t.doubleSided);Ze(r.u_baseColorTexture)?(b+="    vec4 baseColorWithAlpha = SRGBtoLINEAR4(texture2D(u_baseColorTexture, "+J+"));\n",Ze(r.u_baseColorFactor)&&(b+="    baseColorWithAlpha *= u_baseColorFactor;\n")):Ze(r.u_baseColorFactor)?b+="    vec4 baseColorWithAlpha = u_baseColorFactor;\n":b+="    vec4 baseColorWithAlpha = vec4(1.0);\n";I&&(b+="    baseColorWithAlpha *= v_vertexColor;\n");b+="    vec3 baseColor = baseColorWithAlpha.rgb;\n",O?(m?(Ze(r.u_specularGlossinessTexture)?(b+="    vec4 specularGlossiness = SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, "+$+"));\n",b+="    vec3 specular = specularGlossiness.rgb;\n",b+="    float glossiness = specularGlossiness.a;\n",Ze(r.u_specularFactor)&&(b+="    specular *= u_specularFactor;\n"),Ze(r.u_glossinessFactor)&&(b+="    glossiness *= u_glossinessFactor;\n")):(Ze(r.u_specularFactor)?b+="    vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));\n":b+="    vec3 specular = vec3(1.0);\n",Ze(r.u_glossinessFactor)?b+="    float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);\n":b+="    float glossiness = 1.0;\n"),Ze(r.u_diffuseTexture)?(b+="    vec4 diffuse = SRGBtoLINEAR4(texture2D(u_diffuseTexture, "+ee+"));\n",Ze(r.u_diffuseFactor)&&(b+="    diffuse *= u_diffuseFactor;\n")):Ze(r.u_diffuseFactor)?b+="    vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));\n":b+="    vec4 diffuse = vec4(1.0);\n"):Ze(r.u_metallicRoughnessTexture)?(b+="    vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, "+te+").rgb;\n",b+="    float metalness = clamp(metallicRoughness.b, 0.0, 1.0);\n",b+="    float roughness = clamp(metallicRoughness.g, 0.04, 1.0);\n",Ze(r.u_metallicFactor)&&(b+="    metalness *= u_metallicFactor;\n"),Ze(r.u_roughnessFactor)&&(b+="    roughness *= u_roughnessFactor;\n")):(Ze(r.u_metallicFactor)?b+="    float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n":b+="    float metalness = 1.0;\n",Ze(r.u_roughnessFactor)?b+="    float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n":b+="    float roughness = 1.0;\n"),b+="    vec3 v = -normalize(v_positionEC);\n",b+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",b+="    vec3 lightColorHdr = czm_lightColorHdr;\n",b+="#else \n",b+="    vec3 lightColorHdr = gltf_lightColor;\n",b+="#endif \n",b+="    vec3 l = normalize(czm_lightDirectionEC);\n",b+="    vec3 h = normalize(v + l);\n",b+="    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n",b+="    float NdotV = abs(dot(n, v)) + 0.001;\n",b+="    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n",b+="    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n",b+="    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n",b+="    vec3 f0 = vec3(0.04);\n",m?(b+="    float roughness = 1.0 - glossiness;\n",b+="    vec3 diffuseColor = diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));\n",b+="    vec3 specularColor = specular;\n"):(b+="    vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n",b+="    vec3 specularColor = mix(f0, baseColor, metalness);\n"),b+="    float alpha = roughness * roughness;\n",b+="    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n",b+="    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n",b+="    vec3 r0 = specularColor.rgb;\n",b+="    vec3 F = fresnelSchlick2(r0, r90, VdotH);\n",b+="    float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n",b+="    float D = GGX(alpha, NdotH);\n",b+="    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n",b+="    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n",b+="    vec3 color = NdotL * lightColorHdr * (diffuseContribution + specularContribution);\n",b+="#if defined(USE_IBL_LIGHTING) && !defined(DIFFUSE_IBL) && !defined(SPECULAR_IBL) \n",b+="    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));\n",b+="    float vertexRadius = length(positionWC);\n",b+="    float horizonDotNadir = 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);\n",b+="    float reflectionDotNadir = dot(r, normalize(positionWC));\n",b+="    r.x = -r.x;\n",b+="    r = -normalize(czm_temeToPseudoFixed * r);\n",b+="    r.x = -r.x;\n",b+="    float inverseRoughness = 1.04 - roughness;\n",b+="    inverseRoughness *= inverseRoughness;\n",b+="    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;\n",b+="    float atmosphereHeight = 0.05;\n",b+="    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);\n",b+="    float blendRegionOffset = roughness * -1.0;\n",b+="    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);\n",b+="    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);\n",b+="    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);\n",b+="    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);\n",b+="    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);\n",b+="    vec3 nadirColor = belowHorizonColor * 0.5;\n",b+="    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);\n",b+="    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);\n",b+="    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);\n",b+="    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9);\n",b+="    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;\n",b+="    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));\n",b+="    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);\n",b+="    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);\n",b+="    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);\n",b+="    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);\n",b+="    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);\n",b+="#ifdef USE_SUN_LUMINANCE \n",b+="    float LdotZenith = clamp(dot(normalize(czm_inverseViewRotation * l), normalize(positionWC * -1.0)), 0.001, 1.0);\n",b+="    float S = acos(LdotZenith);\n",b+="    float NdotZenith = clamp(dot(normalize(czm_inverseViewRotation * n), normalize(positionWC * -1.0)), 0.001, 1.0);\n",b+="    float gamma = acos(NdotL);\n",b+="    float numerator = ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));\n",b+="    float denominator = (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));\n",b+="    float luminance = gltf_luminanceAtZenith * (numerator / denominator);\n",b+="#endif \n",b+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",b+="    vec3 IBLColor = (diffuseIrradiance * diffuseColor * gltf_iblFactor.x) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y) * gltf_iblFactor.y);\n",b+="    float maximumComponent = max(max(lightColorHdr.x, lightColorHdr.y), lightColorHdr.z);\n",b+="    vec3 lightColor = lightColorHdr / max(maximumComponent, 1.0);\n",b+="    IBLColor *= lightColor;\n",b+="#ifdef USE_SUN_LUMINANCE \n",b+="    color += IBLColor * luminance;\n",b+="#else \n",b+="    color += IBLColor; \n",b+="#endif \n",b+="#elif defined(DIFFUSE_IBL) || defined(SPECULAR_IBL) \n",b+="    mat3 fixedToENU = mat3(gltf_clippingPlanesMatrix[0][0], gltf_clippingPlanesMatrix[1][0], gltf_clippingPlanesMatrix[2][0], \n",b+="                           gltf_clippingPlanesMatrix[0][1], gltf_clippingPlanesMatrix[1][1], gltf_clippingPlanesMatrix[2][1], \n",b+="                           gltf_clippingPlanesMatrix[0][2], gltf_clippingPlanesMatrix[1][2], gltf_clippingPlanesMatrix[2][2]); \n",b+="    const mat3 yUpToZUp = mat3(-1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0); \n",b+="    vec3 cubeDir = normalize(yUpToZUp * fixedToENU * normalize(reflect(-v, n))); \n",b+="#ifdef DIFFUSE_IBL \n",b+="#ifdef CUSTOM_SPHERICAL_HARMONICS \n",b+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, gltf_sphericalHarmonicCoefficients); \n",b+="#else \n",b+="    vec3 diffuseIrradiance = czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); \n",b+="#endif \n",b+="#else \n",b+="    vec3 diffuseIrradiance = vec3(0.0); \n",b+="#endif \n",b+="#ifdef SPECULAR_IBL \n",b+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",b+="#ifdef CUSTOM_SPECULAR_IBL \n",b+="    vec3 specularIBL = czm_sampleOctahedralProjection(gltf_specularMap, gltf_specularMapSize, cubeDir,  roughness * gltf_maxSpecularLOD, gltf_maxSpecularLOD);\n",b+="#else \n",b+="    vec3 specularIBL = czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);\n",b+="#endif \n",b+="    specularIBL *= F * brdfLut.x + brdfLut.y;\n",b+="#else \n",b+="    vec3 specularIBL = vec3(0.0); \n",b+="#endif \n",b+="    color += diffuseIrradiance * diffuseColor + specularColor * specularIBL;\n",b+="#endif \n"):b+="    vec3 color = baseColor;\n";D||(Ze(r.u_occlusionTexture)&&(b+="    color *= texture2D(u_occlusionTexture, "+ne+").r;\n"),Ze(r.u_emissiveTexture)?(b+="    vec3 emissive = SRGBtoLINEAR3(texture2D(u_emissiveTexture, "+re+").rgb);\n",Ze(r.u_emissiveFactor)&&(b+="    emissive *= u_emissiveFactor;\n"),b+="    color += emissive;\n"):Ze(r.u_emissiveFactor)&&(b+="    color += u_emissiveFactor;\n"));D||(b+="    color = applyTonemapping(color);\n");b+="    color = LINEARtoSRGB(color);\n",R&&(b+="    float outlineness = max(\n",b+="        texture2D(u_outlineTexture, vec2(v_outlineCoordinates.x, 0.5)).r,\n",b+="        max(\n",b+="          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.y, 0.5)).r,\n",b+="          texture2D(u_outlineTexture, vec2(v_outlineCoordinates.z, 0.5)).r));\n",b+="    color = mix(color, vec3(0.0, 0.0, 0.0), outlineness);\n");Ze(F)?"MASK"===F?(b+="    if (baseColorWithAlpha.a < u_alphaCutoff) {\n",b+="        discard;\n",b+="    }\n",b+="    gl_FragColor = vec4(color, 1.0);\n"):b+="BLEND"===F?"    gl_FragColor = vec4(color, baseColorWithAlpha.a);\n":"    gl_FragColor = vec4(color, 1.0);\n":b+="    gl_FragColor = vec4(color, 1.0);\n";c&&(b+="    float helsing_p = v_helsing_position.z / "+c.toFixed(1)+";\n",b+="    gl_FragColor *= vec4(helsing_p, helsing_p, helsing_p, 1.0);\n");b+="}\n";var se=iu(p,{type:Rt.VERTEX_SHADER,extras:{_pipeline:{source:x,extension:".glsl"}}}),ue=iu(p,{type:Rt.FRAGMENT_SHADER,extras:{_pipeline:{source:b,extension:".glsl"}}}),le=iu(d,{fragmentShader:ue,vertexShader:se});return iu(f,{attributes:W,program:le,uniforms:M})}(i,e,t,n,a,o);Ze(e.extensions)||(e.extensions={}),e.extensions.KHR_techniques_webgl={values:n,technique:r}}),Hu.ensureSemanticExistence(i),i}function _l(e,t,n,r,i){var o;return Ze(n[t+"Offset"])?(o=t+"Coord",i.fragmentShaderMain+="    vec2 "+o+" = computeTexCoord("+r+", "+t+"Offset, "+t+"Rotation, "+t+"Scale);\n"):o=r,o}Hu.getGltfSemanticUniforms=function(){return hl};var gl=[0,0],yl=[0],vl=[1,1];function xl(e,t,n){var r,i;-1!==e.indexOf("Texture")&&Ze(t.extensions)&&Ze(t.extensions.KHR_texture_transform)&&(r="u_"+e,i=t.extensions.KHR_texture_transform,n[r+"Offset"]=Je(i.offset,gl),n[r+"Rotation"]=Je(i.rotation,yl),n[r+"Scale"]=Je(i.scale,vl),Ze(t.texCoord)&&Ze(i.texCoord)&&(n[r].texCoord=i.texCoord))}function bl(e){if(-1!==e.indexOf("Offset"))return Rt.FLOAT_VEC2;if(-1!==e.indexOf("Rotation"))return Rt.FLOAT;if(-1!==e.indexOf("Scale"))return Rt.FLOAT_VEC2;if(-1!==e.indexOf("Texture"))return Rt.SAMPLER_2D;switch(e){case"u_baseColorFactor":return Rt.FLOAT_VEC4;case"u_metallicFactor":case"u_roughnessFactor":return Rt.FLOAT;case"u_emissiveFactor":return Rt.FLOAT_VEC3;case"u_diffuseFactor":return Rt.FLOAT_VEC4;case"u_specularFactor":return Rt.FLOAT_VEC3;case"u_glossinessFactor":return Rt.FLOAT}}var El={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===El.SCENE3D?1:e!==El.MORPHING?0:void 0}},Tl=Object.freeze(El);function Sl(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var Cl={STREAM_DRAW:Rt.STREAM_DRAW,STATIC_DRAW:Rt.STATIC_DRAW,DYNAMIC_DRAW:Rt.DYNAMIC_DRAW,validate:function(e){return e===Cl.STREAM_DRAW||e===Cl.STATIC_DRAW||e===Cl.DYNAMIC_DRAW}},wl=Object.freeze(Cl);function Al(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).context._gl,n=e.bufferTarget,r=e.typedArray,i=e.sizeInBytes,o=e.usage,a=Ze(r);a&&(i=r.byteLength);var s=t.createBuffer();t.bindBuffer(n,s),t.bufferData(n,a?r:i,o),t.bindBuffer(n,null),this._gl=t,this._webgl2=e.context._webgl2,this._bufferTarget=n,this._sizeInBytes=i,this._usage=o,this._buffer=s,this.vertexArrayDestroyable=!0}function Il(e,t,n,r){switch(t.type){case e.FLOAT:return new Pl(e,0,n,r);case e.FLOAT_VEC2:return new Ol(e,0,n,r);case e.FLOAT_VEC3:return new Ll(e,0,n,r);case e.FLOAT_VEC4:return new Nl(e,0,n,r);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new Rl(e,0,n,r);case e.INT:case e.BOOL:return new Dl(e,0,n,r);case e.INT_VEC2:case e.BOOL_VEC2:return new Ml(e,0,n,r);case e.INT_VEC3:case e.BOOL_VEC3:return new Fl(e,0,n,r);case e.INT_VEC4:case e.BOOL_VEC4:return new zl(e,0,n,r);case e.FLOAT_MAT2:return new Ul(e,0,n,r);case e.FLOAT_MAT3:return new kl(e,0,n,r);case e.FLOAT_MAT4:return new ql(e,0,n,r);default:throw new de("Unrecognized uniform type: "+t.type+' for uniform "'+n+'".')}}function Pl(e,t,n,r){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=r}function Ol(e,t,n,r){this.name=n,this.value=void 0,this._value=new En,this._gl=e,this._location=r}function Ll(e,t,n,r){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=r}function Nl(e,t,n,r){this.name=n,this.value=void 0,this._value=void 0,this._gl=e,this._location=r}function Rl(e,t,n,r){this.name=n,this.value=void 0,this._gl=e,this._location=r,this.textureUnitIndex=void 0}function Dl(e,t,n,r){this.name=n,this.value=void 0,this._value=0,this._gl=e,this._location=r}function Ml(e,t,n,r){this.name=n,this.value=void 0,this._value=new En,this._gl=e,this._location=r}function Fl(e,t,n,r){this.name=n,this.value=void 0,this._value=new _t,this._gl=e,this._location=r}function zl(e,t,n,r){this.name=n,this.value=void 0,this._value=new qt,this._gl=e,this._location=r}Al.createVertexBuffer=function(e){return new Al({context:e.context,bufferTarget:Rt.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})},Al.createIndexBuffer=function(e){var t=e.context,n=e.indexDatatype,r=wa.getSizeInBytes(n),i=new Al({context:t,bufferTarget:Rt.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage}),o=i.sizeInBytes/r;return Object.defineProperties(i,{indexDatatype:{get:function(){return n}},bytesPerIndex:{get:function(){return r}},numberOfIndices:{get:function(){return o}}}),i},Object.defineProperties(Al.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),Al.prototype._getBuffer=function(){return this._buffer},Al.prototype.copyFromArrayView=function(e,t){t=Je(t,0);var n=this._gl,r=this._bufferTarget;n.bindBuffer(r,this._buffer),n.bufferSubData(r,t,e),n.bindBuffer(r,null)},Al.prototype.copyFromBuffer=function(e,t,n,r){var i=Rt.COPY_READ_BUFFER,o=Rt.COPY_WRITE_BUFFER,a=this._gl;a.bindBuffer(o,this._buffer),a.bindBuffer(i,e._buffer),a.copyBufferSubData(i,o,t,n,r),a.bindBuffer(o,null),a.bindBuffer(i,null)},Al.prototype.getBufferData=function(e,t,n,r){t=Je(t,0),n=Je(n,0);var i=this._gl,o=Rt.COPY_READ_BUFFER;i.bindBuffer(o,this._buffer),i.getBufferSubData(o,t,e,n,r),i.bindBuffer(o,null)},Al.prototype.isDestroyed=function(){return!1},Al.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),Vt(this)},Pl.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))},Ol.prototype.set=function(){var e=this.value;En.equals(e,this._value)||(En.clone(e,this._value),this._gl.uniform2f(this._location,e.x,e.y))},Ll.prototype.set=function(){var e=this.value;Ze(e.red)?It.equals(e,this._value)||(this._value=It.clone(e,this._value),this._gl.uniform3f(this._location,e.red,e.green,e.blue)):Ze(e.x)&&(_t.equals(e,this._value)||(this._value=_t.clone(e,this._value),this._gl.uniform3f(this._location,e.x,e.y,e.z)))},Nl.prototype.set=function(){var e=this.value;Ze(e.red)?It.equals(e,this._value)||(this._value=It.clone(e,this._value),this._gl.uniform4f(this._location,e.red,e.green,e.blue,e.alpha)):Ze(e.x)&&(qt.equals(e,this._value)||(this._value=qt.clone(e,this._value),this._gl.uniform4f(this._location,e.x,e.y,e.z,e.w)))},Rl.prototype.set=function(){var e=this._gl;e.activeTexture(e.TEXTURE0+this.textureUnitIndex);var t=this.value;e.bindTexture(t._target,t._texture)},Rl.prototype._setSampler=function(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1},Dl.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))},Ml.prototype.set=function(){var e=this.value;En.equals(e,this._value)||(En.clone(e,this._value),this._gl.uniform2i(this._location,e.x,e.y))},Fl.prototype.set=function(){var e=this.value;_t.equals(e,this._value)||(_t.clone(e,this._value),this._gl.uniform3i(this._location,e.x,e.y,e.z))},zl.prototype.set=function(){var e=this.value;qt.equals(e,this._value)||(qt.clone(e,this._value),this._gl.uniform4i(this._location,e.x,e.y,e.z,e.w))};var Bl=new Float32Array(4);function Ul(e,t,n,r){this.name=n,this.value=void 0,this._value=new fi,this._gl=e,this._location=r}Ul.prototype.set=function(){var e;fi.equalsArray(this.value,this._value,0)||(fi.clone(this.value,this._value),e=fi.toArray(this.value,Bl),this._gl.uniformMatrix2fv(this._location,!1,e))};var Vl=new Float32Array(9);function kl(e,t,n,r){this.name=n,this.value=void 0,this._value=new jt,this._gl=e,this._location=r}kl.prototype.set=function(){var e;jt.equalsArray(this.value,this._value,0)||(jt.clone(this.value,this._value),e=jt.toArray(this.value,Vl),this._gl.uniformMatrix3fv(this._location,!1,e))};var Gl=new Float32Array(16);function ql(e,t,n,r){this.name=n,this.value=void 0,this._value=new on,this._gl=e,this._location=r}function Hl(e,t,n,r){switch(t.type){case e.FLOAT:return new Wl(e,0,n,r);case e.FLOAT_VEC2:return new Yl(e,0,n,r);case e.FLOAT_VEC3:return new Xl(e,0,n,r);case e.FLOAT_VEC4:return new jl(e,0,n,r);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new Kl(e,0,n,r);case e.INT:case e.BOOL:return new Ql(e,0,n,r);case e.INT_VEC2:case e.BOOL_VEC2:return new Zl(e,0,n,r);case e.INT_VEC3:case e.BOOL_VEC3:return new Jl(e,0,n,r);case e.INT_VEC4:case e.BOOL_VEC4:return new $l(e,0,n,r);case e.FLOAT_MAT2:return new ec(e,0,n,r);case e.FLOAT_MAT3:return new tc(e,0,n,r);case e.FLOAT_MAT4:return new nc(e,0,n,r);default:throw new de("Unrecognized uniform type: "+t.type+' for uniform "'+n+'".')}}function Wl(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(i),this._gl=e,this._location=r[0]}function Yl(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(2*i),this._gl=e,this._location=r[0]}function Xl(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(3*i),this._gl=e,this._location=r[0]}function jl(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(4*i),this._gl=e,this._location=r[0]}function Kl(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(i),this._gl=e,this._locations=r,this.textureUnitIndex=void 0}function Ql(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(i),this._gl=e,this._location=r[0]}function Zl(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(2*i),this._gl=e,this._location=r[0]}function Jl(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(3*i),this._gl=e,this._location=r[0]}function $l(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Int32Array(4*i),this._gl=e,this._location=r[0]}function ec(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(4*i),this._gl=e,this._location=r[0]}function tc(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(9*i),this._gl=e,this._location=r[0]}function nc(e,t,n,r){var i=r.length;this.name=n,this.value=new Array(i),this._value=new Float32Array(16*i),this._gl=e,this._location=r[0]}ql.prototype.set=function(){var e;on.equalsArray(this.value,this._value,0)||(on.clone(this.value,this._value),e=on.toArray(this.value,Gl),this._gl.uniformMatrix4fv(this._location,!1,e))},Wl.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0;i<t;++i){var o=e[i];o!==n[i]&&(n[i]=o,r=!0)}r&&this._gl.uniform1fv(this._location,n)},Yl.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];En.equalsArray(a,n,i)||(En.pack(a,n,i),r=!0),i+=2}r&&this._gl.uniform2fv(this._location,n)},Xl.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];Ze(a.red)?a.red===n[i]&&a.green===n[i+1]&&a.blue===n[i+2]||(n[i]=a.red,n[i+1]=a.green,n[i+2]=a.blue,r=!0):Ze(a.x)&&(_t.equalsArray(a,n,i)||(_t.pack(a,n,i),r=!0)),i+=3}r&&this._gl.uniform3fv(this._location,n)},jl.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];Ze(a.red)?It.equalsArray(a,n,i)||(It.pack(a,n,i),r=!0):Ze(a.x)&&(qt.equalsArray(a,n,i)||(qt.pack(a,n,i),r=!0)),i+=4}r&&this._gl.uniform4fv(this._location,n)},Kl.prototype.set=function(){for(var e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,n=this.value,r=n.length,i=0;i<r;++i){var o=n[i];e.activeTexture(t+i),e.bindTexture(o._target,o._texture)}},Kl.prototype._setSampler=function(e){this.textureUnitIndex=e;for(var t=this._locations,n=t.length,r=0;r<n;++r){var i=e+r;this._gl.uniform1i(t[r],i)}return e+n},Ql.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0;i<t;++i){var o=e[i];o!==n[i]&&(n[i]=o,r=!0)}r&&this._gl.uniform1iv(this._location,n)},Zl.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];En.equalsArray(a,n,i)||(En.pack(a,n,i),r=!0),i+=2}r&&this._gl.uniform2iv(this._location,n)},Jl.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];_t.equalsArray(a,n,i)||(_t.pack(a,n,i),r=!0),i+=3}r&&this._gl.uniform3iv(this._location,n)},$l.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];qt.equalsArray(a,n,i)||(qt.pack(a,n,i),r=!0),i+=4}r&&this._gl.uniform4iv(this._location,n)},ec.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];fi.equalsArray(a,n,i)||(fi.pack(a,n,i),r=!0),i+=4}r&&this._gl.uniformMatrix2fv(this._location,!1,n)},tc.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];jt.equalsArray(a,n,i)||(jt.pack(a,n,i),r=!0),i+=9}r&&this._gl.uniformMatrix3fv(this._location,!1,n)},nc.prototype.set=function(){for(var e=this.value,t=e.length,n=this._value,r=!1,i=0,o=0;o<t;++o){var a=e[o];on.equalsArray(a,n,i)||(on.pack(a,n,i),r=!0),i+=16}r&&this._gl.uniformMatrix4fv(this._location,!1,n)};var rc=0;function ic(e){var t=e.vertexShaderText,n=e.fragmentShaderText;"undefined"!=typeof spector&&(t=t.replace(/^#line/gm,"//#line"),n=n.replace(/^#line/gm,"//#line"));var r=function(e,t){var n,r,i,o,a={};if(!Nn.highpFloatSupported||!Nn.highpIntSupported){var s,u=oc(e),l=oc(t),c=u.length,h=l.length;for(n=0;n<c;n++)for(r=0;r<h;r++){u[n]===l[r]&&(i=u[n],o="czm_mediump_"+i,s=new RegExp(i+"\\b","g"),t=t.replace(s,o),a[o]=i)}}return{fragmentShaderText:t,duplicateUniformNames:a}}(t,n);this._gl=e.gl,this._logShaderCompilation=e.logShaderCompilation,this._debugShaders=e.debugShaders,this._attributeLocations=e.attributeLocations,this._program=void 0,this._numberOfVertexAttributes=void 0,this._vertexAttributes=void 0,this._uniformsByName=void 0,this._uniforms=void 0,this._automaticUniforms=void 0,this._manualUniforms=void 0,this._duplicateUniformNames=r.duplicateUniformNames,this._cachedShader=void 0,this.maximumTextureUnitIndex=void 0,this._vertexShaderSource=e.vertexShaderSource,this._vertexShaderText=e.vertexShaderText,this._fragmentShaderSource=e.fragmentShaderSource,this._fragmentShaderText=r.fragmentShaderText,this.id=rc++}function oc(e){var t=[],n=e.match(/uniform.*?(?![^{]*})(?=[=\[;])/g);if(Ze(n))for(var r=n.length,i=0;i<r;i++){var o=n[i].trim(),a=o.slice(o.lastIndexOf(" ")+1);t.push(a)}return t}ic.fromCache=function(e){return(e=Je(e,Je.EMPTY_OBJECT)).context.shaderCache.getShaderProgram(e)},ic.replaceCache=function(e){return(e=Je(e,Je.EMPTY_OBJECT)).context.shaderCache.replaceShaderProgram(e)},Object.defineProperties(ic.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){return fc(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return fc(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return fc(this),this._uniformsByName}}});var ac="[Cesium WebGL] ";function sc(e,t){var n,r=t._vertexShaderText,i=t._fragmentShaderText;"ActiveXObject"in window&&0<=i.indexOf("texture2DLodEXT")&&(i=i.replace("texture2DLodEXT( s, coord.xy, coord.w )","texture2D( s, coord.xy, -3.0 )")),0<=i.indexOf("#extension")&&((n=i.match(/#extension.*/g)).forEach(function(e){i=i.replace(e,"")}),n=n.join("\n"),i=n+"\n"+i);var o=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,r),e.compileShader(o);var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,i),e.compileShader(a);var s=e.createProgram();e.attachShader(s,o),e.attachShader(s,a),e.deleteShader(o),e.deleteShader(a);var u=t._attributeLocations;if(Ze(u))for(var l in u)u.hasOwnProperty(l)&&e.bindAttribLocation(s,u[l],l);if(e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){var c,h=t._debugShaders;if(!e.getShaderParameter(a,e.COMPILE_STATUS)){var f,p=e.getShaderInfoLog(a);throw console.error(ac+"Fragment shader compile log: "+p),Ze(h)&&(""!==(f=h.getTranslatedShaderSource(a))?console.error(ac+"Translated fragment shader source:\n"+f):console.error(ac+"Fragment shader translation failed.")),e.deleteProgram(s),new de("Fragment shader failed to compile.  Compile log: "+p)}if(!e.getShaderParameter(o,e.COMPILE_STATUS))throw p=e.getShaderInfoLog(o),console.error(ac+"Vertex shader compile log: "+p),Ze(h)&&(""!==(c=h.getTranslatedShaderSource(o))?console.error(ac+"Translated vertex shader source:\n"+c):console.error(ac+"Vertex shader translation failed.")),e.deleteProgram(s),new de("Vertex shader failed to compile.  Compile log: "+p);throw p=e.getProgramInfoLog(s),console.error(ac+"Shader program link log: "+p),Ze(h)&&(console.error(ac+"Translated vertex shader source:\n"+h.getTranslatedShaderSource(o)),console.error(ac+"Translated fragment shader source:\n"+h.getTranslatedShaderSource(a))),e.deleteProgram(s),new de("Program failed to link.  Link log: "+p)}var d=t._logShaderCompilation;return d&&Ze(p=e.getShaderInfoLog(o))&&0<p.length&&console.log(ac+"Vertex shader compile log: "+p),d&&Ze(p=e.getShaderInfoLog(a))&&0<p.length&&console.log(ac+"Fragment shader compile log: "+p),d&&Ze(p=e.getProgramInfoLog(s))&&0<p.length&&console.log(ac+"Shader program link log: "+p),s}function uc(e,t,n){for(var r={},i=0;i<n;++i){var o=e.getActiveAttrib(t,i),a=e.getAttribLocation(t,o.name);r[o.name]={name:o.name,type:o.type,index:a}}return r}function lc(e,t){for(var n={},r=[],i=[],o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),a=0;a<o;++a){var s=e.getActiveUniform(t,a),u=-1!==s.name.indexOf("[0]",s.name.length-"[0]".length)?s.name.slice(0,s.name.length-3):s.name;if(0!==u.indexOf("gl_"))if(s.name.indexOf("[")<0){var l,c=e.getUniformLocation(t,u);null!==c&&(l=Il(e,s,u,c),n[u]=l,r.push(l),l._setSampler&&i.push(l))}else{var h,f,p,d,m=u.indexOf("[");if(0<=m){if(!Ze(h=n[u.slice(0,m)]))continue;(f=h._locations).length<=1&&(p=h.value,null!==(d=e.getUniformLocation(t,u))&&(f.push(d),p.push(e.getUniform(t,d))))}else{f=[];for(var _=0;_<s.size;++_)null!==(d=e.getUniformLocation(t,u+"["+_+"]"))&&f.push(d);h=Hl(e,s,u,f),n[u]=h,r.push(h),h._setSampler&&i.push(h)}}}return{uniformsByName:n,uniforms:r,samplerUniforms:i}}function cc(e,t){var n,r,i,o,a=[],s=[];for(var u in t){t.hasOwnProperty(u)&&(n=t[u],r=u,Ze(i=e._duplicateUniformNames[r])&&(r=n.name=i),Ze(o=Gr[r])?a.push({uniform:n,automaticUniform:o}):s.push(n))}return{automaticUniforms:a,manualUniforms:s}}function hc(e,t,n){e.useProgram(t);for(var r=0,i=n.length,o=0;o<i;++o)r=n[o]._setSampler(r);return e.useProgram(null),r}function fc(e){Ze(e._program)||!function l(c){var e=c._program;var t=c._gl;var n=sc(t,c,c._debugShaders);var r=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES);var i=lc(t,n);var o=cc(c,i.uniformsByName);c._program=n;c._numberOfVertexAttributes=r;c._vertexAttributes=uc(t,n,r);c._uniformsByName=i.uniformsByName;c._uniforms=i.uniforms;c._automaticUniforms=o.automaticUniforms;c._manualUniforms=o.manualUniforms;c.maximumTextureUnitIndex=hc(t,n,i.samplerUniforms);e&&c._gl.deleteProgram(e);"undefined"!=typeof spector&&(c._program.__SPECTOR_rebuildProgram=function(e,t,n,r){var i=c._vertexShaderText,o=c._fragmentShaderText,a=/ ! = /g;c._vertexShaderText=e.replace(a," != "),c._fragmentShaderText=t.replace(a," != ");try{l(c),n(c._program)}catch(e){c._vertexShaderText=i,c._fragmentShaderText=o;var s=/(?:Compile|Link) error: ([^]*)/,u=s.exec(e.message);r(u?u[1]:e.message)}})}(e)}ic.prototype._bind=function(){fc(this),this._gl.useProgram(this._program)},ic.prototype._setUniforms=function(e,t,n){if(Ze(e))for(var r=this._manualUniforms,i=r.length,o=0;o<i;++o){var a=r[o];a.value=e[a.name]()}var s=this._automaticUniforms;for(i=s.length,o=0;o<i;++o){var u=s[o];u.uniform.value=u.automaticUniform.getValue(t)}var l,c,h=this._uniforms;for(i=h.length,o=0;o<i;++o)h[o].set();n&&(l=this._gl,c=this._program,l.validateProgram(c))},ic.prototype.isDestroyed=function(){return!1},ic.prototype.destroy=function(){this._cachedShader.cache.releaseShaderProgram(this)},ic.prototype.finalDestroy=function(){return this._gl.deleteProgram(this._program),Vt(this)};var pc=Object.freeze({NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3});function dc(e){e=Je(e,Je.EMPTY_OBJECT),this.attributes=e.attributes,this.indices=e.indices,this.primitiveType=Je(e.primitiveType,Dn.TRIANGLES),this.boundingSphere=e.boundingSphere,this.geometryType=Je(e.geometryType,pc.NONE),this.boundingSphereCV=e.boundingSphereCV,this.offsetAttribute=e.offsetAttribute}dc.computeNumberOfVertices=function(e){var t,n=-1;for(var r in e.attributes){e.attributes.hasOwnProperty(r)&&Ze(e.attributes[r])&&Ze(e.attributes[r].values)&&(n=(t=e.attributes[r]).values.length/t.componentsPerAttribute)}return n};var mc=new Un,_c=new _t,gc=new on,yc=[new Un,new Un,new Un],vc=[new En,new En,new En],xc=[new En,new En,new En],bc=new _t,Ec=new Si,Tc=new on,Sc=new fi;function Cc(e,t,n,r){var i=Ze(t.vertexBuffer),o=Ze(t.value),a=t.value?t.value.length:t.componentsPerAttribute,s={index:Je(t.index,n),enabled:Je(t.enabled,!0),vertexBuffer:t.vertexBuffer,value:o?t.value.slice(0):void 0,componentsPerAttribute:a,componentDatatype:Je(t.componentDatatype,Mt.FLOAT),normalize:Je(t.normalize,!1),offsetInBytes:Je(t.offsetInBytes,0),strideInBytes:Je(t.strideInBytes,0),instanceDivisor:Je(t.instanceDivisor,0)};if(i)s.vertexAttrib=function(e){var t=this.index;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),e.vertexAttribPointer(t,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),e.enableVertexAttribArray(t),0<this.instanceDivisor&&(r.glVertexAttribDivisor(t,this.instanceDivisor),r._vertexAttribDivisors[t]=this.instanceDivisor,r._previousDrawInstanced=!0)},s.disableVertexAttribArray=function(e){e.disableVertexAttribArray(this.index),0<this.instanceDivisor&&r.glVertexAttribDivisor(n,0)};else{switch(s.componentsPerAttribute){case 1:s.vertexAttrib=function(e){e.vertexAttrib1fv(this.index,this.value)};break;case 2:s.vertexAttrib=function(e){e.vertexAttrib2fv(this.index,this.value)};break;case 3:s.vertexAttrib=function(e){e.vertexAttrib3fv(this.index,this.value)};break;case 4:s.vertexAttrib=function(e){e.vertexAttrib4fv(this.index,this.value)}}s.disableVertexAttribArray=function(e){}}e.push(s)}function wc(e,t,n){for(var r=0;r<t.length;++r){var i=t[r];i.enabled&&i.vertexAttrib(e)}Ze(n)&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n._getBuffer())}function Ac(e){for(var t,n=(e=Je(e,Je.EMPTY_OBJECT)).context,r=n._gl,i=e.attributes,o=e.indexBuffer,a=[],s=1,u=!1,l=!1,c=i.length,h=0;h<c;++h)Cc(a,i[h],h,n);for(c=a.length,h=0;h<c;++h){var f=a[h];if(Ze(f.vertexBuffer)&&0===f.instanceDivisor){var p=f.strideInBytes||f.componentsPerAttribute*Mt.getSizeInBytes(f.componentDatatype),s=f.vertexBuffer.sizeInBytes/p;break}}for(h=0;h<c;++h)0<a[h].instanceDivisor&&(u=!0),Ze(a[h].value)&&(l=!0);n.vertexArrayObject&&(t=n.glCreateVertexArray(),n.glBindVertexArray(t),wc(r,a,o),n.glBindVertexArray(null)),this._numberOfVertices=s,this._hasInstancedAttributes=u,this._hasConstantAttributes=l,this._context=n,this._gl=r,this._vao=t,this._attributes=a,this._indexBuffer=o}function Ic(e){return e.values.length/e.componentsPerAttribute}dc._textureCoordinateRotationPoints=function(e,t,n,r){var i=$n.center(r,mc),o=Un.toCartesian(i,n,_c),a=bs.eastNorthUpToFixedFrame(o,n,gc),s=on.inverse(a,gc),u=vc,l=yc;l[0].longitude=r.west,l[0].latitude=r.south,l[1].longitude=r.west,l[1].latitude=r.north,l[2].longitude=r.east,l[2].latitude=r.south;for(var c=bc,h=0;h<3;h++)Un.toCartesian(l[h],n,c),c=on.multiplyByPointAsVector(s,c,c),u[h].x=c.x,u[h].y=c.y;var f=Si.fromAxisAngle(_t.UNIT_Z,-t,Ec),p=jt.fromQuaternion(f,Tc),d=e.length,m=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=Number.NEGATIVE_INFINITY;for(h=0;h<d;h++)c=on.multiplyByPointAsVector(s,e[h],c),c=jt.multiplyByVector(p,c,c),m=Math.min(m,c.x),_=Math.min(_,c.y),g=Math.max(g,c.x),y=Math.max(y,c.y);var v=fi.fromRotation(t,Sc),x=xc;x[0].x=m,x[0].y=_,x[1].x=m,x[1].y=y,x[2].x=g,x[2].y=_;var b=u[0],E=u[2].x-b.x,T=u[1].y-b.y;for(h=0;h<3;h++){var S=x[h];fi.multiplyByVector(v,S,S),S.x=(S.x-b.x)/E,S.y=(S.y-b.y)/T}var C=x[0],w=x[1],A=x[2],I=new Array(6);return En.pack(C,I),En.pack(w,I,2),En.pack(A,I,4),I},Ac.fromGeometry=function(e){var t,n,r,i,o,a=(e=Je(e,Je.EMPTY_OBJECT)).context,s=Je(e.geometry,Je.EMPTY_OBJECT),u=Je(e.bufferUsage,wl.DYNAMIC_DRAW),l=Je(e.attributeLocations,Je.EMPTY_OBJECT),c=Je(e.interleave,!1),h=e.vertexArrayAttributes,f=Ze(h)?h:[],p=s.attributes;if(c){var d=function(n){var e,t,r,i=[];for(e in n)n.hasOwnProperty(e)&&Ze(n[e])&&Ze(n[e].values)&&(i.push(e),n[e].componentDatatype===Mt.DOUBLE&&(n[e].componentDatatype=Mt.FLOAT,n[e].values=Mt.createTypedArray(Mt.FLOAT,n[e].values)));var o=i.length;if(0<o)for(r=Ic(n[i[0]]),d=1;d<o;++d){var a=Ic(n[i[d]]);if(a!==r)throw new de("Each attribute list must have the same number of vertices.  Attribute "+i[d]+" has a different number of vertices ("+a.toString()+") than attribute "+i[0]+" ("+r.toString()+").")}i.sort(function(e,t){return Mt.getSizeInBytes(n[t].componentDatatype)-Mt.getSizeInBytes(n[e].componentDatatype)});var s,u=0,l={};for(d=0;d<o;++d)e=i[d],t=n[e],l[e]=u,u+=(s=t,Mt.getSizeInBytes(s.componentDatatype)*s.componentsPerAttribute);if(0<u){var c=Mt.getSizeInBytes(n[i[0]].componentDatatype),h=u%c;0!=h&&(u+=c-h);for(var f=new ArrayBuffer(r*u),p={},d=0;d<o;++d){e=i[d];var m=Mt.getSizeInBytes(n[e].componentDatatype);p[e]={pointer:Mt.createTypedArray(n[e].componentDatatype,f),index:l[e]/m,strideInComponentType:u/m}}for(d=0;d<r;++d)for(var _=0;_<o;++_){e=i[_];for(var g=(t=n[e]).values,y=p[e],v=y.pointer,x=t.componentsPerAttribute,b=0;b<x;++b)v[y.index+b]=g[d*x+b];y.index+=y.strideInComponentType}return{buffer:f,offsetsInBytes:l,vertexSizeInBytes:u}}}(p);if(Ze(d)){r=Al.createVertexBuffer({context:a,typedArray:d.buffer,usage:u});var m=d.offsetsInBytes,_=d.vertexSizeInBytes;for(t in p)p.hasOwnProperty(t)&&Ze(p[t])&&(Ze((n=p[t]).values)?f.push({index:l[t],vertexBuffer:r,componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,offsetInBytes:m[t],strideInBytes:_}):f.push({index:l[t],value:n.value,componentDatatype:n.componentDatatype,normalize:n.normalize}))}}else for(t in p){p.hasOwnProperty(t)&&Ze(p[t])&&((i=(n=p[t]).componentDatatype)===Mt.DOUBLE&&(i=Mt.FLOAT),r=void 0,Ze(n.values)&&(r=Al.createVertexBuffer({context:a,typedArray:Mt.createTypedArray(i,n.values),usage:u})),f.push({index:l[t],vertexBuffer:r,value:n.value,componentDatatype:i,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize}))}var g=s.indices;return Ze(g)&&(o=dc.computeNumberOfVertices(s)>=pt.SIXTY_FOUR_KILOBYTES&&a.elementIndexUint?Al.createIndexBuffer({context:a,typedArray:new Uint32Array(g),usage:u,indexDatatype:wa.UNSIGNED_INT}):Al.createIndexBuffer({context:a,typedArray:new Uint16Array(g),usage:u,indexDatatype:wa.UNSIGNED_SHORT})),new Ac({context:a,attributes:f,indexBuffer:o})},Object.defineProperties(Ac.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}}),Ac.prototype.getAttribute=function(e){return this._attributes[e]},Ac.prototype._bind=function(){Ze(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&function(e){var t=e._context,n=e._hasInstancedAttributes;if(n||t._previousDrawInstanced){t._previousDrawInstanced=n;var r=t._vertexAttribDivisors,i=e._attributes,o=Nn.maximumVertexAttributes;if(n)for(var a=i.length,s=0;s<a;++s){var u,l,c=i[s];!c.enabled||(u=c.instanceDivisor)!==r[l=c.index]&&(t.glVertexAttribDivisor(l,u),r[l]=u)}else for(s=0;s<o;++s)0<r[s]&&(t.glVertexAttribDivisor(s,0),r[s]=0)}}(this),this._hasConstantAttributes&&function(e,t){for(var n=e._attributes,r=n.length,i=0;i<r;++i){var o=n[i];o.enabled&&Ze(o.value)&&o.vertexAttrib(t)}}(this,this._gl)):wc(this._gl,this._attributes,this._indexBuffer)},Ac.prototype._unBind=function(){if(Ze(this._vao))this._context.glBindVertexArray(null);else{for(var e=this._attributes,t=this._gl,n=0;n<e.length;++n){var r=e[n];r.enabled&&r.disableVertexAttribArray(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}},Ac.prototype.isDestroyed=function(){return!1},Ac.prototype.destroy=function(){for(var e=this._attributes,t=0;t<e.length;++t){var n=e[t].vertexBuffer;Ze(n)&&!n.isDestroyed()&&n.vertexArrayDestroyable&&n.destroy()}var r=this._indexBuffer;return Ze(r)&&!r.isDestroyed()&&r.vertexArrayDestroyable&&r.destroy(),Ze(this._vao)&&this._context.glDeleteVertexArray(this._vao),Vt(this)};var Pc,Oc,Lc,Nc,Rc,Dc,Mc,Fc,zc="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvoid main(void)\n{\n#ifdef VECTOR_TILE\ngl_FragColor = czm_gammaCorrect(u_highlightColor);\n#else\ngl_FragColor = vec4(1.0);\n#endif\nczm_writeDepthClampedToFarPlane();\n}\n",Bc="attribute vec3 position;\nattribute float a_batchId;\nuniform mat4 u_modifiedModelViewProjection;\nvoid main()\n{\ngl_Position = czm_depthClampFarPlane(u_modifiedModelViewProjection * vec4(position, 1.0));\n}\n",Uc=Object.freeze({TERRAIN:0,CESIUM_3D_TILE:1,BOTH:2,NUMBER_OF_CLASSIFICATION_TYPES:3}),Vc={NEVER:Rt.NEVER,LESS:Rt.LESS,EQUAL:Rt.EQUAL,LESS_OR_EQUAL:Rt.LEQUAL,GREATER:Rt.GREATER,NOT_EQUAL:Rt.NOTEQUAL,GREATER_OR_EQUAL:Rt.GEQUAL,ALWAYS:Rt.ALWAYS},kc=Object.freeze(Vc),Gc={};function qc(e,t){var n=new Error(e+" at character "+t);throw n.index=t,n.description=e,n}function Hc(e){var t,n=0;for(var r in e)(t=r.length)>n&&e.hasOwnProperty(r)&&(n=t);return n}function Wc(e){return Rc[e]||0}function Yc(e,t,n){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:n}}function Xc(e){return 48<=e&&e<=57}function jc(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||128<=e&&!Rc[String.fromCharCode(e)]}function Kc(i){for(var e,t,u=0,n=i.charAt,r=i.charCodeAt,o=function(e){return n.call(i,e)},a=function(e){return r.call(i,e)},s=i.length,l=function(){for(var e=a(u);32===e||9===e;)e=a(++u)},c=function(){var e,t,n=f();return l(),63!==a(u)?n:(u++,(e=c())||qc("Expected expression",u),l(),58===a(u)?(u++,(t=c())||qc("Expected expression",u),{type:"ConditionalExpression",test:n,consequent:e,alternate:t}):void qc("Expected :",u))},h=function(){l();for(var e=i.substr(u,Mc),t=e.length;0<t;){if(Rc.hasOwnProperty(e))return u+=t,e;e=e.substr(0,--t)}return!1},f=function(){var e,t,n,r,i,o,a=p(),s=h();if(!s)return a;for(r={value:s,prec:Wc(s)},(i=p())||qc("Expected expression after "+s,u),n=[a,r,i];(s=h())&&0!==(t=Wc(s));){for(r={value:s,prec:t};2<n.length&&t<=n[n.length-2].prec;)i=n.pop(),s=n.pop().value,a=n.pop(),e=Yc(s,a,i),n.push(e);(e=p())||qc("Expected expression after "+s,u),n.push(r,e)}for(e=n[o=n.length-1];1<o;)e=Yc(n[o-1].value,n[o-2],e),o-=2;return e},p=function(){var e,t,n;if(l(),e=a(u),Xc(e)||46===e)return d();if(39===e||34===e)return m();if(jc(e)||40===e)return y();if(91===e)return x();for(n=(t=i.substr(u,Dc)).length;0<n;){if(Nc.hasOwnProperty(t))return u+=n,{type:"UnaryExpression",operator:t,argument:p(),prefix:!0};t=t.substr(0,--n)}return!1},d=function(){for(var e,t,n="";Xc(a(u));)n+=o(u++);if(46===a(u))for(n+=o(u++);Xc(a(u));)n+=o(u++);if("e"===(e=o(u))||"E"===e){for(n+=o(u++),"+"!==(e=o(u))&&"-"!==e||(n+=o(u++));Xc(a(u));)n+=o(u++);Xc(a(u-1))||qc("Expected exponent ("+n+o(u)+")",u)}return t=a(u),jc(t)?qc("Variable names cannot start with a number ("+n+o(u)+")",u):46===t&&qc("Unexpected period",u),{type:Lc,value:parseFloat(n),raw:n}},m=function(){for(var e,t="",n=o(u++),r=!1;u<s;){if((e=o(u++))===n){r=!0;break}if("\\"===e)switch(e=o(u++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+="\\"+e}else t+=e}return r||qc('Unclosed quote after "'+t+'"',u),{type:Lc,value:t,raw:n+t+n}},_=function(){var e,t,n=a(u),r=u;for(jc(n)?u++:qc("Unexpected "+o(u),u);u<s&&(n=a(u),36===(t=n)||95===t||65<=t&&t<=90||97<=t&&t<=122||48<=t&&t<=57||128<=t&&!Rc[String.fromCharCode(t)]);)u++;return e=i.slice(r,u),Fc.hasOwnProperty(e)?{type:Lc,value:Fc[e],raw:e}:"this"===e?{type:"ThisExpression"}:{type:"Identifier",name:e}},g=function(e){for(var t,n,r=[],i=!1;u<s;){if(l(),(t=a(u))===e){i=!0,u++;break}44===t?u++:((n=c())&&"Compound"!==n.type||qc("Expected comma",u),r.push(n))}return i||qc("Expected "+String.fromCharCode(e),u),r},y=function(){var e=a(u),t=(40===e?v:_)();for(l(),e=a(u);46===e||91===e||40===e;)u++,46===e?(l(),t={type:Oc,computed:!1,object:t,property:_()}):91===e?(t={type:Oc,computed:!0,object:t,property:c()},l(),93!==(e=a(u))&&qc("Unclosed [",u),u++):40===e&&(t={type:"CallExpression",arguments:g(41),callee:t}),l(),e=a(u);return t},v=function(){u++;var e=c();if(l(),41===a(u))return u++,e;qc("Unclosed (",u)},x=function(){return u++,{type:"ArrayExpression",elements:g(93)}},b=[];u<s;)59===(e=a(u))||44===e?u++:(t=c())?b.push(t):u<s&&qc('Unexpected "'+o(u)+'"',u);return 1===b.length?b[0]:{type:"Compound",body:b}}Pc=Gc,Oc="MemberExpression",Lc="Literal",Rc={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},Dc=Hc(Nc={"-":!0,"!":!0,"~":!0,"+":!0}),Mc=Hc(Rc),Fc={true:!0,false:!1,null:null},Kc.version="0.3.1",Kc.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Kc.version},Kc.addUnaryOp=function(e){return Dc=Math.max(e.length,Dc),Nc[e]=!0,this},Kc.addBinaryOp=function(e,t){return Mc=Math.max(e.length,Mc),Rc[e]=t,this},Kc.addLiteral=function(e,t){return Fc[e]=t,this},Kc.removeUnaryOp=function(e){return delete Nc[e],e.length===Dc&&(Dc=Hc(Nc)),this},Kc.removeAllUnaryOps=function(){return Nc={},Dc=0,this},Kc.removeBinaryOp=function(e){return delete Rc[e],e.length===Mc&&(Mc=Hc(Rc)),this},Kc.removeAllBinaryOps=function(){return Rc={},Mc=0,this},Kc.removeLiteral=function(e){return delete Fc[e],this},Kc.removeAllLiterals=function(){return Fc={},this},Pc.jsep=Kc;var Qc=Gc.jsep,Zc=Object.freeze({VARIABLE:0,UNARY:1,BINARY:2,TERNARY:3,CONDITIONAL:4,MEMBER:5,FUNCTION_CALL:6,ARRAY:7,REGEX:8,VARIABLE_IN_STRING:9,LITERAL_NULL:10,LITERAL_BOOLEAN:11,LITERAL_NUMBER:12,LITERAL_STRING:13,LITERAL_COLOR:14,LITERAL_VECTOR:15,LITERAL_REGEX:16,LITERAL_UNDEFINED:17,BUILTIN_VARIABLE:18});function Jc(e,t){var n;e=function(e,t){if(!Ze(t))return e;for(var n in t){var r,i;t.hasOwnProperty(n)&&(r=new RegExp("\\$\\{"+n+"\\}","g"),Ze(i="("+t[n]+")")&&(e=e.replace(r,i)))}return e}(this._expression=e,t),e=function(e){var t,n=e,r="",i=n.indexOf("${");for(;0<=i;){var o=n.indexOf("'"),a=n.indexOf('"');if(0<=o&&o<i)t=n.indexOf("'",o+1),r+=n.substr(0,t+1),n=n.substr(t+1),i=n.indexOf("${");else if(0<=a&&a<i)t=n.indexOf('"',a+1),r+=n.substr(0,t+1),n=n.substr(t+1),i=n.indexOf("${");else{r+=n.substr(0,i);var s=n.indexOf("}");if(s<0)throw new de("Unmatched {.");r+="czm_"+n.substr(i+2,s-(i+2)),n=n.substr(s+1),i=n.indexOf("${")}}return r+=n}(e.replace(rh,ih)),Qc.addBinaryOp("=~",0),Qc.addBinaryOp("!~",0);try{n=Qc(e)}catch(e){throw new de(e)}this._runtimeAst=yh(this,n)}Object.defineProperties(Jc.prototype,{expression:{get:function(){return this._expression}}});var $c={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new En],cartesian3Array:[new _t],cartesian4Array:[new qt],reset:function(){this.arrayIndex=0,this.cartesian2Index=0,this.cartesian3Index=0,this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);var e=this.arrayArray[this.arrayIndex++];return e.length=0,e},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new En),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new _t),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new qt),this.cartesian4Array[this.cartesian4Index++]}};Jc.prototype.evaluate=function(e,t){$c.reset();var n=this._runtimeAst.evaluate(e);return t instanceof It&&n instanceof qt?It.fromCartesian4(n,t):n instanceof En||n instanceof _t||n instanceof qt?n.clone(t):n},Jc.prototype.evaluateColor=function(e,t){$c.reset();var n=this._runtimeAst.evaluate(e);return It.fromCartesian4(n,t)},Jc.prototype.getShaderFunction=function(e,t,n,r){return r+" "+e+"() \n{ \n    return "+this.getShaderExpression(t,n)+"; \n} \n"},Jc.prototype.getShaderExpression=function(e,t){return this._runtimeAst.getShaderExpression(e,t)};var eh=["!","-","+"],th=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],nh=/\${(.*?)}/g,rh=/\\/g,ih="@#%",oh=/@#%/g,ah=new It,sh={abs:ch(Math.abs),sqrt:ch(Math.sqrt),cos:ch(Math.cos),sin:ch(Math.sin),tan:ch(Math.tan),acos:ch(Math.acos),asin:ch(Math.asin),atan:ch(Math.atan),radians:ch(pt.toRadians),degrees:ch(pt.toDegrees),sign:ch(pt.sign),floor:ch(Math.floor),ceil:ch(Math.ceil),round:ch(Math.round),exp:ch(Math.exp),exp2:ch(function(e){return Math.pow(2,e)}),log:ch(Math.log),log2:ch(function(e){return pt.log2(e)}),fract:ch(function(e){return e-Math.floor(e)}),length:function(e,t){{if("number"==typeof t)return Math.abs(t);if(t instanceof En)return En.magnitude(t);if(t instanceof _t)return _t.magnitude(t);if(t instanceof qt)return qt.magnitude(t)}throw new de('Function "'+e+'" requires a vector or number argument. Argument is '+t+".")},normalize:function(e,t){{if("number"==typeof t)return 1;if(t instanceof En)return En.normalize(t,$c.getCartesian2());if(t instanceof _t)return _t.normalize(t,$c.getCartesian3());if(t instanceof qt)return qt.normalize(t,$c.getCartesian4())}throw new de('Function "'+e+'" requires a vector or number argument. Argument is '+t+".")}},uh={atan2:hh(Math.atan2,!1),pow:hh(Math.pow,!1),min:hh(Math.min,!0),max:hh(Math.max,!0),distance:function(e,t,n){{if("number"==typeof t&&"number"==typeof n)return Math.abs(t-n);if(t instanceof En&&n instanceof En)return En.distance(t,n);if(t instanceof _t&&n instanceof _t)return _t.distance(t,n);if(t instanceof qt&&n instanceof qt)return qt.distance(t,n)}throw new de('Function "'+e+'" requires vector or number arguments of matching types. Arguments are '+t+" and "+n+".")},dot:function(e,t,n){{if("number"==typeof t&&"number"==typeof n)return t*n;if(t instanceof En&&n instanceof En)return En.dot(t,n);if(t instanceof _t&&n instanceof _t)return _t.dot(t,n);if(t instanceof qt&&n instanceof qt)return qt.dot(t,n)}throw new de('Function "'+e+'" requires vector or number arguments of matching types. Arguments are '+t+" and "+n+".")},cross:function(e,t,n){if(t instanceof _t&&n instanceof _t)return _t.cross(t,n,$c.getCartesian3());throw new de('Function "'+e+'" requires vec3 arguments. Arguments are '+t+" and "+n+".")}},lh={clamp:fh(pt.clamp,!0),mix:fh(pt.lerp,!0)};function ch(n){return function(e,t){if("number"==typeof t)return n(t);if(t instanceof En)return En.fromElements(n(t.x),n(t.y),$c.getCartesian2());if(t instanceof _t)return _t.fromElements(n(t.x),n(t.y),n(t.z),$c.getCartesian3());if(t instanceof qt)return qt.fromElements(n(t.x),n(t.y),n(t.z),n(t.w),$c.getCartesian4());throw new de('Function "'+e+'" requires a vector or number argument. Argument is '+t+".")}}function hh(r,i){return function(e,t,n){if(i&&"number"==typeof n){if("number"==typeof t)return r(t,n);if(t instanceof En)return En.fromElements(r(t.x,n),r(t.y,n),$c.getCartesian2());if(t instanceof _t)return _t.fromElements(r(t.x,n),r(t.y,n),r(t.z,n),$c.getCartesian3());if(t instanceof qt)return qt.fromElements(r(t.x,n),r(t.y,n),r(t.z,n),r(t.w,n),$c.getCartesian4())}if("number"==typeof t&&"number"==typeof n)return r(t,n);if(t instanceof En&&n instanceof En)return En.fromElements(r(t.x,n.x),r(t.y,n.y),$c.getCartesian2());if(t instanceof _t&&n instanceof _t)return _t.fromElements(r(t.x,n.x),r(t.y,n.y),r(t.z,n.z),$c.getCartesian3());if(t instanceof qt&&n instanceof qt)return qt.fromElements(r(t.x,n.x),r(t.y,n.y),r(t.z,n.z),r(t.w,n.w),$c.getCartesian4());throw new de('Function "'+e+'" requires vector or number arguments of matching types. Arguments are '+t+" and "+n+".")}}function fh(i,o){return function(e,t,n,r){if(o&&"number"==typeof r){if("number"==typeof t&&"number"==typeof n)return i(t,n,r);if(t instanceof En&&n instanceof En)return En.fromElements(i(t.x,n.x,r),i(t.y,n.y,r),$c.getCartesian2());if(t instanceof _t&&n instanceof _t)return _t.fromElements(i(t.x,n.x,r),i(t.y,n.y,r),i(t.z,n.z,r),$c.getCartesian3());if(t instanceof qt&&n instanceof qt)return qt.fromElements(i(t.x,n.x,r),i(t.y,n.y,r),i(t.z,n.z,r),i(t.w,n.w,r),$c.getCartesian4())}if("number"==typeof t&&"number"==typeof n&&"number"==typeof r)return i(t,n,r);if(t instanceof En&&n instanceof En&&r instanceof En)return En.fromElements(i(t.x,n.x,r.x),i(t.y,n.y,r.y),$c.getCartesian2());if(t instanceof _t&&n instanceof _t&&r instanceof _t)return _t.fromElements(i(t.x,n.x,r.x),i(t.y,n.y,r.y),i(t.z,n.z,r.z),$c.getCartesian3());if(t instanceof qt&&n instanceof qt&&r instanceof qt)return qt.fromElements(i(t.x,n.x,r.x),i(t.y,n.y,r.y),i(t.z,n.z,r.z),i(t.w,n.w,r.w),$c.getCartesian4());throw new de('Function "'+e+'" requires vector or number arguments of matching types. Arguments are '+t+", "+n+", and "+r+".")}}function ph(e,t,n,r,i){var o;this._type=e,this._value=t,this._left=n,this._right=r,this._test=i,this.evaluate=void 0,(o=this)._type===Zc.CONDITIONAL?o.evaluate=o._evaluateConditional:o._type===Zc.FUNCTION_CALL?"test"===o._value?o.evaluate=o._evaluateRegExpTest:"exec"===o._value?o.evaluate=o._evaluateRegExpExec:"toString"===o._value&&(o.evaluate=o._evaluateToString):o._type===Zc.UNARY?"!"===o._value?o.evaluate=o._evaluateNot:"-"===o._value?o.evaluate=o._evaluateNegative:"+"===o._value?o.evaluate=o._evaluatePositive:"isNaN"===o._value?o.evaluate=o._evaluateNaN:"isFinite"===o._value?o.evaluate=o._evaluateIsFinite:"isExactClass"===o._value?o.evaluate=o._evaluateIsExactClass:"isClass"===o._value?o.evaluate=o._evaluateIsClass:"getExactClassName"===o._value?o.evaluate=o._evaluateGetExactClassName:"Boolean"===o._value?o.evaluate=o._evaluateBooleanConversion:"Number"===o._value?o.evaluate=o._evaluateNumberConversion:"String"===o._value?o.evaluate=o._evaluateStringConversion:Ze(sh[o._value])&&(o.evaluate=function(n){var r=sh[n];return function(e){var t=this._left.evaluate(e);return r(n,t)}}(o._value)):o._type===Zc.BINARY?"+"===o._value?o.evaluate=o._evaluatePlus:"-"===o._value?o.evaluate=o._evaluateMinus:"*"===o._value?o.evaluate=o._evaluateTimes:"/"===o._value?o.evaluate=o._evaluateDivide:"%"===o._value?o.evaluate=o._evaluateMod:"==="===o._value?o.evaluate=o._evaluateEqualsStrict:"!=="===o._value?o.evaluate=o._evaluateNotEqualsStrict:"<"===o._value?o.evaluate=o._evaluateLessThan:"<="===o._value?o.evaluate=o._evaluateLessThanOrEquals:">"===o._value?o.evaluate=o._evaluateGreaterThan:">="===o._value?o.evaluate=o._evaluateGreaterThanOrEquals:"&&"===o._value?o.evaluate=o._evaluateAnd:"||"===o._value?o.evaluate=o._evaluateOr:"=~"===o._value?o.evaluate=o._evaluateRegExpMatch:"!~"===o._value?o.evaluate=o._evaluateRegExpNotMatch:Ze(uh[o._value])&&(o.evaluate=function(r){var i=uh[r];return function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);return i(r,t,n)}}(o._value)):o._type===Zc.TERNARY?o.evaluate=function(i){var o=lh[i];return function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e),r=this._test.evaluate(e);return o(i,t,n,r)}}(o._value):o._type===Zc.MEMBER?"brackets"===o._value?o.evaluate=o._evaluateMemberBrackets:o.evaluate=o._evaluateMemberDot:o._type===Zc.ARRAY?o.evaluate=o._evaluateArray:o._type===Zc.VARIABLE?o.evaluate=o._evaluateVariable:o._type===Zc.VARIABLE_IN_STRING?o.evaluate=o._evaluateVariableString:o._type===Zc.LITERAL_COLOR?o.evaluate=o._evaluateLiteralColor:o._type===Zc.LITERAL_VECTOR?o.evaluate=o._evaluateLiteralVector:o._type===Zc.LITERAL_STRING?o.evaluate=o._evaluateLiteralString:o._type===Zc.REGEX?o.evaluate=o._evaluateRegExp:o._type===Zc.BUILTIN_VARIABLE?"tiles3d_tileset_time"===o._value&&(o.evaluate=vh):o.evaluate=o._evaluateLiteral}function dh(e){return e.replace(oh,"\\")}function mh(e,t){var n,r,i,o,a=t.arguments,s=a.length;if("MemberExpression"===t.callee.type){n=t.callee.property.name;var u=t.callee.object;if("test"===n||"exec"===n){if("regExp"!==u.callee.name)throw new de(n+" is not a function.");return 0===s?"test"===n?new ph(Zc.LITERAL_BOOLEAN,!1):new ph(Zc.LITERAL_NULL,null):(i=yh(e,u),o=yh(e,a[0]),new ph(Zc.FUNCTION_CALL,n,i,o))}if("toString"===n)return r=yh(e,u),new ph(Zc.FUNCTION_CALL,n,r);throw new de('Unexpected function call "'+n+'".')}if("color"===(n=t.callee.name)){if(0===s)return new ph(Zc.LITERAL_COLOR,n);if(r=yh(e,a[0]),Ze(a[1])){var l=yh(e,a[1]);return new ph(Zc.LITERAL_COLOR,n,[r,l])}return new ph(Zc.LITERAL_COLOR,n,[r])}if("rgb"===n||"hsl"===n){if(s<3)throw new de(n+" requires three arguments.");return r=[yh(e,a[0]),yh(e,a[1]),yh(e,a[2])],new ph(Zc.LITERAL_COLOR,n,r)}if("rgba"===n||"hsla"===n){if(s<4)throw new de(n+" requires four arguments.");return r=[yh(e,a[0]),yh(e,a[1]),yh(e,a[2]),yh(e,a[3])],new ph(Zc.LITERAL_COLOR,n,r)}if("vec2"===n||"vec3"===n||"vec4"===n){r=new Array(s);for(var c=0;c<s;++c)r[c]=yh(e,a[c]);return new ph(Zc.LITERAL_VECTOR,n,r)}if("isNaN"===n||"isFinite"===n)return 0===s?new ph(Zc.LITERAL_BOOLEAN,"isNaN"===n):(r=yh(e,a[0]),new ph(Zc.UNARY,n,r));if("isExactClass"===n||"isClass"===n){if(s<1||1<s)throw new de(n+" requires exactly one argument.");return r=yh(e,a[0]),new ph(Zc.UNARY,n,r)}if("getExactClassName"===n){if(0<s)throw new de(n+" does not take any argument.");return new ph(Zc.UNARY,n)}if(Ze(sh[n])){if(1!==s)throw new de(n+" requires exactly one argument.");return r=yh(e,a[0]),new ph(Zc.UNARY,n,r)}if(Ze(uh[n])){if(2!==s)throw new de(n+" requires exactly two arguments.");return i=yh(e,a[0]),o=yh(e,a[1]),new ph(Zc.BINARY,n,i,o)}if(Ze(lh[n])){if(3!==s)throw new de(n+" requires exactly three arguments.");i=yh(e,a[0]),o=yh(e,a[1]);var h=yh(e,a[2]);return new ph(Zc.TERNARY,n,i,o,h)}if("Boolean"===n)return 0===s?new ph(Zc.LITERAL_BOOLEAN,!1):(r=yh(e,a[0]),new ph(Zc.UNARY,n,r));if("Number"===n)return 0===s?new ph(Zc.LITERAL_NUMBER,0):(r=yh(e,a[0]),new ph(Zc.UNARY,n,r));if("String"===n)return 0===s?new ph(Zc.LITERAL_STRING,""):(r=yh(e,a[0]),new ph(Zc.UNARY,n,r));if("regExp"===n)return function(e,t){var n=t.arguments;if(0===n.length)return new ph(Zc.LITERAL_REGEX,new RegExp);var r,i=yh(e,n[0]);if(1<n.length){var o=yh(e,n[1]);if(gh(i)&&gh(o)){try{r=new RegExp(dh(String(i._value)),o._value)}catch(e){throw new de(e)}return new ph(Zc.LITERAL_REGEX,r)}return new ph(Zc.REGEX,i,o)}if(gh(i)){try{r=new RegExp(dh(String(i._value)))}catch(e){throw new de(e)}return new ph(Zc.LITERAL_REGEX,r)}return new ph(Zc.REGEX,i)}(e,t);throw new de('Unexpected function call "'+n+'".')}function _h(e,t){if("Math"===t.object.name)return"PI"===(n=t.property.name)?new ph(Zc.LITERAL_NUMBER,Math.PI):"E"===n?new ph(Zc.LITERAL_NUMBER,Math.E):void 0;if("Number"===t.object.name)return function(e){if("POSITIVE_INFINITY"===e.property.name)return new ph(Zc.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}(t);var n,r,i=yh(e,t.object);return t.computed?(r=yh(e,t.property),new ph(Zc.MEMBER,"brackets",i,r)):(r=new ph(Zc.LITERAL_STRING,t.property.name),new ph(Zc.MEMBER,"dot",i,r))}function gh(e){return e._type>=Zc.LITERAL_NULL}function yh(e,t){var n,r,i;if("Literal"===t.type)i=typeof(r=t).value,l=null===r.value?new ph(Zc.LITERAL_NULL,null):"boolean"==i?new ph(Zc.LITERAL_BOOLEAN,r.value):"number"==i?new ph(Zc.LITERAL_NUMBER,r.value):"string"==i?0<=r.value.indexOf("${")?new ph(Zc.VARIABLE_IN_STRING,r.value):new ph(Zc.LITERAL_STRING,dh(r.value)):void 0;else if("CallExpression"===t.type)l=mh(e,t);else if("Identifier"===t.type)l=function(e){if("czm_"===e.name.substr(0,4)){var t=e.name.substr(4);return"tiles3d_"===t.substr(0,8)?new ph(Zc.BUILTIN_VARIABLE,t):new ph(Zc.VARIABLE,t)}if("NaN"===e.name)return new ph(Zc.LITERAL_NUMBER,NaN);if("Infinity"===e.name)return new ph(Zc.LITERAL_NUMBER,1/0);if("undefined"===e.name)return new ph(Zc.LITERAL_UNDEFINED,void 0);throw new de(e.name+" is not defined.")}(t);else if("UnaryExpression"===t.type){n=t.operator;var o=yh(e,t.argument);if(!(-1<eh.indexOf(n)))throw new de('Unexpected operator "'+n+'".');l=new ph(Zc.UNARY,n,o)}else if("BinaryExpression"===t.type){if(n=t.operator,s=yh(e,t.left),u=yh(e,t.right),!(-1<th.indexOf(n)))throw new de('Unexpected operator "'+n+'".');l=new ph(Zc.BINARY,n,s,u)}else if("LogicalExpression"===t.type)n=t.operator,s=yh(e,t.left),u=yh(e,t.right),-1<th.indexOf(n)&&(l=new ph(Zc.BINARY,n,s,u));else if("ConditionalExpression"===t.type)var a=yh(e,t.test),s=yh(e,t.consequent),u=yh(e,t.alternate),l=new ph(Zc.CONDITIONAL,"?",s,u,a);else if("MemberExpression"===t.type)l=_h(e,t);else{if("ArrayExpression"!==t.type)throw"Compound"===t.type?new de("Provide exactly one expression."):new de("Cannot parse expression.");for(var c=[],h=0;h<t.elements.length;h++)c[h]=yh(e,t.elements[h]);l=new ph(Zc.ARRAY,c)}return l}function vh(e){return Ze(e)?e.content.tileset.timeSinceLoad:0}function xh(e,t){if(Ze(e))return e.getProperty(t)}function bh(e){return"feature"===e._value}function Eh(e){for(var t=e._left,n=t.length,r=0;r<n;++r)if(t[r]._type!==Zc.LITERAL_NUMBER)return;var i=t[0]._value,o=t[1]._value,a=t[2]._value,s=4===n?t[3]._value:1;return It.fromHsl(i,o,a,s,ah)}function Th(e){for(var t=e._left,n=t.length,r=0;r<n;++r)if(t[r]._type!==Zc.LITERAL_NUMBER)return;var i=ah;return i.red=t[0]._value/255,i.green=t[1]._value/255,i.blue=t[2]._value/255,i.alpha=4===n?t[3]._value:1,i}function Sh(e){return e%1==0?e.toFixed(1):e.toString()}function Ch(e){return"vec4("+Sh(e.red)+", "+Sh(e.green)+", "+Sh(e.blue)+", "+Sh(e.alpha)+")"}function wh(e,t,n,r){for(var i=e.length,o=new Array(i),a=0;a<i;++a)o[a]=e[a].getShaderExpression(t,n,r);return o}ph.prototype._evaluateLiteral=function(){return this._value},ph.prototype._evaluateLiteralColor=function(e){var t,n=ah,r=this._left;return"color"===this._value?Ze(r)?1<r.length?(It.fromCssColorString(r[0].evaluate(e),n),n.alpha=r[1].evaluate(e)):It.fromCssColorString(r[0].evaluate(e),n):It.fromBytes(255,255,255,255,n):"rgb"===this._value?It.fromBytes(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),255,n):"rgba"===this._value?(t=255*r[3].evaluate(e),It.fromBytes(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),t,n)):"hsl"===this._value?It.fromHsl(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),1,n):"hsla"===this._value&&It.fromHsl(r[0].evaluate(e),r[1].evaluate(e),r[2].evaluate(e),r[3].evaluate(e),n),qt.fromColor(n,$c.getCartesian4())},ph.prototype._evaluateLiteralVector=function(e){for(var t=$c.getArray(),n=this._value,r=this._left,i=r.length,o=0;o<i;++o){var a=r[o].evaluate(e);if("number"==typeof a)t.push(a);else if(a instanceof En)t.push(a.x,a.y);else if(a instanceof _t)t.push(a.x,a.y,a.z);else{if(!(a instanceof qt))throw new de(n+" argument must be a vector or number. Argument is "+a+".");t.push(a.x,a.y,a.z,a.w)}}var s,u=t.length,l=parseInt(n.charAt(3));if(0===u)throw new de("Invalid "+n+" constructor. No valid arguments.");if(u<l&&1<u)throw new de("Invalid "+n+" constructor. Not enough arguments.");if(l<u&&1<i)throw new de("Invalid "+n+" constructor. Too many arguments.");return 1===u&&(s=t[0],t.push(s,s,s)),"vec2"===n?En.fromArray(t,0,$c.getCartesian2()):"vec3"===n?_t.fromArray(t,0,$c.getCartesian3()):"vec4"===n?qt.fromArray(t,0,$c.getCartesian4()):void 0},ph.prototype._evaluateLiteralString=function(){return this._value},ph.prototype._evaluateVariableString=function(e){for(var t=this._value,n=nh.exec(t);null!==n;){var r=n[0],i=xh(e,n[1]);Ze(i)||(i=""),t=t.replace(r,i),n=nh.exec(t)}return t},ph.prototype._evaluateVariable=function(e){return xh(e,this._value)},ph.prototype._evaluateMemberDot=function(e){if(bh(this._left))return xh(e,this._right.evaluate(e));var t=this._left.evaluate(e);if(Ze(t)){var n=this._right.evaluate(e);if(t instanceof En||t instanceof _t||t instanceof qt){if("r"===n)return t.x;if("g"===n)return t.y;if("b"===n)return t.z;if("a"===n)return t.w}return t[n]}},ph.prototype._evaluateMemberBrackets=function(e){if(bh(this._left))return xh(e,this._right.evaluate(e));var t=this._left.evaluate(e);if(Ze(t)){var n=this._right.evaluate(e);if(t instanceof En||t instanceof _t||t instanceof qt){if(0===n||"r"===n)return t.x;if(1===n||"g"===n)return t.y;if(2===n||"b"===n)return t.z;if(3===n||"a"===n)return t.w}return t[n]}},ph.prototype._evaluateArray=function(e){for(var t=[],n=0;n<this._value.length;n++)t[n]=this._value[n].evaluate(e);return t},ph.prototype._evaluateNot=function(e){var t=this._left.evaluate(e);if("boolean"!=typeof t)throw new de('Operator "!" requires a boolean argument. Argument is '+t+".");return!t},ph.prototype._evaluateNegative=function(e){var t=this._left.evaluate(e);if(t instanceof En)return En.negate(t,$c.getCartesian2());if(t instanceof _t)return _t.negate(t,$c.getCartesian3());if(t instanceof qt)return qt.negate(t,$c.getCartesian4());if("number"==typeof t)return-t;throw new de('Operator "-" requires a vector or number argument. Argument is '+t+".")},ph.prototype._evaluatePositive=function(e){var t=this._left.evaluate(e);if(!(t instanceof En||t instanceof _t||t instanceof qt||"number"==typeof t))throw new de('Operator "+" requires a vector or number argument. Argument is '+t+".");return t},ph.prototype._evaluateLessThan=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!=typeof t||"number"!=typeof n)throw new de('Operator "<" requires number arguments. Arguments are '+t+" and "+n+".");return t<n},ph.prototype._evaluateLessThanOrEquals=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!=typeof t||"number"!=typeof n)throw new de('Operator "<=" requires number arguments. Arguments are '+t+" and "+n+".");return t<=n},ph.prototype._evaluateGreaterThan=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!=typeof t||"number"!=typeof n)throw new de('Operator ">" requires number arguments. Arguments are '+t+" and "+n+".");return n<t},ph.prototype._evaluateGreaterThanOrEquals=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if("number"!=typeof t&&"number"!=typeof n)throw new de('Operator ">=" requires number arguments. Arguments are '+t+" and "+n+".");return n<=t},ph.prototype._evaluateOr=function(e){var t=this._left.evaluate(e);if("boolean"!=typeof t)throw new de('Operator "||" requires boolean arguments. First argument is '+t+".");if(t)return!0;var n=this._right.evaluate(e);if("boolean"!=typeof n)throw new de('Operator "||" requires boolean arguments. Second argument is '+n+".");return t||n},ph.prototype._evaluateAnd=function(e){var t=this._left.evaluate(e);if("boolean"!=typeof t)throw new de('Operator "&&" requires boolean arguments. First argument is '+t+".");if(!t)return!1;var n=this._right.evaluate(e);if("boolean"!=typeof n)throw new de('Operator "&&" requires boolean arguments. Second argument is '+n+".");return t&&n},ph.prototype._evaluatePlus=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof En&&t instanceof En)return En.add(t,n,$c.getCartesian2());if(n instanceof _t&&t instanceof _t)return _t.add(t,n,$c.getCartesian3());if(n instanceof qt&&t instanceof qt)return qt.add(t,n,$c.getCartesian4());if("string"==typeof t||"string"==typeof n)return t+n;if("number"==typeof t&&"number"==typeof n)return t+n;throw new de('Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are '+t+" and "+n+".")},ph.prototype._evaluateMinus=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof En&&t instanceof En)return En.subtract(t,n,$c.getCartesian2());if(n instanceof _t&&t instanceof _t)return _t.subtract(t,n,$c.getCartesian3());if(n instanceof qt&&t instanceof qt)return qt.subtract(t,n,$c.getCartesian4());if("number"==typeof t&&"number"==typeof n)return t-n;throw new de('Operator "-" requires vector or number arguments of matching types. Arguments are '+t+" and "+n+".")},ph.prototype._evaluateTimes=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof En&&t instanceof En)return En.multiplyComponents(t,n,$c.getCartesian2());if(n instanceof En&&"number"==typeof t)return En.multiplyByScalar(n,t,$c.getCartesian2());if(t instanceof En&&"number"==typeof n)return En.multiplyByScalar(t,n,$c.getCartesian2());if(n instanceof _t&&t instanceof _t)return _t.multiplyComponents(t,n,$c.getCartesian3());if(n instanceof _t&&"number"==typeof t)return _t.multiplyByScalar(n,t,$c.getCartesian3());if(t instanceof _t&&"number"==typeof n)return _t.multiplyByScalar(t,n,$c.getCartesian3());if(n instanceof qt&&t instanceof qt)return qt.multiplyComponents(t,n,$c.getCartesian4());if(n instanceof qt&&"number"==typeof t)return qt.multiplyByScalar(n,t,$c.getCartesian4());if(t instanceof qt&&"number"==typeof n)return qt.multiplyByScalar(t,n,$c.getCartesian4());if("number"==typeof t&&"number"==typeof n)return t*n;throw new de('Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are '+t+" and "+n+".")},ph.prototype._evaluateDivide=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof En&&t instanceof En)return En.divideComponents(t,n,$c.getCartesian2());if(t instanceof En&&"number"==typeof n)return En.divideByScalar(t,n,$c.getCartesian2());if(n instanceof _t&&t instanceof _t)return _t.divideComponents(t,n,$c.getCartesian3());if(t instanceof _t&&"number"==typeof n)return _t.divideByScalar(t,n,$c.getCartesian3());if(n instanceof qt&&t instanceof qt)return qt.divideComponents(t,n,$c.getCartesian4());if(t instanceof qt&&"number"==typeof n)return qt.divideByScalar(t,n,$c.getCartesian4());if("number"==typeof t&&"number"==typeof n)return t/n;throw new de('Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are '+t+" and "+n+".")},ph.prototype._evaluateMod=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(n instanceof En&&t instanceof En)return En.fromElements(t.x%n.x,t.y%n.y,$c.getCartesian2());if(n instanceof _t&&t instanceof _t)return _t.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,$c.getCartesian3());if(n instanceof qt&&t instanceof qt)return qt.fromElements(t.x%n.x,t.y%n.y,t.z%n.z,t.w%n.w,$c.getCartesian4());if("number"==typeof t&&"number"==typeof n)return t%n;throw new de('Operator "%" requires vector or number arguments of matching types. Arguments are '+t+" and "+n+".")},ph.prototype._evaluateEqualsStrict=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof En&&t instanceof En||n instanceof _t&&t instanceof _t||n instanceof qt&&t instanceof qt?t.equals(n):t===n},ph.prototype._evaluateNotEqualsStrict=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);return n instanceof En&&t instanceof En||n instanceof _t&&t instanceof _t||n instanceof qt&&t instanceof qt?!t.equals(n):t!==n},ph.prototype._evaluateConditional=function(e){var t=this._test.evaluate(e);if("boolean"!=typeof t)throw new de("Conditional argument of conditional expression must be a boolean. Argument is "+t+".");return t?this._left.evaluate(e):this._right.evaluate(e)},ph.prototype._evaluateNaN=function(e){return isNaN(this._left.evaluate(e))},ph.prototype._evaluateIsFinite=function(e){return isFinite(this._left.evaluate(e))},ph.prototype._evaluateIsExactClass=function(e){return!!Ze(e)&&e.isExactClass(this._left.evaluate(e))},ph.prototype._evaluateIsClass=function(e){return!!Ze(e)&&e.isClass(this._left.evaluate(e))},ph.prototype._evaluateGetExactClassName=function(e){if(Ze(e))return e.getExactClassName()},ph.prototype._evaluateBooleanConversion=function(e){return Boolean(this._left.evaluate(e))},ph.prototype._evaluateNumberConversion=function(e){return Number(this._left.evaluate(e))},ph.prototype._evaluateStringConversion=function(e){return String(this._left.evaluate(e))},ph.prototype._evaluateRegExp=function(e){var t,n=this._value.evaluate(e),r="";Ze(this._left)&&(r=this._left.evaluate(e));try{t=new RegExp(n,r)}catch(e){throw new de(e)}return t},ph.prototype._evaluateRegExpTest=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&"string"==typeof n))throw new de("RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+t+" and "+n+".");return t.test(n)},ph.prototype._evaluateRegExpMatch=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&"string"==typeof n)return t.test(n);if(n instanceof RegExp&&"string"==typeof t)return n.test(t);throw new de('Operator "=~" requires one RegExp argument and one string argument. Arguments are '+t+" and "+n+".")},ph.prototype._evaluateRegExpNotMatch=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(t instanceof RegExp&&"string"==typeof n)return!t.test(n);if(n instanceof RegExp&&"string"==typeof t)return!n.test(t);throw new de('Operator "!~" requires one RegExp argument and one string argument. Arguments are '+t+" and "+n+".")},ph.prototype._evaluateRegExpExec=function(e){var t=this._left.evaluate(e),n=this._right.evaluate(e);if(!(t instanceof RegExp&&"string"==typeof n))throw new de("RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+t+" and "+n+".");var r=t.exec(n);return Ze(r)?r[1]:null},ph.prototype._evaluateToString=function(e){var t=this._left.evaluate(e);if(t instanceof RegExp||t instanceof En||t instanceof _t||t instanceof qt)return String(t);throw new de('Unexpected function call "'+this._value+'".')};var Ah="czm_infinity";function Ih(e){e=Je(e,Je.EMPTY_OBJECT),this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._vertexBatchIds=e.vertexBatchIds,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=e.indexOffsets,this._batchedIndices=e.batchedIndices,this._boundingVolume=e.boundingVolume,this._boundingVolumes=e.boundingVolumes,this._center=Je(e.center,_t.ZERO),this._va=void 0,this._sp=void 0,this._spStencil=void 0,this._spPick=void 0,this._uniformMap=void 0,this._vaSwap=void 0,this._rsStencilPreloadPass=void 0,this._rsStencilPreloadPass3DTiles=void 0,this._rsStencilDepthPass=void 0,this._rsStencilDepthPass3DTiles=void 0,this._rsColorPass=void 0,this._rsPickPass=void 0,this._rsWireframe=void 0,this._commands=[],this._commandsIgnoreShow=[],this._pickCommands=[],this._constantColor=It.clone(It.WHITE),this._highlightColor=this._constantColor,this._batchDirty=!0,this._pickCommandsDirty=!0,this._framesSinceLastRebatch=0,this._updatingAllCommands=!1,this._trianglesLength=this._indices.length/3,this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength,this.debugWireframe=!1,this._debugWireframe=this.debugWireframe,this._wireframeDirty=!1,this.forceRebatch=!1,this.classificationType=Je(e.classificationType,Uc.BOTH),this._vertexShaderSource=e._vertexShaderSource,this._fragmentShaderSource=e._fragmentShaderSource,this._attributeLocations=e._attributeLocations,this._uniformMap=e._uniformMap,this._pickId=e._pickId,this._modelMatrix=e._modelMatrix,this._boundingSphere=e._boundingSphere,this._batchIdLookUp={};for(var t=this._batchIds.length,n=0;n<t;++n){var r=this._batchIds[n];this._batchIdLookUp[r]=n}}ph.prototype.getShaderExpression=function(e,t,n){var r,i,o,a,s,u=this._type,l=this._value;switch(Ze(this._left)&&(i=Array.isArray(this._left)?wh(this._left,e,t,this):this._left.getShaderExpression(e,t,this)),Ze(this._right)&&(o=this._right.getShaderExpression(e,t,this)),Ze(this._test)&&(a=this._test.getShaderExpression(e,t,this)),Array.isArray(this._value)&&(l=wh(this._value,e,t,this)),u){case Zc.VARIABLE:return e+l;case Zc.UNARY:if("Boolean"===l)return"bool("+i+")";if("Number"===l)return"float("+i+")";if("round"===l)return"floor("+i+" + 0.5)";if(Ze(sh[l]))return l+"("+i+")";if("isNaN"===l)return"("+i+" != "+i+")";if("isFinite"===l)return"(abs("+i+") < czm_infinity)";if("String"===l||"isExactClass"===l||"isClass"===l||"getExactClassName"===l)throw new de('Error generating style shader: "'+l+'" is not supported.');return Ze(sh[l])?l+"("+i+")":l+i;case Zc.BINARY:return"%"===l?"mod("+i+", "+o+")":"==="===l?"("+i+" == "+o+")":"!=="===l?"("+i+" != "+o+")":"atan2"===l?"atan("+i+", "+o+")":Ze(uh[l])?l+"("+i+", "+o+")":"("+i+" "+l+" "+o+")";case Zc.TERNARY:if(Ze(lh[l]))return l+"("+i+", "+o+", "+a+")";break;case Zc.CONDITIONAL:return"("+a+" ? "+i+" : "+o+")";case Zc.MEMBER:return"r"===o||"x"===o||"0.0"===o?i+"[0]":"g"===o||"y"===o||"1.0"===o?i+"[1]":"b"===o||"z"===o||"2.0"===o?i+"[2]":"a"===o||"w"===o||"3.0"===o?i+"[3]":i+"[int("+o+")]";case Zc.FUNCTION_CALL:throw new de('Error generating style shader: "'+l+'" is not supported.');case Zc.ARRAY:if(4===l.length)return"vec4("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")";if(3===l.length)return"vec3("+l[0]+", "+l[1]+", "+l[2]+")";if(2===l.length)return"vec2("+l[0]+", "+l[1]+")";throw new de("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case Zc.REGEX:throw new de("Error generating style shader: Regular expressions are not supported.");case Zc.VARIABLE_IN_STRING:throw new de("Error generating style shader: Converting a variable to a string is not supported.");case Zc.LITERAL_NULL:return Ah;case Zc.LITERAL_BOOLEAN:return l?"true":"false";case Zc.LITERAL_NUMBER:return Sh(l);case Zc.LITERAL_STRING:if(Ze(n)&&n._type===Zc.MEMBER&&("r"===l||"g"===l||"b"===l||"a"===l||"x"===l||"y"===l||"z"===l||"w"===l))return l;if(Ze(r=It.fromCssColorString(l,ah)))return"vec3("+Sh((s=r).red)+", "+Sh(s.green)+", "+Sh(s.blue)+")";throw new de("Error generating style shader: String literals are not supported.");case Zc.LITERAL_COLOR:var c=i;if("color"===l){if(!Ze(c))return"vec4(1.0)";if(1<c.length){var h=c[0],f=c[1];return"1.0"!==f&&(t.translucent=!0),"vec4("+h+", "+f+")"}return"vec4("+c[0]+", 1.0)"}if("rgb"===l)return Ze(r=Th(this))?Ch(r):"vec4("+c[0]+" / 255.0, "+c[1]+" / 255.0, "+c[2]+" / 255.0, 1.0)";if("rgba"===l)return"1.0"!==c[3]&&(t.translucent=!0),Ze(r=Th(this))?Ch(r):"vec4("+c[0]+" / 255.0, "+c[1]+" / 255.0, "+c[2]+" / 255.0, "+c[3]+")";if("hsl"===l)return Ze(r=Eh(this))?Ch(r):"vec4(czm_HSLToRGB(vec3("+c[0]+", "+c[1]+", "+c[2]+")), 1.0)";if("hsla"===l)return Ze(r=Eh(this))?(1!==r.alpha&&(t.translucent=!0),Ch(r)):("1.0"!==c[3]&&(t.translucent=!0),"vec4(czm_HSLToRGB(vec3("+c[0]+", "+c[1]+", "+c[2]+")), "+c[3]+")");break;case Zc.LITERAL_VECTOR:for(var p=i.length,d=l+"(",m=0;m<p;++m)d+=i[m],m<p-1&&(d+=", ");return d+=")";case Zc.LITERAL_REGEX:throw new de("Error generating style shader: Regular expressions are not supported.");case Zc.LITERAL_UNDEFINED:return Ah;case Zc.BUILTIN_VARIABLE:if("tiles3d_tileset_time"===l)return"u_time"}},Object.defineProperties(Ih.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});var Ph={position:0,a_batchId:1};function Oh(e){var t=e?vi.EQUAL:vi.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:bi.KEEP,zFail:bi.DECREMENT_WRAP,zPass:bi.DECREMENT_WRAP},backFunction:t,backOperation:{fail:bi.KEEP,zFail:bi.INCREMENT_WRAP,zPass:bi.INCREMENT_WRAP},reference:Ti.CESIUM_3D_TILE_MASK,mask:Ti.CESIUM_3D_TILE_MASK},stencilMask:Ti.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1}}function Lh(e){var t=e?vi.EQUAL:vi.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:t,frontOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.INCREMENT_WRAP},backFunction:t,backOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.DECREMENT_WRAP},reference:Ti.CESIUM_3D_TILE_MASK,mask:Ti.CESIUM_3D_TILE_MASK},stencilMask:Ti.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:kc.LESS_OR_EQUAL},depthMask:!1}}var Nh={stencilTest:{enabled:!0,frontFunction:vi.NOT_EQUAL,frontOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.DECREMENT_WRAP},backFunction:vi.NOT_EQUAL,backOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.DECREMENT_WRAP},reference:0,mask:Ti.CLASSIFICATION_MASK},stencilMask:Ti.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:ui.ALPHA_BLEND},Rh={stencilTest:{enabled:!0,frontFunction:vi.NOT_EQUAL,frontOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.DECREMENT_WRAP},backFunction:vi.NOT_EQUAL,backOperation:{fail:bi.KEEP,zFail:bi.KEEP,zPass:bi.DECREMENT_WRAP},reference:0,mask:Ti.CLASSIFICATION_MASK},stencilMask:Ti.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};var Dh=new on,Mh=new _t;function Fh(e,t,n,r,i,o,a){for(var s=e.constructor.BYTES_PER_ELEMENT,u=o.length,l=0;l<u;++l){var c=a[o[l]],h=r[c],f=i[c],p=new e.constructor(e.buffer,s*h,f);t.set(p,n),r[c]=n,n+=f}return n}function zh(e,t,n,r,i,o,a){for(var s=e.bytesPerIndex,u=o.length,l=0;l<u;++l){var c=a[o[l]],h=r[c],f=i[c];t.copyFromBuffer(e,h*s,n*s,f*s),r[c]=n,n+=f}return n}function Bh(e,t){return t.color.toRgba()-e.color.toRgba()}function Uh(e,t){if(!e._batchDirty)return!1;for(var n=e._batchedIndices,r=n.length,i=!1,o={},a=0;a<r;++a){var s=n[a].color.toRgba();if(Ze(o[s])){i=!0;break}o[s]=!0}return i?i&&!e.forceRebatch&&e._framesSinceLastRebatch<120?void++e._framesSinceLastRebatch:(n.sort(Bh),(t.webgl2?function(e,t){var n=e._indexOffsets,r=e._indexCounts,i=e._batchIdLookUp,o=t.pop(),a=[o],s=e._va.indexBuffer,u=e._vaSwap.indexBuffer,l=zh(s,u,0,n,r,o.batchIds,i);for(o.offset=0,o.count=l;0<t.length;){var c,h=t.pop();It.equals(h.color,o.color)?(l=zh(s,u,l,n,r,h.batchIds,i),o.batchIds=o.batchIds.concat(h.batchIds),o.count=l-o.offset):(l=zh(s,u,c=l,n,r,h.batchIds,i),h.offset=c,h.count=l-c,a.push(h),o=h)}var f=e._va;e._va=e._vaSwap,e._vaSwap=f,e._batchedIndices=a}:function(e,t){var n=e._indices,r=e._indexOffsets,i=e._indexCounts,o=e._batchIdLookUp,a=new n.constructor(n.length),s=t.pop(),u=[s],l=Fh(n,a,0,r,i,s.batchIds,o);for(s.offset=0,s.count=l;0<t.length;){var c,h=t.pop();It.equals(h.color,s.color)?(l=Fh(n,a,l,r,i,h.batchIds,o),s.batchIds=s.batchIds.concat(h.batchIds),s.count=l-s.offset):(l=Fh(n,a,c=l,r,i,h.batchIds,o),h.offset=c,h.count=l-c,u.push(h),s=h)}e._va.indexBuffer.copyFromArrayView(a),e._indices=a,e._batchedIndices=u})(e,n),e._framesSinceLastRebatch=0,e._batchDirty=!1,e._pickCommandsDirty=!0,e._wireframeDirty=!0):e._batchDirty=!1}Ih.prototype.createFeatures=function(e,t){for(var n=this._batchIds,r=n.length,i=0;i<r;++i){var o=n[i];t[o]=new Fo(e,o)}},Ih.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};var Vh=new It,kh=It.WHITE,Gh=/\$/;function qh(e,t,n,r){for(var i,o=e.classificationType,a=o!==Uc.CESIUM_3D_TILE,s=o!==Uc.TERRAIN,u=t.commandList,l=n.length,c=0;c<l;++c)a&&((i=n[c]).pass=yn.TERRAIN_CLASSIFICATION,u.push(i)),s&&((i=n[c].derivedCommands.tileset).pass=yn.CESIUM_3D_TILE_CLASSIFICATION,u.push(i));if(t.invertClassification&&Ze(r))for(l=r.length,c=0;c<l;++c)u.push(r[c])}Ih.prototype.applyStyle=function(e,t){if(Ze(e)){var n=e.color,r=n instanceof Jc&&!Gh.test(n.expression);this._updatingAllCommands=r;var i=this._batchIds,o=i.length;for(u=0;u<o;++u){var a=t[i[u]];a.color=Ze(e.color)?e.color.evaluateColor(a,Vh):kh,a.show=!Ze(e.show)||e.show.evaluate(a)}if(r){for(var s=this._batchedIndices,o=s.length,u=0;u<o;++u)s[u].color=It.clone(It.WHITE);this._updatingAllCommands=!1,this._batchDirty=!0}}else!function(e,t){e._updatingAllCommands=!0;for(var n=e._batchIds,r=n.length,i=0;i<r;++i){var o=t[n[i]];o.show=!0,o.color=It.WHITE}var a=e._batchedIndices,r=a.length;for(i=0;i<r;++i)a[i].color=It.clone(It.WHITE);e._updatingAllCommands=!1,e._batchDirty=!0}(this,t)},Ih.prototype.updateCommands=function(e,t){if(!this._updatingAllCommands){var n=this._batchIdLookUp,r=n[e];if(Ze(r)){for(var i=this._indexOffsets,o=this._indexCounts,a=i[r],s=o[r],u=this._batchedIndices,l=u.length,c=0;c<l;++c){var h=u[c].offset,f=u[c].count;if(h<=a&&a<h+f)break}u.push(new Sl({color:It.clone(t),offset:a,count:s,batchIds:[e]}));for(var p=[],d=[],m=u[c].batchIds,_=m.length,g=0;g<_;++g){var y=m[g];y!==e&&(i[n[y]]<a?p.push(y):d.push(y))}0!==d.length&&u.push(new Sl({color:It.clone(u[c].color),offset:a+s,count:u[c].offset+u[c].count-(a+s),batchIds:d})),0!==p.length?(u[c].count=a-u[c].offset,u[c].batchIds=p):u.splice(c,1),this._batchDirty=!0}}},Ih.prototype.update=function(e){var t,n,r,i,o,a,s,u,l,c,h=e.context;n=h,Ze((t=this)._va)||(r=Al.createVertexBuffer({context:n,typedArray:t._positions,usage:wl.STATIC_DRAW}),i=Al.createVertexBuffer({context:n,typedArray:t._vertexBatchIds,usage:wl.STATIC_DRAW}),o=Al.createIndexBuffer({context:n,typedArray:t._indices,usage:wl.DYNAMIC_DRAW,indexDatatype:2===t._indices.BYTES_PER_ELEMENT?wa.UNSIGNED_SHORT:wa.UNSIGNED_INT}),a=[{index:0,vertexBuffer:r,componentDatatype:Mt.fromTypedArray(t._positions),componentsPerAttribute:3},{index:1,vertexBuffer:i,componentDatatype:Mt.fromTypedArray(t._vertexBatchIds),componentsPerAttribute:1}],t._va=new Ac({context:n,attributes:a,indexBuffer:o}),n.webgl2&&(t._vaSwap=new Ac({context:n,attributes:a,indexBuffer:Al.createIndexBuffer({context:n,sizeInBytes:o.sizeInBytes,usage:wl.DYNAMIC_DRAW,indexDatatype:o.indexDatatype})})),t._batchedPositions=void 0,t._transferrableBatchIds=void 0,t._vertexBatchIds=void 0,t._verticesPromise=void 0),function(e,t){if(!Ze(e._sp)){var n=e._batchTable,r=Je(e._attributeLocations,Ph),i=e._pickId,o=e._vertexShaderSource,a=e._fragmentShaderSource;if(Ze(o))return e._sp=ic.fromCache({context:t,vertexShaderSource:o,fragmentShaderSource:a,attributeLocations:r}),e._spStencil=e._sp,a=(a=Xr.replaceMain(a,"czm_non_pick_main"))+"void main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = "+i+"; \n} \n",e._spPick=ic.fromCache({context:t,vertexShaderSource:o,fragmentShaderSource:a,attributeLocations:r});var s=n.getVertexShaderCallback(!1,"a_batchId",void 0)(Bc),u=n.getFragmentShaderCallback()(zc,!1,void 0),i=n.getPickId(),l=new Xr({sources:[s]}),c=new Xr({defines:["VECTOR_TILE"],sources:[u]});e._sp=ic.fromCache({context:t,vertexShaderSource:l,fragmentShaderSource:c,attributeLocations:r}),l=new Xr({sources:[Bc]}),c=new Xr({defines:["VECTOR_TILE"],sources:[zc]}),e._spStencil=ic.fromCache({context:t,vertexShaderSource:l,fragmentShaderSource:c,attributeLocations:r}),u=(u=Xr.replaceMain(u,"czm_non_pick_main"))+"\nvoid main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = "+i+"; \n} \n";var h=new Xr({sources:[s]}),f=new Xr({defines:["VECTOR_TILE"],sources:[u]});e._spPick=ic.fromCache({context:t,vertexShaderSource:h,fragmentShaderSource:f,attributeLocations:r})}}(this,h),Ze((s=this)._rsStencilPreloadPass)||(s._rsStencilPreloadPass=sr.fromCache(Oh(!1)),s._rsStencilPreloadPass3DTiles=sr.fromCache(Oh(!0)),s._rsStencilDepthPass=sr.fromCache(Lh(!1)),s._rsStencilDepthPass3DTiles=sr.fromCache(Lh(!0)),s._rsColorPass=sr.fromCache(Nh),s._rsPickPass=sr.fromCache(Rh)),l=h,Ze((u=this)._uniformMap)||(c={u_modifiedModelViewProjection:function(){var e=l.uniformState.view,t=l.uniformState.projection;return on.clone(e,Dh),on.multiplyByPoint(Dh,u._center,Mh),on.setTranslation(Dh,Mh,Dh),on.multiply(t,Dh,Dh),Dh},u_highlightColor:function(){return u._highlightColor}},u._uniformMap=u._batchTable.getUniformMapCallback()(c));var f=e.passes;f.render&&(function(e,t){var n=Uh(e,t),r=e._commands,i=e._batchedIndices,o=i.length,a=3*o;if(!Ze(r)||n||r.length!==a){r.length=a;for(var s=e._va,u=e._sp,l=Je(e._modelMatrix,on.IDENTITY),c=e._uniformMap,h=e._boundingVolume,f=0;f<o;++f){var p=i[f].offset,d=i[f].count,m=r[3*f];Ze(m)||(m=r[3*f]=new Mn({owner:e})),m.vertexArray=s,m.modelMatrix=l,m.offset=p,m.count=d,m.renderState=e._rsStencilPreloadPass,m.shaderProgram=u,m.uniformMap=c,m.boundingVolume=h,m.cull=!1,m.pass=yn.TERRAIN_CLASSIFICATION;var _=Mn.shallowClone(m,m.derivedCommands.tileset);_.renderState=e._rsStencilPreloadPass3DTiles,_.pass=yn.CESIUM_3D_TILE_CLASSIFICATION,m.derivedCommands.tileset=_;var g=r[3*f+1];Ze(g)||(g=r[3*f+1]=new Mn({owner:e})),g.vertexArray=s,g.modelMatrix=l,g.offset=p,g.count=d,g.renderState=e._rsStencilDepthPass,g.shaderProgram=u,g.uniformMap=c,g.boundingVolume=h,g.cull=!1,g.pass=yn.TERRAIN_CLASSIFICATION;var y=Mn.shallowClone(g,g.derivedCommands.tileset);y.renderState=e._rsStencilDepthPass3DTiles,y.pass=yn.CESIUM_3D_TILE_CLASSIFICATION,g.derivedCommands.tileset=y;var v=r[3*f+2];Ze(v)||(v=r[3*f+2]=new Mn({owner:e})),v.vertexArray=s,v.modelMatrix=l,v.offset=p,v.count=d,v.renderState=e._rsColorPass,v.shaderProgram=u,v.uniformMap=c,v.boundingVolume=h,v.cull=!1,v.pass=yn.TERRAIN_CLASSIFICATION;var x=Mn.shallowClone(v,v.derivedCommands.tileset);x.pass=yn.CESIUM_3D_TILE_CLASSIFICATION,v.derivedCommands.tileset=x}e._commandsDirty=!0}}(this,h),function(e,t){if(e.classificationType!==Uc.TERRAIN&&t.invertClassification&&(!Ze(e._commandsIgnoreShow)||e._commandsDirty)){for(var n=e._commands,r=e._commandsIgnoreShow,i=e._spStencil,o=n.length,a=r.length=o/3*2,s=0,u=0;u<a;u+=2){var l=r[u]=Mn.shallowClone(n[s],r[u]);l.shaderProgram=i,l.pass=yn.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,(l=r[u+1]=Mn.shallowClone(n[s+1],r[u+1])).shaderProgram=i,l.pass=yn.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,s+=3}e._commandsDirty=!1}}(this,e),function(e){var t,n;if(!(e.debugWireframe===e._debugWireframe&&!(e.debugWireframe&&e._wireframeDirty))){Ze(e._rsWireframe)||(e._rsWireframe=sr.fromCache({})),n=e.debugWireframe?(t=e._rsWireframe,Dn.LINES):(t=e._rsColorPass,Dn.TRIANGLES);for(var r=e._commands,i=r.length,o=0;o<i;o+=3){var a=r[o+2];a.renderState=t,a.primitiveType=n}e._debugWireframe=e.debugWireframe,e._wireframeDirty=!1}}(this),this._debugWireframe?function(e,t){for(var n=e.commandList,r=t.length,i=0;i<r;i+=3){var o=t[i+2];o.pass=yn.OPAQUE,n.push(o)}}(e,this._commands):qh(this,e,this._commands,this._commandsIgnoreShow)),f.pick&&(function(e){if(e._pickCommandsDirty){var t=e._indexOffsets.length,n=e._pickCommands;n.length=3*t;for(var r=e._va,i=e._spStencil,o=e._spPick,a=Je(e._modelMatrix,on.IDENTITY),s=e._uniformMap,u=0;u<t;++u){var l=e._indexOffsets[u],c=e._indexCounts[u],h=Ze(e._boundingVolumes)?e._boundingVolumes[u]:e.boundingVolume,f=n[3*u];Ze(f)||(f=n[3*u]=new Mn({owner:e,pickOnly:!0})),f.vertexArray=r,f.modelMatrix=a,f.offset=l,f.count=c,f.renderState=e._rsStencilPreloadPass,f.shaderProgram=i,f.uniformMap=s,f.boundingVolume=h,f.pass=yn.TERRAIN_CLASSIFICATION;var p=Mn.shallowClone(f,f.derivedCommands.tileset);p.renderState=e._rsStencilPreloadPass3DTiles,p.pass=yn.CESIUM_3D_TILE_CLASSIFICATION,f.derivedCommands.tileset=p;var d=n[3*u+1];Ze(d)||(d=n[3*u+1]=new Mn({owner:e,pickOnly:!0})),d.vertexArray=r,d.modelMatrix=a,d.offset=l,d.count=c,d.renderState=e._rsStencilDepthPass,d.shaderProgram=i,d.uniformMap=s,d.boundingVolume=h,d.pass=yn.TERRAIN_CLASSIFICATION;var m=Mn.shallowClone(d,d.derivedCommands.tileset);m.renderState=e._rsStencilDepthPass3DTiles,m.pass=yn.CESIUM_3D_TILE_CLASSIFICATION,d.derivedCommands.tileset=m;var _=n[3*u+2];Ze(_)||(_=n[3*u+2]=new Mn({owner:e,pickOnly:!0})),_.vertexArray=r,_.modelMatrix=a,_.offset=l,_.count=c,_.renderState=e._rsPickPass,_.shaderProgram=o,_.uniformMap=s,_.boundingVolume=h,_.pass=yn.TERRAIN_CLASSIFICATION;var g=Mn.shallowClone(_,_.derivedCommands.tileset);g.pass=yn.CESIUM_3D_TILE_CLASSIFICATION,_.derivedCommands.tileset=g}e._pickCommandsDirty=!1}}(this),qh(this,e,this._pickCommands))},Ih.prototype.isDestroyed=function(){return!1},Ih.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaSwap=this._vaSwap&&this._vaSwap.destroy(),Vt(this)};var Hh=new _t,Wh=Hu.ModelState;function Yh(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).gltf;if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),!(t instanceof Uint8Array))throw new de("Only binary glTF is supported as a classifier.");Du(t=_u(t)),lu(t),pl(t),ml(t),au.buffer(t,function(e){if(!Ze(e.extras._pipeline.source))throw new de("Buffer data must be embedded in the binary gltf.")});var n=t.nodes,r=t.meshes,i=n[0].mesh;if(1!==n.length||!Ze(i))throw new de("Only one node is supported for classification and it must have a mesh.");if(1!==r.length)throw new de("Only one mesh is supported when using b3dm for classification.");var o=r[0].primitives;if(1!==o.length)throw new de("Only one primitive per mesh is supported when using b3dm for classification.");if(!Ze(o[0].attributes.POSITION))throw new de("The mesh must have a position attribute.");if(!Ze(o[0].attributes._BATCHID))throw new de("The mesh must have a batch id attribute.");this._gltf=t,this.show=Je(e.show,!0),this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this._modelMatrix=on.clone(this.modelMatrix),this._ready=!1,this._readyPromise=D.defer(),this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Je(e.debugWireframe,!1),this._debugWireframe=!1,this._classificationType=e.classificationType,this._vertexShaderLoaded=e.vertexShaderLoaded,this._classificationShaderLoaded=e.classificationShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=Je(e.ignoreCommands,!1),this._upAxis=Je(e.upAxis,xn.Y),this._batchTable=e.batchTable,this._computedModelMatrix=new on,this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new ko,this._state=Wh.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._dirty=!1,this._nodeMatrix=new on,this._primitive=void 0,this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms=void 0,this._buffers={},this._vertexArray=void 0,this._shaderProgram=void 0,this._uniformMap=void 0,this._geometryByteLength=0,this._trianglesLength=0,this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0}function Xh(e,t){return Ze(t)&&(e=t(e)),e}function jh(e){var t=e.gltf,n=Hu.getAttributeOrUniformBySemantic(t,"POSITION"),r=Hu.getAttributeOrUniformBySemantic(t,"_BATCHID"),i={};i[n]=0,i[r]=1;var o,a,s,u,l,c,h,f=Hu.getAttributeOrUniformBySemantic(t,"MODELVIEWPROJECTION"),p=Ze(f)?(o="uniform mat4 "+f+";\n",f+" * vec4("+n+", 1.0)"):(a=Hu.getAttributeOrUniformBySemantic(t,"PROJECTION"),Ze(s=Hu.getAttributeOrUniformBySemantic(t,"MODELVIEW"))||(s=Hu.getAttributeOrUniformBySemantic(t,"CESIUM_RTC_MODELVIEW")),o="uniform mat4 "+s+";\nuniform mat4 "+a+";\n",a+" * "+s+" * vec4("+n+", 1.0)"),d="attribute vec3 "+n+";\nattribute float "+r+";\n"+o+"void main() {\n"+("    vec4 positionInClipCoords = "+p+";\n")+"    gl_Position = czm_depthClampFarPlane(positionInClipCoords);\n}\n";e.extensionsUsed.WEB3D_quantized_attributes&&(u=d,c=(l=e).gltf.meshes[0].primitives[0],h=Hu.modifyShaderForQuantizedAttributes(l.gltf,c,u),l._quantizedUniforms=h.uniforms,d=h.shader);var m=Xh(d,e._vertexShaderLoaded),_=Xh("#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeDepthClampedToFarPlane();\n}\n",e._classificationShaderLoaded),m=Hu.modifyVertexShaderForLogDepth(m,p),_=Hu.modifyFragmentShaderForLogDepth(_);e._shaderProgram={vertexShaderSource:m,fragmentShaderSource:_,attributeLocations:i}}Object.defineProperties(Yh.prototype,{gltf:{get:function(){return this._gltf}},boundingSphere:{get:function(){var e=this.modelMatrix,t=on.getScale(e,Hh),n=this._scaledBoundingSphere;return n.center=_t.multiplyComponents(this._boundingSphere.center,t,n.center),n.radius=_t.maximumComponent(t)*this._initialRadius,Ze(this._rtcCenter)&&_t.add(this._rtcCenter,n.center,n.center),n}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},dirty:{get:function(){return this._dirty}},extensionsUsed:{get:function(){return Ze(this._extensionsUsed)||(this._extensionsUsed=Hu.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Ze(this._extensionsRequired)||(this._extensionsRequired=Hu.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return 0}},classificationType:{get:function(){return this._classificationType}}});var Kh={PROJECTION:function(e,t){return Hu.getGltfSemanticUniforms().PROJECTION(e,t)},MODELVIEW:function(e,t){return Hu.getGltfSemanticUniforms().MODELVIEW(e,t)},CESIUM_RTC_MODELVIEW:function(e,t){return Hu.getGltfSemanticUniforms().CESIUM_RTC_MODELVIEW(e,t)},MODELVIEWPROJECTION:function(e,t){return Hu.getGltfSemanticUniforms().MODELVIEWPROJECTION(e,t)}};function Qh(e){var t,n,r,i,o=e._batchTable,a=e._uniformMap,s=e._vertexArray,u=e.gltf,l=u.accessors,c=u.meshes[0].primitives[0],h=l[c.indices],f=c.attributes.POSITION,p=Hu.getAccessorMinMax(u,f),d=ko.fromCornerPoints(_t.fromArray(p.min),_t.fromArray(p.max));n=Ze(h)?(t=h.count,h.byteOffset/wa.getSizeInBytes(h.componentType)):(t=l[c.attributes.POSITION].count,0),e._trianglesLength+=function(e,t){switch(e.mode){case Dn.TRIANGLES:return t/3;case Dn.TRIANGLE_STRIP:case Dn.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}(c,t),Ze(e._uniformMapLoaded)&&(a=e._uniformMapLoaded(a)),e.extensionsUsed.WEB3D_quantized_attributes&&(a=ne(a,(r=e,i=c,Hu.createUniformsForQuantizedAttributes(r.gltf,i,r._quantizedUniforms))));var m,_,g,y=s.attributes.POSITION,v=y.componentDatatype,x=y.vertexBuffer,b=x.byteOffset,E=x.byteLength/Mt.getSizeInBytes(v),T=Mt.createArrayBufferView(v,x.buffer,b,E),v=(y=s.attributes._BATCHID).componentDatatype,b=(x=y.vertexBuffer).byteOffset,E=x.byteLength/Mt.getSizeInBytes(v),S=Mt.createArrayBufferView(v,x.buffer,b,E),C=s.indexBuffer.typedArray,w=s.indexBuffer.indexDatatype===wa.UNSIGNED_SHORT?new Uint16Array(C.buffer,C.byteOffset,C.byteLength/Uint16Array.BYTES_PER_ELEMENT):new Uint32Array(C.buffer,C.byteOffset,C.byteLength/Uint32Array.BYTES_PER_ELEMENT),T=Uo(T),A=[],I=[],P=[],O=[],L=(S=Uo(S))[(w=Uo(w,n,n+t))[0]];A.push(L),P.push(0);for(var N=w.length,R=1;R<N;++R)(m=S[w[R]])!==L&&(g=R-(_=P[P.length-1]),A.push(m),I.push(g),P.push(R),O.push(new Sl({offset:_,count:g,batchIds:[L],color:It.WHITE})),L=m);g=N-(_=P[P.length-1]),I.push(g),O.push(new Sl({offset:_,count:g,batchIds:[L],color:It.WHITE}));var D=e._shaderProgram,M=D.vertexShaderSource,F=D.fragmentShaderSource,z=D.attributeLocations,B=Ze(e._pickIdLoaded)?e._pickIdLoaded():void 0;e._primitive=new Ih({classificationType:e._classificationType,positions:T,indices:w,indexOffsets:P,indexCounts:I,batchIds:A,vertexBatchIds:S,batchedIndices:O,batchTable:o,boundingVolume:new ko,_vertexShaderSource:M,_fragmentShaderSource:F,_attributeLocations:z,_uniformMap:a,_pickId:B,_modelMatrix:new on,_boundingSphere:d}),e._buffers=void 0,e._vertexArray=void 0,e._shaderProgram=void 0,e._uniformMap=void 0}function Zh(e,t){var n,i,o,a,r,s,u,l,c,h,f,p,d,m,_=t.context;Hu.checkSupportedGlExtensions(e.gltf.glExtensionsUsed,_),function(e){var t=e._loadResources;if(0===t.pendingBufferLoads){for(var n,r,i,o,a,s,u,l,c,h,f,p=t.vertexBuffersToCreate,d=t.indexBuffersToCreate;0<p.length;)n=p.dequeue(),i=void 0,i=(r=e)._loadResources,o=r.gltf.bufferViews[n],a=i.getBuffer(o),r._buffers[n]=a,r._geometryByteLength+=a.byteLength;for(;0<d.length;){var m=d.dequeue();s=m.id,u=m.componentType,c=void 0,c=(l=e)._loadResources,h=l.gltf.bufferViews[s],f={typedArray:c.getBuffer(h),indexDatatype:u},l._buffers[s]=f,l._geometryByteLength+=f.typedArray.byteLength}}}(e),jh(e),(n=e)._loadResources.finishedBuffersCreation()&&!Ze(n._vertexArray)&&(i=n._buffers,o=n.gltf,a=o.accessors,r=o.meshes[0].primitives[0],s={POSITION:0,_BATCHID:1},u={},au.meshPrimitiveAttribute(r,function(e,t){var n,r=s[t];Ze(r)&&(n=a[e],u[t]={index:r,vertexBuffer:i[n.bufferView],componentsPerAttribute:su(n.type),componentDatatype:n.componentType,offsetInBytes:n.byteOffset,strideInBytes:uu(o,n)})}),Ze(r.indices)&&(l=a[r.indices],c=i[l.bufferView]),n._vertexArray={attributes:u,indexBuffer:c}),f=_,Ze((h=e)._uniformMap)||(p={},au.technique(h.gltf,function(e){au.techniqueUniform(e,function(e,t){Ze(e.semantic)&&Ze(Kh[e.semantic])&&(p[t]=Kh[e.semantic](f.uniformState,h))})}),h._uniformMap=p),(d=e)._loadResources.finished()&&(Ze(d._primitive)||(m=d.gltf.nodes[0],d._nodeMatrix=Hu.getTransform(m,d._nodeMatrix),Qh(d)))}var Jh=new qt,$h=new on;Yh.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},Yh.prototype.update=function(e){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m,_,g;e.mode!==Tl.MORPHING&&(et.supportsWebP.initialized?(t=et.supportsWebP(),this._state===Wh.NEEDS_LOAD&&Ze(this.gltf)&&(this._state=Wh.LOADING,this._state!==Wh.FAILED&&(Ze(n=this.gltf.extensions)&&Ze(n.CESIUM_RTC)&&(r=_t.fromArray(n.CESIUM_RTC.center),_t.equals(r,_t.ZERO)||(this._rtcCenter3D=r,o=(i=e.mapProjection).ellipsoid.cartesianToCartographic(this._rtcCenter3D),a=i.project(o),_t.fromElements(a.z,a.x,a.y,a),this._rtcCenter2D=a,this._rtcCenterEye=new _t,this._rtcCenter=this._rtcCenter3D)),this._loadResources=new qu,Hu.parseBuffers(this))),s=this._loadResources,u=!1,this._state===Wh.LOADING&&(0===s.pendingBufferLoads&&(Hu.checkSupportedExtensions(this.extensionsRequired,t),c=(l=this).gltf,h=l._loadResources,au.buffer(c,function(e,t){h.buffers[t]=e.extras._pipeline.source}),function(e){var n=e.gltf.bufferViews,r=e._loadResources.vertexBuffersToCreate;au.bufferView(e.gltf,function(e,t){e.target===Rt.ARRAY_BUFFER&&r.enqueue(t)});var i=e._loadResources.indexBuffersToCreate,o={};au.accessor(e.gltf,function(e){var t=e.bufferView;n[t].target!==Rt.ELEMENT_ARRAY_BUFFER||Ze(o[t])||(o[t]=!0,i.enqueue({id:t,componentType:e.componentType}))})}(this),this._boundingSphere=Hu.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,Zh(this,e)),s.finished()&&(this._state=Wh.LOADED,u=!0)),Ze(s)&&this._state===Wh.LOADED&&(u||Zh(this,e),s.finished()&&(this._loadResources=void 0)),((f=this.show)&&this._state===Wh.LOADED||u)&&(this._dirty=!1,p=this.modelMatrix,d=e.mode!==this._mode,this._mode=e.mode,((m=!on.equals(this._modelMatrix,p)||d)||u)&&(on.clone(p,this._modelMatrix),_=this._computedModelMatrix,on.clone(p,_),this._upAxis===xn.Y?on.multiplyTransformation(_,xn.Y_UP_TO_Z_UP,_):this._upAxis===xn.X&&on.multiplyTransformation(_,xn.X_UP_TO_Z_UP,_)),(m||u)&&(function(e,t,n,r){var i,o,a,s=e._computedModelMatrix;e._mode===Tl.SCENE3D||e._ignoreCommands||(i=on.getColumn(s,3,Jh),qt.equals(i,qt.UNIT_W)?(o=e.boundingSphere.center,a=bs.wgs84To2DModelMatrix(r,o,$h),s=on.multiply(a,s,$h),Ze(e._rtcCenter)&&(on.setTranslation(s,qt.UNIT_W,s),e._rtcCenter=e._rtcCenter2D)):(s=bs.basisTo2D(r,s,$h),e._rtcCenter=e._rtcCenter3D));var u=e._primitive;(t||n)&&(on.multiplyTransformation(s,e._nodeMatrix,u._modelMatrix),ko.transform(u._boundingSphere,u._modelMatrix,u._boundingVolume),Ze(e._rtcCenter)&&_t.add(e._rtcCenter,u._boundingVolume.center,u._boundingVolume.center))}(this,m,u,e.mapProjection),this._dirty=!0)),u?(g=this,e.afterRender.push(function(){g._ready=!0,g._readyPromise.resolve(g)})):f&&!this._ignoreCommands&&(this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.debugWireframe=this.debugWireframe,this._primitive.update(e))):et.supportsWebP.initialize())},Yh.prototype.isDestroyed=function(){return!1},Yh.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Vt(this)};var ef=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"],tf=["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"],nf=["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"],rf=["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"],of=["#text"],af=["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","crossorigin","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","integrity","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns"],sf=["accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"],uf=["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"],lf=["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"];function cf(e,t){for(var n=t.length;n--;)"string"==typeof t[n]&&(t[n]=t[n].toLowerCase()),e[t[n]]=!0;return e}function hf(e){var t={},n=void 0;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}var ff=/\{\{[\s\S]*|[\s\S]*\}\}/gm,pf=/<%[\s\S]*|[\s\S]*%>/gm,df=/^data-[\-\w.\u00B7-\uFFFF]/,mf=/^aria-[\-\w]+$/,_f=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,gf=/^(?:\w+script|data):/i,yf=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,vf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function xf(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var bf=function(){return"undefined"==typeof window?null:window};var Ef=function t(e){function h(e){return t(e)}var u=0<arguments.length&&void 0!==e?e:bf();if(h.version="1.0.8",h.removed=[],!u||!u.document||9!==u.document.nodeType)return h.isSupported=!1,h;var n,l=u.document,o=!1,a=!1,s=u.document,c=u.DocumentFragment,r=u.HTMLTemplateElement,f=u.Node,i=u.NodeFilter,p=u.NamedNodeMap,d=void 0===p?u.NamedNodeMap||u.MozNamedAttrMap:p,m=u.Text,_=u.Comment,g=u.DOMParser;"function"!=typeof r||(n=s.createElement("template")).content&&n.content.ownerDocument&&(s=n.content.ownerDocument);var y=s.implementation,v=s.createNodeIterator,x=s.getElementsByTagName,b=s.createDocumentFragment,E=l.importNode,T={};h.isSupported=y&&void 0!==y.createHTMLDocument&&9!==s.documentMode;function S(e){"object"!==(void 0===e?"undefined":vf(e))&&(e={}),M="ALLOWED_TAGS"in e?cf({},e.ALLOWED_TAGS):F,z="ALLOWED_ATTR"in e?cf({},e.ALLOWED_ATTR):B,U="FORBID_TAGS"in e?cf({},e.FORBID_TAGS):{},V="FORBID_ATTR"in e?cf({},e.FORBID_ATTR):{},te="USE_PROFILES"in e&&e.USE_PROFILES,k=!1!==e.ALLOW_ARIA_ATTR,G=!1!==e.ALLOW_DATA_ATTR,q=e.ALLOW_UNKNOWN_PROTOCOLS||!1,H=e.SAFE_FOR_JQUERY||!1,W=e.SAFE_FOR_TEMPLATES||!1,Y=e.WHOLE_DOCUMENT||!1,K=e.RETURN_DOM||!1,Q=e.RETURN_DOM_FRAGMENT||!1,Z=e.RETURN_DOM_IMPORT||!1,j=e.FORCE_BODY||!1,J=!1!==e.SANITIZE_DOM,$=!1!==e.KEEP_CONTENT,ee=e.IN_PLACE||!1,D=e.ALLOWED_URI_REGEXP||D,W&&(G=!1),Q&&(K=!0),te&&(M=cf({},[].concat(xf(of))),z=[],!0===te.html&&(cf(M,ef),cf(z,af)),!0===te.svg&&(cf(M,tf),cf(z,sf),cf(z,lf)),!0===te.svgFilters&&(cf(M,nf),cf(z,sf),cf(z,lf)),!0===te.mathMl&&(cf(M,rf),cf(z,uf),cf(z,lf))),e.ADD_TAGS&&(M===F&&(M=hf(M)),cf(M,e.ADD_TAGS)),e.ADD_ATTR&&(z===B&&(z=hf(z)),cf(z,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&cf(ie,e.ADD_URI_SAFE_ATTR),$&&(M["#text"]=!0),Y&&cf(M,["html","head","body"]),M.table&&cf(M,["tbody"]),Object&&"freeze"in Object&&Object.freeze(e),oe=e}function C(t){h.removed.push({element:t});try{t.parentNode.removeChild(t)}catch(e){t.outerHTML=""}}function w(e,t){try{h.removed.push({attribute:t.getAttributeNode(e),from:t})}catch(e){h.removed.push({attribute:null,from:t})}t.removeAttribute(e)}function A(e){var t,n,r=void 0,i=void 0;if(j?e="<remove></remove>"+e:(i=(t=e.match(/^[\s]+/))&&t[0])&&(e=e.slice(i.length)),o)try{r=(new g).parseFromString(e,"text/html")}catch(e){}return a&&cf(U,["title"]),r&&r.documentElement||((n=(r=y.createHTMLDocument("")).body).parentNode.removeChild(n.parentNode.firstElementChild),n.outerHTML=e),i&&r.body.insertBefore(s.createTextNode(i),r.body.childNodes[0]||null),x.call(r,Y?"html":"body")[0]}var I=ff,P=pf,O=df,L=mf,N=gf,R=yf,D=_f,M=null,F=cf({},[].concat(xf(ef),xf(tf),xf(nf),xf(rf),xf(of))),z=null,B=cf({},[].concat(xf(af),xf(sf),xf(uf),xf(lf))),U=null,V=null,k=!0,G=!0,q=!1,H=!1,W=!1,Y=!1,X=!1,j=!1,K=!1,Q=!1,Z=!1,J=!0,$=!0,ee=!1,te={},ne=cf({},["audio","head","math","script","style","template","svg","video"]),re=cf({},["audio","video","img","source","image"]),ie=cf({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),oe=null,ae=s.createElement("form");h.isSupported&&(function(){try{A('<svg><p><style><img src="</style><img src=x onerror=alert(1)//">').querySelector("svg img")&&(o=!0)}catch(e){}}(),function(){try{A("<x/><title>&lt;/title&gt;&lt;img&gt;").querySelector("title").textContent.match(/<\/title/)&&(a=!0)}catch(e){}}());function se(e){return v.call(e.ownerDocument||e,e,i.SHOW_ELEMENT|i.SHOW_COMMENT|i.SHOW_TEXT,function(){return i.FILTER_ACCEPT},!1)}function ue(e){return"object"===(void 0===f?"undefined":vf(f))?e instanceof f:e&&"object"===(void 0===e?"undefined":vf(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function le(e,t,n){T[e]&&T[e].forEach(function(e){e.call(h,t,n,oe)})}function ce(e){var t,n=void 0;if(le("beforeSanitizeElements",e,null),!((t=e)instanceof m||t instanceof _||"string"==typeof t.nodeName&&"string"==typeof t.textContent&&"function"==typeof t.removeChild&&t.attributes instanceof d&&"function"==typeof t.removeAttribute&&"function"==typeof t.setAttribute))return C(e),1;var r=e.nodeName.toLowerCase();if(le("uponSanitizeElement",e,{tagName:r,allowedTags:M}),M[r]&&!U[r])return!H||e.firstElementChild||e.content&&e.content.firstElementChild||!/</g.test(e.textContent)||(h.removed.push({element:e.cloneNode()}),e.innerHTML?e.innerHTML=e.innerHTML.replace(/</g,"&lt;"):e.innerHTML=e.textContent.replace(/</g,"&lt;")),W&&3===e.nodeType&&(n=(n=(n=e.textContent).replace(I," ")).replace(P," "),e.textContent!==n&&(h.removed.push({element:e.cloneNode()}),e.textContent=n)),le("afterSanitizeElements",e,null),0;if($&&!ne[r]&&"function"==typeof e.insertAdjacentHTML)try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(e){}return C(e),1}function he(e,t,n){if(J&&("id"===t||"name"===t)&&(n in s||n in ae))return!1;if(W&&(n=(n=n.replace(I," ")).replace(P," ")),!(G&&O.test(t)||k&&L.test(t))){if(!z[t]||V[t])return!1;if(!ie[t]&&!D.test(n.replace(R,""))&&("src"!==t&&"xlink:href"!==t||"script"===e||0!==n.indexOf("data:")||!re[e])&&(!q||N.test(n.replace(R,"")))&&n)return!1}return!0}function fe(e){var t=void 0,n=void 0,r=void 0,i=void 0,o=void 0;le("beforeSanitizeAttributes",e,null);var a=e.attributes;if(a){for(var s={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:z},o=a.length;o--;){var u=(t=a[o]).name,l=t.namespaceURI,n=t.value.trim(),r=u.toLowerCase();if(s.attrName=r,s.attrValue=n,s.keepAttr=!0,le("uponSanitizeAttribute",e,s),n=s.attrValue,"name"===r&&"IMG"===e.nodeName&&a.id)i=a.id,a=Array.prototype.slice.apply(a),w("id",e),w(u,e),a.indexOf(i)>o&&e.setAttribute("id",i.value);else{if("INPUT"===e.nodeName&&"type"===r&&"file"===n&&(z[r]||!V[r]))continue;"id"===u&&e.setAttribute(u,""),w(u,e)}if(s.keepAttr){var c=e.nodeName.toLowerCase();if(he(c,r,n))try{l?e.setAttributeNS(l,u,n):e.setAttribute(u,n),h.removed.pop()}catch(e){}}}le("afterSanitizeAttributes",e,null)}}function pe(e){var t=void 0,n=se(e);for(le("beforeSanitizeShadowDOM",e,null);t=n.nextNode();)le("uponSanitizeShadowNode",t,null),ce(t)||(t.content instanceof c&&pe(t.content),fe(t));le("afterSanitizeShadowDOM",e,null)}return h.sanitize=function(e,t){var n=void 0,r=void 0,i=void 0,o=void 0,a=void 0;if("string"!=typeof(e=e||"\x3c!--\x3e")&&!ue(e)){if("function"!=typeof e.toString)throw new TypeError("toString is not a function");if("string"!=typeof(e=e.toString()))throw new TypeError("dirty is not a string, aborting")}if(!h.isSupported){if("object"===vf(u.toStaticHTML)||"function"==typeof u.toStaticHTML){if("string"==typeof e)return u.toStaticHTML(e);if(ue(e))return u.toStaticHTML(e.outerHTML)}return e}if(X||S(t),h.removed=[],!ee)if(e instanceof f)1===(r=(n=A("\x3c!--\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===r.nodeName?n=r:n.appendChild(r);else{if(!K&&!Y&&-1===e.indexOf("<"))return e;if(!(n=A(e)))return K?null:""}n&&j&&C(n.firstChild);for(var s=se(ee?e:n);i=s.nextNode();)3===i.nodeType&&i===o||ce(i)||(i.content instanceof c&&pe(i.content),fe(i),o=i);if(ee)return e;if(K){if(Q)for(a=b.call(n.ownerDocument);n.firstChild;)a.appendChild(n.firstChild);else a=n;return Z&&(a=E.call(l,a,!0)),a}return Y?n.outerHTML:n.innerHTML},h.setConfig=function(e){S(e),X=!0},h.clearConfig=function(){oe=null,X=!1},h.isValidAttribute=function(e,t,n){oe||S({});var r=e.toLowerCase(),i=t.toLowerCase();return he(r,i,n)},h.addHook=function(e,t){"function"==typeof t&&(T[e]=T[e]||[],T[e].push(t))},h.removeHook=function(e){T[e]&&T[e].pop()},h.removeHooks=function(e){T[e]&&(T[e]=[])},h.removeAllHooks=function(){T={}},h}(),Tf=0,Sf={};function Cf(e,t){var n;Ze(Sf[e])?n=Sf[e]:(n=Tf++,Sf[e]=n),t=Je(t,!1),this._id=n,this._html=e,this._showOnScreen=t,this._element=void 0}function wf(e,t){e=Je(e,0),this._near=e,t=Je(t,Number.MAX_VALUE),this._far=t}function Af(e,t,n,r){this._format=e,this._width=t,this._height=n,this._buffer=r}function If(){if(!Ze(Df._canTransferArrayBuffer)){var r=new Worker(Nf("Workers/transferTypedArrayTest.js"));r.postMessage=Je(r.webkitPostMessage,r.postMessage);var e=new Int8Array([99]);try{r.postMessage({array:e},[e.buffer])}catch(e){return Df._canTransferArrayBuffer=!1}var i=D.defer();r.onmessage=function(e){var t=e.data.array,n=Ze(t)&&99===t[0];i.resolve(n),r.terminate(),Df._canTransferArrayBuffer=n},Df._canTransferArrayBuffer=i.promise}return Df._canTransferArrayBuffer}Object.defineProperties(Cf.prototype,{html:{get:function(){return this._html}},id:{get:function(){return this._id}},showOnScreen:{get:function(){return this._showOnScreen}},element:{get:function(){if(!Ze(this._element)){var e=Ef.sanitize(this._html),t=document.createElement("div");t._creditId=this._id,t.style.display="inline",t.innerHTML=e;for(var n=t.querySelectorAll("a"),r=0;r<n.length;r++)n[r].setAttribute("target","_blank");this._element=t}return this._element}}}),Cf.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e._id===t._id},Cf.prototype.equals=function(e){return Cf.equals(this,e)},Cf.getIonCredit=function(e){var t=Ze(e.collapsible)&&!e.collapsible,n=new Cf(e.html,t);return n._isIon=-1!==n.html.indexOf("ion-credit.png"),n},Cf.clone=function(e){if(Ze(e))return new Cf(e.html,e.showOnScreen)},Object.defineProperties(wf.prototype,{near:{get:function(){return this._near},set:function(e){this._near=e}},far:{get:function(){return this._far},set:function(e){this._far=e}}}),wf.packedLength=2,wf.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.near,t[n]=e.far,t},wf.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new wf),n.near=e[t++],n.far=e[t],n},wf.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.near===t.near&&e.far===t.far},wf.clone=function(e,t){if(Ze(e))return Ze(t)||(t=new wf),t.near=e.near,t.far=e.far,t},wf.prototype.clone=function(e){return wf.clone(this,e)},wf.prototype.equals=function(e){return wf.equals(this,e)},Object.defineProperties(Af.prototype,{internalFormat:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}}),Af.clone=function(e){if(Ze(e))return new Af(e._format,e._width,e._height,e._buffer)},Af.prototype.clone=function(){return Af.clone(this)};var Pf,Of=new U;function Lf(e,t){--e._activeTasks;var n,r,i,o=t.id;Ze(o)&&(r=(n=e._deferreds)[o],Ze(t.error)?("RuntimeError"===(i=t.error).name?(i=new de(t.error.message)).stack=t.error.stack:"DeveloperError"===i.name&&((i=new fe(t.error.message)).stack=t.error.stack),Of.raiseEvent(i),r.reject(i)):(Of.raiseEvent(),r.resolve(t.result)),delete n[o])}function Nf(e){if(O(i=ms(e))){var t,n='importScripts("'+i+'");';try{t=new Blob([n],{type:"application/javascript"})}catch(e){var r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);r.append(n),t=r.getBlob("application/javascript")}var i=(window.URL||window.webkitURL).createObjectURL(t)}return i}function Rf(t){var e=new Worker((Ze(Pf)||(Pf=Nf("Workers/cesiumWorkerBootstrapper.js")),Pf));e.postMessage=Je(e.webkitPostMessage,e.postMessage);var n={loaderConfig:{paths:{Workers:ms("Workers")},baseUrl:ms.getCesiumBaseUrl().url},workerModule:Df._workerModulePrefix+t._workerName};return e.postMessage(n),e.onmessage=function(e){Lf(t,e.data)},e}function Df(e,t){this._workerName=e,this._maximumActiveTasks=Je(t,5),this._activeTasks=0,this._deferreds={},this._nextID=0}var Mf=[];Df.prototype.scheduleTask=function(r,i){if(Ze(this._worker)||(this._worker=Rf(this)),!(this._activeTasks>=this._maximumActiveTasks)){++this._activeTasks;var o=this;return D(If(),function(e){Ze(i)?e||(i.length=0):i=Mf;var t=o._nextID++,n=D.defer();return o._deferreds[t]=n,o._worker.postMessage({id:t,parameters:r,canTransferArrayBuffer:e},i),n.promise})}},Df.prototype.initWebAssemblyModule=function(e){Ze(this._worker)||(this._worker=Rf(this));var i=D.defer(),o=this,a=this._worker;return function(e,t){var n={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(et.supportsWebAssembly())return n.modulePath=ms(t.modulePath),n.wasmBinaryFile=ms(t.wasmBinaryFile),rt.fetchArrayBuffer({url:n.wasmBinaryFile}).then(function(e){return n.wasmBinary=e,n});if(!Ze(t.fallbackModulePath))throw new de("This browser does not support Web Assembly, and no backup module was provided for "+e._workerName);return n.modulePath=ms(t.fallbackModulePath),D.resolve(n)}(this,e).then(function(r){return D(If(),function(e){var t,n=r.wasmBinary;Ze(n)&&e&&(t=[n]),a.onmessage=function(e){a.onmessage=function(e){Lf(o,e.data)},i.resolve(e.data)},a.postMessage({webAssemblyConfig:r},t)})}),i},Df.prototype.isDestroyed=function(){return!1},Df.prototype.destroy=function(){return Ze(this._worker)&&this._worker.terminate(),Vt(this)},Df.taskCompletedEvent=Of,Df._workerModulePrefix=Df._defaultWorkerModulePrefix="Workers/",Df._canTransferArrayBuffer=void 0;var Ff=new Df("transcodeCRNToDXT",Number.POSITIVE_INFINITY);function zf(e){var t;if(Ze(t=e instanceof ArrayBuffer||ArrayBuffer.isView(e)?D.resolve(e):rt.createIfNeeded(e).fetchArrayBuffer()))return t.then(function(e){if(Ze(e)){var t=[];return e instanceof ArrayBuffer?t.push(e):(0===e.byteOffset&&e.byteLength===e.buffer.byteLength||(e=e.slice(0,e.length)),t.push(e.buffer)),Ff.scheduleTask(e,t)}}).then(function(e){return Af.clone(e)})}function Bf(e){var t,n=e.uint8Array,r=e.format,i=e.request,o=Je(e.flipY,!1),a=new Blob([n],{type:r});return rt.supportsImageBitmapOptions().then(function(e){return e?D(rt.createImageBitmapFromBlob(a,{flipY:o,premultiplyAlpha:!1})):new rt({url:t=window.URL.createObjectURL(a),request:i}).fetchImage({flipY:o})}).then(function(e){return Ze(t)&&window.URL.revokeObjectURL(t),e}).otherwise(function(e){return Ze(t)&&window.URL.revokeObjectURL(t),D.reject(e)})}function Uf(e){var t;if(Ze(t=e instanceof ArrayBuffer||ArrayBuffer.isView(e)?D.resolve(e):rt.createIfNeeded(e).fetchArrayBuffer()))return t.then(function(e){if(Ze(e))return function(e){var t,n,r,i=new Uint8Array(e),o=!0;for(t=0;t<Vf.length;++t)if(Vf[t]!==i[t]){o=!1;break}if(!o)throw new de("Invalid KTX file.");r=Ze(e.buffer)?(n=new DataView(e.buffer),e.byteOffset):(n=new DataView(e),0);r+=12;var a=n.getUint32(r,!0);if(r+=qf,a!==kf)throw new de("File is the wrong endianness.");var s=n.getUint32(r,!0);r+=qf;var u=n.getUint32(r,!0);r+=qf;var l=n.getUint32(r,!0);r+=qf;var c=n.getUint32(r,!0);r+=qf;var h=n.getUint32(r,!0);r+=qf;var f=n.getUint32(r,!0);r+=qf;var p=n.getUint32(r,!0);r+=qf;var d=n.getUint32(r,!0);r+=qf;var m=n.getUint32(r,!0);r+=qf;var _=n.getUint32(r,!0);r+=qf;var g=n.getUint32(r,!0);r+=qf;var y=n.getUint32(r,!0);r+=qf,r+=y;var v,x=n.getUint32(r,!0);r+=qf,v=Ze(e.buffer)?new Uint8Array(e.buffer,r,x):new Uint8Array(e,r,x);c===Rt.RGB8?c=Ln.RGB:c===Rt.RGBA8&&(c=Ln.RGBA);if(!Ln.validate(c))throw new de("glInternalFormat is not a valid format.");if(Ln.isCompressedFormat(c)){if(0!==s)throw new de("glType must be zero when the texture is compressed.");if(1!==u)throw new de("The type size for compressed textures must be 1.");if(0!==l)throw new de("glFormat must be zero when the texture is compressed.")}else{if(s!==Rt.UNSIGNED_BYTE)throw new de("Only unsigned byte buffers are supported.");if(h!==l)throw new de("The base internal format must be the same as the format for uncompressed textures.")}if(0!==d)throw new de("3D textures are unsupported.");if(0!==m)throw new de("Texture arrays are unsupported.");var b=v.byteOffset,E=new Array(g);for(t=0;t<g;++t){for(var T=E[t]={},S=0;S<_;++S){var C=f>>t,w=p>>t;C<1&&(C=1),w<1&&(w=1);var A=Ln.isCompressedFormat(c)?Ln.compressedTextureSizeInBytes(c,C,w):Ln.textureSizeInBytes(c,s,C,w),I=new Uint8Array(v.buffer,b,A);T[Gf[S]]=new Af(c,C,w,I),b+=A}Ze(e.buffer)?b+=4:b+=3-(b+3)%4+4}var P=E;if(1===_)for(t=0;t<g;++t)P[t]=P[t][Gf[0]];1===g&&(P=P[0]);return P}(e)})}var Vf=[171,75,84,88,32,49,49,187,13,10,26,10],kf=67305985,Gf=["positiveX","negativeX","positiveY","negativeY","positiveZ","negativeZ"],qf=4;var Hf={octEncodeInRange:function(e,t,n){var r,i;return n.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),n.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0&&(r=n.x,i=n.y,n.x=(1-Math.abs(i))*pt.signNotZero(r),n.y=(1-Math.abs(r))*pt.signNotZero(i)),n.x=pt.toSNorm(n.x,t),n.y=pt.toSNorm(n.y,t),n},octEncode:function(e,t){return Hf.octEncodeInRange(e,255,t)}},Wf=new En,Yf=new Uint8Array(1);function Xf(e){return Yf[0]=e,Yf[0]}Hf.octEncodeToCartesian4=function(e,t){return Hf.octEncodeInRange(e,65535,Wf),t.x=Xf(Wf.x*(1/256)),t.y=Xf(Wf.x),t.z=Xf(Wf.y*(1/256)),t.w=Xf(Wf.y),t},Hf.octDecodeInRange=function(e,t,n,r){var i;return r.x=pt.fromSNorm(e,n),r.y=pt.fromSNorm(t,n),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0&&(i=r.x,r.x=(1-Math.abs(r.y))*pt.signNotZero(i),r.y=(1-Math.abs(i))*pt.signNotZero(r.y)),_t.normalize(r,r)},Hf.octDecode=function(e,t,n){return Hf.octDecodeInRange(e,t,255,n)},Hf.octDecodeFromCartesian4=function(e,t){var n=256*e.x+e.y,r=256*e.z+e.w;return Hf.octDecodeInRange(n,r,65535,t)},Hf.octPackFloat=function(e){return 256*e.x+e.y};var jf=new En;function Kf(e){return e>>>1^-(1&e)}function Qf(e){return e>>1^-(1&e)}function Zf(e,t){this.normal=_t.clone(e),this.distance=t}Hf.octEncodeFloat=function(e){return Hf.octEncode(e,jf),Hf.octPackFloat(jf)},Hf.octDecodeFloat=function(e,t){var n=e/256,r=Math.floor(n),i=256*(n-r);return Hf.octDecode(r,i,t)},Hf.octPack=function(e,t,n,r){var i=Hf.octEncodeFloat(e),o=Hf.octEncodeFloat(t),a=Hf.octEncode(n,jf);return r.x=65536*a.x+i,r.y=65536*a.y+o,r},Hf.octUnpack=function(e,t,n,r){var i=e.x/65536,o=Math.floor(i),a=65536*(i-o),i=e.y/65536,s=Math.floor(i),u=65536*(i-s);Hf.octDecodeFloat(a,t),Hf.octDecodeFloat(u,n),Hf.octDecode(o,s,r)},Hf.compressTextureCoordinates=function(e){return 4096*(4095*e.x|0)+(4095*e.y|0)},Hf.decompressTextureCoordinates=function(e,t){var n=e/4096,r=Math.floor(n);return t.x=r/4095,t.y=(e-4096*r)/4095,t},Hf.zigZagDeltaDecode=function(e,t,n){var r=e.length,i=0,o=0,a=0;if(2===e.BYTES_PER_ELEMENT)for(var s=0;s<r;++s)i+=Qf(e[s]),o+=Qf(t[s]),e[s]=i,t[s]=o,Ze(n)&&(a+=Qf(n[s]),n[s]=a);else if(4===e.BYTES_PER_ELEMENT)for(s=0;s<r;++s)i+=Kf(e[s]),o+=Kf(t[s]),e[s]=i,t[s]=o,Ze(n)&&(a+=Kf(n[s]),n[s]=a)},Zf.fromPointNormal=function(e,t,n){var r=-_t.dot(t,e);return Ze(n)?(_t.clone(t,n.normal),n.distance=r,n):new Zf(t,r)};var Jf=new _t;Zf.fromCartesian4=function(e,t){var n=_t.fromCartesian4(e,Jf),r=e.w;return Ze(t)?(_t.clone(n,t.normal),t.distance=r,t):new Zf(n,r)},Zf.getPointDistance=function(e,t){return _t.dot(e.normal,t)+e.distance};var $f=new _t;Zf.projectPointOntoPlane=function(e,t,n){Ze(n)||(n=new _t);var r=Zf.getPointDistance(e,t),i=_t.multiplyByScalar(e.normal,r,$f);return _t.subtract(t,i,n)};var ep=new _t;function tp(e,t){this._distance=t,this._normal=new np(e,this),this.onChangeCallback=void 0,this.index=-1}function np(e,t){this._clippingPlane=t,this._cartesian3=_t.clone(e)}function rp(e){e=Je(e,Je.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=Je(e.enabled,!0),this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this.edgeColor=It.clone(Je(e.edgeColor,It.WHITE)),this.edgeWidth=Je(e.edgeWidth,0),this.planeAdded=new U,this.planeRemoved=new U,this._owner=void 0;var t=Je(e.unionClippingRegions,!1);this._unionClippingRegions=t,this._testIntersection=t?ip:op,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0;var n=e.planes;if(Ze(n))for(var r=n.length,i=0;i<r;++i)this.add(n[i])}function ip(e){return e===Jn.OUTSIDE}function op(e){return e===Jn.INSIDE}function ap(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||-1!==e._dirtyIndex&&e._dirtyIndex!==t,e._dirtyIndex=t}function sp(e,t){for(var n=e.length,r=0;r<n;++r)if(Zf.equals(e[r],t))return r;return-1}Zf.transform=function(e,t,n){return on.multiplyByPointAsVector(t,e.normal,Jf),_t.normalize(Jf,Jf),_t.multiplyByScalar(e.normal,-e.distance,ep),on.multiplyByPoint(t,ep,ep),Zf.fromPointNormal(ep,Jf,n)},Zf.clone=function(e,t){return Ze(t)?(_t.clone(e.normal,t.normal),t.distance=e.distance,t):new Zf(e.normal,e.distance)},Zf.equals=function(e,t){return e.distance===t.distance&&_t.equals(e.normal,t.normal)},Zf.ORIGIN_XY_PLANE=Object.freeze(new Zf(_t.UNIT_Z,0)),Zf.ORIGIN_YZ_PLANE=Object.freeze(new Zf(_t.UNIT_X,0)),Zf.ORIGIN_ZX_PLANE=Object.freeze(new Zf(_t.UNIT_Y,0)),Object.defineProperties(tp.prototype,{distance:{get:function(){return this._distance},set:function(e){Ze(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._distance=e}},normal:{get:function(){return this._normal},set:function(e){Ze(this.onChangeCallback)&&!_t.equals(this._normal._cartesian3,e)&&this.onChangeCallback(this.index),_t.clone(e,this._normal._cartesian3)}}}),tp.fromPlane=function(e,t){return Ze(t)?(t.normal=e.normal,t.distance=e.distance):t=new tp(e.normal,e.distance),t},tp.clone=function(e,t){return Ze(t)?(t.normal=e.normal,t.distance=e.distance,t):new tp(e.normal,e.distance)},Object.defineProperties(np.prototype,{x:{get:function(){return this._cartesian3.x},set:function(e){Ze(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.x&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.x=e}},y:{get:function(){return this._cartesian3.y},set:function(e){Ze(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.y&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.y=e}},z:{get:function(){return this._cartesian3.z},set:function(e){Ze(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.z&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.z=e}}}),Object.defineProperties(rp.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?ip:op)}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}}),rp.prototype.add=function(e){var t=this._planes.length,n=this;e.onChangeCallback=function(e){ap(n,e)},ap(this,e.index=t),this._planes.push(e),this.planeAdded.raiseEvent(e,t)},rp.prototype.get=function(e){return this._planes[e]},rp.prototype.contains=function(e){return-1!==sp(this._planes,e)},rp.prototype.remove=function(e){var t=this._planes,n=sp(t,e);if(-1===n)return!1;e instanceof tp&&(e.onChangeCallback=void 0,e.index=-1);for(var r=t.length-1,i=n;i<r;++i){var o=t[i+1];(t[i]=o)instanceof tp&&(o.index=i)}return this._multipleDirtyPlanes=!0,t.length=r,this.planeRemoved.raiseEvent(e,n),!0},rp.prototype.removeAll=function(){for(var e=this._planes,t=e.length,n=0;n<t;++n){var r=e[n];r instanceof tp&&(r.onChangeCallback=void 0,r.index=-1),this.planeRemoved.raiseEvent(r,n)}this._multipleDirtyPlanes=!0,this._planes=[]};var up=new qt,lp=new qt;function cp(e,t,n){for(var r=e._uint8View,i=e._planes,o=0,a=t;a<n;++a){var s=i[a],u=Hf.octEncodeToCartesian4(s.normal,lp);r[o]=u.x,r[o+1]=u.y,r[o+2]=u.z,r[o+3]=u.w;var l=qt.packFloat(s.distance,up);r[o+4]=l.x,r[o+5]=l.y,r[o+6]=l.z,r[o+7]=l.w,o+=8}}function hp(e,t,n){for(var r=e._float32View,i=e._planes,o=0,a=t;a<n;++a){var s=i[a],u=s.normal;r[o]=u.x,r[o+1]=u.y,r[o+2]=u.z,r[o+3]=s.distance,o+=4}}function fp(e,t){var n=Nn.maximumTextureSize;return t.x=Math.min(e,n),t.y=Math.ceil(e/t.x),t}var pp=new En;rp.prototype.update=function(e){var t,n,r,i,o,a=this._clippingPlanesTexture,s=e.context,u=rp.useFloatTexture(s),l=u?this.length:2*this.length;!Ze(a)||((t=a.width*a.height)<l||l<.25*t)&&(a.destroy(),a=void 0,this._clippingPlanesTexture=void 0),0!==this.length&&(Ze(a)||((n=fp(l,pp)).y*=2,u?(a=new ti({context:s,width:n.x,height:n.y,pixelFormat:Ln.RGBA,pixelDatatype:Pn.FLOAT,sampler:Nr.NEAREST,flipY:!1}),this._float32View=new Float32Array(n.x*n.y*4)):(a=new ti({context:s,width:n.x,height:n.y,pixelFormat:Ln.RGBA,pixelDatatype:Pn.UNSIGNED_BYTE,sampler:Nr.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(n.x*n.y*4)),this._clippingPlanesTexture=a,this._multipleDirtyPlanes=!0),r=this._dirtyIndex,!this._multipleDirtyPlanes&&-1===r||(this._multipleDirtyPlanes?u?(hp(this,0,this._planes.length),a.copyFrom({width:a.width,height:a.height,arrayBufferView:this._float32View})):(cp(this,0,this._planes.length),a.copyFrom({width:a.width,height:a.height,arrayBufferView:this._uint8View})):(o=i=0,u?(o=Math.floor(r/a.width),i=Math.floor(r-o*a.width),hp(this,r,r+1),a.copyFrom({width:1,height:1,arrayBufferView:this._float32View},i,o)):(o=Math.floor(2*r/a.width),i=Math.floor(2*r-o*a.width),cp(this,r,r+1),a.copyFrom({width:2,height:1,arrayBufferView:this._uint8View},i,o))),this._multipleDirtyPlanes=!1,this._dirtyIndex=-1))};var dp=new on,mp=new Zf(_t.UNIT_X,0);rp.prototype.computeIntersectionWithBoundingVolume=function(e,t){var n=this._planes,r=n.length,i=this.modelMatrix;Ze(t)&&(i=on.multiply(t,i,dp));var o=Jn.INSIDE;!this.unionClippingRegions&&0<r&&(o=Jn.OUTSIDE);for(var a=0;a<r;++a){var s=n[a];Zf.transform(s,i,mp);var u=e.intersectPlane(mp);if(u===Jn.INTERSECTING)o=u;else if(this._testIntersection(u))return u}return o},rp.setOwner=function(e,t,n){e!==t[n]&&(t[n]=t[n]&&t[n].destroy(),Ze(e)&&((e._owner=t)[n]=e))},rp.useFloatTexture=function(e){return e.floatingPointTexture},rp.getTextureResolution=function(e,t,n){var r=e.texture;if(Ze(r))return n.x=r.width,n.y=r.height,n;var i=fp(rp.useFloatTexture(t)?e.length:2*e.length,n);return i.y*=2,i},rp.prototype.isDestroyed=function(){return!1},rp.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),Vt(this)};var _p={HIGHLIGHT:0,REPLACE:1,MIX:2,getColorBlend:function(e,t){return e===_p.HIGHLIGHT?0:e===_p.REPLACE?1:e===_p.MIX?pt.clamp(t,pt.EPSILON4,1):void 0}},gp=Object.freeze(_p);function yp(){}function vp(e,t){var n="runtime."+Object.keys(e.createdBufferViews).length,r=e.buffers,i=Object.keys(r).length;return r[i]=t,e.createdBufferViews[n]={buffer:i,byteOffset:0,byteLength:t.byteLength},n}function xp(e,t){var n=t._loadResources,r=vp(n,e);return n.vertexBuffersToCreate.enqueue(r),r}function bp(e,t){var n=e.typedArray,r=t._loadResources,i=vp(r,n);return r.indexBuffersToCreate.enqueue({id:i,componentType:Mt.fromTypedArray(n)}),{bufferViewId:i,numberOfIndices:e.numberOfIndices}}function Ep(e,u,l){if(yp._taskProcessorReady){var c=l.primitivesToDecode.peek();if(Ze(c)){var t=e.scheduleTask(c,[c.array.buffer]);if(Ze(t))return l.activeDecodingTasks++,l.primitivesToDecode.dequeue(),t.then(function(e){e.taskDataMesh=c.mesh,e.taskDataPrimitive=c.primitive,u.meshPrimitives.push(e),l.activeDecodingTasks--;var t,n,r,i=bp(e.indexArray,u),o={},a=e.attributeData;for(var s in a){a.hasOwnProperty(s)&&(n=xp((t=a[s]).array,u),(r=t.data).bufferView=n,o[s]=r)}u._decodedData[c.mesh+".primitive."+c.primitive]={bufferView:i.bufferViewId,numberOfIndices:i.numberOfIndices,attributes:o}})}}}function Tp(e,t,n){if(yp._taskProcessorReady&&Ze(t)){var r=e.scheduleTask(t,[t.array.buffer]);if(Ze(r))return r.then(function(e){e.taskDataMesh=t.mesh,e.taskDataPrimitive=t.primitive,n.push(e)})}}function Sp(e,t,n){return"    float clipDistance = clip(gl_FragCoord, "+e+", "+t+"); \n    vec4 clippingPlanesEdgeColor = vec4(1.0); \n    clippingPlanesEdgeColor.rgb = "+n+".rgb; \n    float clippingPlanesEdgeWidth = "+n+".a; \n    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) \n    { \n        gl_FragColor = clippingPlanesEdgeColor;\n    } \n"}yp._maxDecodingConcurrency=Math.max(et.hardwareConcurrency-1,1),yp._decoderTaskProcessor=void 0,yp._taskProcessorReady=!1,yp._getDecoderTaskProcessor=function(){var e;return Ze(yp._decoderTaskProcessor)||((e=new Df("decodeDraco",yp._maxDecodingConcurrency)).initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_wasm_wrapper.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm",fallbackModulePath:"ThirdParty/Workers/draco_decoder.js"}).then(function(){yp._taskProcessorReady=!0}),yp._decoderTaskProcessor=e),yp._decoderTaskProcessor},yp.hasExtension=function(e){return Ze(e.extensionsRequired.KHR_draco_mesh_compression)||Ze(e.extensionsUsed.KHR_draco_mesh_compression)},yp._decodedModelResourceCache=void 0,yp.parse=function(e,t){if(yp.hasExtension(e)){var a=e._loadResources,n=e.cacheKey;if(Ze(n)){Ze(yp._decodedModelResourceCache)||(Ze(t.cache.modelDecodingCache)||(t.cache.modelDecodingCache={}),yp._decodedModelResourceCache=t.cache.modelDecodingCache);var r=yp._decodedModelResourceCache[n];if(Ze(r))return r.count++,void(a.pendingDecodingCache=!0)}var s=e._dequantizeInShader,u=e.gltf;au.mesh(u,function(e,o){au.meshPrimitive(e,function(e,t){var n,r,i;!Ze(e.extensions)||Ze(n=e.extensions.KHR_draco_mesh_compression)&&(r=u.bufferViews[n.bufferView],i=Uo(u.buffers[r.buffer].extras._pipeline.source,r.byteOffset,r.byteOffset+r.byteLength),a.primitivesToDecode.enqueue({mesh:o,primitive:t,array:i,bufferView:r,compressedAttributes:n.attributes,dequantizeInShader:s}))})})}},yp.parseDecodedData=function(e,t,n){if(Ze(e.taskDataMesh)&&Ze(e.taskDataPrimitive)&&Ze(e.indexArray)&&Ze(e.attributeData)){var r,i,o,a=bp(e.indexArray,t),s={},u=e.attributeData;for(var l in u){u.hasOwnProperty(l)&&(i=xp((r=u[l]).array,t),(o=r.data).bufferView=i,s[l]=o)}t._decodedData[e.taskDataMesh+".primitive."+e.taskDataPrimitive]={bufferView:a.bufferViewId,numberOfIndices:a.numberOfIndices,attributes:s}}else console.log("indexeddb中存储模型mesh数据有问题")},yp.decodeModel=function(e,t){if(!yp.hasExtension(e))return D.resolve();var n=e._loadResources,r=e.cacheKey;if(Ze(r)&&Ze(yp._decodedModelResourceCache)){var i=yp._decodedModelResourceCache[r];if(Ze(i)&&n.pendingDecodingCache)return D(i.ready,function(){e._decodedData=i.data,n.pendingDecodingCache=!1});yp._decodedModelResourceCache[r]={ready:!1,count:1,data:void 0}}if(0===n.primitivesToDecode.length)return D.resolve();for(var o=yp._getDecoderTaskProcessor(),a=[],s=Ep(o,e,n);Ze(s);)a.push(s),s=Ep(o,e,n);return D.all(a)},yp.decodePointCloud=function(e){var t=yp._getDecoderTaskProcessor();if(yp._taskProcessorReady)return t.scheduleTask(e,[e.buffer.buffer])},yp.cacheDataForModel=function(e){var t,n=e.cacheKey;Ze(n)&&Ze(yp._decodedModelResourceCache)&&(Ze(t=yp._decodedModelResourceCache[n])&&(t.ready=!0,t.data=e._decodedData))},yp.parseGltf=function(a,s,e){var u=[];au.mesh(a,function(e,o){au.meshPrimitive(e,function(e,t){var n,r,i;!Ze(e.extensions)||Ze(n=e.extensions.KHR_draco_mesh_compression)&&(r=a.bufferViews[n.bufferView],i=Uo(a.buffers[r.buffer].extras._pipeline.source,r.byteOffset,r.byteOffset+r.byteLength),u.push({mesh:o,primitive:t,array:i,bufferView:r,compressedAttributes:n.attributes,dequantizeInShader:s}))})});var t=yp._getDecoderTaskProcessor();t._maximumActiveTasks=u.length+1;for(var n=[],r=0;r<u.length;r++){var i=u[r];if(!Ze(i))return;var o=Tp(t,i,e);Ze(o)&&n.push(o)}return D.all(n)},yp.destroyCachedDataForModel=function(e){var t,n=e.cacheKey;Ze(n)&&Ze(yp._decodedModelResourceCache)&&(Ze(t=yp._decodedModelResourceCache[n])&&0==--t.count&&delete yp._decodedModelResourceCache[n])};var Cp=new En;function wp(e,t){var n=e.unionClippingRegions,r=e.length,i=rp.useFloatTexture(t),o=rp.getTextureResolution(e,t,Cp),a=o.x,s=o.y,u=(i?function(e,t){var n=1/t,r=1/e+"";-1===r.indexOf(".")&&(r+=".0");var i=n+"";-1===i.indexOf(".")&&(i+=".0");return"vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int pixY = clippingPlaneNumber / "+e+";\n    int pixX = clippingPlaneNumber - (pixY * "+e+");\n    float u = (float(pixX) + 0.5) * "+r+";\n    float v = (float(pixY) + 0.5) * "+i+";\n    vec4 plane = texture2D(packedClippingPlanes, vec2(u, v));\n    return czm_transformPlane(plane, transform);\n}\n"}:function(e,t){var n=1/t,r=1/e+"";-1===r.indexOf(".")&&(r+=".0");var i=n+"";-1===i.indexOf(".")&&(i+=".0");return"vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int clippingPlaneStartIndex = clippingPlaneNumber * 2;\n    int pixY = clippingPlaneStartIndex / "+e+";\n    int pixX = clippingPlaneStartIndex - (pixY * "+e+");\n    float u = (float(pixX) + 0.5) * "+r+";\n    float v = (float(pixY) + 0.5) * "+i+";\n    vec4 oct32 = texture2D(packedClippingPlanes, vec2(u, v)) * 255.0;\n    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);\n    vec4 plane;\n    plane.xyz = czm_octDecode(oct, 65535.0);\n    plane.w = czm_unpackFloat(texture2D(packedClippingPlanes, vec2(u + "+r+", v)));\n    return czm_transformPlane(plane, transform);\n}\n"})(a,s);return u+="\n",u+=n?"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount;\n    float pixelWidth = czm_metersPerPixel(position);\n    bool breakAndDiscard = false;\n    for (int i = 0; i < "+r+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));\n        if (amount <= 0.0)\n        {\n           breakAndDiscard = true;\n           break;\n        }\n    }\n    if (breakAndDiscard) {\n        discard;\n    }\n    return clipAmount;\n}\n":"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    bool clipped = true;\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount = 0.0;\n    float pixelWidth = czm_metersPerPixel(position);\n    for (int i = 0; i < "+r+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = max(amount, clipAmount);\n        clipped = clipped && (amount <= 0.0);\n    }\n    if (clipped)\n    {\n        discard;\n    }\n    return clipAmount;\n}\n"}var Ap=Object.freeze({NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2}),Ip=Object.freeze({TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3});function Pp(){this.times=void 0,this.points=void 0,fe.throwInstantiationError()}function Op(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).points,n=e.times;this._times=n,this._points=t,this._lastTimeIndex=0}function Lp(e){var a,s,u,t=(e=Je(e,Je.EMPTY_OBJECT)).points,n=e.times;this._times=n,this._points=t,this._evaluateFunction=(s=(a=this).points,u=a.times,function(e,t){Ze(t)||(t=new Si);var n=a._lastTimeIndex=a.findTimeInterval(e,a._lastTimeIndex),r=(e-u[n])/(u[n+1]-u[n]),i=s[n],o=s[n+1];return Si.fastSlerp(i,o,r,t)}),this._lastTimeIndex=0}function Np(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).weights,n=e.times;this._times=n,this._weights=t,this._count=t.length/n.length,this._lastTimeIndex=0}function Rp(){}Pp.prototype.evaluate=fe.throwInstantiationError,Pp.prototype.findTimeInterval=function(e,t){var n,r=this.times,i=r.length;if(e>=r[t=Je(t,0)]){if(t+1<i&&e<r[t+1])return t;if(t+2<i&&e<r[t+2])return t+1}else if(0<=t-1&&e>=r[t-1])return t-1;if(e>r[t])for(n=t;n<i-1&&!(e>=r[n]&&e<r[n+1]);++n);else for(n=t-1;0<=n&&!(e>=r[n]&&e<r[n+1]);--n);return n===i-1&&(n=i-2),n},Pp.prototype.wrapTime=function(e){var t=this.times,n=t[t.length-1],r=t[0],i=n-r;return e<r&&(e+=(Math.floor((r-e)/i)+1)*i),n<e&&(e-=(Math.floor((e-n)/i)+1)*i),e},Pp.prototype.clampTime=function(e){var t=this.times;return pt.clamp(e,t[0],t[t.length-1])},Object.defineProperties(Op.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),Op.prototype.findTimeInterval=Pp.prototype.findTimeInterval,Op.prototype.wrapTime=Pp.prototype.wrapTime,Op.prototype.clampTime=Pp.prototype.clampTime,Op.prototype.evaluate=function(e,t){var n=this.points,r=this.times,i=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),o=(e-r[i])/(r[i+1]-r[i]);return Ze(t)||(t=new _t),_t.lerp(n[i],n[i+1],o,t)},Object.defineProperties(Lp.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),Lp.prototype.findTimeInterval=Pp.prototype.findTimeInterval,Lp.prototype.wrapTime=Pp.prototype.wrapTime,Lp.prototype.clampTime=Pp.prototype.clampTime,Lp.prototype.evaluate=function(e,t){return this._evaluateFunction(e,t)},Object.defineProperties(Np.prototype,{times:{get:function(){return this._times}},weights:{get:function(){return this._weights}}}),Np.prototype.findTimeInterval=Pp.prototype.findTimeInterval,Np.prototype.wrapTime=Pp.prototype.wrapTime,Np.prototype.clampTime=Pp.prototype.clampTime,Np.prototype.evaluate=function(e,t){var n=this.weights,r=this.times,i=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),o=(e-r[i])/(r[i+1]-r[i]);Ze(t)||(t=new Array(this._count));for(var a=0;a<this._count;a++){var s=i*this._count+a;t[a]=n[s]*(1-o)+n[s+this._count]*o}return t};var Dp=/^data\:/i;function Mp(e,t){var n=e.gltf,r=n.buffers,i=n.bufferViews[t.bufferView],o=r[i.buffer],a=i.byteOffset+t.byteOffset,s=t.count*su(t.type),u=Dp.test(o.uri)?"":o.uri;return e.cacheKey+"//"+u+"/"+a+"/"+s}var Fp={};Rp.getAnimationParameterValues=function(e,t){var n=Mp(e,t);if(!Ze(f=Fp[n])){for(var r=e.gltf,i=r.buffers,o=r.bufferViews[t.bufferView],a=i[o.buffer].extras._pipeline.source,s=t.componentType,u=t.type,l=su(u),c=t.count,h=uu(r,t),f=new Array(c),p=Je(t.byteOffset,0),d=o.byteOffset+p,m=0;m<c;m++){var _=Mt.createArrayBufferView(s,a.buffer,a.byteOffset+d,l);"SCALAR"===u?f[m]=_[0]:"VEC3"===u?f[m]=_t.fromArray(_):"VEC4"===u&&(f[m]=Si.unpack(_)),d+=h}Ze(e.cacheKey)&&(Fp[n]=f)}return f};var zp={};function Bp(e){this._value=e}function Up(e){this._spline=e,this._lastTimeIndex=0}Bp.prototype.evaluate=function(e,t){return this._value},Bp.prototype.wrapTime=function(e){return 0},Bp.prototype.clampTime=function(e){return 0},Up.prototype.findTimeInterval=Pp.prototype.findTimeInterval,Up.prototype.evaluate=function(e,t){var n=this._lastTimeIndex=this.findTimeInterval(e,this._lastTimeIndex),r=this._spline.times,i=e>=r[n+1]?r[n+1]:r[n];return this._spline.evaluate(i,t)},Object.defineProperties(Up.prototype,{times:{get:function(){return this._spline.times}}}),Up.prototype.wrapTime=function(e){return this._spline.wrapTime(e)},Up.prototype.clampTime=function(e){return this._spline.clampTime(e)},Rp.getAnimationSpline=function(e,t,n,r,i,o,a,s){var u,l,c,h,f=(u=t,l=r,e.cacheKey+"//"+u+"/"+l),p=zp[f];return Ze(p)||(h=s,1===(c=o).length&&1===h.length?p=new Bp(h[0]):"LINEAR"!==i.interpolation&&"STEP"!==i.interpolation||("translation"===a||"scale"===a?p=new Op({times:c,points:h}):"rotation"===a?p=new Lp({times:c,points:h}):"weights"===a&&(p=new Np({times:c,weights:h})),Ze(p)&&"STEP"===i.interpolation&&(p=new Up(p))),Ze(e.cacheKey)&&(zp[f]=p)),p};var Vp={};Rp.getSkinInverseBindMatrices=function(e,t){var n=Mp(e,t);if(!Ze(p=Vp[n])){var r=e.gltf,i=r.buffers,o=r.bufferViews[t.bufferView],a=i[o.buffer].extras._pipeline.source,s=t.componentType,u=t.type,l=t.count,c=uu(r,t),h=o.byteOffset+t.byteOffset,f=su(u),p=new Array(l);if(s===Rt.FLOAT&&u===ni.MAT4)for(var d=0;d<l;++d){var m=Mt.createArrayBufferView(s,a.buffer,a.byteOffset+h,f);p[d]=on.fromArray(m),h+=c}Vp[n]=p}return p};var kp=Object.freeze({NONE:0,REPEAT:1,MIRRORED_REPEAT:2}),Gp=Object.freeze({STOPPED:0,ANIMATING:1});function qp(e,t,n){this._name=n.name,this._startTime=Ja.clone(e.startTime),this._delay=Je(e.delay,0),this._stopTime=e.stopTime,this.removeOnStop=Je(e.removeOnStop,!1),this._multiplier=Je(e.multiplier,1),this._reverse=Je(e.reverse,!1),this._loop=Je(e.loop,kp.NONE),this.start=new U,this.update=new U,this.stop=new U,this._state=Gp.STOPPED,this._runtimeAnimation=n,this._computedStartTime=void 0,this._duration=void 0;var r=this;this._raiseStartEvent=function(){r.start.raiseEvent(t,r)},this._updateEventTime=0,this._raiseUpdateEvent=function(){r.update.raiseEvent(t,r,r._updateEventTime)},this._raiseStopEvent=function(){r.stop.raiseEvent(t,r)}}function Hp(e){this.animationAdded=new U,this.animationRemoved=new U,this._model=e,this._scheduledAnimations=[],this._previousTime=void 0}function Wp(e,t,n){var r=e._model,i=new qp(n,r,r._runtime.animations[t]);return e._scheduledAnimations.push(i),e.animationAdded.raiseEvent(r,i),i}function Yp(e,t){for(var n=e.channelEvaluators,r=n.length,i=0;i<r;++i)n[i](t)}Object.defineProperties(qp.prototype,{name:{get:function(){return this._name}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},multiplier:{get:function(){return this._multiplier}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}}}),Object.defineProperties(Hp.prototype,{length:{get:function(){return this._scheduledAnimations.length}}}),Hp.prototype.add=function(e){e=Je(e,Je.EMPTY_OBJECT);var t,n=this._model._runtime.animations;if(Ze(e.index))return Wp(this,e.index,e);for(var r=n.length,i=0;i<r;++i)if(n[i].name===e.name){t=i;break}return Wp(this,t,e)},Hp.prototype.addAll=function(e){e=Je(e,Je.EMPTY_OBJECT);for(var t=[],n=this._model._runtime.animations.length,r=0;r<n;++r)t.push(Wp(this,r,e));return t},Hp.prototype.remove=function(e){if(Ze(e)){var t=this._scheduledAnimations,n=t.indexOf(e);if(-1!==n)return t.splice(n,1),this.animationRemoved.raiseEvent(this._model,e),!0}return!1},Hp.prototype.removeAll=function(){var e=this._model,t=this._scheduledAnimations,n=t.length;this._scheduledAnimations=[];for(var r=0;r<n;++r)this.animationRemoved.raiseEvent(e,t[r])},Hp.prototype.contains=function(e){return!!Ze(e)&&-1!==this._scheduledAnimations.indexOf(e)},Hp.prototype.get=function(e){return this._scheduledAnimations[e]};var Xp=[];function jp(e,t,n){return function(){e.animationRemoved.raiseEvent(t,n)}}function Kp(e,t,n){this._name=t.name,this._id=n,this._uniformMap=e._uniformMaps[n],this._technique=void 0,this._program=void 0,this._values=void 0}function Qp(e,t,n){for(var r=[],i=e.primitives,o=i.length,a=0;a<o;++a){var s=i[a];r[a]=t[s.material]}this._name=e.name,this._materials=r,this._id=n}function Zp(e,t,n,r,i){this._model=e,this._runtimeNode=n,this._name=t.name,this._id=r,this.useMatrix=!1,this._show=!0,this._matrix=on.clone(i),this._originalMatrix=on.clone(i)}function Jp(){}function $p(e,t,n,r,i){var o=3*t,a=e[o],s=e[1+o],u=e[2+o];return void 0===a?63:((a===n&&s===r&&u===i)<<0)+((a===n&&s===i&&u===r)<<1)+((a===r&&s===n&&u===i)<<2)+((a===r&&s===i&&u===n)<<3)+((a===i&&s===n&&u===r)<<4)+((a===i&&s===r&&u===n)<<5)}function ed(e){return(1&e)+(e>>1&1)+(e>>2&1)+(e>>3&1)+(e>>4&1)+(e>>5&1)}function td(e,t,n,r,i,o,a){var s=a?1:0,u=i?1:0,l=$p(e,t,s,u,0);if(0===l)return t;var c=i?1:0,h=o?1:0,f=$p(e,n,0,c,h);if(0===f)return n;var p=a?1:0,d=o?1:0,m=$p(e,r,p,0,d);if(0===m)return r;var _,g,y,v=l&f&m;if(1&v)_=0,g=1,y=2;else if(2&v)_=0,y=1,g=2;else if(4&v)g=0,_=1,y=2;else if(8&v)g=0,y=1,_=2;else if(16&v)y=0,_=1,g=2;else{if(!(32&v)){var x=ed(l),b=ed(f),E=ed(m);return x<b&&x<E?t:b<E?n:r}y=0,g=1,_=2}var T=3*t;e[T+_]=s,e[T+g]=u,e[T+y]=0;var S=3*n;e[S+_]=0,e[S+g]=c,e[S+y]=h;var C=3*r;return e[C+_]=p,e[C+g]=0,e[C+y]=d,-1}function nd(e,t,n){var r=e[0];return 1===e[Math.min(t,n)*r+Math.max(t,n)]}function rd(e){var t=new Uint8Array(e);return t[e-1]=192,8===e?t[e-1]=96:4===e?t[e-1]=48:2===e?t[e-1]=24:1===e&&(t[e-1]=12),t}function id(e,t){for(var n=e.gltf,r=e._loadResources,i=0;i<t.length;++i){var o=t[i],a=o.extras._pipeline.vertexNumberingScope;o.extras._pipeline.vertexNumberingScope=void 0;var s=a.extraVertices,u=r.getBuffer(o),l=o.byteStride||4,c=s.length,h=new Uint8Array(u.byteLength+c*l);for(h.set(u),S=0;S<c;++S)for(var f=s[S]*l,p=u.length+S*l,d=0;d<l;++d)h[p+d]=h[f+d];o.byteOffset=0,o.byteLength=h.byteLength;var m=n.buffers.push({byteLength:h.byteLength,extras:{_pipeline:{source:h.buffer}}})-1;o.buffer=m,r.buffers[m]=h;var _=a.accessors;for(S=0;S<_.length;++S){var g=_[S];n.accessors[g].count+=c}if(!a.createdOutlines){var y=a.outlineCoordinates,v=new Float32Array(y),x=e.gltf.buffers.push({byteLength:v.byteLength,extras:{_pipeline:{source:v.buffer}}})-1;r.buffers[x]=new Uint8Array(v.buffer,0,v.byteLength);for(var b=e.gltf.bufferViews.push({buffer:x,byteLength:v.byteLength,byteOffset:0,byteStride:3*Float32Array.BYTES_PER_ELEMENT,target:34962})-1,E=e.gltf.accessors.push({bufferView:b,byteOffset:0,componentType:5126,count:v.length/3,type:"VEC3",min:[0,0,0],max:[1,1,1]})-1,T=a.primitives,S=0;S<T.length;++S)T[S].attributes._OUTLINE_COORDINATES=E;r.vertexBuffersToCreate.enqueue(b),a.createdOutlines=!0}}}function od(e,t){return t.buffer===e}function ad(e){e=Je(e,Je.EMPTY_OBJECT),this.vertexArray=e.vertexArray,this.fragmentShaderSource=e.fragmentShaderSource,this.shaderProgram=e.shaderProgram,this.uniformMap=e.uniformMap,this.outputTexture=e.outputTexture,this.preExecute=e.preExecute,this.postExecute=e.postExecute,this.persists=Je(e.persists,!1),this.pass=yn.COMPUTE,this.owner=e.owner}function sd(e,t,n,r,i,o,a,s,u,l){this._gl=e,this._texture=t,this._textureTarget=n,this._targetFace=r,this._pixelFormat=i,this._pixelDatatype=o,this._size=a,this._preMultiplyAlpha=s,this._flipY=u,this._initialized=l}function ud(e){var t,a,n=(e=Je(e,Je.EMPTY_OBJECT)).context,r=e.source;Ze(r)?(t=[r.positiveX,r.negativeX,r.positiveY,r.negativeY,r.positiveZ,r.negativeZ],a=t[0].width,t[0].height):(a=e.width,e.height);var s=a,u=Je(e.pixelFormat,Ln.RGBA),l=Je(e.pixelDatatype,Pn.UNSIGNED_BYTE),i=6*Ln.textureSizeInBytes(u,l,s,s),o=e.preMultiplyAlpha||u===Ln.RGB||u===Ln.LUMINANCE,c=Je(e.flipY,!0),h=n._gl,f=h.TEXTURE_CUBE_MAP,p=h.createTexture();function d(e,t,n,r){var i=t.arrayBufferView;Ze(i)||(i=t.bufferView);var o=4;Ze(i)&&(o=Ln.alignmentInBytes(u,l,a)),h.pixelStorei(h.UNPACK_ALIGNMENT,o),Ze(i)?(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),r&&(i=Ln.flipY(i,u,l,s,s)),h.texImage2D(e,0,u,s,s,0,u,l,i)):(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),h.texImage2D(e,0,u,u,l,t))}h.activeTexture(h.TEXTURE0),h.bindTexture(f,p),Ze(r)?(d(h.TEXTURE_CUBE_MAP_POSITIVE_X,r.positiveX,o,c),d(h.TEXTURE_CUBE_MAP_NEGATIVE_X,r.negativeX,o,c),d(h.TEXTURE_CUBE_MAP_POSITIVE_Y,r.positiveY,o,c),d(h.TEXTURE_CUBE_MAP_NEGATIVE_Y,r.negativeY,o,c),d(h.TEXTURE_CUBE_MAP_POSITIVE_Z,r.positiveZ,o,c),d(h.TEXTURE_CUBE_MAP_NEGATIVE_Z,r.negativeZ,o,c)):(h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X,0,u,s,s,0,u,l,null),h.texImage2D(h.TEXTURE_CUBE_MAP_NEGATIVE_X,0,u,s,s,0,u,l,null),h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_Y,0,u,s,s,0,u,l,null),h.texImage2D(h.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,u,s,s,0,u,l,null),h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_Z,0,u,s,s,0,u,l,null),h.texImage2D(h.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,u,s,s,0,u,l,null)),h.bindTexture(f,null),this._context=n,this._textureFilterAnisotropic=n._textureFilterAnisotropic,this._textureTarget=f,this._texture=p,this._pixelFormat=u,this._pixelDatatype=l,this._size=s,this._hasMipmap=!1,this._sizeInBytes=i,this._preMultiplyAlpha=o,this._flipY=c,this._sampler=void 0;var m=Ze(r);this._positiveX=new sd(h,p,f,h.TEXTURE_CUBE_MAP_POSITIVE_X,u,l,s,o,c,m),this._negativeX=new sd(h,p,f,h.TEXTURE_CUBE_MAP_NEGATIVE_X,u,l,s,o,c,m),this._positiveY=new sd(h,p,f,h.TEXTURE_CUBE_MAP_POSITIVE_Y,u,l,s,o,c,m),this._negativeY=new sd(h,p,f,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,u,l,s,o,c,m),this._positiveZ=new sd(h,p,f,h.TEXTURE_CUBE_MAP_POSITIVE_Z,u,l,s,o,c,m),this._negativeZ=new sd(h,p,f,h.TEXTURE_CUBE_MAP_NEGATIVE_Z,u,l,s,o,c,m),this.sampler=Ze(e.sampler)?e.sampler:new Nr}Hp.prototype.update=function(e){var t=this._scheduledAnimations,n=t.length;if(0===n)return this._previousTime=void 0,!1;if(Ja.equals(e.time,this._previousTime))return!1;this._previousTime=Ja.clone(e.time,this._previousTime);for(var r=!1,i=e.time,o=this._model,a=0;a<n;++a){var s=t[a],u=s._runtimeAnimation;Ze(s._computedStartTime)||(s._computedStartTime=Ja.addSeconds(Je(s.startTime,i),s.delay,new Ja)),Ze(s._duration)||(s._duration=u.stopTime*(1/s.multiplier));var l=s._computedStartTime,c=s._duration,h=s.stopTime,f=0!==c?Ja.secondsDifference(i,l)/c:0;0!==c&&Ze(h)&&Ja.greaterThan(i,h)&&(f=Ja.secondsDifference(h,l)/c);var p,d,m,_=0<=f,g=s.loop===kp.REPEAT||s.loop===kp.MIRRORED_REPEAT,y=(_||g&&!Ze(s.startTime))&&(f<=1||g)&&(!Ze(h)||Ja.lessThanOrEquals(i,h));!y&&s._state!==Gp.ANIMATING||(y&&s._state===Gp.STOPPED&&(s._state=Gp.ANIMATING,0<s.start.numberOfListeners&&e.afterRender.push(s._raiseStartEvent)),s.loop===kp.REPEAT?f-=Math.floor(f):s.loop===kp.MIRRORED_REPEAT&&(d=f-(p=Math.floor(f)),f=p%2==1?1-d:d),s.reverse&&(f=1-f),m=f*c*s.multiplier,Yp(u,m=pt.clamp(m,u.startTime,u.stopTime)),0<s.update.numberOfListeners&&(s._updateEventTime=m,e.afterRender.push(s._raiseUpdateEvent)),r=!0,y||(s._state=Gp.STOPPED,0<s.stop.numberOfListeners&&e.afterRender.push(s._raiseStopEvent),s.removeOnStop&&Xp.push(s)))}n=Xp.length;for(var v=0;v<n;++v){var x=Xp[v];t.splice(t.indexOf(x),1),e.afterRender.push(jp(this,o,x))}return Xp.length=0,r},Object.defineProperties(Kp.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}}),Kp.prototype.setValue=function(e,t){var n="u_"+e,r=this._uniformMap.values[n];r.value=r.clone(t,r.value)},Kp.prototype.getValue=function(e){var t="u_"+e,n=this._uniformMap.values[t];if(Ze(n))return n.value},Object.defineProperties(Qp.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}}),Object.defineProperties(Zp.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,this._model._perNodeShowDirty=!0)}},matrix:{get:function(){return this._matrix},set:function(e){this._matrix=on.clone(e,this._matrix),this.useMatrix=!0;var t=this._model;t._cesiumAnimationsDirty=!0,this._runtimeNode.dirtyNumber=t._maxDirtyNumber}},originalMatrix:{get:function(){return this._originalMatrix}}}),Zp.prototype.setMatrix=function(e){on.clone(e,this._matrix)},Jp.hasExtension=function(e){return Ze(e.extensionsRequired.CESIUM_primitive_outline)||Ze(e.extensionsUsed.CESIUM_primitive_outline)},Jp.outlinePrimitives=function(o){if(Jp.hasExtension(o)){var e=o.gltf,a=[];au.mesh(e,function(e,i){au.meshPrimitive(e,function(e,t){var n,r;Ze(e.extensions)&&Ze(n=e.extensions.CESIUM_primitive_outline)&&void 0!==(r=function(e,t){var n=t.attributes;if(void 0===n)return;var r,i=e.gltf;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o],s=i.accessors[a].bufferView,u=i.bufferViews[s];if(Ze(u.extras)||(u.extras={}),Ze(u.extras._pipeline)||(u.extras._pipeline={}),Ze(u.extras._pipeline.vertexNumberingScope)){if(void 0!==r&&u.extras._pipeline.vertexNumberingScope!==r)return}else u.extras._pipeline.vertexNumberingScope=r||{vertexCopies:[],extraVertices:[],outlineCoordinates:[],accessors:[],bufferViews:[],primitives:[],createdOutlines:!1};(r=u.extras._pipeline.vertexNumberingScope).bufferViews.indexOf(u)<0&&r.bufferViews.push(u),r.accessors.indexOf(a)<0&&r.accessors.push(a)}return r.primitives.push(t),r}(o,e))&&(a.indexOf(r)<0&&a.push(r),function(e,t,n,r,i){var o,a=i.vertexCopies,s=i.extraVertices,u=i.outlineCoordinates,l=e.gltf,c=l.meshes[t].primitives[n],h=l.accessors,f=l.bufferViews;for(var p in c.attributes)if(c.attributes.hasOwnProperty(p)){var d=c.attributes[p],m=h[d];if(Ze(m)){o=m.count;break}}if(!Ze(o))return;var _,g,y=h[c.indices],v=f[y.bufferView],x=h[r],b=f[x.bufferView],E=e._loadResources,T=E.getBuffer(v),S=E.getBuffer(b),C=new(5123===y.componentType?Uint16Array:Uint32Array)(T.buffer,T.byteOffset+y.byteOffset,y.count),w=new(5123===x.componentType?Uint16Array:Uint32Array)(S.buffer,S.byteOffset+x.byteOffset,x.count),A=o,I=[A];for(_=0;_<w.length;_+=2){var P=w[_],O=w[_+1],L=Math.min(P,O),N=Math.max(P,O);I[L*A+N]=1}for(_=0;_<C.length;_+=3)for(var R=C[_],D=C[_+1],M=C[_+2],F=nd(I,R,D),z=nd(I,D,M),B=nd(I,M,R),U=td(u,R,D,M,F,z,B);0<=U;){if(void 0===(g=U===R?a[R]:U===D?a[D]:a[M])){g=o+s.length;for(var V=U;o<=V;)V=s[V-o];s.push(V),a[U]=g}65536<=g&&C instanceof Uint16Array&&(C=new Uint32Array(C),y.componentType=5125,v.buffer=l.buffers.push({byteLength:C.byteLength,extras:{_pipeline:{source:C.buffer}}})-1,v.byteLength=C.byteLength,v.byteOffset=0,e._loadResources.buffers[v.buffer]=new Uint8Array(C.buffer,0,C.byteLength)),U===R?(R=g,C[_]=g):U===D?(D=g,C[_+1]=g):(M=g,C[_+2]=g),Ze(y.max)&&(y.max[0]=Math.max(y.max[0],g)),U=td(u,R,D,M,F,z,B)}}(o,i,t,n.indices,r))})});for(var t=0;t<a.length;++t)id(o,a[t].bufferViews);!function(e){var t,n=e.gltf,r=e._loadResources;for(t=0;t<n.buffers.length;++t){var i=n.buffers[t],o=n.bufferViews.filter(od.bind(void 0,t)),a=o.reduce(function(e,t){return e+t.byteLength},0);if(a!==i.byteLength){for(var s=new Uint8Array(a),u=0,l=0;l<o.length;++l){var c=o[l],h=r.getBuffer(c);s.set(h,u),c.byteOffset=u,u+=h.byteLength}r.buffers[t]=s,i.extras._pipeline.source=s.buffer,i.byteLength=a}}}(o)}},Jp.createTexture=function(e,t){var n=t.cache.modelOutliningCache;if(Ze(n)||(n=t.cache.modelOutliningCache={}),Ze(n.outlineTexture))return n.outlineTexture;for(var r=Math.min(4096,Nn.maximumTextureSize),i=r,o=rd(i),a=[];1<i;)i>>=1,a.push(rd(i));var s=new ti({context:t,source:{arrayBufferView:o,mipLevels:a},width:r,height:1,pixelFormat:Ln.LUMINANCE,sampler:new Nr({wrapS:Lr.CLAMP_TO_EDGE,wrapT:Lr.CLAMP_TO_EDGE,minificationFilter:Pr.LINEAR_MIPMAP_LINEAR,magnificationFilter:Ar.LINEAR})});return n.outlineTexture=s},ad.prototype.execute=function(e){e.execute(this)},Object.defineProperties(sd.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}}),sd.prototype.copyFrom=function(e,t,n){t=Je(t,0),n=Je(n,0);var r=this._gl,i=this._textureTarget,o=this._targetFace;r.activeTexture(r.TEXTURE0),r.bindTexture(i,this._texture);var a=e.width,s=e.height,u=e.arrayBufferView,l=this._size,c=this._pixelFormat,h=this._pixelDatatype,f=this._preMultiplyAlpha,p=this._flipY,d=4;Ze(u)&&(d=Ln.alignmentInBytes(c,h,a)),r.pixelStorei(r.UNPACK_ALIGNMENT,d);var m,_=!1;this._initialized||(0===t&&0===n&&a===l&&s===l?(Ze(u)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),p&&(u=Ln.flipY(u,c,h,l,l)),r.texImage2D(o,0,c,l,l,0,c,h,u)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,p),r.texImage2D(o,0,c,c,h,e)),_=!0):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),m=Ln.createTypedArray(c,h,l,l),r.texImage2D(o,0,c,l,l,0,c,h,m)),this._initialized=!0),_||(Ze(u)?(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),p&&(u=Ln.flipY(u,c,h,a,s)),r.texSubImage2D(o,0,t,n,a,s,c,h,u)):(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,p),r.texSubImage2D(o,0,t,n,c,h,e))),r.bindTexture(i,null)},sd.prototype.copyFromFramebuffer=function(e,t,n,r,i,o){e=Je(e,0),t=Je(t,0),n=Je(n,0),r=Je(r,0),i=Je(i,this._size),o=Je(o,this._size);var a=this._gl,s=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this._texture),a.copyTexSubImage2D(this._targetFace,0,e,t,n,r,i,o),a.bindTexture(s,null),this._initialized=!0},Object.defineProperties(ud.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(e){var t=e.minificationFilter,n=e.magnificationFilter,r=t===Pr.NEAREST_MIPMAP_NEAREST||t===Pr.NEAREST_MIPMAP_LINEAR||t===Pr.LINEAR_MIPMAP_NEAREST||t===Pr.LINEAR_MIPMAP_LINEAR,i=this._context,o=this._pixelDatatype;(o===Pn.FLOAT&&!i.textureFloatLinear||o===Pn.HALF_FLOAT&&!i.textureHalfFloatLinear)&&(t=r?Pr.NEAREST_MIPMAP_NEAREST:Pr.NEAREST,n=Ar.NEAREST);var a=i._gl,s=this._textureTarget;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this._texture),a.texParameteri(s,a.TEXTURE_MIN_FILTER,t),a.texParameteri(s,a.TEXTURE_MAG_FILTER,n),a.texParameteri(s,a.TEXTURE_WRAP_S,e.wrapS),a.texParameteri(s,a.TEXTURE_WRAP_T,e.wrapT),Ze(this._textureFilterAnisotropic)&&a.texParameteri(s,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),a.bindTexture(s,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}}),ud.prototype.generateMipmap=function(e){e=Je(e,ei.DONT_CARE),this._hasMipmap=!0;var t=this._context._gl,n=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(n,this._texture),t.generateMipmap(n),t.bindTexture(n,null)},ud.prototype.isDestroyed=function(){return!1},ud.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._positiveX=Vt(this._positiveX),this._negativeX=Vt(this._negativeX),this._positiveY=Vt(this._positiveY),this._negativeY=Vt(this._negativeY),this._positiveZ=Vt(this._positiveZ),this._negativeZ=Vt(this._negativeZ),Vt(this)};function ld(e){this._url=e,this._cubeMapBuffers=void 0,this._cubeMaps=void 0,this._texture=void 0,this._mipTextures=void 0,this._va=void 0,this._sp=void 0,this._maximumMipmapLevel=void 0,this._loading=!1,this._ready=!1,this._readyPromise=D.defer()}Object.defineProperties(ld.prototype,{url:{get:function(){return this._url}},texture:{get:function(){return this._texture}},maximumMipmapLevel:{get:function(){return this._maximumMipmapLevel}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}}),ld.isSupported=function(e){return e.colorBufferHalfFloat&&e.halfFloatingPointTexture||e.floatingPointTexture&&e.colorBufferFloat};for(var cd=new _t(1,0,0),hd=new _t(0,0,1),fd=new _t(-1,0,0),pd=new _t(0,0,-1),dd=new _t(0,1,0),md=[dd,fd,hd,new _t(0,-1,0),cd,dd,pd,dd,dd],_d=md.length,gd=new Float32Array(3*_d),yd=0,vd=0;vd<_d;++vd,yd+=3)_t.pack(md[vd],gd,yd);var xd=new Float32Array([-1,1,-1,0,0,1,0,0,1,0,1,1,0,-1,-1,-1,1,-1]),bd=new Uint16Array([0,1,2,2,3,1,7,6,1,3,6,1,2,5,4,3,4,2,4,8,6,3,4,6]);function Ed(e){return function(){return e}}function Td(e){var t,n;e._va=e._va&&e._va.destroy(),e._sp=e._sp&&e._sp.destroy();var r=e._cubeMaps;if(Ze(r))for(n=r.length,t=0;t<n;++t)r[t].destroy();var i=e._mipTextures;if(Ze(i))for(n=i.length,t=0;t<n;++t)i[t].destroy();e._va=void 0,e._sp=void 0,e._cubeMaps=void 0,e._cubeMapBuffers=void 0,e._mipTextures=void 0}ld.prototype.update=function(e){var t=e.context;if(ld.isSupported(t)&&(Ze(this._texture)&&Ze(this._va)&&Td(this),!Ze(this._texture))){if(!Ze(this._texture)&&!this._loading){var n=t.textureCache.getTexture(this._url);if(Ze(n))return Td(this),this._texture=n,this._maximumMipmapLevel=this._texture.maximumMipmapLevel,this._ready=!0,void this._readyPromise.resolve()}var r,i,o,a,s,u=this._cubeMapBuffers;if(Ze(u)||this._loading||(Uf((r=this)._url).then(function(e){r._cubeMapBuffers=e,r._loading=!1}).otherwise(this._readyPromise.reject),this._loading=!0),Ze(this._cubeMapBuffers)){this._va=(o=Al.createVertexBuffer({context:i=t,typedArray:xd,usage:wl.STATIC_DRAW}),a=Al.createVertexBuffer({context:i,typedArray:gd,usage:wl.STATIC_DRAW}),s=Al.createIndexBuffer({context:i,typedArray:bd,usage:wl.STATIC_DRAW,indexDatatype:wa.UNSIGNED_SHORT}),new Ac({context:i,attributes:[{index:0,vertexBuffer:o,componentsPerAttribute:2,componentDatatype:Mt.FLOAT},{index:1,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:Mt.FLOAT}],indexBuffer:s})),this._sp=ic.fromCache({context:t,vertexShaderSource:"attribute vec4 position;\nattribute vec3 cubeMapCoordinates;\nvarying vec3 v_cubeMapCoordinates;\nvoid main()\n{\ngl_Position = position;\nv_cubeMapCoordinates = cubeMapCoordinates;\n}\n",fragmentShaderSource:"varying vec3 v_cubeMapCoordinates;\nuniform samplerCube cubeMap;\nvoid main()\n{\nvec4 rgbm = textureCube(cubeMap, v_cubeMapCoordinates);\nfloat m = rgbm.a * 16.0;\nvec3 r = rgbm.rgb * m;\ngl_FragColor = vec4(r * r, 1.0);\n}\n",attributeLocations:{position:0,cubeMapCoordinates:1}});var l=Math.min(u.length,6);this._maximumMipmapLevel=l-1;for(var c=this._cubeMaps=new Array(l),h=this._mipTextures=new Array(l),f=2*u[0].positiveX.width,p={originalSize:function(){return f}},d=t.halfFloatingPointTexture?Pn.HALF_FLOAT:Pn.FLOAT,m=Ln.RGBA,_=0;_<l;++_){var g=u[_].positiveY;u[_].positiveY=u[_].negativeY,u[_].negativeY=g;var y=c[_]=new ud({context:t,source:u[_]}),v=2*c[_].width,x=h[_]=new ti({context:t,width:v,height:v,pixelDatatype:d,pixelFormat:m}),b=new ad({vertexArray:this._va,shaderProgram:this._sp,uniformMap:{cubeMap:Ed(y)},outputTexture:x,persists:!0,owner:this});e.commandList.push(b),p["texture"+_]=Ed(x)}this._texture=new ti({context:t,width:1.5*f+2,height:f,pixelDatatype:d,pixelFormat:m}),this._texture.maximumMipmapLevel=this._maximumMipmapLevel,t.textureCache.addTexture(this._url,this._texture);var E=new ad({fragmentShaderSource:"varying vec2 v_textureCoordinates;\nuniform float originalSize;\nuniform sampler2D texture0;\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform sampler2D texture3;\nuniform sampler2D texture4;\nuniform sampler2D texture5;\nconst float yMipLevel1 = 1.0 - (1.0 / pow(2.0, 1.0));\nconst float yMipLevel2 = 1.0 - (1.0 / pow(2.0, 2.0));\nconst float yMipLevel3 = 1.0 - (1.0 / pow(2.0, 3.0));\nconst float yMipLevel4 = 1.0 - (1.0 / pow(2.0, 4.0));\nvoid main()\n{\nvec2 uv = v_textureCoordinates;\nvec2 textureSize = vec2(originalSize * 1.5 + 2.0, originalSize);\nvec2 pixel = 1.0 / textureSize;\nfloat mipLevel = 0.0;\nif (uv.x - pixel.x > (textureSize.y / textureSize.x))\n{\nmipLevel = 1.0;\nif (uv.y - pixel.y > yMipLevel1)\n{\nmipLevel = 2.0;\nif (uv.y - pixel.y * 3.0 > yMipLevel2)\n{\nmipLevel = 3.0;\nif (uv.y - pixel.y * 5.0 > yMipLevel3)\n{\nmipLevel = 4.0;\nif (uv.y - pixel.y * 7.0 > yMipLevel4)\n{\nmipLevel = 5.0;\n}\n}\n}\n}\n}\nif (mipLevel > 0.0)\n{\nfloat scale = pow(2.0, mipLevel);\nuv.y -= (pixel.y * (mipLevel - 1.0) * 2.0);\nuv.x *= ((textureSize.x - 2.0) / textureSize.y);\nuv.x -= 1.0 + pixel.x;\nuv.y -= (1.0 - (1.0 / pow(2.0, mipLevel - 1.0)));\nuv *= scale;\n}\nelse\n{\nuv.x *= (textureSize.x / textureSize.y);\n}\nif(mipLevel == 0.0)\n{\ngl_FragColor = texture2D(texture0, uv);\n}\nelse if(mipLevel == 1.0)\n{\ngl_FragColor = texture2D(texture1, uv);\n}\nelse if(mipLevel == 2.0)\n{\ngl_FragColor = texture2D(texture2, uv);\n}\nelse if(mipLevel == 3.0)\n{\ngl_FragColor = texture2D(texture3, uv);\n}\nelse if(mipLevel == 4.0)\n{\ngl_FragColor = texture2D(texture4, uv);\n}\nelse if(mipLevel == 5.0)\n{\ngl_FragColor = texture2D(texture5, uv);\n}\nelse\n{\ngl_FragColor = vec4(0.0);\n}\n}\n",uniformMap:p,outputTexture:this._texture,persists:!1,owner:this});e.commandList.push(E),this._ready=!0,this._readyPromise.resolve()}}},ld.prototype.isDestroyed=function(){return!1},ld.prototype.destroy=function(){return Td(this),this._texture=this._texture&&this._texture.destroy(),Vt(this)};var Sd={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3,NUMBER_OF_SHADOW_MODES:4,castShadows:function(e){return e===Sd.ENABLED||e===Sd.CAST_ONLY},receiveShadows:function(e){return e===Sd.ENABLED||e===Sd.RECEIVE_ONLY},fromCastReceive:function(e,t){return e&&t?Sd.ENABLED:e?Sd.CAST_ONLY:t?Sd.RECEIVE_ONLY:Sd.DISABLED}},Cd=Object.freeze(Sd),wd="const float Kr = 0.0025;\nconst float Km = 0.0015;\nconst float ESun = 15.0;\nconst float fKrESun = Kr * ESun;\nconst float fKmESun = Km * ESun;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float fKm4PI = Km * 4.0 * czm_pi;\nconst vec3 v3InvWavelength = vec3(5.60204474633241, 9.473284437923038, 19.64380261047721);\nconst float fScaleDepth = 0.25;\nstruct AtmosphereColor\n{\nvec3 mie;\nvec3 rayleigh;\n};\nconst int nSamples = 2;\nconst float fSamples = 2.0;\nfloat scale(float fCos)\n{\nfloat x = 1.0 - fCos;\nreturn fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool dynamicLighting, vec3 lightDirectionWC)\n{\nfloat fInnerRadius = czm_ellipsoidRadii.x;\nfloat fOuterRadius = czm_ellipsoidRadii.x * 1.025;\nfloat fOuterRadius2 = fOuterRadius * fOuterRadius;\nfloat fScale = 1.0 / (fOuterRadius - fInnerRadius);\nfloat fScaleOverScaleDepth = fScale / fScaleDepth;\nvec3 v3Ray = v3Pos - czm_viewerPositionWC;\nfloat fFar = length(v3Ray);\nv3Ray /= fFar;\nfloat fCameraHeight = length(czm_viewerPositionWC);\nfloat fCameraHeight2 = fCameraHeight * fCameraHeight;\nfloat B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\nfloat C = fCameraHeight2 - fOuterRadius2;\nfloat fDet = max(0.0, B*B - 4.0 * C);\nfloat fNear = 0.5 * (-B - sqrt(fDet));\nvec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\nfFar -= fNear;\nfloat fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\nfloat fLightAngle = czm_branchFreeTernary(dynamicLighting, dot(lightDirectionWC, v3Pos) / length(v3Pos), 1.0);\nfloat fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\nfloat fCameraScale = scale(fCameraAngle);\nfloat fLightScale = scale(fLightAngle);\nfloat fCameraOffset = fDepth*fCameraScale;\nfloat fTemp = (fLightScale + fCameraScale);\nfloat fSampleLength = fFar / fSamples;\nfloat fScaledLength = fSampleLength * fScale;\nvec3 v3SampleRay = v3Ray * fSampleLength;\nvec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\nvec3 v3FrontColor = vec3(0.0);\nvec3 v3Attenuate = vec3(0.0);\nfor(int i=0; i<nSamples; i++)\n{\nfloat fHeight = length(v3SamplePoint);\nfloat fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\nfloat fScatter = fDepth*fTemp - fCameraOffset;\nv3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\nv3FrontColor += v3Attenuate * (fDepth * fScaledLength);\nv3SamplePoint += v3SampleRay;\n}\nAtmosphereColor color;\ncolor.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\ncolor.rayleigh = v3Attenuate;\nreturn color;\n}\n";function Ad(e){var t;if(Ze(t=e instanceof ArrayBuffer||ArrayBuffer.isView(e)?D.resolve(e):rt.createIfNeeded(e).fetchArrayBuffer()))return t.then(function(e){if(Ze(e))return function(e){var t,n=new Uint8Array(e),r=0,i=!0;for(t=0;t<Id.length;++t)if(Id[t]!==n[t]){i=!1;break}if(!i)throw new de("Invalid ETC file.");r+=Id.length;var o=[2];o[0]=String.fromCharCode(n[r]),o[1]=String.fromCharCode(n[r+1]);var a,s=65535&(n[r+=2]<<8|n[r+1]),u=65535&(n[r+=2]<<8|n[r+1]),l=65535&(n[r+=2]<<8|n[r+1]);r+=2,r+=2,r=16,a=Ze(e.buffer)?(r+=e.byteOffset,new Uint8Array(e.buffer,r)):new Uint8Array(e,r);var c=Ln.RGB_ETC1;0==s?c=Ln.RGB_ETC1:1==s?c=Ln.RGB_ETC2:3==s&&(c=Ln.RGBA_ETC2);var h=a.byteOffset,f=new Array(1);for(t=0;t<1;++t){for(var p=f[t]={},d=0;d<1;++d){u<1&&(u=1),l<1&&(l=1);var m=Ln.isCompressedFormat(c)?Ln.compressedTextureSizeInBytes(c,u,l):Ln.textureSizeInBytes(c,0,u,l),_=new Uint8Array(a.buffer,h,m);p[Pd[d]]=new Af(c,u,l,_),h+=m}Ze(e.buffer)?h+=4:h+=3-(h+3)%4+4}var g=f;for(t=0;t<1;++t)g[t]=g[t][Pd[0]];return g=g[0]}(e)})}var Id=[80,75,77,32],Pd=["positiveX","negativeX","positiveY","negativeY","positiveZ","negativeZ"];function Od(){this._array=[],this._hash={}}function Ld(e,t,n,r){e=Je(e,1),t=Je(t,1),n=Je(n,1),r=Je(r,1),this.value=new Uint8Array([It.floatToByte(e),It.floatToByte(t),It.floatToByte(n),It.floatToByte(r)])}function Nd(e){e=Je(e,Je.EMPTY_OBJECT),this.geometry=e.geometry,this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this.id=e.id,this.pickPrimitive=e.pickPrimitive,this.attributes=Je(e.attributes,{}),this.westHemisphereGeometry=void 0,this.eastHemisphereGeometry=void 0}function Rd(e){e=Je(e,Je.EMPTY_OBJECT),this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=Je(e.normalize,!1),this.values=e.values}function Dd(e){e=Je(e,Je.EMPTY_OBJECT),this.position=e.position,this.normal=e.normal,this.st=e.st,this.bitangent=e.bitangent,this.tangent=e.tangent,this.color=e.color}Object.defineProperties(Od.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}}),Od.prototype.contains=function(e){return Ze(this._hash[e])},Od.prototype.set=function(e,t){t!==this._hash[e]&&(this.remove(e),this._hash[e]=t,this._array.push(t))},Od.prototype.get=function(e){return this._hash[e]},Od.prototype.remove=function(e){var t,n=this._hash[e],r=Ze(n);return r&&((t=this._array).splice(t.indexOf(n),1),delete this._hash[e]),r},Od.prototype.removeAll=function(){var e=this._array;0<e.length&&(this._hash={},e.length=0)},Object.defineProperties(Ld.prototype,{componentDatatype:{get:function(){return Mt.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}}),Ld.fromColor=function(e){return new Ld(e.red,e.green,e.blue,e.alpha)},Ld.toValue=function(e,t){return Ze(t)?e.toBytes(t):new Uint8Array(e.toBytes())},Ld.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.value[0]===t.value[0]&&e.value[1]===t.value[1]&&e.value[2]===t.value[2]&&e.value[3]===t.value[3]};var Md=Object.freeze({NONE:0,TOP:1,ALL:2}),Fd=new _t(1,1,1),zd=Math.cos,Bd=Math.sin;function Ud(e){e=Je(e,Je.EMPTY_OBJECT);var t=Je(e.radii,Fd),n=Je(e.innerRadii,t),r=Je(e.minimumClock,0),i=Je(e.maximumClock,pt.TWO_PI),o=Je(e.minimumCone,0),a=Je(e.maximumCone,pt.PI),s=Math.round(Je(e.stackPartitions,10)),u=Math.round(Je(e.slicePartitions,8)),l=Math.round(Je(e.subdivisions,128));this._radii=_t.clone(t),this._innerRadii=_t.clone(n),this._minimumClock=r,this._maximumClock=i,this._minimumCone=o,this._maximumCone=a,this._stackPartitions=s,this._slicePartitions=u,this._subdivisions=l,this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidOutlineGeometry"}Ud.packedLength=2*_t.packedLength+8,Ud.pack=function(e,t,n){return n=Je(n,0),_t.pack(e._radii,t,n),n+=_t.packedLength,_t.pack(e._innerRadii,t,n),n+=_t.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n++]=e._subdivisions,t[n]=Je(e._offsetAttribute,-1),t};var Vd=new _t,kd=new _t,Gd={radii:Vd,innerRadii:kd,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0,offsetAttribute:void 0};function qd(e){var t=Je(e.radius,1),n={radii:new _t(t,t,t),stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,subdivisions:e.subdivisions};this._ellipsoidGeometry=new Ud(n),this._workerName="createSphereOutlineGeometry"}Ud.unpack=function(e,t,n){t=Je(t,0);var r=_t.unpack(e,t,Vd),i=_t.unpack(e,t+=_t.packedLength,kd);t+=_t.packedLength;var o=e[t++],a=e[t++],s=e[t++],u=e[t++],l=e[t++],c=e[t++],h=e[t++],f=e[t];return Ze(n)?(n._radii=_t.clone(r,n._radii),n._innerRadii=_t.clone(i,n._innerRadii),n._minimumClock=o,n._maximumClock=a,n._minimumCone=s,n._maximumCone=u,n._stackPartitions=l,n._slicePartitions=c,n._subdivisions=h,n._offsetAttribute=-1===f?void 0:f,n):(Gd.minimumClock=o,Gd.maximumClock=a,Gd.minimumCone=s,Gd.maximumCone=u,Gd.stackPartitions=l,Gd.slicePartitions=c,Gd.subdivisions=h,Gd.offsetAttribute=-1===f?void 0:f,new Ud(Gd))},Ud.createGeometry=function(e){var t=e._radii;if(!(t.x<=0||t.y<=0||t.z<=0)){var n=e._innerRadii;if(!(n.x<=0||n.y<=0||n.z<=0)){var r=e._minimumClock,i=e._maximumClock,o=e._minimumCone,a=e._maximumCone,s=e._subdivisions,u=Wn.fromCartesian3(t),l=e._slicePartitions+1,c=e._stackPartitions+1;(l=Math.round(l*Math.abs(i-r)/pt.TWO_PI))<2&&(l=2),(c=Math.round(c*Math.abs(a-o)/pt.PI))<2&&(c=2);var h=0,f=1,p=n.x!==t.x||n.y!==t.y||n.z!==t.z,d=!1,m=!1;p&&(f=2,0<o&&(d=!0,h+=l),a<Math.PI&&(m=!0,h+=l));for(var _,g,y=s*f*(c+l),v=new Float64Array(3*y),x=2*(y+h-(l+c)*f),b=wa.createTypedArray(y,x),E=0,T=new Array(c),S=new Array(c),C=0;C<c;C++)g=o+C*(a-o)/(c-1),T[C]=Bd(g),S[C]=zd(g);var w=new Array(s),A=new Array(s);for(C=0;C<s;C++)_=r+C*(i-r)/(s-1),w[C]=Bd(_),A[C]=zd(_);for(C=0;C<c;C++)for(P=0;P<s;P++)v[E++]=t.x*T[C]*A[P],v[E++]=t.y*T[C]*w[P],v[E++]=t.z*S[C];if(p)for(C=0;C<c;C++)for(P=0;P<s;P++)v[E++]=n.x*T[C]*A[P],v[E++]=n.y*T[C]*w[P],v[E++]=n.z*S[C];for(T.length=s,S.length=s,C=0;C<s;C++)g=o+C*(a-o)/(s-1),T[C]=Bd(g),S[C]=zd(g);for(w.length=l,A.length=l,C=0;C<l;C++)_=r+C*(i-r)/(l-1),w[C]=Bd(_),A[C]=zd(_);for(C=0;C<s;C++)for(P=0;P<l;P++)v[E++]=t.x*T[C]*A[P],v[E++]=t.y*T[C]*w[P],v[E++]=t.z*S[C];if(p)for(C=0;C<s;C++)for(P=0;P<l;P++)v[E++]=n.x*T[C]*A[P],v[E++]=n.y*T[C]*w[P],v[E++]=n.z*S[C];for(C=E=0;C<c*f;C++)for(var I=C*s,P=0;P<s-1;P++)b[E++]=I+P,b[E++]=I+P+1;var O=c*s*f;for(C=0;C<l;C++)for(P=0;P<s-1;P++)b[E++]=O+C+P*l,b[E++]=O+C+(P+1)*l;if(p)for(O=c*s*f+l*s,C=0;C<l;C++)for(P=0;P<s-1;P++)b[E++]=O+C+P*l,b[E++]=O+C+(P+1)*l;if(p){var L=c*s*f,N=L+s*l;if(d)for(C=0;C<l;C++)b[E++]=L+C,b[E++]=N+C;if(m)for(L+=s*l-l,N+=s*l-l,C=0;C<l;C++)b[E++]=L+C,b[E++]=N+C}var R,D,M=new Dd({position:new Rd({componentDatatype:Mt.DOUBLE,componentsPerAttribute:3,values:v})});return Ze(e._offsetAttribute)&&(R=v.length,bn(D=new Uint8Array(R/3),e._offsetAttribute===Md.NONE?0:1),M.applyOffset=new Rd({componentDatatype:Mt.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})),new dc({attributes:M,indices:b,primitiveType:Dn.LINES,boundingSphere:ko.fromEllipsoid(u),offsetAttribute:e._offsetAttribute})}}},qd.packedLength=Ud.packedLength,qd.pack=function(e,t,n){return Ud.pack(e._ellipsoidGeometry,t,n)};var Hd=new Ud,Wd={radius:void 0,radii:new _t,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0};function Yd(e){e=Je(e,Je.EMPTY_OBJECT),this.position=Je(e.position,!1),this.normal=Je(e.normal,!1),this.st=Je(e.st,!1),this.bitangent=Je(e.bitangent,!1),this.tangent=Je(e.tangent,!1),this.color=Je(e.color,!1)}qd.unpack=function(e,t,n){var r=Ud.unpack(e,t,Hd);return Wd.stackPartitions=r._stackPartitions,Wd.slicePartitions=r._slicePartitions,Wd.subdivisions=r._subdivisions,Ze(n)?(_t.clone(r._radii,Wd.radii),n._ellipsoidGeometry=new Ud(Wd),n):(Wd.radius=r._radii.x,new qd(Wd))},qd.createGeometry=function(e){return Ud.createGeometry(e._ellipsoidGeometry)},Yd.POSITION_ONLY=Object.freeze(new Yd({position:!0})),Yd.POSITION_AND_NORMAL=Object.freeze(new Yd({position:!0,normal:!0})),Yd.POSITION_NORMAL_AND_ST=Object.freeze(new Yd({position:!0,normal:!0,st:!0})),Yd.POSITION_AND_ST=Object.freeze(new Yd({position:!0,st:!0})),Yd.POSITION_AND_COLOR=Object.freeze(new Yd({position:!0,color:!0})),Yd.ALL=Object.freeze(new Yd({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0})),Yd.DEFAULT=Yd.POSITION_NORMAL_AND_ST,Yd.packedLength=6,Yd.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.position?1:0,t[n++]=e.normal?1:0,t[n++]=e.st?1:0,t[n++]=e.tangent?1:0,t[n++]=e.bitangent?1:0,t[n]=e.color?1:0,t},Yd.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new Yd),n.position=1===e[t++],n.normal=1===e[t++],n.st=1===e[t++],n.tangent=1===e[t++],n.bitangent=1===e[t++],n.color=1===e[t],n},Yd.clone=function(e,t){if(Ze(e))return Ze(t)||(t=new Yd),t.position=e.position,t.normal=e.normal,t.st=e.st,t.tangent=e.tangent,t.bitangent=e.bitangent,t.color=e.color,t};var Xd="varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvarying vec4 ev_pickColor;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nvec4 color = czm_gammaCorrect(v_color);\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getDefaultMaterial(materialInput);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\ngl_FragColor.rgb*=ev_pickColor.rgb;\n}\n",jd="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",Kd="varying vec4 v_color;\nvarying vec4 ev_pickColor;\nvoid main()\n{\ngl_FragColor = czm_gammaCorrect(v_color);\ngl_FragColor.rgb*=ev_pickColor.rgb;\n}\n",Qd="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 color;\nattribute float batchId;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n";function Zd(e){e=Je(e,Je.EMPTY_OBJECT),this.material=e.material,this.translucent=Je(e.translucent,!0),this._vertexShaderSource=e.vertexShaderSource,this._fragmentShaderSource=e.fragmentShaderSource,this._renderState=e.renderState,this._closed=Je(e.closed,!1)}function Jd(e){e=Je(e,Je.EMPTY_OBJECT);var t=Je(e.translucent,!0),n=Je(e.closed,!1),r=Je(e.flat,!1),i=r?Qd:jd,o=r?Kd:Xd,a=r?Jd.FLAT_VERTEX_FORMAT:Jd.VERTEX_FORMAT;this.material=void 0,this.translucent=t,this._vertexShaderSource=Je(e.vertexShaderSource,i),this._fragmentShaderSource=Je(e.fragmentShaderSource,o),this._renderState=Zd.getDefaultRenderState(t,n,e.renderState),this._closed=n,this._vertexFormat=a,this._flat=r,this._faceForward=Je(e.faceForward,!n)}function $d(){this.high=_t.clone(_t.ZERO),this.low=_t.clone(_t.ZERO)}Object.defineProperties(Zd.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}}),Zd.prototype.getFragmentShaderSource=function(){var e=[];return this.flat&&e.push("#define FLAT"),this.faceForward&&e.push("#define FACE_FORWARD"),Ze(this.material)&&e.push(this.material.shaderSource),e.push(this.fragmentShaderSource),e.join("\n")},Zd.prototype.isTranslucent=function(){return Ze(this.material)&&this.material.isTranslucent()||!Ze(this.material)&&this.translucent},Zd.prototype.getRenderState=function(){var e=this.isTranslucent(),t=$e(this.renderState,!1);return e?(t.depthMask=!1,t.blending=ui.ALPHA_BLEND):t.depthMask=!0,t},Zd.getDefaultRenderState=function(e,t,n){var r={depthTest:{enabled:!0}};return e&&(r.depthMask=!1,r.blending=ui.ALPHA_BLEND),t&&(r.cull={enabled:!0,face:hi.BACK}),Ze(n)&&(r=ne(n,r,!0)),r},Object.defineProperties(Jd.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),Jd.VERTEX_FORMAT=Yd.POSITION_AND_NORMAL,Jd.FLAT_VERTEX_FORMAT=Yd.POSITION_ONLY,Jd.prototype.getFragmentShaderSource=Zd.prototype.getFragmentShaderSource,Jd.prototype.isTranslucent=Zd.prototype.isTranslucent,Jd.prototype.getRenderState=Zd.prototype.getRenderState,$d.encode=function(e,t){var n;return Ze(t)||(t={high:0,low:0}),0<=e?(n=65536*Math.floor(e/65536),t.high=n,t.low=e-n):(n=65536*Math.floor(-e/65536),t.high=-n,t.low=e+n),t};var em={high:0,low:0};$d.fromCartesian=function(e,t){Ze(t)||(t=new $d);var n=t.high,r=t.low;return $d.encode(e.x,em),n.x=em.high,r.x=em.low,$d.encode(e.y,em),n.y=em.high,r.y=em.low,$d.encode(e.z,em),n.z=em.high,r.z=em.low,t};var tm=new $d;function nm(e,t,n){var r,i,o,a,s,u,l,c,h,f,p,d,m,_;this._attributes=t,this._numberOfInstances=n,0!==t.length&&(r=function(e){for(var t=!1,n=e.length,r=0;r<n;++r)if(e[r].componentDatatype!==Mt.UNSIGNED_BYTE){t=!0;break}return t?Pn.FLOAT:Pn.UNSIGNED_BYTE}(t),i=e.floatingPointTexture,s=function(e,t,n){var r=e.length,i=e[r-1];if(t[r-1].componentDatatype!==Mt.UNSIGNED_BYTE&&n)return i+4;return i+1}(a=function(e,t){for(var n=new Array(e.length),r=0,i=e.length,o=0;o<i;++o){var a=e[o].componentDatatype;n[o]=r,a!==Mt.UNSIGNED_BYTE&&t?r+=4:++r}return n}(t,o=r===Pn.FLOAT&&!i),t,o),u=Math.floor(Nn.maximumTextureSize/s),p=.5*(f=1/(c=s*(l=Math.min(n,u)))),m=.5*(d=1/(h=Math.ceil(n/l))),this._textureDimensions=new En(c,h),this._textureStep=new qt(f,p,d,m),this._pixelDatatype=o?Pn.UNSIGNED_BYTE:r,this._packFloats=o,this._offsets=a,this._stride=s,this._texture=void 0,_=4*c*h,this._batchValues=new(r!==Pn.FLOAT||o?Uint8Array:Float32Array)(_),this._batchValuesDirty=!1)}function rm(e,t){var n=e[t].componentsPerAttribute;return 2===n?En:3===n?_t:4===n?qt:Number}$d.writeElements=function(e,t,n){$d.fromCartesian(e,tm);var r=tm.high,i=tm.low;t[n]=r.x,t[n+1]=r.y,t[n+2]=r.z,t[n+3]=i.x,t[n+4]=i.y,t[n+5]=i.z},Object.defineProperties(nm.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});var im=new qt;var om=new qt;nm.prototype.getBatchedAttribute=function(e,t,n){var r=this._attributes,i=this._offsets[t],o=4*this._stride*e+4*i,a=this._packFloats&&r[t].componentDatatype!==Pn.UNSIGNED_BYTE?function(e,t,n){var r=qt.unpack(e,t,im),i=qt.unpackFloat(r),r=qt.unpack(e,t+4,im),o=qt.unpackFloat(r);r=qt.unpack(e,t+8,im);var a=qt.unpackFloat(r);r=qt.unpack(e,t+12,im);var s=qt.unpackFloat(r);return qt.fromElements(i,o,a,s,n)}(this._batchValues,o,om):qt.unpack(this._batchValues,o,om),s=rm(r,t);return Ze(s.fromCartesian4)?s.fromCartesian4(a,n):Ze(s.clone)?s.clone(a,n):a.x};var am=[void 0,void 0,new En,new _t,new qt],sm=new qt;nm.prototype.setBatchedAttribute=function(e,t,n){var r,i,o,a,s,u,l,c=this._attributes,h=am[c[t].componentsPerAttribute],f=this.getBatchedAttribute(e,t,h),p=rm(this._attributes,t);(Ze(p.equals)?p.equals(f,n):f===n)||((r=sm).x=Ze(n.x)?n.x:n,r.y=Ze(n.y)?n.y:0,r.z=Ze(n.z)?n.z:0,r.w=Ze(n.w)?n.w:0,i=this._offsets[t],o=4*this._stride*e+4*i,this._packFloats&&c[t].componentDatatype!==Pn.UNSIGNED_BYTE?(a=r,s=this._batchValues,u=o,l=qt.packFloat(a.x,im),qt.pack(l,s,u),l=qt.packFloat(a.y,l),qt.pack(l,s,u+4),l=qt.packFloat(a.z,l),qt.pack(l,s,u+8),l=qt.packFloat(a.w,l),qt.pack(l,s,u+12)):qt.pack(r,this._batchValues,o),this._batchValuesDirty=!0)},nm.prototype.update=function(e){var t,n,r,i,o;Ze(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,Ze(this._texture)||(t=this,n=e.context,r=t._textureDimensions,t._texture=new ti({context:n,pixelFormat:Ln.RGBA,pixelDatatype:t._pixelDatatype,width:r.x,height:r.y,sampler:Nr.NEAREST,flipY:!1})),o=(i=this)._textureDimensions,i._texture.copyFrom({width:o.x,height:o.y,arrayBufferView:i._batchValues}))},nm.prototype.getUniformMapCallback=function(){var t=this;return function(e){return 0===t._attributes.length?e:ne(e,{batchTexture:function(){return t._texture},batchTextureDimensions:function(){return t._textureDimensions},batchTextureStep:function(){return t._textureStep}})}},nm.prototype.getVertexShaderCallback=function(){var e=this._attributes;if(0===e.length)return function(e){return e};var t,n,i="uniform highp sampler2D batchTexture; \n";i+=(n=(t=this)._stride,(1===t._textureDimensions.y?"uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float numberOfAttributes = float("+n+"); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n":"uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float stepY = batchTextureStep.z; \n    float centerY = batchTextureStep.w; \n    float numberOfAttributes = float("+n+"); \n    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n")+"\n");for(var r,o,a,s,u,l,c,h,f,p,d=e.length,m=0;m<d;++m)i+=(o=m,p=s=a=void 0,u=(r=this)._attributes[o],l=u.componentsPerAttribute,c=u.functionName,h=1===(a=l)?"float":"vec"+a,f=1===(s=l)?".x":2===s?".xy":3===s?".xyz":"",p=h+" "+c+"(float batchId) \n{ \n    vec2 st = computeSt(batchId); \n    st.x += batchTextureStep.x * float("+r._offsets[o]+"); \n",r._packFloats&&u.componentDatatype!==Pn.UNSIGNED_BYTE?p+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":p+="    vec4 textureValue = texture2D(batchTexture, st); \n",p+="    "+h+" value = textureValue"+f+"; \n",r._pixelDatatype!==Pn.UNSIGNED_BYTE||u.componentDatatype!==Mt.UNSIGNED_BYTE||u.normalize?r._pixelDatatype===Pn.FLOAT&&u.componentDatatype===Mt.UNSIGNED_BYTE&&u.normalize&&(p+="value /= 255.0; \n"):p+="value *= 255.0; \n",p+="    return value; \n} \n");return function(e){var t=e.indexOf("void main"),n=e.substring(0,t),r=e.substring(t);return n+"\n"+i+"\n"+r}},nm.prototype.isDestroyed=function(){return!1},nm.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Vt(this)};var um=new _t,lm=new _t,cm=new _t;var hm={};function fm(e,t,n){var r=e+t;return pt.sign(e)!==pt.sign(t)&&Math.abs(r/Math.max(Math.abs(e),Math.abs(t)))<n?0:r}hm.computeDiscriminant=function(e,t,n){return t*t-4*e*n},hm.computeRealRoots=function(e,t,n){var r;if(0===e)return 0===t?[]:[-n/t];if(0===t){if(0===n)return[0,0];var i=Math.abs(n),o=Math.abs(e);if(i<o&&i/o<pt.EPSILON14)return[0,0];if(o<i&&o/i<pt.EPSILON14)return[];if((r=-n/e)<0)return[];var a=Math.sqrt(r);return[-a,a]}if(0===n)return(r=-t/e)<0?[r,0]:[0,r];var s=fm(t*t,-(4*e*n),pt.EPSILON14);if(s<0)return[];var u=-.5*fm(t,pt.sign(t)*Math.sqrt(s),pt.EPSILON14);return 0<t?[u/e,n/u]:[n/u,u/e]};var pm={};function dm(e,t,n,r){var i=e,o=t/3,a=n/3,s=r,u=i*a,l=o*s,c=o*o,h=a*a,f=i*a-c,p=i*s-o*a,d=o*s-h,m=4*f*d-p*p;if(m<0){var _,g,y,v=u*h<=c*l?-2*o*(g=f)+(_=i)*p:-(_=s)*p+2*a*(g=d),x=-(v<0?-1:1)*Math.abs(_)*Math.sqrt(-m),b=(y=x-v)/2,E=b<0?-Math.pow(-b,1/3):Math.pow(b,1/3),T=y===x?-E:-g/E,S=g<=0?E+T:-v/(E*E+T*T+g);return u*h<=c*l?[(S-o)/i]:[-s/(S+a)]}var C=f,w=-2*o*f+i*p,A=d,I=-s*p+2*a*d,P=Math.sqrt(m),O=Math.sqrt(3)/2,L=Math.abs(Math.atan2(i*P,-w)/3);S=2*Math.sqrt(-C);var N=Math.cos(L);y=S*N;var R=S*(-N/2-O*Math.sin(L)),D=2*o<y+R?y-o:R-o,M=i,F=D/M,L=Math.abs(Math.atan2(s*P,-I)/3),z=-s,B=(y=(S=2*Math.sqrt(-A))*(N=Math.cos(L)))+(R=S*(-N/2-O*Math.sin(L)))<2*a?y+a:R+a,U=z/B,V=-D*B-M*z,k=(a*V-o*(D*z))/(-o*V+a*(M*B));return F<=k?F<=U?k<=U?[F,k,U]:[F,U,k]:[U,F,k]:F<=U?[k,F,U]:k<=U?[k,U,F]:[U,k,F]}pm.computeDiscriminant=function(e,t,n,r){var i=t*t,o=n*n;return 18*e*t*n*r+i*o-27*(e*e)*(r*r)-4*(e*o*n+i*t*r)},pm.computeRealRoots=function(e,t,n,r){var i,o;if(0===e)return hm.computeRealRoots(t,n,r);if(0!==t)return 0===n?0===r?(o=-t/e)<0?[o,0,0]:[0,0,o]:dm(e,t,0,r):0===r?0===(i=hm.computeRealRoots(e,t,n)).length?[0]:i[1]<=0?[i[0],i[1],0]:0<=i[0]?[0,i[0],i[1]]:[i[0],0,i[1]]:dm(e,t,n,r);if(0!==n)return 0===r?0===(i=hm.computeRealRoots(e,0,n)).Length?[0]:[i[0],0,i[1]]:dm(e,0,n,r);if(0===r)return[0,0,0];var a=(o=-r/e)<0?-Math.pow(-o,1/3):Math.pow(o,1/3);return[a,a,a]};var mm={};function _m(e,t,n,r){var i=e*e,o=t-3*i/8,a=n-t*e/2+i*e/8,s=r-n*e/4+t*i/16-3*i*i/256,u=pm.computeRealRoots(1,2*o,o*o-4*s,-a*a);if(0<u.length){var l=-e/4,c=u[u.length-1];if(Math.abs(c)<pt.EPSILON14){var h=hm.computeRealRoots(1,o,s);if(2===h.length){var f,p=h[0],d=h[1];if(0<=p&&0<=d){var m=Math.sqrt(p),_=Math.sqrt(d);return[l-_,l-m,l+m,l+_]}if(0<=p&&d<0)return[l-(f=Math.sqrt(p)),l+f];if(p<0&&0<=d)return[l-(f=Math.sqrt(d)),l+f]}return[]}if(0<c){var g=Math.sqrt(c),y=(o+c-a/g)/2,v=(o+c+a/g)/2,x=hm.computeRealRoots(1,g,y),b=hm.computeRealRoots(1,-g,v);return 0!==x.length?(x[0]+=l,x[1]+=l,0!==b.length?(b[0]+=l,b[1]+=l,x[1]<=b[0]?[x[0],x[1],b[0],b[1]]:b[1]<=x[0]?[b[0],b[1],x[0],x[1]]:x[0]>=b[0]&&x[1]<=b[1]?[b[0],x[0],x[1],b[1]]:b[0]>=x[0]&&b[1]<=x[1]?[x[0],b[0],b[1],x[1]]:x[0]>b[0]&&x[0]<b[1]?[b[0],x[0],b[1],x[1]]:[x[0],b[0],x[1],b[1]]):x):0!==b.length?(b[0]+=l,b[1]+=l,b):[]}}return[]}function gm(e,t,n,r){var i=e*e,o=-2*t,a=n*e+t*t-4*r,s=i*r-n*t*e+n*n,u=pm.computeRealRoots(1,o,a,s);if(0<u.length){var l,c,h,f,p,d,m,_,g=u[0],y=t-g,v=y*y,x=e/2,b=y/2,E=v-4*r,T=v+4*Math.abs(r),S=i-4*g,C=i+4*Math.abs(g);h=g<0||E*C<S*T?(c=(l=Math.sqrt(S))/2,0===l?0:(e*b-n)/l):(c=0===(f=Math.sqrt(E))?0:(e*b-n)/f,f/2),0==x&&0===c?d=p=0:pt.sign(x)===pt.sign(c)?d=g/(p=x+c):p=g/(d=x-c),0==b&&0===h?_=m=0:pt.sign(b)===pt.sign(h)?_=r/(m=b+h):m=r/(_=b-h);var w=hm.computeRealRoots(1,p,m),A=hm.computeRealRoots(1,d,_);if(0!==w.length)return 0!==A.length?w[1]<=A[0]?[w[0],w[1],A[0],A[1]]:A[1]<=w[0]?[A[0],A[1],w[0],w[1]]:w[0]>=A[0]&&w[1]<=A[1]?[A[0],w[0],w[1],A[1]]:A[0]>=w[0]&&A[1]<=w[1]?[w[0],A[0],A[1],w[1]]:w[0]>A[0]&&w[0]<A[1]?[A[0],w[0],A[1],w[1]]:[w[0],A[0],w[1],A[1]]:w;if(0!==A.length)return A}return[]}function ym(e,t){t=_t.clone(Je(t,_t.ZERO)),_t.equals(t,_t.ZERO)||_t.normalize(t,t),this.origin=_t.clone(Je(e,_t.ZERO)),this.direction=t}mm.computeDiscriminant=function(e,t,n,r,i){var o=e*e,a=t*t,s=a*t,u=n*n,l=u*n,c=r*r,h=c*r,f=i*i;return a*u*c-4*s*h-4*e*l*c+18*e*t*n*h-27*o*c*c+256*(o*e)*(f*i)+i*(18*s*n*r-4*a*l+16*e*u*u-80*e*t*u*r-6*e*a*c+144*o*n*c)+f*(144*e*a*n-27*a*a-128*o*u-192*o*t*r)},mm.computeRealRoots=function(e,t,n,r,i){if(Math.abs(e)<pt.EPSILON15)return pm.computeRealRoots(t,n,r,i);var o=t/e,a=n/e,s=r/e,u=i/e,l=o<0?1:0;switch(l+=a<0?l+1:l,l+=s<0?l+1:l,l+=u<0?l+1:l){case 0:return _m(o,a,s,u);case 1:case 2:return gm(o,a,s,u);case 3:case 4:return _m(o,a,s,u);case 5:return gm(o,a,s,u);case 6:case 7:return _m(o,a,s,u);case 8:return gm(o,a,s,u);case 9:case 10:return _m(o,a,s,u);case 11:return gm(o,a,s,u);case 12:case 13:case 14:case 15:return _m(o,a,s,u);default:return}},ym.clone=function(e,t){if(Ze(e))return Ze(t)?(t.origin=_t.clone(e.origin),t.direction=_t.clone(e.direction),t):new ym(e.origin,e.direction)},ym.getPoint=function(e,t,n){return Ze(n)||(n=new _t),n=_t.multiplyByScalar(e.direction,t,n),_t.add(e.origin,n,n)};var vm={rayPlane:function(e,t,n){Ze(n)||(n=new _t);var r=e.origin,i=e.direction,o=t.normal,a=_t.dot(o,i);if(!(Math.abs(a)<pt.EPSILON15)){var s=(-t.distance-_t.dot(o,r))/a;if(!(s<0))return n=_t.multiplyByScalar(i,s,n),_t.add(r,n,n)}}},xm=new _t,bm=new _t,Em=new _t,Tm=new _t,Sm=new _t;vm.rayTriangleParametric=function(e,t,n,r,i){i=Je(i,!1);var o,a,s,u=e.origin,l=e.direction,c=_t.subtract(n,t,xm),h=_t.subtract(r,t,bm),f=_t.cross(l,h,Em),p=_t.dot(c,f);if(i){if(p<pt.EPSILON6)return;if(_=_t.subtract(u,t,Tm),(d=_t.dot(_,f))<0||p<d)return;if(o=_t.cross(_,c,Sm),(a=_t.dot(l,o))<0||p<d+a)return;s=_t.dot(h,o)/p}else{if(Math.abs(p)<pt.EPSILON6)return;var d,m=1/p,_=_t.subtract(u,t,Tm);if((d=_t.dot(_,f)*m)<0||1<d)return;if(o=_t.cross(_,c,Sm),(a=_t.dot(l,o)*m)<0||1<d+a)return;s=_t.dot(h,o)*m}return s},vm.rayTriangle=function(e,t,n,r,i,o){var a=vm.rayTriangleParametric(e,t,n,r,i);if(Ze(a)&&!(a<0))return Ze(o)||(o=new _t),_t.multiplyByScalar(e.direction,a,o),_t.add(e.origin,o,o)};var Cm=new ym;vm.lineSegmentTriangle=function(e,t,n,r,i,o,a){var s=Cm;_t.clone(e,s.origin),_t.subtract(t,e,s.direction),_t.normalize(s.direction,s.direction);var u=vm.rayTriangleParametric(s,n,r,i,o);if(!(!Ze(u)||u<0||u>_t.distance(e,t)))return Ze(a)||(a=new _t),_t.multiplyByScalar(s.direction,u,a),_t.add(s.origin,a,a)};var wm={root0:0,root1:0};function Am(e,t,n){Ze(n)||(n=new Vo);var r=e.origin,i=e.direction,o=t.center,a=t.radius*t.radius,s=_t.subtract(r,o,Em),u=function(e,t,n,r){var i=t*t-4*e*n;if(!(i<0)){if(0<i){var o=1/(2*e),a=Math.sqrt(i),s=(-t+a)*o,u=(-t-a)*o;return s<u?(r.root0=s,r.root1=u):(r.root0=u,r.root1=s),r}var l=-t/(2*e);if(0!=l)return r.root0=r.root1=l,r}}(_t.dot(i,i),2*_t.dot(i,s),_t.magnitudeSquared(s)-a,wm);if(Ze(u))return n.start=u.root0,n.stop=u.root1,n}vm.raySphere=function(e,t,n){if(Ze(n=Am(e,t,n))&&!(n.stop<0))return n.start=Math.max(n.start,0),n};var Im=new ym;vm.lineSegmentSphere=function(e,t,n,r){var i=Im;_t.clone(e,i.origin);var o=_t.subtract(t,e,i.direction),a=_t.magnitude(o);if(_t.normalize(o,o),!(!Ze(r=Am(i,n,r))||r.stop<0||r.start>a))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,a),r};var Pm=new _t,Om=new _t;function Lm(e,t,n){var r=e+t;return pt.sign(e)!==pt.sign(t)&&Math.abs(r/Math.max(Math.abs(e),Math.abs(t)))<n?0:r}vm.rayEllipsoid=function(e,t){var n,r,i=t.oneOverRadii,o=_t.multiplyComponents(i,e.origin,Pm),a=_t.multiplyComponents(i,e.direction,Om),s=_t.magnitudeSquared(o),u=_t.dot(o,a);if(1<s){if(0<=u)return;var l,c,h=u*u,f=s-1;if(h<(c=(l=_t.magnitudeSquared(a))*f))return;if(c<h){n=u*u-c;var p=(r=-u+Math.sqrt(n))/l,d=f/r;return p<d?new Vo(p,d):{start:d,stop:p}}var m=Math.sqrt(f/l);return new Vo(m,m)}return s<1?(f=s-1,n=u*u-(c=(l=_t.magnitudeSquared(a))*f),new Vo(0,(r=-u+Math.sqrt(n))/l)):u<0?new Vo(0,-u/(l=_t.magnitudeSquared(a))):void 0};var Nm=new _t,Rm=new _t,Dm=new _t,Mm=new _t,Fm=new _t,zm=new jt,Bm=new jt,Um=new jt,Vm=new jt,km=new jt,Gm=new jt,qm=new jt,Hm=new _t,Wm=new _t,Ym=new Un;vm.grazingAltitudeLocation=function(e,t){var n=e.origin,r=e.direction;if(!_t.equals(n,_t.ZERO)){var i=t.geodeticSurfaceNormal(n,Nm);if(0<=_t.dot(r,i))return n}var o=Ze(this.rayEllipsoid(e,t)),a=t.transformPositionToScaledSpace(r,Nm),s=_t.normalize(a,a),u=_t.mostOrthogonalAxis(a,Mm),l=_t.normalize(_t.cross(u,s,Rm),Rm),c=_t.normalize(_t.cross(s,l,Dm),Dm),h=zm;h[0]=s.x,h[1]=s.y,h[2]=s.z,h[3]=l.x,h[4]=l.y,h[5]=l.z,h[6]=c.x,h[7]=c.y,h[8]=c.z;var f=jt.transpose(h,Bm),p=jt.fromScale(t.radii,Um),d=jt.fromScale(t.oneOverRadii,Vm),m=km;m[0]=0,m[1]=-r.z,m[2]=r.y,m[3]=r.z,m[4]=0,m[5]=-r.x,m[6]=-r.y,m[7]=r.x,m[8]=0;var _,g=jt.multiply(jt.multiply(f,d,Gm),m,Gm),y=jt.multiply(jt.multiply(g,p,qm),h,qm),v=jt.multiplyByVector(g,n,Fm),x=function(e,t,n,r,i){var o,a=r*r,s=i*i,u=(e[jt.COLUMN1ROW1]-e[jt.COLUMN2ROW2])*s,l=i*(r*Lm(e[jt.COLUMN1ROW0],e[jt.COLUMN0ROW1],pt.EPSILON15)+t.y),c=e[jt.COLUMN0ROW0]*a+e[jt.COLUMN2ROW2]*s+r*t.x+n,h=s*Lm(e[jt.COLUMN2ROW1],e[jt.COLUMN1ROW2],pt.EPSILON15),f=i*(r*Lm(e[jt.COLUMN2ROW0],e[jt.COLUMN0ROW2])+t.z),p=[];if(0==f&&0==h){if(0===(o=hm.computeRealRoots(u,l,c)).length)return p;var d,m,_=o[0],g=Math.sqrt(Math.max(1-_*_,0));return p.push(new _t(r,i*_,i*-g)),p.push(new _t(r,i*_,i*g)),2===o.length&&(d=o[1],m=Math.sqrt(Math.max(1-d*d,0)),p.push(new _t(r,i*d,i*-m)),p.push(new _t(r,i*d,i*m))),p}var y=f*f,v=h*h,x=f*h,b=u*u+v,E=2*(l*u+x),T=2*c*u+l*l-v+y,S=2*(c*l-x),C=c*c-y;if(0==b&&0==E&&0==T&&0==S)return p;var w=(o=mm.computeRealRoots(b,E,T,S,C)).length;if(0===w)return p;for(var A=0;A<w;++A){var I=o[A],P=I*I,O=Math.max(1-P,0),L=Math.sqrt(O),N=pt.sign(u)===pt.sign(c)?Lm(u*P+c,l*I,pt.EPSILON12):pt.sign(c)===pt.sign(l*I)?Lm(u*P,l*I+c,pt.EPSILON12):Lm(u*P+l*I,c,pt.EPSILON12),R=N*Lm(h*I,f,pt.EPSILON15);R<0?p.push(new _t(r,i*I,i*L)):0<R?p.push(new _t(r,i*I,i*-L)):0!==L?(p.push(new _t(r,i*I,i*-L)),p.push(new _t(r,i*I,i*L)),++A):p.push(new _t(r,i*I,i*L))}return p}(y,_t.negate(v,Nm),0,0,1),b=x.length;if(0<b){for(var E=_t.clone(_t.ZERO,Wm),T=Number.NEGATIVE_INFINITY,S=0;S<b;++S){_=jt.multiplyByVector(p,jt.multiplyByVector(h,x[S],Hm),Hm);var C=_t.normalize(_t.subtract(_,n,Mm),Mm),w=_t.dot(C,r);T<w&&(T=w,E=_t.clone(_,E))}var A=t.cartesianToCartographic(E,Ym),T=pt.clamp(T,0,1),I=_t.magnitude(_t.subtract(E,n,Mm))*Math.sqrt(1-T*T);return I=o?-I:I,A.height=I,t.cartographicToCartesian(A,new _t)}};var Xm=new _t;vm.lineSegmentPlane=function(e,t,n,r){Ze(r)||(r=new _t);var i=_t.subtract(t,e,Xm),o=n.normal,a=_t.dot(o,i);if(!(Math.abs(a)<pt.EPSILON6)){var s=_t.dot(o,e),u=-(n.distance+s)/a;if(!(u<0||1<u))return _t.multiplyByScalar(i,u,r),_t.add(e,r,r),r}},vm.trianglePlaneIntersection=function(e,t,n,r){var i,o,a=r.normal,s=r.distance,u=_t.dot(a,e)+s<0,l=_t.dot(a,t)+s<0,c=_t.dot(a,n)+s<0,h=0;if(h+=u?1:0,h+=l?1:0,1!=(h+=c?1:0)&&2!=h||(i=new _t,o=new _t),1==h){if(u)return vm.lineSegmentPlane(e,t,r,i),vm.lineSegmentPlane(e,n,r,o),{positions:[e,t,n,i,o],indices:[0,3,4,1,2,4,1,4,3]};if(l)return vm.lineSegmentPlane(t,n,r,i),vm.lineSegmentPlane(t,e,r,o),{positions:[e,t,n,i,o],indices:[1,3,4,2,0,4,2,4,3]};if(c)return vm.lineSegmentPlane(n,e,r,i),vm.lineSegmentPlane(n,t,r,o),{positions:[e,t,n,i,o],indices:[2,3,4,0,1,4,0,4,3]}}else if(2==h){if(!u)return vm.lineSegmentPlane(t,e,r,i),vm.lineSegmentPlane(n,e,r,o),{positions:[e,t,n,i,o],indices:[1,2,4,1,4,3,0,3,4]};if(!l)return vm.lineSegmentPlane(n,t,r,i),vm.lineSegmentPlane(e,t,r,o),{positions:[e,t,n,i,o],indices:[2,0,4,2,4,3,1,3,4]};if(!c)return vm.lineSegmentPlane(e,n,r,i),vm.lineSegmentPlane(t,n,r,o),{positions:[e,t,n,i,o],indices:[0,1,4,0,4,3,2,3,4]}}};var jm={calculateACMR:function(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).indices,n=e.maximumIndex,r=Je(e.cacheSize,24),i=t.length;if(!Ze(n))for(var o=n=0,a=t[o];o<i;)n<a&&(n=a),a=t[++o];for(var s=[],u=0;u<n+1;u++)s[u]=0;for(var l=r+1,c=0;c<i;++c)l-s[t[c]]>r&&(s[t[c]]=l,++l);return(l-r+1)/(i/3)}};jm.tipsify=function(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).indices,n=e.maximumIndex,r=Je(e.cacheSize,24);function i(e,t,n,r,i,o,a){for(var s,u=-1,l=-1,c=0;c<n.length;){var h=n[c];r[h].numLiveTriangles&&(s=0,i-r[h].timeStamp+2*r[h].numLiveTriangles<=t&&(s=i-r[h].timeStamp),(l<s||-1===l)&&(l=s,u=h)),++c}return-1===u?function(e,t,n){for(;1<=t.length;){var r=t[t.length-1];if(t.splice(t.length-1,1),0<e[r].numLiveTriangles)return r}for(;v<n;){if(0<e[v].numLiveTriangles)return++v-1;++v}return-1}(r,o,a):u}var o=t.length,a=0,s=0,u=t[s],l=o;if(Ze(n))a=n+1;else{for(;s<l;)a<u&&(a=u),u=t[++s];if(-1===a)return 0;++a}for(var c=[],h=0;h<a;h++)c[h]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var f=s=0;s<l;)c[t[s]].vertexTriangles.push(f),++c[t[s]].numLiveTriangles,c[t[s+1]].vertexTriangles.push(f),++c[t[s+1]].numLiveTriangles,c[t[s+2]].vertexTriangles.push(f),++c[t[s+2]].numLiveTriangles,++f,s+=3;var p,d,m,_,g=0,y=r+1,v=1,x=[],b=[],E=0,T=[],S=o/3,C=[];for(h=0;h<S;h++)C[h]=!1;for(;-1!==g;){x=[],_=(d=c[g]).vertexTriangles.length;for(var w=0;w<_;++w)if(!C[f=d.vertexTriangles[w]]){C[f]=!0,s=f+f+f;for(var A=0;A<3;++A)m=t[s],x.push(m),b.push(m),T[E]=m,++E,--(p=c[m]).numLiveTriangles,y-p.timeStamp>r&&(p.timeStamp=y,++y),++s}g=i(0,r,x,c,y,b,a)}return T};var Km={};function Qm(e,t,n,r,i){e[t++]=n,e[t++]=r,e[t++]=r,e[t++]=i,e[t++]=i,e[t]=n}function Zm(e){var t,n={};for(var r in e){e.hasOwnProperty(r)&&Ze(e[r])&&Ze(e[r].values)&&(t=e[r],n[r]=new Rd({componentDatatype:t.componentDatatype,componentsPerAttribute:t.componentsPerAttribute,normalize:t.normalize,values:[]}))}return n}function Jm(e,t,n){for(var r in t)if(t.hasOwnProperty(r)&&Ze(t[r])&&Ze(t[r].values))for(var i=t[r],o=0;o<i.componentsPerAttribute;++o)e[r].values.push(i.values[n*i.componentsPerAttribute+o])}Km.toWireframe=function(e){var t=e.indices;if(Ze(t)){switch(e.primitiveType){case Dn.TRIANGLES:e.indices=function(e){for(var t=e.length,n=t/3*6,r=wa.createTypedArray(t,n),i=0,o=0;o<t;o+=3,i+=6)Qm(r,i,e[o],e[o+1],e[o+2]);return r}(t);break;case Dn.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(3<=t){var n=6*(t-2),r=wa.createTypedArray(t,n);Qm(r,0,e[0],e[1],e[2]);for(var i=6,o=3;o<t;++o,i+=6)Qm(r,i,e[o-1],e[o],e[o-2]);return r}return new Uint16Array}(t);break;case Dn.TRIANGLE_FAN:e.indices=function(e){if(0<e.length){for(var t=e.length-1,n=6*(t-1),r=wa.createTypedArray(t,n),i=e[0],o=0,a=1;a<t;++a,o+=6)Qm(r,o,i,e[a],e[a+1]);return r}return new Uint16Array}(t)}e.primitiveType=Dn.LINES}return e},Km.createLineSegmentsForVectors=function(e,t,n){t=Je(t,"normal"),n=Je(n,1e4);for(var r,i=e.attributes.position.values,o=e.attributes[t].values,a=i.length,s=new Float64Array(2*a),u=0,l=0;l<a;l+=3)s[u++]=i[l],s[u++]=i[l+1],s[u++]=i[l+2],s[u++]=i[l]+o[l]*n,s[u++]=i[l+1]+o[l+1]*n,s[u++]=i[l+2]+o[l+2]*n;var c=e.boundingSphere;return Ze(c)&&(r=new ko(c.center,c.radius+n)),new dc({attributes:{position:new Rd({componentDatatype:Mt.DOUBLE,componentsPerAttribute:3,values:s})},primitiveType:Dn.LINES,boundingSphere:r})},Km.createAttributeLocations=function(e){for(var t=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],n=e.attributes,r={},i=0,o=t.length,a=0;a<o;++a){var s=t[a];Ze(n[s])&&(r[s]=i++)}for(var u in n)n.hasOwnProperty(u)&&!Ze(r[u])&&(r[u]=i++);return r},Km.reorderForPreVertexCache=function(e){var t=dc.computeNumberOfVertices(e),n=e.indices;if(Ze(n)){for(var r=new Int32Array(t),i=0;i<t;i++)r[i]=-1;for(var o,a=n,s=a.length,u=wa.createTypedArray(t,s),l=0,c=0,h=0;l<s;)-1!==(o=r[a[l]])?u[c]=o:(r[o=a[l]]=h,u[c]=h,++h),++l,++c;e.indices=u;var f=e.attributes;for(var p in f)if(f.hasOwnProperty(p)&&Ze(f[p])&&Ze(f[p].values)){for(var d=f[p],m=d.values,_=0,g=d.componentsPerAttribute,y=Mt.createTypedArray(d.componentDatatype,h*g);_<t;){var v=r[_];if(-1!==v)for(var x=0;x<g;x++)y[g*v+x]=m[g*_+x];++_}d.values=y}}return e},Km.reorderForPostVertexCache=function(e,t){var n=e.indices;if(e.primitiveType===Dn.TRIANGLES&&Ze(n)){for(var r=n.length,i=0,o=0;o<r;o++)n[o]>i&&(i=n[o]);e.indices=jm.tipsify({indices:n,maximumIndex:i,cacheSize:t})}return e},Km.fitToUnsignedShortIndices=function(e){var t=[],n=dc.computeNumberOfVertices(e);if(Ze(e.indices)&&n>=pt.SIXTY_FOUR_KILOBYTES){var r,i=[],o=[],a=0,s=Zm(e.attributes),u=e.indices,l=u.length;e.primitiveType===Dn.TRIANGLES?r=3:e.primitiveType===Dn.LINES?r=2:e.primitiveType===Dn.POINTS&&(r=1);for(var c=0;c<l;c+=r){for(var h=0;h<r;++h){var f=u[c+h],p=i[f];Ze(p)||(p=a++,i[f]=p,Jm(s,e.attributes,f)),o.push(p)}a+r>=pt.SIXTY_FOUR_KILOBYTES&&(t.push(new dc({attributes:s,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),i=[],o=[],a=0,s=Zm(e.attributes))}0!==o.length&&t.push(new dc({attributes:s,indices:o,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var $m=new _t,e_=new Un;Km.projectTo2D=function(e,t,n,r,i){for(var o=e.attributes[t],a=(i=Ze(i)?i:new Zn).ellipsoid,s=o.values,u=new Float64Array(s.length),l=0,c=0;c<s.length;c+=3){var h=_t.fromArray(s,c,$m),f=a.cartesianToCartographic(h,e_),p=i.project(f,$m);u[l++]=p.x,u[l++]=p.y,u[l++]=p.z}return e.attributes[n]=o,e.attributes[r]=new Rd({componentDatatype:Mt.DOUBLE,componentsPerAttribute:3,values:u}),delete e.attributes[t],e};var t_={high:0,low:0};Km.encodeAttribute=function(e,t,n,r){for(var i=e.attributes[t],o=i.values,a=o.length,s=new Float32Array(a),u=new Float32Array(a),l=0;l<a;++l)$d.encode(o[l],t_),s[l]=t_.high,u[l]=t_.low;var c=i.componentsPerAttribute;return e.attributes[n]=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:c,values:s}),e.attributes[r]=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:c,values:u}),delete e.attributes[t],e};var n_=new _t;function r_(e,t){if(Ze(t))for(var n=t.values,r=n.length,i=0;i<r;i+=3)_t.unpack(n,i,n_),on.multiplyByPoint(e,n_,n_),_t.pack(n_,n,i)}function i_(e,t){if(Ze(t))for(var n=t.values,r=n.length,i=0;i<r;i+=3)_t.unpack(n,i,n_),jt.multiplyByVector(e,n_,n_),n_=_t.normalize(n_,n_),_t.pack(n_,n,i)}var o_=new on,a_=new jt;Km.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(on.equals(t,on.IDENTITY))return e;var n=e.geometry.attributes;r_(t,n.position),r_(t,n.prevPosition),r_(t,n.nextPosition),(Ze(n.normal)||Ze(n.tangent)||Ze(n.bitangent))&&(on.inverse(t,o_),on.transpose(o_,o_),on.getMatrix3(o_,a_),i_(a_,n.normal),i_(a_,n.tangent),i_(a_,n.bitangent));var r=e.geometry.boundingSphere;return Ze(r)&&(e.geometry.boundingSphere=ko.transform(r,t,r)),e.modelMatrix=on.clone(on.IDENTITY),e};var s_=new _t;function u_(e,t){var n,r,i,o,a,s,u=e.length,l=(e[0].modelMatrix,Ze(e[0][t].indices)),c=e[0][t].primitiveType,h=function(e,t){var n,r=e.length,i={},o=e[0][t].attributes;for(n in o)if(o.hasOwnProperty(n)&&Ze(o[n])&&Ze(o[n].values)){for(var a=o[n],s=a.values.length,u=!0,l=1;l<r;++l){var c=e[l][t].attributes[n];if(!Ze(c)||a.componentDatatype!==c.componentDatatype||a.componentsPerAttribute!==c.componentsPerAttribute||a.normalize!==c.normalize){u=!1;break}s+=c.values.length}u&&(i[n]=new Rd({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:Mt.createTypedArray(a.componentDatatype,s)}))}return i}(e,t);for(n in h)if(h.hasOwnProperty(n))for(i=h[n].values,p=x=0;p<u;++p)for(a=(o=e[p][t].attributes[n].values).length,r=0;r<a;++r)i[x++]=o[r];if(l){for(var f=0,p=0;p<u;++p)f+=e[p][t].indices.length;var d=dc.computeNumberOfVertices(new dc({attributes:h,primitiveType:Dn.POINTS})),m=wa.createTypedArray(d,f),_=0,g=0;for(p=0;p<u;++p){for(var y=e[p][t].indices,v=y.length,x=0;x<v;++x)m[_++]=g+y[x];g+=dc.computeNumberOfVertices(e[p][t])}s=m}var b,E=new _t,T=0;for(p=0;p<u;++p){if(!Ze(b=e[p][t].boundingSphere)){E=void 0;break}_t.add(b.center,E,E)}if(Ze(E))for(_t.divideByScalar(E,u,E),p=0;p<u;++p){b=e[p][t].boundingSphere;var S=_t.magnitude(_t.subtract(b.center,E,s_))+b.radius;T<S&&(T=S)}return new dc({attributes:h,indices:s,primitiveType:c,boundingSphere:Ze(E)?new ko(E,T):void 0})}Km.combineInstances=function(e){for(var t=[],n=[],r=e.length,i=0;i<r;++i){var o=e[i];Ze(o.geometry)?t.push(o):Ze(o.westHemisphereGeometry)&&Ze(o.eastHemisphereGeometry)&&n.push(o)}var a=[];return 0<t.length&&a.push(u_(t,"geometry")),0<n.length&&(a.push(u_(n,"westHemisphereGeometry")),a.push(u_(n,"eastHemisphereGeometry"))),a};var l_=new _t,c_=new _t,h_=new _t,f_=new _t;Km.computeNormal=function(e){for(var t=e.indices,n=e.attributes,r=n.position.values,i=n.position.values.length/3,o=t.length,a=new Array(i),s=new Array(o/3),u=new Array(o),l=0;l<i;l++)a[l]={indexOffset:0,count:0,currentCount:0};var c=0;for(l=0;l<o;l+=3){var h=t[l],f=t[l+1],p=t[l+2],d=3*h,m=3*f,_=3*p;c_.x=r[d],c_.y=r[1+d],c_.z=r[2+d],h_.x=r[m],h_.y=r[1+m],h_.z=r[2+m],f_.x=r[_],f_.y=r[1+_],f_.z=r[2+_],a[h].count++,a[f].count++,a[p].count++,_t.subtract(h_,c_,h_),_t.subtract(f_,c_,f_),s[c]=_t.cross(h_,f_,new _t),c++}var g=0;for(l=0;l<i;l++)a[l].indexOffset+=g,g+=a[l].count;for(l=c=0;l<o;l+=3){var y=(b=a[t[l]]).indexOffset+b.currentCount;u[y]=c,b.currentCount++,u[y=(b=a[t[l+1]]).indexOffset+b.currentCount]=c,b.currentCount++,u[y=(b=a[t[l+2]]).indexOffset+b.currentCount]=c,b.currentCount++,c++}var v=new Float32Array(3*i);for(l=0;l<i;l++){var x=3*l,b=a[l];if(_t.clone(_t.ZERO,l_),0<b.count){for(c=0;c<b.count;c++)_t.add(l_,s[u[b.indexOffset+c]],l_);_t.equalsEpsilon(_t.ZERO,l_,pt.EPSILON10)&&_t.clone(s[u[b.indexOffset]],l_)}_t.equalsEpsilon(_t.ZERO,l_,pt.EPSILON10)&&(l_.z=1),_t.normalize(l_,l_),v[x]=l_.x,v[1+x]=l_.y,v[2+x]=l_.z}return e.attributes.normal=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:3,values:v}),e};var p_=new _t,d_=new _t,m_=new _t;Km.computeTangentAndBitangent=function(e){e.attributes;for(var t=e.indices,n=e.attributes.position.values,r=e.attributes.normal.values,i=e.attributes.st.values,o=e.attributes.position.values.length/3,a=t.length,s=new Array(3*o),u=0;u<s.length;u++)s[u]=0;for(u=0;u<a;u+=3){var l,c=t[u],h=t[u+1],f=t[u+2],p=3*h,d=3*f,m=2*c,_=2*h,g=2*f,y=n[l=3*c],v=n[l+1],x=n[l+2],b=i[m],E=i[1+m],T=i[1+_]-E,S=i[1+g]-E,C=1/((i[_]-b)*S-(i[g]-b)*T),w=(S*(n[p]-y)-T*(n[d]-y))*C,A=(S*(n[p+1]-v)-T*(n[d+1]-v))*C,I=(S*(n[p+2]-x)-T*(n[d+2]-x))*C;s[l]+=w,s[l+1]+=A,s[l+2]+=I,s[p]+=w,s[p+1]+=A,s[p+2]+=I,s[d]+=w,s[d+1]+=A,s[d+2]+=I}var P=new Float32Array(3*o),O=new Float32Array(3*o);for(u=0;u<o;u++){p=(l=3*u)+1,d=l+2;var L=_t.fromArray(r,l,p_),N=_t.fromArray(s,l,m_),R=_t.dot(L,N);_t.multiplyByScalar(L,R,d_),_t.normalize(_t.subtract(N,d_,N),N),P[l]=N.x,P[p]=N.y,P[d]=N.z,_t.normalize(_t.cross(L,N,N),N),O[l]=N.x,O[p]=N.y,O[d]=N.z}return e.attributes.tangent=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:3,values:P}),e.attributes.bitangent=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:3,values:O}),e};var __=new En,g_=new _t,y_=new _t,v_=new _t,x_=new En;function b_(e){switch(e.primitiveType){case Dn.TRIANGLE_FAN:return function(e){var t=dc.computeNumberOfVertices(e),n=wa.createTypedArray(t,3*(t-2));n[0]=1,n[1]=0,n[2]=2;for(var r=3,i=3;i<t;++i)n[r++]=i-1,n[r++]=0,n[r++]=i;return e.indices=n,e.primitiveType=Dn.TRIANGLES,e}(e);case Dn.TRIANGLE_STRIP:return function(e){var t=dc.computeNumberOfVertices(e),n=wa.createTypedArray(t,3*(t-2));n[0]=0,n[1]=1,n[2]=2,3<t&&(n[3]=0,n[4]=2,n[5]=3);for(var r=6,i=3;i<t-1;i+=2)n[r++]=i,n[r++]=i-1,n[r++]=i+1,i+2<t&&(n[r++]=i,n[r++]=i+1,n[r++]=i+2);return e.indices=n,e.primitiveType=Dn.TRIANGLES,e}(e);case Dn.TRIANGLES:return function(e){if(Ze(e.indices))return e;for(var t=dc.computeNumberOfVertices(e),n=wa.createTypedArray(t,t),r=0;r<t;++r)n[r]=r;return e.indices=n,e}(e);case Dn.LINE_STRIP:return function(e){var t=dc.computeNumberOfVertices(e),n=wa.createTypedArray(t,2*(t-1));n[0]=0,n[1]=1;for(var r=2,i=2;i<t;++i)n[r++]=i-1,n[r++]=i;return e.indices=n,e.primitiveType=Dn.LINES,e}(e);case Dn.LINE_LOOP:return function(e){var t=dc.computeNumberOfVertices(e),n=wa.createTypedArray(t,2*t);n[0]=0,n[1]=1;for(var r=2,i=2;i<t;++i)n[r++]=i-1,n[r++]=i;return n[r++]=t-1,n[r]=0,e.indices=n,e.primitiveType=Dn.LINES,e}(e);case Dn.LINES:return function(e){if(Ze(e.indices))return e;for(var t=dc.computeNumberOfVertices(e),n=wa.createTypedArray(t,t),r=0;r<t;++r)n[r]=r;return e.indices=n,e}(e)}return e}function E_(e,t){Math.abs(e.y)<pt.EPSILON6&&(e.y=t?-pt.EPSILON6:pt.EPSILON6)}Km.compressVertices=function(e){var t=e.attributes.extrudeDirection;if(Ze(t)){for(var n=t.values,r=n.length/3,i=new Float32Array(2*r),o=0,a=0;a<r;++a)_t.fromArray(n,3*a,g_),_t.equals(g_,_t.ZERO)?o+=2:(x_=Hf.octEncodeInRange(g_,65535,x_),i[o++]=x_.x,i[o++]=x_.y);return e.attributes.compressedAttributes=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:2,values:i}),delete e.attributes.extrudeDirection,e}var s=e.attributes.normal,u=e.attributes.st,l=Ze(s),c=Ze(u);if(!l&&!c)return e;var h,f,p,d,m=e.attributes.tangent,_=e.attributes.bitangent,g=Ze(m),y=Ze(_);l&&(h=s.values),c&&(f=u.values),g&&(p=m.values),y&&(d=_.values);var v=r=(l?h.length:f.length)/(l?3:2),x=c&&l?2:1;v*=x+=g||y?1:0;var b=new Float32Array(v),E=0;for(a=0;a<r;++a){c&&(En.fromArray(f,2*a,__),b[E++]=Hf.compressTextureCoordinates(__));var T=3*a;l&&Ze(p)&&Ze(d)?(_t.fromArray(h,T,g_),_t.fromArray(p,T,y_),_t.fromArray(d,T,v_),Hf.octPack(g_,y_,v_,__),b[E++]=__.x,b[E++]=__.y):(l&&(_t.fromArray(h,T,g_),b[E++]=Hf.octEncodeFloat(g_)),g&&(_t.fromArray(p,T,g_),b[E++]=Hf.octEncodeFloat(g_)),y&&(_t.fromArray(d,T,g_),b[E++]=Hf.octEncodeFloat(g_)))}return e.attributes.compressedAttributes=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:x,values:b}),l&&delete e.attributes.normal,c&&delete e.attributes.st,y&&delete e.attributes.bitangent,g&&delete e.attributes.tangent,e};var T_=new _t;function S_(e,t,n,r){_t.add(e,_t.multiplyByScalar(_t.subtract(t,e,T_),e.y/(e.y-t.y),T_),n),_t.clone(n,r),E_(n,!0),E_(r,!1)}var C_=new _t,w_=new _t,A_=new _t,I_=new _t,P_={positions:new Array(7),indices:new Array(9)};function O_(e,t,n){if(!(0<=e.x||0<=t.x||0<=n.x)){!function(e,t,n){if(0!==e.y&&0!==t.y&&0!==n.y)return E_(e,e.y<0),E_(t,t.y<0),E_(n,n.y<0);var r=Math.abs(e.y),i=Math.abs(t.y),o=Math.abs(n.y),a=i<r?o<r?pt.sign(e.y):pt.sign(n.y):o<i?pt.sign(t.y):pt.sign(n.y),s=a<0;E_(e,s),E_(t,s),E_(n,s)}(e,t,n);var r=e.y<0,i=t.y<0,o=n.y<0,a=0;a+=r?1:0,a+=i?1:0,a+=o?1:0;var s=P_.indices;1==a?(s[1]=3,s[2]=4,s[5]=6,s[7]=6,s[8]=5,r?(S_(e,t,C_,A_),S_(e,n,w_,I_),s[0]=0,s[3]=1,s[4]=2,s[6]=1):i?(S_(t,n,C_,A_),S_(t,e,w_,I_),s[0]=1,s[3]=2,s[4]=0,s[6]=2):o&&(S_(n,e,C_,A_),S_(n,t,w_,I_),s[0]=2,s[3]=0,s[4]=1,s[6]=0)):2==a&&(s[2]=4,s[4]=4,s[5]=3,s[7]=5,s[8]=6,r?i?o||(S_(n,e,C_,A_),S_(n,t,w_,I_),s[0]=0,s[1]=1,s[3]=0,s[6]=2):(S_(t,n,C_,A_),S_(t,e,w_,I_),s[0]=2,s[1]=0,s[3]=2,s[6]=1):(S_(e,t,C_,A_),S_(e,n,w_,I_),s[0]=1,s[1]=2,s[3]=1,s[6]=0));var u=P_.positions;return u[0]=e,u[1]=t,u[2]=n,u.length=3,1!=a&&2!=a||(u[3]=C_,u[4]=w_,u[5]=A_,u[6]=I_,u.length=7),P_}}function L_(e,t){var n,r=e.attributes;if(0!==r.position.values.length){for(var i in r){r.hasOwnProperty(i)&&Ze(r[i])&&Ze(r[i].values)&&((n=r[i]).values=Mt.createTypedArray(n.componentDatatype,n.values))}var o=dc.computeNumberOfVertices(e);return e.indices=wa.createTypedArray(o,e.indices),t&&(e.boundingSphere=ko.fromVertices(r.position.values)),e}}function N_(e){var t,n=e.attributes,r={};for(var i in n){n.hasOwnProperty(i)&&Ze(n[i])&&Ze(n[i].values)&&(t=n[i],r[i]=new Rd({componentDatatype:t.componentDatatype,componentsPerAttribute:t.componentsPerAttribute,normalize:t.normalize,values:[]}))}return new dc({attributes:r,indices:[],primitiveType:e.primitiveType})}function R_(e,t,n){var r=Ze(e.geometry.boundingSphere);t=L_(t,r),Ze(n=L_(n,r))&&!Ze(t)?e.geometry=n:!Ze(n)&&Ze(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=n,e.geometry=void 0)}function D_(f,p){var d=new f,m=new f,_=new f;return function(e,t,n,r,i,o,a,s){var u=f.fromArray(i,e*p,d),l=f.fromArray(i,t*p,m),c=f.fromArray(i,n*p,_);f.multiplyByScalar(u,r.x,u),f.multiplyByScalar(l,r.y,l),f.multiplyByScalar(c,r.z,c);var h=f.add(u,l,u);f.add(h,c,h),s&&f.normalize(h,h),f.pack(h,o,a*p)}}var M_=D_(qt,4),F_=D_(_t,3),z_=D_(En,2),B_=function(e,t,n,r,i,o,a){var s=i[e]*r.x,u=i[t]*r.y,l=i[n]*r.z;o[a]=s+u+l>pt.EPSILON6?1:0},U_=new _t,V_=new _t,k_=new _t,G_=new _t;function q_(e,t,n,r,i,o,a,s,u,l,c,h,f,p,d,m){if(Ze(o)||Ze(a)||Ze(s)||Ze(u)||Ze(l)||0!==p){var _,g,y,v,x=function(e,t,n,r,i){var o,a,s,u,l,c,h,f;if(Ze(i)||(i=new _t),Ze(t.z)){if(_t.equalsEpsilon(e,t,pt.EPSILON14))return _t.clone(_t.UNIT_X,i);if(_t.equalsEpsilon(e,n,pt.EPSILON14))return _t.clone(_t.UNIT_Y,i);if(_t.equalsEpsilon(e,r,pt.EPSILON14))return _t.clone(_t.UNIT_Z,i);o=_t.subtract(n,t,um),a=_t.subtract(r,t,lm),s=_t.subtract(e,t,cm),u=_t.dot(o,o),l=_t.dot(o,a),c=_t.dot(o,s),h=_t.dot(a,a),f=_t.dot(a,s)}else{if(En.equalsEpsilon(e,t,pt.EPSILON14))return _t.clone(_t.UNIT_X,i);if(En.equalsEpsilon(e,n,pt.EPSILON14))return _t.clone(_t.UNIT_Y,i);if(En.equalsEpsilon(e,r,pt.EPSILON14))return _t.clone(_t.UNIT_Z,i);o=En.subtract(n,t,um),a=En.subtract(r,t,lm),s=En.subtract(e,t,cm),u=En.dot(o,o),l=En.dot(o,a),c=En.dot(o,s),h=En.dot(a,a),f=En.dot(a,s)}i.y=h*c-l*f,i.z=u*f-l*c;var p=u*h-l*l;return 0!==i.y&&(i.y/=p),0!==i.z&&(i.z/=p),i.x=1-i.y-i.z,i}(r,_t.fromArray(i,3*e,U_),_t.fromArray(i,3*t,V_),_t.fromArray(i,3*n,k_),G_);if(Ze(o)&&F_(e,t,n,x,o,h.normal.values,m,!0),Ze(l)&&(_=_t.fromArray(l,3*e,U_),g=_t.fromArray(l,3*t,V_),y=_t.fromArray(l,3*n,k_),_t.multiplyByScalar(_,x.x,_),_t.multiplyByScalar(g,x.y,g),_t.multiplyByScalar(y,x.z,y),_t.equals(_,_t.ZERO)&&_t.equals(g,_t.ZERO)&&_t.equals(y,_t.ZERO)?((v=U_).x=0,v.y=0,v.z=0):(v=_t.add(_,g,_),_t.add(v,y,v),_t.normalize(v,v)),_t.pack(v,h.extrudeDirection.values,3*m)),Ze(c)&&B_(e,t,n,x,c,h.applyOffset.values,m),Ze(a)&&F_(e,t,n,x,a,h.tangent.values,m,!0),Ze(s)&&F_(e,t,n,x,s,h.bitangent.values,m,!0),Ze(u)&&z_(e,t,n,x,u,h.st.values,m),0<p)for(var b=0;b<p;b++){var E=f[b];H_(e,t,n,x,m,d[E],h[E])}}}function H_(e,t,n,r,i,o,a){var s=o.componentsPerAttribute,u=o.values,l=a.values;switch(s){case 4:M_(e,t,n,r,u,l,i,!1);break;case 3:F_(e,t,n,r,u,l,i,!1);break;case 2:z_(e,t,n,r,u,l,i,!1);break;default:l[i]=u[e]*r.x+u[t]*r.y+u[n]*r.z}}function W_(e,t,n,r,i,o){var a=e.position.values.length/3;if(-1===i)return e.position.values.push(o.x,o.y,o.z),t.push(a),a;var s=r[i],u=n[s];return-1===u?(n[s]=a,e.position.values.push(o.x,o.y,o.z),t.push(a),a):(t.push(u),u)}var Y_={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function X_(e){var t=e.geometry,n=t.attributes,r=n.position.values,i=Ze(n.normal)?n.normal.values:void 0,o=Ze(n.bitangent)?n.bitangent.values:void 0,a=Ze(n.tangent)?n.tangent.values:void 0,s=Ze(n.st)?n.st.values:void 0,u=Ze(n.extrudeDirection)?n.extrudeDirection.values:void 0,l=Ze(n.applyOffset)?n.applyOffset.values:void 0,c=t.indices,h=[];for(var f in n)n.hasOwnProperty(f)&&!Y_[f]&&Ze(n[f])&&h.push(f);var p,d,m=h.length,_=N_(t),g=N_(t),y=[];y.length=r.length/3;var v=[];for(v.length=r.length/3,b=0;b<y.length;++b)y[b]=-1,v[b]=-1;for(var x=c.length,b=0;b<x;b+=3){var E=c[b],T=c[b+1],S=c[b+2],C=_t.fromArray(r,3*E),w=_t.fromArray(r,3*T),A=_t.fromArray(r,3*S),I=O_(C,w,A);if(Ze(I)&&3<I.positions.length)for(var P=I.positions,O=I.indices,L=O.length,N=0;N<L;++N){var R=O[N],D=P[R],M=D.y<0?(p=g.attributes,d=g.indices,y):(p=_.attributes,d=_.indices,v);q_(E,T,S,D,r,i,a,o,s,u,l,p,h,m,n,W_(p,d,M,c,R<3?b+R:-1,D))}else Ze(I)&&(C=I.positions[0],w=I.positions[1],A=I.positions[2]),M=C.y<0?(p=g.attributes,d=g.indices,y):(p=_.attributes,d=_.indices,v),q_(E,T,S,C,r,i,a,o,s,u,l,p,h,m,n,W_(p,d,M,c,b,C)),q_(E,T,S,w,r,i,a,o,s,u,l,p,h,m,n,W_(p,d,M,c,b+1,w)),q_(E,T,S,A,r,i,a,o,s,u,l,p,h,m,n,W_(p,d,M,c,b+2,A))}R_(e,g,_)}var j_=Zf.fromPointNormal(_t.ZERO,_t.UNIT_Y),K_=new _t,Q_=new _t;function Z_(e,t,n,r,i,o,a){var s;Ze(a)&&(s=_t.fromArray(r,3*e,U_),_t.equalsEpsilon(s,n,pt.EPSILON10)?o.applyOffset.values[i]=a[e]:o.applyOffset.values[i]=a[t])}function J_(e){var t,n=e.geometry,r=n.attributes,i=r.position.values,o=Ze(r.applyOffset)?r.applyOffset.values:void 0,a=n.indices,s=N_(n),u=N_(n),l=a.length,c=[];c.length=i.length/3;var h=[];for(h.length=i.length/3,t=0;t<c.length;++t)c[t]=-1,h[t]=-1;for(t=0;t<l;t+=2){var f=a[t],p=a[t+1],d=_t.fromArray(i,3*f,U_),m=_t.fromArray(i,3*p,V_);Math.abs(d.y)<pt.EPSILON6&&(d.y<0?d.y=-pt.EPSILON6:d.y=pt.EPSILON6),Math.abs(m.y)<pt.EPSILON6&&(m.y<0?m.y=-pt.EPSILON6:m.y=pt.EPSILON6);var _,g,y,v,x,b=s.attributes,E=s.indices,T=h,S=u.attributes,C=u.indices,w=c,A=vm.lineSegmentPlane(d,m,j_,k_);Ze(A)?(_=_t.multiplyByScalar(_t.UNIT_Y,5*pt.EPSILON9,K_),d.y<0&&(_t.negate(_,_),b=u.attributes,E=u.indices,T=c,S=s.attributes,C=s.indices,w=h),g=_t.add(A,_,Q_),Z_(f,p,d,i,W_(b,E,T,a,t,d),b,o),Z_(f,p,g,i,W_(b,E,T,a,-1,g),b,o),_t.negate(_,_),_t.add(A,_,g),Z_(f,p,g,i,W_(S,C,w,a,-1,g),S,o),Z_(f,p,m,i,W_(S,C,w,a,t+1,m),S,o)):(x=d.y<0?(y=u.attributes,v=u.indices,c):(y=s.attributes,v=s.indices,h),Z_(f,p,d,i,W_(y,v,x,a,t,d),y,o),Z_(f,p,m,i,W_(y,v,x,a,t+1,m),y,o))}R_(e,u,s)}var $_=new En,eg=new En,tg=new _t,ng=new _t,rg=new _t,ig=new _t,og=new _t,ag=new _t,sg=new qt;function ug(e){for(var t=e.attributes,n=t.position.values,r=t.prevPosition.values,i=t.nextPosition.values,o=n.length,a=0;a<o;a+=3){var s,u,l=_t.unpack(n,a,tg);0<l.x||(s=_t.unpack(r,a,ng),(l.y<0&&0<s.y||0<l.y&&s.y<0)&&(0<a-3?(r[a]=n[a-3],r[a+1]=n[a-2],r[a+2]=n[a-1]):_t.pack(l,r,a)),u=_t.unpack(i,a,rg),(l.y<0&&0<u.y||0<l.y&&u.y<0)&&(a+3<o?(i[a]=n[a+3],i[a+1]=n[a+4],i[a+2]=n[a+5]):_t.pack(l,i,a)))}}var lg=5*pt.EPSILON9,cg=pt.EPSILON6;function hg(e,t,n){e=Je(e,0),t=Je(t,0),n=Je(n,0),this.value=new Float32Array([e,t,n])}function fg(e){this._ellipsoid=Je(e,Wn.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}function pg(e,t){var n=e.attributes,r=n.position,i=r.values.length/r.componentsPerAttribute;n.batchId=new Rd({componentDatatype:Mt.FLOAT,componentsPerAttribute:1,values:new Float32Array(i)});for(var o=n.batchId.values,a=0;a<i;++a)o[a]=t}function dg(e){var t,n=e.instances,r=e.projection,i=e.elementIndexUintSupported,o=e.scene3DOnly,a=e.vertexCacheOptimize,s=e.compressVertices,u=e.modelMatrix,l=n.length;for(g=0;g<l;++g)if(Ze(n[g].geometry)){n[g].geometry.primitiveType;break}if(!function(e,t,n){var r=!n,i=e.length;if(!r&&1<i)for(var o=e[0].modelMatrix,a=1;a<i;++a)if(!on.equals(o,e[a].modelMatrix)){r=!0;break}if(r)for(a=0;a<i;++a)Ze(e[a].geometry)&&Km.transformToWorldCoordinates(e[a]);else on.multiplyTransformation(t,e[0].modelMatrix,t)}(n,u,o),!o)for(g=0;g<l;++g)Ze(n[g].geometry)&&Km.splitLongitude(n[g]);if(!function(e){for(var t=e.length,n=0;n<t;++n){var r=e[n];Ze(r.geometry)?pg(r.geometry,n):Ze(r.westHemisphereGeometry)&&Ze(r.eastHemisphereGeometry)&&(pg(r.westHemisphereGeometry,n),pg(r.eastHemisphereGeometry,n))}}(n),a)for(g=0;g<l;++g){var c=n[g];Ze(c.geometry)?(Km.reorderForPostVertexCache(c.geometry),Km.reorderForPreVertexCache(c.geometry)):Ze(c.westHemisphereGeometry)&&Ze(c.eastHemisphereGeometry)&&(Km.reorderForPostVertexCache(c.westHemisphereGeometry),Km.reorderForPreVertexCache(c.westHemisphereGeometry),Km.reorderForPostVertexCache(c.eastHemisphereGeometry),Km.reorderForPreVertexCache(c.eastHemisphereGeometry))}var h=Km.combineInstances(n);for(l=h.length,g=0;g<l;++g){var f,p,d,m=(t=h[g]).attributes;if(o)for(f in m)m.hasOwnProperty(f)&&m[f].componentDatatype===Mt.DOUBLE&&Km.encodeAttribute(t,f,f+"3DHigh",f+"3DLow");else for(f in m){m.hasOwnProperty(f)&&m[f].componentDatatype===Mt.DOUBLE&&(p=f+"3D",d=f+"2D",Km.projectTo2D(t,f,p,d,r),Ze(t.boundingSphere)&&"position"===f&&(t.boundingSphereCV=ko.fromVertices(t.attributes.position2D.values)),Km.encodeAttribute(t,p,p+"High",p+"Low"),Km.encodeAttribute(t,d,d+"High",d+"Low"))}s&&Km.compressVertices(t)}if(!i){for(var _=[],l=h.length,g=0;g<l;++g)t=h[g],_=_.concat(Km.fitToUnsignedShortIndices(t));h=_}return h}function mg(e,t,n,r){var i,o,a,s,u=r.length-1;s=0<=u?(o=(i=r[u]).offset+i.count,n[a=i.index].indices.length):n[a=o=0].indices.length;for(var l=e.length,c=0;c<l;++c){var h,f=e[c][t];Ze(f)&&(s<o+(h=f.indices.length)&&(o=0,s=n[++a].indices.length),r.push({index:a,offset:o,count:h}),o+=h)}}Km.splitLongitude=function(e){var t=e.geometry,n=t.boundingSphere;if(Ze(n)&&(0<n.center.x-n.radius||ko.intersectPlane(n,Zf.ORIGIN_ZX_PLANE)!==Jn.INTERSECTING))return e;if(t.geometryType!==pc.NONE)switch(t.geometryType){case pc.POLYLINES:!function(e){for(var t,n=e.geometry,r=n.attributes,i=r.position.values,o=r.prevPosition.values,a=r.nextPosition.values,s=r.expandAndWidth.values,u=Ze(r.st)?r.st.values:void 0,l=Ze(r.color)?r.color.values:void 0,c=N_(n),h=N_(n),f=!1,p=i.length/3,d=0;d<p;d+=4){var m=d,_=d+2,g=_t.fromArray(i,3*m,tg),y=_t.fromArray(i,3*_,ng);if(Math.abs(g.y)<cg)for(g.y=cg*(y.y<0?-1:1),i[3*d+1]=g.y,i[3*(d+1)+1]=g.y,M=3*m;M<3*m+12;M+=3)o[M]=i[3*d],o[M+1]=i[3*d+1],o[M+2]=i[3*d+2];if(Math.abs(y.y)<cg)for(y.y=cg*(g.y<0?-1:1),i[3*(d+2)+1]=y.y,i[3*(d+3)+1]=y.y,M=3*m;M<3*m+12;M+=3)a[M]=i[3*(d+2)],a[M+1]=i[3*(d+2)+1],a[M+2]=i[3*(d+2)+2];var v=c.attributes,x=c.indices,b=h.attributes,E=h.indices,T=vm.lineSegmentPlane(g,y,j_,ig);if(Ze(T)){f=!0;var S=_t.multiplyByScalar(_t.UNIT_Y,lg,og);g.y<0&&(_t.negate(S,S),v=h.attributes,x=h.indices,b=c.attributes,E=c.indices);var C=_t.add(T,S,ag);v.position.values.push(g.x,g.y,g.z,g.x,g.y,g.z),v.position.values.push(C.x,C.y,C.z),v.position.values.push(C.x,C.y,C.z),v.prevPosition.values.push(o[3*m],o[3*m+1],o[3*m+2]),v.prevPosition.values.push(o[3*m+3],o[3*m+4],o[3*m+5]),v.prevPosition.values.push(g.x,g.y,g.z,g.x,g.y,g.z),v.nextPosition.values.push(C.x,C.y,C.z),v.nextPosition.values.push(C.x,C.y,C.z),v.nextPosition.values.push(C.x,C.y,C.z),v.nextPosition.values.push(C.x,C.y,C.z),_t.negate(S,S),_t.add(T,S,C),b.position.values.push(C.x,C.y,C.z),b.position.values.push(C.x,C.y,C.z),b.position.values.push(y.x,y.y,y.z,y.x,y.y,y.z),b.prevPosition.values.push(C.x,C.y,C.z),b.prevPosition.values.push(C.x,C.y,C.z),b.prevPosition.values.push(C.x,C.y,C.z),b.prevPosition.values.push(C.x,C.y,C.z),b.nextPosition.values.push(y.x,y.y,y.z,y.x,y.y,y.z),b.nextPosition.values.push(a[3*_],a[3*_+1],a[3*_+2]),b.nextPosition.values.push(a[3*_+3],a[3*_+4],a[3*_+5]);var w=En.fromArray(s,2*m,$_),A=Math.abs(w.y);v.expandAndWidth.values.push(-1,A,1,A),v.expandAndWidth.values.push(-1,-A,1,-A),b.expandAndWidth.values.push(-1,A,1,A),b.expandAndWidth.values.push(-1,-A,1,-A);var I=_t.magnitudeSquared(_t.subtract(T,g,rg));if(I/=_t.magnitudeSquared(_t.subtract(y,g,rg)),Ze(l)){for(var P=qt.fromArray(l,4*m,sg),O=qt.fromArray(l,4*_,sg),L=pt.lerp(P.x,O.x,I),N=pt.lerp(P.y,O.y,I),R=pt.lerp(P.z,O.z,I),D=pt.lerp(P.w,O.w,I),M=4*m;M<4*m+8;++M)v.color.values.push(l[M]);for(v.color.values.push(L,N,R,D),v.color.values.push(L,N,R,D),b.color.values.push(L,N,R,D),b.color.values.push(L,N,R,D),M=4*_;M<4*_+8;++M)b.color.values.push(l[M])}if(Ze(u)){var F=En.fromArray(u,2*m,$_),z=En.fromArray(u,2*(d+3),eg),B=pt.lerp(F.x,z.x,I);for(M=2*m;M<2*m+4;++M)v.st.values.push(u[M]);for(v.st.values.push(B,F.y),v.st.values.push(B,z.y),b.st.values.push(B,F.y),b.st.values.push(B,z.y),M=2*_;M<2*_+4;++M)b.st.values.push(u[M])}t=v.position.values.length/3-4,x.push(t,t+2,t+1),x.push(t+1,t+2,t+3),t=b.position.values.length/3-4,E.push(t,t+2,t+1),E.push(t+1,t+2,t+3)}else{var U,V=g.y<0?(U=h.attributes,h.indices):(U=c.attributes,c.indices);for(U.position.values.push(g.x,g.y,g.z),U.position.values.push(g.x,g.y,g.z),U.position.values.push(y.x,y.y,y.z),U.position.values.push(y.x,y.y,y.z),M=3*d;M<3*d+12;++M)U.prevPosition.values.push(o[M]),U.nextPosition.values.push(a[M]);for(M=2*d;M<2*d+8;++M)U.expandAndWidth.values.push(s[M]),Ze(u)&&U.st.values.push(u[M]);if(Ze(l))for(M=4*d;M<4*d+16;++M)U.color.values.push(l[M]);t=U.position.values.length/3-4,V.push(t,t+2,t+1),V.push(t+1,t+2,t+3)}}f&&(ug(h),ug(c)),R_(e,h,c)}(e);break;case pc.TRIANGLES:X_(e);break;case pc.LINES:J_(e)}else b_(t),t.primitiveType===Dn.TRIANGLES?X_(e):t.primitiveType===Dn.LINES&&J_(e);return e},Object.defineProperties(hg.prototype,{componentDatatype:{get:function(){return Mt.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),hg.fromCartesian3=function(e){return new hg(e.x,e.y,e.z)},hg.toValue=function(e,t){return Ze(t)||(t=new Float32Array([e.x,e.y,e.z])),t[0]=e.x,t[1]=e.y,t[2]=e.z,t},Object.defineProperties(fg.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),fg.mercatorAngleToGeodeticLatitude=function(e){return pt.PI_OVER_TWO-2*Math.atan(Math.exp(-e))},fg.geodeticLatitudeToMercatorAngle=function(e){fg.MaximumLatitude<e?e=fg.MaximumLatitude:e<-fg.MaximumLatitude&&(e=-fg.MaximumLatitude);var t=Math.sin(e);return.5*Math.log((1+t)/(1-t))},fg.MaximumLatitude=fg.mercatorAngleToGeodeticLatitude(Math.PI),fg.prototype.project=function(e,t){var n=this._semimajorAxis,r=e.longitude*n,i=fg.geodeticLatitudeToMercatorAngle(e.latitude)*n,o=e.height;return Ze(t)?(t.x=r,t.y=i,t.z=o,t):new _t(r,i,o)},fg.prototype.unproject=function(e,t){var n=this._oneOverSemimajorAxis,r=e.x*n,i=fg.mercatorAngleToGeodeticLatitude(e.y*n),o=e.z;return Ze(t)?(t.longitude=r,t.latitude=i,t.height=o,t):new Un(r,i,o)};var _g={};function gg(e,t){var n,r=e.attributes;for(var i in r){!r.hasOwnProperty(i)||Ze(n=r[i])&&Ze(n.values)&&t.push(n.values.buffer)}Ze(e.indices)&&t.push(e.indices.buffer)}function yg(e){var t=e.length,n=new Float32Array(1+(ko.packedLength+1)*t),r=0;n[r++]=t;for(var i=0;i<t;++i){Ze(e[i])?(n[r++]=1,ko.pack(e[i],n,r)):n[r++]=0,r+=ko.packedLength}return n}function vg(e){for(var t=new Array(e[0]),n=0,r=1;r<e.length;)1===e[r++]&&(t[n]=ko.unpack(e,r)),++n,r+=ko.packedLength;return t}_g.combineGeometry=function(e){var t,n,r,i,o,a,s,u=e.instances,l=u.length,c=!1;0<l&&(0<(t=dg(e)).length&&(n=Km.createAttributeLocations(t[0]),e.createPickOffsets&&(mg(o=u,"geometry",a=t,s=[]),mg(o,"westHemisphereGeometry",a,s),mg(o,"eastHemisphereGeometry",a,s),r=s)),Ze(u[0].attributes)&&Ze(u[0].attributes.offset)&&(i=new Array(l),c=!0));for(var h=new Array(l),f=new Array(l),p=0;p<l;++p){var d=u[p],m=d.geometry;Ze(m)&&(h[p]=m.boundingSphere,f[p]=m.boundingSphereCV,c&&(i[p]=d.geometry.offsetAttribute));var _=d.eastHemisphereGeometry,g=d.westHemisphereGeometry;Ze(_)&&Ze(g)&&(Ze(_.boundingSphere)&&Ze(g.boundingSphere)&&(h[p]=ko.union(_.boundingSphere,g.boundingSphere)),Ze(_.boundingSphereCV)&&Ze(g.boundingSphereCV)&&(f[p]=ko.union(_.boundingSphereCV,g.boundingSphereCV)))}return{geometries:t,modelMatrix:e.modelMatrix,attributeLocations:n,pickOffsets:r,offsetInstanceExtend:i,boundingSpheres:h,boundingSpheresCV:f}},_g.packCreateGeometryResults=function(e,t){var n=new Float64Array(function(e){for(var t=1,n=e.length,r=0;r<n;r++){var i=e[r];if(++t,Ze(i)){var o=i.attributes;for(var a in t+=7+2*ko.packedLength+(Ze(i.indices)?i.indices.length:0),o){o.hasOwnProperty(a)&&Ze(o[a])&&(t+=5+o[a].values.length)}}}return t}(e)),r=[],i={},o=e.length,a=0;n[a++]=o;for(var s=0;s<o;s++){var u=e[s],l=Ze(u);if(n[a++]=l?1:0,l){n[a++]=u.primitiveType,n[a++]=u.geometryType,n[a++]=Je(u.offsetAttribute,-1);var c=Ze(u.boundingSphere)?1:0;(n[a++]=c)&&ko.pack(u.boundingSphere,n,a),a+=ko.packedLength;var h=Ze(u.boundingSphereCV)?1:0;(n[a++]=h)&&ko.pack(u.boundingSphereCV,n,a),a+=ko.packedLength;var f=u.attributes,p=[];for(var d in f)f.hasOwnProperty(d)&&Ze(f[d])&&(p.push(d),Ze(i[d])||(i[d]=r.length,r.push(d)));n[a++]=p.length;for(var m=0;m<p.length;m++){var _=p[m],g=f[_];n[a++]=i[_],n[a++]=g.componentDatatype,n[a++]=g.componentsPerAttribute,n[a++]=g.normalize?1:0,n[a++]=g.values.length,n.set(g.values,a),a+=g.values.length}var y=Ze(u.indices)?u.indices.length:0;0<(n[a++]=y)&&(n.set(u.indices,a),a+=y)}}return t.push(n.buffer),{stringTable:r,packedData:n}},_g.unpackCreateGeometryResults=function(e){for(var t=e.stringTable,n=e.packedData,r=new Array(n[0]),i=0,o=1;o<n.length;){if(1===n[o++]){var a,s,u=n[o++],l=n[o++],c=n[o++];-1===c&&(c=void 0),1===n[o++]&&(a=ko.unpack(n,o)),o+=ko.packedLength,1===n[o++]&&(s=ko.unpack(n,o)),o+=ko.packedLength;var h=new Dd,f=n[o++];for(E=0;E<f;E++){for(var p=t[n[o++]],d=n[o++],m=n[o++],_=0!==n[o++],g=n[o++],y=Mt.createTypedArray(d,g),v=0;v<g;v++)y[v]=n[o++];h[p]=new Rd({componentDatatype:d,componentsPerAttribute:m,normalize:_,values:y})}if(0<(g=n[o++]))for(var x=y.length/m,b=wa.createTypedArray(x,g),E=0;E<g;E++)b[E]=n[o++];r[i++]=new dc({primitiveType:u,geometryType:l,boundingSphere:a,boundingSphereCV:s,indices:b,attributes:h,offsetAttribute:c})}else r[i++]=void 0}return r},_g.packCombineGeometryParameters=function(e,t){for(var n=e.createGeometryResults,r=n.length,i=0;i<r;i++)t.push(n[i].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:function(e,t){var n=e.length,r=new Float64Array(1+19*n),i=0;r[i++]=n;for(var o=0;o<n;o++){var a,s=e[o];on.pack(s.modelMatrix,r,i),i+=on.packedLength,Ze(s.attributes)&&Ze(s.attributes.offset)&&(a=s.attributes.offset.value,r[i]=a[0],r[i+1]=a[1],r[i+2]=a[2]),i+=3}return t.push(r.buffer),r}(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof Zn,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},_g.unpackCombineGeometryParameters=function(e){for(var t=function(e){for(var t=e,n=new Array(t[0]),r=0,i=1;i<t.length;){var o,a=on.unpack(t,i);Ze(t[i+=on.packedLength])&&(o={offset:new hg(t[i],t[i+1],t[i+2])}),i+=3,n[r++]={modelMatrix:a,attributes:o}}return n}(e.packedInstances),n=e.createGeometryResults,r=n.length,i=0,o=0;o<r;o++)for(var a=_g.unpackCreateGeometryResults(n[o]),s=a.length,u=0;u<s;u++){var l=a[u];t[i].geometry=l,++i}var c=Wn.clone(e.ellipsoid);return{instances:t,ellipsoid:c,projection:new(e.isGeographic?Zn:fg)(c),elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:on.clone(e.modelMatrix),createPickOffsets:e.createPickOffsets}},_g.packCombineGeometryResults=function(e,t){Ze(e.geometries)&&function(e,t){for(var n=e.length,r=0;r<n;++r)gg(e[r],t)}(e.geometries,t);var n=yg(e.boundingSpheres),r=yg(e.boundingSpheresCV);return t.push(n.buffer,r.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:n,boundingSpheresCV:r,transferableObjects:t}},_g.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:vg(e.boundingSpheres),boundingSpheresCV:vg(e.boundingSpheresCV)}};var xg=Object.freeze({READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6});function bg(e){e=Je(e,Je.EMPTY_OBJECT),this.geometryInstances=e.geometryInstances,this.name=e.name,this.crossid=e.crossid,this._evColor=It.WHITE,this.batchTableEvColorUpdated=!1,this.owner=e.owner,this.appearance=e.appearance,this._appearance=void 0,this._material=void 0,this.depthFailAppearance=e.depthFailAppearance,this._depthFailAppearance=void 0,this._depthFailMaterial=void 0,this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this._modelMatrix=new on,this.show=Je(e.show,!0),this._vertexCacheOptimize=Je(e.vertexCacheOptimize,!1),this._interleave=Je(e.interleave,!1),this._releaseGeometryInstances=Je(e.releaseGeometryInstances,!0),this._allowPicking=Je(e.allowPicking,!0),this._asynchronous=Je(e.asynchronous,!0),this._compressVertices=Je(e.compressVertices,!0),this.cull=Je(e.cull,!0),this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this.rtcCenter=e.rtcCenter,this.shadows=Je(e.shadows,Cd.DISABLED),this._translucent=void 0,this._state=xg.READY,this._geometries=[],this._error=void 0,this._numberOfInstances=0,this._boundingSpheres=[],this._boundingSphereWC=[],this._boundingSphereCV=[],this._boundingSphere2D=[],this._boundingSphereMorph=[],this._perInstanceAttributeCache=[],this._instanceIds=[],this._lastPerInstanceAttributeIndex=0,this._va=[],this._attributeLocations=void 0,this._primitiveType=void 0,this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._depthFailAppearance=void 0,this._spDepthFail=void 0,this._frontFaceDepthFailRS=void 0,this._backFaceDepthFailRS=void 0,this._pickIds=[],this._colorCommands=[],this._pickCommands=[],this._createBoundingVolumeFunction=e._createBoundingVolumeFunction,this._createRenderStatesFunction=e._createRenderStatesFunction,this._createShaderProgramFunction=e._createShaderProgramFunction,this._createCommandsFunction=e._createCommandsFunction,this._updateAndQueueCommandsFunction=e._updateAndQueueCommandsFunction,this._createPickOffsets=e._createPickOffsets,this._pickOffsets=void 0,this._createGeometryResults=void 0,this._ready=!1,this._readyPromise=D.defer(),this._batchTable=void 0,this._batchTableAttributeIndices=void 0,this._offsetInstanceExtend=void 0,this._batchTableOffsetAttribute2DIndex=void 0,this._batchTableOffsetsUpdated=!1,this._instanceBoundingSpheres=void 0,this._instanceBoundingSpheresCV=void 0,this._tempBoundingSpheres=void 0,this._recomputeBoundingSpheres=!1,this._batchTableBoundingSpheresUpdated=!1,this._batchTableBoundingSphereAttributeIndices=void 0}Object.defineProperties(bg.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},evColor:{get:function(){return this._evColor},set:function(e){e instanceof It&&!It.equals(e,this._evColor)&&(this._evColor=e,this.batchTableEvColorUpdated=!0)}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},pickIds:{get:function(){return this._pickIds}}});var Eg=new En,Tg=new _t,Sg=new qt;function Cg(e){var t=e.length;return 1===t?e[0]:2===t?En.unpack(e,0,Eg):3===t?_t.unpack(e,0,Tg):4===t?qt.unpack(e,0,Sg):void 0}function wg(e,t){var n=e.geometryInstances,r=Array.isArray(n)?n:[n],i=r.length;if(0!==i){for(var o,a,s,u=function(e){var t,n=e.length,r=[],i=e[0].attributes;for(t in i)if(i.hasOwnProperty(t)&&Ze(i[t])){for(var o=i[t],a=!0,s=1;s<n;++s){var u=e[s].attributes[t];if(!Ze(u)||o.componentDatatype!==u.componentDatatype||o.componentsPerAttribute!==u.componentsPerAttribute||o.normalize!==u.normalize){a=!1;break}}a&&r.push(t)}return r}(r),l=u.length,c=[],h={},f={},p=r[0].attributes,d=0;d<l;++d)s=p[a=u[d]],h[a]=d,c.push({functionName:"czm_batchTable_"+a,componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize});-1!==u.indexOf("distanceDisplayCondition")&&(c.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:Mt.FLOAT,componentsPerAttribute:1}),f.center3DHigh=c.length-5,f.center3DLow=c.length-4,f.center2DHigh=c.length-3,f.center2DLow=c.length-2,f.radius=c.length-1),-1!==u.indexOf("offset")&&(c.push({functionName:"czm_batchTable_offset2D",componentDatatype:Mt.FLOAT,componentsPerAttribute:3}),o=c.length-1),c.push({functionName:"czm_batchTable_pickColor",componentDatatype:Mt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});var m=c.length,_=new nm(t,c,i);for(d=0;d<i;++d){for(var g=r[d],p=g.attributes,y=0;y<l;++y){var v=Cg((s=p[a=u[y]]).value),x=h[a];_.setBatchedAttribute(d,x,v)}var b={primitive:Je(g.pickPrimitive,e)};Ze(g.id)&&(b.id=g.id);var E=t.createPickId(b);e._pickIds.push(E);var T=E.color,S=Sg;S.x=It.floatToByte(T.red),S.y=It.floatToByte(T.green),S.z=It.floatToByte(T.blue),S.w=It.floatToByte(T.alpha),_.setBatchedAttribute(d,m-1,S)}e._batchTable=_,e._batchTableAttributeIndices=h,e._batchTableBoundingSphereAttributeIndices=f,e._batchTableOffsetAttribute2DIndex=o}}function Ag(e){var t,n,r,i,o=e.attributes,a=new Dd;for(var s in o)o.hasOwnProperty(s)&&Ze(o[s])&&(a[s]=(t=o[s],n=void 0,n=Array.isArray(t.values)?t.values.slice(0):new t.values.constructor(t.values),new Rd({componentDatatype:t.componentDatatype,componentsPerAttribute:t.componentsPerAttribute,normalize:t.normalize,values:n})));return Ze(e.indices)&&(r=e.indices,i=Array.isArray(r)?r.slice(0):new r.constructor(r)),new dc({attributes:a,indices:i,primitiveType:e.primitiveType,boundingSphere:ko.clone(e.boundingSphere)})}var Ig=/attribute\s+vec(?:3|4)\s+(.*)3DHigh;/g;function Pg(e){return Xr.replaceMain(e,"czm_non_pick_main")+"\nvarying vec4 v_pickColor; \nvarying vec4 ev_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor = czm_batchTable_pickColor(batchId); \n    ev_pickColor = vec4(1.0); \n}"}function Og(e){return"varying vec4 v_pickColor;\n"+e}function Lg(e,t){if(!e.compressVertices)return t;var n=-1!==t.search(/attribute\s+vec3\s+normal;/g),r=-1!==t.search(/attribute\s+vec2\s+st;/g);if(!n&&!r)return t;var i=-1!==t.search(/attribute\s+vec3\s+tangent;/g),o=-1!==t.search(/attribute\s+vec3\s+bitangent;/g),a=r&&n?2:1,s="compressedAttributes",u="attribute "+(1<(a+=i||o?1:0)?"vec"+a:"float")+" "+s+";",l="",c="";r&&(l+="vec2 st;\n",c+="    st = czm_decompressTextureCoordinates("+(1<a?s+".x":s)+");\n"),n&&i&&o?(l+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",c+="    czm_octDecode("+s+"."+(r?"yz":"xy")+", normal, tangent, bitangent);\n"):(n&&(l+="vec3 normal;\n",c+="    normal = czm_octDecode("+s+(1<a?"."+(r?"y":"x"):"")+");\n"),i&&(l+="vec3 tangent;\n",c+="    tangent = czm_octDecode("+s+"."+(r&&n?"z":"y")+");\n"),o&&(l+="vec3 bitangent;\n",c+="    bitangent = czm_octDecode("+s+"."+(r&&n?"z":"y")+");\n"));var h=t;return h=(h=(h=(h=h.replace(/attribute\s+vec3\s+normal;/g,"")).replace(/attribute\s+vec2\s+st;/g,"")).replace(/attribute\s+vec3\s+tangent;/g,"")).replace(/attribute\s+vec3\s+bitangent;/g,""),[u,l,h=Xr.replaceMain(h,"czm_non_compressed_main"),"void main() \n{ \n"+c+"    czm_non_compressed_main(); \n}"].join("\n")}function Ng(e){e.vertexAttributes}function Rg(e,t){return function(){return e[t]}}bg._modifyShaderPosition=function(e,t,n){for(var r,i="",o="",a="";null!==(r=Ig.exec(t));){var s=r[1],u="vec4 czm_compute"+s[0].toUpperCase()+s.substr(1)+"()";"vec4 czm_computePosition()"!=u&&(i+=u+";\n"),Ze(e.rtcCenter)?(i+="uniform mat4 u_modifiedModelView;\n",o+="attribute vec4 position;\n",a+=u+"\n{\n    return u_modifiedModelView * position;\n}\n\n",t=(t=(t=(t=t.replace(/attribute\s+vec(?:3|4)\s+position3DHigh;/g,"")).replace(/attribute\s+vec(?:3|4)\s+position3DLow;/g,"")).replace(/czm_modelViewRelativeToEye\s+\*\s+/g,"")).replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):n?a+=u+"\n{\n    return czm_translateRelativeToEye("+s+"3DHigh, "+s+"3DLow);\n}\n\n":(o+="attribute vec3 "+s+"2DHigh;\nattribute vec3 "+s+"2DLow;\n",a+=u+"\n{\n    vec4 p;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye("+s+"3DHigh, "+s+"3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye("+s+"2DHigh.zxy, "+s+"2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye("+s+"2DHigh.zxy, "+s+"2DLow.zxy),\n                czm_translateRelativeToEye("+s+"3DHigh, "+s+"3DLow),\n                czm_morphTime);\n    }\n    return p;\n}\n\n")}return[i,o,t,a].join("\n")},bg._appendShowToShader=function(e,t){if(!Ze(e._batchTableAttributeIndices.show))return t;return Xr.replaceMain(t,"czm_non_show_main")+"\nvoid main() \n{ \n    czm_non_show_main(); \n    gl_Position *= czm_batchTable_show(batchId); \n}"},bg._updateColorAttribute=function(e,t,n){if(!Ze(e._batchTableAttributeIndices.color)&&!Ze(e._batchTableAttributeIndices.depthFailColor))return t;if(-1===t.search(/attribute\s+vec4\s+color;/g))return t;var r=(r=t).replace(/attribute\s+vec4\s+color;/g,"");return r=n?r.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):r.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2")},bg._updatePickColorAttribute=function(e){return e.replace(/attribute\s+vec4\s+pickColor;/g,"").replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2")},bg._appendOffsetToShader=function(e,t){if(!Ze(e._batchTableAttributeIndices.offset))return t;var n=t.replace(/attribute\s+float\s+batchId;/g,"attribute float batchId;\nattribute float applyOffset;");return n=n.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,"vec4 $1 = czm_computePosition();\n    if (czm_sceneMode == czm_sceneMode3D)\n    {\n        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);    }\n    else\n    {\n        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);    }\n")},bg._appendDistanceDisplayConditionToShader=function(e,t,n){if(!Ze(e._batchTableAttributeIndices.distanceDisplayCondition))return t;var r="void main() \n{ \n    czm_non_distanceDisplayCondition_main(); \n    vec2 distanceDisplayCondition = czm_batchTable_distanceDisplayCondition(batchId);\n    vec3 boundingSphereCenter3DHigh = czm_batchTable_boundingSphereCenter3DHigh(batchId);\n    vec3 boundingSphereCenter3DLow = czm_batchTable_boundingSphereCenter3DLow(batchId);\n    float boundingSphereRadius = czm_batchTable_boundingSphereRadius(batchId);\n";return r+=n?"    vec4 centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n":"    vec3 boundingSphereCenter2DHigh = czm_batchTable_boundingSphereCenter2DHigh(batchId);\n    vec3 boundingSphereCenter2DLow = czm_batchTable_boundingSphereCenter2DLow(batchId);\n    vec4 centerRTE;\n    if (czm_morphTime == 1.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);\n    }\n    else\n    {\n        centerRTE = czm_columbusViewMorph(\n                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),\n                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),\n                czm_morphTime);\n    }\n",Xr.replaceMain(t,"czm_non_distanceDisplayCondition_main")+"\n"+(r+="    float radiusSq = boundingSphereRadius * boundingSphereRadius; \n    float distanceSq; \n    if (czm_sceneMode == czm_sceneMode2D) \n    { \n        distanceSq = czm_eyeHeight2D.y - radiusSq; \n    } \n    else \n    { \n        distanceSq = dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; \n    } \n    distanceSq = max(distanceSq, 0.0); \n    float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x; \n    float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y; \n    float show = (distanceSq >= nearSq && distanceSq <= farSq) ? 1.0 : 0.0; \n    gl_Position *= show; \n}")};var Dg,Mg=Math.max(et.hardwareConcurrency-1,1),Fg=new Df("combineGeometry",Number.POSITIVE_INFINITY);function zg(n,r){var e,t=n._instanceIds;if(n._state===xg.READY){_=Array.isArray(n.geometryInstances)?n.geometryInstances:[n.geometryInstances];for(var i,o=n._numberOfInstances=_.length,a=[],s=[],u=0;u<o;++u)e=_[u].geometry,t.push(_[u].id),s.push({moduleName:e._workerName,geometry:e});if(!Ze(Dg))for(Dg=new Array(Mg),u=0;u<Mg;u++)Dg[u]=new Df("createGeometry",Number.POSITIVE_INFINITY);for(s=function(e,t){for(var n=[],r=e.length,i=0;i<r;){var o=Math.ceil((r-i)/t--);n.push(e.slice(i,i+o)),i+=o}return n}(s,Mg),u=0;u<s.length;u++){var l=0,c=s[u],h=c.length;for(d=0;d<h;++d)Ze((e=(i=c[d]).geometry).constructor.pack)&&(i.offset=l,l+=Je(e.constructor.packedLength,e.packedLength));if(0<l)for(var f=new Float64Array(l),p=[f.buffer],d=0;d<h;++d)Ze((e=(i=c[d]).geometry).constructor.pack)&&(e.constructor.pack(e,f,i.offset),i.geometry=f);a.push(Dg[u].scheduleTask({subTasks:s[u]},p))}n._state=xg.CREATING,D.all(a,function(e){n._createGeometryResults=e,n._state=xg.CREATED}).otherwise(function(e){iy(n,r,xg.FAILED,e)})}else if(n._state===xg.CREATED){for(var m=[],_=Array.isArray(n.geometryInstances)?n.geometryInstances:[n.geometryInstances],g=r.scene3DOnly,y=r.mapProjection,v=Fg.scheduleTask(_g.packCombineGeometryParameters({createGeometryResults:n._createGeometryResults,instances:_,ellipsoid:y.ellipsoid,projection:y,elementIndexUintSupported:r.context.elementIndexUint,scene3DOnly:g,vertexCacheOptimize:n.vertexCacheOptimize,compressVertices:n.compressVertices,modelMatrix:n.modelMatrix,createPickOffsets:n._createPickOffsets},m),m),x=0;x<n._createGeometryResults.length;x++)n._createGeometryResults[x].packedData=void 0;n._createGeometryResults=void 0,n._state=xg.COMBINING,D(v,function(e){var t=_g.unpackCombineGeometryResults(e);n._geometries=t.geometries,n._attributeLocations=t.attributeLocations,n.modelMatrix=on.clone(t.modelMatrix,n.modelMatrix),n._pickOffsets=t.pickOffsets,n._offsetInstanceExtend=t.offsetInstanceExtend,n._instanceBoundingSpheres=t.boundingSpheres,n._instanceBoundingSpheresCV=t.boundingSpheresCV,Ze(n._geometries)&&0<n._geometries.length?(n._recomputeBoundingSpheres=!0,n._state=xg.COMBINED):iy(n,r,xg.FAILED,void 0),e.transferableObjects=[],m=[]}).otherwise(function(e){iy(n,r,xg.FAILED,e)})}}var Bg=new $d,Ug=new Un,Vg=new _t,kg=new ko;var Gg=new _t,qg=new _t;function Hg(e,t){if(Ze(e._batchTableAttributeIndices.offset)&&!e._batchTableOffsetsUpdated&&!t.scene3DOnly){for(var n=e._batchTableOffsetAttribute2DIndex,r=t.mapProjection,i=r.ellipsoid,o=e._batchTable,a=e._instanceBoundingSpheres,s=a.length,u=0;u<s;++u){var l,c,h,f,p,d,m,_,g,y=a[u];Ze(y)&&(l=o.getBatchedAttribute(u,e._batchTableAttributeIndices.offset),_t.equals(l,_t.ZERO)?o.setBatchedAttribute(u,n,_t.ZERO):(Ze(c=e.modelMatrix)&&(y=ko.transform(y,c,kg)),h=y.center,h=i.scaleToGeodeticSurface(h,qg),d=i.cartesianToCartographic(h,Ug),f=r.project(d,Vg),p=_t.add(l,h,Gg),d=i.cartesianToCartographic(p,d),m=r.project(d,Gg),g=(_=_t.subtract(m,f,Gg)).x,_.x=_.z,_.z=_.y,_.y=g,o.setBatchedAttribute(u,n,_)))}e._batchTableOffsetsUpdated=!0}}function Wg(e,t,n,r){var i,o=n.getRenderState();r?((i=$e(o,!1)).cull={enabled:!0,face:hi.BACK},e._frontFaceRS=sr.fromCache(i),i.cull.face=hi.FRONT,e._backFaceRS=sr.fromCache(i)):(e._frontFaceRS=sr.fromCache(o),e._backFaceRS=e._frontFaceRS),i=$e(o,!1),Ze(e._depthFailAppearance)&&(i.depthTest.enabled=!1),Ze(e._depthFailAppearance)&&((i=$e(o=e._depthFailAppearance.getRenderState(),!1)).depthTest.func=kc.GREATER,r?(i.cull={enabled:!0,face:hi.BACK},e._frontFaceDepthFailRS=sr.fromCache(i),i.cull.face=hi.FRONT,e._backFaceDepthFailRS=sr.fromCache(i)):(e._frontFaceDepthFailRS=sr.fromCache(i),e._backFaceDepthFailRS=e._frontFaceRS))}function Yg(e,t,n){var r,i=t.context,o=e._attributeLocations,a=e._batchTable.getVertexShaderCallback()(n.vertexShaderSource),a=bg._appendOffsetToShader(e,a);a=bg._appendShowToShader(e,a),a=Pg(a=bg._appendDistanceDisplayConditionToShader(e,a,t.scene3DOnly)),a=bg._updateColorAttribute(e,a,!1),r=a,Ze(e._batchTableAttributeIndices.evColor)&&(r=r.replace("ev_pickColor = vec4(1.0);","ev_pickColor= czm_batchTable_evColor(batchId);")),a=Lg(e,a=r),a=bg._modifyShaderPosition(e,a,t.scene3DOnly);var s,u=Og(u=n.getFragmentShaderSource());e._sp=ic.replaceCache({context:i,shaderProgram:e._sp,vertexShaderSource:a,fragmentShaderSource:u,attributeLocations:o}),Ng(e._sp),Ze(e._depthFailAppearance)&&(a=e._batchTable.getVertexShaderCallback()(e._depthFailAppearance.vertexShaderSource),a=bg._appendShowToShader(e,a),a=Pg(a=bg._appendDistanceDisplayConditionToShader(e,a,t.scene3DOnly)),a=Lg(e,a=bg._updateColorAttribute(e,a,!0)),a=bg._modifyShaderPosition(e,a,t.scene3DOnly),s=Xr.replaceMain(a,"czm_non_depth_clamp_main"),a=s+="varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n    vec4 position = gl_Position;\n    v_WindowZ = (0.5 * (position.z / position.w) + 0.5) * position.w;\n    position.z = min(position.z, position.w);\n    gl_Position = position;\n}\n",u=Og(u=e._depthFailAppearance.getFragmentShaderSource()),u="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n"+Xr.replaceMain(u,"czm_non_depth_clamp_main")+"varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth)\n    #if defined(LOG_DEPTH)\n        czm_writeLogDepth();\n    #else\n        gl_FragDepthEXT = min(v_WindowZ * gl_FragCoord.w, 1.0);\n    #endif\n#endif\n}\n",e._spDepthFail=ic.replaceCache({context:i,shaderProgram:e._spDepthFail,vertexShaderSource:a,fragmentShaderSource:u,attributeLocations:o}),Ng(e._spDepthFail))}var Xg=new on,jg=new _t;function Kg(t,e,n,r){var i=Ze(n)?n._uniforms:void 0,o={},a=e.uniforms;if(Ze(a))for(var s in a)a.hasOwnProperty(s)&&(o[s]=Rg(a,s));var u=ne(o,i),u=t._batchTable.getUniformMapCallback()(u);return Ze(t.rtcCenter)&&(u.u_modifiedModelView=function(){var e=r.context.uniformState.view;return on.multiply(e,t._modelMatrix,Xg),on.multiplyByPoint(Xg,t.rtcCenter,jg),on.setTranslation(Xg,jg,Xg),Xg}),u}function Qg(e,t,n,r,i,o,a,s){var u,l=Kg(e,t,n,s);Ze(e._depthFailAppearance)&&(u=Kg(e,e._depthFailAppearance,e._depthFailAppearance.material,s));var c=r?yn.TRANSLUCENT:yn.OPAQUE,h=i?2:1;h*=Ze(e._depthFailAppearance)?2:1,o.length=e._va.length*h;for(var f,p=o.length,d=0,m=0;m<p;++m){i&&(Ze(f=o[m])||(f=o[m]=new Mn({owner:e,primitiveType:e._primitiveType})),f.vertexArray=e._va[d],f.renderState=e._backFaceRS,f.shaderProgram=e._sp,f.uniformMap=l,f.pass=c,++m),Ze(f=o[m])||(f=o[m]=new Mn({owner:e,primitiveType:e._primitiveType})),f.vertexArray=e._va[d],f.renderState=e._frontFaceRS,f.shaderProgram=e._sp,f.uniformMap=l,f.pass=c,Ze(e._depthFailAppearance)&&(i&&(Ze(f=o[++m])||(f=o[m]=new Mn({owner:e,primitiveType:e._primitiveType})),f.vertexArray=e._va[d],f.renderState=e._backFaceDepthFailRS,f.shaderProgram=e._spDepthFail,f.uniformMap=u,f.pass=c),Ze(f=o[++m])||(f=o[m]=new Mn({owner:e,primitiveType:e._primitiveType})),f.vertexArray=e._va[d],f.renderState=e._frontFaceDepthFailRS,f.shaderProgram=e._spDepthFail,f.uniformMap=u,f.pass=c),++d}}function Zg(e,t,n,r,i,o,a,s){var u;bg._updateBoundingVolumes(e,t,i),t.mode===Tl.SCENE3D?u=e._boundingSphereWC:t.mode===Tl.COLUMBUS_VIEW?u=e._boundingSphereCV:t.mode===Tl.SCENE2D&&Ze(e._boundingSphere2D)?u=e._boundingSphere2D:Ze(e._boundingSphereMorph)&&(u=e._boundingSphereMorph);var l=t.commandList,c=t.passes;if(c.render||c.pick){var h=e.allowPicking,f=Cd.castShadows(e.shadows),p=Cd.receiveShadows(e.shadows),d=n.length,m=s?2:1;m*=Ze(e._depthFailAppearance)?2:1;for(var _=0;_<d;++_){var g=Math.floor(_/m),y=n[_];y.modelMatrix=i,y.boundingVolume=u[g],y.cull=o,y.debugShowBoundingVolume=a,y.castShadows=f,y.receiveShadows=p,y.pickId=h?"v_pickColor":void 0,l.push(y)}}}bg._updateBoundingVolumes=function(e,t,n,r){var i,o,a;if(r||!on.equals(n,e._modelMatrix))for(on.clone(n,e._modelMatrix),o=e._boundingSpheres.length,i=0;i<o;++i)Ze(a=e._boundingSpheres[i])&&(e._boundingSphereWC[i]=ko.transform(a,n,e._boundingSphereWC[i]),t.scene3DOnly||(e._boundingSphere2D[i]=ko.clone(e._boundingSphereCV[i],e._boundingSphere2D[i]),e._boundingSphere2D[i].center.x=0,e._boundingSphereMorph[i]=ko.union(e._boundingSphereWC[i],e._boundingSphereCV[i])));var s=e.appearance.pixelSize;if(Ze(s))for(o=e._boundingSpheres.length,i=0;i<o;++i){a=e._boundingSpheres[i];var u=e._boundingSphereWC[i],l=t.camera.getPixelSize(a,t.context.drawingBufferWidth,t.context.drawingBufferHeight)*s;u.radius=a.radius+l}},bg.prototype.update=function(e){if(!(!Ze(this.geometryInstances)&&0===this._va.length||Ze(this.geometryInstances)&&Array.isArray(this.geometryInstances)&&0===this.geometryInstances.length||!Ze(this.appearance)||e.mode!==Tl.SCENE3D&&e.scene3DOnly||!e.passes.render&&!e.passes.pick)){if(Ze(this._error))throw this._error;if(this._state!==xg.FAILED){var t,n,r,i,o,a,s,u,l=e.context;if(Ze(this._batchTable)||wg(this,l),0<this._batchTable.attributes.length){if(0===Nn.maximumVertexTextureImageUnits)throw new de("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(e)}this._state!==xg.COMPLETE&&this._state!==xg.COMBINED&&(this.asynchronous?zg:function(e,t){for(var n,r,i=Array.isArray(e.geometryInstances)?e.geometryInstances:[e.geometryInstances],o=e._numberOfInstances=i.length,a=new Array(o),s=e._instanceIds,u=0,l=0;l<o;l++){var c=(n=i[l]).geometry,h=Ze(c.attributes)&&Ze(c.primitiveType)?Ag(c):c.constructor.createGeometry(c);a[u++]={geometry:h,attributes:(r=n).attributes,modelMatrix:on.clone(r.modelMatrix),pickPrimitive:r.pickPrimitive,id:r.id},s.push(n.id)}a.length=u;var f=t.scene3DOnly,p=t.mapProjection,d=_g.combineGeometry({instances:a,ellipsoid:p.ellipsoid,projection:p,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:f,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e._createPickOffsets});e._geometries=d.geometries,e._attributeLocations=d.attributeLocations,e.modelMatrix=on.clone(d.modelMatrix,e.modelMatrix),e._pickOffsets=d.pickOffsets,e._offsetInstanceExtend=d.offsetInstanceExtend,e._instanceBoundingSpheres=d.boundingSpheres,e._instanceBoundingSpheresCV=d.boundingSpheresCV,Ze(e._geometries)&&0<e._geometries.length?(e._recomputeBoundingSpheres=!0,e._state=xg.COMBINED):iy(e,t,xg.FAILED,void 0)})(this,e),this._state===xg.COMBINED&&(function(e,t){if(Ze(e._batchTableAttributeIndices.distanceDisplayCondition)&&!e._batchTableBoundingSpheresUpdated){for(var n=e._batchTableBoundingSphereAttributeIndices,r=n.center3DHigh,i=n.center3DLow,o=n.center2DHigh,a=n.center2DLow,s=n.radius,u=t.mapProjection,l=u.ellipsoid,c=e._batchTable,h=e._instanceBoundingSpheres,f=h.length,p=0;p<f;++p){var d,m,_,g,y,v,x=h[p];Ze(x)&&(Ze(d=e.modelMatrix)&&(x=ko.transform(x,d,kg)),m=x.center,_=x.radius,v=$d.fromCartesian(m,Bg),c.setBatchedAttribute(p,r,v.high),c.setBatchedAttribute(p,i,v.low),t.scene3DOnly||(g=l.cartesianToCartographic(m,Ug),y=u.project(g,Vg),v=$d.fromCartesian(y,Bg),c.setBatchedAttribute(p,o,v.high),c.setBatchedAttribute(p,a,v.low)),c.setBatchedAttribute(p,s,_))}e._batchTableBoundingSpheresUpdated=!0}}(this,e),Hg(this,e),function(e,t){for(var n=e._attributeLocations,r=e._geometries,i=t.scene3DOnly,o=t.context,a=[],s=r.length,u=0;u<s;++u){var l,c,h,f,p=r[u];a.push(Ac.fromGeometry({context:o,geometry:p,attributeLocations:n,bufferUsage:wl.STATIC_DRAW,interleave:e._interleave})),Ze(e._createBoundingVolumeFunction)?e._createBoundingVolumeFunction(t,p):(e._boundingSpheres.push(ko.clone(p.boundingSphere)),e._boundingSphereWC.push(new ko),i||(c=(l=p.boundingSphereCV.center).x,h=l.y,f=l.z,l.x=f,l.y=c,l.z=h,e._boundingSphereCV.push(ko.clone(p.boundingSphereCV)),e._boundingSphere2D.push(new ko),e._boundingSphereMorph.push(new ko)))}for(e._va=a,e._primitiveType=r[0].primitiveType,e.releaseGeometryInstances&&(e.geometryInstances=void 0),u=0;u<e._geometries.length;u++)for(var d in e._geometries[u].attributes)e._geometries[u].attributes[d].values=void 0,e._geometries[u].attributes[d]=void 0;e._geometries=void 0,iy(e,t,xg.COMPLETE,void 0)}(this,e)),this.show&&this._state===xg.COMPLETE&&(this._batchTableOffsetsUpdated||Hg(this,e),this.batchTableEvColorUpdated&&function(e,t){if(Ze(e._batchTableAttributeIndices.evColor)&&e.batchTableEvColorUpdated&&!t.scene3DOnly){for(var n=e._batchTableAttributeIndices.evColor,r=e.evColor,i=new qt(255*r.red,255*r.green,255*r.blue,255*r.alpha),o=e._batchTable,a=o.numberOfInstances,s=0;s<a;s++)o.setBatchedAttribute(s,n,i);e.batchTableEvColorUpdated=!1}}(this,e),this._recomputeBoundingSpheres&&function(e,t){var n=e._batchTableAttributeIndices.offset;if(e._recomputeBoundingSpheres&&Ze(n)){var r=e._offsetInstanceExtend,i=e._instanceBoundingSpheres,o=i.length,a=e._tempBoundingSpheres;if(!Ze(a)){for(a=new Array(o),f=0;f<o;f++)a[f]=new ko;e._tempBoundingSpheres=a}for(f=0;f<o;++f){var s=a[f],u=e._batchTable.getBatchedAttribute(f,n,new _t);ey(s=i[f].clone(s),u,r[f])}for(var l=[],c=[],h=[],f=0;f<o;++f){var p=a[f];0<p.center.x-p.radius||ko.intersectPlane(p,Zf.ORIGIN_ZX_PLANE)!==Jn.INTERSECTING?l.push(p):(c.push(p),h.push(p))}var d=l[0],m=h[0],_=c[0];for(f=1;f<l.length;f++)d=ko.union(d,l[f]);for(f=1;f<h.length;f++)m=ko.union(m,h[f]);for(f=1;f<c.length;f++)_=ko.union(_,c[f]);var g=[];for(Ze(d)&&g.push(d),Ze(m)&&g.push(m),Ze(_)&&g.push(_),f=0;f<g.length;f++){var y=g[f].clone(e._boundingSpheres[f]);e._boundingSpheres[f]=y,e._boundingSphereCV[f]=ko.projectTo2D(y,t.mapProjection,e._boundingSphereCV[f])}bg._updateBoundingVolumes(e,t,e.modelMatrix,!0),e._recomputeBoundingSpheres=!1}else e._recomputeBoundingSpheres=!1}(this,e),n=(t=this.appearance).material,i=r=!1,this._appearance!==t?(this._appearance=t,this._material=n,i=r=!0):this._material!==n&&(this._material=n,i=!0),a=Ze(o=this.depthFailAppearance)?o.material:void 0,this._depthFailAppearance!==o?(this._depthFailAppearance=o,this._depthFailMaterial=a,i=r=!0):this._depthFailMaterial!==a&&(this._depthFailMaterial=a,i=!0),s=this._appearance.isTranslucent(),this._translucent!==s&&(this._translucent=s,r=!0),Ze(this._material)&&this._material.update(l),u=t.closed&&s,r&&Je(this._createRenderStatesFunction,Wg)(this,l,t,u),i&&Je(this._createShaderProgramFunction,Yg)(this,e,t),(r||i)&&Je(this._createCommandsFunction,Qg)(this,t,n,s,u,this._colorCommands,this._pickCommands,e),Je(this._updateAndQueueCommandsFunction,Zg)(this,e,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,u))}}};var Jg=new ko,$g=new ko;function ey(e,t,n){var r,i;return n===Md.TOP?(r=ko.clone(e,Jg),(i=ko.clone(e,$g)).center=_t.add(i.center,t,i.center),e=ko.union(r,i,e)):n===Md.ALL&&(e.center=_t.add(e.center,t,e.center)),e}function ty(i,o,a){return function(){var e=i.getBatchedAttribute(o,a),t=i.attributes[a],n=t.componentsPerAttribute,r=Mt.createTypedArray(t.componentDatatype,n);return Ze(e.constructor.pack)?e.constructor.pack(e,r,0):r[0]=e,r}}function ny(n,r,i,o,a){return function(e){var t=Cg(e);n.setBatchedAttribute(r,i,t),"offset"===a&&(o._recomputeBoundingSpheres=!0,o._batchTableOffsetsUpdated=!1)}}var ry=new _t;function iy(e,t,n,r){e._error=r,e._state=n,t.afterRender.push(function(){e._ready=e._state===xg.COMPLETE||e._state===xg.FAILED,Ze(r)?e._readyPromise.reject(r):e._readyPromise.resolve(e)})}function oy(e,t){0===t&&(t=pt.EPSILON7),this._boundingSphere=new ko(e,t)}function ay(e){this._meshId=Je(e.meshId,-1),this._instances=Je(e.instances,[]),this._model=Je(e.model,void 0),this._frameState=Je(e.frameState,void 0),this.show=Je(e.show,!0),this._instancingSupported=!1,this._dynamic=Je(e.dynamic,!1),this._allowPicking=Je(e.allowPicking,!0),this._dirty=!1,this.resource=e.model.content._resource,this._cull=Je(e.cull,!0),this._opaquePass=Je(e.opaquePass,yn.OPAQUE),this._drawCommands=[];for(var t=this._model.content._batchTable,n=0,n=Ze(t)&&Ze(t._properties.EVID)?Ze(t._properties.EVID[0])?t._properties.EVID[0]:1:t._content._tile._header.EVID,r={EVID:[],id:[],name:[]},i=this._model.gltf.nodes,o=0;o<this._instances.length;o++){var a=i[this._instances[o]._nodeId];this._instances[o]._instanceId=a.instanceIndex,r.id.push(a.componentID),r.name.push(a.componentName),r.EVID.push(n)}this._batchTable=new no(Ze(this._model)?this._model.content:void 0,this._instances.length,r),this._batchTable.upMatrix=xn.Y_UP_TO_Z_UP,this._features=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._pickIdBuffer=void 0,this._features=void 0,this._drawCommands=[],this._modelCommands=void 0,Ze(this._model.content._tile._boundingVolume)?this._boundingSphere=ko.clone(this._model.content._tile._boundingVolume._boundingSphere):this._boundingSphere=function(e){for(var t=e.length,n=new Array(t),r=0;r<t;++r)n[r]=on.getTranslation(e._instances[r]._modelMatrix,new _t);return ko.fromPoints(n)}(this),this._center=_t.clone(this._boundingSphere.center),this._rtcTransform=on.clone(on.IDENTITY),this._rtcModelView=new on,this._mode=void 0,this.modelMatrix=on.clone(on.IDENTITY),this._modelMatrix=on.clone(this.modelMatrix),this._boundingVolume=function(e,t){if(!Ze(e))throw new de("boundingSphere must be defined");if(Ze(e)){var n=e.center,r=e.radius;n=on.multiplyByPoint(t,n,n);var i=on.getScale(t,sy),o=_t.maximumComponent(i);return new oy(n,r*=o)}}(this._boundingSphere,this.modelMatrix),this._asynchronous=e.asynchronous,this._incrementallyLoadTextures=e.incrementallyLoadTextures,this._upAxis=e.upAxis,this._forwardAxis=e.forwardAxis,this._tileset=this._model.content.tileset}bg.prototype.getGeometryInstanceAttributes=function(e){for(var t=-1,n=this._lastPerInstanceAttributeIndex,r=this._instanceIds,i=r.length,o=0;o<i;++o){var a=(n+o)%i;if(e===r[a]){t=a;break}}if(-1!==t){if(Ze(m=this._perInstanceAttributeCache[t]))return m;var s,u,l,c,h,f,p=this._batchTable,d=this._batchTableAttributeIndices,m={},_={};for(var g in d){d.hasOwnProperty(g)&&(s=d[g],_[g]={get:ty(p,t,s),set:ny(p,t,s,this,g)})}return u=this,c=t,(l=_).boundingSphere={get:function(){var e,t,n=u._instanceBoundingSpheres[c];return Ze(n)&&(n=n.clone(),e=u.modelMatrix,Ze(t=l.offset)&&ey(n,_t.fromArray(t.get(),0,ry),u._offsetInstanceExtend[c]),Ze(e)&&(n=ko.transform(n,e))),n}},l.boundingSphereCV={get:function(){return u._instanceBoundingSpheresCV[c]}},h=this,f=t,_.pickId={get:function(){return h._pickIds[f]}},Object.defineProperties(m,_),this._lastPerInstanceAttributeIndex=t,this._perInstanceAttributeCache[t]=m}},bg.prototype.isDestroyed=function(){return!1},bg.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy();for(var e=this._va,t=e.length,n=0;n<t;++n)e[n].destroy();this._va=void 0;var r=this._pickIds;for(t=r.length,n=0;n<t;++n)r[n].destroy();return this._pickIds=void 0,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._instanceIds=void 0,this._perInstanceAttributeCache=void 0,this._attributeLocations=void 0,this.geometryInstances=void 0,Vt(this)},bg.prototype.release=function(){if(!this._isRealse){this._sp=this._sp&&this._sp.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy();for(var e=this._va,t=e.length,n=0;n<t;++n){e[n].destroy();for(var r=0;r<e[n]._attributes.length;r++)e[n]._attributes[r].vertexBuffer=void 0,e[n]._attributes[r]=void 0;e[n]=void 0}this._va=[],this._boundingSpheres=[],this._boundingSphereWC=[],this._boundingSphereCV=[],this._boundingSphere2D=[],this._boundingSphereMorph=[],this._perInstanceAttributeCache=[],this._instanceIds=[],this._lastPerInstanceAttributeIndex=0,this._primitiveType=void 0,this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._depthFailAppearance=void 0,this._spDepthFail=void 0,this._frontFaceDepthFailRS=void 0,this._backFaceDepthFailRS=void 0;var i=this._pickIds;for(t=i.length,n=0;n<t;++n)i[n].destroy();this._pickIds=[],this._colorCommands=[],this._pickCommands=[],this._batchTable=this._batchTable&&this._batchTable.destroy(),this._attributeLocations=void 0,this._pickOffsets=void 0,this._createGeometryResults=void 0,this._ready=!1,this._batchTable=void 0,this._appearance=void 0,this._material=void 0,this._batchTableAttributeIndices=void 0,this._offsetInstanceExtend=void 0,this._batchTableOffsetAttribute2DIndex=void 0,this._batchTableOffsetsUpdated=!1,this._instanceBoundingSpheres=void 0,this._instanceBoundingSpheresCV=void 0,this._tempBoundingSpheres=void 0,this._recomputeBoundingSpheres=!1,this._batchTableBoundingSpheresUpdated=!1,this._batchTableBoundingSphereAttributeIndices=void 0,this._modelMatrix=new on,this._geometries=[],this._state=xg.READY}},Object.defineProperties(oy.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}}),oy.prototype.distanceToCamera=function(e){var t=this._boundingSphere;return Math.max(0,_t.distance(t.center,e.camera.positionWC)-t.radius)},oy.prototype.intersectPlane=function(e){return ko.intersectPlane(this._boundingSphere,e)},oy.prototype.update=function(e,t){_t.clone(e,this._boundingSphere.center),this._boundingSphere.radius=t},oy.prototype.createDebugVolume=function(e){return new bg({geometryInstances:new Nd({geometry:new qd({radius:this.radius}),id:"outline",modelMatrix:on.fromTranslation(this.center,new on.clone(on.IDENTITY)),attributes:{color:Ld.fromColor(e)}}),appearance:new Jd({translucent:!1,flat:!0}),asynchronous:!1})},Object.defineProperties(ay.prototype,{length:{get:function(){return this._instances.length}},featuresLength:{get:function(){return this._batchTable.featuresLength}},tileset:{get:function(){return this._tileset}},batchTable:{get:function(){return this._batchTable}},url:{get:function(){return this.resource.getUrlComponent(!0)}}}),ay.prototype.isDestroyed=function(){return!1},ay.prototype.destroy=function(){return this._instances=[],Ze(this._pickIdBuffer)&&!this._pickIdBuffer.isDestroyed()&&this._pickIdBuffer.destroy(),Ze(this._batchIdBuffer)&&!this._batchIdBuffer.isDestroyed()&&this._batchIdBuffer.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)};var sy=new _t;function uy(e){if(!Ze(e.model))throw new fe("EV_E3MInternalInstance: options.model is required.");this._model=e.model,this.modelInstanceCollections=[],this._instancedUniformsByProgram=void 0,this._usesBatchTable=!0,this._tileset=this._model.content.tileset,this._precreatedAttributes=void 0}function ly(e,t,n){var r;(t.debugShowBoundingVolume||t.debugShowContentBoundingVolume)&&(r=It.BLUE,Ze(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(r)),e._debugBoundingVolume.update(n))}uy.prototype.postUpdate=function(e,t){for(var n=0;n<this.modelInstanceCollections.length;n++){var r=this.modelInstanceCollections[n],i=e.mode!==r._mode,o=t.modelMatrix,a=!on.equals(r._modelMatrix,o);ly(r,r._tileset,e),(i||a)&&(r._mode=e.mode,on.clone(o,r._modelMatrix),r._rtcTransform=r._modelMatrix)}},uy.prototype.generateInstanceCommandByGltf=function(e,t,n,r){for(var i in n._hash){var o;0<n.length&&(o=new ay({instances:n._hash[i],model:e,meshId:i,frameState:r}),r&&this.cesium3DTileBatchTableUpdate(e.content,r),vy(this,o,t,r.scene3DOnly),this.modelInstanceCollections.push(o))}};var cy=new It;function hy(e,t,n){var r=e.featuresLength;if(!Ze(e._pickTexture)&&0<r){for(var i=e._pickIds,o=e._textureDimensions,a=o.x*o.y*4,s=new Uint8Array(a),u=e._content,l=0;l<r;++l){var c=t.createPickId(fy(n,l));i.push(c);var h=c.color,f=4*l;s[f]=It.floatToByte(h.red),s[1+f]=It.floatToByte(h.green),s[2+f]=It.floatToByte(h.blue),s[3+f]=It.floatToByte(h.alpha)}e._pickTexture=py(e,t,s),u.tileset._statistics.batchTableByteLength+=e._pickTexture.sizeInBytes}}function fy(e,t){e.featuresLength;return function(e){var t=e.featuresLength;if(!Ze(e._features)&&0<t){for(var n=new Array(t),r=0;r<t;++r)n[r]=new Fo(e,r);e._features=n}}(e),e._features[t]}function py(e,t,n){var r=e._textureDimensions;return new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.UNSIGNED_BYTE,source:{width:r.x,height:r.y,arrayBufferView:n},flipY:!1,sampler:Nr.NEAREST})}function dy(e,t,n){var r=e._textureDimensions;return new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.FLOAT,source:{width:r.x,height:r.y,arrayBufferView:n},flipY:!1,sampler:Nr.NEAREST})}function my(e,t,n){var r=e._textureDimensions;n.copyFrom({width:r.x,height:r.y,arrayBufferView:t})}function _y(e,t){return new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([0,0,0,1])},flipY:!1,sampler:Nr.NEAREST})}function gy(e,t){var n=e._instances.length,r=e._dynamic,i=Ze(e._batchTable);if(i){for(var o=new Uint16Array(n),a=0;a<n;++a)o[a]=a;e._batchIdBuffer=Al.createVertexBuffer({context:t,typedArray:o,usage:wl.STATIC_DRAW})}if(!i){var s=new Uint8Array(4*n);for(a=0;a<n;++a){var u=e._pickIds[a].color,l=4*a;s[l]=It.floatToByte(u.red),s[1+l]=It.floatToByte(u.green),s[2+l]=It.floatToByte(u.blue),s[3+l]=It.floatToByte(u.alpha)}e._pickIdBuffer=Al.createVertexBuffer({context:t,typedArray:s,usage:wl.STATIC_DRAW})}var c=function(e){var t=e._instances,n=t.length,r=(e._center,e._vertexBufferTypedArray);Ze(r)||(r=new Float32Array(12*n));e._dynamic&&(e._vertexBufferTypedArray=r);for(var i=0;i<n;++i){var o=t[i]._modelMatrix,a=on.clone(o,yy),s=12*i;r[0+s]=a[0],r[1+s]=a[4],r[2+s]=a[8],r[3+s]=a[12],r[4+s]=a[1],r[5+s]=a[5],r[6+s]=a[9],r[7+s]=a[13],r[8+s]=a[2],r[9+s]=a[6],r[10+s]=a[10],r[11+s]=a[14]}return r}(e);e._vertexBuffer=Al.createVertexBuffer({context:t,typedArray:c,usage:r?wl.STREAM_DRAW:wl.STATIC_DRAW})}uy.prototype.applyStyle=function(e){for(var t=0;t<this.modelInstanceCollections.length;t++){var n=this.modelInstanceCollections[t];if(0===n.featuresLength){var r=Ze(e)&&Ze(e.color),i=Ze(e)&&Ze(e.show);n._model.color=r?e.color.evaluateColor(void 0,n._model.color):It.clone(It.WHITE,n._model.color),n._model.show=!i||e.show.evaluate(void 0)}else{if(!Ze(e))return n._batchTable.setAllColor(no._DEFAULT_COLOR_VALUE),void n._batchTable.setAllShow(no._DEFAULT_SHOW_VALUE);for(var o=n._batchTable.featuresLength,a=0;a<o;++a){var s,u,l,c=fy(n,a),h=Ze(e.color)?e.color.evaluateColor(c,cy):no._DEFAULT_COLOR_VALUE,f=Ze(e.show)?e.show.evaluate(c):no._DEFAULT_SHOW_VALUE;n._batchTable.setColor(a,h),n._batchTable.setShow(a,f),Ze(e.translation)&&(s=e.translation.evaluate(c),n._batchTable.setTranslation(a,s)),Ze(e.scale)&&(u=e.scale.evaluate(c),n._batchTable.setScale(a,u)),Ze(e.rotation)&&(l=e.rotation.evaluate(c),n._batchTable.setRotation(a,l))}}}},uy.prototype.cesium3DTileBatchTableUpdate=function(e,t){for(var n,r,i=t.context,o=t.passes,a=0;a<this.modelInstanceCollections.length;a++){var s=this.modelInstanceCollections[a],u=s._batchTable;u._defaultTexture=i.defaultTexture,!Ze(u._defaultTransTexture)&&Ze(u._textureDimensions)&&(u._defaultTransTexture=_y(0,i)),!Ze(u._defaultScaleTexture)&&Ze(u._textureDimensions)&&(u._defaultScaleTexture=new ti({context:i,pixelFormat:Ln.RGBA,pixelDatatype:Pn.FLOAT,source:{width:1,height:1,arrayBufferView:new Float32Array([1,1,1,1])},flipY:!1,sampler:Nr.NEAREST})),!Ze(u._defaultRotationTexture)&&Ze(u._textureDimensions)&&(u._defaultRotationTexture=_y(0,i)),(o.pick||o.postProcess)&&hy(u,i,s),u._batchValuesDirty&&(u._batchValuesDirty=!1,!Ze(u._batchTexture)&&Ze(u._batchValues)&&(u._batchTexture=py(u,i,u._batchValues),e._statistics.batchTableByteLength+=u._batchTexture.sizeInBytes),!Ze(u._translationTexture)&&Ze(u._transValues)&&(u._translationTexture=dy(u,i,u._transValues)),!Ze(u._scaleTexture)&&Ze(u._scaleValues)&&(u._scaleTexture=dy(u,i,u._scaleValues)),!Ze(u._rotationTexture)&&Ze(u._rotationValues)&&(u._rotationTexture=dy(u,i,u._rotationValues)),Ze(u._batchValues)&&(r=(n=u)._textureDimensions,n._batchTexture.copyFrom({width:r.x,height:r.y,arrayBufferView:n._batchValues})),Ze(u._transValues)&&my(u,u._transValues,u._translationTexture),Ze(u._scaleValues)&&my(u,u._scaleValues,u._scaleTexture),Ze(u._rotationValues)&&my(u,u._rotationValues,u._rotationTexture))}},uy.prototype.destroy=function(){Ze(this._precreatedAttributes)&&function(e){for(var t in e)e.hasOwnProperty(t)&&(e[t].isDestroyed()||e[t].destroy())}(this._model._rendererResources.vertexArrays);for(var e=0;e<this.modelInstanceCollections.length;e++)this.modelInstanceCollections[e].destroy(),this.modelInstanceCollections[e]=void 0;return this.modelInstanceCollections=[],this._model=null,Vt(this)},uy.prototype.regenerateShaders=function(e,t,n){!function(e,t,n,r){var i=e.programId,o=e.techniqueId,a=(r._model=t)._sourcePrograms[i],s=t._rendererResources.sourceShaders,u=t._quantizedVertexShaders,l=t.clippingPlanes,c=function(e){var t=e._clippingPlanes;return Ze(t)&&t.enabled&&0!==t.length}(t),h=s[a.vertexShader],f=s[a.fragmentShader];f+="uniform vec4 u_rollerRegion;",(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(h=u[i]);{var p;(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&-1===t._toClipCoordinatesGLSL[i].indexOf("czm_instanced_modelView ")&&(p="\nczm_instanced_modelView ",-1!==h.indexOf("gltf_a_dec_position")&&(p+="\ngltf_a_dec_position "),t._toClipCoordinatesGLSL[i]=Hu.toClipCoordinatesGLSL(t.gltf,p))}var d=t._toClipCoordinatesGLSL[i],m=f;!function(e){return!It.equals(e.color,It.WHITE)||e.colorBlendMode!==gp.HIGHLIGHT}(t)||(m=function(e){return e=Xr.replaceMain(e,"gltf_blend_main"),e+="uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight = ceil(gltf_colorBlend); \n    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *= gltf_color.a; \n} \n"}(m));c&&(m=function(e,t,n){return e=Xr.replaceMain(e,"gltf_clip_main"),e+=wp(t,n)+"\n",e+="uniform sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+Sp("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n"}(m,l,n));var _=Py(h,i,o,r),g=Iy(m,i,r);et.isInternetExplorer()||(_=Hu.modifyVertexShaderForLogDepth(_,d),g=t.rollerRegion.equals(Dy)?Hu.modifyFragmentShaderForLogDepth(g):Hu.modifyFragmentShaderForLogDepthAddRoller(g));Ze(t._uniformMapLoaded)||(g="uniform vec4 czm_pickColor;\n"+g);{var y;Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((y=(_="\n varying vec4 v_worldPosition; \n"+_).lastIndexOf("}"))&&(_=_.slice(0,y)+"vec4 eyePostion = czm_inverseProjection * gl_Position; \nv_worldPosition = czm_inverseView3D * eyePostion; \n"+_.slice(y)),g="\nvarying vec4 v_worldPosition; \n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) \nuniform float u_minimumBrightness ;\n#endif \nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n} \n"+wd+"\n"+g,t._scene.fog.enabled&&(g="#define FOG \n\n"+g))}var v=0<t._imageBasedLightingFactor.x||0<t._imageBasedLightingFactor.y;v&&(g="#define USE_IBL_LIGHTING \n\n"+g);Ze(t._lightColor)&&(g="#define USE_CUSTOM_LIGHT_COLOR \n\n"+g);"2.0"===t._sourceVersion&&!t._sourceKHRTechniquesWebGL||(g=Xr.replaceMain(g,"non_gamma_corrected_main"),g+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n");{var x;Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((x=g.lastIndexOf("}"))&&(g=g.slice(0,x)+"\n#if defined(FOG)\n  vec4 finalColor =  gl_FragColor; \n  float vDistance =  length((czm_view3D * v_worldPosition).xyz); \n  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(v_worldPosition.x, v_worldPosition.y, v_worldPosition.z), false, vec3(0.0));\n  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);\n #ifndef HDR\n  const float fExposure = 4.0;\n  fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n #endif\n #ifdef FOG\n   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\n      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\n      fogColor *= darken;\n   #endif\n   #ifdef HDR\n       const float modifier = 0.15;\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);\n    #else\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);\n    #endif\n #endif\n gl_FragColor = finalColor;\n#endif\n"+g.slice(x)))}{var b,E;ld.isSupported(n)&&(b=Ze(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,E=Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,!c&&(b||E||v)&&(g="uniform mat4 gltf_clippingPlanesMatrix; \n"+g),Ze(t._sphericalHarmonicCoefficients)?g="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+g:t._useDefaultSphericalHarmonics&&(g="#define DIFFUSE_IBL \n"+g),Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?g="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+g:t._useDefaultSpecularMaps&&(g="#define SPECULAR_IBL \n"+g))}Ze(t._luminanceAtZenith)&&(g="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+g);My(i,o,g,_,t,n,r)}(e,t,n,this)},uy.prototype.getFeature=fy;var yy=new on;function vy(e,t,n,r){gy(t,n);var i=Ze(t._batchTable),o=Mt.getSizeInBytes(Mt.FLOAT),a={czm_modelMatrixRow0:{index:0,vertexBuffer:t._vertexBuffer,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:t._vertexBuffer,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,normalize:!1,offsetInBytes:4*o,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:t._vertexBuffer,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,normalize:!1,offsetInBytes:8*o,strideInBytes:12*o,instanceDivisor:1}};i&&(a.a_batchId={index:0,vertexBuffer:t._batchIdBuffer,componentsPerAttribute:1,componentDatatype:Mt.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),i||(a.pickColor={index:0,vertexBuffer:t._pickIdBuffer,componentsPerAttribute:4,componentDatatype:Mt.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1});var s=t._model;e._precreatedAttributes=a;for(var u,l,c,h,f,p=s._nodeCommands,d=s._pickIds,m=s.allowPicking,_=s._runtime.meshesByName,g=s._rendererResources,y=g.vertexArrays,v=g.programs,x=g.renderStates,b=s._uniformMaps,E=s._runtime.nodes,T=s.gltf,S=T.accessors,C=T.meshes[t._meshId],w=C.primitives,A=w.length,I=0;I<A;++I){var P,O,L=w[I],N=S[L.indices],R=s._runtime.materialsById[L.material],D=R._program,M=s._decodedData[t._meshId+".primitive."+I],F=L.attributes.POSITION;Ze(F)&&(P=Hu.getAccessorMinMax(T,F),O=ko.fromCornerPoints(_t.fromArray(P.min),_t.fromArray(P.max))),wy(e,t,R._technique,s,n);var z,B,U,V,k,G,q,H,W,Y,X,j,K,Q,Z,J,$,ee=T.nodes[t._instances[0]._nodeId],te=E[t._instances[0]._nodeId];te.matrix=on.IDENTITY,Ze(ee.mesh)&&(z=y[t._meshId+".primitive."+I],U=Ze(M)?(B=M.numberOfIndices,0):Ze(N)?(B=N.count,N.byteOffset/wa.getSizeInBytes(N.componentType)):(B=S[L.attributes.POSITION].count,0),s._trianglesLength+=Cy(L,B),Q=(V=b[L.material]).uniformMap,Ze(V.jointMatrixUniformName)&&((k={})[V.jointMatrixUniformName]=Fy(te),Q=ne(Q,k)),Ze(V.morphWeightsUniformName)&&((G={})[V.morphWeightsUniformName]=zy(te),Q=ne(Q,G)),Q=xy(t,n,Q=ne(Q,{gltf_color:By(s),gltf_colorBlend:Uy(s),gltf_clippingPlanes:Vy(s),gltf_clippingPlanesEdgeStyle:ky(s),gltf_clippingPlanesMatrix:qy(s),gltf_iblFactor:Hy(s),gltf_lightColor:Wy(s),gltf_sphericalHarmonicCoefficients:Xy(s),gltf_specularMap:jy(s),gltf_specularMapSize:Ky(s),gltf_maxSpecularLOD:Qy(s),gltf_luminanceAtZenith:Yy(s)}),D,te),q={},s.extensionsUsed.WEB3D_quantized_attributes?(0,h=Zy(l=s,c=L),f=l._quantizedUniforms[h],q=Hu.createUniformsForQuantizedAttributes(l.gltf,c,f)):s._dequantizeInShader&&Ze(M)&&(u=M,q=Hu.createUniformsForDracoQuantizedAttributes(u.attributes)),Q=ne(Q,q),W=(H=x[L.material]).blending.enabled,Ze(Y=void 0)||(Y={primitive:s,id:s.id,node:te.publicNode,mesh:_[C.name],meshId:t._meshId}),X=Cd.castShadows(s._shadows),j=Cd.receiveShadows(s._shadows),m&&!Ze(s._uniformMapLoaded)&&(K=n.createPickId(Y),d.push(K),Q=ne(Q,{czm_pickColor:Jy(K.color)})),m&&(K=Ze(s._pickIdLoaded)&&Ze(s._uniformMapLoaded)?s._pickIdLoaded():"czm_pickColor"),Z=new Mn({boundingVolume:new ko,cull:s.cull,modelMatrix:new on,primitiveType:L.mode,vertexArray:z,count:B,offset:U,shaderProgram:v[D],castShadows:X,receiveShadows:j,uniformMap:Q,renderState:H,owner:Y,pass:W?yn.TRANSLUCENT:s.opaquePass,pickId:K,debugShowBoundingVolume:!1}),r||((J=Mn.shallowClone(Z)).boundingVolume=new ko,J.modelMatrix=new on),$={show:!0,boundingSphere:O,command:Z,command2D:J,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:D},t._instancingSupported=n.instancedArrays,Sy(t,t._instancingSupported,[$.command]),by(t),Ey(t),Ty(t),au.object(t._drawCommands,function(e,t){te.gltfInstaced=!0,$.command=e,te.commands.push($),p.push($)}))}}function xy(e,t,n,r,i){var o,a,s;(n=$e(n)).czm_instanced_modifiedModelView=(o=e,a=t,function(){return on.multiply(a.uniformState.view,o._rtcTransform,o._rtcModelView)}),n.czm_instanced_nodeTransform=(s=i,function(){return s.computedMatrix});var u=Ay(e,r);for(var l in u)u.hasOwnProperty(l)&&delete n[l];return Ze(e._batchTable)&&(n=e._batchTable.getUniformMapCallback()(n)),n}function by(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Cd.castShadows(e.shadows),n=Cd.receiveShadows(e.shadows),r=e._drawCommands,i=r.length,o=0;o<i;++o){var a=r[o];a.castShadows=t,a.receiveShadows=n}}}function Ey(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Dn.LINES:Dn.TRIANGLES,n=e._drawCommands,r=n.length,i=0;i<r;++i)n[i].primitiveType=t}}function Ty(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e._drawCommands,n=t.length,r=0;r<n;++r)t[r].debugShowBoundingVolume=e.debugShowBoundingVolume}}function Sy(e,t,n){t?function(e,t){for(var n=t.length,r=e.length,i=e._boundingSphere,o=e._cull,a=0;a<n;++a){var s=Mn.shallowClone(t[a]);s.instanceCount=r,s.boundingVolume=i,s.cull=o,Ze(e._batchTable)?s.pickId=e._batchTable.getPickId():s.pickId="v_pickColor",e._drawCommands.push(s)}}(e,n):(function(e,t){for(var n=e._instances,r=t.length,i=e.length,o=Ze(e._batchTable),a=e._cull,s=0;s<r;++s)for(var u=0;u<i;++u){var l,c=Mn.shallowClone(t[s]);c.modelMatrix=new on,c.boundingVolume=new ko,c.cull=a,c.uniformMap=$e(c.uniformMap),o?c.uniformMap.a_batchId=createBatchIdFunction(n[u]._instanceId):(l=e._pickIds[u],c.uniformMap.czm_pickColor=Jy(l.color)),e._drawCommands.push(c)}}(e,n),function(e){for(var t=e._modelCommands,n=t.length,r=e.length,i=e._rtcTransform,o=e._center,a=0;a<n;++a)for(var s=t[a],u=0;u<r;++u){var l=a*r+u,c=e._drawCommands[l],h=on.clone(e._instances[u]._modelMatrix,scratchMatrix);h[12]-=o.x,h[13]-=o.y,h[14]-=o.z,h=on.multiply(i,h,scratchMatrix);var f=s.modelMatrix,p=c.modelMatrix;on.multiply(h,f,p);var d=s.boundingVolume,m=c.boundingVolume;ko.transform(d,h,m)}}(e))}function Cy(e,t){switch(e.mode){case Dn.TRIANGLES:return t/3;case Dn.TRIANGLE_STRIP:case Dn.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function wy(e,t,n,r,i){var o,a,s,u,h,f,p,d,m,_,g,y,l,c=r._quantizedVertexShaders,v=Ze(r._toClipCoordinatesGLSL)?r._toClipCoordinatesGLSL:r._toClipCoordinatesGLSL={},x=r._rendererResources.sourceShaders,b=r._sourceTechniques,E=r._sourcePrograms;b.hasOwnProperty(n)&&(s=x[(a=E[o=b[n].program]).vertexShader],Hu.checkSupportedGlExtensions(a.glExtensions,i),(r.extensionsUsed.WEB3D_quantized_attributes||r._dequantizeInShader)&&(Ze(u=c[o])||(u=Ry(s,o,r),c[o]=u),s=u),s=function(e,t,n,r,i){var o,a,s,u,l=n,c=r,h=Ay(i,t,c),f=Ze(e._batchTable),p=Xr.replaceMain(l,"czm_instancing_main"),d="",m="";for(var _ in h){var g,y;h.hasOwnProperty(_)&&("MODELVIEW"===(g=h[_])||"CESIUM_RTC_MODELVIEW"===g?o="czm_instanced_modelView":"MODELVIEWPROJECTION"===g?(o="czm_instanced_modelViewProjection",d+="mat4 czm_instanced_modelViewProjection;\n",m+="czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;\n"):"MODELVIEWINVERSETRANSPOSE"===g&&(o="czm_instanced_modelViewInverseTranspose",d+="mat3 czm_instanced_modelViewInverseTranspose;\n",m+="czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);\n"),y=new RegExp("uniform.*"+_+".*"),p=p.replace(y,""),y=new RegExp(_+"\\b","g"),p=p.replace(y,o))}u=f?s=a="":(a="",s="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n","    v_pickColor = pickColor;\n");var v="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n"+d+"mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n"+a+s+p+"void main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform  ;\n"+m+"    czm_instancing_main();\n"+u+"}\n";{var x,b;f&&(x=e._model.gltf,b=Hu.getDiffuseAttributeOrUniform(x,c),v=e._batchTable.getVertexShaderCallback(!0,"a_batchId",b)(v))}return n=v}(t,n,s,o,e),v[o]=Hu.toClipCoordinatesGLSL(r.gltf,s),function(e,t,n,r){var i=e.programId,o=e.techniqueId,a=t._sourcePrograms[i],s=t._rendererResources.sourceShaders;if(r._model=t,Ze(a.name)&&Ze(t.instancedPrograms[a.name])){if(t.instancedPrograms[a.name].attributeLocations===t._rendererResources.programs[i]._attributeLocations)return;var u=t.instancedPrograms[a.name];return t._rendererResources.programs[i]=ic.fromCache({context:n,vertexShaderSource:u.vertexShaderSource,fragmentShaderSource:u.fragmentShaderSource,attributeLocations:u.attributeLocations})}var l=s[a.vertexShader],c=s[a.fragmentShader];c+="uniform vec4 u_rollerRegion;";var h=t._quantizedVertexShaders,f=t._toClipCoordinatesGLSL[i];{var p;(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(Ze(p=h[i])||(p=Ry(l,i,t),h[i]=p),l=p)}var d=Py(l,i,o,r),m=Iy(c,i,r);et.isInternetExplorer()||(d=Hu.modifyVertexShaderForLogDepth(d,f),m=t.rollerRegion.equals(Dy)?Hu.modifyFragmentShaderForLogDepth(m):Hu.modifyFragmentShaderForLogDepthAddRoller(m));Ze(t._uniformMapLoaded)||(m="uniform vec4 czm_pickColor;\n"+m);{var _;Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((_=(d="\n varying vec4 v_worldPosition; \n"+d).lastIndexOf("}"))&&(d=d.slice(0,_)+"vec4 eyePostion = czm_inverseProjection * gl_Position; \n v_worldPosition = czm_inverseView3D * eyePostion; \n"+d.slice(_)),m="\nvarying vec4 v_worldPosition; \n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) \nuniform float u_minimumBrightness ;\n#endif \nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n} \n"+wd+"\n"+m,t._scene.fog.enabled&&(m="#define FOG \n\n"+m))}var g=0<t._imageBasedLightingFactor.x||0<t._imageBasedLightingFactor.y;g&&(m="#define USE_IBL_LIGHTING \n\n"+m);Ze(t._lightColor)&&(m="#define USE_CUSTOM_LIGHT_COLOR \n\n"+m);"2.0"===t._sourceVersion&&!t._sourceKHRTechniquesWebGL||(m=Xr.replaceMain(m,"non_gamma_corrected_main"),m+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n");{var y;Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((y=m.lastIndexOf("}"))&&(m=m.slice(0,y)+"\n#if defined(FOG)\n  vec4 finalColor =  gl_FragColor; \n  float vDistance =  length((czm_view3D * v_worldPosition).xyz); \n  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(v_worldPosition.x, v_worldPosition.y, v_worldPosition.z), false, vec3(0.0));\n  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);\n #ifndef HDR\n  const float fExposure = 4.0;\n  fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n #endif\n #ifdef FOG\n   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\n      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\n      fogColor *= darken;\n   #endif\n   #ifdef HDR\n       const float modifier = 0.15;\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);\n    #else\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);\n    #endif\n #endif\n gl_FragColor = finalColor;\n#endif\n"+m.slice(y)))}{var v,x;ld.isSupported(n)&&(v=Ze(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,x=Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,(v||x||g)&&(m="uniform mat4 gltf_clippingPlanesMatrix; \n"+m),Ze(t._sphericalHarmonicCoefficients)?m="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+m:t._useDefaultSphericalHarmonics&&(m="#define DIFFUSE_IBL \n"+m),Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?m="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+m:t._useDefaultSpecularMaps&&(m="#define SPECULAR_IBL \n"+m))}Ze(t._luminanceAtZenith)&&(m="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+m);My(i,o,m,d,t,n,r)}({programId:o,techniqueId:n},r,i,e),h=r,f=t._meshId,p=i,d=e,m=h._rendererResources.buffers,_=h._rendererResources.vertexArrays,g=h.gltf,y=g.accessors,l=g.meshes[f],au.meshPrimitive(l,function(e,t){var a,n,r,s=[],u=function(e,t,n){var r,i,o=e._sourceTechniques,a={},s=e._runtime.materialsById[t.material];if(!Ze(s))return a;var u=o[s._technique];if(!Ze(u))return a;var l=u.attributes,c=e._rendererResources.programs[u.program],h=c.vertexAttributes,f=c._attributeLocations;for(r in h){var p;!h.hasOwnProperty(r)||Ze(p=l[r])&&(i=f[r],a[p.semantic]=i)}var d=n._precreatedAttributes;if(Ze(d))for(r in d)d.hasOwnProperty(r)&&(i=f[r],a[r]=i);return a}(h,e,d),l=h._decodedData[f+".primitive."+t];au.meshPrimitiveAttribute(e,function(e,t){if(Ze(a=u[t])){if(Ze(l)){var n=l.attributes;if(n.hasOwnProperty(t)){var r=n[t];return void s.push({index:a,vertexBuffer:m[r.bufferView],componentsPerAttribute:r.componentsPerAttribute,componentDatatype:r.componentDatatype,normalize:r.normalized,offsetInBytes:r.byteOffset,strideInBytes:r.byteStride})}}var i=y[e],o=Ze(i.normalized)&&i.normalized;s.push({index:a,vertexBuffer:m[i.bufferView],componentsPerAttribute:su(i.type),componentDatatype:i.componentType,normalize:o,offsetInBytes:i.byteOffset,strideInBytes:uu(g,i)})}});var i,o,c=d._precreatedAttributes;if(Ze(c))for(r in c)c.hasOwnProperty(r)&&Ze(a=u[r])&&((n=c[r]).index=a,s.push(n));Ze(e.indices)&&(o=y[e.indices].bufferView,Ze(l)&&(o=l.bufferView),i=m[o]),_[f+".primitive."+t]=new Ac({context:p,attributes:s,indexBuffer:i})}))}function Ay(e,t,n){if(Ze(e._instancedUniformsByProgram)&&e._instancedUniformsByProgram.hasOwnProperty(n))return e._instancedUniformsByProgram[n];var r={};e._instancedUniformsByProgram=r;var i,o,a,s,u,l,c,h=e._model._sourceTechniques;return h.hasOwnProperty(t)&&(Ze(r[o=(i=h[t]).program])||(a={},r[o]=a,au.techniqueUniform(i,(s=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],u=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],l=n,c=a,function(e,t){var n=e.semantic;if(Ze(n)&&-1<s.indexOf(n)){if(!(-1<u.indexOf(n)))throw new de('Shader program cannot be optimized for instancing. Uniform "'+t+'" in program "'+l+'" uses unsupported semantic "'+n+'"');c[t]=n}})))),r[n]}function Iy(e,t,n){var r;return e=Ze(n._usesBatchTable)?(r=n._model.gltf,function(e,t,n){n=Ly(n,t,!0),0<Nn.maximumVertexTextureImageUnits?n+="uniform sampler2D tile_pickTexture; \nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_color(tile_featureColor); \n}":(e&&(n+="uniform bool tile_translucentCommand; \n"),n+="uniform sampler2D tile_pickTexture; \nuniform sampler2D tile_batchTexture; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n",e&&(n+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            discard; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            discard; \n        } \n    } \n"),n+="    tile_color(featureProperties); \n} \n");return n}(!0,Hu.getDiffuseAttributeOrUniform(r,t),e)):"varying vec4 v_pickColor;\n"+e}function Py(e,t,n,r){var i,o,a,s=Ay(r,n,t),u=r._usesBatchTable,l=Xr.replaceMain(e,"czm_instancing_main"),c="",h="";for(var f in s){s.hasOwnProperty(f)&&("MODELVIEW"===(i=s[f])||"CESIUM_RTC_MODELVIEW"===i?o="czm_instanced_modelView":"MODELVIEWPROJECTION"===i?(o="czm_instanced_modelViewProjection",c+="mat4 czm_instanced_modelViewProjection;\n",h+="czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;\n"):"MODELVIEWINVERSETRANSPOSE"===i&&(o="czm_instanced_modelViewInverseTranspose",c+="mat3 czm_instanced_modelViewInverseTranspose;\n",h+="czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);\n"),a=new RegExp("uniform.*"+f+".*"),l=l.replace(a,""),a=new RegExp(f+"\\b","g"),l=l.replace(a,o))}var p,d,m,_=u?d=p="":(p="",d="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n","    v_pickColor = pickColor;\n"),g="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n"+c+"mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n"+p+d+l+"void main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model *  czm_instanced_nodeTransform      ;\n"+h+"    czm_instancing_main();\n"+_+"}\n";return u&&(m=r._model.gltf,g=function(e,t,n,r){var i,o=Ly(r,n,!1),a=!1;-1!=o.indexOf("gl_Position = u_modelViewProj * vec4(a_position,1.0);")?(a=!0,o=(o=o.replace("attribute vec3 a_position;","attribute vec3 a_position;\nvec4 trans;\nvec4 scale;\nvec4 rotation;")).replace("gl_Position = u_modelViewProj * vec4(a_position,1.0);","gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(a_position,1.0));"),o=Oy+o):-1!=o.indexOf("vec3 gltf_a_dec_position")?(a=!0,-1!=(o=o.replace("vec3 gltf_a_dec_position;","vec3 gltf_a_dec_position;\nvec4 trans;\nvec4 scale;\nvec4 rotation;")).indexOf("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0)")?o=o.replace("gl_Position = u_modelViewProj * vec4(gltf_a_dec_position,1.0);"," gl_Position = u_modelViewProj * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0));"):-1!=o.indexOf("gl_Position = czm_instanced_modelViewProjection * vec4(gltf_a_dec_position,1.0)")?o=o.replace("czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model *  czm_instanced_nodeTransform"," czm_instanced_modelView = czm_instanced_modifiedModelView * ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz)* czm_instanced_model * czm_instanced_nodeTransform"):-1!=o.indexOf("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0)")&&(o=o.replace("xlat_temp_input.position = vec4(gltf_a_dec_position,1.0);","xlat_temp_input.position = ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * vec4(gltf_a_dec_position,1.0);")),o=Oy+o):-1!=o.indexOf("position = u_modelViewMatrix * position")&&(a=!0,o=(o=o.replace("attribute vec3 a_position;","attribute vec3 a_position;\nvec4 trans;\nvec4 scale;\nvec4 rotation;")).replace("position = u_modelViewMatrix * position;","position = u_modelViewMatrix * (ev_fromTranslationQuaternionRotationScale(trans.xyz,rotation,scale.xyz) * position);"),o=Oy+o);0<Nn.maximumVertexTextureImageUnits?(i="",e&&(i+="uniform bool tile_translucentCommand; \n"),i+="uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_transTexture; \nuniform sampler2D tile_scaleTexture; \nuniform sampler2D tile_rotationTexture; \nvarying vec4 tile_featureColor; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec2 st = computeSt("+t+"); \n    vec4 featureProperties = texture2D(tile_batchTexture, st); \n",a&&(i+="    trans = texture2D(tile_transTexture, vec2(st.x,0.0)); \n",i+="    scale = texture2D(tile_scaleTexture, vec2(st.x,0.0)); \n",i+="    rotation = texture2D(tile_rotationTexture, vec2(st.x,0.0)); \n"),i+="    tile_color(featureProperties); \n    float show = ceil(featureProperties.a); \n    gl_Position *= show; \n",e&&(i+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n"),i+="    tile_featureColor = featureProperties; \n    tile_featureSt = st; \n}"):i="varying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_color(vec4(1.0)); \n    tile_featureSt = computeSt("+t+"); \n}";return o+"\nuniform vec4 tile_textureStep; \nuniform vec2 tile_textureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    float stepY = tile_textureStep.z; \n    float centerY = tile_textureStep.w; \n    float xId = mod(batchId, tile_textureDimensions.x); \n    float yId = floor(batchId / tile_textureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n"+i}(!0,"a_batchId",Hu.getDiffuseAttributeOrUniform(m,t),g)),g}var Oy="mat4 ev_fromTranslationQuaternionRotationScale(vec3 translation, vec4 quaternion, vec3 scale)\n{\n      float x2 = quaternion.x * quaternion.x;\n      float xy = quaternion.x * quaternion.y;\n      float xz = quaternion.x * quaternion.z;\n      float xw = quaternion.x * quaternion.w;\n      float y2 = quaternion.y * quaternion.y;\n      float yz = quaternion.y * quaternion.z;\n      float yw = quaternion.y * quaternion.w;\n      float z2 = quaternion.z * quaternion.z;\n      float zw = quaternion.z * quaternion.w;\n      float w2 = quaternion.w * quaternion.w;\n\n      float m00 = x2 - y2 - z2 + w2;\n      float m01 = 2.0 * (xy - zw);\n      float m02 = 2.0 * (xz + yw);\n\n      float m10 = 2.0 * (xy + zw);\n      float m11 = -x2 + y2 - z2 + w2;\n      float m12 = 2.0 * (yz - xw);\n\n      float m20 = 2.0 * (xz - yw);\n      float m21 = 2.0 * (yz + xw);\n      float m22 = -x2 - y2 + z2 + w2;\n      return mat4(\n        m00 * scale.x , m01* scale.x, m02* scale.x, 0.0,\n        m10 * scale.y, m11 * scale.y, m12 * scale.y, 0.0,\n        m20 * scale.z, m21 * scale.z, m22 * scale.z, 0.0,\n        translation.x, translation.y, translation.z, 1.0);\n}\n";function Ly(e,t,n){if(!Ze(t))return Ny(e,n);var r=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+t+";"),i=e.match(r);if(!Ze(i))return Ny(e,n);var o=i[0],a=i[2];e=(e=Xr.replaceMain(e,"tile_main")).replace(o,"");var s,u,l;return"vec3"===a||"vec4"===a?(u="vec3"===a?"vec4("+t+", 1.0)":t,l="vec3"===a?"tile_diffuse.xyz":"tile_diffuse",r=new RegExp(t,"g"),e=e.replace(r,l),s="    vec4 source = "+u+"; \n    tile_diffuse = tile_diffuse_final(source, tile_featureColor); \n    tile_main(); \n"):"sampler2D"===a&&(e=function(e,t){var n,r="texture2D("+t,i=0,o=e.indexOf(r,i);for(;-1<o;){for(var a=0,s=o;s<e.length;++s){var u=e.charAt(s);if("("===u)++a;else if(")"===u&&0===--a){n=s+1;break}}var l="tile_diffuse_final("+e.slice(o,n)+", tile_diffuse)";e=e.slice(0,o)+l+e.slice(n),i=o+l.length,o=e.indexOf(r,i)}return e}(e,t),s="    tile_diffuse = tile_featureColor; \n    tile_main(); \n"),e="uniform float tile_colorBlend; \nvec4 tile_diffuse = vec4(1.0); \nbool isWhite(vec3 color) \n{ \n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); \n} \nvec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) \n{ \n    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); \n    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; \n    return vec4(diffuse.rgb, sourceDiffuse.a); \n} \n"+o+"\n"+e+"\nvoid tile_color(vec4 tile_featureColor) \n{ \n"+s,n&&(e+="    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n if(!all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ \n\tif(highlight== 0.0){\n\t\tgl_FragColor.rgb = mix(tile_featureColor.rgb, gl_FragColor.rgb, 0.4);\n\t}else if(highlight== 1.0){\n\t\tgl_FragColor.rgb = tile_featureColor.rgb;\n\t}else{\n\t\tgl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight);\n\t}\n }"),e+="} \n"}function Ny(e,t){return e=Xr.replaceMain(e,"tile_main"),t?e+"uniform float tile_colorBlend; \nvoid tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n     if(highlight==1.0 && !all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ \n       gl_FragColor.rgb = tile_featureColor.rgb; \n      } \n} \n":e+"void tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n} \n"}function Ry(e,t,n){var r,i,o,a=n._programPrimitives[t];if(!Ze(a))return e;for(i in a)if(a.hasOwnProperty(i)&&Zy(n,r=a[i])===t)break;if(n._programPrimitives[t]=void 0,n.extensionsUsed.WEB3D_quantized_attributes)o=Hu.modifyShaderForQuantizedAttributes(n.gltf,r,e),n._quantizedUniforms[t]=o.uniforms;else{var s=n._decodedData[i];if(!Ze(s))return e;o=Hu.modifyShaderForDracoQuantizedAttributes(n.gltf,r,e,s.attributes)}return o.shader}var Dy=new qt(0,0,1,1);function My(e,t,n,r,i,o,a){var s=i._sourceTechniques[t],u=i._sourcePrograms[e],l=Hu.createAttributeLocations(s,a._precreatedAttributes);i._rendererResources.programs[e]=ic.fromCache({context:o,vertexShaderSource:r,fragmentShaderSource:n,attributeLocations:l}),i.instancedPrograms[u.name]={vertexShaderSource:r,fragmentShaderSource:n,attributeLocations:l}}function Fy(e){return function(){return e.computedJointMatrices}}function zy(e){return function(){return e.weights}}function By(e){return function(){return e.color}}function Uy(e){return function(){return gp.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function Vy(t){return function(){var e=t.clippingPlanes;return Ze(e)&&e.enabled?e.texture:t._defaultTexture}}function ky(n){return function(){var e=n.clippingPlanes;if(!Ze(e))return It.WHITE.withAlpha(0);var t=It.clone(e.edgeColor);return t.alpha=e.edgeWidth,t}}var Gy=new on;function qy(n){return function(){var e=n.clippingPlanes;if(!Ze(e)&&!Ze(n._sphericalHarmonicCoefficients)&&!Ze(n._specularEnvironmentMaps))return on.IDENTITY;var t=Ze(e)?e.modelMatrix:on.IDENTITY;return on.multiply(n._clippingPlaneModelViewMatrix,t,Gy)}}function Hy(e){return function(){return e._imageBasedLightingFactor}}function Wy(e){return function(){return e._lightColor}}function Yy(e){return function(){return e.luminanceAtZenith}}function Xy(e){return function(){return e._sphericalHarmonicCoefficients}}function jy(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function Ky(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function Qy(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function Zy(e,t){var n=e._runtime.materialsById[t.material];if(Ze(n))return n._program}function Jy(e){return function(){return e}}var $y=new _t,ev=Hu.ModelState,tv=pt.EPSILON16;function nv(e,t){e._cachedGltf=t}function rv(e){this._gltf=e.gltf,this.ready=e.ready,this.modelsToLoad=[],this.count=0}Object.defineProperties(rv.prototype,{gltf:{set:function(e){this._gltf=e},get:function(){return this._gltf}}}),rv.prototype.makeReady=function(e){this.gltf=e;for(var t=this.modelsToLoad,n=t.length,r=0;r<n;++r){var i=t[r];i.isDestroyed()||nv(i,this)}this.modelsToLoad=void 0,this.ready=!0};var iv={},ov={};function av(e){var t,n,r=(e=Je(e,Je.EMPTY_OBJECT)).cacheKey;this._cacheKey=r,this._cachedGltf=void 0,this._releaseGltfJson=Je(e.releaseGltfJson,!1),Ze(r)&&Ze(iv[r])&&iv[r].ready?++(n=iv[r]).count:Ze(t=e.gltf)&&(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(n=t instanceof Uint8Array?new rv({gltf:_u(t),ready:!0}):new rv({gltf:e.gltf,ready:!0})).count=1,Ze(r)&&(iv[r]=n)),nv(this,n);var i=Je(e.basePath,"");this._resource=rt.createIfNeeded(i);var o=e.credit;"string"==typeof o&&(o=new Cf(o)),this._credit=o,this._resourceCredits=[],this.show=Je(e.show,!0),this.silhouetteColor=Je(e.silhouetteColor,It.RED),this._silhouetteColor=new It,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=Je(e.silhouetteSize,0),this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this._modelMatrix=on.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=Je(e.scale,1),this._scale=this.scale,this.minimumPixelSize=Je(e.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=e.maximumScale,this._maximumScale=this.maximumScale,this.id=e.id,this._id=e.id,this.heightReference=Je(e.heightReference,Ap.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;var a=e.scene;Ze(this._scene=a)&&Ze(a.terrainProviderChanged)&&(this._terrainProviderChangedCallback=a.terrainProviderChanged.addEventListener(function(){this._heightChanged=!0},this)),this._pickObject=e.pickObject,this._allowPicking=Je(e.allowPicking,!0),this._ready=!1,this._readyPromise=D.defer(),this.activeAnimations=new Hp(this),this.clampAnimations=Je(e.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=Je(e.incrementallyLoadTextures,!0),this._asynchronous=Je(e.asynchronous,!0),this.shadows=Je(e.shadows,Cd.ENABLED),this._shadows=this.shadows,this.color=It.clone(Je(e.color,It.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=Je(e.colorBlendMode,gp.HIGHLIGHT),this.colorBlendAmount=Je(e.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._clippingPlanesState=0,this.clippingPlanesOriginMatrix=void 0,this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Je(e.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=e.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=e.addBatchIdToGeneratedShaders,this._precreatedAttributes=e.precreatedAttributes,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=Je(e.ignoreCommands,!1),this._requestType=e.requestType,this._upAxis=Je(e.upAxis,xn.Y),this._gltfForwardAxis=xn.Z,this._forwardAxis=e.forwardAxis,this.cull=Je(e.cull,!0),this.opaquePass=Je(e.opaquePass,yn.OPAQUE),this._computedModelMatrix=new on,this._clippingPlaneModelViewMatrix=on.clone(on.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new ko,this._state=ev.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=Je(e.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._imageBasedLightingFactor=new En(1,1),En.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this._lightColor=_t.clone(e.lightColor),this._luminanceAtZenith=void 0,this.luminanceAtZenith=Je(e.luminanceAtZenith,.2),this._sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._shouldUpdateSpecularMapAtlas=!0,this._specularEnvironmentMapAtlas=void 0,this._useDefaultSphericalHarmonics=!1,this._useDefaultSpecularMaps=!1,this._shouldRegenerateShaders=!1,this._enableFog=!1,this.meshPrimitives=[],Ze(e.sharedResources)?(this.childrenTilesetUri=e.sharedResources.ktxs.name,this.ktxs=e.sharedResources.ktxs,this.instancedPrograms=e.sharedResources.instancedPrograms.shadredData):(this.childrenTilesetUri="",this.ktxs={},this.instancedPrograms={}),this.content=Je(e.content,void 0),this.ev_E3MInternalInstance=Ze(this.content)?new uy({model:this}):void 0,this.modelSpecular=Je(e.specular,.5),this.rollerRegion=Je(e.rollerRegion,new qt(0,0,1,1))}function sv(e){return e.stencilBuffer}function uv(e){return!It.equals(e.color,It.WHITE)||e.colorBlendMode!==gp.HIGHLIGHT}function lv(e){var t=e._clippingPlanes;return Ze(t)&&t.enabled&&0!==t.length}function cv(e,t,n){return e._runtime[t][n]}Object.defineProperties(av.prototype,{gltf:{get:function(){return Ze(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var e=this.modelMatrix;this.heightReference!==Ap.NONE&&this._clampedModelMatrix&&(e=this._clampedModelMatrix);var t=on.getScale(e,$y),n=Ze(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;_t.multiplyByScalar(t,n,t);var r=this._scaledBoundingSphere;return r.center=_t.multiplyComponents(this._boundingSphere.center,t,r.center),r.radius=_t.maximumComponent(t)*this._initialRadius,Ze(this._rtcCenter)&&_t.add(this._rtcCenter,r.center,r.center),r}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return Ze(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=wf.clone(e,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return Ze(this._extensionsUsed)||(this._extensionsUsed=Hu.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Ze(this._extensionsRequired)||(this._extensionsRequired=Hu.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return Ze(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&rp.setOwner(e,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){var t=this._imageBasedLightingFactor;e===t||En.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||0<this._imageBasedLightingFactor.x&&0===e.x||0===this._imageBasedLightingFactor.x&&0<e.x,this._shouldRegenerateShaders=this._shouldRegenerateShaders||0<this._imageBasedLightingFactor.y&&0===e.y||0===this._imageBasedLightingFactor.y&&0<e.y,En.clone(e,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(e){var t=this._lightColor;e===t||_t.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Ze(t)&&!Ze(e)||Ze(e)&&!Ze(t),this._lightColor=_t.clone(e,t))}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){var t=this._luminanceAtZenith;e!==t&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Ze(t)&&!Ze(e)||Ze(e)&&!Ze(t),this._luminanceAtZenith=e)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){e!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=e,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||e!==this._specularEnvironmentMaps,this._specularEnvironmentMaps=e}},credit:{get:function(){return this._credit}}}),av.silhouetteSupported=function(e){return sv(e.context)},av.fromGltf=function(e){var t=e.url;e=$e(e);var u=rt.createIfNeeded(t),n=Je(e.basePath,u.clone()),r=rt.createIfNeeded(n),i=Je(e.cacheKey,ov[w(u.url)]);Ze(i)||(i=Jr(),ov[w(u.url)]=i),Ze(e.basePath)&&!Ze(e.cacheKey)&&(i+=r.url),e.cacheKey=i,e.basePath=r;var l=new av(e),c=iv[i];return Ze(c)?c.ready||(++c.count,c.modelsToLoad.push(l)):((c=new rv({ready:!1})).count=1,c.modelsToLoad.push(l),nv(l,c),iv[i]=c,Ze(u.headers.Accept)||(u.headers.Accept="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01"),u.fetchArrayBuffer().then(function(e){var t,n,r=new Uint8Array(e);"glTF"===du(r)?(t=_u(r),c.makeReady(t)):(n=kt(r),c.makeReady(JSON.parse(n)));var i=l._resourceCredits,o=u.credits;if(Ze(o))for(var a=o.length,s=0;s<a;s++)i.push(o[s])}).otherwise(Hu.getFailedLoadFunction(l,"model",u.url))),l},av._gltfCache=iv,av.prototype.getNode=function(e){var t=cv(this,"nodesByName",e);return Ze(t)?t.publicNode:void 0},av.prototype.getMesh=function(e){return cv(this,"meshesByName",e)},av.prototype.getMaterial=function(e){return cv(this,"materialsByName",e)},av.prototype.setArticulationStage=function(e,t){var n=cv(this,"stagesByKey",e),r=cv(this,"articulationsByStageKey",e);Ze(n)&&Ze(r)&&(t=pt.clamp(t,n.minimumValue,n.maximumValue),pt.equalsEpsilon(n.currentValue,t,tv)||(n.currentValue=t,r.isDirty=!0))};var hv=new _t,fv=new jt;function pv(e,t){var n,r=e.currentValue,i=hv;switch(e.type){case"xRotate":n=jt.fromRotationX(pt.toRadians(r),fv),on.multiplyByMatrix3(t,n,t);break;case"yRotate":n=jt.fromRotationY(pt.toRadians(r),fv),on.multiplyByMatrix3(t,n,t);break;case"zRotate":n=jt.fromRotationZ(pt.toRadians(r),fv),on.multiplyByMatrix3(t,n,t);break;case"xTranslate":i.x=r,i.y=0,i.z=0,on.multiplyByTranslation(t,i,t);break;case"yTranslate":i.x=0,i.y=r,i.z=0,on.multiplyByTranslation(t,i,t);break;case"zTranslate":i.x=0,i.y=0,i.z=r,on.multiplyByTranslation(t,i,t);break;case"xScale":i.x=r,i.y=1,i.z=1,on.multiplyByScale(t,i,t);break;case"yScale":i.x=1,i.y=r,i.z=1,on.multiplyByScale(t,i,t);break;case"zScale":i.x=1,i.y=1,i.z=r,on.multiplyByScale(t,i,t);break;case"uniformScale":on.multiplyByUniformScale(t,r,t)}return t}var dv=new on;function mv(r,i){return function(e){var t=r._loadResources,n=new Uint8Array(e);--t.pendingBufferLoads,r.gltf.buffers[i].extras._pipeline.source=n}}function _v(r,i,o,a){return function(e){var t=r.gltfShader,n=r._loadResources;n.shaders[o]={source:e,type:i,bufferView:void 0},--n.pendingShaderLoads,r._rendererResources.sourceShaders[o]=e,Ze(t)&&(!Ze(t[a])||Ze(t[a])&&"function"==typeof t[a].then)&&(t[a]=e)}}function gv(m){var e=m.gltf,_=e.buffers,g=e.bufferViews,y=m._rendererResources.sourceShaders;au.shader(e,function(e,t){var n,r,i,o,a,s,u,l,c,h,f,p,d;Ze(e.bufferView)?(n=e.bufferView,i=(r=g[n]).buffer,s=kt(_[i].extras._pipeline.source,r.byteOffset,r.byteLength),y[t]=s):Ze(e.extras._pipeline.source)?y[t]=e.extras._pipeline.source:(++m._loadResources.pendingShaderLoads,o=m._resource._url.substring(0,m._resource._url.lastIndexOf("/")+1)+e.uri,Ze(a=m.gltfShader)&&Ze(a[o])?"function"==typeof(s=a[o]).then?s.then(_v(m,e.type,t,o)).otherwise(Hu.getFailedLoadFunction(m,"shader",o)):(c=m,h=e.type,f=t,p=s,d=c._loadResources,p=p.replace("material.shininess = 1.0;","material.shininess = 2.0;"),d.shaders[f]={source:p,type:h,bufferView:void 0},--d.pendingShaderLoads,c._rendererResources.sourceShaders[f]=p):(l=(u=m._resource.getDerivedResource({url:e.uri,queryParameters:m._resource.queryParameters})).fetchText(),Ze(m.gltfShader)&&(m.gltfShader[o]=l),l.then(_v(m,e.type,t,u._url)).otherwise(Hu.getFailedLoadFunction(m,"shader",u.url))))})}function yv(n,r,i){return function(e){Ze(i)&&Ze(n.ktxs)&&(Ze(n.ktxs[i])&&"function"==typeof n.ktxs[i].then||!Ze(n.ktxs[i]))&&(n.ktxs[i]=e);var t=n._loadResources;--t.pendingTextureLoads,t.texturesToCreate.enqueue({id:r,image:e,bufferView:e.bufferView,width:e.width,height:e.height,internalFormat:e.internalFormat})}}av.prototype.applyArticulations=function(){var e=this._runtime.articulationsByName;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(n.isDirty){n.isDirty=!1;for(var r=n.nodes.length,i=0;i<r;++i){for(var o=n.nodes[i],a=on.clone(o.originalMatrix,dv),s=n.stages.length,u=0;u<s;++u)a=pv(n.stages[u],a);o.matrix=a}}}};var vv=/(^data:image\/ktx)|(data:image\/ktx)|(\.ktx$)|(\.ktx.gz$)/i,xv=/(^data:image\/crn)|(\.crn$)/i,bv=/(^data:image\/pkm)|(\.pkm$)|(\.pkm.gz$)/i;function Ev(y,v,x){var b,e=y.gltf,E=e.images;au.texture(e,function(e,t){var n=e.source;Ze(e.extensions)&&Ze(e.extensions.EXT_texture_webp)&&x&&(n=e.extensions.EXT_texture_webp.source);var r,i,o,a,s,u,l,c,h,f,p,d=E[n],m=d.extras,_=d.bufferView,g=d.mimeType;b=d.uri,Ze(m)&&Ze(m.compressedImage3DTiles)&&(r=m.compressedImage3DTiles.crunch,i=m.compressedImage3DTiles.s3tc,o=m.compressedImage3DTiles.pvrtc1,a=m.compressedImage3DTiles.etc1,v.s3tc&&Ze(r)?(g=r.mimeType,Ze(r.bufferView)?_=r.bufferView:b=r.uri):v.s3tc&&Ze(i)?(g=i.mimeType,Ze(i.bufferView)?_=i.bufferView:b=i.uri):v.pvrtc&&Ze(o)?(g=o.mimeType,Ze(o.bufferView)?_=o.bufferView:b=o.uri):v.etc1&&Ze(a)&&(g=a.mimeType,Ze(a.bufferView)?_=a.bufferView:b=a.uri)),Ze(_)?y._loadResources.texturesToCreateFromBufferView.enqueue({id:t,image:void 0,bufferView:_,mimeType:g}):(++y._loadResources.pendingTextureLoads,s=y._resource.getDerivedResource({url:b}),Ze(u=y.ktxs)&&-1===b.indexOf("data:image/")?Ze(l=u[b])?"function"==typeof l.then?l.then(yv(y,t,b)).otherwise(Hu.getFailedLoadFunction(y,"image",s.url)):(Ze(l.arrayBufferView)&&delete l.arrayBufferView,h=t,f=l,--(p=y._loadResources).pendingTextureLoads,p.texturesToCreate.enqueue({id:h,image:f,bufferView:f.bufferView,width:f.width,height:f.height,internalFormat:f.internalFormat})):(c=vv.test(b)?Uf(s):xv.test(b)?zf(s):bv.test(b)?Ad(s):s.fetchImage(),(u[b]=c).then(yv(y,t,b)).otherwise(Hu.getFailedLoadFunction(y,"image",s.url))):(c=vv.test(b)?Uf(s):xv.test(b)?zf(s):s.fetchImage()).then(yv(y,t)).otherwise(Hu.getFailedLoadFunction(y,"image",s.url)))})}var Tv=new on;function Sv(){this.id=void 0,this.model=void 0,this.context=void 0}function Cv(e,t,n){var r=t._loadResources,i=t.gltf.bufferViews[e];Ze(i)||(i=r.createdBufferViews[e]);var o=Al.createVertexBuffer({context:n,typedArray:r.getBuffer(i),usage:wl.STATIC_DRAW});o.vertexArrayDestroyable=!1,t._rendererResources.buffers[e]=o,t._geometryByteLength+=o.sizeInBytes}Sv.prototype.set=function(e,t,n){this.id=e,this.model=t,this.context=n},Sv.prototype.execute=function(){Cv(this.id,this.model,this.context)};function wv(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0}function Av(e,t,n,r){var i=n._loadResources,o=n.gltf.bufferViews[e];Ze(o)||(o=i.createdBufferViews[e]);var a=Al.createIndexBuffer({context:r,typedArray:i.getBuffer(o),usage:wl.STATIC_DRAW,indexDatatype:t});a.vertexArrayDestroyable=!1,n._rendererResources.buffers[e]=a,n._geometryByteLength+=a.sizeInBytes}wv.prototype.set=function(e,t,n,r){this.id=e,this.componentType=t,this.model=n,this.context=r},wv.prototype.execute=function(){Av(this.id,this.componentType,this.model,this.context)};var Iv=new Sv,Pv=new wv;function Ov(e,t){var n=e._runtime.materialsById[t.material];if(Ze(n))return n._program}function Lv(e,t,n){var r,i,o,a=n._programPrimitives[t];if(!Ze(a))return e;for(i in a)if(a.hasOwnProperty(i)&&Ov(n,r=a[i])===t)break;if(n._programPrimitives[t]=void 0,n.extensionsUsed.WEB3D_quantized_attributes)o=Hu.modifyShaderForQuantizedAttributes(n.gltf,r,e),n._quantizedUniforms[t]=o.uniforms;else{var s=n._decodedData[i];if(!Ze(s))return e;o=Hu.modifyShaderForDracoQuantizedAttributes(n.gltf,r,e,s.attributes)}return o.shader}function Nv(e,t,n){return Ze(n)&&(e=n(e,t)),e}function Rv(){this.programToCreate=void 0,this.model=void 0,this.context=void 0}function Dv(e,t,n){var r=e.programId,i=e.techniqueId,o=t._sourcePrograms[r],a=t._rendererResources.sourceShaders,s=a[o.vertexShader],u=a[o.fragmentShader];u+="uniform vec4 u_rollerRegion;";var l,c=t._quantizedVertexShaders,h=t._toClipCoordinatesGLSL[r];(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(Ze(l=c[r])||(l=Lv(s,r,t),c[r]=l),s=l);var f,p=Nv(s,r,t._vertexShaderLoaded),d=Nv(u,r,t._fragmentShaderLoaded);et.isInternetExplorer()||(p=Hu.modifyVertexShaderForLogDepth(p,h),d=t.rollerRegion.equals(Mv)?Hu.modifyFragmentShaderForLogDepth(d):Hu.modifyFragmentShaderForLogDepthAddRoller(d)),Ze(t._uniformMapLoaded)||(d="uniform vec4 czm_pickColor;\n"+d),Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((f=(p="\n varying vec4 v_worldPosition; \n"+p).lastIndexOf("}"))&&(p=p.slice(0,f)+"vec4 eyePostion = czm_inverseProjection * gl_Position; \n v_worldPosition = czm_inverseView3D * eyePostion; \n"+p.slice(f)),d="\nvarying vec4 v_worldPosition; \n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) \nuniform float u_minimumBrightness ;\n#endif \nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n} \n"+wd+"\n"+d,t._scene.fog.enabled&&(d="#define FOG \n\n"+d));var m,_,g,y=0<t._imageBasedLightingFactor.x||0<t._imageBasedLightingFactor.y;y&&(d="#define USE_IBL_LIGHTING \n\n"+d),Ze(t._lightColor)&&(d="#define USE_CUSTOM_LIGHT_COLOR \n\n"+d),"2.0"===t._sourceVersion&&!t._sourceKHRTechniquesWebGL||(d=Xr.replaceMain(d,"non_gamma_corrected_main"),d+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((m=d.lastIndexOf("}"))&&(d=d.slice(0,m)+"\n#if defined(FOG)\n  vec4 finalColor =  gl_FragColor; \n  float vDistance =  length((czm_view3D * v_worldPosition).xyz); \n  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(v_worldPosition.x, v_worldPosition.y, v_worldPosition.z), false, vec3(0.0));\n  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);\n #ifndef HDR\n  const float fExposure = 4.0;\n  fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n #endif\n #ifdef FOG\n   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\n      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\n      fogColor *= darken;\n   #endif\n   #ifdef HDR\n       const float modifier = 0.15;\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);\n    #else\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);\n    #endif\n #endif\n gl_FragColor = finalColor;\n#endif\n"+d.slice(m))),ld.isSupported(n)&&(_=Ze(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,g=Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,(_||g||y)&&(d="uniform mat4 gltf_clippingPlanesMatrix; \n"+d),Ze(t._sphericalHarmonicCoefficients)?d="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+d:t._useDefaultSphericalHarmonics&&(d="#define DIFFUSE_IBL \n"+d),Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?d="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+d:t._useDefaultSpecularMaps&&(d="#define SPECULAR_IBL \n"+d)),Ze(t._luminanceAtZenith)&&(d="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+d),zv(r,i,d,p,t,n)}Rv.prototype.set=function(e,t,n){this.programToCreate=e,this.model=t,this.context=n},Rv.prototype.execute=function(){Dv(this.programToCreate,this.model,this.context)};var Mv=new qt(0,0,1,1);function Fv(e,t,n){var r=e.programId,i=e.techniqueId,o=t._sourcePrograms[r],a=t._rendererResources.sourceShaders,s=t._quantizedVertexShaders,u=t._toClipCoordinatesGLSL[r],l=t.clippingPlanes,c=lv(t),h=a[o.vertexShader],f=a[o.fragmentShader];f+="uniform vec4 u_rollerRegion;",(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(h=s[r]);var p,d,m,_=f;uv(t)&&(_=av._modifyShaderForColor(_)),c&&(d=l,m=n,p=Xr.replaceMain(p=_,"gltf_clip_main"),p+=av._getClippingFunction(d,m)+"\n",_=p+="uniform sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+Sp("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n");var g,y=Nv(h,r,t._vertexShaderLoaded),v=Nv(_,r,t._fragmentShaderLoaded);et.isInternetExplorer()||(y=Hu.modifyVertexShaderForLogDepth(y,u),v=t.rollerRegion.equals(Mv)?Hu.modifyFragmentShaderForLogDepth(v):Hu.modifyFragmentShaderForLogDepthAddRoller(v)),Ze(t._uniformMapLoaded)||(v="uniform vec4 czm_pickColor;\n"+v),Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((g=(y="\n varying vec4 v_worldPosition; \n"+y).lastIndexOf("}"))&&(y=y.slice(0,g)+"vec4 eyePostion = czm_inverseProjection * gl_Position; \nv_worldPosition = czm_inverseView3D * eyePostion; \n"+y.slice(g)),v="\nvarying vec4 v_worldPosition; \n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) \nuniform float u_minimumBrightness ;\n#endif \nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n} \n"+wd+"\n"+v,t._scene.fog.enabled&&(v="#define FOG \n\n"+v));var x,b,E,T=0<t._imageBasedLightingFactor.x||0<t._imageBasedLightingFactor.y;T&&(v="#define USE_IBL_LIGHTING \n\n"+v),Ze(t._lightColor)&&(v="#define USE_CUSTOM_LIGHT_COLOR \n\n"+v),"2.0"===t._sourceVersion&&!t._sourceKHRTechniquesWebGL||(v=Xr.replaceMain(v,"non_gamma_corrected_main"),v+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),Ze(t._scene)&&Ze(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((x=v.lastIndexOf("}"))&&(v=v.slice(0,x)+"\n#if defined(FOG)\n  vec4 finalColor =  gl_FragColor; \n  float vDistance =  length((czm_view3D * v_worldPosition).xyz); \n  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(v_worldPosition.x, v_worldPosition.y, v_worldPosition.z), false, vec3(0.0));\n  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);\n #ifndef HDR\n  const float fExposure = 4.0;\n  fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n #endif\n #ifdef FOG\n   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\n      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\n      fogColor *= darken;\n   #endif\n   #ifdef HDR\n       const float modifier = 0.15;\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);\n    #else\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);\n    #endif\n #endif\n gl_FragColor = finalColor;\n#endif\n"+v.slice(x))),ld.isSupported(n)&&(b=Ze(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,E=Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,!c&&(b||E||T)&&(v="uniform mat4 gltf_clippingPlanesMatrix; \n"+v),Ze(t._sphericalHarmonicCoefficients)?v="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+v:t._useDefaultSphericalHarmonics&&(v="#define DIFFUSE_IBL \n"+v),Ze(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?v="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+v:t._useDefaultSpecularMaps&&(v="#define SPECULAR_IBL \n"+v)),Ze(t._luminanceAtZenith)&&(v="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+v),zv(r,i,v,y,t,n)}function zv(e,t,n,r,i,o){var a=i._sourceTechniques[t],s=Hu.createAttributeLocations(a,i._precreatedAttributes);"string"==typeof n&&(n=n.replace(/czm_phong\(normalize\(positionToEyeEC\)\, material\)/g,"czm_phong(normalize(positionToEyeEC), material,czm_lightDirectionEC)")),i._rendererResources.programs[e]=ic.fromCache({context:o,vertexShaderSource:r,fragmentShaderSource:n,attributeLocations:s})}var Bv=new Rv;function Uv(t,n){return function(e){t.texturesToCreate.enqueue({id:n.id,image:e,bufferView:void 0}),--t.pendingBufferViewToImage}}function Vv(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0}function kv(e,t,n){var r=t.gltf.textures[e.id],i=t._rendererResources.samplers[r.sampler];Ze(i)||(i=new Nr({wrapS:Lr.REPEAT,wrapT:Lr.REPEAT}));for(var o=!1,a=t.gltf.materials,s=a.length,u=0;u<s;++u){var l=a[u];if(Ze(l.extensions)&&Ze(l.extensions.KHR_techniques_webgl)){var c=l.extensions.KHR_techniques_webgl.values;for(var h in c)if(c.hasOwnProperty(h)&&-1!==h.indexOf("Texture")){var f=c[h];if(f.index===e.id&&Ze(f.extensions)&&Ze(f.extensions.KHR_texture_transform)){o=!0;break}}}if(o)break}var p=i.wrapS,d=i.wrapT,m=i.minificationFilter;o&&m!==Pr.LINEAR&&m!==Pr.NEAREST&&(m=m===Pr.NEAREST_MIPMAP_NEAREST||m===Pr.NEAREST_MIPMAP_LINEAR?Pr.NEAREST:Pr.LINEAR,i=new Nr({wrapS:i.wrapS,wrapT:i.wrapT,textureMinificationFilter:m,textureMagnificationFilter:i.magnificationFilter}));var _,g,y,v,x=e.internalFormat,b=!(Ze(x)&&Ln.isCompressedFormat(x)||m!==Pr.NEAREST_MIPMAP_NEAREST&&m!==Pr.NEAREST_MIPMAP_LINEAR&&m!==Pr.LINEAR_MIPMAP_NEAREST&&m!==Pr.LINEAR_MIPMAP_LINEAR),E=b||p===Lr.REPEAT||p===Lr.MIRRORED_REPEAT||d===Lr.REPEAT||d===Lr.MIRRORED_REPEAT,T=Ze(e.image.length)?$e(e.image,!1):e.image;Ze(x)?v=new ti({context:n,source:{arrayBufferView:e.bufferView},width:e.width,height:e.height,pixelFormat:x,sampler:i}):Ze(T)&&(Ze(T.width)&&Ze(T.height)?(_=!pt.isPowerOfTwo(T.width)||!pt.isPowerOfTwo(T.height),E&&_&&((g=document.createElement("canvas")).width=pt.nextPowerOfTwo(T.width),g.height=pt.nextPowerOfTwo(T.height),g.getContext("2d").drawImage(T,0,0,T.width,T.height,0,0,g.width,g.height),T=g),v=new ti({context:n,source:T,pixelFormat:r.internalFormat,sampler:i,flipY:!1}),b&&v.generateMipmap()):Ze(T.length)&&0<T.length&&(v=new ti({context:n,source:T,width:(y=T[0]).width,height:y.height,pixelFormat:y.internalFormat,sampler:i}))),Ze(v)&&(t._rendererResources.textures[e.id]=v,t._texturesByteLength+=v.sizeInBytes)}Vv.prototype.set=function(e,t,n){this.gltfTexture=e,this.model=t,this.context=n},Vv.prototype.execute=function(){kv(this.gltfTexture,this.model,this.context)};var Gv=new Vv;function qv(i){var e,o,a,t=i._loadResources;0===t.pendingBufferLoads&&t.createSkins&&(t.createSkins=!1,e=i.gltf,o=e.accessors,a={},au.skin(e,function(e,t){var n,r=o[e.inverseBindMatrices];on.equals(e.bindShapeMatrix,on.IDENTITY)||(n=on.clone(e.bindShapeMatrix)),a[t]={inverseBindMatrices:Rp.getSkinInverseBindMatrices(i,r),bindShapeMatrix:n}}),function(e,t){for(var n=e.gltf,r=n.skins,i=n.nodes,o=e._runtime.nodes,a=e._loadResources.skinnedNodesIds,s=a.length,u=0;u<s;++u){var l=a[u],c=o[l],h=i[l],f=t[h.skin];c.inverseBindMatrices=f.inverseBindMatrices,c.bindShapeMatrix=f.bindShapeMatrix;for(var p=r[h.skin].joints,d=p.length,m=0;m<d;++m){var _=o[p[m]];c.joints.push(_)}}}(i,a))}function Hv(t,n,r,i){return function(e){Ze(i)&&(e=t.clampAnimations?i.clampTime(e):i.wrapTime(e),n[r]=i.evaluate(e,n[r]),n.dirtyNumber=t._maxDirtyNumber)}}function Wv(f,p){var d,m,_,g,e=f._loadResources;e.finishedBuffersCreation()&&e.finishedProgramCreation()&&e.createVertexArrays&&(e.createVertexArrays=!1,d=f._rendererResources.buffers,m=f._rendererResources.vertexArrays,_=f.gltf,g=_.accessors,au.mesh(_,function(e,h){au.meshPrimitive(e,function(e,t){var a,n,r,s=[],u=function(e,t){var n,r,i=e._sourceTechniques,o={},a=e._runtime.materialsById[t.material];if(!Ze(a))return o;var s=i[a._technique];if(!Ze(s))return o;var u,l=s.attributes,c=e._rendererResources.programs[s.program],h=c.vertexAttributes,f=c._attributeLocations;for(n in h){!h.hasOwnProperty(n)||Ze(u=l[n])&&(r=f[n],o[u.semantic]=r)}var p=e._precreatedAttributes;if(Ze(p))for(n in p)p.hasOwnProperty(n)&&(r=f[n],o[n]=r);return o}(f,e),l=f._decodedData[h+".primitive."+t];au.meshPrimitiveAttribute(e,function(e,t){if(Ze(a=u[t])){if(Ze(l)){var n=l.attributes;if(n.hasOwnProperty(t)){var r=n[t];return void s.push({index:a,vertexBuffer:d[r.bufferView],componentsPerAttribute:r.componentsPerAttribute,componentDatatype:r.componentDatatype,normalize:r.normalized,offsetInBytes:r.byteOffset,strideInBytes:r.byteStride})}}var i=g[e],o=Ze(i.normalized)&&i.normalized;s.push({index:a,vertexBuffer:d[i.bufferView],componentsPerAttribute:su(i.type),componentDatatype:i.componentType,normalize:o,offsetInBytes:i.byteOffset,strideInBytes:uu(_,i)})}});var i,o,c=f._precreatedAttributes;if(Ze(c))for(r in c)c.hasOwnProperty(r)&&Ze(a=u[r])&&((n=c[r]).index=a,s.push(n));Ze(e.indices)&&(o=g[e.indices].bufferView,Ze(l)&&(o=l.bufferView),i=d[o]),m[h+".primitive."+t]=new Ac({context:p,attributes:s,indexBuffer:i})})}))}function Yv(n){var e=n._loadResources;e.createRenderStates&&(e.createRenderStates=!1,au.material(n.gltf,function(e,t){!function(e,t,n){var r=e._rendererResources.renderStates,i=[Rt.FUNC_ADD,Rt.FUNC_ADD],o=[Rt.ONE,Rt.ONE_MINUS_SRC_ALPHA,Rt.ONE,Rt.ONE_MINUS_SRC_ALPHA];Ze(t.extensions)&&Ze(t.extensions.KHR_blend)&&(i=t.extensions.KHR_blend.blendEquation,o=t.extensions.KHR_blend.blendFactors);var a=!t.doubleSided,s="BLEND"===t.alphaMode;r[n]=sr.fromCache({cull:{enabled:a},depthTest:{enabled:!0,func:kc.LESS_OR_EQUAL},depthMask:!s,blending:{enabled:s,equationRgb:i[0],equationAlpha:i[1],functionSourceRgb:o[0],functionDestinationRgb:o[1],functionSourceAlpha:o[2],functionDestinationAlpha:o[3]}})}(n,e,t)}))}var Xv={MODEL:function(e,t,n){return function(){return n.computedMatrix}},VIEW:function(e,t,n){return function(){return e.view}},PROJECTION:function(e,t,n){return function(){return e.projection}},MODELVIEW:function(e,t,n){var r=new on;return function(){return on.multiplyTransformation(e.view,n.computedMatrix,r)}},CESIUM_RTC_MODELVIEW:function(e,t,n){var r=new on;return function(){return on.multiplyTransformation(e.view,n.computedMatrix,r),on.setTranslation(r,t._rtcCenterEye,r)}},MODELVIEWPROJECTION:function(e,t,n){var r=new on;return function(){return on.multiplyTransformation(e.view,n.computedMatrix,r),on.multiply(e._projection,r,r)}},MODELINVERSE:function(e,t,n){var r=new on;return function(){return on.inverse(n.computedMatrix,r)}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t,n){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t,n){var r=new on,i=new on;return function(){return on.multiplyTransformation(e.view,n.computedMatrix,r),on.inverse(r,i)}},MODELVIEWPROJECTIONINVERSE:function(e,t,n){var r=new on,i=new on;return function(){return on.multiplyTransformation(e.view,n.computedMatrix,r),on.multiply(e._projection,r,r),on.inverse(r,i)}},MODELINVERSETRANSPOSE:function(e,t,n){var r=new on,i=new jt;return function(){return on.inverse(n.computedMatrix,r),on.getMatrix3(r,i),jt.transpose(i,i)}},MODELVIEWINVERSETRANSPOSE:function(e,t,n){var r=new on,i=new on,o=new jt;return function(){return on.multiplyTransformation(e.view,n.computedMatrix,r),on.inverse(r,i),on.getMatrix3(i,o),jt.transpose(o,o)}},VIEWPORT:function(e,t,n){return function(){return e.viewportCartesian4}}};function jv(h,f,e,p,d,m,_){var g,y,v={},x={};return au.techniqueUniform(e,function(e,t){var n,r,i,o,a,s,u,l,c;Ze(p)&&Ze(p[t])?(i=Hu.createUniformFunction(e.type,p[t],m,_),v[t]=i.func,x[t]=i):Ze(e.node)?v[t]=(a=e.node,s=h,u=e.semantic,l=d.uniformState,c=s._runtime.nodes[a],Xv[u](l,s,c)):Ze(e.semantic)?"JOINTMATRIX"===e.semantic?g=t:"MORPHWEIGHTS"===e.semantic?y=t:"ALPHACUTOFF"===e.semantic?Ze(n=f.alphaMode)&&"MASK"===n&&(r=Je(f.alphaCutoff,.5),i=Hu.createUniformFunction(e.type,r,m,_),v[t]=i.func,x[t]=i):v[t]=Hu.getGltfSemanticUniforms()[e.semantic](d.uniformState,h):Ze(e.value)&&(o=Hu.createUniformFunction(e.type,e.value,m,_),v[t]=o.func,x[t]=o)}),{map:v,values:x,jointMatrixUniformName:g,morphWeightsUniformName:y}}function Kv(e){return function(){return e}}function Qv(e){return function(){return e.computedJointMatrices}}function Zv(e){return function(){return e.weights}}function Jv(e){return function(){return e.silhouetteColor}}function $v(e){return function(){return e.silhouetteSize}}function ex(e){return function(){return e.color}}var tx=new on;function nx(n){return function(){var e=n.clippingPlanes;if(!Ze(e)&&!Ze(n._sphericalHarmonicCoefficients)&&!Ze(n._specularEnvironmentMaps))return on.IDENTITY;var t=Ze(e)?e.modelMatrix:on.IDENTITY;return on.multiply(n._clippingPlaneModelViewMatrix,t,tx)}}function rx(t){return function(){var e=t.clippingPlanes;return Ze(e)&&e.enabled?e.texture:t._defaultTexture}}function ix(n){return function(){var e=n.clippingPlanes;if(!Ze(e))return It.WHITE.withAlpha(0);var t=It.clone(e.edgeColor);return t.alpha=e.edgeWidth,t}}function ox(e){return function(){return gp.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function ax(e){return function(){return e._imageBasedLightingFactor}}function sx(e){return function(){return e._lightColor}}function ux(e){return function(){return e.luminanceAtZenith}}function lx(e){return function(){return e._sphericalHarmonicCoefficients}}function cx(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function hx(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function fx(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function px(e,t){switch(e.mode){case Dn.TRIANGLES:return t/3;case Dn.TRIANGLE_STRIP:case Dn.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function dx(e,t,n,r,i){for(var o,a,s,u,l,c=e._nodeCommands,h=e._pickIds,f=e.allowPicking,p=e._runtime.meshesByName,d=e._rendererResources,m=d.vertexArrays,_=d.programs,g=d.renderStates,y=e._uniformMaps,v=e.gltf,x=v.accessors,b=v.meshes,E=t.mesh,T=b[E],S=T.primitives,C=S.length,w=0;w<C;++w){var A,I,P=S[w],O=x[P.indices],L=e._runtime.materialsById[P.material]._program,N=e._decodedData[E+".primitive."+w],R=P.attributes.POSITION;Ze(R)&&(A=Hu.getAccessorMinMax(v,R),I=ko.fromCornerPoints(_t.fromArray(A.min),_t.fromArray(A.max)));var D,M,F=m[E+".primitive."+w];M=Ze(N)?(D=N.numberOfIndices,0):Ze(O)?(D=O.count,O.byteOffset/wa.getSizeInBytes(O.componentType)):(D=x[P.attributes.POSITION].count,0),e._trianglesLength+=px(P,D);var z,B,U=y[P.material],V=U.uniformMap;Ze(U.jointMatrixUniformName)&&((z={})[U.jointMatrixUniformName]=Qv(n),V=ne(V,z)),Ze(U.morphWeightsUniformName)&&((B={})[U.morphWeightsUniformName]=Zv(n),V=ne(V,B)),V=ne(V,{gltf_color:ex(e),gltf_colorBlend:ox(e),gltf_clippingPlanes:rx(e),gltf_clippingPlanesEdgeStyle:ix(e),gltf_clippingPlanesMatrix:nx(e),gltf_iblFactor:ax(e),gltf_lightColor:sx(e),gltf_sphericalHarmonicCoefficients:lx(e),gltf_specularMap:cx(e),gltf_specularMapSize:hx(e),gltf_maxSpecularLOD:fx(e),gltf_luminanceAtZenith:ux(e)}),Ze(e._uniformMapLoaded)&&(V=e._uniformMapLoaded(V,L,n));var k={};e.extensionsUsed.WEB3D_quantized_attributes?(0,u=Ov(a=e,s=P),l=a._quantizedUniforms[u],k=Hu.createUniformsForQuantizedAttributes(a.gltf,s,l)):e._dequantizeInShader&&Ze(N)&&(o=N,k=Hu.createUniformsForDracoQuantizedAttributes(o.attributes)),V=ne(V,k);var G=g[P.material],q=G.blending.enabled,H=e._pickObject;Ze(H)||(H={primitive:e,id:e.id,node:n.publicNode,mesh:p[T.name]});var W,Y=Cd.castShadows(e._shadows),X=Cd.receiveShadows(e._shadows);f&&!Ze(e._uniformMapLoaded)&&(W=r.createPickId(H),h.push(W),V=ne(V,{czm_pickColor:Kv(W.color)})),f&&(W=Ze(e._pickIdLoaded)&&Ze(e._uniformMapLoaded)?e._pickIdLoaded():"czm_pickColor");var j,K=new Mn({boundingVolume:new ko,cull:e.cull,modelMatrix:new on,primitiveType:P.mode,vertexArray:F,count:D,offset:M,shaderProgram:_[L],castShadows:Y,receiveShadows:X,uniformMap:V,renderState:G,owner:H,pass:q?yn.TRANSLUCENT:e.opaquePass,pickId:W});i||((j=Mn.shallowClone(K)).boundingVolume=new ko,j.modelMatrix=new on);var Q={show:!0,boundingSphere:I,command:K,command2D:j,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:L};n.commands.push(Q),c.push(Q)}}function mx(e,t){var n,r,i,o,a,s,u,l,_,g,y,c,h,f,p,d,m,v,x,b,E=t.context,T=(t.scene3DOnly,e._quantizedVertexShaders),S=e._toClipCoordinatesGLSL={},C=e._sourceTechniques,w=e._sourcePrograms,A=e._rendererResources,I=A.sourceShaders;for(var P in e._loadRendererResourcesFromCache&&(I=A.sourceShaders=e._cachedRendererResources.sourceShaders),C){C.hasOwnProperty(P)&&(i=I[(r=w[n=C[P].program]).vertexShader],Hu.checkSupportedGlExtensions(r.glExtensions,E),(e.extensionsUsed.WEB3D_quantized_attributes||e._dequantizeInShader)&&(Ze(o=T[n])||(o=Lv(i,n,e),T[n]=o),i=o),i=Nv(i,n,e._vertexShaderLoaded),S[n]=Hu.toClipCoordinatesGLSL(e.gltf,i))}e._loadRendererResourcesFromCache?(a=e._cachedRendererResources,A.buffers=a.buffers,A.vertexArrays=a.vertexArrays,A.programs=a.programs,A.silhouettePrograms=a.silhouettePrograms,A.textures=a.textures,A.samplers=a.samplers,A.renderStates=a.renderStates,Ze(e._precreatedAttributes)&&Wv(e,E),e._cachedGeometryByteLength+=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&(t+=e[n].sizeInBytes);return t}(a.buffers),e._cachedTexturesByteLength+=function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&(t+=e[n].sizeInBytes);return t}(a.textures)):(function(e,t){var n=e._loadResources;if(0===n.pendingBufferLoads){var r,i=t.context,o=n.vertexBuffersToCreate,a=n.indexBuffersToCreate;if(e.asynchronous){for(;0<o.length&&(Iv.set(o.peek(),e,i),t.jobScheduler.execute(Iv,Ip.BUFFER));)o.dequeue();for(;0<a.length&&(r=a.peek(),Pv.set(r.id,r.componentType,e,i),t.jobScheduler.execute(Pv,Ip.BUFFER));)a.dequeue()}else{for(;0<o.length;)Cv(o.dequeue(),e,i);for(;0<a.length;)Av((r=a.dequeue()).id,r.componentType,e,i)}}}(e,t),function(e,t){var n=e._loadResources,r=n.programsToCreate;if(0===n.pendingShaderLoads&&0===n.pendingBufferLoads){var i=t.context;if(e.asynchronous)for(;0<r.length&&(Bv.set(r.peek(),e,i),t.jobScheduler.execute(Bv,Ip.PROGRAM));)r.dequeue();else for(;0<r.length;)Dv(r.dequeue(),e,i)}}(e,t),(l=(s=e)._loadResources).createSamplers&&(l.createSamplers=!1,u=s._rendererResources.samplers,au.sampler(s.gltf,function(e,t){u[t]=new Nr({wrapS:e.wrapS,wrapT:e.wrapT,minificationFilter:e.minFilter,magnificationFilter:e.magFilter})})),function(e){var t=e._loadResources;if(0===t.pendingBufferLoads)for(;0<t.texturesToCreateFromBufferView.length;){var n,r=t.texturesToCreateFromBufferView.dequeue(),i=e.gltf,o=i.bufferViews[r.bufferView],a=i.textures[r.id].source,s=Hu.getFailedLoadFunction(e,"image","id: "+r.id+", bufferView: "+r.bufferView);"image/ktx"===r.mimeType?(Uf(t.getBuffer(o)).then(yv(e,r.id,a)).otherwise(s),++e._loadResources.pendingTextureLoads):"image/crn"===r.mimeType?(zf(t.getBuffer(o)).then(yv(e,r.id,a)).otherwise(s),++e._loadResources.pendingTextureLoads):"image/pkm"===r.mimeType?(Ad(t.getBuffer(o)).then(yv(e,r.id,a)).otherwise(s),++e._loadResources.pendingTextureLoads):(n=Uv(t,r),Bf({uint8Array:t.getBuffer(o),format:r.mimeType,flipY:!1}).then(n).otherwise(s),++t.pendingBufferViewToImage)}}(e),function(e,t){var n=t.context,r=e._loadResources.texturesToCreate;if(e.asynchronous)for(;0<r.length&&(Gv.set(r.peek(),e,n),t.jobScheduler.execute(Gv,Ip.TEXTURE));)r.dequeue();else for(;0<r.length;)kv(r.dequeue(),e,n)}(e,t)),qv(e),(c=(_=e)._loadResources).finishedPendingBufferLoads()&&c.createRuntimeAnimations&&(c.createRuntimeAnimations=!1,_._runtime.animations=[],g=_._runtime.nodes,y=_.gltf.accessors,au.animation(_.gltf,function(e,t){for(var n=e.channels,r=e.samplers,i=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=n.length,s=new Array(a),u=0;u<a;++u){var l=n[u],c=l.target,h=c.path,f=r[l.sampler],p=Rp.getAnimationParameterValues(_,y[f.input]),d=Rp.getAnimationParameterValues(_,y[f.output]),i=Math.min(i,p[0]),o=Math.max(o,p[p.length-1]),m=Rp.getAnimationSpline(_,t,e,l.sampler,f,p,h,d);s[u]=Hv(_,g[c.node],c.path,m)}_._runtime.animations[t]={name:e.name,startTime:i,stopTime:o,channelEvaluators:s}})),e._loadRendererResourcesFromCache||(Wv(e,E),Yv(e)),f=E,(b=(h=e)._loadResources).finishedProgramCreation()&&b.createUniformMaps&&(b.createUniformMaps=!1,p=h.gltf,d=h._sourceTechniques,m=h._uniformMaps,v=h._rendererResources.textures,x=h._defaultTexture,au.material(p,function(e,t){var n=h._runtime.materialsById[t],r=d[n._technique],i=n._values,o=jv(h,e,r,i,f,v,x);o.map.u_rollerRegion=function(){return h.rollerRegion};var a,s=m[t];s.uniformMap=o.map,s.values=o.values,s.jointMatrixUniformName=o.jointMatrixUniformName,s.morphWeightsUniformName=o.morphWeightsUniformName,Ze(r.attributes.a_outlineCoordinates)&&(a=Jp.createTexture(h,f),s.uniformMap.u_outlineTexture=function(){return a})})),function(e,t,n){var r=e._loadResources;if(r.finishedEverythingButTextureCreation()&&r.createRuntimeNodes){r.createRuntimeNodes=!1;for(var i=[],o=e._runtime.nodes,a=e.gltf,s=a.nodes,u=a.scenes[a.scene].nodes,l=u.length,c=[],h={},f=new Od,p=!1,d=a.asset.version,m=0;m<l;++m)for(c.push({parentRuntimeNode:void 0,gltfNode:s[u[m]],id:u[m]});0<c.length;){var _=c.pop();h[_.id]=!0;var g,y,v,x=_.parentRuntimeNode,b=_.gltfNode,E=o[_.id];0===E.parents.length&&(Ze(b.matrix)?E.matrix=on.fromColumnMajorArray(b.matrix):(g=b.rotation,E.translation=_t.fromArray(b.translation),E.rotation=Si.unpack(g),E.scale=_t.fromArray(b.scale))),Ze(x)?(x.children.push(E),E.parents.push(x)):i.push(E),Ze(b.instanceIndex)&&Ze(e.content)&&"2.0"==d?(y=b.mesh,"Batched3DModel3DTileContent"===e.content.constructor.name&&(Ze(b.matrix)?((v=on.clone(b.matrix,new on))[1]=-b.matrix[2],v[2]=b.matrix[1],v[4]=-b.matrix[8],v[5]=b.matrix[10],v[6]=-b.matrix[9],v[8]=b.matrix[4],v[9]=-b.matrix[6],v[10]=b.matrix[5],v[13]=-b.matrix[14],v[14]=b.matrix[13],f.contains(y)?f.get(y).push({_modelMatrix:v,_nodeId:_.id,_instanceId:b.instanceIndex}):f.set(y,[{_modelMatrix:v,_nodeId:_.id,_instanceId:b.instanceIndex}])):console.log("node.matrix is empty")),p=!0):Ze(b.mesh)&&dx(e,b,E,t,n.scene3DOnly);var T=b.children;if(Ze(T))for(var S=T.length,C=0;C<S;C++){var w=T[C];h[w]||c.push({parentRuntimeNode:E,gltfNode:s[w],id:T[C]})}}e.ev_E3MInternalInstance&&(p&&0<f.length&&"Batched3DModel3DTileContent"===e.content.constructor.name?(e._releaseGltfJson=!1,e.ev_E3MInternalInstance.generateInstanceCommandByGltf(e,t,f,n)):p&&"Instanced3DModel3DTileContent"===e.content.constructor.name&&(s[0].matrix=on.clone(on.IDENTITY),o[0].matrix=on.clone(on.IDENTITY),dx(e,s[0],o[0],t,n.scene3DOnly))),e._runtime.rootNodes=i,e._runtime.nodes=o}}(e,E,t)}function _x(e,t){var n=e.publicNode,r=n.matrix;n.useMatrix&&Ze(r)?on.clone(r,t):Ze(e.matrix)?on.clone(e.matrix,t):(on.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t),n.setMatrix(t))}var gx=[],yx=new qt,vx=new on;var xx=new on;function bx(e){var t,n,r=Mn.shallowClone(e);return r.pass=yn.TRANSLUCENT,r.renderState=(t=e.renderState,(n=$e(t,!0)).cull.enabled=!1,n.depthTest.enabled=!0,n.depthMask=!1,n.blending=ui.ALPHA_BLEND,sr.fromCache(n)),r}function Ex(e,t,n){var r=t.scene3DOnly,i=e.color.alpha;if(0<i&&i<1){var o=e._nodeCommands,a=o.length;if(!Ze(o[0].translucentCommand)||n)for(var s=0;s<a;++s){var u,l=o[s],c=l.command;l.translucentCommand=bx(c),r||(u=l.command2D,l.translucentCommand2D=bx(u))}}}function Tx(e,t){var n=e._rendererResources.programs;for(var r in n)if(n.hasOwnProperty(r)&&n[r]===t)return r}function Sx(e,t,n){var r=t.vertexShaderSource.sources[0],i=t._attributeLocations,o=e._normalAttributeName,r=Xr.replaceMain(r,"gltf_silhouette_main");r+="uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n = normalize(czm_normal3D * "+o+"); \n    n.x *= czm_projection[0][0]; \n    n.y *= czm_projection[1][1]; \n    vec4 clip = gl_Position; \n    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; \n    gl_Position = clip; \n}";return ic.fromCache({context:n.context,vertexShaderSource:r,fragmentShaderSource:"uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); \n}",attributeLocations:i})}function Cx(e,t){return sv(t.context)&&0<e.silhouetteSize&&0<e.silhouetteColor.alpha&&Ze(e._normalAttributeName)}function wx(e){return 0<e.color.alpha&&e.color.alpha<1}function Ax(e){return 0===e.color.alpha}function Ix(e,t){return Math.floor(e)!==Math.floor(t)||Math.ceil(e)!==Math.ceil(t)}var Px=0;function Ox(e,t){for(var n=++Px%255,r=function(e){for(var t=e._nodeCommands,n=t.length,r=0;r<n;++r){if(t[r].command.pass===yn.TRANSLUCENT)return!0}return!1}(e)||wx(e)||e.silhouetteColor.alpha<1,i=e._rendererResources.silhouettePrograms,o=t.scene3DOnly,a=e._nodeCommands,s=a.length,u=0;u<s;++u){var l=a[u],c=l.command,h=wx(e)?l.translucentCommand:c,f=Mn.shallowClone(h),p=$e(h.renderState);p.stencilTest={enabled:!0,frontFunction:Rt.ALWAYS,backFunction:Rt.ALWAYS,reference:n,mask:-1,frontOperation:{fail:Rt.KEEP,zFail:Rt.KEEP,zPass:Rt.REPLACE},backOperation:{fail:Rt.KEEP,zFail:Rt.KEEP,zPass:Rt.REPLACE}},Ax(e)&&(p.colorMask={red:!1,green:!1,blue:!1,alpha:!1},p.depthMask=!1),p=sr.fromCache(p),f.renderState=p,l.silhouetteModelCommand=f;var d=Mn.shallowClone(c);(p=$e(c.renderState,!0)).depthTest.enabled=!0,p.cull.enabled=!1,r&&(d.pass=yn.TRANSLUCENT,p.depthMask=!1,p.blending=ui.ALPHA_BLEND),p.stencilTest={enabled:!0,frontFunction:Rt.NOTEQUAL,backFunction:Rt.NOTEQUAL,reference:n,mask:-1,frontOperation:{fail:Rt.KEEP,zFail:Rt.KEEP,zPass:Rt.KEEP},backOperation:{fail:Rt.KEEP,zFail:Rt.KEEP,zPass:Rt.KEEP}},p=sr.fromCache(p);var m=c.shaderProgram,_=Tx(e,m),g=i[_];Ze(g)||(g=Sx(e,m,t),i[_]=g);var y,v,x,b=ne(c.uniformMap,{gltf_silhouetteColor:Jv(e),gltf_silhouetteSize:$v(e)});d.renderState=p,d.shaderProgram=g,d.uniformMap=b,d.castShadows=!1,d.receiveShadows=!1,l.silhouetteColorCommand=d,o||(y=l.command2D,(v=Mn.shallowClone(f)).boundingVolume=y.boundingVolume,v.modelMatrix=y.modelMatrix,l.silhouetteModelCommand2D=v,x=Mn.shallowClone(d),v.boundingVolume=y.boundingVolume,v.modelMatrix=y.modelMatrix,l.silhouetteColorCommand2D=x)}}function Lx(e,t,n){var r,i;Cx(e,t)&&(r=e._nodeCommands,i=Ix(e.color.alpha,e._colorPreviousAlpha)||Ix(e.silhouetteColor.alpha,e._silhouetteColorPreviousAlpha)||!Ze(r[0].silhouetteModelCommand),e._colorPreviousAlpha=e.color.alpha,e._silhouetteColorPreviousAlpha=e.silhouetteColor.alpha,(i||n)&&Ox(e,t))}var Nx=new ko;var Rx=new _t,Dx=new Un;function Mx(e,t){var n,r,i,o,a,s,u,l,c,h,f,p=e.scale;return 0!==e.minimumPixelSize&&(n=t.context,r=Math.max(n.drawingBufferWidth,n.drawingBufferHeight),i=Ze(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix,Rx.x=i[12],Rx.y=i[13],Rx.z=i[14],Ze(e._rtcCenter)&&_t.add(e._rtcCenter,Rx,Rx),e._mode!==Tl.SCENE3D&&(a=(o=t.mapProjection).ellipsoid.cartesianToCartographic(Rx,Dx),o.project(a,Rx),_t.fromElements(Rx.z,Rx.x,Rx.y,Rx)),s=e.boundingSphere.radius,c=Rx,h=s,f=t,Nx.center=c,Nx.radius=h,l=1/(u=f.camera.getPixelSize(Nx,f.context.drawingBufferWidth,f.context.drawingBufferHeight)),Math.min(2*s*l,r)<e.minimumPixelSize&&(p=e.minimumPixelSize*u/(2*e._initialRadius))),Ze(e.maximumScale)?Math.min(e.maximumScale,p):p}function Fx(e){Ze(e._cacheKey)&&Ze(e._cachedGltf)&&0==--e._cachedGltf.count&&delete iv[e._cacheKey],e._cachedGltf=void 0}function zx(e,t){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=e,this.cacheKey=t,this.count=0}function Bx(e){for(var t in e)e.hasOwnProperty(t)&&(e[t].isDestroyed()||e[t].destroy())}function Ux(r,i,o){return function(e){var t;r.heightReference===Ap.RELATIVE_TO_GROUND&&((t=i.cartesianToCartographic(e,Dx)).height+=o.height,i.cartographicToCartesian(t,e));var n=r._clampedModelMatrix;on.clone(r.modelMatrix,n),n[12]=e.x,n[13]=e.y,n[14]=e.z,r._heightChanged=!0}}zx.prototype.release=function(){if(0==--this.count)return Ze(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],Bx((e=this).buffers),Bx(e.vertexArrays),Bx(e.programs),Bx(e.silhouettePrograms),Bx(e.textures),Vt(this);var e};var Vx=new _t,kx=new Un;function Gx(e,t){e.programs!==t.programs&&Bx(e.programs),e.silhouettePrograms!==t.silhouettePrograms&&Bx(e.silhouettePrograms)}function qx(e,t,n,r,i){this._tileset=e,this._tile=t,this._resource=n,this._model=void 0,this._batchTable=void 0,this._features=void 0,this._batchIdAttributeName=void 0,this._diffuseAttributeOrUniformName={},this._rtcCenterTransform=void 0,this._contentModelMatrix=void 0,this.featurePropertiesDirty=!1,this.useHdr=!0,function(e,t,n){var r=e._tileset,i=e._tile,o=e._resource,a=Je(n,0);n=a;var s=new Uint8Array(t),u=new DataView(t);n+=Hx;var l=u.getUint32(n,!0);if(1!==l)throw new de("Only Batched 3D Model version 1 is supported.  Version "+l+" is not.");n+=Hx;var c=u.getUint32(n,!0);n+=Hx;var h=u.getUint32(n,!0);n+=Hx;var f=u.getUint32(n,!0);n+=Hx;var p=u.getUint32(n,!0);n+=Hx;var d,m,_=u.getUint32(n,!0);n+=Hx,570425344<=p?(n-=2*Hx,d=h,p=f,f=h=_=0,qx._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")):570425344<=_&&(n-=Hx,d=p,p=h,_=f,f=h=0,qx._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/master/specification/TileFormats/Batched3DModel."));{var g;0===h?m={BATCH_LENGTH:Je(d,0)}:(g=kt(s,n,h),m=JSON.parse(g),n+=h)}var y=new Uint8Array(t,n,f);n+=f;var v,x,b,E,T=new zo(m,y);d=T.getGlobalProperty("BATCH_LENGTH"),T.featuresLength=d,Ze(T.json.Radius)&&(e.lineRadius=T.json.Radius,v=T.json.Radius);if(Ze(T.json.FLOWLINE)){var S=T.json.FLOWLINE,C=0;for(var w in S){for(var A=[],I=[],P=0;P<S[w].length;P+=3){var O=_t.fromRadians(S[w][P+0],S[w][P+1],S[w][P+2]);A.push(O),v&&(I.push(S[w][P+0]),I.push(S[w][P+1]),I.push(S[w][P+2]+v[C]))}C++,Ze(e.tileset.flowLines)||(e.tileset.flowLines=[]),e.tileset.flowLines.push(A),Ze(e.flowLines)||(e.flowLines=[],e.centreLine=[]),e.flowLines.push(A),v&&e.centreLine.push(I)}}{var L;0<p&&(L=kt(s,n,p),x=JSON.parse(L),n+=p,0<_&&(b=new Uint8Array(t,n,_),b=new Uint8Array(b),n+=_))}Ze(r.classificationType)&&(E=function(n){return function(e,t){n._model.updateCommands(e,t)}}(e));var N=new no(e,d,x,b,E);if(e._batchTable=N,Ze(e._tile._header.EVID))for(var R=N.featuresLength,P=0;P<R;P++)N.setProperty(P,"EVID",e._tile._header.EVID);var D,M=a+c-n;if(0==M)throw new de("glTF byte length must be greater than 0.");D=n%4==0?new Uint8Array(t,n,M):(qx._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),new Uint8Array(s.subarray(n,n+M)));var F={content:e,primitive:r};e._rtcCenterTransform=on.IDENTITY;var z=T.getGlobalProperty("RTC_CENTER",Mt.FLOAT,3);Ze(z)&&(e._rtcCenterTransform=on.fromTranslation(_t.fromArray(z)));e._contentModelMatrix=on.multiply(i.computedTransform,e._rtcCenterTransform,new on),Ze(r.classificationType)?e._model=new Yh({gltf:D,cull:!1,basePath:o,requestType:pe.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:r._gltfUpAxis,forwardAxis:xn.X,debugWireframe:r.debugWireframe,vertexShaderLoaded:Wx(e),classificationShaderLoaded:function(n){return function(e){var t=n._batchTable.getClassificationFragmentShaderCallback();return Ze(t)?t(e):e}}(e),uniformMapLoaded:N.getUniformMapCallback(),pickIdLoaded:Yx(e),classificationType:r._classificationType,batchTable:N}):e._model=new av({gltf:D,cull:!1,releaseGltfJson:!0,opaquePass:yn.CESIUM_3D_TILE,basePath:o,requestType:pe.TILES3D,modelMatrix:e._contentModelMatrix,upAxis:r._gltfUpAxis,forwardAxis:xn.X,shadows:r.shadows,debugWireframe:r.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:Wx(e),fragmentShaderLoaded:function(a){return function(e,t){var n=a._batchTable,r=!Ze(a._tileset.classificationType),i=a._model.gltf;Ze(i)&&(a._diffuseAttributeOrUniformName[t]=Hu.getDiffuseAttributeOrUniform(i,t));var o=n.getFragmentShaderCallback(r,a._diffuseAttributeOrUniformName[t]);return Ze(o)?o(e):e}}(e),uniformMapLoaded:N.getUniformMapCallback(),pickIdLoaded:Yx(e),addBatchIdToGeneratedShaders:0<d,pickObject:F,imageBasedLightingFactor:r.imageBasedLightingFactor,lightColor:r.lightColor,luminanceAtZenith:r.luminanceAtZenith,sphericalHarmonicCoefficients:r.sphericalHarmonicCoefficients,specularEnvironmentMaps:r.specularEnvironmentMaps,content:e,sharedResources:{instancedPrograms:{name:i.sharedResources.instancedPrograms.name,shadredData:i.sharedResources.instancedPrograms.shadredData},ktxs:i.sharedResources.ktxs},specular:r.specular,rollerRegion:r.rollerRegion})}(this,r,i)}av.prototype.update=function(e){if(Ze(this._scene)||(this._scene=e.camera._scene),e.mode!==Tl.MORPHING)if(et.supportsWebP.initialized){var t=et.supportsWebP(),n=e.context;this._defaultTexture=n.defaultTexture;var r,i,o=this._scene,a=o.globe;if(Ze(a)&&a.enableLighting){i=Ze(a._surfaceNormal)?a._surfaceNormal:(_=o.camera.positionCartographic,m=a._surface._tileProvider.tilingScheme.ellipsoid,r=_t.fromRadians(_.longitude,_.latitude,0,m),m.geodeticSurfaceNormal(r));var s=o.context._us.lightDirectionWC,u=_t.dot(i,s);if((!this.hasDiffuse||!!Math.ceil(this.hasDiffuse)!=!!Math.ceil(u))&&this._runtime&&this._runtime.materialsById){var l=0<u?this.modelSpecular:0,c=this._runtime.materialsById;for(var h in c)Ze(c[h]._values.u_specular)&&(c[h]._values.u_specular[0]=l),Ze(c[h]._uniformMap.values)&&Ze(c[h]._uniformMap.values.u_specular)&&(c[h]._uniformMap.values.u_specular.value.x=l);this.hasDiffuse=u}}if(this._state===ev.NEEDS_LOAD&&Ze(this.gltf)){var f,p,d,m,_,g,y=this.cacheKey;if(Ze(y)){n.cache.modelRendererResourceCache=Je(n.cache.modelRendererResourceCache,{});var v,x=n.cache.modelRendererResourceCache;if(Ze(v=x[this.cacheKey])){if(!v.ready)return;++v.count,this._loadRendererResourcesFromCache=!0}else(v=new zx(n,y)).count=1,x[this.cacheKey]=v;this._cachedRendererResources=v}else(v=new zx(n)).count=1,this._cachedRendererResources=v;this._state=ev.LOADING,this._state!==ev.FAILED&&(Ze(f=this.gltf.extensions)&&Ze(f.CESIUM_RTC)&&(p=_t.fromArray(f.CESIUM_RTC.center),_t.equals(p,_t.ZERO)||(this._rtcCenter3D=p,_=(m=(d=e.mapProjection).ellipsoid).cartesianToCartographic(this._rtcCenter3D),g=d.project(_),_t.fromElements(g.z,g.x,g.y,g),this._rtcCenter2D=g,this._rtcCenterEye=new _t,this._rtcCenter=this._rtcCenter3D)),hu(this.gltf),this._loadResources=new qu,this._loadRendererResourcesFromCache||Hu.parseBuffers(this,mv))}var b,E,T,S,C,w,A,I,P,O,L,N,R,D,M,F,z,B,U,V,k,G,q,H,W,Y,X,j=this._loadResources,K=this._incrementallyLoadTextures,Q=!1;if(this._state===ev.LOADING){if(0===j.pendingBufferLoads){if(!j.initialized){e.brdfLutGenerator.update(e),Hu.checkSupportedExtensions(this.extensionsRequired,t),Hu.updateForwardAxis(this),Ze(this.gltf.extras.sourceVersion)||((b=this.gltf).extras.sourceVersion=Hu.getAssetVersion(b),b.extras.sourceKHRTechniquesWebGL=Ze(Hu.getUsedExtensions(b).KHR_techniques_webgl),this._sourceVersion=b.extras.sourceVersion,this._sourceKHRTechniquesWebGL=b.extras.sourceKHRTechniquesWebGL,Du(b),lu(b),pl(b,E={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders}),ml(b,E)),this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&yp.hasExtension(this),H=(q=this).gltf,W=q._loadResources,au.buffer(H,function(e,t){W.buffers[t]=e.extras._pipeline.source}),function(e){var t={},n={},r={};e._runtime.articulationsByName=t,e._runtime.articulationsByStageKey=n,e._runtime.stagesByKey=r;var i=e.gltf;if(ou(i,"AGI_articulations")&&Ze(i.extensions)&&Ze(i.extensions.AGI_articulations)){var o=i.extensions.AGI_articulations.articulations;if(Ze(o))for(var a=o.length,s=0;s<a;++s){var u=$e(o[s]);u.nodes=[],u.isDirty=!0;for(var l=(t[u.name]=u).stages.length,c=0;c<l;++c){var h=u.stages[c];h.currentValue=h.initialValue;var f=u.name+" "+h.name;n[f]=u,r[f]=h}}}}(this),ou(G=(B=this).gltf,"KHR_techniques_webgl")&&(U=B._sourcePrograms,V=B._sourceTechniques,k=G.extensions.KHR_techniques_webgl.programs,au.technique(G,function(e,t){V[t]=$e(e);var n=e.program;Ze(U[n])||(U[n]=$e(k[n]))})),this._loadRendererResourcesFromCache||(function(e){var n=e.gltf.bufferViews,r=e._loadResources.vertexBuffersToCreate;au.bufferView(e.gltf,function(e,t){e.target===Rt.ARRAY_BUFFER&&r.enqueue(t)});var i=e._loadResources.indexBuffersToCreate,o={};au.accessor(e.gltf,function(e){var t=e.bufferView;Ze(t)&&(n[t].target!==Rt.ELEMENT_ARRAY_BUFFER||Ze(o[t])||(o[t]=!0,i.enqueue({id:t,componentType:e.componentType})))})}(this),gv(this),function(e){var t,n=e._sourceTechniques;for(var r in n){n.hasOwnProperty(r)&&(t=n[r],e._loadResources.programsToCreate.enqueue({programId:t.program,techniqueId:r}))}}(this),Ev(this,n,t)),R=(N=this).gltf,D=N._sourceTechniques,M={},F={},z=N._uniformMaps,au.material(R,function(e,t){z[t]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var n,r=new Kp(N,e,t);Ze(e.extensions)&&Ze(e.extensions.KHR_techniques_webgl)&&(n=e.extensions.KHR_techniques_webgl.technique,r._technique=n,r._program=D[n].program,au.materialValue(e,function(e,t){Ze(r._values)||(r._values={}),r._values[t]=$e(e),"u_specular"==t&&(r._values[t][0]=N.modelSpecular)})),M[e.name]=r,F[t]=r}),N._runtime.materialsByName=M,N._runtime.materialsById=F,O={},L=(P=this)._runtime.materialsById,au.mesh(P.gltf,function(e,i){O[e.name]=new Qp(e,L,i),(Ze(P.extensionsUsed.WEB3D_quantized_attributes)||P._dequantizeInShader)&&au.meshPrimitive(e,function(e,t){var n=Ov(P,e),r=P._programPrimitives[n];Ze(r)||(r={},P._programPrimitives[n]=r),r[i+".primitive."+t]=e})}),P._runtime.meshesByName=O,S={},C={},w=[],A=(T=this)._loadResources.skinnedNodesIds,I=T._runtime.articulationsByName,au.node(T.gltf,function(e,t){var n={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new on,computedMatrix:new on,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:e.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(n.publicNode=new Zp(T,e,n,t,Hu.getTransform(e)),S[t]=n,C[e.name]=n,Ze(e.skin)&&(A.push(t),w.push(n)),Ze(e.extensions)&&Ze(e.extensions.AGI_articulations)){var r=e.extensions.AGI_articulations.articulationName;if(Ze(r)){var i=on.clone(n.publicNode.originalMatrix,Tv),o=I[r];o.nodes.push(n.publicNode);for(var a=o.stages.length,s=0;s<a;++s)i=pv(o.stages[s],i);n.publicNode.matrix=i}}}),T._runtime.nodes=S,T._runtime.nodesByName=C,T._runtime.skinnedNodes=w;var Z=this.gltf;if(Ze(Z)&&0<Z.meshes.length&&0<this.meshPrimitives.length){for(var J=0;J<this.meshPrimitives.length;J++)yp.parseDecodedData(this.meshPrimitives[J],this,n);this.meshPrimitives.length=0}else yp.parse(this,n);j.initialized=!0}j.finishedDecoding()||yp.decodeModel(this,n).otherwise(Hu.getFailedLoadFunction(this,"model",this.basePath)),j.finishedDecoding()&&!j.resourcesParsed&&(this._boundingSphere=Hu.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,yp.cacheDataForModel(this),j.resourcesParsed=!0),j.resourcesParsed&&0===j.pendingShaderLoads&&(Jp.outlinePrimitives(this),mx(this,e))}(j.finished()||K&&j.finishedEverythingButTextureCreation())&&(this._state=ev.LOADED,Q=!0)}Ze(j)&&this._state===ev.LOADED&&(K&&!Q&&mx(this,e),j.finished()&&(this._loadResources=void 0,Y=this._rendererResources,(X=this._cachedRendererResources).buffers=Y.buffers,X.vertexArrays=Y.vertexArrays,X.programs=Y.programs,X.sourceShaders=Y.sourceShaders,X.silhouettePrograms=Y.silhouettePrograms,X.textures=Y.textures,X.samplers=Y.samplers,X.renderStates=Y.renderStates,X.ready=!0,this._normalAttributeName=Hu.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),Ze(this._precreatedAttributes)&&(X.vertexArrays={}),this.releaseGltfJson&&Fx(this)));var $,ee=ld.isSupported(n);this._shouldUpdateSpecularMapAtlas&&ee&&(this._shouldUpdateSpecularMapAtlas=!1,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._specularEnvironmentMapAtlas=void 0,Ze(this._specularEnvironmentMaps)&&(this._specularEnvironmentMapAtlas=new ld(this._specularEnvironmentMaps),($=this)._specularEnvironmentMapAtlas.readyPromise.then(function(){$._shouldRegenerateShaders=!0}).otherwise(function(e){console.error("Error loading specularEnvironmentMaps: "+e)})),this._shouldRegenerateShaders=!0),Ze(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e);var te=!Ze(this._specularEnvironmentMapAtlas)&&Ze(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,ne=!Ze(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,re=!Ze(this._sphericalHarmonicCoefficients)&&Ze(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,ie=!Ze(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||te||ne||re||ie,this._useDefaultSpecularMaps=!Ze(this._specularEnvironmentMapAtlas)&&Ze(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!Ze(this._sphericalHarmonicCoefficients)&&Ze(e.sphericalHarmonicCoefficients);var oe,ae,se,ue,le,ce,he,fe,pe,de,me,_e,ge,ye,ve,xe,be,Ee,Te,Se,Ce,we,Ae,Ie,Pe,Oe,Le=Cx(this,e),Ne=wx(this),Re=Ax(this),De=!Ze(this.distanceDisplayCondition)||(ae=e,he=(oe=this).distanceDisplayCondition,fe=he.near*he.near,pe=he.far*he.far,ae.mode===Tl.SCENE2D?(se=.5*(ae.camera.frustum.right-ae.camera.frustum.left),se*=se):(ce=on.getTranslation(oe.modelMatrix,Vx),ae.mode===Tl.COLUMBUS_VIEW&&(le=(ue=ae.mapProjection).ellipsoid.cartesianToCartographic(ce,kx),ce=ue.project(le,ce),_t.fromElements(ce.z,ce.x,ce.y,ce)),se=_t.distanceSquared(ce,ae.camera.positionWC)),fe<=se&&se<=pe),Me=this.show&&De&&0!==this.scale&&(!Re||Le);if((Me&&this._state===ev.LOADED||Q)&&(de=this.activeAnimations.update(e)||this._cesiumAnimationsDirty,this._cesiumAnimationsDirty=!1,this._dirty=!1,me=this.modelMatrix,_e=e.mode!==this._mode,this._mode=e.mode,((ge=!on.equals(this._modelMatrix,me)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||0!==this.minimumPixelSize||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||_e)||Q)&&(on.clone(me,this._modelMatrix),function(e){Ze(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);var t,n,r,i,o,a,s,u=e._scene;Ze(u)&&Ze(u.globe)&&e.heightReference!==Ap.NONE?(n=(t=u.globe).ellipsoid,r=e.modelMatrix,Rx.x=r[12],Rx.y=r[13],Rx.z=r[14],i=n.cartesianToCartographic(Rx),Ze(e._clampedModelMatrix)||(e._clampedModelMatrix=on.clone(r,new on)),o=t._surface,e._removeUpdateHeightCallback=o.updateHeight(i,Ux(e,n,i)),Ze(a=t.getHeight(i))&&(s=Ux(e,n,i),Un.clone(i,Dx),Dx.height=a,n.cartographicToCartesian(Dx,Rx),s(Rx))):e._clampedModelMatrix=void 0}(this),Ze(this._clampedModelMatrix)&&(me=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1,ye=Mx(this,e),ve=this._computedModelMatrix,on.multiplyByUniformScale(me,ye,ve),this._upAxis===xn.Y?on.multiplyTransformation(ve,xn.Y_UP_TO_Z_UP,ve):this._upAxis===xn.X&&on.multiplyTransformation(ve,xn.X_UP_TO_Z_UP,ve),this.forwardAxis===xn.Z&&on.multiplyTransformation(ve,xn.Z_UP_TO_X_UP,ve)),(de||ge||Q)&&(function(e,t,n,r){var i,o,a,s=e._maxDirtyNumber,u=e._runtime.rootNodes,l=u.length,c=gx,h=e._computedModelMatrix;e._mode===Tl.SCENE3D||e._ignoreCommands||(i=on.getColumn(h,3,yx),qt.equals(i,qt.UNIT_W)?(o=e.boundingSphere.center,a=bs.wgs84To2DModelMatrix(r,o,vx),h=on.multiply(a,h,vx),Ze(e._rtcCenter)&&(on.setTranslation(h,qt.UNIT_W,h),e._rtcCenter=e._rtcCenter2D)):(h=bs.basisTo2D(r,h,vx),e._rtcCenter=e._rtcCenter3D));var f=on.clone(on.IDENTITY);e._upAxis===xn.Y?on.multiplyTransformation(f,xn.Y_UP_TO_Z_UP,f):e._upAxis===xn.X&&on.multiplyTransformation(f,xn.X_UP_TO_Z_UP,f),e.forwardAxis===xn.Z&&on.multiplyTransformation(f,xn.Z_UP_TO_X_UP,f);for(var p=0;p<l;++p){var d=u[p];for(_x(d,d.transformToRoot),c.push(d);0<c.length;){var m=(d=c.pop()).transformToRoot,_=d.commands;if(d.dirtyNumber===s||t||n){var g=on.clone(on.IDENTITY),g=Ze(d.gltfInstaced)&&d.gltfInstaced?on.multiplyTransformation(f,m,d.computedMatrix):on.multiplyTransformation(h,m,d.computedMatrix),y=_.length;if(0<y)for(var v=0;v<y;++v){var x=_[v],b=x.command;on.clone(g,b.modelMatrix),Ze(d.gltfInstaced)&&d.gltfInstaced||ko.transform(x.boundingSphere,b.modelMatrix,b.boundingVolume),Ze(e._rtcCenter)&&_t.add(e._rtcCenter,b.boundingVolume.center,b.boundingVolume.center),Ze(b=x.command2D)&&e._mode===Tl.SCENE2D&&(on.clone(g,b.modelMatrix),b.modelMatrix[13]-=2*pt.sign(b.modelMatrix[13])*pt.PI*r.ellipsoid.maximumRadius,ko.transform(x.boundingSphere,b.modelMatrix,b.boundingVolume))}}var E=d.children;if(Ze(E))for(var T=E.length,S=0;S<T;++S){var C=E[S];C.dirtyNumber=Math.max(C.dirtyNumber,d.dirtyNumber),C.dirtyNumber!==s&&!n||(_x(C,C.transformToRoot),on.multiplyTransformation(m,C.transformToRoot,C.transformToRoot)),c.push(C)}}}++e._maxDirtyNumber}(this,ge,Q,e.mapProjection),this._dirty=!0,(de||Q)&&function(e){for(var t=e._runtime.skinnedNodes,n=t.length,r=0;r<n;++r){var i=t[r];xx=on.inverseTransformation(i.transformToRoot,xx);for(var o=i.computedJointMatrices,a=i.joints,s=i.bindShapeMatrix,u=i.inverseBindMatrices,l=u.length,c=0;c<l;++c)Ze(o[c])||(o[c]=new on),o[c]=on.multiplyTransformation(xx,a[c].transformToRoot,o[c]),o[c]=on.multiplyTransformation(o[c],u[c],o[c]),Ze(s)&&(o[c]=on.multiplyTransformation(o[c],s,o[c]))}}(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,function(e){for(var t=e._runtime.rootNodes,n=t.length,r=gx,i=0;i<n;++i){var o=t[i];for(o.computedShow=o.publicNode.show,r.push(o);0<r.length;){for(var a=(o=r.pop()).computedShow,s=o.commands,u=s.length,l=0;l<u;++l)s[l].show=a;var c=o.children;if(Ze(c))for(var h=c.length,f=0;f<h;++f){var p=c[f];p.computedShow=a&&p.publicNode.show,r.push(p)}}}}(this)),function(e){var t=e.id;if(e._id!==t){e._id=t;for(var n=e._pickIds,r=n.length,i=0;i<r;++i)n[i].object.id=t}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Dn.LINES:Dn.TRIANGLES,n=e._nodeCommands,r=n.length,i=0;i<r;++i)n[i].command.primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e.debugShowBoundingVolume,n=e._nodeCommands,r=n.length,i=0;i<r;++i)n[i].command.debugShowBoundingVolume=t}}(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Cd.castShadows(e.shadows),n=Cd.receiveShadows(e.shadows),r=e._nodeCommands,i=r.length,o=0;o<i;o++){var a=r[o];a.command.castShadows=t,a.command.receiveShadows=n}}}(this),Pe=e,Ze(Oe=(Ie=this)._clippingPlanes)&&Oe.owner===Ie&&Oe.enabled&&Oe.update(Pe),be=0,Ee=Ze(xe=this._clippingPlanes)&&xe.enabled&&0<xe.length,Te=Ze(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,Se=Ze(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps,(Ee||Te||Se)&&(Ce=Je(this.clippingPlanesOriginMatrix,me),on.multiply(n.uniformState.view3D,Ce,this._clippingPlaneModelViewMatrix)),Ee&&(be=xe.clippingPlanesState),we=(we=this._shouldRegenerateShaders)||this._clippingPlanesState!==be,this._clippingPlanesState=be,(Ae=uv(this))!==this._colorShadingEnabled&&(this._colorShadingEnabled=Ae,we=!0),this._scene.ev_Fog&&this._enableFog!==this._scene.ev_Fog.enabled&&(we=!0,this._shouldRegenerateShaders=!0,this._enableFog=this._scene.ev_Fog.enabled),Ze(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.postUpdate(e,this),we?function(e,t){var n,r,i=e._rendererResources,o=e._cachedRendererResources;if(Gx(i,o),lv(e)||uv(e)||e._shouldRegenerateShaders){e._shouldRegenerateShaders=!1,i.programs={},i.silhouettePrograms={},Ze(e.ev_E3MInternalInstance)&&(e.ev_E3MInternalInstance._instancedUniformsByProgram=void 0);var a,s={},u=e._sourceTechniques;for(var l in u){u.hasOwnProperty(l)&&(r=u[l],n=r.program,s[n]||(s[n]=!0,a=e._sourcePrograms[n].name,Ze(e.ev_E3MInternalInstance)&&Ze(e.ev_E3MInternalInstance._tileset)&&Ze(a)&&e.instancedPrograms[a]?(e.instancedPrograms[a]=void 0,e.ev_E3MInternalInstance.regenerateShaders({programId:n,techniqueId:l},e,t.context)):Fv({programId:n,techniqueId:l},e,t.context)))}}else i.programs=o.programs,i.silhouettePrograms=o.silhouettePrograms;for(var c=i.programs,h=e._nodeCommands,f=h.length,p=0;p<f;++p){var d=h[p];n=d.programId;var m=c[n];d.command.shaderProgram=m,Ze(d.command2D)&&(d.command2D.shaderProgram=m)}Ex(e,t,!0),Lx(e,t,!0)}(this,e):(Ex(this,e,!1),Lx(this,e,!1))),Q){var Fe=this;e.afterRender.push(function(){Fe._ready=!0,Fe._readyPromise.resolve(Fe)})}else{if(Me&&!this._ignoreCommands){var ze,Be,Ue,Ve,ke,Ge=e.commandList,qe=e.passes,He=this._nodeCommands,We=He.length,Ye=e.mapProjection.ellipsoid.maximumRadius*pt.PI;if(qe.render||qe.pick&&this.allowPicking){for(ze=0;ze<We;++ze){(ke=He[ze]).show&&(Ve=Ne?ke.translucentCommand:ke.command,Ve=Le?ke.silhouetteModelCommand:Ve,Ge.push(Ve),Be=ke.command.boundingVolume,e.mode===Tl.SCENE2D&&(Be.center.y+Be.radius>Ye||Be.center.y-Be.radius<Ye)&&(Ue=Ne?ke.translucentCommand2D:ke.command2D,Ue=Le?ke.silhouetteModelCommand2D:Ue,Ge.push(Ue)))}if(Le&&!qe.pick)for(ze=0;ze<We;++ze)(ke=He[ze]).show&&(Ge.push(ke.silhouetteColorCommand),Be=ke.command.boundingVolume,e.mode===Tl.SCENE2D&&(Be.center.y+Be.radius>Ye||Be.center.y-Be.radius<Ye)&&Ge.push(ke.silhouetteColorCommand2D))}}var Xe=this._credit;Ze(Xe)&&e.creditDisplay.addCredit(Xe);for(var je=this._resourceCredits,Ke=je.length,Qe=0;Qe<Ke;Qe++)e.creditDisplay.addCredit(je[Qe])}}else et.supportsWebP.initialize()},av.prototype.isDestroyed=function(){return!1},av.prototype.destroy=function(){Ze(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.destroy(),Ze(this._precreatedAttributes)&&Bx(this._rendererResources.vertexArrays),Ze(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),Ze(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),Ze(this._cachedRendererResources)&&Gx(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),yp.destroyCachedDataForModel(this);for(var e=this._pickIds,t=e.length,n=0;n<t;++n)e[n].destroy();Fx(this),this._quantizedVertexShaders=void 0;var r=this._clippingPlanes;return Ze(r)&&!r.isDestroyed()&&r.owner===this&&r.destroy(),this._clippingPlanes=void 0,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._nodeCommands.length=0,this.meshPrimitives.length=0,this.ktxs=void 0,this.instancedPrograms=void 0,this.gltfShader=void 0,Vt(this)},av._getClippingFunction=wp,av._modifyShaderForColor=function(e){return e=Xr.replaceMain(e,"gltf_blend_main"),e+="uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight = ceil(gltf_colorBlend); \n    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *= gltf_color.a; \n} \n"},qx._deprecationWarning=Bt,Object.defineProperties(qx.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var Hx=Uint32Array.BYTES_PER_ELEMENT;function Wx(u){return function(e,t){var n,r,i=u._batchTable,o=!Ze(u._tileset.classificationType),a=u._model.gltf;Ze(a)&&(u._batchIdAttributeName=(n=a,Ze(r=Hu.getAttributeOrUniformBySemantic(n,"_BATCHID"))||Ze(r=Hu.getAttributeOrUniformBySemantic(n,"BATCHID"))&&qx._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`."),r),u._diffuseAttributeOrUniformName[t]=Hu.getDiffuseAttributeOrUniform(a,t));var s=i.getVertexShaderCallback(o,u._batchIdAttributeName,u._diffuseAttributeOrUniformName[t]);return Ze(s)?s(e):e}}function Yx(e){return function(){return e._batchTable.getPickId()}}function Xx(e){this.planes=Je(e,[])}qx.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},qx.prototype.getFeature=function(e){return function(e){var t=e.featuresLength;if(!Ze(e._features)&&0<t){for(var n=new Array(t),r=0;r<t;++r)n[r]=new Fo(e,r);e._features=n}}(this),this._features[e]},qx.prototype.applyDebugSettings=function(e,t){t=e?t:It.WHITE,0===this.featuresLength?this._model.color=t:this._batchTable.setAllColor(t)},qx.prototype.applyStyle=function(e){var t,n;0===this.featuresLength?(t=Ze(e)&&Ze(e.color),n=Ze(e)&&Ze(e.show),this._model.color=t?e.color.evaluateColor(void 0,this._model.color):It.clone(It.WHITE,this._model.color),this._model.show=!n||e.show.evaluate(void 0)):this._batchTable.applyStyle(e),Ze(this._model.ev_E3MInternalInstance)&&this._model.ev_E3MInternalInstance.applyStyle(e)},qx.prototype.update=function(e,t){var n=t.commandList.length;this._batchTable.update(e,t),Ze(this._model.ev_E3MInternalInstance)&&this._model.ev_E3MInternalInstance.cesium3DTileBatchTableUpdate(e,t),this._contentModelMatrix=on.multiply(this._tile.computedTransform,this._rtcCenterTransform,this._contentModelMatrix),this._model.modelMatrix=this._contentModelMatrix,this._model.shadows=this._tileset.shadows,this._model.imageBasedLightingFactor=this._tileset.imageBasedLightingFactor,this._model.lightColor=this._tileset.lightColor,this._model.luminanceAtZenith=this._tileset.luminanceAtZenith,this._model.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._model.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._model.debugWireframe=this._tileset.debugWireframe,this._model.gltfShader=this._tileset.gltfShader;var r=this._tileset.clippingPlanes;this._model.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Ze(r)&&this._tile.clippingPlanesDirty&&(this._model._clippingPlanes=r.enabled&&this._tile._isClipped?r:void 0),Ze(r)&&Ze(this._model._clippingPlanes)&&this._model._clippingPlanes!==r&&(this._model._clippingPlanes=r),this._model.update(t),n<t.commandList.length&&(t.passes.render||t.passes.pick)&&!Ze(e.classificationType)&&this._batchTable.addDerivedCommands(t,n);for(var i=0;i<t.commandList.length;++i){t.commandList[i].dirty=this.useHdr!==t.camera._scene._hdr}this.useHdr=t.camera._scene._hdr},qx.prototype.isDestroyed=function(){return!1},qx.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)};var jx=[new _t,new _t,new _t];_t.clone(_t.UNIT_X,jx[0]),_t.clone(_t.UNIT_Y,jx[1]),_t.clone(_t.UNIT_Z,jx[2]);var Kx=new _t,Qx=new _t,Zx=new Zf(new _t(1,0,0),0);function Jx(e,t,n){this.minimum=_t.clone(Je(e,_t.ZERO)),this.maximum=_t.clone(Je(t,_t.ZERO)),n=Ze(n)?_t.clone(n):_t.midpoint(this.minimum,this.maximum,new _t),this.center=n}Xx.fromBoundingSphere=function(e,t){Ze(t)||(t=new Xx);var n=jx.length,r=t.planes;r.length=2*n;for(var i=e.center,o=e.radius,a=0,s=0;s<n;++s){var u=jx[s],l=r[a],c=r[a+1];Ze(l)||(l=r[a]=new qt),Ze(c)||(c=r[a+1]=new qt),_t.multiplyByScalar(u,-o,Kx),_t.add(i,Kx,Kx),l.x=u.x,l.y=u.y,l.z=u.z,l.w=-_t.dot(u,Kx),_t.multiplyByScalar(u,o,Kx),_t.add(i,Kx,Kx),c.x=-u.x,c.y=-u.y,c.z=-u.z,c.w=-_t.dot(_t.negate(u,Qx),Kx),a+=2}return t},Xx.prototype.computeVisibility=function(e){for(var t=this.planes,n=!1,r=0,i=t.length;r<i;++r){var o=e.intersectPlane(Zf.fromCartesian4(t[r],Zx));if(o===Jn.OUTSIDE)return Jn.OUTSIDE;o===Jn.INTERSECTING&&(n=!0)}return n?Jn.INTERSECTING:Jn.INSIDE},Xx.prototype.computeVisibilityWithPlaneMask=function(e,t){if(t===Xx.MASK_OUTSIDE||t===Xx.MASK_INSIDE)return t;for(var n=Xx.MASK_INSIDE,r=this.planes,i=0,o=r.length;i<o;++i){var a=i<31?1<<i:0;if(!(i<31&&0==(t&a))){var s=e.intersectPlane(Zf.fromCartesian4(r[i],Zx));if(s===Jn.OUTSIDE)return Xx.MASK_OUTSIDE;s===Jn.INTERSECTING&&(n|=a)}}return n},Xx.MASK_OUTSIDE=4294967295,Xx.MASK_INSIDE=0,Xx.MASK_INDETERMINATE=2147483647,Jx.fromPoints=function(e,t){if(Ze(t)||(t=new Jx),!Ze(e)||0===e.length)return t.minimum=_t.clone(_t.ZERO,t.minimum),t.maximum=_t.clone(_t.ZERO,t.maximum),t.center=_t.clone(_t.ZERO,t.center),t;for(var n=e[0].x,r=e[0].y,i=e[0].z,o=e[0].x,a=e[0].y,s=e[0].z,u=e.length,l=1;l<u;l++)var c=e[l],h=c.x,f=c.y,p=c.z,n=Math.min(h,n),o=Math.max(h,o),r=Math.min(f,r),a=Math.max(f,a),i=Math.min(p,i),s=Math.max(p,s);var d=t.minimum;d.x=n,d.y=r,d.z=i;var m=t.maximum;return m.x=o,m.y=a,m.z=s,t.center=_t.midpoint(d,m,t.center),t},Jx.clone=function(e,t){if(Ze(e))return Ze(t)?(t.minimum=_t.clone(e.minimum,t.minimum),t.maximum=_t.clone(e.maximum,t.maximum),t.center=_t.clone(e.center,t.center),t):new Jx(e.minimum,e.maximum,e.center)},Jx.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&_t.equals(e.center,t.center)&&_t.equals(e.minimum,t.minimum)&&_t.equals(e.maximum,t.maximum)};var $x=new _t;Jx.intersectPlane=function(e,t){$x=_t.subtract(e.maximum,e.minimum,$x);var n=_t.multiplyByScalar($x,.5,$x),r=t.normal,i=n.x*Math.abs(r.x)+n.y*Math.abs(r.y)+n.z*Math.abs(r.z),o=_t.dot(e.center,r)+t.distance;return 0<o-i?Jn.INSIDE:o+i<0?Jn.OUTSIDE:Jn.INTERSECTING},Jx.prototype.clone=function(e){return Jx.clone(this,e)},Jx.prototype.intersectPlane=function(e){return Jx.intersectPlane(this,e)},Jx.prototype.equals=function(e){return Jx.equals(this,e)};var eb=new qt;function tb(e,t){e=(t=Je(t,Wn.WGS84)).scaleToGeodeticSurface(e);var n=bs.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=_t.fromCartesian4(on.getColumn(n,0,eb)),this._yAxis=_t.fromCartesian4(on.getColumn(n,1,eb));var r=_t.fromCartesian4(on.getColumn(n,2,eb));this._plane=Zf.fromPointNormal(e,r)}Object.defineProperties(tb.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var nb=new Jx;tb.fromPoints=function(e,t){return new tb(Jx.fromPoints(e,nb).center,t)};var rb=new ym,ib=new _t;tb.prototype.projectPointOntoPlane=function(e,t){var n=rb;n.origin=e,_t.normalize(e,n.direction);var r=vm.rayPlane(n,this._plane,ib);if(Ze(r)||(_t.negate(n.direction,n.direction),r=vm.rayPlane(n,this._plane,ib)),Ze(r)){var i=_t.subtract(r,this._origin,r),o=_t.dot(this._xAxis,i),a=_t.dot(this._yAxis,i);return Ze(t)?(t.x=o,t.y=a,t):new En(o,a)}},tb.prototype.projectPointsOntoPlane=function(e,t){Ze(t)||(t=[]);for(var n=0,r=e.length,i=0;i<r;i++){var o=this.projectPointOntoPlane(e[i],t[n]);Ze(o)&&(t[n]=o,n++)}return t.length=n,t},tb.prototype.projectPointToNearestOnPlane=function(e,t){Ze(t)||(t=new En);var n=rb;n.origin=e,_t.clone(this._plane.normal,n.direction);var r=vm.rayPlane(n,this._plane,ib);Ze(r)||(_t.negate(n.direction,n.direction),r=vm.rayPlane(n,this._plane,ib));var i=_t.subtract(r,this._origin,r),o=_t.dot(this._xAxis,i),a=_t.dot(this._yAxis,i);return t.x=o,t.y=a,t},tb.prototype.projectPointsToNearestOnPlane=function(e,t){Ze(t)||(t=[]);var n=e.length;t.length=n;for(var r=0;r<n;r++)t[r]=this.projectPointToNearestOnPlane(e[r],t[r]);return t};var ob=new _t;function ab(e,t){this.center=_t.clone(Je(e,_t.ZERO)),this.halfAxes=jt.clone(Je(t,jt.ZERO))}tb.prototype.projectPointOntoEllipsoid=function(e,t){Ze(t)||(t=new _t);var n=this._ellipsoid,r=this._origin,i=this._xAxis,o=this._yAxis,a=ob;return _t.multiplyByScalar(i,e.x,a),t=_t.add(r,a,t),_t.multiplyByScalar(o,e.y,a),_t.add(t,a,t),n.scaleToGeocentricSurface(t,t),t},tb.prototype.projectPointsOntoEllipsoid=function(e,t){var n=e.length;Ze(t)?t.length=n:t=new Array(n);for(var r=0;r<n;++r)t[r]=this.projectPointOntoEllipsoid(e[r],t[r]);return t},ab.packedLength=_t.packedLength+jt.packedLength,ab.pack=function(e,t,n){return n=Je(n,0),_t.pack(e.center,t,n),jt.pack(e.halfAxes,t,n+_t.packedLength),t},ab.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new ab),_t.unpack(e,t,n.center),jt.unpack(e,t+_t.packedLength,n.halfAxes),n};var sb=new _t,ub=new _t,lb=new _t,cb=new _t,hb=new _t,fb=new _t,pb=new jt,db={unitary:new jt,diagonal:new jt};ab.fromPoints=function(e,t){if(Ze(t)||(t=new ab),!Ze(e)||0===e.length)return t.halfAxes=jt.ZERO,t.center=_t.ZERO,t;for(var n=e.length,r=_t.clone(e[0],sb),i=1;i<n;i++)_t.add(r,e[i],r);var o=1/n;_t.multiplyByScalar(r,o,r);var a,s=0,u=0,l=0,c=0,h=0,f=0;for(i=0;i<n;i++)s+=(a=_t.subtract(e[i],r,ub)).x*a.x,u+=a.x*a.y,l+=a.x*a.z,c+=a.y*a.y,h+=a.y*a.z,f+=a.z*a.z;s*=o,u*=o,l*=o,c*=o,h*=o,f*=o;var p=pb;p[0]=s,p[1]=u,p[2]=l,p[3]=u,p[4]=c,p[5]=h,p[6]=l,p[7]=h,p[8]=f;var d=jt.computeEigenDecomposition(p,db),m=jt.clone(d.unitary,t.halfAxes),_=jt.getColumn(m,0,cb),g=jt.getColumn(m,1,hb),y=jt.getColumn(m,2,fb),v=-Number.MAX_VALUE,x=-Number.MAX_VALUE,b=-Number.MAX_VALUE,E=Number.MAX_VALUE,T=Number.MAX_VALUE,S=Number.MAX_VALUE;for(i=0;i<n;i++)a=e[i],v=Math.max(_t.dot(_,a),v),x=Math.max(_t.dot(g,a),x),b=Math.max(_t.dot(y,a),b),E=Math.min(_t.dot(_,a),E),T=Math.min(_t.dot(g,a),T),S=Math.min(_t.dot(y,a),S);_=_t.multiplyByScalar(_,.5*(E+v),_),g=_t.multiplyByScalar(g,.5*(T+x),g),y=_t.multiplyByScalar(y,.5*(S+b),y);var C=_t.add(_,g,t.center);_t.add(C,y,C);var w=lb;return w.x=v-E,w.y=x-T,w.z=b-S,_t.multiplyByScalar(w,.5,w),jt.multiplyByScale(t.halfAxes,w,t.halfAxes),t};var mb=new _t,_b=new _t;function gb(e,t,n,r,i,o,a,s,u,l,c){Ze(c)||(c=new ab);var h=c.halfAxes;jt.setColumn(h,0,t,h),jt.setColumn(h,1,n,h),jt.setColumn(h,2,r,h),(d=mb).x=(i+o)/2,d.y=(a+s)/2,d.z=(u+l)/2;var f=_b;f.x=(o-i)/2,f.y=(s-a)/2,f.z=(l-u)/2;var p=c.center,d=jt.multiplyByVector(h,d,d);return _t.add(e,d,p),jt.multiplyByScale(h,f,h),c}var yb=new Un,vb=new _t,xb=new Un,bb=new Un,Eb=new Un,Tb=new Un,Sb=new Un,Cb=new _t,wb=new _t,Ab=new _t,Ib=new _t,Pb=new _t,Ob=new En,Lb=new En,Nb=new En,Rb=new En,Db=new En,Mb=new _t,Fb=new _t,zb=new _t,Bb=new _t,Ub=new En,Vb=new _t,kb=new _t,Gb=new _t,qb=new Zf(_t.UNIT_X,0);ab.fromRectangle=function(e,t,n,r,i){if(t=Je(t,0),n=Je(n,0),r=Je(r,Wn.WGS84),e.width<=pt.PI){var o,a=$n.center(e,yb),s=new tb(r.cartographicToCartesian(a,vb),r),u=s.plane,l=a.longitude,c=e.south<0&&0<e.north?0:a.latitude,h=Un.fromRadians(l,e.north,n,xb),f=Un.fromRadians(e.west,e.north,n,bb),p=Un.fromRadians(e.west,c,n,Eb),d=Un.fromRadians(e.west,e.south,n,Tb),m=Un.fromRadians(l,e.south,n,Sb),_=r.cartographicToCartesian(h,Cb),g=r.cartographicToCartesian(f,wb),y=r.cartographicToCartesian(p,Ab),v=r.cartographicToCartesian(d,Ib),x=r.cartographicToCartesian(m,Pb),b=s.projectPointToNearestOnPlane(_,Ob),E=s.projectPointToNearestOnPlane(g,Lb),T=s.projectPointToNearestOnPlane(y,Nb),S=s.projectPointToNearestOnPlane(v,Rb),C=s.projectPointToNearestOnPlane(x,Db),w=-(o=Math.min(E.x,T.x,S.x)),A=Math.max(E.y,b.y),I=Math.min(S.y,C.y);return f.height=d.height=t,g=r.cartographicToCartesian(f,wb),v=r.cartographicToCartesian(d,Ib),B=Math.min(Zf.getPointDistance(u,g),Zf.getPointDistance(u,v)),U=n,gb(s.origin,s.xAxis,s.yAxis,s.zAxis,o,w,I,A,B,U,i)}var P=0<e.south,O=e.north<0,L=P?e.south:O?e.north:0,N=$n.center(e,yb).longitude,R=_t.fromRadians(N,L,n,r,Mb);R.z=0;var D=Math.abs(R.x)<pt.EPSILON10&&Math.abs(R.y)<pt.EPSILON10?_t.UNIT_X:_t.normalize(R,Fb),M=_t.UNIT_Z,F=_t.cross(D,M,zb);u=Zf.fromPointNormal(R,D,qb);var z=_t.fromRadians(N+pt.PI_OVER_TWO,L,n,r,Bb);o=-(w=_t.dot(Zf.projectPointOntoPlane(u,z,Ub),F)),A=_t.fromRadians(0,e.north,O?t:n,r,Vb).z,I=_t.fromRadians(0,e.south,P?t:n,r,kb).z;var B,U,V=_t.fromRadians(e.east,L,n,r,Gb);return gb(R,F,M,D,o,w,I,A,B=Zf.getPointDistance(u,V),U=0,i)},ab.clone=function(e,t){if(Ze(e))return Ze(t)?(_t.clone(e.center,t.center),jt.clone(e.halfAxes,t.halfAxes),t):new ab(e.center,e.halfAxes)},ab.intersectPlane=function(e,t){var n=e.center,r=t.normal,i=e.halfAxes,o=r.x,a=r.y,s=r.z,u=Math.abs(o*i[jt.COLUMN0ROW0]+a*i[jt.COLUMN0ROW1]+s*i[jt.COLUMN0ROW2])+Math.abs(o*i[jt.COLUMN1ROW0]+a*i[jt.COLUMN1ROW1]+s*i[jt.COLUMN1ROW2])+Math.abs(o*i[jt.COLUMN2ROW0]+a*i[jt.COLUMN2ROW1]+s*i[jt.COLUMN2ROW2]),l=_t.dot(r,n)+t.distance;return l<=-u?Jn.OUTSIDE:u<=l?Jn.INSIDE:Jn.INTERSECTING};var Hb=new _t,Wb=new _t,Yb=new _t,Xb=new _t;ab.distanceSquaredTo=function(e,t){var n=_t.subtract(t,e.center,mb),r=e.halfAxes,i=jt.getColumn(r,0,Hb),o=jt.getColumn(r,1,Wb),a=jt.getColumn(r,2,Yb),s=_t.magnitude(i),u=_t.magnitude(o),l=_t.magnitude(a);_t.normalize(i,i),_t.normalize(o,o),_t.normalize(a,a);var c=Xb;c.x=_t.dot(n,i),c.y=_t.dot(n,o),c.z=_t.dot(n,a);var h,f=0;return c.x<-s?f+=(h=c.x+s)*h:c.x>s&&(f+=(h=c.x-s)*h),c.y<-u?f+=(h=c.y+u)*h:c.y>u&&(f+=(h=c.y-u)*h),c.z<-l?f+=(h=c.z+l)*h:c.z>l&&(f+=(h=c.z-l)*h),f};var jb=new _t,Kb=new _t;ab.computePlaneDistances=function(e,t,n,r){Ze(r)||(r=new Vo);var i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=e.center,s=e.halfAxes,u=jt.getColumn(s,0,Hb),l=jt.getColumn(s,1,Wb),c=jt.getColumn(s,2,Yb),h=_t.add(u,l,jb);_t.add(h,c,h),_t.add(h,a,h);var f=_t.subtract(h,t,Kb),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o);return _t.add(a,u,h),_t.add(h,l,h),_t.subtract(h,c,h),_t.subtract(h,t,f),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o),_t.add(a,u,h),_t.subtract(h,l,h),_t.add(h,c,h),_t.subtract(h,t,f),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o),_t.add(a,u,h),_t.subtract(h,l,h),_t.subtract(h,c,h),_t.subtract(h,t,f),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o),_t.subtract(a,u,h),_t.add(h,l,h),_t.add(h,c,h),_t.subtract(h,t,f),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o),_t.subtract(a,u,h),_t.add(h,l,h),_t.subtract(h,c,h),_t.subtract(h,t,f),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o),_t.subtract(a,u,h),_t.subtract(h,l,h),_t.add(h,c,h),_t.subtract(h,t,f),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o),_t.subtract(a,u,h),_t.subtract(h,l,h),_t.subtract(h,c,h),_t.subtract(h,t,f),p=_t.dot(n,f),i=Math.min(p,i),o=Math.max(p,o),r.start=i,r.stop=o,r};var Qb=new ko;function Zb(e){e=Je(e,Je.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=Je(e.near,1),this._near=this.near,this.far=Je(e.far,5e8),this._far=this.far,this._cullingVolume=new Xx,this._orthographicMatrix=new on}function Jb(e){e.top===e._top&&e.bottom===e._bottom&&e.left===e._left&&e.right===e._right&&e.near===e._near&&e.far===e._far||(e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=on.computeOrthographicOffCenter(e.left,e.right,e.bottom,e.top,e.near,e.far,e._orthographicMatrix))}ab.isOccluded=function(e,t){var n=ko.fromOrientedBoundingBox(e,Qb);return!t.isBoundingSphereVisible(n)},ab.prototype.intersectPlane=function(e){return ab.intersectPlane(this,e)},ab.prototype.distanceSquaredTo=function(e){return ab.distanceSquaredTo(this,e)},ab.prototype.computePlaneDistances=function(e,t,n){return ab.computePlaneDistances(this,e,t,n)},ab.prototype.isOccluded=function(e){return ab.isOccluded(this,e)},ab.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&_t.equals(e.center,t.center)&&jt.equals(e.halfAxes,t.halfAxes)},ab.prototype.clone=function(e){return ab.clone(this,e)},ab.prototype.equals=function(e){return ab.equals(this,e)},Object.defineProperties(Zb.prototype,{projectionMatrix:{get:function(){return Jb(this),this._orthographicMatrix}}});var $b=new _t,eE=new _t,tE=new _t,nE=new _t;function rE(e){e=Je(e,Je.EMPTY_OBJECT),this._offCenterFrustum=new Zb,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=Je(e.near,1),this._near=this.near,this.far=Je(e.far,5e8),this._far=this.far}function iE(e){var t,n=e._offCenterFrustum;e.width===e._width&&e.aspectRatio===e._aspectRatio&&e.near===e._near&&e.far===e._far||(e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far,t=1/e.aspectRatio,n.right=.5*e.width,n.left=-n.right,n.top=t*n.right,n.bottom=-n.top,n.near=e.near,n.far=e.far)}function oE(e,t,n,r,i,o){this._tileset=e,this._tile=t,this._resource=n,this._contents=[],this._readyPromise=D.defer(),function(t,e,n,r){n=Je(n,0);var i=new Uint8Array(e),o=new DataView(e);n+=aE;var a=o.getUint32(n,!0);if(1!==a)throw new de("Only Composite Tile version 1 is supported. Version "+a+" is not.");n+=aE,n+=aE;var s=o.getUint32(n,!0);n+=aE;for(var u=[],l=0;l<s;++l){var c=du(i,n),h=o.getUint32(n+2*aE,!0),f=r[c];if(!Ze(f))throw new de("Unknown tile content type, "+c+", inside Composite tile");var p=f(t._tileset,t._tile,t._resource,e,n);t._contents.push(p),u.push(p.readyPromise),n+=h}D.all(u).then(function(){t._readyPromise.resolve(t)}).otherwise(function(e){t._readyPromise.reject(e)})}(this,r,i,o)}Zb.prototype.computeCullingVolume=function(e,t,n){var r=this._cullingVolume.planes,i=this.top,o=this.bottom,a=this.right,s=this.left,u=this.near,l=this.far,c=_t.cross(t,n,$b);_t.normalize(c,c);var h=eE;_t.multiplyByScalar(t,u,h),_t.add(e,h,h);var f=tE;_t.multiplyByScalar(c,s,f),_t.add(h,f,f);var p=r[0];return Ze(p)||(p=r[0]=new qt),p.x=c.x,p.y=c.y,p.z=c.z,p.w=-_t.dot(c,f),_t.multiplyByScalar(c,a,f),_t.add(h,f,f),Ze(p=r[1])||(p=r[1]=new qt),p.x=-c.x,p.y=-c.y,p.z=-c.z,p.w=-_t.dot(_t.negate(c,nE),f),_t.multiplyByScalar(n,o,f),_t.add(h,f,f),Ze(p=r[2])||(p=r[2]=new qt),p.x=n.x,p.y=n.y,p.z=n.z,p.w=-_t.dot(n,f),_t.multiplyByScalar(n,i,f),_t.add(h,f,f),Ze(p=r[3])||(p=r[3]=new qt),p.x=-n.x,p.y=-n.y,p.z=-n.z,p.w=-_t.dot(_t.negate(n,nE),f),Ze(p=r[4])||(p=r[4]=new qt),p.x=t.x,p.y=t.y,p.z=t.z,p.w=-_t.dot(t,h),_t.multiplyByScalar(t,l,f),_t.add(e,f,f),Ze(p=r[5])||(p=r[5]=new qt),p.x=-t.x,p.y=-t.y,p.z=-t.z,p.w=-_t.dot(_t.negate(t,nE),f),this._cullingVolume},Zb.prototype.getPixelDimensions=function(e,t,n,r,i){Jb(this);var o=r*(this.right-this.left)/e,a=r*(this.top-this.bottom)/t;return i.x=o,i.y=a,i},Zb.prototype.clone=function(e){return Ze(e)||(e=new Zb),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e},Zb.prototype.equals=function(e){return Ze(e)&&e instanceof Zb&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far},Zb.prototype.equalsEpsilon=function(e,t,n){return e===this||Ze(e)&&e instanceof Zb&&pt.equalsEpsilon(this.right,e.right,t,n)&&pt.equalsEpsilon(this.left,e.left,t,n)&&pt.equalsEpsilon(this.top,e.top,t,n)&&pt.equalsEpsilon(this.bottom,e.bottom,t,n)&&pt.equalsEpsilon(this.near,e.near,t,n)&&pt.equalsEpsilon(this.far,e.far,t,n)},rE.packedLength=4,rE.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.width,t[n++]=e.aspectRatio,t[n++]=e.near,t[n]=e.far,t},rE.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new rE),n.width=e[t++],n.aspectRatio=e[t++],n.near=e[t++],n.far=e[t],n},Object.defineProperties(rE.prototype,{projectionMatrix:{get:function(){return iE(this),this._offCenterFrustum.projectionMatrix}}}),rE.prototype.computeCullingVolume=function(e,t,n){return iE(this),this._offCenterFrustum.computeCullingVolume(e,t,n)},rE.prototype.getPixelDimensions=function(e,t,n,r,i){return iE(this),this._offCenterFrustum.getPixelDimensions(e,t,n,r,i)},rE.prototype.clone=function(e){return Ze(e)||(e=new rE),e.aspectRatio=this.aspectRatio,e.width=this.width,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._width=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e},rE.prototype.equals=function(e){return!!(Ze(e)&&e instanceof rE)&&(iE(this),iE(e),this.width===e.width&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))},rE.prototype.equalsEpsilon=function(e,t,n){return!!(Ze(e)&&e instanceof rE)&&(iE(this),iE(e),pt.equalsEpsilon(this.width,e.width,t,n)&&pt.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,n)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,n))},Object.defineProperties(oE.prototype,{featurePropertiesDirty:{get:function(){for(var e=this._contents,t=e.length,n=0;n<t;++n)if(e[n].featurePropertiesDirty)return!0;return!1},set:function(e){for(var t=this._contents,n=t.length,r=0;r<n;++r)t[r].featurePropertiesDirty=e}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});var aE=Uint32Array.BYTES_PER_ELEMENT;function sE(e){this._boxes=e.boxes,this._boxBatchIds=e.boxBatchIds,this._cylinders=e.cylinders,this._cylinderBatchIds=e.cylinderBatchIds,this._ellipsoids=e.ellipsoids,this._ellipsoidBatchIds=e.ellipsoidBatchIds,this._spheres=e.spheres,this._sphereBatchIds=e.sphereBatchIds,this._modelMatrix=e.modelMatrix,this._batchTable=e.batchTable,this._boundingVolume=e.boundingVolume,this._center=e.center,Ze(this._center)||(Ze(this._boundingVolume)?this._center=_t.clone(this._boundingVolume.center):this._center=_t.clone(_t.ZERO)),this._boundingVolumes=void 0,this._batchedIndices=void 0,this._indices=void 0,this._indexOffsets=void 0,this._indexCounts=void 0,this._positions=void 0,this._vertexBatchIds=void 0,this._batchIds=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=D.defer(),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Uc.BOTH}oE.prototype.hasProperty=function(e,t){return!1},oE.prototype.getFeature=function(e){},oE.prototype.applyDebugSettings=function(e,t){for(var n=this._contents,r=n.length,i=0;i<r;++i)n[i].applyDebugSettings(e,t)},oE.prototype.applyStyle=function(e){for(var t=this._contents,n=t.length,r=0;r<n;++r)t[r].applyStyle(e)},oE.prototype.update=function(e,t){for(var n=this._contents,r=n.length,i=0;i<r;++i)n[i].update(e,t)},oE.prototype.isDestroyed=function(){return!1},oE.prototype.destroy=function(){for(var e=this._contents,t=e.length,n=0;n<t;++n)e[n].destroy();return Vt(this)},Object.defineProperties(sE.prototype,{trianglesLength:{get:function(){return Ze(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return Ze(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}}),sE.packedBoxLength=on.packedLength+_t.packedLength,sE.packedCylinderLength=on.packedLength+2,sE.packedEllipsoidLength=on.packedLength+_t.packedLength,sE.packedSphereLength=_t.packedLength+1;var uE=new Df("createVectorTileGeometries"),lE=new It;function cE(r){if(!Ze(r._primitive)){if(!Ze(r._verticesPromise)){var e=r._boxes,t=r._boxBatchIds,n=r._cylinders,i=r._cylinderBatchIds,o=r._ellipsoids,a=r._ellipsoidBatchIds,s=r._spheres,u=r._sphereBatchIds,l=r._batchTableColors,c=r._packedBuffer;if(!Ze(l)){var h=0;Ze(r._boxes)&&(e=r._boxes=Uo(e),h+=(t=r._boxBatchIds=Uo(t)).length),Ze(r._cylinders)&&(n=r._cylinders=Uo(n),h+=(i=r._cylinderBatchIds=Uo(i)).length),Ze(r._ellipsoids)&&(o=r._ellipsoids=Uo(o),h+=(a=r._ellipsoidBatchIds=Uo(a)).length),Ze(r._spheres)&&(s=r._sphere=Uo(s),h+=(u=r._sphereBatchIds=Uo(u)).length),l=r._batchTableColors=new Uint32Array(h);for(var f=r._batchTable,p=0;p<h;++p){var d=f.getColor(p,lE);l[p]=d.toRgba()}c=r._packedBuffer=(y=r,v=new Float64Array(on.packedLength+_t.packedLength),x=0,_t.pack(y._center,v,x),x+=_t.packedLength,on.pack(y._modelMatrix,v,x),v)}var m=[];Ze(e)&&m.push(e.buffer,t.buffer),Ze(n)&&m.push(n.buffer,i.buffer),Ze(o)&&m.push(o.buffer,a.buffer),Ze(s)&&m.push(s.buffer,u.buffer),m.push(l.buffer,c.buffer);var _={boxes:Ze(e)?e.buffer:void 0,boxBatchIds:Ze(e)?t.buffer:void 0,cylinders:Ze(n)?n.buffer:void 0,cylinderBatchIds:Ze(n)?i.buffer:void 0,ellipsoids:Ze(o)?o.buffer:void 0,ellipsoidBatchIds:Ze(o)?a.buffer:void 0,spheres:Ze(s)?s.buffer:void 0,sphereBatchIds:Ze(s)?u.buffer:void 0,batchTableColors:l.buffer,packedBuffer:c.buffer},g=r._verticesPromise=uE.scheduleTask(_,m);if(!Ze(g))return;g.then(function(e){var t=new Float64Array(e.packedBuffer),n=function(e,t){for(var n=0,r=t[n++],i=t[n++],o=e._boundingVolumes=new Array(i),a=0;a<i;++a)o[a]=ko.unpack(t,n),n+=ko.packedLength;for(var s=t[n++],u=e._batchedIndices=new Array(s),l=0;l<s;++l){var c=It.unpack(t,n);n+=It.packedLength;for(var h=t[n++],f=t[n++],p=t[n++],d=new Array(p),m=0;m<p;++m)d[m]=t[n++];u[l]=new Sl({color:c,offset:h,count:f,batchIds:d})}return r}(r,t);r._indices=new(2===n?Uint16Array:Uint32Array)(e.indices),r._indexOffsets=new Uint32Array(e.indexOffsets),r._indexCounts=new Uint32Array(e.indexCounts),r._positions=new Float32Array(e.positions),r._vertexBatchIds=new Uint16Array(e.vertexBatchIds),r._batchIds=new Uint16Array(e.batchIds),r._ready=!0})}var y,v,x;r._ready&&!Ze(r._primitive)&&(r._primitive=new Ih({batchTable:r._batchTable,positions:r._positions,batchIds:r._batchIds,vertexBatchIds:r._vertexBatchIds,indices:r._indices,indexOffsets:r._indexOffsets,indexCounts:r._indexCounts,batchedIndices:r._batchedIndices,boundingVolume:r._boundingVolume,boundingVolumes:r._boundingVolumes,center:r._center,pickObject:Je(r._pickObject,r)}),r._boxes=void 0,r._boxBatchIds=void 0,r._cylinders=void 0,r._cylinderBatchIds=void 0,r._ellipsoids=void 0,r._ellipsoidBatchIds=void 0,r._spheres=void 0,r._sphereBatchIds=void 0,r._center=void 0,r._modelMatrix=void 0,r._batchTable=void 0,r._boundingVolume=void 0,r._boundingVolumes=void 0,r._batchedIndices=void 0,r._indices=void 0,r._indexOffsets=void 0,r._indexCounts=void 0,r._positions=void 0,r._vertexBatchIds=void 0,r._batchIds=void 0,r._batchTableColors=void 0,r._packedBuffer=void 0,r._verticesPromise=void 0,r._readyPromise.resolve())}}function hE(e,t,n,r,i){this._tileset=e,this._tile=t,this._resource=n,this._geometries=void 0,this._contentReadyPromise=void 0,this._readyPromise=D.defer(),this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,function(e,t,n){n=Je(n,0);var r=new Uint8Array(t),i=new DataView(t);n+=fE;var o=i.getUint32(n,!0);if(1!==o)throw new de("Only Geometry tile version 1 is supported.  Version "+o+" is not.");n+=fE;var a=i.getUint32(n,!0);if(n+=fE,0===a)return e._readyPromise.resolve(e);var s=i.getUint32(n,!0);if(n+=fE,0===s)throw new de("Feature table must have a byte length greater than zero");var u=i.getUint32(n,!0);n+=fE;var l=i.getUint32(n,!0);n+=fE;var c=i.getUint32(n,!0),h=kt(r,n+=fE,s),f=JSON.parse(h);n+=s;var p,d,m=new Uint8Array(t,n,u);{var _;n+=u,0<l&&(_=kt(r,n,l),p=JSON.parse(_),n+=l,0<c&&(d=new Uint8Array(t,n,c),d=new Uint8Array(d)))}var g=Je(f.BOXES_LENGTH,0),y=Je(f.CYLINDERS_LENGTH,0),v=Je(f.ELLIPSOIDS_LENGTH,0),x=Je(f.SPHERES_LENGTH,0),b=g+y+v+x,E=new no(e,b,p,d,function(n){return function(e,t){Ze(n._geometries)&&n._geometries.updateCommands(e,t)}}(e));if(e._batchTable=E,0===b)return;var T,S=e.tile.computedTransform;Ze(f.RTC_CENTER)&&(T=_t.unpack(f.RTC_CENTER),on.multiplyByPoint(S,T,T));var C,w,A,I,P=function(e,t){var n,r,i,o,a,s=Je(e.BOXES_LENGTH,0),u=Je(e.CYLINDERS_LENGTH,0),l=Je(e.ELLIPSOIDS_LENGTH,0),c=Je(e.SPHERES_LENGTH,0);{var h;0<s&&Ze(e.BOX_BATCH_IDS)&&(h=t.byteOffset+e.BOX_BATCH_IDS.byteOffset,n=new Uint16Array(t.buffer,h,s))}{var f;0<u&&Ze(e.CYLINDER_BATCH_IDS)&&(f=t.byteOffset+e.CYLINDER_BATCH_IDS.byteOffset,r=new Uint16Array(t.buffer,f,u))}{var p;0<l&&Ze(e.ELLIPSOID_BATCH_IDS)&&(p=t.byteOffset+e.ELLIPSOID_BATCH_IDS.byteOffset,i=new Uint16Array(t.buffer,p,l))}{var d;0<c&&Ze(e.SPHERE_BATCH_IDS)&&(d=t.byteOffset+e.SPHERE_BATCH_IDS.byteOffset,o=new Uint16Array(t.buffer,d,c))}var m=Ze(n)||Ze(r)||Ze(i)||Ze(o),_=0<s&&!Ze(n)||0<u&&!Ze(r)||0<l&&!Ze(i)||0<c&&!Ze(o);if(m&&_)throw new de("If one group of batch ids is defined, then all batch ids must be defined.");if(!(Ze(n)||Ze(r)||Ze(i)||Ze(o))){var g=0;if(!Ze(n)&&0<s)for(n=new Uint16Array(s),a=0;a<s;++a)n[a]=g++;if(!Ze(r)&&0<u)for(r=new Uint16Array(u),a=0;a<u;++a)r[a]=g++;if(!Ze(i)&&0<l)for(i=new Uint16Array(l),a=0;a<l;++a)i[a]=g++;if(!Ze(o)&&0<c)for(o=new Uint16Array(c),a=0;a<c;++a)o[a]=g++}return{boxes:n,cylinders:r,ellipsoids:i,spheres:o}}(f,m);{var O,L,N,R;(0<g||0<y||0<v||0<x)&&(0<g&&(O=m.byteOffset+f.BOXES.byteOffset,C=new Float32Array(m.buffer,O,sE.packedBoxLength*g)),0<y&&(L=m.byteOffset+f.CYLINDERS.byteOffset,w=new Float32Array(m.buffer,L,sE.packedCylinderLength*y)),0<v&&(N=m.byteOffset+f.ELLIPSOIDS.byteOffset,A=new Float32Array(m.buffer,N,sE.packedEllipsoidLength*v)),0<x&&(R=m.byteOffset+f.SPHERES.byteOffset,I=new Float32Array(m.buffer,R,sE.packedSphereLength*x)),e._geometries=new sE({boxes:C,boxBatchIds:P.boxes,cylinders:w,cylinderBatchIds:P.cylinders,ellipsoids:A,ellipsoidBatchIds:P.ellipsoids,spheres:I,sphereBatchIds:P.spheres,center:T,modelMatrix:S,batchTable:E,boundingVolume:e.tile.boundingVolume.boundingVolume}))}}(this,r,i)}sE.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},sE.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},sE.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},sE.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},sE.prototype.update=function(e){cE(this),this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e))},sE.prototype.isDestroyed=function(){return!1},sE.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Vt(this)},Object.defineProperties(hE.prototype,{featuresLength:{get:function(){return Ze(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return Ze(this._geometries)?this._geometries.trianglesLength:0}},geometryByteLength:{get:function(){return Ze(this._geometries)?this._geometries.geometryByteLength:0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return Ze(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var fE=Uint32Array.BYTES_PER_ELEMENT;function pE(e){var t,n=e.featuresLength;!Ze(e._features)&&0<n&&(t=new Array(n),Ze(e._geometries)&&e._geometries.createFeatures(e,t),e._features=t)}hE.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},hE.prototype.getFeature=function(e){return pE(this),this._features[e]},hE.prototype.applyDebugSettings=function(e,t){Ze(this._geometries)&&this._geometries.applyDebugSettings(e,t)},hE.prototype.applyStyle=function(e){pE(this),Ze(this._geometries)&&this._geometries.applyStyle(e,this._features)},hE.prototype.update=function(e,t){var n;Ze(this._geometries)&&(this._geometries.classificationType=this._tileset.classificationType,this._geometries.debugWireframe=this._tileset.debugWireframe,this._geometries.update(t)),Ze(this._batchTable)&&this._geometries._ready&&this._batchTable.update(e,t),Ze(this._contentReadyPromise)||((n=this)._contentReadyPromise=this._geometries.readyPromise.then(function(){n._readyPromise.resolve(n)}))},hE.prototype.isDestroyed=function(){return!1},hE.prototype.destroy=function(){return this._geometries=this._geometries&&this._geometries.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)};var dE=new _t(1,1,1),mE=_t.ZERO,_E=Si.IDENTITY;function gE(e,t,n){this.translation=_t.clone(Je(e,mE)),this.rotation=Si.clone(Je(t,_E)),this.scale=_t.clone(Je(n,dE))}function yE(e,t,n,r){this.primitive=e,this._modelMatrix=on.clone(t),this._instanceId=n,this._modelColor=r}gE.prototype.equals=function(e){return this===e||Ze(e)&&_t.equals(this.translation,e.translation)&&Si.equals(this.rotation,e.rotation)&&_t.equals(this.scale,e.scale)},Object.defineProperties(yE.prototype,{instanceId:{get:function(){return this._instanceId}},model:{get:function(){return this.primitive._model}},modelMatrix:{get:function(){return on.clone(this._modelMatrix)},set:function(e){on.clone(e,this._modelMatrix),this.primitive.expandBoundingSphere(this._modelMatrix),this.primitive._dirty=!0}},modelColor:{get:function(){return this._modelColor}}});var vE={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};function xE(e){e=Je(e,Je.EMPTY_OBJECT),this.show=Je(e.show,!0),this._instancingSupported=!1,this._dynamic=Je(e.dynamic,!1),this._allowPicking=Je(e.allowPicking,!0),this._ready=!1,this._readyPromise=D.defer(),this._state=vE.NEEDS_LOAD,this._dirty=!1,this._cull=Je(e.cull,!0),this._opaquePass=Je(e.opaquePass,yn.OPAQUE),this._instances=function(e,t){for(var n=(t=Je(t,[])).length,r=new Array(n),i=0;i<n;++i){var o=t[i],a=o.modelMatrix,s=Je(o.batchId,i);r[i]=new yE(e,a,s)}return r}(this,e.instances),this._batchTable=e.batchTable,this._model=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._instancedUniformsByProgram=void 0,this._drawCommands=[],this._modelCommands=void 0,this._boundingSphere=function(e){for(var t=e.length,n=new Array(t),r=0;r<t;++r)n[r]=on.getTranslation(e._instances[r]._modelMatrix,new _t);return ko.fromPoints(n)}(this),this._center=_t.clone(this._boundingSphere.center),this._rtcTransform=new on,this._rtcModelView=new on,this._mode=void 0,this.modelMatrix=on.clone(on.IDENTITY),this._modelMatrix=on.clone(this.modelMatrix),this._url=rt.createIfNeeded(e.url),this._requestType=e.requestType,this._gltf=e.gltf,this._basePath=rt.createIfNeeded(e.basePath),this._asynchronous=e.asynchronous,this._incrementallyLoadTextures=e.incrementallyLoadTextures,this._upAxis=e.upAxis,this._forwardAxis=e.forwardAxis,this.shadows=Je(e.shadows,Cd.ENABLED),this._shadows=this.shadows,this._pickIdLoaded=e.pickIdLoaded,this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Je(e.debugWireframe,!1),this._debugWireframe=!1,this._imageBasedLightingFactor=new En(1,1),En.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=e.lightColor,this.luminanceAtZenith=e.luminanceAtZenith,this.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=e.specularEnvironmentMaps,this.modelMeshPrimitives=[],this.content=Je(e.content,void 0),this.specular=e.specular,this.rollerRegion=e.rollerRegion}Object.defineProperties(xE.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){En.clone(e,this._imageBasedLightingFactor)}}});var bE=new _t,EE=new on;function TE(r,i,o,a){return function(e,t){var n=e.semantic;if(Ze(n)&&-1<r.indexOf(n)){if(!(-1<i.indexOf(n)))throw new de('Shader program cannot be optimized for instancing. Uniform "'+t+'" in program "'+o+'" uses unsupported semantic "'+n+'"');a[t]=n}}}function SE(e,t){if(Ze(e._instancedUniformsByProgram))return e._instancedUniformsByProgram[t];var n={};e._instancedUniformsByProgram=n;var r,i,o,a=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],s=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],u=e._model._sourceTechniques;for(var l in u){u.hasOwnProperty(l)&&(Ze(n[i=(r=u[l]).program])||(o={},n[i]=o,au.techniqueUniform(r,TE(a,s,t,o))))}return n[t]}function CE(u,l){return function(e,t,n){var r,i,o;(e=$e(e)).czm_instanced_modifiedModelView=(r=u,i=l,function(){return on.multiply(i.uniformState.view,r._rtcTransform,r._rtcModelView)}),e.czm_instanced_nodeTransform=(o=n,function(){return o.computedMatrix});var a=SE(u,t);for(var s in a)a.hasOwnProperty(s)&&delete e[s];return Ze(u._batchTable)&&(e=u._batchTable.getUniformMapCallback()(e)),e}}function wE(e){var t=e._instances,n=e.length,r=e._center,i=e._vertexBufferTypedArray;Ze(i)||(i=new Float32Array(12*n)),e._dynamic&&(e._vertexBufferTypedArray=i);for(var o=0;o<n;++o){var a=t[o]._modelMatrix,s=on.clone(a,EE);s[12]-=r.x,s[13]-=r.y,s[14]-=r.z;var u=12*o;i[0+u]=s[0],i[1+u]=s[4],i[2+u]=s[8],i[3+u]=s[12],i[4+u]=s[1],i[5+u]=s[5],i[6+u]=s[9],i[7+u]=s[13],i[8+u]=s[2],i[9+u]=s[6],i[10+u]=s[10],i[11+u]=s[14]}return i}function AE(e,t){var n,r,i,o,a,s,g,u=e._instancingSupported,l=Ze(e._batchTable),c=e._allowPicking,h={url:e._url,requestType:e._requestType,gltf:e._gltf,basePath:e._basePath,shadows:e._shadows,cacheKey:void 0,asynchronous:e._asynchronous,allowPicking:c,incrementallyLoadTextures:e._incrementallyLoadTextures,upAxis:e._upAxis,forwardAxis:e._forwardAxis,precreatedAttributes:void 0,vertexShaderLoaded:void 0,fragmentShaderLoaded:void 0,uniformMapLoaded:void 0,pickIdLoaded:e._pickIdLoaded,ignoreCommands:!0,opaquePass:e._opaquePass,imageBasedLightingFactor:e.imageBasedLightingFactor,lightColor:e.lightColor,luminanceAtZenith:e.luminanceAtZenith,sphericalHarmonicCoefficients:e.sphericalHarmonicCoefficients,specularEnvironmentMaps:e.specularEnvironmentMaps,content:e.content,sharedResources:{instancedPrograms:{name:e.sharedResources.instancedPrograms.name,shadredData:e.sharedResources.instancedPrograms.shadredData},ktxs:e.sharedResources.ktxs},specular:e.specular,rollerRegion:e.rollerRegion};l||(e._pickIds=function(e,t){for(var n=e._instances,r=n.length,i=new Array(r),o=0;o<r;++o)i[o]=t.createPickId(n[o]);return i}(e,t)),u?(function(e,t){var n=e._instances,r=e.length,i=e._dynamic,o=Ze(e._batchTable);if(o){for(var a=new Uint16Array(r),s=0;s<r;++s)a[s]=n[s]._instanceId;e._batchIdBuffer=Al.createVertexBuffer({context:t,typedArray:a,usage:wl.STATIC_DRAW})}if(!o){var u=new Uint8Array(4*r);for(s=0;s<r;++s){var l=e._pickIds[s].color,c=4*s;u[c]=It.floatToByte(l.red),u[1+c]=It.floatToByte(l.green),u[2+c]=It.floatToByte(l.blue),u[3+c]=It.floatToByte(l.alpha)}e._pickIdBuffer=Al.createVertexBuffer({context:t,typedArray:u,usage:wl.STATIC_DRAW})}var h=wE(e);e._vertexBuffer=Al.createVertexBuffer({context:t,typedArray:h,usage:i?wl.STREAM_DRAW:wl.STATIC_DRAW})}(e,t),n=Mt.getSizeInBytes(Mt.FLOAT),r={czm_modelMatrixRow0:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*n,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,normalize:!1,offsetInBytes:4*n,strideInBytes:12*n,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,normalize:!1,offsetInBytes:8*n,strideInBytes:12*n,instanceDivisor:1}},l&&(r.a_batchId={index:0,vertexBuffer:e._batchIdBuffer,componentsPerAttribute:1,componentDatatype:Mt.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),l||(r.pickColor={index:0,vertexBuffer:e._pickIdBuffer,componentsPerAttribute:4,componentDatatype:Mt.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),h.precreatedAttributes=r,h.vertexShaderLoaded=(g=e,function(e,t){var n,r,i,o=SE(g,t),a=Ze(g._batchTable),s=Xr.replaceMain(e,"czm_instancing_main"),u="",l="";for(var c in o)o.hasOwnProperty(c)&&("MODELVIEW"===(n=o[c])||"CESIUM_RTC_MODELVIEW"===n?r="czm_instanced_modelView":"MODELVIEWPROJECTION"===n?(r="czm_instanced_modelViewProjection",u+="mat4 czm_instanced_modelViewProjection;\n",l+="czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;\n"):"MODELVIEWINVERSETRANSPOSE"===n&&(r="czm_instanced_modelViewInverseTranspose",u+="mat3 czm_instanced_modelViewInverseTranspose;\n",l+="czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);\n"),i=new RegExp("uniform.*"+c+".*"),s=s.replace(i,""),i=new RegExp(c+"\\b","g"),s=s.replace(i,r));var h,f,p,d,m=a?(h="attribute float a_batchId;\n",f=""):(h="",f="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n","    v_pickColor = pickColor;\n"),_="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n"+u+"mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n"+h+f+s+"void main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;\n"+l+"    czm_instancing_main();\n"+m+"}\n";return a&&(p=g._model.gltf,d=Hu.getDiffuseAttributeOrUniform(p,t),_=g._batchTable.getVertexShaderCallback(!0,"a_batchId",d)(_)),_}),h.fragmentShaderLoaded=(s=e,function(e,t){var n,r,i=s._batchTable;return e=Ze(i)?(n=s._model.gltf,r=Hu.getDiffuseAttributeOrUniform(n,t),i.getFragmentShaderCallback(!0,r)(e)):"varying vec4 v_pickColor;\n"+e}),h.uniformMapLoaded=CE(e,t),Ze(e._url)&&(h.cacheKey=e._url.getUrlComponent()+"#instanced")):(h.vertexShaderLoaded=(a=e,function(e,t){var n,r;return Ze(a._batchTable)&&(n=a._model.gltf,r=Hu.getDiffuseAttributeOrUniform(n,t),e="uniform float a_batchId\n;"+a._batchTable.getVertexShaderCallback(!0,"a_batchId",r)(e)),e}),h.fragmentShaderLoaded=(o=e,function(e,t){var n,r,i=o._batchTable;return e=Ze(i)?(n=o._model.gltf,r=Hu.getDiffuseAttributeOrUniform(n,t),i.getFragmentShaderCallback(!0,r)(e)):"uniform vec4 czm_pickColor;\n"+e}),h.uniformMapLoaded=(i=e,function(e){return Ze(i._batchTable)&&(e=i._batchTable.getUniformMapCallback()(e)),e})),Ze(e._url)?e._model=av.fromGltf(h):e._model=new av(h)}function IE(e){return function(){return e}}function PE(e){return function(){return e}}function OE(e){for(var t=e._modelCommands,n=t.length,r=e.length,i=e._rtcTransform,o=e._center,a=0;a<n;++a)for(var s=t[a],u=0;u<r;++u){var l=a*r+u,c=e._drawCommands[l],h=on.clone(e._instances[u]._modelMatrix,EE);h[12]-=o.x,h[13]-=o.y,h[14]-=o.z,h=on.multiply(i,h,EE);var f=s.modelMatrix,p=c.modelMatrix;on.multiply(h,f,p);var d=s.boundingVolume,m=c.boundingVolume;ko.transform(d,h,m)}}function LE(e){for(var t=e._nodeCommands,n=t.length,r=[],i=0;i<n;++i){var o=t[i];o.show&&r.push(o.command)}return r}function NE(e,t){e._drawCommands=[];var n=LE(e._model);t?function(e,t){for(var n=t.length,r=e.length,i=e._boundingSphere,o=e._cull,a=0;a<n;++a){var s=Mn.shallowClone(t[a]);s.instanceCount=r,s.boundingVolume=i,s.cull=o,Ze(e._batchTable)?s.pickId=e._batchTable.getPickId():s.pickId="v_pickColor",e._drawCommands.push(s)}}(e,n):(function(e,t){for(var n=e._instances,r=t.length,i=e.length,o=Ze(e._batchTable),a=e._cull,s=0;s<r;++s)for(var u=0;u<i;++u){var l,c=Mn.shallowClone(t[s]);c.modelMatrix=new on,c.boundingVolume=new ko,c.cull=a,c.uniformMap=$e(c.uniformMap),o?c.uniformMap.a_batchId=IE(n[u]._instanceId):(l=e._pickIds[u],c.uniformMap.czm_pickColor=PE(l.color)),e._drawCommands.push(c)}}(e,n),OE(e))}function RE(e,t,n,r,i){this._tileset=e,this._tile=t,this._resource=n,this._modelInstanceCollection=void 0,this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,function(e,t,n){var r=Je(n,0);n=r;var i=new Uint8Array(t),o=new DataView(t);n+=DE;var a=o.getUint32(n,!0);if(1!==a)throw new de("Only Instanced 3D Model version 1 is supported. Version "+a+" is not.");n+=DE;var s=o.getUint32(n,!0);n+=DE;var u=o.getUint32(n,!0);if(0===u)throw new de("featureTableJsonByteLength is zero, the feature table must be defined.");n+=DE;var l=o.getUint32(n,!0);n+=DE;var c=o.getUint32(n,!0);n+=DE;var h=o.getUint32(n,!0);n+=DE;var f=o.getUint32(n,!0);if(1!==f&&0!==f)throw new de("Only glTF format 0 (uri) or 1 (embedded) are supported. Format "+f+" is not.");var p=kt(i,n+=DE,u),d=JSON.parse(p);n+=u;var m=new Uint8Array(t,n,l);n+=l;var _,g,y=new zo(d,m),v=y.getGlobalProperty("INSTANCES_LENGTH");if(!Ze(y.featuresLength=v))throw new de("Feature table global property: INSTANCES_LENGTH must be defined");{var x;0<c&&(x=kt(i,n,c),_=JSON.parse(x),n+=c,0<h&&(g=new Uint8Array(t,n,h),g=new Uint8Array(g),n+=h))}if(e._batchTable=new no(e,v,_,g),Ze(e._tile._header.EVID))for(var b=e._batchTable.featuresLength,E=0;E<b;E++)e._batchTable.setProperty(E,"EVID",e._tile._header.EVID);var T,S=r+s-n;if(0==S)throw new de("glTF byte length is zero, i3dm must have a glTF to instance.");T=n%4==0?new Uint8Array(t,n,S):(RE._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),new Uint8Array(i.subarray(n,n+S)));var C=e._tileset,w={instances:new Array(v),batchTable:e._batchTable,cull:!1,url:void 0,requestType:pe.TILES3D,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,upAxis:C._gltfUpAxis,forwardAxis:xn.X,opaquePass:yn.CESIUM_3D_TILE,pickIdLoaded:function(e){return function(){return e._batchTable.getPickId()}}(e),imageBasedLightingFactor:C.imageBasedLightingFactor,lightColor:C.lightColor,luminanceAtZenith:C.luminanceAtZenith,sphericalHarmonicCoefficients:C.sphericalHarmonicCoefficients,specularEnvironmentMaps:C.specularEnvironmentMaps,content:e,specular:C.specular,rollerRegion:C.rollerRegion};{var A;0===f?(A=(A=kt(T)).replace(/[\s\0]+$/,""),w.url=e._resource.getDerivedResource({url:A})):(w.gltf=T,w.basePath=e._resource.clone())}var I,P=y.getGlobalProperty("EAST_NORTH_UP"),O=y.getGlobalProperty("RTC_CENTER",Mt.FLOAT,3);Ze(O)&&(I=_t.unpack(O));for(var L=w.instances,N=new _t,R=new Array(3),D=new _t,M=new _t,F=new _t,z=new jt,B=new Si,U=new _t,V=new gE,k=new on,E=0;E<v;E++){var G=y.getProperty("POSITION",Mt.FLOAT,3,E,ME);if(!Ze(G)){G=R;var q=y.getProperty("POSITION_QUANTIZED",Mt.UNSIGNED_SHORT,3,E,ME);if(!Ze(q))throw new de("Either POSITION or POSITION_QUANTIZED must be defined for each instance.");var H=y.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Mt.FLOAT,3);if(!Ze(H))throw new de("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var W=y.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Mt.FLOAT,3);if(!Ze(W))throw new de("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var Y=0;Y<3;Y++)G[Y]=q[Y]/65535*W[Y]+H[Y]}_t.unpack(G,0,N),Ze(I)&&_t.add(N,I,N),V.translation=N;var X=y.getProperty("NORMAL_UP",Mt.FLOAT,3,E,ME),j=y.getProperty("NORMAL_RIGHT",Mt.FLOAT,3,E,FE),K=!1;if(Ze(X)){if(!Ze(j))throw new de("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");_t.unpack(X,0,M),_t.unpack(j,0,D),K=!0}else{var Q=y.getProperty("NORMAL_UP_OCT32P",Mt.UNSIGNED_SHORT,2,E,ME),Z=y.getProperty("NORMAL_RIGHT_OCT32P",Mt.UNSIGNED_SHORT,2,E,FE);if(Ze(Q)){if(!Ze(Z))throw new de("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");Hf.octDecodeInRange(Q[0],Q[1],65535,M),Hf.octDecodeInRange(Z[0],Z[1],65535,D),K=!0}else P?(bs.eastNorthUpToFixedFrame(N,Wn.WGS84,k),on.getMatrix3(k,z)):jt.clone(jt.IDENTITY,z)}K&&(_t.cross(D,M,F),_t.normalize(F,F),jt.setColumn(z,0,D,z),jt.setColumn(z,1,M,z),jt.setColumn(z,2,F,z)),Si.fromRotationMatrix(z,B),V.rotation=B,U=_t.fromElements(1,1,1,U);var J=y.getProperty("SCALE",Mt.FLOAT,1,E);Ze(J)&&_t.multiplyByScalar(U,J,U);var $=y.getProperty("SCALE_NON_UNIFORM",Mt.FLOAT,3,E,ME);Ze($)&&(U.x*=$[0],U.y*=$[1],U.z*=$[2]),V.scale=U;var ee=y.getProperty("BATCH_ID",Mt.UNSIGNED_SHORT,1,E);Ze(ee)||(ee=E),on.fromTranslationRotationScale(V,k);var te=k.clone();L[E]={modelMatrix:te,batchId:ee}}var ne=w.gltf;if(Ze(ne)&&(ne instanceof ArrayBuffer&&(ne=new Uint8Array(ne)),ne instanceof Uint8Array&&(w.gltf=_u(ne)),Ze(w.gltf.asset)&&"2.0"==w.gltf.asset.version)){var re=e._batchTable,ie=!1,oe={EVID:[],id:[],name:[]},ae=w.gltf.nodes;if(0<ae.length&&Ze(ae[0].instanceIndex)&&(ie=!0),ie){for(var se=new Array(w.instances.length*ae.length),ue=0;ue<w.instances.length;ue++)for(var le=0;le<ae.length;le++){if(!Ze(ae[le].matrix)||!Ze(ae[le].instanceIndex))throw new fe("Instanced3DModel3DTileContent: nodes["+le+"].instanceIndex is empty");var ce=on.clone(ae[le].matrix,new on);ce[1]=-ae[le].matrix[2],ce[2]=ae[le].matrix[1],ce[4]=-ae[le].matrix[8],ce[5]=ae[le].matrix[10],ce[6]=-ae[le].matrix[9],ce[8]=ae[le].matrix[4],ce[9]=-ae[le].matrix[6],ce[10]=ae[le].matrix[5],ce[13]=-ae[le].matrix[14],ce[14]=ae[le].matrix[13];var he=on.multiplyTransformation(w.instances[ue].modelMatrix,ce,new on);se[ue*ae.length+le]={modelMatrix:he,batchId:ue*ae.length+le},Ze(re._properties.EVID)?oe.EVID.push(re._properties.EVID[ue]):oe.EVID.push(0),oe.id.push(ae[le].instanceIndex),oe.name.push(re._properties.name[ue])}w.instances.length=0,w.instances=se;v=w.instances.length;e._batchTable=new no(e,v,oe),w.batchTable=e._batchTable}}e._modelInstanceCollection=new xE(w)}(this,r,i)}xE.prototype.expandBoundingSphere=function(e){var t=on.getTranslation(e,bE);ko.expand(this._boundingSphere,t,this._boundingSphere)},xE.prototype.update=function(e){if(e.mode!==Tl.MORPHING&&this.show&&0!==this.length){var t,n=e.context;this._state===vE.NEEDS_LOAD&&(this._state=vE.LOADING,this._instancingSupported=n.instancedArrays,AE(this,n),this._model._meshPrimitives=this.modelMeshPrimitives,(t=this)._model.readyPromise.otherwise(function(e){t._state=vE.FAILED,t._readyPromise.reject(e)}));var r=this._instancingSupported,i=this._model;if(i.imageBasedLightingFactor=this.imageBasedLightingFactor,i.lightColor=this.lightColor,i.luminanceAtZenith=this.luminanceAtZenith,i.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,i.specularEnvironmentMaps=this.specularEnvironmentMaps,i.ktxs=this.ktxs,i.gltfShader=this.gltfShader,i.update(e),i.ready&&this._state===vE.LOADING){this._state=vE.LOADED,this._ready=!0;var o=i.boundingSphere.radius+_t.magnitude(i.boundingSphere.center);return this._boundingSphere.radius+=o,this._modelCommands=LE(i),NE(this,r),void this._readyPromise.resolve(this)}if(this._state===vE.LOADED){var a,s,u,l=e.mode!==this._mode,c=this.modelMatrix,h=!on.equals(this._modelMatrix,c);(l||h)&&(this._mode=e.mode,on.clone(c,this._modelMatrix),a=on.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform),this._mode!==Tl.SCENE3D&&(a=bs.basisTo2D(e.mapProjection,a,a)),on.getTranslation(a,this._boundingSphere.center)),r&&this._dirty&&(this._dynamic=!0,this._dirty=!1,u=wE(s=this),s._vertexBuffer.copyFromArrayView(u)),function(e){for(var t=e._nodeCommands,n=t.length,r=0;r<n;r++){if(t[r].command.dirty)return 1}}(i)&&NE(this,r),!r&&(i.dirty||this._dirty||l||h)&&OE(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Cd.castShadows(e.shadows),n=Cd.receiveShadows(e.shadows),r=e._drawCommands,i=r.length,o=0;o<i;++o){var a=r[o];a.castShadows=t,a.receiveShadows=n}}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Dn.LINES:Dn.TRIANGLES,n=e._drawCommands,r=n.length,i=0;i<r;++i)n[i].primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e._drawCommands,n=t.length,r=0;r<n;++r)t[r].debugShowBoundingVolume=e.debugShowBoundingVolume}}(this);var f=e.passes;if(f.render||f.pick)for(var p=e.commandList,d=this._drawCommands,m=d.length,_=0;_<m;++_)p.push(d[_])}}},xE.prototype.isDestroyed=function(){return!1},xE.prototype.destroy=function(){this._model=this._model&&this._model.destroy(),this.sharedResources.instancedPrograms=void 0,this.sharedResources.ktxs=void 0,this.gltfShader=void 0,this._gltf=void 0,this._instances.length=0;var e=this._pickIds;if(Ze(e))for(var t=e.length,n=0;n<t;++n)e[n].destroy();return Vt(this)},RE._deprecationWarning=Bt,Object.defineProperties(RE.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){var e=this._modelInstanceCollection._model;return Ze(e)?e.trianglesLength:0}},geometryByteLength:{get:function(){var e=this._modelInstanceCollection._model;return Ze(e)?e.geometryByteLength:0}},texturesByteLength:{get:function(){var e=this._modelInstanceCollection._model;return Ze(e)?e.texturesByteLength:0}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._modelInstanceCollection.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var DE=Uint32Array.BYTES_PER_ELEMENT,ME=new Array(4),FE=new Array(4);RE.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},RE.prototype.getFeature=function(e){this.featuresLength;return function(e){var t=e.featuresLength;if(!Ze(e._features)&&0<t){for(var n=new Array(t),r=0;r<t;++r)n[r]=new Fo(e,r);e._features=n}}(this),this._features[e]},RE.prototype.applyDebugSettings=function(e,t){t=e?t:It.WHITE,this._batchTable.setAllColor(t)},RE.prototype.applyStyle=function(e){this._batchTable.applyStyle(e)},RE.prototype.update=function(e,t){var n=t.commandList.length;this._batchTable.update(e,t),this._modelInstanceCollection.modelMatrix=this._tile.computedTransform,this._modelInstanceCollection.shadows=this._tileset.shadows,this._modelInstanceCollection.lightColor=this._tileset.lightColor,this._modelInstanceCollection.luminanceAtZenith=this._tileset.luminanceAtZenith,this._modelInstanceCollection.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients,this._modelInstanceCollection.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps,this._modelInstanceCollection.debugWireframe=this._tileset.debugWireframe,this._modelInstanceCollection.sharedResources={instancedPrograms:{name:this.tile.sharedResources.instancedPrograms.name,shadredData:this.tile.sharedResources.instancedPrograms.shadredData},ktxs:this.tile.sharedResources.ktxs},this._modelInstanceCollection.gltfShader=this._tileset.gltfShader;var r,i=this._modelInstanceCollection._model;Ze(i)&&(r=this._tileset.clippingPlanes,i.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix,Ze(r)&&this._tile.clippingPlanesDirty&&(i._clippingPlanes=r.enabled&&this._tile._isClipped?r:void 0),Ze(r)&&Ze(i._clippingPlanes)&&i._clippingPlanes!==r&&(i._clippingPlanes=r)),this._modelInstanceCollection.update(t),n<t.commandList.length&&(t.passes.render||t.passes.pick)&&this._batchTable.addDerivedCommands(t,n,!1)},RE.prototype.isDestroyed=function(){return!1},RE.prototype.destroy=function(){return this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)};var zE=Object.freeze({ADD:0,REPLACE:1}),BE={NEEDS_DECODE:0,DECODING:1,READY:2,FAILED:3};function UE(e){this._parsedContent=void 0,this._drawCommand=void 0,this._isTranslucent=!1,this._styleTranslucent=!1,this._constantColor=It.clone(It.DARKGRAY),this._highlightColor=It.clone(It.WHITE),this._pointSize=2,this._rtcCenter=void 0,this._quantizedVolumeScale=void 0,this._quantizedVolumeOffset=void 0,this._styleableShaderAttributes=void 0,this._isQuantized=!1,this._isOctEncoded16P=!1,this._isRGB565=!1,this._hasColors=!1,this._hasNormals=!1,this._hasBatchIds=!1,this._decodingState=BE.READY,this._dequantizeInShader=!0,this._isQuantizedDraco=!1,this._isOctEncodedDraco=!1,this._quantizedRange=0,this._octEncodedRange=0,this.backFaceCulling=!1,this._backFaceCulling=!1,this.normalShading=!0,this._normalShading=!0,this._opaqueRenderState=void 0,this._translucentRenderState=void 0,this._mode=void 0,this._ready=!1,this._readyPromise=D.defer(),this._pointsLength=0,this._geometryByteLength=0,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._batchTableLoaded=e.batchTableLoaded,this._pickIdLoaded=e.pickIdLoaded,this._opaquePass=Je(e.opaquePass,yn.OPAQUE),this._cull=Je(e.cull,!0),this.style=void 0,this._style=void 0,this.styleDirty=!1,this.modelMatrix=on.clone(on.IDENTITY),this._modelMatrix=on.clone(on.IDENTITY),this.time=0,this.shadows=Cd.ENABLED,this._boundingSphere=void 0,this.clippingPlanes=void 0,this.isClipped=!1,this.clippingPlanesDirty=!1,this.clippingPlanesOriginMatrix=void 0,this.attenuation=!1,this._attenuation=!1,this.geometricError=0,this.geometricErrorScale=1,this.maximumAttenuation=this._pointSize,this.useElevation=Je(e.useElevation,!1),this.elevationMap=Je(e.elevationMap,void 0),this.meshPrimitives=[],this.useDracoDecoded=!1,function(e,t){var n=t.arrayBuffer,r=Je(t.byteOffset,0),i=new Uint8Array(n),o=new DataView(n);r+=VE;var a=o.getUint32(r,!0);if(1!==a)throw new de("Only Point Cloud tile version 1 is supported.  Version "+a+" is not.");r+=VE,r+=VE;var s=o.getUint32(r,!0);if(0===s)throw new de("Feature table must have a byte length greater than zero");r+=VE;var u=o.getUint32(r,!0);r+=VE;var l=o.getUint32(r,!0);r+=VE;var c=o.getUint32(r,!0),h=kt(i,r+=VE,s),f=JSON.parse(h);r+=s;var p,d,m=new Uint8Array(n,r,u);{var _;r+=u,0<l&&(_=kt(i,r,l),p=JSON.parse(_),r+=l,0<c&&(d=new Uint8Array(n,r,c),r+=c))}var g=new zo(f,m),y=g.getGlobalProperty("POINTS_LENGTH");if(!Ze(g.featuresLength=y))throw new de("Feature table global property: POINTS_LENGTH must be defined");var v,x,b,E,T=g.getGlobalProperty("RTC_CENTER",Mt.FLOAT,3);Ze(T)&&(e._rtcCenter=_t.unpack(T));var S,C,w,A,I,P=!1,O=!1,L=!1,N=!1,R=!1,D=!1,M=!1,F=!1,z=Ze(f.extensions)?f.extensions["3DTILES_draco_point_compression"]:void 0,B=Ze(p)&&Ze(p.extensions)?p.extensions["3DTILES_draco_point_compression"]:void 0;Ze(B)&&(w=B.properties);if(Ze(z)){C=z.properties;var U=z.byteOffset,V=z.byteLength;if(!Ze(C)||!Ze(U)||!Ze(V))throw new de("Draco properties, byteOffset, and byteLength must be defined");S=Uo(m,U,U+V),P=Ze(C.POSITION),O=Ze(C.RGB)||Ze(C.RGBA),L=Ze(C.NORMAL),N=Ze(C.BATCH_ID),D=Ze(C.RGBA),e._decodingState=BE.NEEDS_DECODE}Ze(S)&&(A={buffer:S,featureTableProperties:C,batchTableProperties:w,properties:ne(C,w),dequantizeInShader:e._dequantizeInShader});if(!P)if(Ze(f.POSITION))v=g.getPropertyArray("POSITION",Mt.FLOAT,3),P=!0;else if(Ze(f.POSITION_QUANTIZED)){v=g.getPropertyArray("POSITION_QUANTIZED",Mt.UNSIGNED_SHORT,3),P=R=!0;var k=g.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Mt.FLOAT,3);if(!Ze(k))throw new de("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");e._quantizedVolumeScale=_t.unpack(k),e._quantizedRange=65535;var G=g.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Mt.FLOAT,3);if(!Ze(G))throw new de("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e._quantizedVolumeOffset=_t.unpack(G)}O||(Ze(f.RGBA)?(x=g.getPropertyArray("RGBA",Mt.UNSIGNED_BYTE,4),O=D=!0):Ze(f.RGB)?(x=g.getPropertyArray("RGB",Mt.UNSIGNED_BYTE,3),O=!0):Ze(f.RGB565)&&(x=g.getPropertyArray("RGB565",Mt.UNSIGNED_SHORT,1),O=M=!0));L||(Ze(f.NORMAL)?(b=g.getPropertyArray("NORMAL",Mt.FLOAT,3),L=!0):Ze(f.NORMAL_OCT16P)&&(b=g.getPropertyArray("NORMAL_OCT16P",Mt.UNSIGNED_BYTE,2),L=F=!0));N||Ze(f.BATCH_ID)&&(E=g.getPropertyArray("BATCH_ID",Mt.UNSIGNED_SHORT,1),N=!0);if(!P)throw new de("Either POSITION or POSITION_QUANTIZED must be defined.");{var q;Ze(f.CONSTANT_RGBA)&&(q=g.getGlobalProperty("CONSTANT_RGBA",Mt.UNSIGNED_BYTE,4),e._constantColor=It.fromBytes(q[0],q[1],q[2],q[3],e._constantColor))}if(N){var H=g.getGlobalProperty("BATCH_LENGTH");if(!Ze(H))throw new de("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");Ze(d)&&(d=new Uint8Array(d)),Ze(e._batchTableLoaded)&&e._batchTableLoaded(H,p,d)}N&&!e.useElevation||!Ze(d)||(I=no.getBinaryProperties(y,p,d));e._parsedContent={positions:v,colors:x,normals:b,batchIds:E,styleableProperties:I,draco:A},e._pointsLength=y,e._isQuantized=R,e._isOctEncoded16P=F,e._isRGB565=M,e._isTranslucent=D,e._hasColors=O,e._hasNormals=L,e._hasBatchIds=N}(this,e)}Object.defineProperties(UE.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},color:{get:function(){return It.clone(this._highlightColor)},set:function(e){this._highlightColor=It.clone(e,this._highlightColor)}},boundingSphere:{get:function(){if(Ze(this._drawCommand))return this._drawCommand.boundingVolume},set:function(e){this._boundingSphere=ko.clone(e,this._boundingSphere)}}});var VE=Uint32Array.BYTES_PER_ELEMENT;var kE,GE=new _t,qE=new _t,HE=new _t;function WE(e){for(var t=e.length/3,n=Math.min(t,20),r=function(e){if(!Ze(kE)){pt.setRandomNumberSeed(0),kE=new Array(e);for(var t=0;t<e;++t)kE[t]=pt.nextRandomNumber()}return kE}(20),i=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=_t.fromElements(i,i,i,GE),s=_t.fromElements(o,o,o,qE),u=0;u<n;++u){var l=Math.floor(r[u]*t),c=_t.unpack(e,3*l,HE);_t.minimumByComponent(a,c,a),_t.maximumByComponent(s,c,s)}var h=ko.fromCornerPoints(a,s);return h.radius+=pt.EPSILON2,h}function YE(e,t){var n=Mt.fromTypedArray(e);return n===Mt.INT||n===Mt.UNSIGNED_INT||n===Mt.DOUBLE?(zt("Cast pnts property to floats",'Point cloud property "'+t+'" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.'),new Float32Array(e)):e}var XE=new qt,jE=new qt,KE=new It,QE=new on;function ZE(r,i){var o=i.context,e=r._isQuantized,t=r._isQuantizedDraco,n=r._isOctEncodedDraco,a={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){var e,t,n=XE;return n.x=r._attenuation?r.maximumAttenuation:r._pointSize,n.x*=i.pixelRatio,n.y=r.time,r._attenuation&&(e=i.camera.frustum,t=i.mode===Tl.SCENE2D||e instanceof rE?Number.POSITIVE_INFINITY:o.drawingBufferHeight/i.camera.frustum.sseDenominator,n.z=r.geometricError*r.geometricErrorScale,n.w=t),n},u_highlightColor:function(){return r._highlightColor},u_constantColor:function(){return r._constantColor},u_clippingPlanes:function(){var e=r.clippingPlanes;return r.isClipped?e.texture:o.defaultTexture},u_clippingPlanesEdgeStyle:function(){var e=r.clippingPlanes;if(!Ze(e))return It.TRANSPARENT;var t=It.clone(e.edgeColor,KE);return t.alpha=e.edgeWidth,t},u_clippingPlanesMatrix:function(){var e=r.clippingPlanes;if(!Ze(e))return on.IDENTITY;var t=Je(r.clippingPlanesOriginMatrix,r._modelMatrix);return on.multiply(o.uniformState.view3D,t,QE),on.multiply(QE,e.modelMatrix,QE)}};r.useElevation&&(a=ne(a,{u_maximumHeight:function(){return r.elevationMax},u_minimumHeight:function(){return r.elevationMin},u_image:function(){return function(e,t){if(Ze(t.elevationTexture))return t.elevationTexture;var n,r;n=Ze(t.elevationRamp)?t.elevationRamp:[0,.045,.1,.15,.37,.54,1];if(Ze(t.colorRamp)){r=t.colorRamp;for(var i=0;i<r.length;i++)r[i]=(o=r[i],0,a=o.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),s=parseFloat(a[3]||1),u=Math.floor(s*parseInt(a[0])+255*(1-s)),l=Math.floor(s*parseInt(a[1])+255*(1-s)),c=Math.floor(s*parseInt(a[2])+255*(1-s)),"#"+((1<<24)+(u<<16)+(l<<8)+c).toString(16).slice(1))}else r=["#000000","#2747E0","#D33B7D","#D33038","#FF9742","#ffd700","#ffffff"];var o,a,s,u,l,c;var h=document.createElement("canvas");h.width=100,h.height=1;for(var f=h.getContext("2d"),p=f.createLinearGradient(0,0,100,0),d=n.length>r.length?r.length:n.length,i=0;i<d;i++)p.addColorStop(n[i],r[i]);f.fillStyle=p,f.fillRect(0,0,100,1);var m=new ti({context:e,source:h});return t.elevationTexture=m}(o,r.elevationMap)}})),(e||t||n)&&(a=ne(a,{u_quantizedVolumeScaleAndOctEncodedRange:function(){var e,t=jE;return Ze(r._quantizedVolumeScale)&&(e=_t.clone(r._quantizedVolumeScale,t),_t.divideByScalar(e,r._quantizedRange,t)),t.w=r._octEncodedRange,t}})),Ze(r._uniformMapLoaded)&&(a=r._uniformMapLoaded(a)),r._drawCommand.uniformMap=a}var JE=["POSITION","COLOR","NORMAL","POSITION_ABSOLUTE"];function $E(e,t){for(var n=/czm_tiles3d_style_(\w+)/g,r=n.exec(e);null!==r;){var i=r[1];-1===t.indexOf(i)&&t.push(i),r=n.exec(e)}}function eT(e,t){for(var n=e.numberOfAttributes,r=0;r<n;++r){var i=e.getAttribute(r);if(i.index===t)return i}}function tT(e){for(var t=JE.length,n=0;n<t;++n){var r=JE[n],i="czm_tiles3d_style_"+r,o=r.toLowerCase();e=e.replace(new RegExp(i+"(\\W)","g"),o+"$1")}return e.replace("()","(vec3 position, vec3 position_absolute, vec4 color, vec3 normal)")}var nT=new qt,rT=new _t;function iT(e){e=Je(e,Je.EMPTY_OBJECT),this.color=e.color,this.depth=e.depth,this.stencil=e.stencil,this.renderState=e.renderState,this.framebuffer=e.framebuffer,this.owner=e.owner,this.pass=e.pass}function oT(e,t,n){var r=e._gl;r.framebufferTexture2D(r.FRAMEBUFFER,t,n._target,n._texture,0)}function aT(e,t,n){var r=e._gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,n._getRenderbuffer())}function sT(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).context._gl;this._gl=t,this._framebuffer=t.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=Je(e.destroyAttachments,!0);var n,r,i;Ze(e.depthTexture)||Ze(e.depthRenderbuffer),Ze(e.depthStencilTexture)||Ze(e.depthStencilRenderbuffer);if(this._bind(),Ze(e.colorTextures))for(var o=e.colorTextures,a=this._colorTextures.length=this._activeColorAttachments.length=o.length,s=0;s<a;++s)n=o[s],oT(this,i=this._gl.COLOR_ATTACHMENT0+s,n),this._activeColorAttachments[s]=i,this._colorTextures[s]=n;if(Ze(e.colorRenderbuffers)){var u=e.colorRenderbuffers;for(a=this._colorRenderbuffers.length=this._activeColorAttachments.length=u.length,s=0;s<a;++s)r=u[s],aT(this,i=this._gl.COLOR_ATTACHMENT0+s,r),this._activeColorAttachments[s]=i,this._colorRenderbuffers[s]=r}Ze(e.depthTexture)&&(n=e.depthTexture,oT(this,this._gl.DEPTH_ATTACHMENT,n),this._depthTexture=n),Ze(e.depthRenderbuffer)&&(r=e.depthRenderbuffer,aT(this,this._gl.DEPTH_ATTACHMENT,r),this._depthRenderbuffer=r),Ze(e.stencilRenderbuffer)&&(r=e.stencilRenderbuffer,aT(this,this._gl.STENCIL_ATTACHMENT,r),this._stencilRenderbuffer=r),Ze(e.depthStencilTexture)&&(n=e.depthStencilTexture,oT(this,this._gl.DEPTH_STENCIL_ATTACHMENT,n),this._depthStencilTexture=n),Ze(e.depthStencilRenderbuffer)&&(r=e.depthStencilRenderbuffer,aT(this,this._gl.DEPTH_STENCIL_ATTACHMENT,r),this._depthStencilRenderbuffer=r),this._unBind()}UE.prototype.update=function(e){var d,t,m,_,n,r,i,o,a,s,u,l,c,h,f,p,g=e.context,y=!1;0<this.meshPrimitives.length?(y=function(e,t){if(e._decodingState===BE.READY)return!1;var n=e._parsedContent,r=n.draco;e._decodingState=BE.READY;var i,o,a=Ze(t.POSITION)?t.POSITION.array:void 0,s=Ze(t.RGB)?t.RGB.array:void 0,u=Ze(t.RGBA)?t.RGBA.array:void 0,l=Ze(t.NORMAL)?t.NORMAL.array:void 0,c=Ze(t.BATCH_ID)?t.BATCH_ID.array:void 0,h=Ze(a)&&Ze(t.POSITION.data.quantization),f=Ze(l)&&Ze(t.NORMAL.data.quantization);h&&(o=(i=t.POSITION.data.quantization).range,e._quantizedVolumeScale=_t.fromElements(o,o,o),e._quantizedVolumeOffset=_t.unpack(i.minValues),e._quantizedRange=(1<<i.quantizationBits)-1,e._isQuantizedDraco=!0),f&&(e._octEncodedRange=(1<<t.NORMAL.data.quantization.quantizationBits)-1,e._isOctEncodedDraco=!0);var p,d=n.styleableProperties,m=r.batchTableProperties;for(var _ in m){m.hasOwnProperty(_)&&(p=t[_],Ze(d)||(d={}),d[_]={typedArray:p.array,componentCount:p.data.componentsPerAttribute})}return n.positions=Je(a,n.positions),n.colors=Je(Je(u,s),n.colors),n.normals=Je(l,n.normals),n.batchIds=Je(c,n.batchIds),n.styleableProperties=d,!1}(this,this.meshPrimitives[0]),this.useDracoDecoded||(this.meshPrimitives.length=0)):(t=g,y=(d=this)._decodingState!==BE.READY&&(d._decodingState===BE.NEEDS_DECODE&&(m=d._parsedContent,_=m.draco,Ze(n=yp.decodePointCloud(_,t))&&(d._decodingState=BE.DECODING,n.then(function(e){d.meshPrimitives.push(e),d.useDracoDecoded=!0,d._decodingState=BE.READY;var t,n,r=Ze(e.POSITION)?e.POSITION.array:void 0,i=Ze(e.RGB)?e.RGB.array:void 0,o=Ze(e.RGBA)?e.RGBA.array:void 0,a=Ze(e.NORMAL)?e.NORMAL.array:void 0,s=Ze(e.BATCH_ID)?e.BATCH_ID.array:void 0,u=Ze(r)&&Ze(e.POSITION.data.quantization),l=Ze(a)&&Ze(e.NORMAL.data.quantization);u&&(n=(t=e.POSITION.data.quantization).range,d._quantizedVolumeScale=_t.fromElements(n,n,n),d._quantizedVolumeOffset=_t.unpack(t.minValues),d._quantizedRange=(1<<t.quantizationBits)-1,d._isQuantizedDraco=!0),l&&(d._octEncodedRange=(1<<e.NORMAL.data.quantization.quantizationBits)-1,d._isOctEncodedDraco=!0);var c,h=m.styleableProperties,f=_.batchTableProperties;for(var p in f)f.hasOwnProperty(p)&&(c=e[p],Ze(h)||(h={}),h[p]={typedArray:c.array,componentCount:c.data.componentsPerAttribute});m.positions=Je(r,m.positions),m.colors=Je(Je(o,i),m.colors),m.normals=Je(a,m.normals),m.batchIds=Je(s,m.batchIds),m.styleableProperties=h}).otherwise(function(e){d._decodingState=BE.FAILED,d._readyPromise.reject(e)}))),!0)),y||(r=!1,i=!on.equals(this._modelMatrix,this.modelMatrix),this._mode!==e.mode&&(this._mode=e.mode,i=!0),Ze(this._drawCommand)||(function(e,t){var n=t.context,r=e._parsedContent,i=e._pointsLength,o=r.positions,a=r.colors,s=r.normals,u=r.batchIds,l=r.styleableProperties,c=Ze(l),h=e._isQuantized,f=e._isQuantizedDraco,p=e._isOctEncoded16P,d=e._isOctEncodedDraco,m=e._quantizedRange,_=e._octEncodedRange,g=e._isRGB565,y=e._isTranslucent,v=e._hasColors,x=e._hasNormals,b=e._hasBatchIds,E=[],T={};if(e._styleableShaderAttributes=T,c){var S,C,w,A,I,P,O=4;for(var L in l){l.hasOwnProperty(L)&&(C=YE((S=l[L]).typedArray,L),w=S.componentCount,A=Mt.fromTypedArray(C),I=Al.createVertexBuffer({context:n,typedArray:C,usage:wl.STATIC_DRAW}),e._geometryByteLength+=I.sizeInBytes,P={index:O,vertexBuffer:I,componentsPerAttribute:w,componentDatatype:A,normalize:!1,offsetInBytes:0,strideInBytes:0},E.push(P),T[L]={location:O,componentCount:w},++O)}}var N,R,D,M=Al.createVertexBuffer({context:n,typedArray:o,usage:wl.STATIC_DRAW});e._geometryByteLength+=M.sizeInBytes,v&&(N=Al.createVertexBuffer({context:n,typedArray:a,usage:wl.STATIC_DRAW}),e._geometryByteLength+=N.sizeInBytes),x&&(R=Al.createVertexBuffer({context:n,typedArray:s,usage:wl.STATIC_DRAW}),e._geometryByteLength+=R.sizeInBytes),b&&(u=YE(u,"batchIds"),D=Al.createVertexBuffer({context:n,typedArray:u,usage:wl.STATIC_DRAW}),e._geometryByteLength+=D.sizeInBytes);var F,z=[];A=h?Mt.UNSIGNED_SHORT:f?m<=255?Mt.UNSIGNED_BYTE:Mt.UNSIGNED_SHORT:Mt.FLOAT,z.push({index:0,vertexBuffer:M,componentsPerAttribute:3,componentDatatype:A,normalize:!1,offsetInBytes:0,strideInBytes:0}),e._cull&&(e._boundingSphere=h||f?ko.fromCornerPoints(_t.ZERO,e._quantizedVolumeScale):WE(o)),v&&(g?z.push({index:1,vertexBuffer:N,componentsPerAttribute:1,componentDatatype:Mt.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0}):(F=y?4:3,z.push({index:1,vertexBuffer:N,componentsPerAttribute:F,componentDatatype:Mt.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0}))),x&&(A=p?(w=2,Mt.UNSIGNED_BYTE):d?(w=2,_<=255?Mt.UNSIGNED_BYTE:Mt.UNSIGNED_SHORT):(w=3,Mt.FLOAT),z.push({index:2,vertexBuffer:R,componentsPerAttribute:w,componentDatatype:A,normalize:!1,offsetInBytes:0,strideInBytes:0})),b&&z.push({index:3,vertexBuffer:D,componentsPerAttribute:1,componentDatatype:Mt.fromTypedArray(u),normalize:!1,offsetInBytes:0,strideInBytes:0}),c&&(z=z.concat(E));var B=new Ac({context:n,attributes:z}),U={depthTest:{enabled:!0}};e._opaquePass===yn.CESIUM_3D_TILE&&(U.stencilTest=Ti.setCesium3DTileBit(),U.stencilMask=Ti.CESIUM_3D_TILE_MASK),e._opaqueRenderState=sr.fromCache(U),e._translucentRenderState=sr.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:ui.ALPHA_BLEND}),e._drawCommand=new Mn({boundingVolume:new ko,cull:e._cull,modelMatrix:new on,primitiveType:Dn.POINTS,vertexArray:B,count:i,shaderProgram:void 0,uniformMap:void 0,renderState:y?e._translucentRenderState:e._opaqueRenderState,pass:y?yn.TRANSLUCENT:e._opaquePass,owner:e,castShadows:!1,receiveShadows:!1,pickId:e._pickIdLoaded()})}(this,e),r=i=!0,this._ready=!0,this._readyPromise.resolve(this),this._parsedContent=void 0),i&&(on.clone(this.modelMatrix,this._modelMatrix),o=this._drawCommand.modelMatrix,on.clone(this._modelMatrix,o),Ze(this._rtcCenter)&&on.multiplyByTranslation(o,this._rtcCenter,o),Ze(this._quantizedVolumeOffset)&&on.multiplyByTranslation(o,this._quantizedVolumeOffset,o),e.mode!==Tl.SCENE3D&&(a=e.mapProjection,s=on.getColumn(o,3,nT),qt.equals(s,qt.UNIT_W)||bs.basisTo2D(a,o,o)),u=this._drawCommand.boundingVolume,ko.clone(this._boundingSphere,u),this._cull&&(l=u.center,on.multiplyByPoint(o,l,l),c=on.getScale(o,rT),u.radius*=_t.maximumComponent(c))),this.clippingPlanesDirty&&(r=!(this.clippingPlanesDirty=!1)),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,r=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,r=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,r=!0),this._style===this.style&&!this.styleDirty||(this._style=this.style,r=!(this.styleDirty=!1)),r&&function(e,t,n){var r,i,o,a,s,u,l=t.context,c=Ze(n),h=e._isQuantized,f=e._isQuantizedDraco,p=e._isOctEncoded16P,d=e._isOctEncodedDraco,m=e._isRGB565,_=e._isTranslucent,g=e._hasColors,y=e._hasNormals,v=e._hasBatchIds,x=e._backFaceCulling,b=e._normalShading,E=e._drawCommand.vertexArray,T=e.clippingPlanes,S=e._attenuation,C=_;c&&(a={translucent:!1},s=n._show&&n._show._expression?n.getShowShaderFunction("getShowFromStyle","czm_tiles3d_style_",a):void 0,u=n._pointSize&&n._pointSize._expression?n.getPointSizeShaderFunction("getPointSizeFromStyle","czm_tiles3d_style_",a):void 0,Ze(o)&&a.translucent&&(C=!0)),e._styleTranslucent=C;var w=Ze(o),A=Ze(s),I=Ze(u),P=e.isClipped,O=[];w&&($E(o,O),o=tT(o)),e.useElevation&&O.push("elevation"),A&&($E(s,O),s=tT(s)),I&&($E(u,O),u=tT(u));var L=0<=O.indexOf("COLOR"),N=0<=O.indexOf("NORMAL"),R=O.filter(function(e){return-1===JE.indexOf(e)});if(N&&!y)throw new de("Style references the NORMAL semantic but the point cloud does not have normals");var D,M=e._styleableShaderAttributes;for(r in M){M.hasOwnProperty(r)&&(i=M[r],D=0<=R.indexOf(r),eT(E,i.location).enabled=D)}var F=g&&(!w||L);g&&(eT(E,1).enabled=F);var z=y&&(b||x||N);y&&(eT(E,2).enabled=z);var B={a_position:0};F&&(B.a_color=1),z&&(B.a_normal=2),v&&(B.a_batchId=3);for(var U="",V=R.length,k=0;k<V;++k){if(!Ze(i=M[r=R[k]]))throw new de('Style references a property "'+r+'" that does not exist or is not styleable.');var G=i.componentCount,q="czm_tiles3d_style_"+r,H=1===G?"float":"vec"+G;U+="attribute "+H+" "+q+"; \n",B[q]=i.location}ZE(e,t);var W="attribute vec3 a_position; \nvarying vec4 v_color; \nuniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; \nuniform vec4 u_constantColor; \nuniform vec4 u_highlightColor; \n";W+="float u_pointSize; \nfloat u_time; \n",S&&(W+="float u_geometricError; \nfloat u_depthMultiplier; \n"),e.useElevation&&(W+="uniform float u_minimumHeight;\nuniform float u_maximumHeight; \nuniform sampler2D u_image; \n"),W+=U,F&&(W+=_?"attribute vec4 a_color; \n":m?"attribute float a_color; \nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0; \nconst float SHIFT_RIGHT_5 = 1.0 / 32.0; \nconst float SHIFT_LEFT_11 = 2048.0; \nconst float SHIFT_LEFT_5 = 32.0; \nconst float NORMALIZE_6 = 1.0 / 64.0; \nconst float NORMALIZE_5 = 1.0 / 32.0; \n":"attribute vec3 a_color; \n"),z&&(W+=p||d?"attribute vec2 a_normal; \n":"attribute vec3 a_normal; \n"),v&&(W+="attribute float a_batchId; \n"),(h||f||d)&&(W+="uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; \n"),e.useElevation&&(W+="vec4 getColorFromElevation()\n{\n     float scaledHeight = clamp((czm_tiles3d_style_elevation - u_minimumHeight) / (u_maximumHeight - u_minimumHeight), 0.0, 1.0);\n     vec4 rampColor = texture2D(u_image, vec2(scaledHeight, 0.5));\n     rampColor = czm_gammaCorrect(rampColor);\n     return rampColor;\n}\n"),w&&(W+=o),A&&(W+=s),I&&(W+=u),W+="void main() \n{ \n    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; \n    u_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; \n",S&&(W+="    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; \n    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; \n"),W+=F?_?"    vec4 color = a_color; \n":m?"    float compressed = a_color; \n    float r = floor(compressed * SHIFT_RIGHT_11); \n    compressed -= r * SHIFT_LEFT_11; \n    float g = floor(compressed * SHIFT_RIGHT_5); \n    compressed -= g * SHIFT_LEFT_5; \n    float b = compressed; \n    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); \n    vec4 color = vec4(rgb, 1.0); \n":"    vec4 color = vec4(a_color, 1.0); \n":"    vec4 color = u_constantColor; \n",W+=h||f?"    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; \n":"    vec3 position = a_position; \n",W+="    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); \n",z?(W+=p?"    vec3 normal = czm_octDecode(a_normal); \n":d?"    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; \n":"    vec3 normal = a_normal; \n",W+="    vec3 normalEC = czm_normal * normal; \n"):W+="    vec3 normal = vec3(1.0); \n",w&&(W+="    color = getColorFromStyle(position, position_absolute, color, normal); \n"),e.useElevation&&(W+="    color = getColorFromElevation(); \n"),A&&(W+="    float show = float(getShowFromStyle(position, position_absolute, color, normal)); \n"),W+=I?"    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal) * czm_pixelRatio; \n":S?"    vec4 positionEC = czm_modelView * vec4(position, 1.0); \n    float depth = -positionEC.z; \n    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); \n":"    gl_PointSize = u_pointSize; \n",W+="    color = color * u_highlightColor; \n",z&&b&&(W+="    float diffuseStrength = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC); \n    diffuseStrength = max(diffuseStrength, 0.4); \n    color.xyz *= diffuseStrength * czm_lightColor; \n"),W+="    v_color = color; \n    gl_Position = czm_modelViewProjection * vec4(position, 1.0); \n",z&&x&&(W+="    float visible = step(-normalEC.z, 0.0); \n    gl_Position *= visible; \n    gl_PointSize *= visible; \n"),A&&(W+="    gl_Position.w *= float(show); \n    gl_PointSize *= float(show); \n"),W+="} \n";var Y="varying vec4 v_color; \n";P&&(Y+="uniform sampler2D u_clippingPlanes; \nuniform mat4 u_clippingPlanesMatrix; \nuniform vec4 u_clippingPlanesEdgeStyle; \n",Y+="\n",Y+=wp(T,l),Y+="\n"),Y+="void main() \n{ \n    gl_FragColor = czm_gammaCorrect(v_color); \n",P&&(Y+=Sp("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle")),Y+="} \n",Ze(e._vertexShaderLoaded)&&(W=e._vertexShaderLoaded(W)),Ze(e._fragmentShaderLoaded)&&(Y=e._fragmentShaderLoaded(Y));var X=e._drawCommand;Ze(X.shaderProgram)&&X.shaderProgram.destroy(),X.shaderProgram=ic.fromCache({context:l,vertexShaderSource:W,fragmentShaderSource:Y,attributeLocations:B});try{X.shaderProgram._bind()}catch(e){throw new de("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.")}}(this,e,this._style),this._drawCommand.castShadows=Cd.castShadows(this.shadows),this._drawCommand.receiveShadows=Cd.receiveShadows(this.shadows),h=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent,this._drawCommand.renderState=h?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=h?yn.TRANSLUCENT:this._opaquePass,f=e.commandList,((p=e.passes).render||p.pick)&&f.push(this._drawCommand))},UE.prototype.isDestroyed=function(){return!1},UE.prototype.destroy=function(){var e=this._drawCommand;return Ze(e)&&(e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy()),Vt(this)},iT.ALL=Object.freeze(new iT({color:new It(0,0,0,0),depth:1,stencil:0})),iT.prototype.execute=function(e,t){e.clear(this,t)},Object.defineProperties(sT.prototype,{status:{get:function(){this._bind();var e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}}),sT.prototype._bind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},sT.prototype._unBind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},sT.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments},sT.prototype.getColorTexture=function(e){return this._colorTextures[e]},sT.prototype.getColorRenderbuffer=function(e){return this._colorRenderbuffers[e]},sT.prototype.isDestroyed=function(){return!1},sT.prototype.destroy=function(){if(this.destroyAttachments){for(var e=0,t=this._colorTextures,n=t.length;e<n;++e){var r=t[e];Ze(r)&&r.destroy()}for(var i=this._colorRenderbuffers,n=i.length,e=0;e<n;++e){var o=i[e];Ze(o)&&o.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),Vt(this)};var uT="#extension GL_EXT_frag_depth : enable\nuniform sampler2D u_pointCloud_colorGBuffer;\nuniform sampler2D u_pointCloud_depthGBuffer;\nuniform vec2 u_distanceAndEdlStrength;\nvarying vec2 v_textureCoordinates;\nvec2 neighborContribution(float log2Depth, vec2 offset)\n{\nfloat dist = u_distanceAndEdlStrength.x;\nvec2 texCoordOrig = v_textureCoordinates + offset * dist;\nvec2 texCoord0 = v_textureCoordinates + offset * floor(dist);\nvec2 texCoord1 = v_textureCoordinates + offset * ceil(dist);\nfloat depthOrLogDepth0 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord0));\nfloat depthOrLogDepth1 = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, texCoord1));\nif (depthOrLogDepth0 == 0.0 || depthOrLogDepth1 == 0.0) {\nreturn vec2(0.0);\n}\nfloat depthMix = mix(depthOrLogDepth0, depthOrLogDepth1, fract(dist));\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(texCoordOrig, depthMix);\nreturn vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);\n}\nvoid main()\n{\nfloat depthOrLogDepth = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates));\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);\neyeCoordinate /= eyeCoordinate.w;\nfloat log2Depth = log2(-eyeCoordinate.z);\nif (depthOrLogDepth == 0.0)\n{\ndiscard;\n}\nvec4 color = texture2D(u_pointCloud_colorGBuffer, v_textureCoordinates);\nvec2 texelSize = 1.0 / czm_viewport.zw;\nvec2 responseAndCount = vec2(0.0);\nresponseAndCount += neighborContribution(log2Depth, vec2(-texelSize.x, 0.0));\nresponseAndCount += neighborContribution(log2Depth, vec2(+texelSize.x, 0.0));\nresponseAndCount += neighborContribution(log2Depth, vec2(0.0, -texelSize.y));\nresponseAndCount += neighborContribution(log2Depth, vec2(0.0, +texelSize.y));\nfloat response = responseAndCount.x / responseAndCount.y;\nfloat strength = u_distanceAndEdlStrength.y;\nfloat shade = exp(-response * 300.0 * strength);\ncolor.rgb *= shade;\ngl_FragColor = vec4(color);\n#ifdef LOG_DEPTH\nczm_writeLogDepth(1.0 + (czm_projection * vec4(eyeCoordinate.xyz, 1.0)).w);\n#else\ngl_FragDepthEXT = czm_eyeToWindowCoordinates(vec4(eyeCoordinate.xyz, 1.0)).z;\n#endif\n}\n";function lT(){this._framebuffer=void 0,this._colorGBuffer=void 0,this._depthGBuffer=void 0,this._depthTexture=void 0,this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}function cT(e){var t=e._framebuffer;Ze(t)&&(e._colorGBuffer.destroy(),e._depthGBuffer.destroy(),e._depthTexture.destroy(),t.destroy(),e._framebuffer=void 0,e._colorGBuffer=void 0,e._depthGBuffer=void 0,e._depthTexture=void 0,e._drawCommand=void 0,e._clearCommand=void 0)}var hT=new En;function fT(e,t){var n,r,i,o,a,s,u,l,c,h,f,p,d=t.drawingBufferWidth,m=t.drawingBufferHeight,_=e._colorGBuffer,g=!1,y=Ze(_)&&(_.width!==d||_.height!==m);return Ze(_)&&!y||(cT(e),s=e,l=(u=t).drawingBufferWidth,c=u.drawingBufferHeight,h=new ti({context:u,width:l,height:c,pixelFormat:Ln.RGBA,pixelDatatype:Pn.UNSIGNED_BYTE,sampler:Nr.NEAREST}),f=new ti({context:u,width:l,height:c,pixelFormat:Ln.RGBA,pixelDatatype:Pn.UNSIGNED_BYTE,sampler:Nr.NEAREST}),p=new ti({context:u,width:l,height:c,pixelFormat:Ln.DEPTH_COMPONENT,pixelDatatype:Pn.UNSIGNED_INT,sampler:Nr.NEAREST}),s._framebuffer=new sT({context:u,colorTextures:[h,f],depthTexture:p,destroyAttachments:!1}),s._colorGBuffer=h,s._depthGBuffer=f,s._depthTexture=p,n=e,r=t,i=uT,o={u_pointCloud_colorGBuffer:function(){return n._colorGBuffer},u_pointCloud_depthGBuffer:function(){return n._depthGBuffer},u_distanceAndEdlStrength:function(){return hT.x=n._radius,hT.y=n._strength,hT}},a=sr.fromCache({blending:ui.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:Ti.setCesium3DTileBit(),stencilMask:Ti.CESIUM_3D_TILE_MASK}),n._drawCommand=r.createViewportQuadCommand(i,{uniformMap:o,renderState:a,pass:yn.CESIUM_3D_TILE,owner:n}),n._clearCommand=new iT({framebuffer:n._framebuffer,color:new It(0,0,0,0),depth:1,renderState:sr.fromCache(),pass:yn.CESIUM_3D_TILE,owner:n}),g=!0),g}function pT(e){return e.drawBuffers&&e.fragmentDepth}function dT(e){var t=Je(e,{});this.attenuation=Je(t.attenuation,!1),this.geometricErrorScale=Je(t.geometricErrorScale,1),this.maximumAttenuation=t.maximumAttenuation,this.baseResolution=t.baseResolution,this.eyeDomeLighting=Je(t.eyeDomeLighting,!0),this.eyeDomeLightingStrength=Je(t.eyeDomeLightingStrength,1),this.eyeDomeLightingRadius=Je(t.eyeDomeLightingRadius,1),this.backFaceCulling=Je(t.backFaceCulling,!1),this.normalShading=Je(t.normalShading,!0)}function mT(e,t,n,r,i){var o,u,a,s,l;this._tileset=e,this._tile=t,this._resource=n,this._pickId=void 0,this._batchTable=void 0,this._styleDirty=!1,this._features=void 0,this.featurePropertiesDirty=!1,this._pointCloud=new UE({arrayBuffer:r,byteOffset:i,cull:!1,opaquePass:yn.CESIUM_3D_TILE,useElevation:e._useElevation,elevationMap:e._elevationMap,vertexShaderLoaded:function(e){return Ze(l._batchTable)?l._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(e):e},fragmentShaderLoaded:function(e){return Ze(s._batchTable)?s._batchTable.getFragmentShaderCallback(!1,void 0)(e):"uniform vec4 czm_pickColor;\n"+e},uniformMapLoaded:function(e){return Ze(a._batchTable)?a._batchTable.getUniformMapCallback()(e):ne(e,{czm_pickColor:function(){return a._pickId.color}})},batchTableLoaded:function(e,t,n){var r=new no(u,e,t,n);if(u._batchTable=r,Ze(u._tile._header.EVID))for(var i=r.featuresLength,o=0;o<i;o++)r.setProperty(o,"EVID",u._tile._header.EVID);this._readyPromise.then(function(e){if(e.useElevation)if(Ze(u.tileset.elevationMax))e.elevationMax=u.tileset.elevationMax,e.elevationMin=u.tileset.elevationMin;else{var t=e._parsedContent.styleableProperties;if(t.hasOwnProperty("elevation")){for(var n=t.elevation.typedArray,r=n[0],i=n[0],o=n.length,a=1;a<o;a++)var s=n[a],r=s<r?r:s,i=i<s?i:s;e.elevationMax=r,e.elevationMin=i,u.tileset.elevationMax=r,u.tileset.elevationMin=i}}})},pickIdLoaded:(o=u=a=s=l=this,function(){return Ze(o._batchTable)?o._batchTable.getPickId():"czm_pickColor"})})}lT.isSupported=pT,lT.prototype.update=function(e,t,n,r){if(pT(e.context)){this._strength=n.eyeDomeLightingStrength,this._radius=n.eyeDomeLightingRadius*e.pixelRatio;for(var i,o,a,s,u,l=fT(this,e.context),c=e.commandList,h=c.length,f=t;f<h;++f){var p,d=c[f];d.primitiveType===Dn.POINTS&&d.pass!==yn.TRANSLUCENT&&(Ze(p=d.derivedCommands.pointCloudProcessor)&&!d.dirty&&!l&&p.framebuffer===this._framebuffer||(p=Mn.shallowClone(d),(d.derivedCommands.pointCloudProcessor=p).framebuffer=this._framebuffer,p.shaderProgram=(i=e.context,o=d.shaderProgram,u=s=a=void 0,Ze(u=i.shaderCache.getDerivedShaderProgram(o,"EC"))||(a=o._attributeLocations,(s=o.fragmentShaderSource.clone()).sources=s.sources.map(function(e){return e=(e=Xr.replaceMain(e,"czm_point_cloud_post_process_main")).replace(/gl_FragColor/g,"gl_FragData[0]")}),s.sources.unshift("#extension GL_EXT_draw_buffers : enable \n"),s.sources.push("void main() \n{ \n    czm_point_cloud_post_process_main(); \n#ifdef LOG_DEPTH\n    czm_writeLogDepth();\n    gl_FragData[1] = czm_packDepth(gl_FragDepthEXT); \n#else\n    gl_FragData[1] = czm_packDepth(gl_FragCoord.z);\n#endif\n}"),u=i.shaderCache.createDerivedShaderProgram(o,"EC",{vertexShaderSource:o.vertexShaderSource,fragmentShaderSource:s,attributeLocations:a})),u),p.castShadows=!1,p.receiveShadows=!1),c[f]=p)}var m=this._clearCommand,_=this._drawCommand;_.boundingVolume=r,c.push(_),c.push(m)}},lT.prototype.isDestroyed=function(){return!1},lT.prototype.destroy=function(){return cT(this),Vt(this)},dT.isSupported=function(e){return lT.isSupported(e.context)},Object.defineProperties(mT.prototype,{featuresLength:{get:function(){return Ze(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return Ze(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}}),mT.prototype.hasProperty=function(e,t){return!!Ze(this._batchTable)&&this._batchTable.hasProperty(e,t)},mT.prototype.getFeature=function(e){if(Ze(this._batchTable)){this.featuresLength;return function(e){var t=e.featuresLength;if(!Ze(e._features)&&0<t){for(var n=new Array(t),r=0;r<t;++r)n[r]=new Fo(e,r);e._features=n}}(this),this._features[e]}},mT.prototype.applyDebugSettings=function(e,t){this._pointCloud.color=e?t:It.WHITE},mT.prototype.applyStyle=function(e){Ze(this._batchTable)?this._batchTable.applyStyle(e):this._styleDirty=!0};var _T=new dT;function gT(e,t,n,r,i){this._tileset=e,this._tile=t,this._resource=n,this._readyPromise=D.defer(),this.featurePropertiesDirty=!1,function(t,e,n){n=Je(n,0);var r,i=kt(new Uint8Array(e),n);try{r=JSON.parse(i)}catch(e){return t._readyPromise.reject(new de("Invalid tile content."))}t._tileset.loadTileset(t._resource,r,t._tile),t._readyPromise.resolve(t)}(this,r,i)}function yT(e,t,n,r){this.near=Je(e,0),this.nearValue=Je(t,0),this.far=Je(n,1),this.farValue=Je(r,0)}function vT(e,t,n,r){var i=vT._verifyAttributes(t);n=Je(n,0);for(var o,a,s,u,l=[],c={},h=i.length,f=0;f<h;++f){var p=i[f];p.vertexBuffer?l.push(p):(Ze(o=c[a=p.usage])||(o=c[a]=[]),o.push(p))}function d(e,t){return Mt.getSizeInBytes(t.componentDatatype)-Mt.getSizeInBytes(e.componentDatatype)}for(a in this._allBuffers=[],c){c.hasOwnProperty(a)&&((o=c[a]).sort(d),u={vertexSizeInBytes:s=vT._vertexSizeInBytes(o),vertexBuffer:void 0,usage:o[0].usage,needsCommit:!1,arrayBuffer:void 0,arrayViews:vT._createArrayViews(o,s)},this._allBuffers.push(u))}this._size=0,this._instanced=Je(r,!1),this._precreated=l,this._context=e,this.writers=void 0,this.va=void 0,this.resize(n)}mT.prototype.update=function(e,t){var n,r=this._pointCloud,i=Je(e.pointCloudShading,_T),o=this._tile,a=this._batchTable,s=t.mode,u=e.clippingPlanes;Ze(this._pickId)||Ze(a)||(this._pickId=t.context.createPickId({primitive:e,content:this})),Ze(a)&&a.update(e,t),n=Ze(o._contentBoundingVolume)?s===Tl.SCENE3D?o._contentBoundingVolume.boundingSphere:o._contentBoundingVolume2D.boundingSphere:s===Tl.SCENE3D?o._boundingVolume.boundingSphere:o._boundingVolume2D.boundingSphere;var l,c,h,f,p,d=this._styleDirty;this._styleDirty=!1,r.clippingPlanesOriginMatrix=e.clippingPlanesOriginMatrix,r.style=e.style,r.styleDirty=d,r.modelMatrix=o.computedTransform,r.time=e.timeSinceLoad,r.shadows=e.shadows,r.boundingSphere=n,r.clippingPlanes=u,r.isClipped=Ze(u)&&u.enabled&&o._isClipped,r.clippingPlanesDirty=o.clippingPlanesDirty,r.attenuation=i.attenuation,r.backFaceCulling=i.backFaceCulling,r.normalShading=i.normalShading,r.geometricError=(c=(l=this)._tileset.pointCloudShading,h=l._tile.contentBoundingVolume.boundingSphere.volume(),f=pt.cbrt(h/l.pointsLength),0===(p=l._tile.geometricError)&&(p=Ze(c)&&Ze(c.baseResolution)?c.baseResolution:f),p),r.geometricErrorScale=i.geometricErrorScale,Ze(i)&&Ze(i.maximumAttenuation)?r.maximumAttenuation=i.maximumAttenuation:o.refine===zE.ADD?r.maximumAttenuation=5:r.maximumAttenuation=e.maximumScreenSpaceError,r.update(t)},mT.prototype.isDestroyed=function(){return!1},mT.prototype.destroy=function(){return this._pickId=this._pickId&&this._pickId.destroy(),this._pointCloud=this._pointCloud&&this._pointCloud.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)},Object.defineProperties(gT.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}}),gT.prototype.hasProperty=function(e,t){return!1},gT.prototype.getFeature=function(e){},gT.prototype.applyDebugSettings=function(e,t){},gT.prototype.applyStyle=function(e){},gT.prototype.update=function(e,t){},gT.prototype.isDestroyed=function(){return!1},gT.prototype.destroy=function(){return Vt(this)},yT.clone=function(e,t){if(Ze(e))return Ze(t)?(t.near=e.near,t.nearValue=e.nearValue,t.far=e.far,t.farValue=e.farValue,t):new yT(e.near,e.nearValue,e.far,e.farValue)},yT.packedLength=4,yT.pack=function(e,t,n){return n=Je(n,0),t[n++]=e.near,t[n++]=e.nearValue,t[n++]=e.far,t[n]=e.farValue,t},yT.unpack=function(e,t,n){return t=Je(t,0),Ze(n)||(n=new yT),n.near=e[t++],n.nearValue=e[t++],n.far=e[t++],n.farValue=e[t],n},yT.equals=function(e,t){return e===t||Ze(e)&&Ze(t)&&e.near===t.near&&e.nearValue===t.nearValue&&e.far===t.far&&e.farValue===t.farValue},yT.prototype.clone=function(e){return yT.clone(this,e)},yT.prototype.equals=function(e){return yT.equals(this,e)},vT._verifyAttributes=function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i={index:Je(r.index,n),enabled:Je(r.enabled,!0),componentsPerAttribute:r.componentsPerAttribute,componentDatatype:Je(r.componentDatatype,Mt.FLOAT),normalize:Je(r.normalize,!1),vertexBuffer:r.vertexBuffer,usage:Je(r.usage,wl.STATIC_DRAW)};t.push(i)}for(var o=new Array(t.length),a=0;a<t.length;++a){o[t[a].index]=!0}return t},vT._vertexSizeInBytes=function(e){for(var t=0,n=e.length,r=0;r<n;++r){var i=e[r];t+=i.componentsPerAttribute*Mt.getSizeInBytes(i.componentDatatype)}var o=0<n?Mt.getSizeInBytes(e[0].componentDatatype):0,a=0<o?t%o:0;return t+=0==a?0:o-a},vT._createArrayViews=function(e,t){for(var n=[],r=0,i=e.length,o=0;o<i;++o){var a=e[o],s=a.componentDatatype;n.push({index:a.index,enabled:a.enabled,componentsPerAttribute:a.componentsPerAttribute,componentDatatype:s,normalize:a.normalize,offsetInBytes:r,vertexSizeInComponentType:t/Mt.getSizeInBytes(s),view:void 0}),r+=a.componentsPerAttribute*Mt.getSizeInBytes(s)}return n},vT.prototype.resize=function(e){this._size=e;var t=this._allBuffers;this.writers=[];for(var n=0,r=t.length;n<r;++n){var i=t[n];vT._resize(i,this._size),vT._appendWriters(this.writers,i)}TT(this)},vT._resize=function(e,t){if(0<e.vertexSizeInBytes){var n=new ArrayBuffer(t*e.vertexSizeInBytes);if(Ze(e.arrayBuffer))for(var r=new Uint8Array(n),i=new Uint8Array(e.arrayBuffer),o=i.length,a=0;a<o;++a)r[a]=i[a];for(var s=e.arrayViews,u=s.length,l=0;l<u;++l){var c=s[l];c.view=Mt.createArrayBufferView(c.componentDatatype,n,c.offsetInBytes)}e.arrayBuffer=n}};var xT=[function(n,r,i){return function(e,t){r[e*i]=t,n.needsCommit=!0}},function(i,o,a){return function(e,t,n){var r=e*a;o[r]=t,o[1+r]=n,i.needsCommit=!0}},function(o,a,s){return function(e,t,n,r){var i=e*s;a[i]=t,a[1+i]=n,a[2+i]=r,o.needsCommit=!0}},function(a,s,u){return function(e,t,n,r,i){var o=e*u;s[o]=t,s[1+o]=n,s[2+o]=r,s[3+o]=i,a.needsCommit=!0}}];function bT(e,t){if(t.needsCommit&&0<t.vertexSizeInBytes){t.needsCommit=!1;var n=t.vertexBuffer,r=e._size*t.vertexSizeInBytes,i=Ze(n);if(!i||n.sizeInBytes<r)return i&&n.destroy(),t.vertexBuffer=Al.createVertexBuffer({context:e._context,typedArray:t.arrayBuffer,usage:t.usage}),!(t.vertexBuffer.vertexArrayDestroyable=!1);t.vertexBuffer.copyFromArrayView(t.arrayBuffer)}return!1}function ET(e,t,n){var r,i;e.needsCommit&&0<e.vertexSizeInBytes&&(r=e.vertexSizeInBytes*t,i=e.vertexSizeInBytes*n,e.vertexBuffer.copyFromArrayView(new Uint8Array(e.arrayBuffer,r,i),r))}function TT(e){var t=e.va;if(Ze(t)){for(var n=t.length,r=0;r<n;++r)t[r].va.destroy();e.va=void 0}}vT._appendWriters=function(e,t){for(var n=t.arrayViews,r=n.length,i=0;i<r;++i){var o=n[i];e[o.index]=xT[o.componentsPerAttribute-1](t,o.view,o.vertexSizeInComponentType)}},vT.prototype.commit=function(e){var t,n=!1,r=this._allBuffers;for(l=0,c=r.length;l<c;++l)n=bT(this,t=r[l])||n;if(n||!Ze(this.va)){TT(this);for(var i=this.va=[],o=pt.SIXTY_FOUR_KILOBYTES-4,a=Ze(e)&&!this._instanced?Math.ceil(this._size/o):1,s=0;s<a;++s){for(var u=[],l=0,c=r.length;l<c;++l){var h=s*((t=r[l]).vertexSizeInBytes*o);vT._appendAttributes(u,t,h,this._instanced)}u=u.concat(this._precreated),i.push({va:new Ac({context:this._context,attributes:u,indexBuffer:e}),indicesCount:1.5*(s!==a-1?o:this._size%o)})}}},vT._appendAttributes=function(e,t,n,r){for(var i=t.arrayViews,o=i.length,a=0;a<o;++a){var s=i[a];e.push({index:s.index,enabled:s.enabled,componentsPerAttribute:s.componentsPerAttribute,componentDatatype:s.componentDatatype,normalize:s.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:n+s.offsetInBytes,strideInBytes:t.vertexSizeInBytes,instanceDivisor:r?1:0})}},vT.prototype.subCommit=function(e,t){for(var n=this._allBuffers,r=0,i=n.length;r<i;++r)ET(n[r],e,t)},vT.prototype.endSubCommits=function(){for(var e=this._allBuffers,t=0,n=e.length;t<n;++t)e[t].needsCommit=!1},vT.prototype.isDestroyed=function(){return!1},vT.prototype.destroy=function(){for(var e=this._allBuffers,t=0,n=e.length;t<n;++t){var r=e[t];r.vertexBuffer=r.vertexBuffer&&r.vertexBuffer.destroy()}return TT(this),Vt(this)};var ST=Object.freeze({CENTER:0,LEFT:1,RIGHT:-1}),CT={},wT=new qt(0,0,0,1),AT=new qt,IT=new tr,PT=new En,OT=new En;CT.wgs84ToWindowCoordinates=function(e,t,n){return CT.wgs84WithEyeOffsetToWindowCoordinates(e,t,_t.ZERO,n)};var LT=new qt,NT=new _t;function RT(e,t,n,r){var i=n.viewMatrix,o=on.multiplyByVector(i,qt.fromElements(e.x,e.y,e.z,1,LT),LT),a=_t.multiplyComponents(t,_t.normalize(o,NT),NT);return o.x+=t.x+a.x,o.y+=t.y+a.y,o.z+=a.z,on.multiplyByVector(n.frustum.projectionMatrix,o,r)}var DT=new Un(Math.PI,pt.PI_OVER_TWO),MT=new _t,FT=new _t;CT.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,n,r){var i=e.frameState,o=CT.computeActualWgs84Position(i,t,wT);if(Ze(o)){var a=e.canvas,s=IT;s.x=0,s.y=0,s.width=a.clientWidth,s.height=a.clientHeight;var u,l,c,h,f,p,d,m,_,g,y=e.camera,v=!1;if(i.mode===Tl.SCENE2D&&(u=e.mapProjection.project(DT,MT),l=_t.clone(y.position,FT),c=y.frustum.clone(),h=on.computeViewportTransformation(s,0,1,new on),f=y.frustum.projectionMatrix,p=y.positionWC.y,d=_t.fromElements(pt.sign(p)*u.x-p,0,-y.positionWC.x),m=bs.pointToGLWindowCoordinates(f,h,d),0===p||m.x<=0||m.x>=a.clientWidth?v=!0:(AT=(m.x>.5*a.clientWidth?(s.width=m.x,y.frustum.right=u.x-p,AT=RT(o,n,y,AT),CT.clipToGLWindowCoordinates(s,AT,PT),s.x+=m.x,y.position.x=-y.position.x,_=y.frustum.right,y.frustum.right=-y.frustum.left,y.frustum.left=-_):(s.x+=m.x,s.width-=m.x,y.frustum.left=-u.x-p,AT=RT(o,n,y,AT),CT.clipToGLWindowCoordinates(s,AT,PT),s.x=s.x-s.width,y.position.x=-y.position.x,g=y.frustum.left,y.frustum.left=-y.frustum.right,y.frustum.right=-g),RT(o,n,y,AT)),CT.clipToGLWindowCoordinates(s,AT,OT),_t.clone(l,y.position),y.frustum=c.clone(),((r=En.clone(PT,r)).x<0||r.x>a.clientWidth)&&(r.x=OT.x))),i.mode!==Tl.SCENE2D||v){if((AT=RT(o,n,y,AT)).z<0&&!(y.frustum instanceof rE)&&!(y.frustum instanceof Zb))return;r=CT.clipToGLWindowCoordinates(s,AT,r)}return r.y=a.clientHeight-r.y,r}},CT.wgs84ToDrawingBufferCoordinates=function(e,t,n){if(Ze(n=CT.wgs84ToWindowCoordinates(e,t,n)))return CT.transformWindowToDrawingBuffer(e,n,n)};var zT=new _t,BT=new Un;CT.computeActualWgs84Position=function(e,t,n){var r=e.mode;if(r===Tl.SCENE3D)return _t.clone(t,n);var i=e.mapProjection,o=i.ellipsoid.cartesianToCartographic(t,BT);if(Ze(o)){if(i.project(o,zT),r===Tl.COLUMBUS_VIEW)return _t.fromElements(zT.z,zT.x,zT.y,n);if(r===Tl.SCENE2D)return _t.fromElements(0,zT.x,zT.y,n);var a=e.morphTime;return _t.fromElements(pt.lerp(zT.z,t.x,a),pt.lerp(zT.x,t.y,a),pt.lerp(zT.y,t.z,a),n)}};var UT=new _t,VT=new _t,kT=new on;CT.clipToGLWindowCoordinates=function(e,t,n){return _t.divideByScalar(t,t.w,UT),on.computeViewportTransformation(e,0,1,kT),on.multiplyByPoint(kT,UT,VT),En.fromCartesian3(VT,n)},CT.transformWindowToDrawingBuffer=function(e,t,n){var r=e.canvas,i=e.drawingBufferWidth/r.clientWidth,o=e.drawingBufferHeight/r.clientHeight;return En.fromElements(t.x*i,t.y*o,n)};var GT=new qt,qT=new qt;CT.drawingBufferToWgs84Coordinates=function(e,t,n,r){var i,o=e.context.uniformState,a=o.currentFrustum,s=a.x,u=a.y;e.frameState.useLogDepth&&(i=n*o.log2FarDepthFromNearPlusOne,n=u*(1-s/(Math.pow(2,i)-1+s))/(u-s));var l,c=e.view.passState.viewport,h=qt.clone(qt.UNIT_W,GT);h.x=(t.x-c.x)/c.width*2-1,h.y=(t.y-c.y)/c.height*2-1,h.z=2*n-1,h.w=1;var f,p=e.camera.frustum;return Ze(p.fovy)?(f=1/(l=on.multiplyByVector(o.inverseViewProjection,h,qT)).w,_t.multiplyByScalar(l,f,l)):(Ze(p._offCenterFrustum)&&(p=p._offCenterFrustum),(l=qT).x=.5*(h.x*(p.right-p.left)+p.left+p.right),l.y=.5*(h.y*(p.top-p.bottom)+p.bottom+p.top),l.z=.5*(h.z*(s-u)-s-u),l.w=1,l=on.multiplyByVector(o.inverseView,l,l)),_t.fromCartesian4(l,r)};var HT=Object.freeze({CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1});function WT(e,t){var n=(e=Je(e,Je.EMPTY_OBJECT)).translucencyByDistance,r=e.pixelOffsetScaleByDistance,i=e.scaleByDistance,o=e.distanceDisplayCondition;Ze(n)&&(n=yT.clone(n)),Ze(r)&&(r=yT.clone(r)),Ze(i)&&(i=yT.clone(i)),Ze(o)&&(o=wf.clone(o)),this._dynamicUpdateHeight=Je(e.dynamicUpdateHeight,!1),this._show=Je(e.show,!0),this._position=_t.clone(Je(e.position,_t.ZERO)),this._actualPosition=_t.clone(this._position),this._pixelOffset=En.clone(Je(e.pixelOffset,En.ZERO)),this._translate=new En(0,0),this._eyeOffset=_t.clone(Je(e.eyeOffset,_t.ZERO)),this._heightReference=Je(e.heightReference,Ap.NONE),this._verticalOrigin=Je(e.verticalOrigin,HT.CENTER),this._horizontalOrigin=Je(e.horizontalOrigin,ST.CENTER),this._scale=Je(e.scale,1),this._color=It.clone(Je(e.color,It.WHITE)),this._rotation=Je(e.rotation,0),this._alignedAxis=_t.clone(Je(e.alignedAxis,_t.ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=i,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=r,this._sizeInMeters=Je(e.sizeInMeters,!1),this._distanceDisplayCondition=o,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=Je(e.collection,t),this._pickId=void 0,this._pickPrimitive=Je(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;var a=e.image,s=e.imageId;Ze(a)&&(Ze(s)||(s="string"==typeof a?a:Ze(a.src)?a.src:Jr()),this._imageId=s,this._image=a),Ze(e.imageSubRegion)&&(this._imageId=s,this._imageSubRegion=e.imageSubRegion),Ze(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=Tl.SCENE3D,this._clusterShow=!0,this._outlineColor=It.clone(Je(e.outlineColor,It.BLACK)),this._outlineWidth=Je(e.outlineWidth,0),this._animation=Je(e.animation,!1),this._updateClamping()}var YT=WT.SHOW_INDEX=0,XT=WT.POSITION_INDEX=1,jT=WT.PIXEL_OFFSET_INDEX=2,KT=WT.EYE_OFFSET_INDEX=3,QT=WT.HORIZONTAL_ORIGIN_INDEX=4,ZT=WT.VERTICAL_ORIGIN_INDEX=5,JT=WT.SCALE_INDEX=6,$T=WT.IMAGE_INDEX_INDEX=7,eS=WT.COLOR_INDEX=8,tS=WT.ROTATION_INDEX=9,nS=WT.ALIGNED_AXIS_INDEX=10,rS=WT.SCALE_BY_DISTANCE_INDEX=11,iS=WT.TRANSLUCENCY_BY_DISTANCE_INDEX=12,oS=WT.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,aS=WT.DISTANCE_DISPLAY_CONDITION=14,sS=WT.DISABLE_DEPTH_DISTANCE=15;WT.TEXTURE_COORDINATE_BOUNDS=16;var uS=WT.SDF_INDEX=17;function lS(e,t){var n=e._billboardCollection;Ze(n)&&(n._updateBillboard(e,t),e._dirty=!0)}WT.NUMBER_OF_PROPERTIES=18,Object.defineProperties(WT.prototype,{show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,lS(this,YT))}},position:{get:function(){return this._position},set:function(e){var t=this._position;_t.equals(t,e)||(_t.clone(e,t),_t.clone(e,this._actualPosition),this._updateClamping(),lS(this,XT))}},heightReference:{get:function(){return this._heightReference},set:function(e){e!==this._heightReference&&(this._heightReference=e,this._updateClamping(),lS(this,XT))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){var t=this._pixelOffset;En.equals(t,e)||(En.clone(e,t),lS(this,jT))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){var t=this._scaleByDistance;yT.equals(t,e)||(this._scaleByDistance=yT.clone(e,t),lS(this,rS))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){var t=this._translucencyByDistance;yT.equals(t,e)||(this._translucencyByDistance=yT.clone(e,t),lS(this,iS))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){var t=this._pixelOffsetScaleByDistance;yT.equals(t,e)||(this._pixelOffsetScaleByDistance=yT.clone(e,t),lS(this,oS))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){var t=this._eyeOffset;_t.equals(t,e)||(_t.clone(e,t),lS(this,KT))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin!==e&&(this._horizontalOrigin=e,lS(this,QT))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin!==e&&(this._verticalOrigin=e,lS(this,ZT))}},scale:{get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e,lS(this,JT))}},color:{get:function(){return this._color},set:function(e){var t=this._color;It.equals(t,e)||(It.clone(e,t),lS(this,eS))}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,lS(this,tS))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){var t=this._alignedAxis;_t.equals(t,e)||(_t.clone(e,t),lS(this,nS))}},width:{get:function(){return Je(this._width,this._imageWidth)},set:function(e){this._width!==e&&(this._width=e,lS(this,$T))}},height:{get:function(){return Je(this._height,this._imageHeight)},set:function(e){this._height!==e&&(this._height=e,lS(this,$T))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){this._sizeInMeters!==e&&(this._sizeInMeters=e,lS(this,eS))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){wf.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=wf.clone(e,this._distanceDisplayCondition),lS(this,aS))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,lS(this,sS))}},id:{get:function(){return this._id},set:function(e){this._id=e,Ze(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,Ze(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){Ze(e)?"string"==typeof e?this.setImage(e,e):e instanceof rt?this.setImage(e.url,e):Ze(e.src)?this.setImage(e.src,e):this.setImage(Jr(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,lS(this,$T))}},ready:{get:function(){return-1!==this._imageIndex}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=_t.clone(e,this._actualClampedPosition),lS(this,XT)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,lS(this,YT))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){var t=this._outlineColor;It.equals(t,e)||(It.clone(e,t),lS(this,uS))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,lS(this,uS))}},animation:{get:function(){return this._animation},set:function(e){this._animation!==e&&(this._animation=e)}}}),WT.prototype.getPickId=function(e){return Ze(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId},WT.prototype._updateClamping=function(){WT._updateClamping(this._billboardCollection,this)};var cS=new Un,hS=new _t;WT._updateClamping=function(e,n){var t,r,i,o,a,s,u,l=e._scene;function c(e){var t;n._heightReference===Ap.RELATIVE_TO_GROUND&&(n._mode===Tl.SCENE3D?((t=r.cartesianToCartographic(e,cS)).height+=s.height,r.cartographicToCartesian(t,e)):e.x+=s.height),n._clampedPosition=_t.clone(e,n._clampedPosition)}Ze(l)&&Ze(l.globe)&&(t=l.globe,r=t.ellipsoid,i=t._surface,a=(o=l.frameState.mode)!==n._mode,n._mode=o,(n._heightReference===Ap.NONE||a)&&Ze(n._removeCallbackFunc)&&(n._removeCallbackFunc(),n._removeCallbackFunc=void 0,n._clampedPosition=void 0),n._heightReference!==Ap.NONE&&Ze(n._position)&&(Ze(s=r.cartesianToCartographic(n._position))?(Ze(n._removeCallbackFunc)&&n._removeCallbackFunc(),n._removeCallbackFunc=i.updateHeight(s,c),Un.clone(s,cS),n._dynamicUpdateHeight||Ze(u=t.fastGetHeight(s))&&(cS.height=u),r.cartographicToCartesian(cS,hS),c(hS)):n._actualClampedPosition=void 0))},WT.prototype._loadImage=function(){var e,n,r=this._billboardCollection._textureAtlas,i=this._imageId,o=this._image,a=this._imageSubRegion;Ze(o)&&(e=r.addImage(i,o)),Ze(a)&&(e=r.addSubRegion(i,a)),Ze(this._imageIndexPromise=e)&&(n=this,e.then(function(e){var t;n._imageId===i&&n._image===o&&tr.equals(n._imageSubRegion,a)&&(t=r.textureCoordinates[e],n._imageWidth=r.texture.width*t.width,n._imageHeight=r.texture.height*t.height,n._imageIndex=e,n._ready=!0,n._imageIndexPromise=void 0,lS(n,$T))}).otherwise(function(e){console.error("Error loading image for billboard: "+e),n._imageIndexPromise=void 0}))},WT.prototype._updateImage=function(){this._billboardCollection._textureAtlas.updateImage(this._imageIndex,this._image)},WT.prototype.setImage=function(e,t){this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,Ze(this._billboardCollection._textureAtlas)&&this._loadImage())},WT.prototype.setImageSubRegion=function(e,t){this._imageId===e&&tr.equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=tr.clone(t),Ze(this._billboardCollection._textureAtlas)&&this._loadImage())},WT.prototype._setTranslate=function(e){var t=this._translate;En.equals(t,e)||(En.clone(e,t),lS(this,jT))},WT.prototype._getActualPosition=function(){return Ze(this._clampedPosition)?this._clampedPosition:this._actualPosition},WT.prototype._setActualPosition=function(e){Ze(this._clampedPosition)||_t.clone(e,this._actualPosition),lS(this,XT)};var fS=new qt;WT._computeActualPosition=function(e,t,n,r){return Ze(e._clampedPosition)?(n.mode!==e._mode&&e._updateClamping(),e._clampedPosition):n.mode===Tl.SCENE3D?t:(on.multiplyByPoint(r,t,fS),CT.computeActualWgs84Position(n,fS))};var pS=new _t;WT._computeScreenSpacePosition=function(e,t,n,r,i,o){var a=on.multiplyByPoint(e,t,pS),s=CT.wgs84WithEyeOffsetToWindowCoordinates(i,a,n,o);if(Ze(s))return En.add(s,r,s),s};var dS=new En(0,0);WT.prototype.computeScreenSpacePosition=function(e,t){var n=this._billboardCollection;Ze(t)||(t=new En),En.clone(this._pixelOffset,dS),En.add(dS,this._translate,dS);var r,i,o,a=n.modelMatrix,s=this._position;return Ze(this._clampedPosition)&&(s=this._clampedPosition,e.mode!==Tl.SCENE3D&&(i=(r=e.mapProjection).ellipsoid,o=r.unproject(s,cS),s=i.cartographicToCartesian(o,pS),a=on.IDENTITY)),WT._computeScreenSpacePosition(a,s,this._eyeOffset,dS,e,t)},WT.getScreenSpaceBoundingBox=function(e,t,n){var r=e.width,i=e.height,o=e.scale;r*=o,i*=o;var a=t.x;e.horizontalOrigin===ST.RIGHT?a-=r:e.horizontalOrigin===ST.CENTER&&(a-=.5*r);var s=t.y;return e.verticalOrigin===HT.BOTTOM||e.verticalOrigin===HT.BASELINE?s-=i:e.verticalOrigin===HT.CENTER&&(s-=.5*i),Ze(n)||(n=new tr),n.x=a,n.y=s,n.width=r,n.height=i,n},WT.prototype.equals=function(e){return this===e||Ze(e)&&this._id===e._id&&_t.equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&tr.equals(this._imageSubRegion,e._imageSubRegion)&&It.equals(this._color,e._color)&&En.equals(this._pixelOffset,e._pixelOffset)&&En.equals(this._translate,e._translate)&&_t.equals(this._eyeOffset,e._eyeOffset)&&yT.equals(this._scaleByDistance,e._scaleByDistance)&&yT.equals(this._translucencyByDistance,e._translucencyByDistance)&&yT.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&wf.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance},WT.prototype._destroy=function(){Ze(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),Ze(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0};var mS=Object.freeze({OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2}),_S=Object.freeze({FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25});function gS(e,t,n,r,i){this.bottomLeft=Je(e,En.ZERO),this.topRight=Je(t,En.ZERO),this.childNode1=n,this.childNode2=r,this.imageIndex=i}var yS=new En(16,16);function vS(e){e=Je(e,Je.EMPTY_OBJECT);var t=Je(e.borderWidthInPixels,1),n=Je(e.initialSize,yS);this._context=e.context,this._pixelFormat=Je(e.pixelFormat,Ln.RGBA),this._borderWidthInPixels=t,this._textureCoordinates=[],this._guid=Jr(),this._idHash={},this._initialSize=n,this._root=void 0}function xS(e,t,n){var r,i,o,a,s,u,l,c,h=function e(t,n,r){if(Ze(n)){if(Ze(n.childNode1)||Ze(n.childNode2))return e(t,n.childNode1,r)||e(t,n.childNode2,r);if(Ze(n.imageIndex))return;var i,o,a=n.topRight.x-n.bottomLeft.x,s=n.topRight.y-n.bottomLeft.y,u=a-r.width,l=s-r.height;if(u<0||l<0)return;return 0==u&&0==l?n:(l<u?(n.childNode1=new gS(new En(n.bottomLeft.x,n.bottomLeft.y),new En(n.bottomLeft.x+r.width,n.topRight.y)),(i=n.bottomLeft.x+r.width+t._borderWidthInPixels)<n.topRight.x&&(n.childNode2=new gS(new En(i,n.bottomLeft.y),new En(n.topRight.x,n.topRight.y)))):(n.childNode1=new gS(new En(n.bottomLeft.x,n.bottomLeft.y),new En(n.topRight.x,n.bottomLeft.y+r.height)),(o=n.bottomLeft.y+r.height+t._borderWidthInPixels)<n.topRight.y&&(n.childNode2=new gS(new En(n.bottomLeft.x,o),new En(n.topRight.x,n.topRight.y)))),e(t,n.childNode1,r))}}(e,e._root,t);Ze(h)?(h.imageIndex=n,r=e._texture.width,i=e._texture.height,o=h.topRight.x-h.bottomLeft.x,a=h.topRight.y-h.bottomLeft.y,s=h.bottomLeft.x/r,u=h.bottomLeft.y/i,l=o/r,c=a/i,e._textureCoordinates[n]=new tr(s,u,l,c),e._texture.copyFrom(t,h.bottomLeft.x,h.bottomLeft.y)):(function(e,t){var n=e._context,r=e.numberOfImages,i=e._borderWidthInPixels;if(0<r){for(var o=e._texture.width,a=e._texture.height,s=2*(o+t.width+i),u=2*(a+t.height+i),l=o/s,c=a/u,h=new gS(new En(o+i,i),new En(s,a)),f=new gS(new En,new En(s,a),e._root,h),p=new gS(new En(i,a+i),new En(s,u)),d=new gS(new En,new En(s,u),f,p),m=0;m<e._textureCoordinates.length;m++){var _=e._textureCoordinates[m];Ze(_)&&(_.x*=l,_.y*=c,_.width*=l,_.height*=c)}var g=new ti({context:e._context,width:s,height:u,pixelFormat:e._pixelFormat}),y=new sT({context:n,colorTextures:[e._texture],destroyAttachments:!1});y._bind(),g.copyFromFramebuffer(0,0,0,0,s,u),y._unBind(),y.destroy(),e._texture=e._texture&&e._texture.destroy(),e._texture=g,e._root=d}else{var v=2*(t.width+2*i),x=2*(t.height+2*i);v<e._initialSize.x&&(v=e._initialSize.x),x<e._initialSize.y&&(x=e._initialSize.y),e._texture=e._texture&&e._texture.destroy(),e._texture=new ti({context:e._context,width:v,height:x,pixelFormat:e._pixelFormat}),e._root=new gS(new En(i,i),new En(v,x))}}(e,t),xS(e,t,n)),e._guid=Jr()}Object.defineProperties(vS.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return Ze(this._texture)||(this._texture=new ti({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}}),vS.prototype.addImage=function(e,t){if(Ze(r=this._idHash[e]))return r;"function"==typeof t?t=t(e):("string"==typeof t||t instanceof rt)&&(t=rt.createIfNeeded(t).fetchImage());var n=this,r=D(t,function(e){if(n.isDestroyed())return-1;var t=n.numberOfImages;return xS(n,e,t),t});return this._idHash[e]=r},vS.prototype.updateImage=function(e,t){var n=this._textureCoordinates[e],r=this._texture,i=Math.round(n.x*r.width),o=Math.round(n.y*r.height);r.copyFrom(t,i,o)},vS.prototype.addSubRegion=function(e,l){var t=this._idHash[e];if(!Ze(t))throw new de('image with id "'+e+'" not found in the atlas.');var c=this;return D(t,function(e){if(-1===e)return-1;var t=c._texture.width,n=c._texture.height,r=c.numberOfImages,i=c._textureCoordinates[e],o=i.x+l.x/t,a=i.y+l.y/n,s=l.width/t,u=l.height/n;return c._textureCoordinates.push(new tr(o,a,s,u)),c._guid=Jr(),r})},vS.prototype.isDestroyed=function(){return!1},vS.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Vt(this)};var bS,ES,TS=WT.SHOW_INDEX,SS=WT.POSITION_INDEX,CS=WT.PIXEL_OFFSET_INDEX,wS=WT.EYE_OFFSET_INDEX,AS=WT.HORIZONTAL_ORIGIN_INDEX,IS=WT.VERTICAL_ORIGIN_INDEX,PS=WT.SCALE_INDEX,OS=WT.IMAGE_INDEX_INDEX,LS=WT.COLOR_INDEX,NS=WT.ROTATION_INDEX,RS=WT.ALIGNED_AXIS_INDEX,DS=WT.SCALE_BY_DISTANCE_INDEX,MS=WT.TRANSLUCENCY_BY_DISTANCE_INDEX,FS=WT.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,zS=WT.DISTANCE_DISPLAY_CONDITION,BS=WT.DISABLE_DEPTH_DISTANCE,US=WT.TEXTURE_COORDINATE_BOUNDS,VS=WT.SDF_INDEX,kS=WT.NUMBER_OF_PROPERTIES,GS={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11},qS={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12};function HS(e){e=Je(e,Je.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(kS),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new ko,this._baseVolumeWC=new ko,this._baseVolume2D=new ko,this._boundingVolume=new ko,this._boundingVolumeDirty=!1,this._colorCommands=[],this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this._modelMatrix=on.clone(on.IDENTITY),this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=Je(e.debugShowTextureAtlas,!1),this.blendOption=Je(e.blendOption,mS.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=Tl.SCENE3D,this._buffersUsage=[wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW,wl.STATIC_DRAW],this._highlightColor=It.clone(It.WHITE);var t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};var n=this._scene;Ze(n)&&Ze(n.terrainProviderChanged)&&(this._removeCallbackFunc=n.terrainProviderChanged.addEventListener(function(){for(var e=this._billboards,t=e.length,n=0;n<t;++n)Ze(e[n])&&e[n]._updateClamping()},this))}function WS(e){for(var t=e.length,n=0;n<t;++n)e[n]&&e[n]._destroy()}function YS(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;for(var t=[],n=e._billboards,r=n.length,i=0,o=0;i<r;++i){var a=n[i];a&&(a._index=o++,t.push(a))}e._billboards=t}}function XS(e){var t=e.cache.billboardCollection_indexBufferBatched;if(Ze(t))return t;for(var n=new Uint16Array(98298),r=0,i=0;r<98298;r+=6,i+=4)n[r]=i,n[r+1]=i+1,n[r+2]=i+2,n[r+3]=i+0,n[r+4]=i+2,n[r+5]=i+3;return(t=Al.createIndexBuffer({context:e,typedArray:n,usage:wl.STATIC_DRAW,indexDatatype:wa.UNSIGNED_SHORT})).vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=t}function jS(e){var t=e.cache.billboardCollection_indexBufferInstanced;return Ze(t)?t:((t=Al.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:wl.STATIC_DRAW,indexDatatype:wa.UNSIGNED_SHORT})).vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t)}function KS(e,t,n,r,i,o){var a,s,u=[{index:bS.positionHighAndScale,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[SS]},{index:bS.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[SS]},{index:bS.compressedAttribute0,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[CS]},{index:bS.compressedAttribute1,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[MS]},{index:bS.compressedAttribute2,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[LS]},{index:bS.eyeOffset,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[wS]},{index:bS.scaleByDistance,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[DS]},{index:bS.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[FS]},{index:bS.compressedAttribute3,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[zS]},{index:bS.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,usage:n[US]}];return r&&u.push({index:bS.direction,componentsPerAttribute:2,componentDatatype:Mt.FLOAT,vertexBuffer:Ze(s=(a=e).cache.billboardCollection_vertexBufferInstanced)?s:((s=Al.createVertexBuffer({context:a,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:wl.STATIC_DRAW})).vertexArrayDestroyable=!1,a.cache.billboardCollection_vertexBufferInstanced=s)}),Ze(i)&&u.push({index:bS.a_batchId,componentsPerAttribute:1,componentDatatyps:Mt.FLOAT,bufferUsage:wl.STATIC_DRAW}),o&&u.push({index:bS.sdf,componentsPerAttribute:2,componentDatatype:Mt.FLOAT,usage:n[VS]}),new vT(e,u,r?t:4*t,r)}Object.defineProperties(HS.prototype,{length:{get:function(){return YS(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}}),HS.prototype.add=function(e){var t=new WT(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t},HS.prototype.remove=function(e){return!!this.contains(e)&&(this._billboards[e._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},HS.prototype.resize=function(e){return this.removeAll(),this._billboards=e,this._billboardsRemoved=!0,this._createVertexArray=!0},HS.prototype.removeAll=function(){WS(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},HS.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]},HS.prototype.contains=function(e){return Ze(e)&&e._billboardCollection===this},HS.prototype.get=function(e){return YS(this),this._billboards[e]},HS.prototype.computeNewBuffersUsage=function(){for(var e=this._buffersUsage,t=!1,n=this._propertiesChanged,r=0;r<kS;++r){var i=0===n[r]?wl.STATIC_DRAW:wl.STREAM_DRAW,t=t||e[r]!==i;e[r]=i}return t};var QS=new $d;function ZS(e,t,n,r,i){var o,a=r[bS.positionHighAndScale],s=r[bS.positionLowAndRotation],u=i._getActualPosition();e._mode===Tl.SCENE3D&&(ko.expand(e._baseVolume,u,e._baseVolume),e._boundingVolumeDirty=!0),$d.fromCartesian(u,QS);var l=i.scale,c=i.rotation;0!==c&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,l);var h=QS.high,f=QS.low;e._instanced?(a(o=i._index,h.x,h.y,h.z,l),s(o,f.x,f.y,f.z,c)):(a((o=4*i._index)+0,h.x,h.y,h.z,l),a(o+1,h.x,h.y,h.z,l),a(o+2,h.x,h.y,h.z,l),a(o+3,h.x,h.y,h.z,l),s(o+0,f.x,f.y,f.z,c),s(o+1,f.x,f.y,f.z,c),s(o+2,f.x,f.y,f.z,c),s(o+3,f.x,f.y,f.z,c))}var JS=new En,$S=32768,eC=65536,tC=4096,nC=256,rC=128,iC=32,oC=8,aC=4,sC=1/256,uC=0,lC=2,cC=3,hC=1;function fC(e,t,n,r,i){var o,a=r[bS.compressedAttribute0],s=i.pixelOffset,u=s.x,l=s.y,c=i._translate,h=c.x,f=c.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(u+h),Math.abs(-l+f));var p=i.horizontalOrigin,d=i._verticalOrigin,m=i.show&&i.clusterShow;0===i.color.alpha&&(m=!1),d===HT.BASELINE&&(d=HT.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&p===ST.CENTER,e._allVerticalCenter=e._allVerticalCenter&&d===HT.CENTER;var _,g=0,y=0,v=0,x=0,b=i._imageIndex;-1!==b&&(g=(_=n[b]).x,y=_.y,v=_.width,x=_.height);var E=g+v,T=y+x,S=Math.floor(pt.clamp(u,-$S,$S)+$S)*rC;S+=(p+1)*iC,S+=(d+1)*oC,S+=(m?1:0)*aC;var C=Math.floor(pt.clamp(l,-$S,$S)+$S)*nC,w=Math.floor(pt.clamp(h,-$S,$S)+$S)*nC,A=(pt.clamp(f,-$S,$S)+$S)*sC,I=Math.floor(A);C+=I,w+=Math.floor((A-I)*nC),JS.x=g,JS.y=y;var P=Hf.compressTextureCoordinates(JS);JS.x=E;var O=Hf.compressTextureCoordinates(JS);JS.y=T;var L=Hf.compressTextureCoordinates(JS);JS.x=g;var N=Hf.compressTextureCoordinates(JS);e._instanced?a(o=i._index,S,C,w,P):(a((o=4*i._index)+0,S+uC,C,w,P),a(o+1,S+lC,C,w,O),a(o+2,S+cC,C,w,L),a(o+3,S+hC,C,w,N))}function pC(e,t,n,r,i){var o,a=r[bS.compressedAttribute1],s=i.alignedAxis;_t.equals(s,_t.ZERO)||(e._shaderAlignedAxis=!0);var u=0,l=1,c=1,h=1,f=i.translucencyByDistance;Ze(f)&&(u=f.near,l=f.nearValue,c=f.far,h=f.farValue,1===l&&1===h||(e._shaderTranslucencyByDistance=!0));var p=0,d=i._imageIndex;-1!==d&&(p=n[d].width);var m=e._textureAtlas.texture.width,_=Math.round(Je(i.width,m*p));e._maxSize=Math.max(e._maxSize,_);var g=pt.clamp(_,0,eC),y=0;Math.abs(_t.magnitudeSquared(s)-1)<pt.EPSILON6&&(y=Hf.octEncodeFloat(s)),l=pt.clamp(l,0,1),g=g*nC+(l=1===l?255:255*l|0),h=pt.clamp(h,0,1),y=y*nC+(h=1===h?255:255*h|0),e._instanced?a(o=i._index,g,y,u,c):(a((o=4*i._index)+0,g,y,u,c),a(o+1,g,y,u,c),a(o+2,g,y,u,c),a(o+3,g,y,u,c))}function dC(e,t,n,r,i){var o,a=r[bS.compressedAttribute2],s=i.color,u=Ze(e._batchTable)?It.WHITE:i.getPickId(t).color,l=i.sizeInMeters?1:0,c=Math.abs(_t.magnitudeSquared(i.alignedAxis)-1)<pt.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&1==l;var h=0,f=i._imageIndex;-1!==f&&(h=n[f].height);var p=e._textureAtlas.texture.dimensions,d=Math.round(Je(i.height,p.y*h));e._maxSize=Math.max(e._maxSize,d);var m=Je(i._labelHorizontalOrigin,-2),_=d*aC+(m+=2),g=It.floatToByte(s.red),y=It.floatToByte(s.green),v=It.floatToByte(s.blue),x=g*eC+y*nC+v,g=It.floatToByte(u.red),y=It.floatToByte(u.green),v=It.floatToByte(u.blue),b=g*eC+y*nC+v,E=It.floatToByte(s.alpha)*eC+It.floatToByte(u.alpha)*nC;E+=2*l+c,e._instanced?a(o=i._index,x,b,E,_):(a((o=4*i._index)+0,x,b,E,_),a(o+1,x,b,E,_),a(o+2,x,b,E,_),a(o+3,x,b,E,_))}function mC(e,t,n,r,i){var o,a,s,u,l,c,h=r[bS.eyeOffset],f=i.eyeOffset,p=f.z;i._heightReference!==Ap.NONE&&(p*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(f.x),Math.abs(f.y),Math.abs(p)),e._instanced?(u=s=0,-1!==(o=i._imageIndex)&&(s=(a=n[o]).width,u=a.height),JS.x=s,JS.y=u,l=Hf.compressTextureCoordinates(JS),h(c=i._index,f.x,f.y,p,l)):(h((c=4*i._index)+0,f.x,f.y,p,0),h(c+1,f.x,f.y,p,0),h(c+2,f.x,f.y,p,0),h(c+3,f.x,f.y,p,0))}function _C(e,t,n,r,i){var o,a=r[bS.scaleByDistance],s=0,u=1,l=1,c=1,h=i.scaleByDistance;Ze(h)&&(s=h.near,u=h.nearValue,l=h.far,c=h.farValue,1===u&&1===c||(e._shaderScaleByDistance=!0)),e._instanced?a(o=i._index,s,u,l,c):(a((o=4*i._index)+0,s,u,l,c),a(o+1,s,u,l,c),a(o+2,s,u,l,c),a(o+3,s,u,l,c))}function gC(e,t,n,r,i){var o,a=r[bS.pixelOffsetScaleByDistance],s=0,u=1,l=1,c=1,h=i.pixelOffsetScaleByDistance;Ze(h)&&(s=h.near,u=h.nearValue,l=h.far,c=h.farValue,1===u&&1===c||(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?a(o=i._index,s,u,l,c):(a((o=4*i._index)+0,s,u,l,c),a(o+1,s,u,l,c),a(o+2,s,u,l,c),a(o+3,s,u,l,c))}function yC(e,t,n,r,i){var o,a=r[bS.compressedAttribute3],s=0,u=Number.MAX_VALUE,l=i.distanceDisplayCondition;Ze(l)&&(s=l.near,u=l.far,s*=s,u*=u,e._shaderDistanceDisplayCondition=!0);var c,h,f,p,d,m,_,g=i.disableDepthTestDistance,y=i.heightReference===Ap.CLAMP_TO_GROUND&&e._scene.context.depthTexture;Ze(g)||(g=y?5e3:0),g*=g,(y||0<g)&&(e._shaderDisableDepthDistance=!0,g===Number.POSITIVE_INFINITY&&(g=-1)),Ze(i._labelDimensions)?(_=i._labelDimensions.x,c=i._labelDimensions.y):(d=p=0,-1!==(h=i._imageIndex)&&(p=(f=n[h]).height,d=f.width),c=Math.round(Je(i.height,e._textureAtlas.texture.dimensions.y*p)),m=e._textureAtlas.texture.width,_=Math.round(Je(i.width,m*d)));var v=Math.floor(pt.clamp(_,0,tC)),x=Math.floor(pt.clamp(c,0,tC)),b=v*tC+x;e._instanced?a(o=i._index,s,u,g,b):(a((o=4*i._index)+0,s,u,g,b),a(o+1,s,u,g,b),a(o+2,s,u,g,b),a(o+3,s,u,g,b))}function vC(e,t,n,r,i){var o;i.heightReference===Ap.CLAMP_TO_GROUND&&(e._shaderClampToGround=e._scene.context.depthTexture);var a=r[bS.textureCoordinateBoundsOrLabelTranslate];if(0<Nn.maximumVertexTextureImageUnits){var s=0,u=0;return Ze(i._labelTranslate)&&(s=i._labelTranslate.x,u=i._labelTranslate.y),void(e._instanced?a(o=i._index,s,u,0,0):(a((o=4*i._index)+0,s,u,0,0),a(o+1,s,u,0,0),a(o+2,s,u,0,0),a(o+3,s,u,0,0)))}var l,c=0,h=0,f=0,p=0,d=i._imageIndex;-1!==d&&(c=(l=n[d]).x,h=l.y,f=l.width,p=l.height);var m=c+f,_=h+p;e._instanced?a(o=i._index,c,h,m,_):(a((o=4*i._index)+0,c,h,m,_),a(o+1,c,h,m,_),a(o+2,c,h,m,_),a(o+3,c,h,m,_))}function xC(e,t,n,r,i){var o,a,s,u,l,c,h,f,p,d;e._sdf&&(a=r[bS.sdf],s=i.outlineColor,u=i.outlineWidth,l=It.floatToByte(s.red),c=It.floatToByte(s.green),h=It.floatToByte(s.blue),f=l*eC+c*nC+h,p=u/_S.RADIUS,d=It.floatToByte(s.alpha)*eC+It.floatToByte(p)*nC,e._instanced?a(o=i._index,f,d):(a((o=4*i._index)+0,f+uC,d),a(o+1,f+lC,d),a(o+2,f+cC,d),a(o+3,f+hC,d)))}function bC(e,t,n,r,i){var o,a,s,u,l,c;ZS(e,0,0,r,i),fC(e,0,n,r,i),pC(e,0,n,r,i),dC(e,t,n,r,i),mC(e,0,n,r,i),_C(e,0,0,r,i),gC(e,0,0,r,i),yC(e,0,n,r,i),vC(e,0,n,r,i),a=r,s=i,Ze((o=e)._batchTable)&&(u=a[bS.a_batchId],l=s._batchIndex,o._instanced?u(c=s._index,l):(u((c=4*s._index)+0,l),u(c+1,l),u(c+2,l),u(c+3,l))),xC(e,0,0,r,i)}function EC(e,t,n,r,i,o){var a;r.mode===Tl.SCENE3D?(a=e._baseVolume,e._boundingVolumeDirty=!0):a=e._baseVolume2D;for(var s=[],u=0;u<n;++u){var l=t[u],c=l.position,h=WT._computeActualPosition(l,c,r,i);Ze(h)&&(l._setActualPosition(h),o?s.push(h):ko.expand(a,h,a))}o&&ko.fromPoints(s,a)}var TC=[];function SC(e,t,n,r,i){this._content=e,this._billboard=n,this._label=r,this._polyline=i,this._batchId=t,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._exOffset=void 0,this._pickIds=new Array(3),wC(this)}HS.prototype.update=function(e){YS(this);var t=this._billboards,n=t.length,r=e.context;this._instanced=r.instancedArrays,bS=this._instanced?qS:GS,ES=this._instanced?jS:XS;var i=this._textureAtlas;if(Ze(i))for(o=0;o<n;++o){(b=t[o]).animation&&b.ready&&b._updateImage()}else{i=this._textureAtlas=new vS({context:r});for(var o=0;o<n;++o)t[o]._loadImage()}var a,s,u,l,c,h,f=i.textureCoordinates;if(0!==f.length){a=this,u=(s=e).mode,l=a._billboards,c=a._billboardsToUpdate,h=a._modelMatrix,a._createVertexArray||a._mode!==u||u!==Tl.SCENE3D&&!on.equals(h,a.modelMatrix)?(a._mode=u,on.clone(a.modelMatrix,h),a._createVertexArray=!0,u!==Tl.SCENE3D&&u!==Tl.SCENE2D&&u!==Tl.COLUMBUS_VIEW||EC(a,l,l.length,s,h,!0)):u===Tl.MORPHING?EC(a,l,l.length,s,h,!0):u!==Tl.SCENE2D&&u!==Tl.COLUMBUS_VIEW||EC(a,c,a._billboardsToUpdateIndex,s,h,!1),n=(t=this._billboards).length;var p=this._billboardsToUpdate,d=this._billboardsToUpdateIndex,m=this._propertiesChanged,_=i.guid,g=this._createVertexArray||this._textureAtlasGUID!==_;this._textureAtlasGUID=_;var y=e.passes,v=y.pick;if(g||!v&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(var x=0;x<kS;++x)m[x]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),0<n){this._vaf=KS(r,n,this._buffersUsage,this._instanced,this._batchTable,this._sdf),C=this._vaf.writers;for(var b,E=0;E<n;++E){(b=this._billboards[E])._dirty=!1,bC(this,r,f,C,b)}this._vaf.commit(ES(r))}this._billboardsToUpdateIndex=0}else if(0<d){var T=TC;T.length=0,(m[SS]||m[NS]||m[PS])&&T.push(ZS),(m[OS]||m[CS]||m[AS]||m[IS]||m[TS])&&(T.push(fC),this._instanced&&T.push(mC)),(m[OS]||m[RS]||m[MS])&&(T.push(pC),T.push(dC)),(m[OS]||m[LS])&&T.push(dC),m[wS]&&T.push(mC),m[DS]&&T.push(_C),m[FS]&&T.push(gC),(m[zS]||m[BS]||m[OS]||m[SS])&&T.push(yC),(m[OS]||m[SS])&&T.push(vC),m[VS]&&T.push(xC);var S=T.length,C=this._vaf.writers;if(.1<d/n){for(var w=0;w<d;++w){var A=p[w];A._dirty=!1;for(var I=0;I<S;++I)T[I](this,r,f,C,A)}this._vaf.commit(ES(r))}else{for(var P=0;P<d;++P){var O=p[P];O._dirty=!1;for(var L=0;L<S;++L)T[L](this,r,f,C,O);this._instanced?this._vaf.subCommit(O._index,1):this._vaf.subCommit(4*O._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(1.5*n<d&&(p.length=n),Ze(this._vaf)&&Ze(this._vaf.va)){this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,ko.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));var N,R=on.IDENTITY;(function(e,t,n){var r=1;e._allSizedInMeters&&0===e._maxPixelOffset||(r=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight));var i=r*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(i*=.5);var o=r*e._maxPixelOffset+e._maxEyeOffset;n.radius+=i+o})(this,e,N=e.mode===Tl.SCENE3D?(R=this.modelMatrix,ko.clone(this._baseVolumeWC,this._boundingVolume)):ko.clone(this._baseVolume2D,this._boundingVolume));var D,M,F,z,B,U,V=this._blendOption!==this.blendOption;this._blendOption=this.blendOption,V&&(this._blendOption===mS.OPAQUE||this._blendOption===mS.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=sr.fromCache({depthTest:{enabled:!0,func:Rt.LESS},depthMask:!0}):this._rsOpaque=void 0,D=this._blendOption===mS.TRANSLUCENT,this._blendOption===mS.TRANSLUCENT||this._blendOption===mS.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=sr.fromCache({depthTest:{enabled:!0,func:D?Rt.LEQUAL:Rt.LESS},depthMask:D,blending:ui.ALPHA_BLEND}):this._rsTranslucent=void 0),this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==e.minimumDisableDepthTestDistance;var k,G,q=0<Nn.maximumVertexTextureImageUnits;!V&&this._shaderRotation===this._compiledShaderRotation&&this._shaderAlignedAxis===this._compiledShaderAlignedAxis&&this._shaderScaleByDistance===this._compiledShaderScaleByDistance&&this._shaderTranslucencyByDistance===this._compiledShaderTranslucencyByDistance&&this._shaderPixelOffsetScaleByDistance===this._compiledShaderPixelOffsetScaleByDistance&&this._shaderDistanceDisplayCondition===this._compiledShaderDistanceDisplayCondition&&this._shaderDisableDepthDistance===this._compiledShaderDisableDepthDistance&&this._shaderClampToGround===this._compiledShaderClampToGround&&this._sdf===this._compiledSDF||(M="#ifdef INSTANCED\nattribute vec2 direction;\n#endif\nattribute vec4 positionHighAndScale;\nattribute vec4 positionLowAndRotation;\nattribute vec4 compressedAttribute0;\nattribute vec4 compressedAttribute1;\nattribute vec4 compressedAttribute2;\nattribute vec4 eyeOffset;\nattribute vec4 scaleByDistance;\nattribute vec4 pixelOffsetScaleByDistance;\nattribute vec4 compressedAttribute3;\nattribute vec2 sdf;\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\nattribute vec4 textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef VECTOR_TILE\nattribute float a_batchId;\n#endif\nvarying vec2 v_textureCoordinates;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\n#endif\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\nconst float UPPER_BOUND = 32768.0;\nconst float SHIFT_LEFT16 = 65536.0;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT8 = 256.0;\nconst float SHIFT_LEFT7 = 128.0;\nconst float SHIFT_LEFT5 = 32.0;\nconst float SHIFT_LEFT3 = 8.0;\nconst float SHIFT_LEFT2 = 4.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT8 = 1.0 / 256.0;\nconst float SHIFT_RIGHT7 = 1.0 / 128.0;\nconst float SHIFT_RIGHT5 = 1.0 / 32.0;\nconst float SHIFT_RIGHT3 = 1.0 / 8.0;\nconst float SHIFT_RIGHT2 = 1.0 / 4.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nvec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)\n{\nvec2 halfSize = imageSize * scale * 0.5;\nhalfSize *= ((direction * 2.0) - 1.0);\nvec2 originTranslate = origin * abs(halfSize);\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nif (validAlignedAxis || rotation != 0.0)\n{\nfloat angle = rotation;\nif (validAlignedAxis)\n{\nvec4 projectedAlignedAxis = czm_modelViewProjection * vec4(alignedAxis, 0.0);\nangle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /\n(projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));\n}\nfloat cosTheta = cos(angle);\nfloat sinTheta = sin(angle);\nrotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);\nhalfSize = rotationMatrix * halfSize;\n}\nelse\n{\nrotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n}\n#endif\nmpp = czm_metersPerPixel(positionEC);\npositionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);\npositionEC.xy += (translate + pixelOffset) * mpp;\nreturn positionEC;\n}\n#ifdef VERTEX_DEPTH_CHECK\nfloat getGlobeDepth(vec4 positionEC)\n{\nvec4 posWC = czm_eyeToWindowCoordinates(positionEC);\nfloat globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));\nif (globeDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(posWC.xy, globeDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\nvec3 positionHigh = positionHighAndScale.xyz;\nvec3 positionLow = positionLowAndRotation.xyz;\nfloat scale = positionHighAndScale.w;\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nfloat rotation = positionLowAndRotation.w;\n#else\nfloat rotation = 0.0;\n#endif\nfloat compressed = compressedAttribute0.x;\nvec2 pixelOffset;\npixelOffset.x = floor(compressed * SHIFT_RIGHT7);\ncompressed -= pixelOffset.x * SHIFT_LEFT7;\npixelOffset.x -= UPPER_BOUND;\nvec2 origin;\norigin.x = floor(compressed * SHIFT_RIGHT5);\ncompressed -= origin.x * SHIFT_LEFT5;\norigin.y = floor(compressed * SHIFT_RIGHT3);\ncompressed -= origin.y * SHIFT_LEFT3;\n#ifdef FRAGMENT_DEPTH_CHECK\nvec2 depthOrigin = origin.xy;\n#endif\norigin -= vec2(1.0);\nfloat show = floor(compressed * SHIFT_RIGHT2);\ncompressed -= show * SHIFT_LEFT2;\n#ifdef INSTANCED\nvec2 textureCoordinatesBottomLeft = czm_decompressTextureCoordinates(compressedAttribute0.w);\nvec2 textureCoordinatesRange = czm_decompressTextureCoordinates(eyeOffset.w);\nvec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;\n#else\nvec2 direction;\ndirection.x = floor(compressed * SHIFT_RIGHT1);\ndirection.y = compressed - direction.x * SHIFT_LEFT1;\nvec2 textureCoordinates = czm_decompressTextureCoordinates(compressedAttribute0.w);\n#endif\nfloat temp = compressedAttribute0.y  * SHIFT_RIGHT8;\npixelOffset.y = -(floor(temp) - UPPER_BOUND);\nvec2 translate;\ntranslate.y = (temp - floor(temp)) * SHIFT_LEFT16;\ntemp = compressedAttribute0.z * SHIFT_RIGHT8;\ntranslate.x = floor(temp) - UPPER_BOUND;\ntranslate.y += (temp - floor(temp)) * SHIFT_LEFT8;\ntranslate.y -= UPPER_BOUND;\ntemp = compressedAttribute1.x * SHIFT_RIGHT8;\nfloat temp2 = floor(compressedAttribute2.w * SHIFT_RIGHT2);\nvec2 imageSize = vec2(floor(temp), temp2);\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat labelHorizontalOrigin = floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));\nfloat applyTranslate = 0.0;\nif (labelHorizontalOrigin != 0.0)\n{\napplyTranslate = 1.0;\nlabelHorizontalOrigin -= 2.0;\ndepthOrigin.x = labelHorizontalOrigin + 1.0;\n}\ndepthOrigin = vec2(1.0) - (depthOrigin * 0.5);\n#endif\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;\ntranslucencyByDistance.x = compressedAttribute1.z;\ntranslucencyByDistance.z = compressedAttribute1.w;\ntranslucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\ntemp = compressedAttribute1.y * SHIFT_RIGHT8;\ntranslucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\ntemp = compressedAttribute3.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\n#endif\n#ifdef ALIGNED_AXIS\nvec3 alignedAxis = czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));\ntemp = compressedAttribute2.z * SHIFT_RIGHT5;\nbool validAlignedAxis = (temp - floor(temp)) * SHIFT_LEFT1 > 0.0;\n#else\nvec3 alignedAxis = vec3(0.0);\nbool validAlignedAxis = false;\n#endif\nvec4 pickColor;\nvec4 color;\ntemp = compressedAttribute2.y;\ntemp = temp * SHIFT_RIGHT8;\npickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor.r = floor(temp);\ntemp = compressedAttribute2.x;\ntemp = temp * SHIFT_RIGHT8;\ncolor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\ncolor.g = (temp - floor(temp)) * SHIFT_LEFT8;\ncolor.r = floor(temp);\ntemp = compressedAttribute2.z * SHIFT_RIGHT8;\nbool sizeInMeters = floor((temp - floor(temp)) * SHIFT_LEFT7) > 0.0;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor /= 255.0;\ncolor.a = floor(temp);\ncolor /= 255.0;\nvec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\nvec4 positionEC = czm_modelViewRelativeToEye * p;\n#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)\nfloat eyeDepth = positionEC.z;\n#endif\npositionEC = czm_eyeOffset(positionEC, eyeOffset.xyz);\npositionEC.xyz *= show;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq = dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef EYE_DISTANCE_SCALING\nfloat distanceScale = czm_nearFarScalar(scaleByDistance, lengthSq);\nscale *= distanceScale;\ntranslate *= distanceScale;\nif (scale == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nfloat translucency = 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency = czm_nearFarScalar(translucencyByDistance, lengthSq);\nif (translucency == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\n#ifdef EYE_DISTANCE_PIXEL_OFFSET\nfloat pixelOffsetScale = czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);\npixelOffset *= pixelOffsetScale;\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq = compressedAttribute3.x;\nfloat farSq = compressedAttribute3.y;\nif (lengthSq < nearSq || lengthSq > farSq)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nmat2 rotationMatrix;\nfloat mpp;\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance = compressedAttribute3.z;\n#endif\n#ifdef VERTEX_DEPTH_CHECK\nif (lengthSq < disableDepthTestDistance) {\nfloat depthsilon = 10.0;\nvec2 labelTranslate = textureCoordinateBoundsOrLabelTranslate.xy;\nvec4 pEC1 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth1 = getGlobeDepth(pEC1);\nif (globeDepth1 != 0.0 && pEC1.z + depthsilon < globeDepth1)\n{\nvec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth2 = getGlobeDepth(pEC2);\nif (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2)\n{\nvec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth3 = getGlobeDepth(pEC3);\nif (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3)\n{\npositionEC.xyz = vec3(0.0);\n}\n}\n}\n}\n#endif\npositionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\ngl_Position = czm_projection * positionEC;\nv_textureCoordinates = textureCoordinates;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth();\n#endif\n#ifdef DISABLE_DEPTH_DISTANCE\nif (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)\n{\ndisableDepthTestDistance = czm_minimumDisableDepthTestDistance;\n}\nif (disableDepthTestDistance != 0.0)\n{\nfloat zclip = gl_Position.z / gl_Position.w;\nbool clipped = (zclip < -1.0 || zclip > 1.0);\nif (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))\n{\ngl_Position.z = -gl_Position.w;\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = 1.0;\n#endif\n}\n}\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nif (sizeInMeters) {\ntranslate /= mpp;\ndimensions /= mpp;\nimageSize /= mpp;\n}\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nv_rotationMatrix = rotationMatrix;\n#else\nv_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n#endif\nfloat enableDepthCheck = 0.0;\nif (lengthSq < disableDepthTestDistance)\n{\nenableDepthCheck = 1.0;\n}\nfloat dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));\nfloat dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));\nfloat iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));\nfloat ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));\nv_compressed.x = eyeDepth;\nv_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck;\nv_compressed.z = dw * SHIFT_LEFT12 + dh;\nv_compressed.w = iw * SHIFT_LEFT12 + ih;\nv_originTextureCoordinateAndTranslate.xy = depthOrigin;\nv_originTextureCoordinateAndTranslate.zw = translate;\nv_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef SDF\nvec4 outlineColor;\nfloat outlineWidth;\ntemp = sdf.x;\ntemp = temp * SHIFT_RIGHT8;\noutlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.r = floor(temp);\ntemp = sdf.y;\ntemp = temp * SHIFT_RIGHT8;\nfloat temp3 = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineWidth = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.a = floor(temp);\noutlineColor /= 255.0;\nv_outlineWidth = outlineWidth / 255.0;\nv_outlineColor = outlineColor;\n#endif\nv_pickColor = pickColor;\nv_color = color;\nv_color.a *= translucency;\n}\n",F="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform sampler2D u_atlas;\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_textureCoordinates;\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nfloat getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)\n{\nvec2 lookupVector = imageSize * (depthLookupST - adjustedST);\nlookupVector = v_rotationMatrix * lookupVector;\nvec2 labelOffset = (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y));\nvec2 translation = v_originTextureCoordinateAndTranslate.zw;\nif (applyTranslate)\n{\ntranslation += (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));\n}\nvec2 st = ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;\nfloat logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st));\nif (logDepthOrDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\n#ifdef SDF\nfloat getDistance(vec2 position)\n{\nreturn texture2D(u_atlas, position).r;\n}\nvec4 getSDFColor(vec2 position, float outlineWidth, vec4 outlineColor, float smoothing)\n{\nfloat distance = getDistance(position);\nif (outlineWidth > 0.0)\n{\nfloat outlineEdge = clamp(SDF_EDGE - outlineWidth, 0.0, SDF_EDGE);\nfloat outlineFactor = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\nvec4 sdfColor = mix(outlineColor, v_color, outlineFactor);\nfloat alpha = smoothstep(outlineEdge - smoothing, outlineEdge + smoothing, distance);\nreturn vec4(sdfColor.rgb, sdfColor.a * alpha);\n}\nelse\n{\nfloat alpha = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\nreturn vec4(v_color.rgb, v_color.a * alpha);\n}\n}\n#endif\nvoid main()\n{\nvec4 color = texture2D(u_atlas, v_textureCoordinates);\n#ifdef SDF\nfloat outlineWidth = v_outlineWidth;\nvec4 outlineColor = v_outlineColor;\nfloat distance = getDistance(v_textureCoordinates);\n#ifdef GL_OES_standard_derivatives\nfloat smoothing = fwidth(distance);\nvec2 sampleOffset = 0.354 * vec2(dFdx(v_textureCoordinates) + dFdy(v_textureCoordinates));\nvec4 center = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\nvec4 color1 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color2 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color3 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color4 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\ncolor = (center + color1 + color2 + color3 + color4)/5.0;\n#else\nfloat smoothing = 1.0/32.0;\ncolor = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\n#endif\ncolor = czm_gammaCorrect(color);\n#else\ncolor = czm_gammaCorrect(color);\ncolor *= czm_gammaCorrect(v_color);\n#endif\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\nif (color.a < 0.005)\n{\ndiscard;\n}\n#else\n#ifdef OPAQUE\ndiscard;\n#endif\n#endif\n#ifdef VECTOR_TILE\ncolor *= u_highlightColor;\n#endif\ngl_FragColor = color;\n#ifdef LOG_DEPTH\nczm_writeLogDepth();\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat temp = v_compressed.y;\ntemp = temp * SHIFT_RIGHT1;\nfloat temp2 = (temp - floor(temp)) * SHIFT_LEFT1;\nbool enableDepthTest = temp2 != 0.0;\nbool applyTranslate = floor(temp) != 0.0;\nif (enableDepthTest) {\ntemp = v_compressed.z;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\ntemp = v_compressed.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 imageSize;\nimageSize.y = (temp - floor(temp)) * SHIFT_LEFT12;\nimageSize.x = floor(temp);\nvec2 adjustedST = v_textureCoordinates - v_textureCoordinateBounds.xy;\nadjustedST = adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);\nfloat epsilonEyeDepth = v_compressed.x + czm_epsilon1;\nfloat globeDepth1 = getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);\nif (globeDepth1 != 0.0 && globeDepth1 > epsilonEyeDepth)\n{\nfloat globeDepth2 = getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth2 != 0.0 && globeDepth2 > epsilonEyeDepth)\n{\nfloat globeDepth3 = getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth3 != 0.0 && globeDepth3 > epsilonEyeDepth)\n{\ndiscard;\n}\n}\n}\n}\n#endif\n}\n",U=[],Ze(this._batchTable)&&(U.push("VECTOR_TILE"),M=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(M),F=this._batchTable.getFragmentShaderCallback(!1,void 0)(F)),z=new Xr({defines:U,sources:[M]}),this._instanced&&z.defines.push("INSTANCED"),this._shaderRotation&&z.defines.push("ROTATION"),this._shaderAlignedAxis&&z.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&z.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&z.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&z.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&z.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&z.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(q?z.defines.push("VERTEX_DEPTH_CHECK"):z.defines.push("FRAGMENT_DEPTH_CHECK")),k=1-_S.CUTOFF,this._sdf&&z.defines.push("SDF"),G=Ze(this._batchTable)?"VECTOR_TILE":"",this._blendOption===mS.OPAQUE_AND_TRANSLUCENT&&(B=new Xr({defines:["OPAQUE",G],sources:[F]}),this._shaderClampToGround&&(q?B.defines.push("VERTEX_DEPTH_CHECK"):B.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(B.defines.push("SDF"),B.defines.push("SDF_EDGE "+k)),this._sp=ic.replaceCache({context:r,shaderProgram:this._sp,vertexShaderSource:z,fragmentShaderSource:B,attributeLocations:bS}),B=new Xr({defines:["TRANSLUCENT",G],sources:[F]}),this._shaderClampToGround&&(q?B.defines.push("VERTEX_DEPTH_CHECK"):B.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(B.defines.push("SDF"),B.defines.push("SDF_EDGE "+k)),this._spTranslucent=ic.replaceCache({context:r,shaderProgram:this._spTranslucent,vertexShaderSource:z,fragmentShaderSource:B,attributeLocations:bS})),this._blendOption===mS.OPAQUE&&(B=new Xr({defines:[G],sources:[F]}),this._shaderClampToGround&&(q?B.defines.push("VERTEX_DEPTH_CHECK"):B.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(B.defines.push("SDF"),B.defines.push("SDF_EDGE "+k)),this._sp=ic.replaceCache({context:r,shaderProgram:this._sp,vertexShaderSource:z,fragmentShaderSource:B,attributeLocations:bS})),this._blendOption===mS.TRANSLUCENT&&(B=new Xr({defines:[G],sources:[F]}),this._shaderClampToGround&&(q?B.defines.push("VERTEX_DEPTH_CHECK"):B.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(B.defines.push("SDF"),B.defines.push("SDF_EDGE "+k)),this._spTranslucent=ic.replaceCache({context:r,shaderProgram:this._spTranslucent,vertexShaderSource:z,fragmentShaderSource:B,attributeLocations:bS})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf);var H,W,Y,X=e.commandList;if(y.render||y.pick){var j=this._colorCommands,K=this._blendOption===mS.OPAQUE,Q=this._blendOption===mS.OPAQUE_AND_TRANSLUCENT,Z=this._vaf.va,J=Z.length,$=this._uniforms,ee=Ze(this._batchTable)?($=this._batchTable.getUniformMapCallback()($),this._batchTable.getPickId()):"v_pickColor";j.length=J;for(var te=Q?2*J:J,ne=0;ne<te;++ne){var re=j[ne];Ze(re)||(re=j[ne]=new Mn({}));var ie=K||Q&&ne%2==0;re.pass=ie||!Q?yn.OPAQUE:yn.TRANSLUCENT,re.owner=this;var oe=Q?Math.floor(ne/2):ne;re.boundingVolume=N,re.modelMatrix=R,re.count=Z[oe].indicesCount,re.shaderProgram=ie?this._sp:this._spTranslucent,re.uniformMap=$,re.vertexArray=Z[oe].va,re.renderState=ie?this._rsOpaque:this._rsTranslucent,re.debugShowBoundingVolume=this.debugShowBoundingVolume,re.pickId=ee,this._instanced&&(re.count=6,re.instanceCount=n),X.push(re)}this.debugShowTextureAtlas&&(Ze(this.debugCommand)||(this.debugCommand=(H=this,W=e.context,(Y=W.createViewportQuadCommand("uniform sampler2D billboard_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    gl_FragColor = texture2D(billboard_texture, v_textureCoordinates); \n} \n",{uniformMap:{billboard_texture:function(){return H._textureAtlas.texture}}})).pass=yn.OVERLAY,Y)),X.push(this.debugCommand))}}}},HS.prototype.isDestroyed=function(){return!1},HS.prototype.destroy=function(){return Ze(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),WS(this._billboards),Vt(this)};var CC=new Un;function wC(e){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m,_,g,y=e._billboard;Ze(e._billboardImage)&&e._billboardImage!==y.image?y.image=e._billboardImage:Ze(e._billboardImage)||(t=Je(e._color,SC.defaultColor),n=Je(e._pointOutlineColor,SC.defaultPointOutlineColor),r=Je(e._pointOutlineWidth,SC.defaultPointOutlineWidth),i=Je(e._pointSize,SC.defaultPointSize),o=e._billboardColor,a=e._billboardOutlineColor,s=e._billboardOutlineWidth,u=e._billboardSize,It.equals(t,o)&&It.equals(n,a)&&r===s&&i===u||(e._billboardColor=It.clone(t,e._billboardColor),e._billboardOutlineColor=It.clone(n,e._billboardOutlineColor),e._billboardOutlineWidth=r,e._billboardSize=i,l=t.alpha,c=t.toCssColorString(),h=n.toCssColorString(),f=JSON.stringify([c,i,h,r]),y.setImage(f,(p=l,d=c,m=h,_=r,g=i,function(){var e=document.createElement("canvas"),t=g+2*_;e.height=e.width=t;var n=e.getContext("2d");return n.clearRect(0,0,t,t),0!==_&&(n.beginPath(),n.arc(t/2,t/2,t/2,0,2*Math.PI,!0),n.closePath(),n.fillStyle=m,n.fill(),p<1&&(n.save(),n.globalCompositeOperation="destination-out",n.beginPath(),n.arc(t/2,t/2,g/2,0,2*Math.PI,!0),n.closePath(),n.fillStyle="black",n.fill(),n.restore())),n.beginPath(),n.arc(t/2,t/2,g/2,0,2*Math.PI,!0),n.closePath(),n.fillStyle=d,n.fill(),e}))))}Object.defineProperties(SC.prototype,{show:{get:function(){return this._label.show},set:function(e){this._label.show=e,this._billboard.show=e,this._polyline.show=e}},color:{get:function(){return this._color},set:function(e){this._color=It.clone(e,this._color),wC(this)}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=e,wC(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=It.clone(e,this._pointOutlineColor),wC(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=e,wC(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(e){this._label.fillColor=e,this._polyline.show=this._label.show&&0<e.alpha}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(e){this._label.outlineColor=e}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(e){this._label.outlineWidth=e}},font:{get:function(){return this._label.font},set:function(e){this._label.font=e}},labelStyle:{get:function(){return this._label.style},set:function(e){this._label.style=e}},labelText:{get:function(){return this._label.text},set:function(e){Ze(e)||(e=""),this._label.text=e}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(e){this._label.backgroundColor=e}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(e){this._label.backgroundPadding=e}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(e){this._label.showBackground=e}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(e){this._label.scaleByDistance=e,this._billboard.scaleByDistance=e}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(e){this._label.translucencyByDistance=e,this._billboard.translucencyByDistance=e}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(e){this._label.distanceDisplayCondition=e,this._polyline.distanceDisplayCondition=e,this._billboard.distanceDisplayCondition=e}},heightOffset:{get:function(){return this._heightOffset},set:function(e){var t=Je(this._heightOffset,0),n=this._content.tileset.ellipsoid,r=n.cartesianToCartographic(this._billboard.position,CC);r.height=r.height-t+e;var i=n.cartographicToCartesian(r);this._billboard.position=i,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],i],this._heightOffset=e}},exOffset:{get:function(){return this._exOffset},set:function(e){var t,n,r;e instanceof _t||(e=_t.ZERO),_t.equals(e,_t.ZERO)||(t=this.getProperty("worldMatrix"),n=on.fromArray(t),r=new _t,on.multiplyByPoint(n,e,r),this._billboard.position=r,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],r]),this._exOffset=e}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(e){this._polyline.show=e}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(e){this._polyline.material.uniforms.color=It.clone(e,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(e){var t=this._billboardImage!==e;this._billboardImage=e,t&&wC(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(e){this._label.disableDepthTestDistance=e,this._billboard.disableDepthTestDistance=e}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(e){this._billboard.horizontalOrigin=e}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(e){this._billboard.verticalOrigin=e}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(e){this._label.horizontalOrigin=e}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(e){this._label.verticalOrigin=e}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){var e=this._pickIds;return e[0]=this._billboard.pickId,e[1]=this._label.pickId,e[2]=this._polyline.pickId,e}}}),SC.defaultColor=It.WHITE,SC.defaultPointOutlineColor=It.BLACK,SC.defaultPointOutlineWidth=0,SC.defaultPointSize=8,SC.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)},SC.prototype.getPropertyNames=function(e){return this._content.batchTable.getPropertyNames(this._batchId,e)},SC.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)},SC.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0},SC.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)},SC.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)},SC.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};function AC(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}var IC,PC=function(e,t,n,r){var i=e.measureText(t),o=AC(e.canvas,"font-family"),a=AC(e.canvas,"font-size").replace("px",""),s=AC(e.canvas,"font-style"),u=AC(e.canvas,"font-weight"),l=!/\S/.test(t);i.fontsize=a;var c=document.createElement("div");c.style.position="absolute",c.style.opacity=0,c.style.font=s+" "+u+" "+a+"px "+o,c.innerHTML=t+"<br/>"+t,document.body.appendChild(c),i.leading=1.2*a;var h=AC(c,"height");if(2*a<=(h=h.replace("px",""))&&(i.leading=h/2|0),document.body.removeChild(c),l)i.ascent=0,i.descent=0,i.bounds={minx:0,maxx:i.width,miny:0,maxy:0},i.height=0;else{var f=document.createElement("canvas");f.width=i.width+100,f.height=3*a,f.style.opacity=1,f.style.fontFamily=o,f.style.fontSize=a,f.style.fontStyle=s,f.style.fontWeight=u;var p=f.getContext("2d");p.font=s+" "+u+" "+a+"px "+o;var d=f.width,m=f.height,_=m/2;p.fillStyle="white",p.fillRect(-1,-1,d+2,m+2),n&&(p.strokeStyle="black",p.lineWidth=e.lineWidth,p.strokeText(t,50,_)),r&&(p.fillStyle="black",p.fillText(t,50,_));for(var g=p.getImageData(0,0,d,m).data,y=0,v=4*d,x=g.length;++y<x&&255===g[y];);for(var b=y/v|0,y=x-1;0<--y&&255===g[y];);var E=y/v|0;for(y=0;y<x&&255===g[y];)x<=(y+=v)&&(y=y-x+4);var T=y%v/4|0,S=1;for(y=x-3;0<=y&&255===g[y];)(y-=v)<0&&(y=x-3-4*S++);var C=y%v/4+1|0;i.ascent=_-b,i.descent=E-_,i.bounds={minx:T-50,maxx:C-50,miny:0,maxy:E-b},i.height=E-b+1}return i};var OC=1e20;function LC(e,t){var n,r,i,o,a,s,u,l,c,h=null==(t=t||{}).cutoff?.25:t.cutoff,f=null==t.radius?8:t.radius,p=t.channel||0;if(ArrayBuffer.isView(e)||Array.isArray(e)){if(!t.width||!t.height)throw Error("For raw data width and height should be provided by options");n=t.width,r=t.height,o=e,s=t.stride?t.stride:Math.floor(e.length/n/r)}else window.HTMLCanvasElement&&e instanceof window.HTMLCanvasElement?(u=(l=e).getContext("2d"),n=l.width,r=l.height,o=(c=u.getImageData(0,0,n,r)).data,s=4):window.CanvasRenderingContext2D&&e instanceof window.CanvasRenderingContext2D?(n=(l=(u=e).canvas).width,r=l.height,o=(c=u.getImageData(0,0,n,r)).data,s=4):window.ImageData&&e instanceof window.ImageData&&(n=(c=e).width,r=e.height,o=c.data,s=4);if(i=Math.max(n,r),window.Uint8ClampedArray&&o instanceof window.Uint8ClampedArray||window.Uint8Array&&o instanceof window.Uint8Array)for(a=o,o=Array(n*r),x=0,b=a.length;x<b;x++)o[x]=a[x*s+p]/255;else if(1!==s)throw Error("Raw data can have only 1 value per pixel");for(var d=Array(n*r),m=Array(n*r),_=Array(i),g=Array(i),y=Array(i+1),v=Array(i),x=0,b=n*r;x<b;x++){var E=o[x];d[x]=1===E?0:0===E?OC:Math.pow(Math.max(0,.5-E),2),m[x]=1===E?OC:0===E?0:Math.pow(Math.max(0,E-.5),2)}NC(d,n,r,_,g,v,y),NC(m,n,r,_,g,v,y);var T,S,C,w=new(window.Float32Array?Float32Array:Array)(n*r);for(x=0,b=n*r;x<b;x++)w[x]=(T=1-((d[x]-m[x])/f+h),(S=0)<(C=1)?T<S?S:C<T?C:T:T<C?C:S<T?S:T);return w}function NC(e,t,n,r,i,o,a){for(var s=0;s<t;s++){for(var u=0;u<n;u++)r[u]=e[u*t+s];for(RC(r,i,o,a,n),u=0;u<n;u++)e[u*t+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<t;s++)r[s]=e[u*t+s];for(RC(r,i,o,a,t),s=0;s<t;s++)e[u*t+s]=Math.sqrt(i[s])}}function RC(e,t,n,r,i){r[n[0]=0]=-OC,r[1]=+OC;for(var o=1,a=0;o<i;o++){for(var s=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+OC}for(a=o=0;o<i;o++){for(;r[a+1]<o;)a++;t[o]=(o-n[a])*(o-n[a])+e[n[a]]}}var DC=Object.freeze({FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2}),MC={},FC=0,zC=256,BC=Object.freeze({LTR:0,RTL:1,WEAK:2,BRACKETS:3});function UC(e){e._rebindAllGlyphs||e._repositionAllGlyphs||e._labelCollection._labelsToUpdate.push(e),e._rebindAllGlyphs=!0}function VC(e){e._rebindAllGlyphs||e._repositionAllGlyphs||e._labelCollection._labelsToUpdate.push(e),e._repositionAllGlyphs=!0}function kC(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function GC(e){var t,n=MC[e._font];Ze(n)||((t=document.createElement("div")).style.position="absolute",t.style.opacity=0,t.style.font=e._font,document.body.appendChild(t),n={family:kC(t,"font-family"),size:kC(t,"font-size").replace("px",""),style:kC(t,"font-style"),weight:kC(t,"font-weight")},document.body.removeChild(t),FC<zC&&(MC[e._font]=n,FC++)),e._fontFamily=n.family,e._fontSize=n.size,e._fontStyle=n.style,e._fontWeight=n.weight}function qC(e,t){var n=(e=Je(e,Je.EMPTY_OBJECT)).translucencyByDistance,r=e.pixelOffsetScaleByDistance,i=e.scaleByDistance,o=e.distanceDisplayCondition;Ze(n)&&(n=yT.clone(n)),Ze(r)&&(r=yT.clone(r)),Ze(i)&&(i=yT.clone(i)),Ze(o)&&(o=wf.clone(o)),this._renderedText=void 0,this._text=void 0,this._show=Je(e.show,!0),this._font=Je(e.font,"30px sans-serif"),this._fillColor=It.clone(Je(e.fillColor,It.WHITE)),this._outlineColor=It.clone(Je(e.outlineColor,It.BLACK)),this._outlineWidth=Je(e.outlineWidth,1),this._showBackground=Je(e.showBackground,!1),this._backgroundColor=Je(e.backgroundColor,new It(.165,.165,.165,.8)),this._backgroundPadding=Je(e.backgroundPadding,new En(7,5)),this._style=Je(e.style,DC.FILL),this._verticalOrigin=Je(e.verticalOrigin,HT.BASELINE),this._horizontalOrigin=Je(e.horizontalOrigin,ST.LEFT),this._pixelOffset=En.clone(Je(e.pixelOffset,En.ZERO)),this._eyeOffset=_t.clone(Je(e.eyeOffset,_t.ZERO)),this._position=_t.clone(Je(e.position,_t.ZERO)),this._scale=Je(e.scale,1),this._id=e.id,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=r,this._scaleByDistance=i,this._heightReference=Je(e.heightReference,Ap.NONE),this._distanceDisplayCondition=o,this._disableDepthTestDistance=e.disableDepthTestDistance,this._labelCollection=t,this._glyphs=[],this._backgroundBillboard=void 0,this._batchIndex=void 0,this._rebindAllGlyphs=!0,this._repositionAllGlyphs=!0,this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=void 0,this._clusterShow=!0,this.text=Je(e.text,""),this._relativeSize=1,Ze(e.properties)&&(this._properties=e.properties),GC(this),this._updateClamping()}function HC(e,t){for(var n=/[a-zA-Z0-9]/,r=/[()[\]{}<>]/,i=[],o="",a=BC.LTR,s="",u=e.length,l=0;l<u;++l){var c=e.charAt(l),s=t.test(c)?BC.RTL:n.test(c)?BC.LTR:r.test(c)?BC.BRACKETS:BC.WEAK;0===l&&(a=s),a===s&&s!==BC.BRACKETS?o+=c:(""!==o&&i.push({Type:a,Word:o}),a=s,o=c)}return i.push({Type:s,Word:o}),i}function WC(e,t,n){return e.slice(0,t)+n+e.slice(t)}function YC(e){switch(e){case"(":return")";case")":return"(";case"[":return"]";case"]":return"[";case"{":return"}";case"}":return"{";case"<":return">";case">":return"<"}}Object.defineProperties(qC.prototype,{show:{get:function(){return this._show},set:function(e){if(this._show!==e){this._show=e;for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n].billboard;Ze(i)&&(i.show=e)}var o=this._backgroundBillboard;Ze(o)&&(o.show=e)}}},position:{get:function(){return this._position},set:function(e){var t=this._position;if(!_t.equals(t,e)){_t.clone(e,t);for(var n=this._glyphs,r=0,i=n.length;r<i;r++){var o=n[r].billboard;Ze(o)&&(o.position=e)}var a=this._backgroundBillboard;Ze(a)&&(a.position=e),this._updateClamping()}}},heightReference:{get:function(){return this._heightReference},set:function(e){if(e!==this._heightReference){this._heightReference=e;for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n].billboard;Ze(i)&&(i.heightReference=e)}var o=this._backgroundBillboard;Ze(o)&&(o.heightReference=e),VC(this),this._updateClamping()}}},text:{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._renderedText=qC.enableRightToLeftDetection?function(e){for(var t=e.split("\n"),n="",r=0;r<t.length;r++){for(var i=t[r],o=XC.test(i.charAt(0)),a=HC(i,XC),s=0,u="",l=0;l<a.length;++l){var c=a[l],h=c.Type===BC.BRACKETS?YC(c.Word):c.Word.split("").reverse().join("");o?c.Type===BC.RTL?(u=h+u,s=0):c.Type===BC.LTR?(u=WC(u,s,c.Word),s+=c.Word.length):c.Type!==BC.WEAK&&c.Type!==BC.BRACKETS||(c.Type===BC.WEAK&&a[l-1].Type===BC.BRACKETS?u=h+u:a[l-1].Type===BC.RTL?(u=h+u,s=0):a.length>l+1?a[l+1].Type===BC.RTL?(u=h+u,s=0):(u=WC(u,s,c.Word),s+=c.Word.length):u=WC(u,0,h)):c.Type===BC.RTL?u=WC(u,s,h):c.Type===BC.LTR?(u+=c.Word,s=u.length):c.Type!==BC.WEAK&&c.Type!==BC.BRACKETS||(0<l&&a[l-1].Type===BC.RTL?a.length>l+1?a[l+1].Type===BC.RTL?u=WC(u,s,h):(u+=c.Word,s=u.length):u+=c.Word:(u+=c.Word,s=u.length))}n+=u,r<t.length-1&&(n+="\n")}return n}(e):e,UC(this))}},font:{get:function(){return this._font},set:function(e){this._font!==e&&(this._font=e,UC(this),GC(this))}},fillColor:{get:function(){return this._fillColor},set:function(e){var t=this._fillColor;It.equals(t,e)||(It.clone(e,t),UC(this))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){var t=this._outlineColor;It.equals(t,e)||(It.clone(e,t),UC(this))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,UC(this))}},showBackground:{get:function(){return this._showBackground},set:function(e){this._showBackground!==e&&(this._showBackground=e,UC(this))}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){var t,n=this._backgroundColor;It.equals(n,e)||(It.clone(e,n),Ze(t=this._backgroundBillboard)&&(t.color=n))}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){var t=this._backgroundPadding;En.equals(t,e)||(En.clone(e,t),VC(this))}},style:{get:function(){return this._style},set:function(e){this._style!==e&&(this._style=e,UC(this))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){var t=this._pixelOffset;if(!En.equals(t,e)){En.clone(e,t);for(var n=this._glyphs,r=0,i=n.length;r<i;r++){var o=n[r];Ze(o.billboard)&&(o.billboard.pixelOffset=e)}var a=this._backgroundBillboard;Ze(a)&&(a.pixelOffset=e)}}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){var t=this._translucencyByDistance;if(!yT.equals(t,e)){this._translucencyByDistance=yT.clone(e,t);for(var n=this._glyphs,r=0,i=n.length;r<i;r++){var o=n[r];Ze(o.billboard)&&(o.billboard.translucencyByDistance=e)}var a=this._backgroundBillboard;Ze(a)&&(a.translucencyByDistance=e)}}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){var t=this._pixelOffsetScaleByDistance;if(!yT.equals(t,e)){this._pixelOffsetScaleByDistance=yT.clone(e,t);for(var n=this._glyphs,r=0,i=n.length;r<i;r++){var o=n[r];Ze(o.billboard)&&(o.billboard.pixelOffsetScaleByDistance=e)}var a=this._backgroundBillboard;Ze(a)&&(a.pixelOffsetScaleByDistance=e)}}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){var t=this._scaleByDistance;if(!yT.equals(t,e)){this._scaleByDistance=yT.clone(e,t);for(var n=this._glyphs,r=0,i=n.length;r<i;r++){var o=n[r];Ze(o.billboard)&&(o.billboard.scaleByDistance=e)}var a=this._backgroundBillboard;Ze(a)&&(a.scaleByDistance=e)}}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){var t=this._eyeOffset;if(!_t.equals(t,e)){_t.clone(e,t);for(var n=this._glyphs,r=0,i=n.length;r<i;r++){var o=n[r];Ze(o.billboard)&&(o.billboard.eyeOffset=e)}var a=this._backgroundBillboard;Ze(a)&&(a.eyeOffset=e)}}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin!==e&&(this._horizontalOrigin=e,VC(this))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){if(this._verticalOrigin!==e){this._verticalOrigin=e;for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n];Ze(i.billboard)&&(i.billboard.verticalOrigin=e)}var o=this._backgroundBillboard;Ze(o)&&(o.verticalOrigin=e),VC(this)}}},scale:{get:function(){return this._scale},set:function(e){if(this._scale!==e){this._scale=e;for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n];Ze(i.billboard)&&(i.billboard.scale=e*this._relativeSize)}var o=this._backgroundBillboard;Ze(o)&&(o.scale=e*this._relativeSize),VC(this)}}},totalScale:{get:function(){return this._scale*this._relativeSize}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(!wf.equals(e,this._distanceDisplayCondition)){this._distanceDisplayCondition=wf.clone(e,this._distanceDisplayCondition);for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n];Ze(i.billboard)&&(i.billboard.distanceDisplayCondition=e)}var o=this._backgroundBillboard;Ze(o)&&(o.distanceDisplayCondition=e)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){this._disableDepthTestDistance=e;for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n];Ze(i.billboard)&&(i.billboard.disableDepthTestDistance=e)}var o=this._backgroundBillboard;Ze(o)&&(o.disableDepthTestDistance=e)}}},id:{get:function(){return this._id},set:function(e){if(this._id!==e){this._id=e;for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n];Ze(i.billboard)&&(i.billboard.id=e)}var o=this._backgroundBillboard;Ze(o)&&(o.id=e)}}},pickId:{get:function(){if(0!==this._glyphs.length&&Ze(this._glyphs[0].billboard))return this._glyphs[0].billboard.pickId}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=_t.clone(e,this._actualClampedPosition);for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n];Ze(i.billboard)&&(i.billboard._clampedPosition=e)}var o=this._backgroundBillboard;Ze(o)&&(o._clampedPosition=e)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){if(this._clusterShow!==e){this._clusterShow=e;for(var t=this._glyphs,n=0,r=t.length;n<r;n++){var i=t[n];Ze(i.billboard)&&(i.billboard.clusterShow=e)}var o=this._backgroundBillboard;Ze(o)&&(o.clusterShow=e)}}}}),qC.prototype._updateClamping=function(){WT._updateClamping(this._labelCollection,this)},qC.prototype.computeScreenSpacePosition=function(e,t){Ze(t)||(t=new En);var n=this._labelCollection.modelMatrix,r=Ze(this._actualClampedPosition)?this._actualClampedPosition:this._position;return WT._computeScreenSpacePosition(n,r,this._eyeOffset,this._pixelOffset,e,t)},qC.getScreenSpaceBoundingBox=function(e,t,n){var r=0,i=0,o=0,a=0,s=e.totalScale,u=e._backgroundBillboard;if(Ze(u))r=t.x+u._translate.x,i=t.y-u._translate.y,o=u.width*s,a=u.height*s,e.verticalOrigin===HT.BOTTOM||e.verticalOrigin===HT.BASELINE?i-=a:e.verticalOrigin===HT.CENTER&&(i-=.5*a);else{r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(var l=0,c=0,h=e._glyphs,f=h.length,p=0;p<f;++p){var d,m,_,g,y=h[p],v=y.billboard;Ze(v)&&(d=t.x+v._translate.x,m=t.y-v._translate.y,_=y.dimensions.width*s,g=y.dimensions.height*s,e.verticalOrigin===HT.BOTTOM||e.verticalOrigin===HT.BASELINE?m-=g:e.verticalOrigin===HT.CENTER&&(m-=.5*g),e._verticalOrigin===HT.TOP?m+=_S.PADDING*s:e._verticalOrigin!==HT.BOTTOM&&e._verticalOrigin!==HT.BASELINE||(m-=_S.PADDING*s),r=Math.min(r,d),i=Math.min(i,m),l=Math.max(l,d+_),c=Math.max(c,m+g))}o=l-r,a=c-i}return Ze(n)||(n=new tr),n.x=r,n.y=i,n.width=o,n.height=a,n},qC.prototype.equals=function(e){return this===e||Ze(e)&&this._show===e._show&&this._scale===e._scale&&this._outlineWidth===e._outlineWidth&&this._showBackground===e._showBackground&&this._style===e._style&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&this._renderedText===e._renderedText&&this._font===e._font&&_t.equals(this._position,e._position)&&It.equals(this._fillColor,e._fillColor)&&It.equals(this._outlineColor,e._outlineColor)&&It.equals(this._backgroundColor,e._backgroundColor)&&En.equals(this._backgroundPadding,e._backgroundPadding)&&En.equals(this._pixelOffset,e._pixelOffset)&&_t.equals(this._eyeOffset,e._eyeOffset)&&yT.equals(this._translucencyByDistance,e._translucencyByDistance)&&yT.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&yT.equals(this._scaleByDistance,e._scaleByDistance)&&wf.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._id===e._id},qC.prototype.isDestroyed=function(){return!1},qC.enableRightToLeftDetection=!1;var XC=new RegExp("[א-ת؀-ۿݐ-ݿࢠ-ࣿ]");function jC(){this.textureInfo=void 0,this.dimensions=void 0,this.billboard=void 0}function KC(e,t,n){this.labelCollection=e,this.index=t,this.dimensions=n}var QC=1.2,ZC="ID_WHITE_PIXEL",JC=new En(4,4),$C=new tr(1,1,1,1);var ew={};function tw(e,t,n,r,i,o,a){return ew.font=t,ew.fillColor=n,ew.strokeColor=r,ew.strokeWidth=i,ew.padding=_S.PADDING,a===HT.CENTER?ew.textBaseline="middle":a===HT.TOP?ew.textBaseline="top":ew.textBaseline="bottom",ew.fill=o===DC.FILL||o===DC.FILL_AND_OUTLINE,ew.stroke=o===DC.OUTLINE||o===DC.FILL_AND_OUTLINE,ew.backgroundColor=It.BLACK,function(e,t){if(""!==e){t=Je(t,Je.EMPTY_OBJECT);var n=Je(t.font,"10px sans-serif"),r=Je(t.stroke,!1),i=Je(t.fill,!0),o=Je(t.strokeWidth,1),a=Je(t.backgroundColor,It.TRANSPARENT),s=Je(t.padding,0),u=2*s,l=document.createElement("canvas");l.width=1,l.height=1,l.style.font=n;var c=l.getContext("2d");Ze(IC)||(Ze(c.imageSmoothingEnabled)?IC="imageSmoothingEnabled":Ze(c.mozImageSmoothingEnabled)?IC="mozImageSmoothingEnabled":Ze(c.webkitImageSmoothingEnabled)?IC="webkitImageSmoothingEnabled":Ze(c.msImageSmoothingEnabled)&&(IC="msImageSmoothingEnabled")),c.font=n,c.lineJoin="round",c.lineWidth=o,c[IC]=!1,c.textBaseline=Je(t.textBaseline,"bottom"),l.style.visibility="hidden",document.body.appendChild(l);var h=PC(c,e,r,i);l.dimensions=h,document.body.removeChild(l),l.style.visibility="";var f,p,d=-h.bounds.minx,m=Math.ceil(h.width)+d+u,_=h.height+u,g=_-(_-h.ascent+s)+u;return l.width=m,l.height=_,c.font=n,c.lineJoin="round",c.lineWidth=o,c[IC]=!1,a!==It.TRANSPARENT&&(c.fillStyle=a.toCssColorString(),c.fillRect(0,0,l.width,l.height)),r&&(f=Je(t.strokeColor,It.BLACK),c.strokeStyle=f.toCssColorString(),c.strokeText(e,d+s,g)),i&&(p=Je(t.fillColor,It.WHITE),c.fillStyle=p.toCssColorString(),c.fillText(e,d+s,g)),l}}(e,ew)}function nw(e,t){t.textureInfo=void 0,t.dimensions=void 0;var n=t.billboard;Ze(n)&&(n.show=!1,n.image=void 0,Ze(n._removeCallbackFunc)&&(n._removeCallbackFunc(),n._removeCallbackFunc=void 0),e._spareBillboards.push(n),t.billboard=void 0)}var rw={},iw=0,ow=512;function aw(e,t,n,r){e.addImage(t,n).then(function(e){r.index=e})}var sw=new function(){var l=0,c=1,h=2,f=3,p=4,d=5,m=6,_=7,g=8,y=9,v=10,x=12,b=13,E=14,T=15,S=16,C=17,w=0,A=1,I=2,P=3,O=4;function u(e,t){void 0===t&&(t=0);var n=e.charCodeAt(t);if(55296<=n&&n<=56319&&t<e.length-1){var r=n;return 56320<=(i=e.charCodeAt(t+1))&&i<=57343?1024*(r-55296)+(i-56320)+65536:r}if(56320<=n&&n<=57343&&1<=t){var i=n;return 55296<=(r=e.charCodeAt(t-1))&&r<=56319?1024*(r-55296)+(i-56320)+65536:i}return n}function L(e,t,n){var r=[e].concat(t).concat([n]),i=r[r.length-2],o=n,a=r.lastIndexOf(E);if(1<a&&r.slice(1,a).every(function(e){return e==f})&&-1==[f,b,C].indexOf(e))return I;var s=r.lastIndexOf(p);if(0<s&&r.slice(1,s).every(function(e){return e==p})&&-1==[x,p].indexOf(i))return r.filter(function(e){return e==p}).length%2==1?P:O;if(i==l&&o==c)return w;if(i==h||i==l||i==c)return o==E&&t.every(function(e){return e==f})?I:A;if(o==h||o==l||o==c)return A;if(i==m&&(o==m||o==_||o==y||o==v))return w;if(!(i!=y&&i!=_||o!=_&&o!=g))return w;if((i==v||i==g)&&o==g)return w;if(o==f||o==T)return w;if(o==d)return w;if(i==x)return w;var u=-1!=r.indexOf(f)?r.lastIndexOf(f)-1:r.length-2;return-1!=[b,C].indexOf(r[u])&&r.slice(1+u,-1).every(function(e){return e==f})&&o==E||i==T&&-1!=[S,C].indexOf(o)?w:-1!=t.indexOf(p)?I:i==p&&o==p?w:A}function N(e){return 1536<=e&&e<=1541||1757==e||1807==e||2274==e||3406==e||69821==e||70082<=e&&e<=70083||72250==e||72326<=e&&e<=72329||73030==e?x:13==e?l:10==e?c:0<=e&&e<=9||11<=e&&e<=12||14<=e&&e<=31||127<=e&&e<=159||173==e||1564==e||6158==e||8203==e||8206<=e&&e<=8207||8232==e||8233==e||8234<=e&&e<=8238||8288<=e&&e<=8292||8293==e||8294<=e&&e<=8303||55296<=e&&e<=57343||65279==e||65520<=e&&e<=65528||65529<=e&&e<=65531||113824<=e&&e<=113827||119155<=e&&e<=119162||917504==e||917505==e||917506<=e&&e<=917535||917632<=e&&e<=917759||918e3<=e&&e<=921599?h:768<=e&&e<=879||1155<=e&&e<=1159||1160<=e&&e<=1161||1425<=e&&e<=1469||1471==e||1473<=e&&e<=1474||1476<=e&&e<=1477||1479==e||1552<=e&&e<=1562||1611<=e&&e<=1631||1648==e||1750<=e&&e<=1756||1759<=e&&e<=1764||1767<=e&&e<=1768||1770<=e&&e<=1773||1809==e||1840<=e&&e<=1866||1958<=e&&e<=1968||2027<=e&&e<=2035||2070<=e&&e<=2073||2075<=e&&e<=2083||2085<=e&&e<=2087||2089<=e&&e<=2093||2137<=e&&e<=2139||2260<=e&&e<=2273||2275<=e&&e<=2306||2362==e||2364==e||2369<=e&&e<=2376||2381==e||2385<=e&&e<=2391||2402<=e&&e<=2403||2433==e||2492==e||2494==e||2497<=e&&e<=2500||2509==e||2519==e||2530<=e&&e<=2531||2561<=e&&e<=2562||2620==e||2625<=e&&e<=2626||2631<=e&&e<=2632||2635<=e&&e<=2637||2641==e||2672<=e&&e<=2673||2677==e||2689<=e&&e<=2690||2748==e||2753<=e&&e<=2757||2759<=e&&e<=2760||2765==e||2786<=e&&e<=2787||2810<=e&&e<=2815||2817==e||2876==e||2878==e||2879==e||2881<=e&&e<=2884||2893==e||2902==e||2903==e||2914<=e&&e<=2915||2946==e||3006==e||3008==e||3021==e||3031==e||3072==e||3134<=e&&e<=3136||3142<=e&&e<=3144||3146<=e&&e<=3149||3157<=e&&e<=3158||3170<=e&&e<=3171||3201==e||3260==e||3263==e||3266==e||3270==e||3276<=e&&e<=3277||3285<=e&&e<=3286||3298<=e&&e<=3299||3328<=e&&e<=3329||3387<=e&&e<=3388||3390==e||3393<=e&&e<=3396||3405==e||3415==e||3426<=e&&e<=3427||3530==e||3535==e||3538<=e&&e<=3540||3542==e||3551==e||3633==e||3636<=e&&e<=3642||3655<=e&&e<=3662||3761==e||3764<=e&&e<=3769||3771<=e&&e<=3772||3784<=e&&e<=3789||3864<=e&&e<=3865||3893==e||3895==e||3897==e||3953<=e&&e<=3966||3968<=e&&e<=3972||3974<=e&&e<=3975||3981<=e&&e<=3991||3993<=e&&e<=4028||4038==e||4141<=e&&e<=4144||4146<=e&&e<=4151||4153<=e&&e<=4154||4157<=e&&e<=4158||4184<=e&&e<=4185||4190<=e&&e<=4192||4209<=e&&e<=4212||4226==e||4229<=e&&e<=4230||4237==e||4253==e||4957<=e&&e<=4959||5906<=e&&e<=5908||5938<=e&&e<=5940||5970<=e&&e<=5971||6002<=e&&e<=6003||6068<=e&&e<=6069||6071<=e&&e<=6077||6086==e||6089<=e&&e<=6099||6109==e||6155<=e&&e<=6157||6277<=e&&e<=6278||6313==e||6432<=e&&e<=6434||6439<=e&&e<=6440||6450==e||6457<=e&&e<=6459||6679<=e&&e<=6680||6683==e||6742==e||6744<=e&&e<=6750||6752==e||6754==e||6757<=e&&e<=6764||6771<=e&&e<=6780||6783==e||6832<=e&&e<=6845||6846==e||6912<=e&&e<=6915||6964==e||6966<=e&&e<=6970||6972==e||6978==e||7019<=e&&e<=7027||7040<=e&&e<=7041||7074<=e&&e<=7077||7080<=e&&e<=7081||7083<=e&&e<=7085||7142==e||7144<=e&&e<=7145||7149==e||7151<=e&&e<=7153||7212<=e&&e<=7219||7222<=e&&e<=7223||7376<=e&&e<=7378||7380<=e&&e<=7392||7394<=e&&e<=7400||7405==e||7412==e||7416<=e&&e<=7417||7616<=e&&e<=7673||7675<=e&&e<=7679||8204==e||8400<=e&&e<=8412||8413<=e&&e<=8416||8417==e||8418<=e&&e<=8420||8421<=e&&e<=8432||11503<=e&&e<=11505||11647==e||11744<=e&&e<=11775||12330<=e&&e<=12333||12334<=e&&e<=12335||12441<=e&&e<=12442||42607==e||42608<=e&&e<=42610||42612<=e&&e<=42621||42654<=e&&e<=42655||42736<=e&&e<=42737||43010==e||43014==e||43019==e||43045<=e&&e<=43046||43204<=e&&e<=43205||43232<=e&&e<=43249||43302<=e&&e<=43309||43335<=e&&e<=43345||43392<=e&&e<=43394||43443==e||43446<=e&&e<=43449||43452==e||43493==e||43561<=e&&e<=43566||43569<=e&&e<=43570||43573<=e&&e<=43574||43587==e||43596==e||43644==e||43696==e||43698<=e&&e<=43700||43703<=e&&e<=43704||43710<=e&&e<=43711||43713==e||43756<=e&&e<=43757||43766==e||44005==e||44008==e||44013==e||64286==e||65024<=e&&e<=65039||65056<=e&&e<=65071||65438<=e&&e<=65439||66045==e||66272==e||66422<=e&&e<=66426||68097<=e&&e<=68099||68101<=e&&e<=68102||68108<=e&&e<=68111||68152<=e&&e<=68154||68159==e||68325<=e&&e<=68326||69633==e||69688<=e&&e<=69702||69759<=e&&e<=69761||69811<=e&&e<=69814||69817<=e&&e<=69818||69888<=e&&e<=69890||69927<=e&&e<=69931||69933<=e&&e<=69940||70003==e||70016<=e&&e<=70017||70070<=e&&e<=70078||70090<=e&&e<=70092||70191<=e&&e<=70193||70196==e||70198<=e&&e<=70199||70206==e||70367==e||70371<=e&&e<=70378||70400<=e&&e<=70401||70460==e||70462==e||70464==e||70487==e||70502<=e&&e<=70508||70512<=e&&e<=70516||70712<=e&&e<=70719||70722<=e&&e<=70724||70726==e||70832==e||70835<=e&&e<=70840||70842==e||70845==e||70847<=e&&e<=70848||70850<=e&&e<=70851||71087==e||71090<=e&&e<=71093||71100<=e&&e<=71101||71103<=e&&e<=71104||71132<=e&&e<=71133||71219<=e&&e<=71226||71229==e||71231<=e&&e<=71232||71339==e||71341==e||71344<=e&&e<=71349||71351==e||71453<=e&&e<=71455||71458<=e&&e<=71461||71463<=e&&e<=71467||72193<=e&&e<=72198||72201<=e&&e<=72202||72243<=e&&e<=72248||72251<=e&&e<=72254||72263==e||72273<=e&&e<=72278||72281<=e&&e<=72283||72330<=e&&e<=72342||72344<=e&&e<=72345||72752<=e&&e<=72758||72760<=e&&e<=72765||72767==e||72850<=e&&e<=72871||72874<=e&&e<=72880||72882<=e&&e<=72883||72885<=e&&e<=72886||73009<=e&&e<=73014||73018==e||73020<=e&&e<=73021||73023<=e&&e<=73029||73031==e||92912<=e&&e<=92916||92976<=e&&e<=92982||94095<=e&&e<=94098||113821<=e&&e<=113822||119141==e||119143<=e&&e<=119145||119150<=e&&e<=119154||119163<=e&&e<=119170||119173<=e&&e<=119179||119210<=e&&e<=119213||119362<=e&&e<=119364||121344<=e&&e<=121398||121403<=e&&e<=121452||121461==e||121476==e||121499<=e&&e<=121503||121505<=e&&e<=121519||122880<=e&&e<=122886||122888<=e&&e<=122904||122907<=e&&e<=122913||122915<=e&&e<=122916||122918<=e&&e<=122922||125136<=e&&e<=125142||125252<=e&&e<=125258||917536<=e&&e<=917631||917760<=e&&e<=917999?f:127462<=e&&e<=127487?p:2307==e||2363==e||2366<=e&&e<=2368||2377<=e&&e<=2380||2382<=e&&e<=2383||2434<=e&&e<=2435||2495<=e&&e<=2496||2503<=e&&e<=2504||2507<=e&&e<=2508||2563==e||2622<=e&&e<=2624||2691==e||2750<=e&&e<=2752||2761==e||2763<=e&&e<=2764||2818<=e&&e<=2819||2880==e||2887<=e&&e<=2888||2891<=e&&e<=2892||3007==e||3009<=e&&e<=3010||3014<=e&&e<=3016||3018<=e&&e<=3020||3073<=e&&e<=3075||3137<=e&&e<=3140||3202<=e&&e<=3203||3262==e||3264<=e&&e<=3265||3267<=e&&e<=3268||3271<=e&&e<=3272||3274<=e&&e<=3275||3330<=e&&e<=3331||3391<=e&&e<=3392||3398<=e&&e<=3400||3402<=e&&e<=3404||3458<=e&&e<=3459||3536<=e&&e<=3537||3544<=e&&e<=3550||3570<=e&&e<=3571||3635==e||3763==e||3902<=e&&e<=3903||3967==e||4145==e||4155<=e&&e<=4156||4182<=e&&e<=4183||4228==e||6070==e||6078<=e&&e<=6085||6087<=e&&e<=6088||6435<=e&&e<=6438||6441<=e&&e<=6443||6448<=e&&e<=6449||6451<=e&&e<=6456||6681<=e&&e<=6682||6741==e||6743==e||6765<=e&&e<=6770||6916==e||6965==e||6971==e||6973<=e&&e<=6977||6979<=e&&e<=6980||7042==e||7073==e||7078<=e&&e<=7079||7082==e||7143==e||7146<=e&&e<=7148||7150==e||7154<=e&&e<=7155||7204<=e&&e<=7211||7220<=e&&e<=7221||7393==e||7410<=e&&e<=7411||7415==e||43043<=e&&e<=43044||43047==e||43136<=e&&e<=43137||43188<=e&&e<=43203||43346<=e&&e<=43347||43395==e||43444<=e&&e<=43445||43450<=e&&e<=43451||43453<=e&&e<=43456||43567<=e&&e<=43568||43571<=e&&e<=43572||43597==e||43755==e||43758<=e&&e<=43759||43765==e||44003<=e&&e<=44004||44006<=e&&e<=44007||44009<=e&&e<=44010||44012==e||69632==e||69634==e||69762==e||69808<=e&&e<=69810||69815<=e&&e<=69816||69932==e||70018==e||70067<=e&&e<=70069||70079<=e&&e<=70080||70188<=e&&e<=70190||70194<=e&&e<=70195||70197==e||70368<=e&&e<=70370||70402<=e&&e<=70403||70463==e||70465<=e&&e<=70468||70471<=e&&e<=70472||70475<=e&&e<=70477||70498<=e&&e<=70499||70709<=e&&e<=70711||70720<=e&&e<=70721||70725==e||70833<=e&&e<=70834||70841==e||70843<=e&&e<=70844||70846==e||70849==e||71088<=e&&e<=71089||71096<=e&&e<=71099||71102==e||71216<=e&&e<=71218||71227<=e&&e<=71228||71230==e||71340==e||71342<=e&&e<=71343||71350==e||71456<=e&&e<=71457||71462==e||72199<=e&&e<=72200||72249==e||72279<=e&&e<=72280||72343==e||72751==e||72766==e||72873==e||72881==e||72884==e||94033<=e&&e<=94078||119142==e||119149==e?d:4352<=e&&e<=4447||43360<=e&&e<=43388?m:4448<=e&&e<=4519||55216<=e&&e<=55238?_:4520<=e&&e<=4607||55243<=e&&e<=55291?g:44032==e||44060==e||44088==e||44116==e||44144==e||44172==e||44200==e||44228==e||44256==e||44284==e||44312==e||44340==e||44368==e||44396==e||44424==e||44452==e||44480==e||44508==e||44536==e||44564==e||44592==e||44620==e||44648==e||44676==e||44704==e||44732==e||44760==e||44788==e||44816==e||44844==e||44872==e||44900==e||44928==e||44956==e||44984==e||45012==e||45040==e||45068==e||45096==e||45124==e||45152==e||45180==e||45208==e||45236==e||45264==e||45292==e||45320==e||45348==e||45376==e||45404==e||45432==e||45460==e||45488==e||45516==e||45544==e||45572==e||45600==e||45628==e||45656==e||45684==e||45712==e||45740==e||45768==e||45796==e||45824==e||45852==e||45880==e||45908==e||45936==e||45964==e||45992==e||46020==e||46048==e||46076==e||46104==e||46132==e||46160==e||46188==e||46216==e||46244==e||46272==e||46300==e||46328==e||46356==e||46384==e||46412==e||46440==e||46468==e||46496==e||46524==e||46552==e||46580==e||46608==e||46636==e||46664==e||46692==e||46720==e||46748==e||46776==e||46804==e||46832==e||46860==e||46888==e||46916==e||46944==e||46972==e||47e3==e||47028==e||47056==e||47084==e||47112==e||47140==e||47168==e||47196==e||47224==e||47252==e||47280==e||47308==e||47336==e||47364==e||47392==e||47420==e||47448==e||47476==e||47504==e||47532==e||47560==e||47588==e||47616==e||47644==e||47672==e||47700==e||47728==e||47756==e||47784==e||47812==e||47840==e||47868==e||47896==e||47924==e||47952==e||47980==e||48008==e||48036==e||48064==e||48092==e||48120==e||48148==e||48176==e||48204==e||48232==e||48260==e||48288==e||48316==e||48344==e||48372==e||48400==e||48428==e||48456==e||48484==e||48512==e||48540==e||48568==e||48596==e||48624==e||48652==e||48680==e||48708==e||48736==e||48764==e||48792==e||48820==e||48848==e||48876==e||48904==e||48932==e||48960==e||48988==e||49016==e||49044==e||49072==e||49100==e||49128==e||49156==e||49184==e||49212==e||49240==e||49268==e||49296==e||49324==e||49352==e||49380==e||49408==e||49436==e||49464==e||49492==e||49520==e||49548==e||49576==e||49604==e||49632==e||49660==e||49688==e||49716==e||49744==e||49772==e||49800==e||49828==e||49856==e||49884==e||49912==e||49940==e||49968==e||49996==e||50024==e||50052==e||50080==e||50108==e||50136==e||50164==e||50192==e||50220==e||50248==e||50276==e||50304==e||50332==e||50360==e||50388==e||50416==e||50444==e||50472==e||50500==e||50528==e||50556==e||50584==e||50612==e||50640==e||50668==e||50696==e||50724==e||50752==e||50780==e||50808==e||50836==e||50864==e||50892==e||50920==e||50948==e||50976==e||51004==e||51032==e||51060==e||51088==e||51116==e||51144==e||51172==e||51200==e||51228==e||51256==e||51284==e||51312==e||51340==e||51368==e||51396==e||51424==e||51452==e||51480==e||51508==e||51536==e||51564==e||51592==e||51620==e||51648==e||51676==e||51704==e||51732==e||51760==e||51788==e||51816==e||51844==e||51872==e||51900==e||51928==e||51956==e||51984==e||52012==e||52040==e||52068==e||52096==e||52124==e||52152==e||52180==e||52208==e||52236==e||52264==e||52292==e||52320==e||52348==e||52376==e||52404==e||52432==e||52460==e||52488==e||52516==e||52544==e||52572==e||52600==e||52628==e||52656==e||52684==e||52712==e||52740==e||52768==e||52796==e||52824==e||52852==e||52880==e||52908==e||52936==e||52964==e||52992==e||53020==e||53048==e||53076==e||53104==e||53132==e||53160==e||53188==e||53216==e||53244==e||53272==e||53300==e||53328==e||53356==e||53384==e||53412==e||53440==e||53468==e||53496==e||53524==e||53552==e||53580==e||53608==e||53636==e||53664==e||53692==e||53720==e||53748==e||53776==e||53804==e||53832==e||53860==e||53888==e||53916==e||53944==e||53972==e||54e3==e||54028==e||54056==e||54084==e||54112==e||54140==e||54168==e||54196==e||54224==e||54252==e||54280==e||54308==e||54336==e||54364==e||54392==e||54420==e||54448==e||54476==e||54504==e||54532==e||54560==e||54588==e||54616==e||54644==e||54672==e||54700==e||54728==e||54756==e||54784==e||54812==e||54840==e||54868==e||54896==e||54924==e||54952==e||54980==e||55008==e||55036==e||55064==e||55092==e||55120==e||55148==e||55176==e?y:44033<=e&&e<=44059||44061<=e&&e<=44087||44089<=e&&e<=44115||44117<=e&&e<=44143||44145<=e&&e<=44171||44173<=e&&e<=44199||44201<=e&&e<=44227||44229<=e&&e<=44255||44257<=e&&e<=44283||44285<=e&&e<=44311||44313<=e&&e<=44339||44341<=e&&e<=44367||44369<=e&&e<=44395||44397<=e&&e<=44423||44425<=e&&e<=44451||44453<=e&&e<=44479||44481<=e&&e<=44507||44509<=e&&e<=44535||44537<=e&&e<=44563||44565<=e&&e<=44591||44593<=e&&e<=44619||44621<=e&&e<=44647||44649<=e&&e<=44675||44677<=e&&e<=44703||44705<=e&&e<=44731||44733<=e&&e<=44759||44761<=e&&e<=44787||44789<=e&&e<=44815||44817<=e&&e<=44843||44845<=e&&e<=44871||44873<=e&&e<=44899||44901<=e&&e<=44927||44929<=e&&e<=44955||44957<=e&&e<=44983||44985<=e&&e<=45011||45013<=e&&e<=45039||45041<=e&&e<=45067||45069<=e&&e<=45095||45097<=e&&e<=45123||45125<=e&&e<=45151||45153<=e&&e<=45179||45181<=e&&e<=45207||45209<=e&&e<=45235||45237<=e&&e<=45263||45265<=e&&e<=45291||45293<=e&&e<=45319||45321<=e&&e<=45347||45349<=e&&e<=45375||45377<=e&&e<=45403||45405<=e&&e<=45431||45433<=e&&e<=45459||45461<=e&&e<=45487||45489<=e&&e<=45515||45517<=e&&e<=45543||45545<=e&&e<=45571||45573<=e&&e<=45599||45601<=e&&e<=45627||45629<=e&&e<=45655||45657<=e&&e<=45683||45685<=e&&e<=45711||45713<=e&&e<=45739||45741<=e&&e<=45767||45769<=e&&e<=45795||45797<=e&&e<=45823||45825<=e&&e<=45851||45853<=e&&e<=45879||45881<=e&&e<=45907||45909<=e&&e<=45935||45937<=e&&e<=45963||45965<=e&&e<=45991||45993<=e&&e<=46019||46021<=e&&e<=46047||46049<=e&&e<=46075||46077<=e&&e<=46103||46105<=e&&e<=46131||46133<=e&&e<=46159||46161<=e&&e<=46187||46189<=e&&e<=46215||46217<=e&&e<=46243||46245<=e&&e<=46271||46273<=e&&e<=46299||46301<=e&&e<=46327||46329<=e&&e<=46355||46357<=e&&e<=46383||46385<=e&&e<=46411||46413<=e&&e<=46439||46441<=e&&e<=46467||46469<=e&&e<=46495||46497<=e&&e<=46523||46525<=e&&e<=46551||46553<=e&&e<=46579||46581<=e&&e<=46607||46609<=e&&e<=46635||46637<=e&&e<=46663||46665<=e&&e<=46691||46693<=e&&e<=46719||46721<=e&&e<=46747||46749<=e&&e<=46775||46777<=e&&e<=46803||46805<=e&&e<=46831||46833<=e&&e<=46859||46861<=e&&e<=46887||46889<=e&&e<=46915||46917<=e&&e<=46943||46945<=e&&e<=46971||46973<=e&&e<=46999||47001<=e&&e<=47027||47029<=e&&e<=47055||47057<=e&&e<=47083||47085<=e&&e<=47111||47113<=e&&e<=47139||47141<=e&&e<=47167||47169<=e&&e<=47195||47197<=e&&e<=47223||47225<=e&&e<=47251||47253<=e&&e<=47279||47281<=e&&e<=47307||47309<=e&&e<=47335||47337<=e&&e<=47363||47365<=e&&e<=47391||47393<=e&&e<=47419||47421<=e&&e<=47447||47449<=e&&e<=47475||47477<=e&&e<=47503||47505<=e&&e<=47531||47533<=e&&e<=47559||47561<=e&&e<=47587||47589<=e&&e<=47615||47617<=e&&e<=47643||47645<=e&&e<=47671||47673<=e&&e<=47699||47701<=e&&e<=47727||47729<=e&&e<=47755||47757<=e&&e<=47783||47785<=e&&e<=47811||47813<=e&&e<=47839||47841<=e&&e<=47867||47869<=e&&e<=47895||47897<=e&&e<=47923||47925<=e&&e<=47951||47953<=e&&e<=47979||47981<=e&&e<=48007||48009<=e&&e<=48035||48037<=e&&e<=48063||48065<=e&&e<=48091||48093<=e&&e<=48119||48121<=e&&e<=48147||48149<=e&&e<=48175||48177<=e&&e<=48203||48205<=e&&e<=48231||48233<=e&&e<=48259||48261<=e&&e<=48287||48289<=e&&e<=48315||48317<=e&&e<=48343||48345<=e&&e<=48371||48373<=e&&e<=48399||48401<=e&&e<=48427||48429<=e&&e<=48455||48457<=e&&e<=48483||48485<=e&&e<=48511||48513<=e&&e<=48539||48541<=e&&e<=48567||48569<=e&&e<=48595||48597<=e&&e<=48623||48625<=e&&e<=48651||48653<=e&&e<=48679||48681<=e&&e<=48707||48709<=e&&e<=48735||48737<=e&&e<=48763||48765<=e&&e<=48791||48793<=e&&e<=48819||48821<=e&&e<=48847||48849<=e&&e<=48875||48877<=e&&e<=48903||48905<=e&&e<=48931||48933<=e&&e<=48959||48961<=e&&e<=48987||48989<=e&&e<=49015||49017<=e&&e<=49043||49045<=e&&e<=49071||49073<=e&&e<=49099||49101<=e&&e<=49127||49129<=e&&e<=49155||49157<=e&&e<=49183||49185<=e&&e<=49211||49213<=e&&e<=49239||49241<=e&&e<=49267||49269<=e&&e<=49295||49297<=e&&e<=49323||49325<=e&&e<=49351||49353<=e&&e<=49379||49381<=e&&e<=49407||49409<=e&&e<=49435||49437<=e&&e<=49463||49465<=e&&e<=49491||49493<=e&&e<=49519||49521<=e&&e<=49547||49549<=e&&e<=49575||49577<=e&&e<=49603||49605<=e&&e<=49631||49633<=e&&e<=49659||49661<=e&&e<=49687||49689<=e&&e<=49715||49717<=e&&e<=49743||49745<=e&&e<=49771||49773<=e&&e<=49799||49801<=e&&e<=49827||49829<=e&&e<=49855||49857<=e&&e<=49883||49885<=e&&e<=49911||49913<=e&&e<=49939||49941<=e&&e<=49967||49969<=e&&e<=49995||49997<=e&&e<=50023||50025<=e&&e<=50051||50053<=e&&e<=50079||50081<=e&&e<=50107||50109<=e&&e<=50135||50137<=e&&e<=50163||50165<=e&&e<=50191||50193<=e&&e<=50219||50221<=e&&e<=50247||50249<=e&&e<=50275||50277<=e&&e<=50303||50305<=e&&e<=50331||50333<=e&&e<=50359||50361<=e&&e<=50387||50389<=e&&e<=50415||50417<=e&&e<=50443||50445<=e&&e<=50471||50473<=e&&e<=50499||50501<=e&&e<=50527||50529<=e&&e<=50555||50557<=e&&e<=50583||50585<=e&&e<=50611||50613<=e&&e<=50639||50641<=e&&e<=50667||50669<=e&&e<=50695||50697<=e&&e<=50723||50725<=e&&e<=50751||50753<=e&&e<=50779||50781<=e&&e<=50807||50809<=e&&e<=50835||50837<=e&&e<=50863||50865<=e&&e<=50891||50893<=e&&e<=50919||50921<=e&&e<=50947||50949<=e&&e<=50975||50977<=e&&e<=51003||51005<=e&&e<=51031||51033<=e&&e<=51059||51061<=e&&e<=51087||51089<=e&&e<=51115||51117<=e&&e<=51143||51145<=e&&e<=51171||51173<=e&&e<=51199||51201<=e&&e<=51227||51229<=e&&e<=51255||51257<=e&&e<=51283||51285<=e&&e<=51311||51313<=e&&e<=51339||51341<=e&&e<=51367||51369<=e&&e<=51395||51397<=e&&e<=51423||51425<=e&&e<=51451||51453<=e&&e<=51479||51481<=e&&e<=51507||51509<=e&&e<=51535||51537<=e&&e<=51563||51565<=e&&e<=51591||51593<=e&&e<=51619||51621<=e&&e<=51647||51649<=e&&e<=51675||51677<=e&&e<=51703||51705<=e&&e<=51731||51733<=e&&e<=51759||51761<=e&&e<=51787||51789<=e&&e<=51815||51817<=e&&e<=51843||51845<=e&&e<=51871||51873<=e&&e<=51899||51901<=e&&e<=51927||51929<=e&&e<=51955||51957<=e&&e<=51983||51985<=e&&e<=52011||52013<=e&&e<=52039||52041<=e&&e<=52067||52069<=e&&e<=52095||52097<=e&&e<=52123||52125<=e&&e<=52151||52153<=e&&e<=52179||52181<=e&&e<=52207||52209<=e&&e<=52235||52237<=e&&e<=52263||52265<=e&&e<=52291||52293<=e&&e<=52319||52321<=e&&e<=52347||52349<=e&&e<=52375||52377<=e&&e<=52403||52405<=e&&e<=52431||52433<=e&&e<=52459||52461<=e&&e<=52487||52489<=e&&e<=52515||52517<=e&&e<=52543||52545<=e&&e<=52571||52573<=e&&e<=52599||52601<=e&&e<=52627||52629<=e&&e<=52655||52657<=e&&e<=52683||52685<=e&&e<=52711||52713<=e&&e<=52739||52741<=e&&e<=52767||52769<=e&&e<=52795||52797<=e&&e<=52823||52825<=e&&e<=52851||52853<=e&&e<=52879||52881<=e&&e<=52907||52909<=e&&e<=52935||52937<=e&&e<=52963||52965<=e&&e<=52991||52993<=e&&e<=53019||53021<=e&&e<=53047||53049<=e&&e<=53075||53077<=e&&e<=53103||53105<=e&&e<=53131||53133<=e&&e<=53159||53161<=e&&e<=53187||53189<=e&&e<=53215||53217<=e&&e<=53243||53245<=e&&e<=53271||53273<=e&&e<=53299||53301<=e&&e<=53327||53329<=e&&e<=53355||53357<=e&&e<=53383||53385<=e&&e<=53411||53413<=e&&e<=53439||53441<=e&&e<=53467||53469<=e&&e<=53495||53497<=e&&e<=53523||53525<=e&&e<=53551||53553<=e&&e<=53579||53581<=e&&e<=53607||53609<=e&&e<=53635||53637<=e&&e<=53663||53665<=e&&e<=53691||53693<=e&&e<=53719||53721<=e&&e<=53747||53749<=e&&e<=53775||53777<=e&&e<=53803||53805<=e&&e<=53831||53833<=e&&e<=53859||53861<=e&&e<=53887||53889<=e&&e<=53915||53917<=e&&e<=53943||53945<=e&&e<=53971||53973<=e&&e<=53999||54001<=e&&e<=54027||54029<=e&&e<=54055||54057<=e&&e<=54083||54085<=e&&e<=54111||54113<=e&&e<=54139||54141<=e&&e<=54167||54169<=e&&e<=54195||54197<=e&&e<=54223||54225<=e&&e<=54251||54253<=e&&e<=54279||54281<=e&&e<=54307||54309<=e&&e<=54335||54337<=e&&e<=54363||54365<=e&&e<=54391||54393<=e&&e<=54419||54421<=e&&e<=54447||54449<=e&&e<=54475||54477<=e&&e<=54503||54505<=e&&e<=54531||54533<=e&&e<=54559||54561<=e&&e<=54587||54589<=e&&e<=54615||54617<=e&&e<=54643||54645<=e&&e<=54671||54673<=e&&e<=54699||54701<=e&&e<=54727||54729<=e&&e<=54755||54757<=e&&e<=54783||54785<=e&&e<=54811||54813<=e&&e<=54839||54841<=e&&e<=54867||54869<=e&&e<=54895||54897<=e&&e<=54923||54925<=e&&e<=54951||54953<=e&&e<=54979||54981<=e&&e<=55007||55009<=e&&e<=55035||55037<=e&&e<=55063||55065<=e&&e<=55091||55093<=e&&e<=55119||55121<=e&&e<=55147||55149<=e&&e<=55175||55177<=e&&e<=55203?v:9757==e||9977==e||9994<=e&&e<=9997||127877==e||127938<=e&&e<=127940||127943==e||127946<=e&&e<=127948||128066<=e&&e<=128067||128070<=e&&e<=128080||128110==e||128112<=e&&e<=128120||128124==e||128129<=e&&e<=128131||128133<=e&&e<=128135||128170==e||128372<=e&&e<=128373||128378==e||128400==e||128405<=e&&e<=128406||128581<=e&&e<=128583||128587<=e&&e<=128591||128675==e||128692<=e&&e<=128694||128704==e||128716==e||129304<=e&&e<=129308||129310<=e&&e<=129311||129318==e||129328<=e&&e<=129337||129341<=e&&e<=129342||129489<=e&&e<=129501?b:127995<=e&&e<=127999?E:8205==e?T:9792==e||9794==e||9877<=e&&e<=9878||9992==e||10084==e||127752==e||127806==e||127859==e||127891==e||127908==e||127912==e||127979==e||127981==e||128139==e||128187<=e&&e<=128188||128295==e||128300==e||128488==e||128640==e||128658==e?S:128102<=e&&e<=128105?C:11}return this.nextBreak=function(e,t){if(void 0===t&&(t=0),t<0)return 0;if(t>=e.length-1)return e.length;for(var n,r,i=N(u(e,t)),o=[],a=t+1;a<e.length;a++)if(r=a-1,!(55296<=(n=e).charCodeAt(r)&&n.charCodeAt(r)<=56319&&56320<=n.charCodeAt(r+1)&&n.charCodeAt(r+1)<=57343)){var s=N(u(e,a));if(L(i,o,s))return a;o.push(s)}return e.length},this.splitGraphemes=function(e){for(var t,n=[],r=0;(t=this.nextBreak(e,r))<e.length;)n.push(e.slice(r,t)),r=t;return r<e.length&&n.push(e.slice(r)),n},this.iterateGraphemes=function(n){var r=0,e={next:function(){var e,t;return(t=this.nextBreak(n,r))<n.length?(e=n.slice(r,t),r=t,{value:e,done:!1}):r<n.length?(e=n.slice(r),r=n.length,{value:e,done:!1}):{value:void 0,done:!0}}.bind(this)};return"undefined"!=typeof Symbol&&Symbol.iterator&&(e[Symbol.iterator]=function(){return e}),e},this.countGraphemes=function(e){for(var t,n=0,r=0;(t=this.nextBreak(e,r))<e.length;)r=t,n++;return r<e.length&&n++,n},this};function uw(e,t){var n,r,i=t._renderedText,o=sw.splitGraphemes(i),a=o.length,s=t._glyphs,u=s.length;if(t._relativeSize=t._fontSize/_S.FONT_SIZE,a<u)for(r=a;r<u;++r)nw(e,s[r]);s.length=a;var l=t._showBackground&&0<i.split("\n").join("").length,c=t._backgroundBillboard,h=e._backgroundBillboardCollection;l?(Ze(c)||(c=h.add({collection:e,image:ZC,imageSubRegion:$C}),t._backgroundBillboard=c),c.color=t._backgroundColor,c.show=t._show,c.position=t._position,c.eyeOffset=t._eyeOffset,c.pixelOffset=t._pixelOffset,c.horizontalOrigin=ST.LEFT,c.verticalOrigin=t._verticalOrigin,c.heightReference=t._heightReference,c.scale=t.totalScale,c.pickPrimitive=t,c.id=t._id,c.translucencyByDistance=t._translucencyByDistance,c.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,c.scaleByDistance=t._scaleByDistance,c.distanceDisplayCondition=t._distanceDisplayCondition,c.disableDepthTestDistance=t._disableDepthTestDistance):Ze(c)&&(h.remove(c),t._backgroundBillboard=c=void 0);for(var f=e._glyphTextureCache,p=0;p<a;++p){var d,m,_=o[p],g=t._verticalOrigin,y=JSON.stringify([_,t._fontFamily,t._fontStyle,t._fontWeight,+g]),v=f[y];if(!Ze(v)){var x,b=t._fontStyle+" "+t._fontWeight+" "+_S.FONT_SIZE+"px "+t._fontFamily,E=!1;if(Ze(rw[y])?(x=rw[y],E=!0):(x=tw(_,b,It.WHITE,It.WHITE,0,DC.FILL,g),iw<ow&&(rw[y]=x,iw++)),v=new KC(e,-1,x.dimensions),f[y]=v,0<x.width&&0<x.height){if(!E){for(var T=LC(x,{cutoff:_S.CUTOFF,radius:_S.RADIUS}),S=x.getContext("2d"),C=x.width,w=x.height,A=S.getImageData(0,0,C,w),I=0;I<C;I++)for(var P=0;P<w;P++){var O=P*C+I,L=255*T[O],N=4*O;A.data[0+N]=L,A.data[1+N]=L,A.data[2+N]=L,A.data[3+N]=L}S.putImageData(A,0,0)}" "!==_&&aw(e._textureAtlas,y,x,v)}}Ze(n=s[p])?-1===v.index?nw(e,n):Ze(n.textureInfo)&&(n.textureInfo=void 0):(n=new jC,s[p]=n),n.textureInfo=v,n.dimensions=v.dimensions,-1!==v.index&&(d=n.billboard,m=e._spareBillboards,Ze(d)||(0<m.length?d=m.pop():((d=e._billboardCollection.add({collection:e}))._labelDimensions=new En,d._labelTranslate=new En),n.billboard=d),d.show=t._show,d.position=t._position,d.eyeOffset=t._eyeOffset,d.pixelOffset=t._pixelOffset,d.horizontalOrigin=ST.LEFT,d.verticalOrigin=t._verticalOrigin,d._clampedPosition=t._clampedPosition,d.scale=t.totalScale,d.pickPrimitive=t,d.id=t._id,d.image=y,d.translucencyByDistance=t._translucencyByDistance,d.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,d.scaleByDistance=t._scaleByDistance,d.distanceDisplayCondition=t._distanceDisplayCondition,d.disableDepthTestDistance=t._disableDepthTestDistance,d._batchIndex=t._batchIndex,d.outlineColor=t.outlineColor,t.style===DC.FILL_AND_OUTLINE?(d.color=t._fillColor,d.outlineWidth=t.outlineWidth):t.style===DC.FILL?(d.color=t._fillColor,d.outlineWidth=0):t.style===DC.OUTLINE&&(d.color=It.TRANSPARENT,d.outlineWidth=t.outlineWidth))}t._repositionAllGlyphs=!0}function lw(e,t,n){return t===ST.CENTER?-e/2:t===ST.RIGHT?-(e+n.x):n.x}var cw=new En,hw=new En;function fw(e){var t=e._glyphs,n=e._renderedText,r=0,i=0,o=[],a=Number.NEGATIVE_INFINITY,s=0,u=1,l=t.length,c=e._backgroundBillboard,h=En.clone(Ze(c)?e._backgroundPadding:En.ZERO,hw);for(h.x/=e._relativeSize,h.y/=e._relativeSize,I=0;I<l;++I)"\n"===n.charAt(I)?(o.push(r),++u,r=0):(C=(S=t[I]).dimensions,s=Math.max(s,C.height-C.descent),a=Math.max(a,C.descent),r+=C.width-C.bounds.minx,I<l-1&&(r+=t[I+1].dimensions.bounds.minx),i=Math.max(i,r));o.push(r);var f=s+a,p=e.totalScale,d=e._horizontalOrigin,m=e._verticalOrigin,_=0,g=o[_],y=lw(g,d,h),v=QC*f,x=v*(u-1),b=i,E=f+x;Ze(c)&&(b+=2*h.x,E+=2*h.y,c._labelHorizontalOrigin=d),cw.x=y*p;for(var T,S,C,w=!(cw.y=0),A=0,I=0;I<l;++I){"\n"===n.charAt(I)?(A+=v,y=lw(g=o[++_],d,h),cw.x=y*p,w=!0):(C=(S=t[I]).dimensions,m===HT.TOP?(cw.y=C.height-s-h.y,cw.y+=_S.PADDING):m===HT.CENTER?cw.y=(x+C.height-s)/2:(m===HT.BASELINE?cw.y=x:cw.y=x+a+h.y,cw.y-=_S.PADDING),cw.y=(cw.y-C.descent-A)*p,w&&(cw.x-=_S.PADDING*p,w=!1),Ze(S.billboard)&&(S.billboard._setTranslate(cw),S.billboard._labelDimensions.x=b,S.billboard._labelDimensions.y=E,S.billboard._labelHorizontalOrigin=d),I<l-1&&(T=t[I+1],cw.x+=(C.width-C.bounds.minx+T.dimensions.bounds.minx)*p))}if(Ze(c)&&0<n.split("\n").join("").length&&(y=d===ST.CENTER?-i/2-h.x:d===ST.RIGHT?-(i+2*h.x):0,cw.x=y*p,m===HT.TOP?cw.y=f-s-a:m===HT.CENTER?cw.y=(f-s)/2-a:m===HT.BASELINE?cw.y=-h.y-a:cw.y=0,cw.y=cw.y*p,c.width=b,c.height=E,c._setTranslate(cw),c._labelTranslate=En.clone(cw,c._labelTranslate)),e.heightReference===Ap.CLAMP_TO_GROUND)for(I=0;I<l;++I){var P=(S=t[I]).billboard;Ze(P)&&(P._labelTranslate=En.clone(cw,P._labelTranslate))}}function pw(e,t){for(var n=t._glyphs,r=0,i=n.length;r<i;++r)nw(e,n[r]);Ze(t._backgroundBillboard)&&(e._backgroundBillboardCollection.remove(t._backgroundBillboard),t._backgroundBillboard=void 0),t._labelCollection=void 0,Ze(t._removeCallbackFunc)&&t._removeCallbackFunc(),Vt(t)}function dw(e){e=Je(e,Je.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._backgroundTextureAtlas=void 0,this._whitePixelIndex=void 0,this._backgroundBillboardCollection=new HS({scene:this._scene}),this._backgroundBillboardCollection.destroyTextureAtlas=!1,this._billboardCollection=new HS({scene:this._scene,batchTable:this._batchTable}),this._billboardCollection.destroyTextureAtlas=!1,this._billboardCollection._sdf=!0,this._spareBillboards=[],this._glyphTextureCache={},this._labels=[],this._labelsToUpdate=[],this._totalGlyphCount=0,this._highlightColor=It.clone(It.WHITE),this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this.blendOption=Je(e.blendOption,mS.OPAQUE_AND_TRANSLUCENT)}Object.defineProperties(dw.prototype,{length:{get:function(){return this._labels.length}}}),dw.prototype.resize=function(e){this.removeAll(),this._spareBillboards=[],this._billboardCollection.removeAll(),this._labels=e;for(var t=0;t<e.length;t++)this._labelsToUpdate.push(e[t]);return!0},dw.prototype.add=function(e){var t=new qC(e,this);return this._labels.push(t),this._labelsToUpdate.push(t),t},dw.prototype.remove=function(e){if(Ze(e)&&e._labelCollection===this){var t=this._labels.indexOf(e);if(-1!==t)return this._labels.splice(t,1),pw(this,e),!0}return!1},dw.prototype.removeAll=function(){for(var e=this._labels,t=0,n=e.length;t<n;++t)pw(this,e[t]);e.length=0},dw.prototype.contains=function(e){return Ze(e)&&e._labelCollection===this},dw.prototype.get=function(e){return this._labels[e]},dw.prototype.update=function(e){var t=this._billboardCollection,n=this._backgroundBillboardCollection;t.modelMatrix=this.modelMatrix,t.debugShowBoundingVolume=this.debugShowBoundingVolume,n.modelMatrix=this.modelMatrix,n.debugShowBoundingVolume=this.debugShowBoundingVolume;var r=e.context;Ze(this._textureAtlas)||(this._textureAtlas=new vS({context:r}),t.textureAtlas=this._textureAtlas),Ze(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new vS({context:r,initialSize:JC}),n.textureAtlas=this._backgroundTextureAtlas,function(e,t){var n=document.createElement("canvas");n.width=JC.x,n.height=JC.y;var r=n.getContext("2d");r.fillStyle="#fff",r.fillRect(0,0,n.width,n.height),e.addImage(ZC,n).then(function(e){t._whitePixelIndex=e})}(this._backgroundTextureAtlas,this));for(var i=this._labelsToUpdate.length,o=0;o<i;++o){var a,s,u=this._labelsToUpdate[o];u.isDestroyed()||(a=u._glyphs.length,u._rebindAllGlyphs&&(uw(this,u),u._rebindAllGlyphs=!1),u._repositionAllGlyphs&&(fw(u),u._repositionAllGlyphs=!1),s=u._glyphs.length-a,this._totalGlyphCount+=s)}var l=0<n.length?mS.TRANSLUCENT:this.blendOption;t.blendOption=l,n.blendOption=l,t._highlightColor=this._highlightColor,n._highlightColor=this._highlightColor,this._labelsToUpdate.length=0,n.update(e),t.update(e)},dw.prototype.isDestroyed=function(){return!1},dw.prototype.destroy=function(){return this.removeAll(),this._billboardCollection=this._billboardCollection.destroy(),this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy(),this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy(),Vt(this)};var mw="void clipLineSegmentToNearPlane(\nvec3 p0,\nvec3 p1,\nout vec4 positionWC,\nout bool clipped,\nout bool culledByNearPlane,\nout vec4 clippedPositionEC)\n{\nculledByNearPlane = false;\nclipped = false;\nvec3 p0ToP1 = p1 - p0;\nfloat magnitude = length(p0ToP1);\nvec3 direction = normalize(p0ToP1);\nfloat endPoint0Distance =  czm_currentFrustum.x + p0.z;\nfloat denominator = -direction.z;\nif (endPoint0Distance > 0.0 && abs(denominator) < czm_epsilon7)\n{\nculledByNearPlane = true;\n}\nelse if (endPoint0Distance > 0.0)\n{\nfloat t = endPoint0Distance / denominator;\nif (t < 0.0 || t > magnitude)\n{\nculledByNearPlane = true;\n}\nelse\n{\np0 = p0 + t * direction;\np0.z = min(p0.z, -czm_currentFrustum.x);\nclipped = true;\n}\n}\nclippedPositionEC = vec4(p0, 1.0);\npositionWC = czm_eyeToWindowCoordinates(clippedPositionEC);\n}\nvec4 getPolylineWindowCoordinatesEC(vec4 positionEC, vec4 prevEC, vec4 nextEC, float expandDirection, float width, bool usePrevious, out float angle)\n{\n#ifdef POLYLINE_DASH\nvec4 positionWindow = czm_eyeToWindowCoordinates(positionEC);\nvec4 previousWindow = czm_eyeToWindowCoordinates(prevEC);\nvec4 nextWindow = czm_eyeToWindowCoordinates(nextEC);\nvec2 lineDir;\nif (usePrevious) {\nlineDir = normalize(positionWindow.xy - previousWindow.xy);\n}\nelse {\nlineDir = normalize(nextWindow.xy - positionWindow.xy);\n}\nangle = atan(lineDir.x, lineDir.y) - 1.570796327;\nangle = floor(angle / czm_piOverFour + 0.5) * czm_piOverFour;\n#endif\nvec4 clippedPrevWC, clippedPrevEC;\nbool prevSegmentClipped, prevSegmentCulled;\nclipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, clippedPrevWC, prevSegmentClipped, prevSegmentCulled, clippedPrevEC);\nvec4 clippedNextWC, clippedNextEC;\nbool nextSegmentClipped, nextSegmentCulled;\nclipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, clippedNextWC, nextSegmentClipped, nextSegmentCulled, clippedNextEC);\nbool segmentClipped, segmentCulled;\nvec4 clippedPositionWC, clippedPositionEC;\nclipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, clippedPositionWC, segmentClipped, segmentCulled, clippedPositionEC);\nif (segmentCulled)\n{\nreturn vec4(0.0, 0.0, 0.0, 1.0);\n}\nvec2 directionToPrevWC = normalize(clippedPrevWC.xy - clippedPositionWC.xy);\nvec2 directionToNextWC = normalize(clippedNextWC.xy - clippedPositionWC.xy);\nif (prevSegmentCulled)\n{\ndirectionToPrevWC = -directionToNextWC;\n}\nelse if (nextSegmentCulled)\n{\ndirectionToNextWC = -directionToPrevWC;\n}\nvec2 thisSegmentForwardWC, otherSegmentForwardWC;\nif (usePrevious)\n{\nthisSegmentForwardWC = -directionToPrevWC;\notherSegmentForwardWC = directionToNextWC;\n}\nelse\n{\nthisSegmentForwardWC = directionToNextWC;\notherSegmentForwardWC =  -directionToPrevWC;\n}\nvec2 thisSegmentLeftWC = vec2(-thisSegmentForwardWC.y, thisSegmentForwardWC.x);\nvec2 leftWC = thisSegmentLeftWC;\nfloat expandWidth = width * 0.5;\nif (!czm_equalsEpsilon(prevEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) && !czm_equalsEpsilon(nextEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1))\n{\nvec2 otherSegmentLeftWC = vec2(-otherSegmentForwardWC.y, otherSegmentForwardWC.x);\nvec2 leftSumWC = thisSegmentLeftWC + otherSegmentLeftWC;\nfloat leftSumLength = length(leftSumWC);\nleftWC = leftSumLength < czm_epsilon6 ? thisSegmentLeftWC : (leftSumWC / leftSumLength);\nvec2 u = -thisSegmentForwardWC;\nvec2 v = leftWC;\nfloat sinAngle = abs(u.x * v.y - u.y * v.x);\nexpandWidth = clamp(expandWidth / sinAngle, 0.0, width * 2.0);\n}\nvec2 offset = leftWC * expandDirection * expandWidth * czm_pixelRatio;\nreturn vec4(clippedPositionWC.xy + offset, -clippedPositionWC.z, 1.0) * (czm_projection * clippedPositionEC).w;\n}\nvec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle)\n{\nvec4 positionEC = czm_modelViewRelativeToEye * position;\nvec4 prevEC = czm_modelViewRelativeToEye * previous;\nvec4 nextEC = czm_modelViewRelativeToEye * next;\nreturn getPolylineWindowCoordinatesEC(positionEC, prevEC, nextEC, expandDirection, width, usePrevious, angle);\n}\n";function _w(e){this.type=void 0,this.shaderSource=void 0,this.materials=void 0,this.uniforms=void 0,this._uniforms=void 0,this.translucent=void 0,this.isAnimation=e.isAnimation,this.isAnimation&&(this._images={}),this._minificationFilter=Je(e.minificationFilter,Pr.LINEAR),this._magnificationFilter=Je(e.magnificationFilter,Ar.LINEAR),this._strict=void 0,this._template=void 0,this._count=void 0,this._texturePaths={},this._loadedImages=[],this._loadedCubeMaps=[],this._textures={},this._updateFunctions=[],this._defaultTexture=void 0,function(e,t){var n;e=Je(e,Je.EMPTY_OBJECT),t._strict=Je(e.strict,!1),t._count=Je(e.count,0),t._template=$e(Je(e.fabric,Je.EMPTY_OBJECT)),t._template.uniforms=$e(Je(t._template.uniforms,Je.EMPTY_OBJECT)),t._template.materials=$e(Je(t._template.materials,Je.EMPTY_OBJECT)),t.type=Ze(t._template.type)?t._template.type:Jr(),t.shaderSource="",t.materials={},t.uniforms={},t._uniforms={},t._translucentFunctions=[];var r=_w._materialCache.getMaterial(t.type);{var i;Ze(r)&&(i=$e(r.fabric,!0),t._template=ne(t._template,i,!0),n=r.translucent)}(function(e){var t=e._template,n=t.uniforms,r=t.materials,i=t.components;gw(t,xw,yw,!0),gw(i,bw,yw,!0);var o=[];for(var a in r)r.hasOwnProperty(a)&&o.push(a);gw(n,o,vw,!1)})(t),Ze(r)||_w._materialCache.addMaterial(t.type,t);(function(e){var t=e._template.components,n=e._template.source;if(Ze(n))e.shaderSource+=n+"\n";else{if(e.shaderSource+="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n",e.shaderSource+="czm_material material = czm_getDefaultMaterial(materialInput);\n",Ze(t)){var r,i=0<Object.keys(e._template.materials).length;for(var o in t){t.hasOwnProperty(o)&&("diffuse"===o||"emission"===o?(r=i&&Ew(t[o],e)?t[o]:"czm_gammaCorrect("+t[o]+")",e.shaderSource+="material."+o+" = "+r+"; \n"):e.shaderSource+="alpha"===o?"material.alpha = "+t.alpha+"; \n":"material."+o+" = "+t[o]+";\n")}}e.shaderSource+="return material;\n}\n"}})(t),function(e){var t=e._template.uniforms;for(var n in t)t.hasOwnProperty(n)&&ww(e,n)}(t),function(e){var t=e._strict,n=e._template.materials;for(var r in n){var i,o,a;n.hasOwnProperty(r)&&(i=new _w({strict:t,fabric:n[r],count:e._count}),e._count=i._count,e._uniforms=ne(e._uniforms,i._uniforms,!0),e.materials[r]=i,e._translucentFunctions=e._translucentFunctions.concat(i._translucentFunctions),a=(o="czm_getMaterial")+"_"+e._count++,Aw(i,o,a),e.shaderSource=i.shaderSource+e.shaderSource,Aw(e,r,a+"(materialInput)"))}}(t);var o=0===t._translucentFunctions.length||void 0;{n=Je(n,o),Ze(n=Je(e.translucent,n))&&("function"==typeof n?t._translucentFunctions.push(function(){return n(t)}):t._translucentFunctions.push(n))}}(e,this),Object.defineProperties(this,{type:{value:this.type,writable:!1}}),Ze(_w._uniformList[this.type])||(_w._uniformList[this.type]=Object.keys(this._uniforms))}function gw(e,t,n,r){if(Ze(e))for(var i in e){var o;e.hasOwnProperty(i)&&(o=-1!==t.indexOf(i),(r&&!o||!r&&o)&&n(i,t))}}function yw(e,t){}function vw(e,t){}_w._uniformList={},_w.fromType=function(e,t){var n=new _w({fabric:{type:e}});if(Ze(t))for(var r in t)t.hasOwnProperty(r)&&(n.uniforms[r]=t[r]);return n},_w.prototype.isTranslucent=function(){if(Ze(this.translucent))return"function"==typeof this.translucent?this.translucent():this.translucent;for(var e=!0,t=this._translucentFunctions,n=t.length,r=0;r<n;++r){var i=t[r];if(!(e="function"==typeof i?e&&i():e&&i))break}return e},_w.prototype.update=function(e){for(var t=this._loadedImages,n=t.length,r=0;r<n;++r){var i=t[r],o=i.id,a=i.image,s=new Nr({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter}),u=Ze(a.internalFormat)?new ti({context:e,pixelFormat:a.internalFormat,width:a.width,height:a.height,source:{arrayBufferView:a.bufferView},sampler:s}):new ti({context:e,source:a,sampler:s});this._textures[o]=u,this.isAnimation&&(this._images[o]=a);var l,c=o+"Dimensions";this.uniforms.hasOwnProperty(c)&&((l=this.uniforms[c]).x=u._width,l.y=u._height)}t.length=0;var h,f,p=this._loadedCubeMaps,n=p.length;for(r=0;r<n;++r){var d=p[r];o=d.id;var m,_=new ud({context:e,source:{positiveX:(m=d.images)[0],negativeX:m[1],positiveY:m[2],negativeY:m[3],positiveZ:m[4],negativeZ:m[5]},sampler:new Nr({minificationFilter:this._minificationFilter,magnificationFilter:this._magnificationFilter})});this._textures[o]=_}p.length=0,!this.isAnimation||0<(h=Object.keys(this._images)).length&&(f=this._textures,m=this._images,h.forEach(function(e){f[e].copyFrom(m[e])}));var g=this._updateFunctions;for(n=g.length,r=0;r<n;++r)g[r](this,e);var y=this.materials;for(var v in y)y.hasOwnProperty(v)&&y[v].update(e)},_w.prototype.isDestroyed=function(){return!1},_w.prototype.destroy=function(){var e,t=this._textures;for(var n in t){!t.hasOwnProperty(n)||(e=t[n])!==this._defaultTexture&&e.destroy()}var r=this.materials;for(var i in r)r.hasOwnProperty(i)&&r[i].destroy();return Vt(this)};var xw=["type","materials","uniforms","components","source"],bw=["diffuse","specular","shininess","normal","emission","alpha"];function Ew(e,t){var n=t._template.materials;for(var r in n)if(n.hasOwnProperty(r)&&-1<e.indexOf(r))return!0;return!1}var Tw={mat2:fi,mat3:jt,mat4:on},Sw=/\.ktx$/i,Cw=/\.crn$/i;function ww(e,t){e._strict;var n,r,i,o,a,h,f,s,u,l=e._template.uniforms,c=l[t],p=function(e){var t=e.type;if(!Ze(t)){var n=typeof e;if("number"==n)t="float";else if("boolean"==n)t="bool";else if("string"==n||e instanceof rt||e instanceof HTMLCanvasElement||e instanceof HTMLImageElement)t=/^([rgba]){1,4}$/i.test(e)?"channels":e===_w.DefaultCubeMapId?"samplerCube":"sampler2D";else if("object"==n)if(Array.isArray(e))4!==e.length&&9!==e.length&&16!==e.length||(t="mat"+Math.sqrt(e.length));else{var r=0;for(var i in e)e.hasOwnProperty(i)&&(r+=1);2<=r&&r<=4?t="vec"+r:6===r&&(t="samplerCube")}}return t}(c);"channels"===p?Aw(e,t,c,!1):("sampler2D"!==p||0<Aw(e,s=n=t+"Dimensions",s,u)&&(l[n]={type:"ivec3",x:1,y:1},ww(e,n)),new RegExp("uniform\\s+"+p+"\\s+"+t+"\\s*;").test(e.shaderSource)||(r="uniform "+p+" "+t+";",e.shaderSource=r+e.shaderSource),i=t+"_"+e._count++,Aw(e,t,i),e.uniforms[t]=c,"sampler2D"===p?(e._uniforms[i]=function(){return e._textures[t]},e._updateFunctions.push((h=t,function(t,e){var n=t.uniforms,r=n[h],i=f!==r;f=r;var o,a,s,u,l=t._textures[h];if(r instanceof HTMLVideoElement)if(2<=r.readyState){if(i&&Ze(l)&&(l!==e.defaultTexture&&l.destroy(),l=void 0),!Ze(l)||l===e.defaultTexture)return l=new ti({context:e,source:r,sampler:new Nr({minificationFilter:t._minificationFilter,magnificationFilter:t._magnificationFilter})}),void(t._textures[h]=l);l.copyFrom(r)}else Ze(l)||(t._textures[h]=e.defaultTexture);else{if(r instanceof ti&&r!==l){t._texturePaths[h]=void 0;var c=t._textures[h];return c!==t._defaultTexture&&c.destroy(),t._textures[h]=r,o=h+"Dimensions",void(n.hasOwnProperty(o)&&((a=n[o]).x=r._width,a.y=r._height))}Ze(l)||(t._texturePaths[h]=void 0,Ze(t._defaultTexture)||(t._defaultTexture=e.defaultTexture),l=t._textures[h]=t._defaultTexture,o=h+"Dimensions",n.hasOwnProperty(o)&&((a=n[o]).x=l._width,a.y=l._height)),r!==_w.DefaultImageId&&(s=r instanceof rt,(!Ze(t._texturePaths[h])||s&&r.url!==t._texturePaths[h].url||!s&&r!==t._texturePaths[h])&&("string"==typeof r||s?(u=s?r:rt.createIfNeeded(r),D(Sw.test(u.url)?Uf(u):Cw.test(u.url)?zf(u):u.fetchImage(),function(e){t._loadedImages.push({id:h,image:e})})):(r instanceof HTMLCanvasElement||r instanceof HTMLImageElement)&&t._loadedImages.push({id:h,image:r}),t._texturePaths[h]=r))}}))):"samplerCube"===p?(e._uniforms[i]=function(){return e._textures[t]},e._updateFunctions.push((a=t,function(t,e){var n,r,i=t.uniforms[a];if(i instanceof ud){var o=t._textures[a];return o!==t._defaultTexture&&o.destroy(),t._texturePaths[a]=void 0,void(t._textures[a]=i)}Ze(t._textures[a])||(t._texturePaths[a]=void 0,t._textures[a]=e.defaultCubeMap),i===_w.DefaultCubeMapId||(n=i.positiveX+i.negativeX+i.positiveY+i.negativeY+i.positiveZ+i.negativeZ)!==t._texturePaths[a]&&(r=[rt.createIfNeeded(i.positiveX).fetchImage(),rt.createIfNeeded(i.negativeX).fetchImage(),rt.createIfNeeded(i.positiveY).fetchImage(),rt.createIfNeeded(i.negativeY).fetchImage(),rt.createIfNeeded(i.positiveZ).fetchImage(),rt.createIfNeeded(i.negativeZ).fetchImage()],D.all(r).then(function(e){t._loadedCubeMaps.push({id:a,images:e})}),t._texturePaths[a]=n)}))):-1!==p.indexOf("mat")?(o=new Tw[p],e._uniforms[i]=function(){return Tw[p].fromColumnMajorArray(e.uniforms[t],o)}):e._uniforms[i]=function(){return e.uniforms[t]})}function Aw(e,t,r,n){n=Je(n,!0);var i=0,o=new RegExp("([\\w"+(n?".":"")+"])?"+t+"([\\w])?","g");return e.shaderSource=e.shaderSource.replace(o,function(e,t,n){return t||n?e:(i+=1,r)}),i}_w._materialCache={_materials:{},addMaterial:function(e,t){this._materials[e]=t},getMaterial:function(e){return this._materials[e]}},_w.DefaultImageId="czm_defaultImage",_w.DefaultCubeMapId="czm_defaultCubeMap",_w.ColorType="Color",_w._materialCache.addMaterial(_w.ColorType,{fabric:{type:_w.ColorType,uniforms:{color:new It(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}}),_w.ImageType="Image",_w._materialCache.addMaterial(_w.ImageType,{fabric:{type:_w.ImageType,uniforms:{image:_w.DefaultImageId,repeat:new En(1,1),color:new It(1,1,1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).rgb * color.rgb",alpha:"texture2D(image, fract(repeat * materialInput.st)).a * color.a"}},translucent:function(e){return e.uniforms.color.alpha<1}}),_w.DiffuseMapType="DiffuseMap",_w._materialCache.addMaterial(_w.DiffuseMapType,{fabric:{type:_w.DiffuseMapType,uniforms:{image:_w.DefaultImageId,channels:"rgb",repeat:new En(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),_w.AlphaMapType="AlphaMap",_w._materialCache.addMaterial(_w.AlphaMapType,{fabric:{type:_w.AlphaMapType,uniforms:{image:_w.DefaultImageId,channel:"a",repeat:new En(1,1)},components:{alpha:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!0}),_w.SpecularMapType="SpecularMap",_w._materialCache.addMaterial(_w.SpecularMapType,{fabric:{type:_w.SpecularMapType,uniforms:{image:_w.DefaultImageId,channel:"r",repeat:new En(1,1)},components:{specular:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!1}),_w.EmissionMapType="EmissionMap",_w._materialCache.addMaterial(_w.EmissionMapType,{fabric:{type:_w.EmissionMapType,uniforms:{image:_w.DefaultImageId,channels:"rgb",repeat:new En(1,1)},components:{emission:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),_w.BumpMapType="BumpMap",_w._materialCache.addMaterial(_w.BumpMapType,{fabric:{type:_w.BumpMapType,uniforms:{image:_w.DefaultImageId,channel:"r",strength:.8,repeat:new En(1,1)},source:"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 centerPixel = fract(repeat * st);\nfloat centerBump = texture2D(image, centerPixel).channel;\nfloat imageWidth = float(imageDimensions.x);\nvec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));\nfloat rightBump = texture2D(image, rightPixel).channel;\nfloat imageHeight = float(imageDimensions.y);\nvec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));\nfloat topBump = texture2D(image, leftPixel).channel;\nvec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nmaterial.diffuse = vec3(0.01);\nreturn material;\n}\n"},translucent:!1}),_w.NormalMapType="NormalMap",_w._materialCache.addMaterial(_w.NormalMapType,{fabric:{type:_w.NormalMapType,uniforms:{image:_w.DefaultImageId,channels:"rgb",strength:.8,repeat:new En(1,1)},source:"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 textureValue = texture2D(image, fract(repeat * materialInput.st));\nvec3 normalTangentSpace = textureValue.channels;\nnormalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;\nnormalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);\nnormalTangentSpace = normalize(normalTangentSpace);\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nreturn material;\n}\n"},translucent:!1}),_w.GridType="Grid",_w._materialCache.addMaterial(_w.GridType,{fabric:{type:_w.GridType,uniforms:{color:new It(0,1,0,1),cellAlpha:.1,lineCount:new En(8,8),lineThickness:new En(1,1),lineOffset:new En(0,0)},source:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float cellAlpha;\nuniform vec2 lineCount;\nuniform vec2 lineThickness;\nuniform vec2 lineOffset;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat scaledWidth = fract(lineCount.s * st.s - lineOffset.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(lineCount.t * st.t - lineOffset.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value;\n#ifdef GL_OES_standard_derivatives\nconst float fuzz = 1.2;\nvec2 thickness = (lineThickness * czm_pixelRatio) - 1.0;\nvec2 dx = abs(dFdx(st));\nvec2 dy = abs(dFdy(st));\nvec2 dF = vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;\nvalue = min(\nsmoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),\nsmoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));\n#else\nconst float fuzz = 0.05;\nvec2 range = 0.5 - (lineThickness * 0.05);\nvalue = min(\n1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),\n1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));\n#endif\nfloat dRim = 1.0 - abs(dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC)));\nfloat sRim = smoothstep(0.8, 1.0, dRim);\nvalue *= (1.0 - sRim);\nvec4 halfColor;\nhalfColor.rgb = color.rgb * 0.5;\nhalfColor.a = color.a * (1.0 - ((1.0 - cellAlpha) * value));\nhalfColor = czm_gammaCorrect(halfColor);\nmaterial.diffuse = halfColor.rgb;\nmaterial.emission = halfColor.rgb;\nmaterial.alpha = halfColor.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.color.alpha<1||t.cellAlpha<1}}),_w.StripeType="Stripe",_w._materialCache.addMaterial(_w.StripeType,{fabric:{type:_w.StripeType,uniforms:{horizontal:!0,evenColor:new It(1,1,1,.5),oddColor:new It(0,0,1,.5),offset:0,repeat:5},source:"uniform vec4 evenColor;\nuniform vec4 oddColor;\nuniform float offset;\nuniform float repeat;\nuniform bool horizontal;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));\nfloat value = fract((coord - offset) * (repeat * 0.5));\nfloat dist = min(value, min(abs(value - 0.5), 1.0 - value));\nvec4 currentColor = mix(evenColor, oddColor, step(0.5, value));\nvec4 color = czm_antialias(evenColor, oddColor, currentColor, dist);\ncolor = czm_gammaCorrect(color);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.evenColor.alpha<1||t.oddColor.alpha<1}}),_w.CheckerboardType="Checkerboard",_w._materialCache.addMaterial(_w.CheckerboardType,{fabric:{type:_w.CheckerboardType,uniforms:{lightColor:new It(1,1,1,.5),darkColor:new It(0,0,0,.5),repeat:new En(5,5)},source:"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);\nfloat scaledWidth = fract(repeat.s * st.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(repeat.t * st.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value = min(scaledWidth, scaledHeight);\nvec4 currentColor = mix(lightColor, darkColor, b);\nvec4 color = czm_antialias(lightColor, darkColor, currentColor, value, 0.03);\ncolor = czm_gammaCorrect(color);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),_w.DotType="Dot",_w._materialCache.addMaterial(_w.DotType,{fabric:{type:_w.DotType,uniforms:{lightColor:new It(1,1,0,.75),darkColor:new It(0,1,1,.75),repeat:new En(5,5)},source:"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));\nvec4 color = mix(lightColor, darkColor, b);\ncolor = czm_gammaCorrect(color);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),_w.WaterType="Water",_w._materialCache.addMaterial(_w.WaterType,{fabric:{type:_w.WaterType,uniforms:{baseWaterColor:new It(.2,.3,.6,1),blendColor:new It(0,1,.699,1),specularMap:_w.DefaultImageId,normalMap:_w.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:"uniform sampler2D specularMap;\nuniform sampler2D normalMap;\nuniform vec4 baseWaterColor;\nuniform vec4 blendColor;\nuniform float frequency;\nuniform float animationSpeed;\nuniform float amplitude;\nuniform float specularIntensity;\nuniform float fadeFactor;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat time = czm_frameNumber * animationSpeed;\nfloat fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);\nfloat specularMapValue = texture2D(specularMap, materialInput.st).r;\nvec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);\nvec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));\nnormalTangentSpace.xy /= fade;\nnormalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);\nnormalTangentSpace = normalize(normalTangentSpace);\nfloat tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);\nmaterial.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;\nmaterial.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);\nmaterial.diffuse += (0.1 * tsPerturbationRatio);\nmaterial.diffuse = material.diffuse;\nmaterial.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);\nmaterial.specular = specularIntensity;\nmaterial.shininess = 10.0;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.baseWaterColor.alpha<1||t.blendColor.alpha<1}}),_w.RimLightingType="RimLighting",_w._materialCache.addMaterial(_w.RimLightingType,{fabric:{type:_w.RimLightingType,uniforms:{color:new It(1,0,0,.7),rimColor:new It(1,1,1,.4),width:.3},source:"uniform vec4 color;\nuniform vec4 rimColor;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat d = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));\nfloat s = smoothstep(1.0 - width, 1.0, d);\nvec4 outColor = czm_gammaCorrect(color);\nvec4 outRimColor = czm_gammaCorrect(rimColor);\nmaterial.diffuse = outColor.rgb;\nmaterial.emission = outRimColor.rgb * s;\nmaterial.alpha = mix(outColor.a, outRimColor.a, s);\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.color.alpha<1||t.rimColor.alpha<1}}),_w.FadeType="Fade",_w._materialCache.addMaterial(_w.FadeType,{fabric:{type:_w.FadeType,uniforms:{fadeInColor:new It(1,0,0,1),fadeOutColor:new It(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new En(.5,.5)},source:"uniform vec4 fadeInColor;\nuniform vec4 fadeOutColor;\nuniform float maximumDistance;\nuniform bool repeat;\nuniform vec2 fadeDirection;\nuniform vec2 time;\nfloat getTime(float t, float coord)\n{\nfloat scalar = 1.0 / maximumDistance;\nfloat q  = distance(t, coord) * scalar;\nif (repeat)\n{\nfloat r = distance(t, coord + 1.0) * scalar;\nfloat s = distance(t, coord - 1.0) * scalar;\nq = min(min(r, s), q);\n}\nreturn clamp(q, 0.0, 1.0);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat s = getTime(time.x, st.s) * fadeDirection.s;\nfloat t = getTime(time.y, st.t) * fadeDirection.t;\nfloat u = length(vec2(s, t));\nvec4 color = mix(fadeInColor, fadeOutColor, u);\ncolor = czm_gammaCorrect(color);\nmaterial.emission = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.fadeInColor.alpha<1||t.fadeOutColor.alpha<1}}),_w.PolylineArrowType="PolylineArrow",_w._materialCache.addMaterial(_w.PolylineArrowType,{fabric:{type:_w.PolylineArrowType,uniforms:{color:new It(1,1,1,1)},source:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\nfloat slope = (p0.y - p1.y) / (p0.x - p1.x);\nreturn slope * (x - p0.x) + p0.y;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\n#ifdef GL_OES_standard_derivatives\nfloat base = 1.0 - abs(fwidth(st.s)) * 10.0 * czm_pixelRatio;\n#else\nfloat base = 0.975;\n#endif\nvec2 center = vec2(1.0, 0.5);\nfloat ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\nfloat ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\nfloat halfWidth = 0.15;\nfloat s = step(0.5 - halfWidth, st.t);\ns *= 1.0 - step(0.5 + halfWidth, st.t);\ns *= 1.0 - step(base, st.s);\nfloat t = step(base, materialInput.st.s);\nt *= 1.0 - step(ptOnUpperLine, st.t);\nt *= step(ptOnLowerLine, st.t);\nfloat dist;\nif (st.s < base)\n{\nfloat d1 = abs(st.t - (0.5 - halfWidth));\nfloat d2 = abs(st.t - (0.5 + halfWidth));\ndist = min(d1, d2);\n}\nelse\n{\nfloat d1 = czm_infinity;\nif (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\n{\nd1 = abs(st.s - base);\n}\nfloat d2 = abs(st.t - ptOnUpperLine);\nfloat d3 = abs(st.t - ptOnLowerLine);\ndist = min(min(d1, d2), d3);\n}\nvec4 outsideColor = vec4(0.0);\nvec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\nvec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);\noutColor = czm_gammaCorrect(outColor);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"},translucent:!0}),_w.PolylineDashType="PolylineDash",_w._materialCache.addMaterial(_w.PolylineDashType,{fabric:{type:_w.PolylineDashType,uniforms:{color:new It(1,0,1,1),gapColor:new It(0,0,0,0),dashLength:16,dashPattern:255},source:"uniform vec4 color;\nuniform vec4 gapColor;\nuniform float dashLength;\nuniform float dashPattern;\nvarying float v_polylineAngle;\nconst float maskLength = 16.0;\nmat2 rotate(float rad) {\nfloat c = cos(rad);\nfloat s = sin(rad);\nreturn mat2(\nc, s,\n-s, c\n);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\nfloat dashPosition = fract(pos.x / (dashLength * czm_pixelRatio));\nfloat maskIndex = floor(dashPosition * maskLength);\nfloat maskTest = floor(dashPattern / pow(2.0, maskIndex));\nvec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;\nif (fragColor.a < 0.005) {\ndiscard;\n}\nfragColor = czm_gammaCorrect(fragColor);\nmaterial.emission = fragColor.rgb;\nmaterial.alpha = fragColor.a;\nreturn material;\n}\n"},translucent:!0}),_w.PolylineGlowType="PolylineGlow",_w._materialCache.addMaterial(_w.PolylineGlowType,{fabric:{type:_w.PolylineGlowType,uniforms:{color:new It(0,.5,1,1),glowPower:.25,taperPower:1},source:"uniform vec4 color;\nuniform float glowPower;\nuniform float taperPower;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat glow = glowPower / abs(st.t - 0.5) - (glowPower / 0.5);\nif (taperPower <= 0.99999) {\nglow *= min(1.0, taperPower / (0.5 - st.s * 0.5) - (taperPower / 0.5));\n}\nvec4 fragColor;\nfragColor.rgb = max(vec3(glow - 1.0 + color.rgb), color.rgb);\nfragColor.a = clamp(0.0, 1.0, glow) * color.a;\nfragColor = czm_gammaCorrect(fragColor);\nmaterial.emission = fragColor.rgb;\nmaterial.alpha = fragColor.a;\nreturn material;\n}\n"},translucent:!0}),_w.PolylineOutlineType="PolylineOutline",_w._materialCache.addMaterial(_w.PolylineOutlineType,{fabric:{type:_w.PolylineOutlineType,uniforms:{color:new It(1,1,1,1),outlineColor:new It(1,0,0,1),outlineWidth:1},source:"uniform vec4 color;\nuniform vec4 outlineColor;\nuniform float outlineWidth;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;\nfloat b = step(0.5 - halfInteriorWidth, st.t);\nb *= 1.0 - step(0.5 + halfInteriorWidth, st.t);\nfloat d1 = abs(st.t - (0.5 - halfInteriorWidth));\nfloat d2 = abs(st.t - (0.5 + halfInteriorWidth));\nfloat dist = min(d1, d2);\nvec4 currentColor = mix(outlineColor, color, b);\nvec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);\noutColor = czm_gammaCorrect(outColor);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"},translucent:function(e){var t=e.uniforms;return t.color.alpha<1||t.outlineColor.alpha<1}}),_w.ElevationContourType="ElevationContour",_w._materialCache.addMaterial(_w.ElevationContourType,{fabric:{type:_w.ElevationContourType,uniforms:{spacing:100,color:new It(1,0,0,1),width:1},source:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float spacing;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat distanceToContour = mod(materialInput.height, spacing);\n#ifdef GL_OES_standard_derivatives\nfloat dxc = abs(dFdx(materialInput.height));\nfloat dyc = abs(dFdy(materialInput.height));\nfloat dF = max(dxc, dyc) * czm_pixelRatio * width;\nfloat alpha = (distanceToContour < dF) ? 1.0 : 0.0;\n#else\nfloat alpha = (distanceToContour < (czm_pixelRatio * width)) ? 1.0 : 0.0;\n#endif\nvec4 outColor = czm_gammaCorrect(vec4(color.rgb, alpha * color.a));\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"},translucent:!1}),_w.ElevationRampType="ElevationRamp",_w._materialCache.addMaterial(_w.ElevationRampType,{fabric:{type:_w.ElevationRampType,uniforms:{image:_w.DefaultImageId,minimumHeight:0,maximumHeight:1e4},source:"uniform sampler2D image;\nuniform float minimumHeight;\nuniform float maximumHeight;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat scaledHeight = clamp((materialInput.height - minimumHeight) / (maximumHeight - minimumHeight), 0.0, 1.0);\nvec4 rampColor = texture2D(image, vec2(scaledHeight, 0.5));\nrampColor = czm_gammaCorrect(rampColor);\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"},translucent:!1}),_w.SlopeRampMaterialType="SlopeRamp",_w._materialCache.addMaterial(_w.SlopeRampMaterialType,{fabric:{type:_w.SlopeRampMaterialType,uniforms:{image:_w.DefaultImageId},source:"uniform sampler2D image;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 rampColor = texture2D(image, vec2(materialInput.slope / (czm_pi / 2.0), 0.5));\nrampColor = czm_gammaCorrect(rampColor);\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"},translucent:!1}),_w.AspectRampMaterialType="AspectRamp",_w._materialCache.addMaterial(_w.AspectRampMaterialType,{fabric:{type:_w.AspectRampMaterialType,uniforms:{image:_w.DefaultImageId},source:"uniform sampler2D image;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 rampColor = texture2D(image, vec2(materialInput.aspect / (2.0 * czm_pi), 0.5));\nrampColor = czm_gammaCorrect(rampColor);\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"},translucent:!1}),_w.PolylineTrailLinkType="PolylineTrailLink",_w.PolylineTrailLinkImage=_w.DefaultImageId,_w.PolylineTrailLinkSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n                                                      {\n                                                           czm_material material = czm_getDefaultMaterial(materialInput);\n                                                           vec2 st = materialInput.st;\n                                                           vec4 colorImage = texture2D(image, vec2(st.s, fract(st.t+time)));\n                                                           material.alpha = colorImage.a * color.a;\n                                                           material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n                                                           return material;\n                                                       }",_w._materialCache.addMaterial(_w.PolylineTrailLinkType,{fabric:{type:_w.PolylineTrailLinkType,uniforms:{color:new It(1,0,0,.5),image:_w.PolylineTrailLinkImage,time:-15},source:_w.PolylineTrailLinkSource},translucent:function(e){return!0}});var Iw=pt.EPSILON10;function Pw(e,t,n){if(Ze(e)){n=Je(n,!1);var r,i,o,a=e.length;if(a<2)return e;for(r=1;r<a&&!t(i=e[r-1],o=e[r],Iw);++r);if(r===a)return n&&t(e[0],e[e.length-1],Iw)?e.slice(1):e;for(var s=e.slice(0,r);r<a;++r)t(i,o=e[r],Iw)||(s.push(o),i=o);return n&&1<s.length&&t(s[0],s[s.length-1],Iw)&&s.shift(),s}}function Ow(e,t,n,r,i,o,a){var s,u,l=(s=e)*(u=n)*(4+s*(4-3*u))/16;return(1-l)*e*t*(r+l*i*(a+l*o*(2*a*a-1)))}var Lw=new _t,Nw=new _t;function Rw(e,t,n,r){var i,o,a,s,u,l,c,h,f,p,d,m,_,g,y,v,x,b,E,T,S,C,w,A,I;_t.normalize(r.cartographicToCartesian(t,Nw),Lw),_t.normalize(r.cartographicToCartesian(n,Nw),Nw);!function(e,t,n,r,i,o,a){var s=(t-n)/t,u=o-r,l=Math.atan((1-s)*Math.tan(i)),c=Math.atan((1-s)*Math.tan(a)),h=Math.cos(l),f=Math.sin(l),p=Math.cos(c),d=Math.sin(c),m=h*p,_=h*d,g=f*d,y=f*p,v=u,x=pt.TWO_PI,b=Math.cos(v),E=Math.sin(v);do{b=Math.cos(v),E=Math.sin(v);var T,S,C=_-y*b,w=Math.sqrt(p*p*E*E+C*C),A=g+m*b,I=Math.atan2(w,A),x=v,P=A-2*g/(S=0===w?(T=0,1):1-(T=m*E/w)*T);isNaN(P)&&(P=0),v=u+Ow(s,T,S,I,w,A,P)}while(Math.abs(v-x)>pt.EPSILON12);var O=S*(t*t-n*n)/(n*n),L=O*(256+O*(O*(74-47*O)-128))/1024,N=P*P,R=n*(1+O*(4096+O*(O*(320-175*O)-768))/16384)*(I-L*w*(P+L*(A*(2*N-1)-L*P*(4*w*w-3)*(4*N-3)/6)/4)),D=Math.atan2(p*E,_-y*b),M=Math.atan2(h*E,_*b-y);e._distance=R,e._startHeading=D,e._endHeading=M,e._uSquared=O}(e,r.maximumRadius,r.minimumRadius,t.longitude,t.latitude,n.longitude,n.latitude),e._start=Un.clone(t,e._start),e._end=Un.clone(n,e._end),e._start.height=0,e._end.height=0,o=(i=e)._uSquared,a=i._ellipsoid.maximumRadius,s=i._ellipsoid.minimumRadius,u=(a-s)/a,l=Math.cos(i._startHeading),c=Math.sin(i._startHeading),h=(1-u)*Math.tan(i._start.latitude),f=1/Math.sqrt(1+h*h),p=f*h,d=Math.atan2(h,l),g=1-(_=(m=f*c)*m),y=Math.sqrt(g),C=1-3*(v=o/4)+35*(x=v*v)/4,w=1-5*v,A=(T=1+v-3*x/4+5*(b=x*v)/4-175*(E=x*x)/64)*d-(S=1-v+15*x/8-35*b/8)*Math.sin(2*d)*v/2-C*Math.sin(4*d)*x/16-w*Math.sin(6*d)*b/48-5*Math.sin(8*d)*E/512,(I=i._constants).a=a,I.b=s,I.f=u,I.cosineHeading=l,I.sineHeading=c,I.tanU=h,I.cosineU=f,I.sineU=p,I.sigma=d,I.sineAlpha=m,I.sineSquaredAlpha=_,I.cosineSquaredAlpha=g,I.cosineAlpha=y,I.u2Over4=v,I.u4Over16=x,I.u6Over64=b,I.u8Over256=E,I.a0=T,I.a1=S,I.a2=C,I.a3=w,I.distanceRatio=A}function Dw(e,t,n){var r=Je(n,Wn.WGS84);this._ellipsoid=r,this._start=new Un,this._end=new Un,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0,Ze(e)&&Ze(t)&&Rw(this,e,t,r)}function Mw(e,t,n){if(0===e)return t*n;var r=e*e,i=r*r,o=i*r,a=o*r,s=a*r,u=s*r,l=n;return t*((1-r/4-3*i/64-5*o/256-175*a/16384-441*s/65536-4851*u/1048576)*l-(3*r/8+3*i/32+45*o/1024+105*a/4096+2205*s/131072+6237*u/524288)*Math.sin(2*l)+(15*i/256+45*o/1024+525*a/16384+1575*s/65536+155925*u/8388608)*Math.sin(4*l)-(35*o/3072+175*a/12288+3675*s/262144+13475*u/1048576)*Math.sin(6*l)+(315*a/131072+2205*s/524288+43659*u/8388608)*Math.sin(8*l)-(693*s/1310720+6237*u/5242880)*Math.sin(10*l)+1001*u/8388608*Math.sin(12*l))}function Fw(e,t){if(0===e)return Math.log(Math.tan(.5*(pt.PI_OVER_TWO+t)));var n=e*Math.sin(t);return Math.log(Math.tan(.5*(pt.PI_OVER_TWO+t)))-e/2*Math.log((1+n)/(1-n))}Object.defineProperties(Dw.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){return this._startHeading}},endHeading:{get:function(){return this._endHeading}}}),Dw.prototype.setEndPoints=function(e,t){Rw(this,e,t,this._ellipsoid)},Dw.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)},Dw.prototype.interpolateUsingSurfaceDistance=function(e,t){var n=this._constants,r=n.distanceRatio+e/n.b,i=Math.cos(2*r),o=Math.cos(4*r),a=Math.cos(6*r),s=Math.sin(2*r),u=Math.sin(4*r),l=Math.sin(6*r),c=Math.sin(8*r),h=r*r,f=r*h,p=n.u8Over256,d=n.u2Over4,m=n.u6Over64,_=n.u4Over16,g=2*f*p*i/3+r*(1-d+7*_/4-15*m/4+579*p/64-(_-15*m/4+187*p/16)*i-(5*m/4-115*p/16)*o-29*p*a/16)+(d/2-_+71*m/32-85*p/16)*s+(5*_/16-5*m/4+383*p/96)*u-h*((m-11*p/2)*s+5*p*u/2)+(29*m/96-29*p/16)*l+539*p*c/1536,y=Math.asin(Math.sin(g)*n.cosineAlpha),v=Math.atan(n.a/n.b*Math.tan(y));g-=n.sigma;var x=Math.cos(2*n.sigma+g),b=Math.sin(g),E=Math.cos(g),T=n.cosineU*E,S=n.sineU*b,C=Math.atan2(b*n.sineHeading,T-S*n.cosineHeading)-Ow(n.f,n.sineAlpha,n.cosineSquaredAlpha,g,b,E,x);return Ze(t)?(t.longitude=this._start.longitude+C,t.latitude=v,t.height=0,t):new Un(this._start.longitude+C,v,0)};var zw=new _t,Bw=new _t;function Uw(e,t,n,r){_t.normalize(r.cartographicToCartesian(t,Bw),zw),_t.normalize(r.cartographicToCartesian(n,Bw),Bw);var i,o,a,s,u,l,c,h,f,p,d,m,_,g,y,v,x,b,E,T=r.maximumRadius,S=r.minimumRadius,C=T*T,w=S*S;e._ellipticitySquared=(C-w)/C,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=Un.clone(t,e._start),e._start.height=0,e._end=Un.clone(n,e._end),e._end.height=0,e._heading=(i=e,o=t.longitude,a=t.latitude,s=n.longitude,u=n.latitude,l=Fw(i._ellipticity,a),c=Fw(i._ellipticity,u),Math.atan2(pt.negativePiToPi(s-o),c-l)),e._distance=(h=e,f=r.maximumRadius,p=r.minimumRadius,d=t.longitude,m=t.latitude,_=n.longitude,g=n.latitude,x=h._heading,b=_-d,E=0,E=pt.equalsEpsilon(Math.abs(x),pt.PI_OVER_TWO,pt.EPSILON8)?f===p?f*Math.cos(m)*pt.negativePiToPi(b):(y=Math.sin(m),f*Math.cos(m)*pt.negativePiToPi(b)/Math.sqrt(1-h._ellipticitySquared*y*y)):(v=Mw(h._ellipticity,f,m),(Mw(h._ellipticity,f,g)-v)/Math.cos(x)),Math.abs(E))}function Vw(e,t,n,r,i,o){var a,s,u,l,c,h,f=i*i;return c=Math.abs(pt.PI_OVER_TWO-Math.abs(t))>pt.EPSILON8?(a=function(e,t,n){var r=e/n;if(0===t)return r;var i=r*r,o=i*r,a=o*r,s=t*t,u=s*s,l=u*s,c=l*s,h=c*s,f=h*s,p=Math.sin(2*r),d=Math.cos(2*r),m=Math.sin(4*r),_=Math.cos(4*r),g=Math.sin(6*r),y=Math.cos(6*r),v=Math.sin(8*r),x=Math.cos(8*r),b=Math.sin(10*r);return r+r*s/4+7*r*u/64+15*r*l/256+579*r*c/16384+1515*r*h/65536+16837*r*f/1048576+(3*r*u/16+45*r*l/256-r*(32*i-561)*c/4096-r*(232*i-1677)*h/16384+r*(399985-90560*i+512*a)*f/5242880)*d+(21*r*l/256+483*r*c/4096-r*(224*i-1969)*h/16384-r*(33152*i-112599)*f/1048576)*_+(151*r*c/4096+4681*r*h/65536+1479*r*f/16384-453*o*f/32768)*y+(1097*r*h/65536+42783*r*f/1048576)*x+8011*r*f/1048576*Math.cos(10*r)+(3*s/8+3*u/16+213*l/2048-3*i*l/64+255*c/4096-33*i*c/512+20861*h/524288-33*i*h/512+a*h/1024+28273*f/1048576-471*i*f/8192+9*a*f/4096)*p+(21*u/256+21*l/256+533*c/8192-21*i*c/512+197*h/4096-315*i*h/4096+584039*f/16777216-12517*i*f/131072+7*a*f/2048)*m+(151*l/6144+151*c/4096+5019*h/131072-453*i*h/16384+26965*f/786432-8607*i*f/131072)*g+(1097*c/131072+1097*h/65536+225797*f/10485760-1097*i*f/65536)*v+(8011*h/2621440+8011*f/1048576)*b+293393*f/251658240*Math.sin(12*r)}(Mw(i,r,e.latitude)+n*Math.cos(t),i,r),s=Fw(i,e.latitude),u=Fw(i,a),l=Math.tan(t)*(u-s),pt.negativePiToPi(e.longitude+l)):(a=e.latitude,l=n/(0===i?r*Math.cos(e.latitude):(h=Math.sin(e.latitude),r*Math.cos(e.latitude)/Math.sqrt(1-f*h*h))),0<t?pt.negativePiToPi(e.longitude+l):pt.negativePiToPi(e.longitude-l)),Ze(o)?(o.longitude=c,o.latitude=a,o.height=0,o):new Un(c,a,0)}function kw(e,t,n){var r=Je(n,Wn.WGS84);this._ellipsoid=r,this._start=new Un,this._end=new Un,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,Ze(e)&&Ze(t)&&Uw(this,e,t,r)}Object.defineProperties(kw.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){return this._heading}}}),kw.fromStartHeadingDistance=function(e,t,n,r,i){var o=Je(r,Wn.WGS84),a=o.maximumRadius,s=o.minimumRadius,u=a*a,l=s*s,c=Math.sqrt((u-l)/u),h=Vw(e,t=pt.negativePiToPi(t),n,o.maximumRadius,c);return!Ze(i)||Ze(r)&&!r.equals(i.ellipsoid)?new kw(e,h,o):(i.setEndPoints(e,h),i)},kw.prototype.setEndPoints=function(e,t){Uw(this,e,t,this._ellipsoid)},kw.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)},kw.prototype.interpolateUsingSurfaceDistance=function(e,t){return Vw(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)},kw.prototype.findIntersectionWithLongitude=function(e,t){var n=this._ellipticity,r=this._heading,i=Math.abs(r),o=this._start;if(e=pt.negativePiToPi(e),pt.equalsEpsilon(Math.abs(e),Math.PI,pt.EPSILON14)&&(e=pt.sign(o.longitude)*Math.PI),Ze(t)||(t=new Un),Math.abs(pt.PI_OVER_TWO-i)<=pt.EPSILON8)return t.longitude=e,t.latitude=o.latitude,t.height=0,t;if(pt.equalsEpsilon(Math.abs(pt.PI_OVER_TWO-i),pt.PI_OVER_TWO,pt.EPSILON8)){if(pt.equalsEpsilon(e,o.longitude,pt.EPSILON12))return;return t.longitude=e,t.latitude=pt.PI_OVER_TWO*pt.sign(pt.PI_OVER_TWO-r),t.height=0,t}var a,s=o.latitude,u=n*Math.sin(s),l=Math.tan(.5*(pt.PI_OVER_TWO+s))*Math.exp((e-o.longitude)/Math.tan(r)),c=(1+u)/(1-u),h=o.latitude;do{a=h;var f=n*Math.sin(a),p=(1+f)/(1-f),h=2*Math.atan(l*Math.pow(p/c,n/2))-pt.PI_OVER_TWO}while(!pt.equalsEpsilon(h,a,pt.EPSILON12));return t.longitude=e,t.latitude=h,t.height=0,t},kw.prototype.findIntersectionWithLatitude=function(e,t){var n=this._ellipticity,r=this._heading,i=this._start;if(!pt.equalsEpsilon(Math.abs(r),pt.PI_OVER_TWO,pt.EPSILON8)){var o=Fw(n,i.latitude),a=Fw(n,e),s=Math.tan(r)*(a-o),u=pt.negativePiToPi(i.longitude+s);return Ze(t)?(t.longitude=u,t.latitude=e,t.height=0,t):new Un(u,e,0)}};var Gw={numberOfPoints:function(e,t,n){var r=_t.distance(e,t);return Math.ceil(r/n)},numberOfPointsRhumbLine:function(e,t,n){var r=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.ceil(Math.sqrt(r/(n*n)))}},qw=new Un;Gw.extractHeights=function(e,t){for(var n=e.length,r=new Array(n),i=0;i<n;i++){var o=e[i];r[i]=t.cartesianToCartographic(o,qw).height}return r};var Hw=new on,Ww=new _t,Yw=new _t,Xw=new Zf(_t.UNIT_X,0),jw=new _t,Kw=new Zf(_t.UNIT_X,0),Qw=new _t,Zw=new _t,Jw=[];function $w(e,t,n){var r=Jw;if(r.length=e,t===n){for(o=0;o<e;o++)r[o]=t;return r}for(var i=(n-t)/e,o=0;o<e;o++){var a=t+o*i;r[o]=a}return r}var eA=new Un,tA=new Un,nA=new _t,rA=new _t,iA=new _t,oA=new Dw,aA=new kw;function sA(e,t,n,r,i,o,a,s){var u=r.scaleToGeodeticSurface(e,rA),l=r.scaleToGeodeticSurface(t,iA),c=Gw.numberOfPoints(e,t,n),h=r.cartesianToCartographic(u,eA),f=r.cartesianToCartographic(l,tA),p=$w(c,i,o);oA.setEndPoints(h,f);var d=oA.surfaceDistance/c,m=s;h.height=i;var _=r.cartographicToCartesian(h,nA);_t.pack(_,a,m),m+=3;for(var g=1;g<c;g++){var y=oA.interpolateUsingSurfaceDistance(g*d,tA);y.height=p[g],_=r.cartographicToCartesian(y,nA),_t.pack(_,a,m),m+=3}return m}function uA(e,t,n,r,i,o,a,s){var u=r.scaleToGeodeticSurface(e,rA),l=r.scaleToGeodeticSurface(t,iA),c=r.cartesianToCartographic(u,eA),h=r.cartesianToCartographic(l,tA),f=Gw.numberOfPointsRhumbLine(c,h,n),p=$w(f,i,o);aA.ellipsoid.equals(r)||(aA=new kw(void 0,void 0,r)),aA.setEndPoints(c,h);var d=aA.surfaceDistance/f,m=s;c.height=i;var _=r.cartographicToCartesian(c,nA);_t.pack(_,a,m),m+=3;for(var g=1;g<f;g++){var y=aA.interpolateUsingSurfaceDistance(g*d,tA);y.height=p[g],_=r.cartographicToCartesian(y,nA),_t.pack(_,a,m),m+=3}return m}Gw.wrapLongitude=function(e,t){var n=[],r=[];if(Ze(e)&&0<e.length){t=Je(t,on.IDENTITY);var i=on.inverseTransformation(t,Hw),o=on.multiplyByPoint(i,_t.ZERO,Ww),a=_t.normalize(on.multiplyByPointAsVector(i,_t.UNIT_Y,Yw),Yw),s=Zf.fromPointNormal(o,a,Xw),u=_t.normalize(on.multiplyByPointAsVector(i,_t.UNIT_X,jw),jw),l=Zf.fromPointNormal(o,u,Kw),c=1;n.push(_t.clone(e[0]));for(var h=n[0],f=e.length,p=1;p<f;++p){var d,m,_=e[p];!(Zf.getPointDistance(l,h)<0||Zf.getPointDistance(l,_)<0)||Ze(d=vm.lineSegmentPlane(h,_,s,Qw))&&(m=_t.multiplyByScalar(a,5e-9,Zw),Zf.getPointDistance(s,h)<0&&_t.negate(m,m),n.push(_t.add(d,m,new _t)),r.push(c+1),_t.negate(m,m),n.push(_t.add(d,m,new _t)),c=1),n.push(_t.clone(e[p])),c++,h=_}r.push(c)}return{positions:n,lengths:r}},Gw.generateArc=function(e){Ze(e)||(e={});var t=e.positions,n=t.length,r=Je(e.ellipsoid,Wn.WGS84),i=Je(e.height,0),o=Array.isArray(i),a=Je(e.ignoreEndPosition,!1);if(n<1)return[];if(1===n){var s,u=r.scaleToGeodeticSurface(t[0],rA);return 0!==(i=o?i[0]:i)&&(s=r.geodeticSurfaceNormal(u,nA),_t.multiplyByScalar(s,i,s),_t.add(u,s,u)),[u.x,u.y,u.z]}var l,c=e.minDistance;Ze(c)||(l=Je(e.granularity,pt.RADIANS_PER_DEGREE),c=pt.chordLength(l,r.maximumRadius));for(var h,f=0,p=0;p<n-1;p++)f+=Gw.numberOfPoints(t[p],t[p+1],c);h=a?3*f:3*(f+1);var d,m,_,g=new Array(h),y=0;for(p=0;p<n-1;p++)y=sA(t[p],t[p+1],c,r,o?i[p]:i,o?i[p+1]:i,g,y);return Jw.length=0,a||(d=t[n-1],(m=r.cartesianToCartographic(d,eA)).height=o?i[n-1]:i,_=r.cartographicToCartesian(m,nA),_t.pack(_,g,h-3)),g};var lA=new Un,cA=new Un;function hA(e,t){e=Je(e,Je.EMPTY_OBJECT),this._show=Je(e.show,!0),this._width=Je(e.width,1),this._loop=Je(e.loop,!1),this._distanceDisplayCondition=e.distanceDisplayCondition,this._material=e.material,Ze(this._material)||(this._material=_w.fromType(_w.ColorType,{color:new It(1,1,1,1)}));var n,r=e.positions;Ze(r)||(r=[]),this._positions=r,this._actualPositions=Pw(r,_t.equalsEpsilon),this._loop&&2<this._actualPositions.length&&(this._actualPositions===this._positions&&(this._actualPositions=r.slice()),this._actualPositions.push(_t.clone(this._actualPositions[0]))),this._length=this._actualPositions.length,this._id=e.id,Ze(t)&&(n=on.clone(t.modelMatrix)),this._modelMatrix=n,this._segments=Gw.wrapLongitude(this._actualPositions,n),this._actualLength=void 0,this._propertiesChanged=new Uint32Array(yA),this._polylineCollection=t,this._dirty=!1,this._pickId=void 0,this._boundingVolume=ko.fromPoints(this._actualPositions),this._boundingVolumeWC=ko.transform(this._boundingVolume,this._modelMatrix),this._boundingVolume2D=new ko}Gw.generateRhumbArc=function(e){Ze(e)||(e={});var t=e.positions,n=t.length,r=Je(e.ellipsoid,Wn.WGS84),i=Je(e.height,0),o=Array.isArray(i);if(n<1)return[];if(1===n){var a,s=r.scaleToGeodeticSurface(t[0],rA);return 0!==(i=o?i[0]:i)&&(a=r.geodeticSurfaceNormal(s,nA),_t.multiplyByScalar(a,i,a),_t.add(s,a,s)),[s.x,s.y,s.z]}for(var u,l=Je(e.granularity,pt.RADIANS_PER_DEGREE),c=0,h=r.cartesianToCartographic(t[0],lA),f=0;f<n-1;f++)u=r.cartesianToCartographic(t[f+1],cA),c+=Gw.numberOfPointsRhumbLine(h,u,l),h=Un.clone(u,lA);var p=3*(c+1),d=new Array(p),m=0;for(f=0;f<n-1;f++)m=uA(t[f],t[f+1],l,r,o?i[f]:i,o?i[f+1]:i,d,m);Jw.length=0;var _=t[n-1],g=r.cartesianToCartographic(_,eA);g.height=o?i[n-1]:i;var y=r.cartographicToCartesian(g,nA);return _t.pack(y,d,p-3),d},Gw.generateCartesianArc=function(e){for(var t=Gw.generateArc(e),n=t.length/3,r=new Array(n),i=0;i<n;i++)r[i]=_t.unpack(t,3*i);return r},Gw.generateCartesianRhumbArc=function(e){for(var t=Gw.generateRhumbArc(e),n=t.length/3,r=new Array(n),i=0;i<n;i++)r[i]=_t.unpack(t,3*i);return r};var fA=hA.POSITION_INDEX=0,pA=hA.SHOW_INDEX=1,dA=hA.WIDTH_INDEX=2,mA=hA.MATERIAL_INDEX=3,_A=hA.POSITION_SIZE_INDEX=4,gA=hA.DISTANCE_DISPLAY_CONDITION=5,yA=hA.NUMBER_OF_PROPERTIES=6;function vA(e,t){++e._propertiesChanged[t];var n=e._polylineCollection;Ze(n)&&(n._updatePolyline(e,t),e._dirty=!0)}Object.defineProperties(hA.prototype,{show:{get:function(){return this._show},set:function(e){e!==this._show&&(this._show=e,vA(this,pA))}},positions:{get:function(){return this._positions},set:function(e){var t=Pw(e,_t.equalsEpsilon);this._loop&&2<t.length&&(t===e&&(t=e.slice()),t.push(_t.clone(t[0]))),this._actualPositions.length===t.length&&this._actualPositions.length===this._length||vA(this,_A),this._positions=e,this._actualPositions=t,this._length=t.length,this._boundingVolume=ko.fromPoints(this._actualPositions,this._boundingVolume),this._boundingVolumeWC=ko.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC),vA(this,fA),this.update()}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,vA(this,mA))}},width:{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,vA(this,dA))}},loop:{get:function(){return this._loop},set:function(e){var t;e!==this._loop&&(t=this._actualPositions,e?2<t.length&&!_t.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(_t.clone(t[0]))):2<t.length&&_t.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop()),this._loop=e,vA(this,_A))}},id:{get:function(){return this._id},set:function(e){this._id=e,Ze(this._pickId)&&(this._pickId.object.id=e)}},pickId:{get:function(){return this._pickId}},isDestroyed:{get:function(){return!Ze(this._polylineCollection)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){wf.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=wf.clone(e,this._distanceDisplayCondition),vA(this,gA))}}}),hA.prototype.update=function(){var e=on.IDENTITY;Ze(this._polylineCollection)&&(e=this._polylineCollection.modelMatrix);var t=this._segments.positions.length,n=this._segments.lengths,r=0<this._propertiesChanged[fA]||0<this._propertiesChanged[_A];if(on.equals(e,this._modelMatrix)&&!r||(this._segments=Gw.wrapLongitude(this._actualPositions,e),this._boundingVolumeWC=ko.transform(this._boundingVolume,e,this._boundingVolumeWC)),this._modelMatrix=on.clone(e,this._modelMatrix),this._segments.positions.length!==t)vA(this,_A);else for(var i=n.length,o=0;o<i;++o)if(n[o]!==this._segments.lengths[o]){vA(this,_A);break}},hA.prototype.getPickId=function(e){return Ze(this._pickId)||(this._pickId=e.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId},hA.prototype._clean=function(){this._dirty=!1;for(var e=this._propertiesChanged,t=0;t<yA-1;++t)e[t]=0},hA.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy(),this._material=this._material&&this._material.destroy(),this._polylineCollection=void 0};var xA=hA.SHOW_INDEX,bA=hA.WIDTH_INDEX,EA=hA.POSITION_INDEX,TA=hA.MATERIAL_INDEX,SA=hA.POSITION_SIZE_INDEX,CA=hA.DISTANCE_DISPLAY_CONDITION,wA=hA.NUMBER_OF_PROPERTIES,AA={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};function IA(e){e=Je(e,Je.EMPTY_OBJECT),this.modelMatrix=on.clone(Je(e.modelMatrix,on.IDENTITY)),this._modelMatrix=on.clone(on.IDENTITY),this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this._opaqueRS=void 0,this._translucentRS=void 0,this._colorCommands=[],this._polylinesUpdated=!1,this._polylinesRemoved=!1,this._createVertexArray=!1,this._propertiesChanged=new Uint32Array(wA),this._polylines=[],this._polylineBuckets={},this._positionBufferUsage={bufferUsage:wl.STATIC_DRAW,frameCount:0},this._mode=void 0,this._polylinesToUpdate=[],this._vertexArrays=[],this._positionBuffer=void 0,this._texCoordExpandAndBatchIndexBuffer=void 0,this._batchTable=void 0,this._createBatchTable=!1,this._useHighlightColor=!1,this._highlightColor=It.clone(It.WHITE);var t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}Object.defineProperties(IA.prototype,{length:{get:function(){return UA(this),this._polylines.length}}}),IA.prototype.add=function(e){var t=new hA(e,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t},IA.prototype.remove=function(e){var t;return!!this.contains(e)&&(this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,Ze(e._bucket)&&((t=e._bucket).shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()),e._destroy(),!0)},IA.prototype.removeAll=function(){VA(this),GA(this),this._polylineBuckets={},this._polylinesRemoved=!1,this._polylines.length=0,this._polylinesToUpdate.length=0,this._createVertexArray=!0},IA.prototype.contains=function(e){return Ze(e)&&e._polylineCollection===this},IA.prototype.get=function(e){return UA(this),this._polylines[e]};var PA=new $d,OA=new qt,LA=new En;IA.prototype.update=function(e){if(UA(this),0!==this._polylines.length){var t,n;t=this,n=e.mode,t._mode===n&&on.equals(t._modelMatrix,t.modelMatrix)||(t._mode=n,t._modelMatrix=on.clone(t.modelMatrix),t._createVertexArray=!0);var r,i=e.context,o=e.mapProjection,a=this._propertiesChanged;if(this._createBatchTable){if(0===Nn.maximumVertexTextureImageUnits)throw new de("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");!function(e,t){Ze(e._batchTable)&&e._batchTable.destroy();var n=[{functionName:"batchTable_getWidthAndShow",componentDatatype:Mt.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:Mt.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:Mt.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:Mt.FLOAT,componentsPerAttribute:2}];e._batchTable=new nm(t,n,e._polylines.length)}(this,i),this._createBatchTable=!1}if(this._createVertexArray||function(e){var t=!1,n=e._propertiesChanged,r=e._positionBufferUsage;n[EA]?(r.bufferUsage!==wl.STREAM_DRAW&&(t=!0,r.bufferUsage=wl.STREAM_DRAW),r.frameCount=100):r.bufferUsage!==wl.STATIC_DRAW&&(0===r.frameCount?(t=!0,r.bufferUsage=wl.STATIC_DRAW):r.frameCount--);return t}(this))MA(this,i,o);else if(this._polylinesUpdated){var s=this._polylinesToUpdate;if(this._mode!==Tl.SCENE3D)for(var u=s.length,l=0;l<u;++l)(r=s[l]).update();if(a[SA]||a[TA])MA(this,i,o);else for(var c=s.length,h=this._polylineBuckets,f=0;f<c;++f){a=(r=s[f])._propertiesChanged;var p,d,m,_,g,y=r._bucket,v=0;for(var x in h)if(h.hasOwnProperty(x)){if(h[x]===y){a[EA]&&y.writeUpdate(v,r,this._positionBuffer,o);break}v+=h[x].lengthOfPositions}(a[xA]||a[bA])&&this._batchTable.setBatchedAttribute(r._index,0,new En(r._width,r._show)),2<this._batchTable.attributes.length&&((a[EA]||a[SA])&&(p=e.mode===Tl.SCENE2D?r._boundingVolume2D:r._boundingVolumeWC,d=$d.fromCartesian(p.center,PA),m=qt.fromElements(d.low.x,d.low.y,d.low.z,p.radius,OA),this._batchTable.setBatchedAttribute(r._index,2,d.high),this._batchTable.setBatchedAttribute(r._index,3,m)),a[CA]&&((_=LA).x=0,_.y=Number.MAX_VALUE,Ze(g=r.distanceDisplayCondition)&&(_.x=g.near,_.y=g.far),this._batchTable.setBatchedAttribute(r._index,4,_))),r._clean()}s.length=0,this._polylinesUpdated=!1}a=this._propertiesChanged;for(var b=0;b<wA;++b)a[b]=0;var E=on.IDENTITY;e.mode===Tl.SCENE3D&&(E=this.modelMatrix);var T=e.passes,S=0!==e.morphTime;Ze(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===S||(this._opaqueRS=sr.fromCache({depthMask:S,depthTest:{enabled:S}})),Ze(this._translucentRS)&&this._translucentRS.depthTest.enabled===S||(this._translucentRS=sr.fromCache({blending:ui.ALPHA_BLEND,depthMask:!S,depthTest:{enabled:S}})),this._batchTable.update(e),(T.render||T.pick)&&function(e,t,n,r){for(var i,o,a,s,u,l=t.context,c=t.commandList,h=n.length,f=0,p=!0,d=e._vertexArrays,m=e.debugShowBoundingVolume,_=e._batchTable.getUniformMapCallback(),g=d.length,y=0;y<g;++y)for(var v=d[y],x=v.buckets,b=x.length,E=0;E<b;++E){for(var T=x[E],S=T.offset,C=T.bucket.shaderProgram,w=T.bucket.polylines,A=w.length,I=0,P=0;P<A;++P){var O,L=w[P],N=BA(L._material);N!==i&&(Ze(i)&&0<I&&(O=o.isTranslucent(),h<=f?(a=new Mn({owner:e}),n.push(a)):a=n[f],++f,s=ne(_(o._uniforms),e._uniformMap),a.boundingVolume=ko.clone(NA,a.boundingVolume),a.modelMatrix=r,a.shaderProgram=C,a.vertexArray=v.va,a.renderState=O?e._translucentRS:e._opaqueRS,a.pass=O?yn.TRANSLUCENT:yn.OPAQUE,a.debugShowBoundingVolume=m,a.pickId="v_pickColor",a.uniformMap=s,a.count=I,a.offset=S,S+=I,p=!(I=0),c.push(a)),(o=L._material).update(l),i=N);for(var R=L._locatorBuckets,D=R.length,M=0;M<D;++M){var F=R[M];F.locator===T&&(I+=F.count)}t.mode===Tl.SCENE3D?u=L._boundingVolumeWC:t.mode===Tl.COLUMBUS_VIEW?u=L._boundingVolume2D:t.mode===Tl.SCENE2D?Ze(L._boundingVolume2D)&&((u=ko.clone(L._boundingVolume2D,RA)).center.x=0):Ze(L._boundingVolumeWC)&&Ze(L._boundingVolume2D)&&(u=ko.union(L._boundingVolumeWC,L._boundingVolume2D,RA)),p?(p=!1,ko.clone(u,NA)):ko.union(u,NA,NA)}Ze(i)&&0<I&&(h<=f?(a=new Mn({owner:e}),n.push(a)):a=n[f],++f,s=ne(_(o._uniforms),e._uniformMap),a.boundingVolume=ko.clone(NA,a.boundingVolume),a.modelMatrix=r,a.shaderProgram=C,a.vertexArray=v.va,a.renderState=o.isTranslucent()?e._translucentRS:e._opaqueRS,a.pass=o.isTranslucent()?yn.TRANSLUCENT:yn.OPAQUE,a.debugShowBoundingVolume=m,a.pickId="v_pickColor",a.uniformMap=s,a.count=I,a.offset=S,p=!0,c.push(a)),i=void 0}n.length=f}(this,e,this._colorCommands,E)}};var NA=new ko,RA=new ko;IA.prototype.isDestroyed=function(){return!1},IA.prototype.destroy=function(){return kA(this),VA(this),GA(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)};var DA=[0,0,0];function MA(e,t,n){e._createVertexArray=!1,VA(e),kA(e),function(e){for(var t=e._mode,n=e._modelMatrix,r=e._polylineBuckets={},i=e._polylines,o=i.length,a=0;a<o;++a){var s,u,l=i[a];1<l._actualPositions.length&&(l.update(),s=l.material,Ze(u=r[s.type])||(u=r[s.type]=new HA(s,t,n)),u.addPolyline(l))}}(e);var r,i,o=[[]],a=o[0],s=e._batchTable,u=e._useHighlightColor,l=[0],c=0,h=[[]],f=0,p=e._polylineBuckets;for(r in p)p.hasOwnProperty(r)&&((i=p[r]).updateShader(t,s,u),f+=i.lengthOfPositions);if(0<f){var d,m,_=e._mode,g=new Float32Array(6*f*3),y=new Float32Array(4*f),v=0,x=0,b=0;for(r in p){p.hasOwnProperty(r)&&((i=p[r]).write(g,y,v,x,b,s,t,n),_===Tl.MORPHING&&(Ze(d)||(d=new Float32Array(6*f*3)),i.writeForMorph(d,v)),v+=6*(m=i.lengthOfPositions)*3,x+=4*m,b+=4*m,c=i.updateIndices(o,l,h,c))}var E,T=e._positionBufferUsage.bufferUsage,S=wl.STATIC_DRAW;e._positionBuffer=Al.createVertexBuffer({context:t,typedArray:g,usage:T}),Ze(d)&&(E=Al.createVertexBuffer({context:t,typedArray:d,usage:T})),e._texCoordExpandAndBatchIndexBuffer=Al.createVertexBuffer({context:t,typedArray:y,usage:S});for(var C,w,A,I,P,O,L,N,R,D,M,F,z,B,U,V=3*Float32Array.BYTES_PER_ELEMENT,k=4*Float32Array.BYTES_PER_ELEMENT,G=0,q=o.length,H=0;H<q;++H){0<(a=o[H]).length&&(C=new Uint16Array(a),w=Al.createIndexBuffer({context:t,typedArray:C,usage:wl.STATIC_DRAW,indexDatatype:wa.UNSIGNED_SHORT}),G+=l[H],N=V+(L=V+(O=V+(P=V+(I=V+(A=6*(H*(V*pt.SIXTY_FOUR_KILOBYTES)-G*V)))))),R=H*(k*pt.SIXTY_FOUR_KILOBYTES)-G*k,D=[{index:AA.position3DHigh,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:A,strideInBytes:6*V},{index:AA.position3DLow,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:I,strideInBytes:6*V},{index:AA.position2DHigh,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:A,strideInBytes:6*V},{index:AA.position2DLow,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:I,strideInBytes:6*V},{index:AA.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:P,strideInBytes:6*V},{index:AA.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:O,strideInBytes:6*V},{index:AA.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:P,strideInBytes:6*V},{index:AA.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:O,strideInBytes:6*V},{index:AA.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:L,strideInBytes:6*V},{index:AA.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:N,strideInBytes:6*V},{index:AA.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:L,strideInBytes:6*V},{index:AA.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:Mt.FLOAT,offsetInBytes:N,strideInBytes:6*V},{index:AA.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:Mt.FLOAT,vertexBuffer:e._texCoordExpandAndBatchIndexBuffer,offsetInBytes:R}],B=_===Tl.SCENE3D?(M=e._positionBuffer,F="vertexBuffer",z=DA,"value"):(z=(F=_===Tl.SCENE2D||_===Tl.COLUMBUS_VIEW?(M=DA,"value"):(M=E,"vertexBuffer"),e._positionBuffer),"vertexBuffer"),D[0][F]=M,D[1][F]=M,D[2][B]=z,D[3][B]=z,D[4][F]=M,D[5][F]=M,D[6][B]=z,D[7][B]=z,D[8][F]=M,D[9][F]=M,D[10][B]=z,D[11][B]=z,U=new Ac({context:t,attributes:D,indexBuffer:w}),e._vertexArrays.push({va:U,buckets:h[H]}))}}}function FA(e,t){return t instanceof ti?t.id:t}var zA=[];function BA(e){var t=_w._uniformList[e.type],n=t.length;zA.length=2*n;for(var r=0,i=0;i<n;++i){var o=t[i];zA[r]=o,zA[r+1]=e._uniforms[o](),r+=2}return e.type+":"+JSON.stringify(zA,FA)}function UA(e){if(e._polylinesRemoved){e._polylinesRemoved=!1;for(var t,n=[],r=[],i=0,o=e._polylines.length,a=0;a<o;++a)(t=e._polylines[a]).isDestroyed||(t._index=i++,r.push(t),n.push(t));e._polylines=n,e._polylinesToUpdate=r}}function VA(e){for(var t,n=e._polylines,r=n.length,i=0;i<r;++i){n[i].isDestroyed||Ze(t=n[i]._bucket)&&(t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy())}}function kA(e){for(var t=e._vertexArrays.length,n=0;n<t;++n)e._vertexArrays[n].va.destroy();e._vertexArrays.length=0}function GA(e){for(var t=e._polylines,n=t.length,r=0;r<n;++r)t[r].isDestroyed||t[r]._destroy()}function qA(e,t,n){this.count=e,this.offset=t,this.bucket=n}function HA(e,t,n){this.polylines=[],this.lengthOfPositions=0,this.material=e,this.shaderProgram=void 0,this.mode=t,this.modelMatrix=n}function WA(e){return _t.dot(_t.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(Zf.ORIGIN_ZX_PLANE)===Jn.INTERSECTING}IA.prototype._updatePolyline=function(e,t){this._polylinesUpdated=!0,e._dirty||this._polylinesToUpdate.push(e),++this._propertiesChanged[t]},HA.prototype.addPolyline=function(e){this.polylines.push(e),e._actualLength=this.getPolylinePositionsLength(e),this.lengthOfPositions+=e._actualLength,e._bucket=this},HA.prototype.updateShader=function(e,t,n){var r,i,o,a;Ze(this.shaderProgram)||(r=["DISTANCE_DISPLAY_CONDITION"],n&&r.push("VECTOR_TILE"),-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&r.push("POLYLINE_DASH"),et.isInternetExplorer()||r.push("CLIP_POLYLINE"),i=new Xr({defines:r,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,"#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nvec2 st = v_st;\nst.t = czm_readNonPerspective(st.t, gl_FragCoord.w);\nmaterialInput.s = st.s;\nmaterialInput.st = st;\nmaterialInput.str = vec3(st, 0.0);\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#ifdef VECTOR_TILE\ngl_FragColor *= u_highlightColor;\n#endif\nczm_writeLogDepth();\n}\n"]}),o=t.getVertexShaderCallback()("attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 prevPosition2DHigh;\nattribute vec3 prevPosition2DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec3 nextPosition2DHigh;\nattribute vec3 nextPosition2DLow;\nattribute vec4 texCoordExpandAndBatchIndex;\nvarying vec2  v_st;\nvarying float v_width;\nvarying vec4 v_pickColor;\nvarying float v_polylineAngle;\nvoid main()\n{\nfloat texCoord = texCoordExpandAndBatchIndex.x;\nfloat expandDir = texCoordExpandAndBatchIndex.y;\nbool usePrev = texCoordExpandAndBatchIndex.z < 0.0;\nfloat batchTableIndex = texCoordExpandAndBatchIndex.w;\nvec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex);\nfloat width = widthAndShow.x + 0.5;\nfloat show = widthAndShow.y;\nif (width < 1.0)\n{\nshow = 0.0;\n}\nvec4 pickColor = batchTable_getPickColor(batchTableIndex);\nvec4 p, prev, next;\nif (czm_morphTime == 1.0)\n{\np = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);\nprev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);\nnext = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);\n}\nelse if (czm_morphTime == 0.0)\n{\np = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\nprev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);\nnext = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);\n}\nelse\n{\np = czm_columbusViewMorph(\nczm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\nczm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),\nczm_morphTime);\nprev = czm_columbusViewMorph(\nczm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),\nczm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),\nczm_morphTime);\nnext = czm_columbusViewMorph(\nczm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),\nczm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),\nczm_morphTime);\n}\n#ifdef DISTANCE_DISPLAY_CONDITION\nvec3 centerHigh = batchTable_getCenterHigh(batchTableIndex);\nvec4 centerLowAndRadius = batchTable_getCenterLowAndRadius(batchTableIndex);\nvec3 centerLow = centerLowAndRadius.xyz;\nfloat radius = centerLowAndRadius.w;\nvec2 distanceDisplayCondition = batchTable_getDistanceDisplayCondition(batchTableIndex);\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nvec4 center = czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);\nlengthSq = max(0.0, dot(center.xyz, center.xyz) - radius * radius);\n}\nfloat nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x;\nfloat farSq = distanceDisplayCondition.y * distanceDisplayCondition.y;\nif (lengthSq < nearSq || lengthSq > farSq)\n{\nshow = 0.0;\n}\n#endif\nfloat polylineAngle;\nvec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, polylineAngle);\ngl_Position = czm_viewportOrthographic * positionWC * show;\nv_st.s = texCoord;\nv_st.t = czm_writeNonPerspective(clamp(expandDir, 0.0, 1.0), gl_Position.w);\nv_width = width;\nv_pickColor = pickColor;\nv_polylineAngle = polylineAngle;\n}\n"),a=new Xr({defines:r,sources:[mw,o]}),this.shaderProgram=ic.fromCache({context:e,vertexShaderSource:a,fragmentShaderSource:i,attributeLocations:AA}))},HA.prototype.getPolylinePositionsLength=function(e){if(this.mode===Tl.SCENE3D||!WA(e))return 4*(r=e._actualPositions.length)-4;for(var t=0,n=e._segments.lengths,r=n.length,i=0;i<r;++i)t+=4*n[i]-4;return t};var YA=new _t,XA=new _t,jA=new _t,KA=new _t,QA=new qt,ZA=new En;HA.prototype.write=function(e,t,n,r,i,o,a,s){for(var u=this.mode,l=s.ellipsoid.maximumRadius*pt.PI,c=this.polylines,h=c.length,f=0;f<h;++f){for(var p,d=c[f],m=d.width,_=d.show&&0<m,g=d._index,y=this.getSegments(d,s),v=y.positions,x=y.lengths,b=v.length,E=d.getPickId(a).color,T=0,S=0,C=0;C<b;++C){0===C?d._loop?p=v[b-2]:(p=KA,_t.subtract(v[0],v[1],p),_t.add(v[0],p,p)):p=v[C-1],_t.clone(p,XA),_t.clone(v[C],YA),C===b-1?d._loop?p=v[1]:(p=KA,_t.subtract(v[b-1],v[b-2],p),_t.add(v[b-1],p,p)):p=v[C+1],_t.clone(p,jA);var w=x[T];C===S+w&&(S+=w,++T);var A=C-S==0,I=C===S+x[T]-1;u===Tl.SCENE2D&&(XA.z=0,YA.z=0,jA.z=0),u!==Tl.SCENE2D&&u!==Tl.MORPHING||(A||I)&&l-Math.abs(YA.x)<1&&((YA.x<0&&0<XA.x||0<YA.x&&XA.x<0)&&_t.clone(YA,XA),(YA.x<0&&0<jA.x||0<YA.x&&jA.x<0)&&_t.clone(YA,jA));for(var P=I?2:4,O=A?2:0;O<P;++O){$d.writeElements(YA,e,n),$d.writeElements(XA,e,n+6),$d.writeElements(jA,e,n+12);var L=O-2<0?-1:1;t[i]=C/(b-1),t[i+1]=O%2*2-1,t[i+2]=L,t[i+3]=g,n+=18,i+=4}}var N=QA;N.x=It.floatToByte(E.red),N.y=It.floatToByte(E.green),N.z=It.floatToByte(E.blue),N.w=It.floatToByte(E.alpha);var R=ZA;R.x=m,R.y=_?1:0;var D=u===Tl.SCENE2D?d._boundingVolume2D:d._boundingVolumeWC,M=$d.fromCartesian(D.center,PA),F=M.high,z=qt.fromElements(M.low.x,M.low.y,M.low.z,D.radius,OA),B=LA;B.x=0,B.y=Number.MAX_VALUE;var U=d.distanceDisplayCondition;Ze(U)&&(B.x=U.near,B.y=U.far),o.setBatchedAttribute(g,0,R),o.setBatchedAttribute(g,1,N),2<o.attributes.length&&(o.setBatchedAttribute(g,2,F),o.setBatchedAttribute(g,3,z),o.setBatchedAttribute(g,4,B))}};var JA=new _t,$A=new _t,eI=new _t,tI=new _t;HA.prototype.writeForMorph=function(e,t){for(var n=this.modelMatrix,r=this.polylines,i=r.length,o=0;o<i;++o)for(var a,s=r[o],u=s._segments.positions,l=s._segments.lengths,c=u.length,h=0,f=0,p=0;p<c;++p){0===p?s._loop?a=u[c-2]:(a=tI,_t.subtract(u[0],u[1],a),_t.add(u[0],a,a)):a=u[p-1],a=on.multiplyByPoint(n,a,$A);var d,m=on.multiplyByPoint(n,u[p],JA);p===c-1?s._loop?d=u[1]:(d=tI,_t.subtract(u[c-1],u[c-2],d),_t.add(u[c-1],d,d)):d=u[p+1],d=on.multiplyByPoint(n,d,eI);var _=l[h];p===f+_&&(f+=_,++h);for(var g=p-f==0,y=p===f+l[h]-1?2:4,v=g?2:0;v<y;++v)$d.writeElements(m,e,t),$d.writeElements(a,e,t+6),$d.writeElements(d,e,t+12),t+=18}};var nI=new Array(1);HA.prototype.updateIndices=function(e,t,n,r){var i=n.length-1,o=new qA(0,r,this);n[i].push(o);var a=0,s=e[e.length-1],u=0;0<s.length&&(u=s[s.length-1]+1);for(var l=this.polylines,c=l.length,h=0;h<c;++h){var f,p=l[h];if(p._locatorBuckets=[],this.mode===Tl.SCENE3D){f=nI;var d=p._actualPositions.length;if(!(0<d))continue;f[0]=d}else f=p._segments.lengths;var m=f.length;if(0<m){for(var _=0,g=0;g<m;++g)for(var y=f[g]-1,v=0;v<y;++v)u+4>pt.SIXTY_FOUR_KILOBYTES&&(p._locatorBuckets.push({locator:o,count:_}),_=0,t.push(4),s=[],e.push(s),u=0,o.count=a,o=new qA(r=a=0,0,this),n[++i]=[o]),s.push(u,u+2,u+1),s.push(u+1,u+2,u+3),_+=6,a+=6,r+=6,u+=4;p._locatorBuckets.push({locator:o,count:_}),u+4>pt.SIXTY_FOUR_KILOBYTES&&(t.push(0),s=[],e.push(s),u=0,o.count=a,o=new qA(a=r=0,0,this),n[++i]=[o])}p._clean()}return o.count=a,r},HA.prototype.getPolylineStartIndex=function(e){for(var t=this.polylines,n=0,r=t.length,i=0;i<r;++i){var o=t[i];if(o===e)break;n+=o._actualLength}return n};var rI,iI={positions:void 0,lengths:void 0},oI=new Array(1),aI=new _t,sI=new Un;function uI(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=void 0,this._labelCollection=void 0,this._polylineCollection=void 0,this._verticesPromise=void 0,this._packedBuffer=void 0,this._ready=!1,this._readyPromise=D.defer(),this._resolvedPromise=!1,this._heightReference=e.heightReference}function lI(e,t){var n=e._rectangle,r=e._minHeight,i=e._maxHeight,o=new Float64Array(2+$n.packedLength+Wn.packedLength),a=0;return o[a++]=r,o[a++]=i,$n.pack(n,o,a),Wn.pack(t,o,a+=$n.packedLength),o}HA.prototype.getSegments=function(e,t){var n=e._actualPositions;if(this.mode===Tl.SCENE3D)return oI[0]=n.length,iI.positions=n,iI.lengths=oI,iI;WA(e)&&(n=e._segments.positions);for(var r,i,o=t.ellipsoid,a=[],s=this.modelMatrix,u=n.length,l=aI,c=0;c<u;++c)r=n[c],l=on.multiplyByPoint(s,r,l),a.push(t.project(o.cartesianToCartographic(l,sI)));return 0<a.length&&(e._boundingVolume2D=ko.fromPoints(a,e._boundingVolume2D),i=e._boundingVolume2D.center,e._boundingVolume2D.center=new _t(i.z,i.x,i.y)),iI.positions=a,iI.lengths=e._segments.lengths,iI},HA.prototype.writeUpdate=function(e,t,n,r){var i=this.mode,o=r.ellipsoid.maximumRadius*pt.PI;if(m=t._actualLength){e+=this.getPolylineStartIndex(t);var a=rI,s=6*m*3;!Ze(a)||a.length<s?a=rI=new Float32Array(s):a.length>s&&(a=new Float32Array(a.buffer,0,s));for(var u,l=this.getSegments(t,r),c=l.positions,h=l.lengths,f=0,p=0,d=0,m=c.length,_=0;_<m;++_){0===_?t._loop?u=c[m-2]:(u=KA,_t.subtract(c[0],c[1],u),_t.add(c[0],u,u)):u=c[_-1],_t.clone(u,XA),_t.clone(c[_],YA),_===m-1?t._loop?u=c[1]:(u=KA,_t.subtract(c[m-1],c[m-2],u),_t.add(c[m-1],u,u)):u=c[_+1],_t.clone(u,jA);var g=h[p];_===d+g&&(d+=g,++p);var y=_-d==0,v=_===d+h[p]-1;i===Tl.SCENE2D&&(XA.z=0,YA.z=0,jA.z=0),i!==Tl.SCENE2D&&i!==Tl.MORPHING||(y||v)&&o-Math.abs(YA.x)<1&&((YA.x<0&&0<XA.x||0<YA.x&&XA.x<0)&&_t.clone(YA,XA),(YA.x<0&&0<jA.x||0<YA.x&&jA.x<0)&&_t.clone(YA,jA));for(var x=v?2:4,b=y?2:0;b<x;++b)$d.writeElements(YA,a,f),$d.writeElements(XA,a,f+6),$d.writeElements(jA,a,f+12),f+=18}n.copyFromArrayView(a,18*Float32Array.BYTES_PER_ELEMENT*e)}},Object.defineProperties(uI.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){return this._billboardCollection.textureAtlas.texture.sizeInBytes+this._labelCollection._textureAtlas.texture.sizeInBytes}},readyPromise:{get:function(){return this._readyPromise.promise}}});var cI=new Df("createVectorTilePoints"),hI=new _t;uI.prototype.createFeatures=function(e,t){for(var n=this._billboardCollection,r=this._labelCollection,i=this._polylineCollection,o=this._batchIds,a=o.length,s=0;s<a;++s){var u=o[s],l=n.get(s),c=r.get(s),h=i.get(s);t[u]=new SC(e,u,l,c,h)}},uI.prototype.applyDebugSettings=function(e,t){e?(It.clone(t,this._billboardCollection._highlightColor),It.clone(t,this._labelCollection._highlightColor),It.clone(t,this._polylineCollection._highlightColor)):(It.clone(It.WHITE,this._billboardCollection._highlightColor),It.clone(It.WHITE,this._labelCollection._highlightColor),It.clone(It.WHITE,this._polylineCollection._highlightColor))};var fI=new It,pI=new It,dI=new It,mI=new It,_I=new It,gI=new It,yI=new yT,vI=new yT,xI=new wf;function bI(e){this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._counts=e.counts,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._batchedPositions=void 0,this._transferrableBatchIds=void 0,this._vertexBatchIds=void 0,this._ellipsoid=Je(e.ellipsoid,Wn.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._polygonMinimumHeights=e.polygonMinimumHeights,this._polygonMaximumHeights=e.polygonMaximumHeights,this._center=Je(e.center,_t.ZERO),this._rectangle=e.rectangle,this._center=void 0,this._boundingVolume=e.boundingVolume,this._boundingVolumes=void 0,this._batchedIndices=void 0,this._ready=!1,this._readyPromise=D.defer(),this._verticesPromise=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Uc.BOTH}uI.prototype.applyStyle=function(e,t){if(Ze(e))for(var n=this._batchIds,r=n.length,i=0;i<r;++i){var o,a,s,u=t[n[i]];Ze(e.show)&&(u.show=e.show.evaluate(u)),Ze(e.pointSize)&&(u.pointSize=e.pointSize.evaluate(u)),Ze(e.color)&&(u.color=e.color.evaluateColor(u,fI)),Ze(e.pointOutlineColor)&&(u.pointOutlineColor=e.pointOutlineColor.evaluateColor(u,pI)),Ze(e.pointOutlineWidth)&&(u.pointOutlineWidth=e.pointOutlineWidth.evaluate(u)),Ze(e.labelColor)&&(u.labelColor=e.labelColor.evaluateColor(u,dI)),Ze(e.labelOutlineColor)&&(u.labelOutlineColor=e.labelOutlineColor.evaluateColor(u,mI)),Ze(e.labelOutlineWidth)&&(u.labelOutlineWidth=e.labelOutlineWidth.evaluate(u)),Ze(e.font)&&(u.font=e.font.evaluate(u)),Ze(e.labelStyle)&&(u.labelStyle=e.labelStyle.evaluate(u)),Ze(e.labelText)?u.labelText=e.labelText.evaluate(u):u.labelText=void 0,Ze(e.backgroundColor)&&(u.backgroundColor=e.backgroundColor.evaluateColor(u,_I)),Ze(e.backgroundPadding)&&(u.backgroundPadding=e.backgroundPadding.evaluate(u)),Ze(e.backgroundEnabled)&&(u.backgroundEnabled=e.backgroundEnabled.evaluate(u)),Ze(e.scaleByDistance)?(o=e.scaleByDistance.evaluate(u),yI.near=o.x,yI.nearValue=o.y,yI.far=o.z,yI.farValue=o.w,u.scaleByDistance=yI):u.scaleByDistance=void 0,Ze(e.translucencyByDistance)?(a=e.translucencyByDistance.evaluate(u),vI.near=a.x,vI.nearValue=a.y,vI.far=a.z,vI.farValue=a.w,u.translucencyByDistance=vI):u.translucencyByDistance=void 0,Ze(e.distanceDisplayCondition)?(s=e.distanceDisplayCondition.evaluate(u),xI.near=s.x,xI.far=s.y,u.distanceDisplayCondition=xI):u.distanceDisplayCondition=void 0,Ze(e.heightOffset)&&(u.heightOffset=e.heightOffset.evaluate(u)),Ze(e.anchorLineEnabled)&&(u.anchorLineEnabled=e.anchorLineEnabled.evaluate(u)),Ze(e.anchorLineColor)&&(u.anchorLineColor=e.anchorLineColor.evaluateColor(u,gI)),Ze(e.image)?u.image=e.image.evaluate(u):u.image=void 0,Ze(e.disableDepthTestDistance)&&(u.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(u)),Ze(e.horizontalOrigin)&&(u.horizontalOrigin=e.horizontalOrigin.evaluate(u)),Ze(e.verticalOrigin)&&(u.verticalOrigin=e.verticalOrigin.evaluate(u)),Ze(e.labelHorizontalOrigin)&&(u.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(u)),Ze(e.labelVerticalOrigin)&&(u.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(u)),Ze(e.exOffset)&&(u.exOffset=e.exOffset.evaluate(u))}else!function(e,t){for(var n=e._batchIds,r=n.length,i=0;i<r;++i){var o=t[n[i]];o.show=!0,o.pointSize=SC.defaultPointSize,o.color=SC.defaultColor,o.pointOutlineColor=SC.defaultPointOutlineColor,o.pointOutlineWidth=SC.defaultPointOutlineWidth,o.labelColor=It.WHITE,o.labelOutlineColor=It.WHITE,o.labelOutlineWidth=1,o.font="30px sans-serif",o.labelStyle=DC.FILL,o.labelText=void 0,o.backgroundColor=new It(.165,.165,.165,.8),o.backgroundPadding=new En(7,5),o.backgroundEnabled=!1,o.scaleByDistance=void 0,o.translucencyByDistance=void 0,o.distanceDisplayCondition=void 0,o.heightOffset=0,o.anchorLineEnabled=!1,o.anchorLineColor=It.WHITE,o.image=void 0,o.disableDepthTestDistance=0,o.horizontalOrigin=ST.CENTER,o.verticalOrigin=HT.CENTER,o.labelHorizontalOrigin=ST.RIGHT,o.labelVerticalOrigin=HT.BASELINE}}(this,t)},uI.prototype.update=function(e){this._heightReference===Ap.CLAMP_TO_GROUND?function(t,e,n){if(Ze(t._billboardCollection))return;var r;if(!Ze(t._verticesPromise)){r=t._positions;var i=t._packedBuffer;Ze(i)||(r=t._positions=Uo(r),t._batchIds=Uo(t._batchIds),i=t._packedBuffer=lI(t,e));var o=[r.buffer,i.buffer],a={positions:r.buffer,packedBuffer:i.buffer},s=t._verticesPromise=cI.scheduleTask(a,o);if(!Ze(s))return;s.then(function(e){t._positions=new Float64Array(e.positions),t._ready=!0})}if(t._ready&&!Ze(t._billboardCollection)){r=t._positions;var u=t._batchTable,l=t._batchIds,c=t._billboardCollection=new HS({batchTable:u,scene:n}),h=t._labelCollection=new dw({batchTable:u,scene:n}),f=t._polylineCollection=new IA;f._useHighlightColor=!0;for(var p=r.length/3,d=0;d<p;++d){var m=l[d],_=_t.unpack(r,3*d,hI),g=c.add({heightReference:Ap.CLAMP_TO_GROUND});g.position=_,g._batchIndex=m;var y=h.add({heightReference:Ap.CLAMP_TO_GROUND});y.text=" ",y.position=_,y._batchIndex=m,f.add().positions=[_t.clone(_),_t.clone(_)]}t._positions=void 0,t._packedBuffer=void 0}}(this,e.mapProjection.ellipsoid,e.camera._scene):function(t,e){if(!Ze(t._billboardCollection)){var n;if(!Ze(t._verticesPromise)){n=t._positions;var r=t._packedBuffer;Ze(r)||(n=t._positions=Uo(n),t._batchIds=Uo(t._batchIds),r=t._packedBuffer=lI(t,e));var i=[n.buffer,r.buffer],o={positions:n.buffer,packedBuffer:r.buffer},a=t._verticesPromise=cI.scheduleTask(o,i);if(!Ze(a))return;a.then(function(e){t._positions=new Float64Array(e.positions),t._ready=!0})}if(t._ready&&!Ze(t._billboardCollection)){n=t._positions;var s=t._batchTable,u=t._batchIds,l=t._billboardCollection=new HS({batchTable:s}),c=t._labelCollection=new dw({batchTable:s}),h=t._polylineCollection=new IA;h._useHighlightColor=!0;for(var f=n.length/3,p=0;p<f;++p){var d=u[p],m=_t.unpack(n,3*p,hI),_=l.add();_.position=m,_._batchIndex=d;var g=c.add();g.text=" ",g.position=m,g._batchIndex=d,h.add().positions=[_t.clone(m),_t.clone(m)]}t._positions=void 0,t._packedBuffer=void 0}}}(this,e.mapProjection.ellipsoid),this._ready&&(this._polylineCollection.update(e),this._billboardCollection.update(e),this._labelCollection.update(e),this._resolvedPromise||(this._readyPromise.resolve(),this._resolvedPromise=!0))},uI.prototype.isDestroyed=function(){return!1},uI.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),Vt(this)},Object.defineProperties(bI.prototype,{trianglesLength:{get:function(){return Ze(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return Ze(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}});var EI=new Df("createVectorTilePolygons"),TI=new It;function SI(r){if(!Ze(r._primitive)){if(!Ze(r._verticesPromise)){var e=r._positions,t=r._counts,n=r._indexCounts,i=r._indices,o=r._transferrableBatchIds,a=r._batchTableColors,s=r._packedBuffer;if(!Ze(a)){e=r._positions=Uo(r._positions),t=r._counts=Uo(r._counts),n=r._indexCounts=Uo(r._indexCounts),i=r._indices=Uo(r._indices),r._center=r._ellipsoid.cartographicToCartesian($n.center(r._rectangle)),o=r._transferrableBatchIds=new Uint32Array(r._batchIds),a=r._batchTableColors=new Uint32Array(o.length);for(var u=r._batchTable,l=a.length,c=0;c<l;++c){var h=u.getColor(c,TI);a[c]=h.toRgba()}s=r._packedBuffer=(g=r,y=new Float64Array(3+_t.packedLength+Wn.packedLength+$n.packedLength),v=0,y[v++]=g._indices.BYTES_PER_ELEMENT,y[v++]=g._minimumHeight,y[v++]=g._maximumHeight,_t.pack(g._center,y,v),v+=_t.packedLength,Wn.pack(g._ellipsoid,y,v),v+=Wn.packedLength,$n.pack(g._rectangle,y,v),y)}var f=[e.buffer,t.buffer,n.buffer,i.buffer,o.buffer,a.buffer,s.buffer],p={packedBuffer:s.buffer,positions:e.buffer,counts:t.buffer,indexCounts:n.buffer,indices:i.buffer,batchIds:o.buffer,batchTableColors:a.buffer},d=r._polygonMinimumHeights,m=r._polygonMaximumHeights;Ze(d)&&Ze(m)&&(d=Uo(d),m=Uo(m),f.push(d.buffer,m.buffer),p.minimumHeights=d,p.maximumHeights=m);var _=r._verticesPromise=EI.scheduleTask(p,f);if(!Ze(_))return;D(_,function(e){r._positions=void 0,r._counts=void 0,r._polygonMinimumHeights=void 0,r._polygonMaximumHeights=void 0;var t=new Float64Array(e.packedBuffer),n=t[0];!function(e,t){for(var n=1,r=t[n++],i=e._boundingVolumes=new Array(r),o=0;o<r;++o)i[o]=ab.unpack(t,n),n+=ab.packedLength;for(var a=t[n++],s=e._batchedIndices=new Array(a),u=0;u<a;++u){var l=It.unpack(t,n);n+=It.packedLength;for(var c=t[n++],h=t[n++],f=t[n++],p=new Array(f),d=0;d<f;++d)p[d]=t[n++];s[u]=new Sl({color:l,offset:c,count:h,batchIds:p})}}(r,t),r._indices=new(2===wa.getSizeInBytes(n)?Uint16Array:Uint32Array)(e.indices),r._indexOffsets=new Uint32Array(e.indexOffsets),r._indexCounts=new Uint32Array(e.indexCounts),r._batchedPositions=new Float32Array(e.positions),r._vertexBatchIds=new Uint16Array(e.batchIds),r._ready=!0})}var g,y,v;r._ready&&!Ze(r._primitive)&&(r._primitive=new Ih({batchTable:r._batchTable,positions:r._batchedPositions,batchIds:r._batchIds,vertexBatchIds:r._vertexBatchIds,indices:r._indices,indexOffsets:r._indexOffsets,indexCounts:r._indexCounts,batchedIndices:r._batchedIndices,boundingVolume:r._boundingVolume,boundingVolumes:r._boundingVolumes,center:r._center}),r._batchTable=void 0,r._batchIds=void 0,r._positions=void 0,r._counts=void 0,r._indices=void 0,r._indexCounts=void 0,r._indexOffsets=void 0,r._batchTableColors=void 0,r._packedBuffer=void 0,r._batchedPositions=void 0,r._transferrableBatchIds=void 0,r._vertexBatchIds=void 0,r._ellipsoid=void 0,r._minimumHeight=void 0,r._maximumHeight=void 0,r._polygonMinimumHeights=void 0,r._polygonMaximumHeights=void 0,r._center=void 0,r._rectangle=void 0,r._boundingVolume=void 0,r._boundingVolumes=void 0,r._batchedIndices=void 0,r._verticesPromise=void 0,r._readyPromise.resolve())}}bI.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)},bI.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)},bI.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)},bI.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)},bI.prototype.update=function(e){SI(this),this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e))},bI.prototype.isDestroyed=function(){return!1},bI.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),Vt(this)};var CI="attribute vec4 currentPosition;\nattribute vec4 previousPosition;\nattribute vec4 nextPosition;\nattribute vec3 expandAndWidth;\nattribute float a_batchId;\nattribute float disableDepthTestDistance;\nuniform mat4 u_modifiedModelView;\nvarying vec2  v_st;\nvarying float v_polylineAngle;\nvoid main()\n{\nfloat expandDir = expandAndWidth.x;\nfloat width = abs(expandAndWidth.y) + 0.5;\nbool usePrev = expandAndWidth.y < 0.0;\nfloat texCoord = expandAndWidth.z;\nvec4 p = u_modifiedModelView * currentPosition;\nvec4 prev = u_modifiedModelView * previousPosition;\nvec4 next = u_modifiedModelView * nextPosition;\nfloat angle;\nvec4 positionWC = getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle);\nv_polylineAngle = angle;\ngl_Position = czm_viewportOrthographic * positionWC;\nv_st = vec2(texCoord, clamp(expandDir, 0.0, 1.0));\n}\n";function wI(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=Je(e.ellipsoid,Wn.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this.highPrecision=e.highPrecision,Ze(e.material.color)?this._material=_w.fromType(_w.ColorType,{color:e.material.color}):this._material=_w.fromType(_w.ColorType,{color:new It(1,1,1,1)}),this.highPrecision&&this._widths[0],this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=It.clone(It.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._readyPromise=D.defer(),this._verticesPromise=void 0,this.useHdr=!0,this.rollerRegion=e.rollerRegion}Object.defineProperties(wI.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise.promise}}});var AI=new Df("createVectorTilePolylines"),II={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};function PI(n,e){if(!Ze(n._va)){if(!Ze(n._verticesPromise)){var t=n._positions,r=n._widths,i=n._counts,o=n._transferrableBatchIds,a=n._packedBuffer;Ze(a)||(t=n._positions=Uo(t),r=n._widths=Uo(r),i=n._counts=Uo(i),o=n._transferrableBatchIds=Uo(n._batchIds),a=n._packedBuffer=(f=(h=n)._rectangle,p=h._minimumHeight,d=h._maximumHeight,m=h._ellipsoid,_=h._center,g=new Float64Array(2+$n.packedLength+Wn.packedLength+_t.packedLength),y=0,g[y++]=p,g[y++]=d,$n.pack(f,g,y),Wn.pack(m,g,y+=$n.packedLength),_t.pack(_,g,y+=Wn.packedLength),g));var s=[t.buffer,r.buffer,i.buffer,o.buffer,a.buffer],u=n.highPrecision,l={positions:t.buffer,widths:r.buffer,counts:i.buffer,batchIds:o.buffer,packedBuffer:a.buffer,highPrecision:u},c=n._verticesPromise=AI.scheduleTask(l,s);if(!Ze(c))return;D(c,function(e){n._currentPositions=new Float32Array(e.currentPositions),n._previousPositions=new Float32Array(e.previousPositions),n._nextPositions=new Float32Array(e.nextPositions),n._expandAndWidth=new Float32Array(e.expandAndWidth),n._vertexBatchIds=new Uint16Array(e.batchIds);var t=e.indexDatatype;n._indices=new(t===wa.UNSIGNED_SHORT?Uint16Array:Uint32Array)(e.indices),n._ready=!0})}var h,f,p,d,m,_,g,y,v,x,b,E,T,S,C,w,A,I,P,O,L,N;n._ready&&!Ze(n._va)&&(v=n._currentPositions,x=n._previousPositions,b=n._nextPositions,E=n._expandAndWidth,T=n._vertexBatchIds,S=n._indices,C=x.byteLength+v.byteLength+b.byteLength,C+=E.byteLength+T.byteLength+S.byteLength,n._trianglesLength=S.length/3,n._geometryByteLength=C,w=Al.createVertexBuffer({context:e,typedArray:x,usage:wl.STATIC_DRAW}),A=Al.createVertexBuffer({context:e,typedArray:v,usage:wl.STATIC_DRAW}),I=Al.createVertexBuffer({context:e,typedArray:b,usage:wl.STATIC_DRAW}),P=Al.createVertexBuffer({context:e,typedArray:E,usage:wl.STATIC_DRAW}),O=Al.createVertexBuffer({context:e,typedArray:T,usage:wl.STATIC_DRAW}),L=Al.createIndexBuffer({context:e,typedArray:S,usage:wl.STATIC_DRAW,indexDatatype:2===S.BYTES_PER_ELEMENT?wa.UNSIGNED_SHORT:wa.UNSIGNED_INT}),N=[{index:II.previousPosition,vertexBuffer:w,componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{index:II.currentPosition,vertexBuffer:A,componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{index:II.nextPosition,vertexBuffer:I,componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{index:II.expandAndWidth,vertexBuffer:P,componentDatatype:Mt.FLOAT,componentsPerAttribute:2},{index:II.a_batchId,vertexBuffer:O,componentDatatype:Mt.UNSIGNED_SHORT,componentsPerAttribute:1}],n._va=new Ac({context:e,attributes:N,indexBuffer:L}),n._positions=void 0,n._widths=void 0,n._counts=void 0,n._ellipsoid=void 0,n._minimumHeight=void 0,n._maximumHeight=void 0,n._rectangle=void 0,n._transferrableBatchIds=void 0,n._packedBuffer=void 0,n._currentPositions=void 0,n._previousPositions=void 0,n._nextPositions=void 0,n._expandAndWidth=void 0,n._vertexBatchIds=void 0,n._indices=void 0,n._readyPromise.resolve())}}var OI=new on,LI=new _t;var NI=new qt(0,0,1,1);wI.prototype.createFeatures=function(e,t){for(var n=this._batchIds,r=n.length,i=0;i<r;++i){var o=n[i];t[o]=new Fo(e,o)}},wI.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};var RI=new It,DI=It.WHITE;function MI(e,t,n,r,i){this._tileset=e,this._tile=t,this._resource=n,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._contentReadyPromise=void 0,this._readyPromise=D.defer(),this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,function(e,t,n){n=Je(n,0);var r=new Uint8Array(t),i=new DataView(t);n+=FI;var o=i.getUint32(n,!0);if(1!==o)throw new de("Only Vector tile version 1 is supported.  Version "+o+" is not.");n+=FI;var a=i.getUint32(n,!0);if(n+=FI,0===a)return e._readyPromise.resolve(e);var s=i.getUint32(n,!0);if(n+=FI,0===s)throw new de("Feature table must have a byte length greater than zero");var u=i.getUint32(n,!0);n+=FI;var l=i.getUint32(n,!0);n+=FI;var c=i.getUint32(n,!0);n+=FI;var h=i.getUint32(n,!0);n+=FI;var f=i.getUint32(n,!0);n+=FI;var p=i.getUint32(n,!0);n+=FI;var d=i.getUint32(n,!0),m=kt(r,n+=FI,s),_=JSON.parse(m);n+=s;var g,y,v=new Uint8Array(t,n,u);{var x;n+=u,0<l&&(x=kt(r,n,l),g=JSON.parse(x),n+=l,0<c&&(y=new Uint8Array(t,n,c),y=new Uint8Array(y),n+=c))}var b=Je(_.POLYGONS_LENGTH,0),E=Je(_.POLYLINES_LENGTH,0),T=Je(_.POINTS_LENGTH,0),S=b+E+T,C=new no(e,S,g,y,function(n){return function(e,t){Ze(n._polygons)&&n._polygons.updateCommands(e,t)}}(e));if(e._batchTable=C,0===S)return;var w=new zo(_,v);if(Ze(w.json.FLOWLINE)){var A=w.json.FLOWLINE;for(var I in A){for(var P=[],O=0;O<A[I].length;O+=3){var L=_t.fromRadians(A[I][O+0],A[I][O+1],A[I][O+2]);P.push(L)}Ze(e.tileset.flowLines)||(e.tileset.flowLines=[]),e.tileset.flowLines.push(P)}}var N=w.getGlobalProperty("REGION");if(!Ze(N))throw new de("Feature table global property: REGION must be defined");var R=$n.unpack(N),D=N[4],M=N[5],F=e._tile.computedTransform,z=w.getGlobalProperty("RTC_CENTER",Mt.FLOAT,3);Ze(z)?(z=_t.unpack(z),on.multiplyByPoint(F,z,z)):((z=$n.center(R)).height=pt.lerp(D,M,.5),z=Wn.WGS84.cartographicToCartesian(z));var B,U,V=function(e,t){var n,r,i,o,a=Je(e.POLYGONS_LENGTH,0),s=Je(e.POLYLINES_LENGTH,0),u=Je(e.POINTS_LENGTH,0);{var l;0<a&&Ze(e.POLYGON_BATCH_IDS)&&(l=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset,n=new Uint16Array(t.buffer,l,a))}{var c;0<s&&Ze(e.POLYLINE_BATCH_IDS)&&(c=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset,r=new Uint16Array(t.buffer,c,s))}{var h;0<u&&Ze(e.POINT_BATCH_IDS)&&(h=t.byteOffset+e.POINT_BATCH_IDS.byteOffset,i=new Uint16Array(t.buffer,h,u))}var f=Ze(n)||Ze(r)||Ze(i),p=0<a&&!Ze(n)||0<s&&!Ze(r)||0<u&&!Ze(i);if(f&&p)throw new de("If one group of batch ids is defined, then all batch ids must be defined.");if(!Ze(n)&&!Ze(r)&&!Ze(i)){var d=0;if(!Ze(n)&&0<a)for(n=new Uint16Array(a),o=0;o<a;++o)n[o]=d++;if(!Ze(r)&&0<s)for(r=new Uint16Array(s),o=0;o<s;++o)r[o]=d++;if(!Ze(i)&&0<u)for(i=new Uint16Array(u),o=0;o<u;++o)i[o]=d++}return{polygons:n,polylines:r,points:i}}(_,v);if(n+=n%4,0<b){w.featuresLength=b;var k=Je(w.getPropertyArray("POLYGON_COUNTS",Mt.UNSIGNED_INT,1),w.getPropertyArray("POLYGON_COUNT",Mt.UNSIGNED_INT,1));if(!Ze(k))throw new de("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var G=Je(w.getPropertyArray("POLYGON_INDEX_COUNTS",Mt.UNSIGNED_INT,1),w.getPropertyArray("POLYGON_INDEX_COUNT",Mt.UNSIGNED_INT,1));if(!Ze(G))throw new de("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var q=k.reduce(function(e,t){return e+2*t},0),H=G.reduce(function(e,t){return e+t},0),W=new Uint32Array(t,n,H);n+=h;var Y=new Uint16Array(t,n,q);n+=f,Ze(_.POLYGON_MINIMUM_HEIGHTS)&&Ze(_.POLYGON_MAXIMUM_HEIGHTS)&&(B=w.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",Mt.FLOAT,1),U=w.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",Mt.FLOAT,1)),e._polygons=new bI({positions:Y,counts:k,indexCounts:G,indices:W,minimumHeight:D,maximumHeight:M,polygonMinimumHeights:B,polygonMaximumHeights:U,center:z,rectangle:R,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:C,batchIds:V.polygons,modelMatrix:F})}if(0<E){w.featuresLength=E;var X=Je(w.getPropertyArray("POLYLINE_COUNTS",Mt.UNSIGNED_INT,1),w.getPropertyArray("POLYLINE_COUNT",Mt.UNSIGNED_INT,1));if(!Ze(X))throw new de("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");var j=w.getPropertyArray("POLYLINE_WIDTHS",Mt.UNSIGNED_SHORT,1);if(!Ze(j)){j=new Uint16Array(E);var K=2;Ze(e._tileset._airWidth)&&(K=e._tileset._airWidth);for(O=0;O<E;++O)j[O]=K}var Q,Z=X.reduce(function(e,t){return e+3*t},0),J=w.getGlobalProperty("HIGHTPRECISION",Mt.UNSIGNED_INT,1);Ze(J)||(J=e._tileset.highPrecision),Q=new(Ze(J)&&J?Uint32Array:Uint16Array)(t,n,Z),n+=p,e._polylines=new wI({positions:Q,widths:j,counts:X,batchIds:V.polylines,minimumHeight:D,maximumHeight:M,center:z,rectangle:R,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:C,material:e._tileset._material,highPrecision:J,rollerRegion:e._tileset.rollerRegion})}{var $;0<T&&($=new Uint16Array(t,n,3*T),n+=d,e._points=new uI({positions:$,batchIds:V.points,minimumHeight:D,maximumHeight:M,rectangle:R,batchTable:C,heightReference:e._tileset.heightReference}))}}(this,r,i)}wI.prototype.applyStyle=function(e,t){if(Ze(e)){Ze(this._batchTable._content.tileset.meshLine)&&(this.meshLine=this._batchTable._content.tileset.meshLine),Ze(this._batchTable.batchInitValues)&&(this._batchTable._batchValues=void 0,this._batchTable._batchValues=Uo(this._batchTable.batchInitValues),this._batchTable._batchValuesDirty=!0),this.meshLine&&!Ze(this._batchTable._batchValues)&&(e.color=this._batchTable._content.tileset.meshLineColor);for(var n=this._batchIds,r=n.length,i=0;i<r;++i){var o,a=t[n[i]];if(this.meshLine){if(Ze(e.color)&&(o=e.color.evaluateColor(a,RI),It.equals(o,DI)))continue;a.color=Ze(e.color)?o:DI}else a.color=Ze(e.color)?e.color.evaluateColor(a,RI):DI;a.show=!Ze(e.show)||e.show.evaluate(a)}this.meshLine&&!Ze(this._batchTable.batchInitValues)&&Ze(this._batchTable._batchValues)&&(this._batchTable.batchInitValues=Uo(this._batchTable._batchValues))}else!function(e,t){for(var n=e._batchIds,r=n.length,i=0;i<r;++i){var o=t[n[i]];o.show=!0,o.color=It.WHITE}}(this,t)},wI.prototype.update=function(e){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m=e.context;PI(this,m),n=m,Ze((t=this)._uniformMap)||(t._uniformMap={u_modifiedModelView:function(){var e=n.uniformState.view;return on.clone(e,OI),on.multiplyByPoint(OI,t._center,LI),on.setTranslation(OI,LI,OI),OI},u_highlightColor:function(){return t._highlightColor},u_rollerRegion:function(){return t.rollerRegion}}),i=m,Ze((r=this)._sp)||(a=(o=r._batchTable).getVertexShaderCallback(!1,"a_batchId",void 0)(CI),u=o.getFragmentShaderCallback()("uniform vec4 u_highlightColor; \nvoid main()\n{\n    gl_FragColor = u_highlightColor;\n}\n",!1,void 0),s=new Xr({defines:["VECTOR_TILE",et.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[mw,a]}),l=new Xr({defines:["VECTOR_TILE"],sources:[u=r._material.shaderSource+u]}),r.rollerRegion.equals(NI)||l.defines.push("APPLY_ROLLER"),l.sources=l.sources.map(function(e){return e=(e=e.replace("tile_color(tile_featureColor);","#ifdef APPLY_ROLLER\n    czm_rollerShutter(gl_FragCoord.xy,u_rollerRegion);\n#endif\nczm_materialInput materialInput;\n\n    materialInput.s = v_st.s;\n    materialInput.st = v_st;\n    materialInput.str = vec3(v_st, 0.0);\n\n    czm_material material = czm_getMaterial(materialInput);\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#ifdef VECTOR_TILE\n    gl_FragColor*= u_highlightColor;\n#endif\nfloat highlight = ceil(tile_colorBlend); \ngl_FragColor.rgb *= mix(gl_FragColor.rgb, tile_featureColor.rgb, highlight);\n    czm_writeLogDepth();")).replace("varying vec4 tile_featureColor;","varying vec4 tile_featureColor;\nvarying vec2 v_st;\nuniform vec4 u_rollerRegion;")}),r._sp=ic.fromCache({context:i,vertexShaderSource:s,fragmentShaderSource:l,attributeLocations:II})),Ze((c=this)._rs)||(c._rs=sr.fromCache({blending:ui.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:{enabled:!0,factor:-5,units:-5}})),!this._ready||((h=e.passes).render||h.pick)&&(p=e,Ze((f=this)._command)||(d=ne(d=f._batchTable.getUniformMapCallback()(f._uniformMap),f._material._uniforms),f._command=new Mn({owner:f,vertexArray:f._va,renderState:f._rs,shaderProgram:f._sp,uniformMap:d,boundingVolume:f._boundingVolume,pass:yn.TRANSLUCENT,pickId:f._batchTable.getPickId()})),f._command.dirty=f.useHdr!==p.camera._scene._hdr,f.useHdr=p.camera._scene._hdr,p.commandList.push(f._command))},wI.prototype.isDestroyed=function(){return!1},wI.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Vt(this)},Object.defineProperties(MI.prototype,{featuresLength:{get:function(){return Ze(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return Ze(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){var e=0;return Ze(this._polygons)&&(e+=this._polygons.trianglesLength),Ze(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){var e=0;return Ze(this._polygons)&&(e+=this._polygons.geometryByteLength),Ze(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return Ze(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return Ze(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var FI=Uint32Array.BYTES_PER_ELEMENT;function zI(e){var t,n=e.featuresLength;!Ze(e._features)&&0<n&&(t=new Array(n),Ze(e._polygons)&&e._polygons.createFeatures(e,t),Ze(e._polylines)&&e._polylines.createFeatures(e,t),Ze(e._points)&&e._points.createFeatures(e,t),e._features=t)}MI.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},MI.prototype.getFeature=function(e){return zI(this),this._features[e]},MI.prototype.applyDebugSettings=function(e,t){Ze(this._polygons)&&this._polygons.applyDebugSettings(e,t),Ze(this._polylines)&&this._polylines.applyDebugSettings(e,t),Ze(this._points)&&this._points.applyDebugSettings(e,t)},MI.prototype.applyStyle=function(e){zI(this),Ze(this._polygons)&&this._polygons.applyStyle(e,this._features),Ze(this._polylines)&&this._polylines.applyStyle(e,this._features),Ze(this._points)&&this._points.applyStyle(e,this._features)},MI.prototype.update=function(e,t){var n,r,i,o,a=!0;Ze(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),a=a&&this._polygons._ready),Ze(this._polylines)&&(this._polylines.update(t),a=a&&this._polylines._ready),Ze(this._points)&&(this._points.update(t),a=a&&this._points._ready),Ze(this._batchTable)&&a&&this._batchTable.update(e,t),Ze(this._contentReadyPromise)||(n=Ze(this._points)?this._points.readyPromise:void 0,r=Ze(this._polygons)?this._polygons.readyPromise:void 0,i=Ze(this._polylines)?this._polylines.readyPromise:void 0,(o=this)._contentReadyPromise=D.all([n,r,i]).then(function(){o._readyPromise.resolve(o)}))},MI.prototype.isDestroyed=function(){return!1},MI.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)};var BI={b3dm:function(e,t,n,r,i){return new qx(e,t,n,r,i)},pnts:function(e,t,n,r,i){return new mT(e,t,n,r,i)},i3dm:function(e,t,n,r,i){return new RE(e,t,n,r,i)},cmpt:function(e,t,n,r,i){return new oE(e,t,n,r,i,BI)},json:function(e,t,n,r,i){return new gT(e,t,n,r,i)},geom:function(e,t,n,r,i){return new hE(e,t,n,r,i)},vctr:function(e,t,n,r,i){return new MI(e,t,n,r,i)}},UI=Object.freeze({UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5}),VI=Object.freeze({NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0});function kI(e){e=Je(e,0),this._array=new Array(e),this._length=e}function GI(){}Object.defineProperties(kI.prototype,{length:{get:function(){return this._length},set:function(e){(this._length=e)>this._array.length&&(this._array.length=e)}},values:{get:function(){return this._array}}}),kI.prototype.get=function(e){return this._array[e]},kI.prototype.set=function(e,t){e>=this.length&&(this.length=e+1),this._array[e]=t},kI.prototype.peek=function(){return this._array[this._length-1]},kI.prototype.push=function(e){var t=this.length++;this._array[t]=e},kI.prototype.pop=function(){return this._array[--this.length]},kI.prototype.reserve=function(e){e>this._array.length&&(this._array.length=e)},kI.prototype.resize=function(e){this.length=e},kI.prototype.trim=function(e){e=Je(e,this.length),this._array.length=e};var qI={stack:new kI,stackMaximumLength:0};function HI(e){return e._visible&&e._inRequestVolume}function WI(e){return e.hasEmptyContent||e.hasTilesetContent}function YI(e,t){return 0!==t.children.length&&(t.hasTilesetContent?!t.contentExpired:(t.hasEmptyContent,!0))}function XI(e,t,n,r){for(var i=t.children,o=i.length,a=0;a<o;++a){var s=i[a];s.updateVisibility(r),HI(s)&&n.push(s)}}function jI(e,t){var n;(!WI(n=t)&&n.contentUnloaded||t.contentExpired)&&(t._priority=0,e._requestedTiles.push(t))}function KI(e,t,n){t._touchedFrame!==n.frameNumber&&(e._cache.touch(t),t._touchedFrame=n.frameNumber)}function QI(e,t,n){t.contentAvailable&&t.contentVisibility(n)!==Jn.OUTSIDE&&e._selectedTiles.push(t)}function ZI(){}function JI(e){return e._visible&&e._inRequestVolume}GI.selectTiles=function(e,t){e._selectedTiles.length=0,e._requestedTiles.length=0;var n=!(e._hasMixedContent=!1),r=e.root;if(r.updateVisibility(t),!HI(r))return n;var i=qI.stack;for(i.push(e.root);0<i.length;){qI.stackMaximumLength=Math.max(qI.stackMaximumLength,i.length);var o=i.pop(),a=o.refine===zE.ADD,s=o.refine===zE.REPLACE,u=YI(0,o);u&&XI(0,o,i,t),(a||s&&!u)&&(jI(e,o),KI(e,o,t),QI(e,o,t),WI(o)||o.contentAvailable||(n=!1)),++e.statistics.visited}return qI.stack.trim(qI.stackMaximumLength),n};var $I={stack:new kI,stackMaximumLength:0},eP={stack:new kI,stackMaximumLength:0},tP={stack:new kI,stackMaximumLength:0},nP={stack:new kI,stackMaximumLength:0,ancestorStack:new kI,ancestorStackMaximumLength:0},rP=2;function iP(e){return e._skipLevelOfDetail}function oP(e,t,n){var r;t.contentVisibility(n)!==Jn.OUTSIDE&&((r=t.content)&&r.featurePropertiesDirty?(r.featurePropertiesDirty=!1,t.lastStyleTime=0,e._selectedTilesToStyle.push(t)):t._selectedFrame<n.frameNumber-1&&e._selectedTilesToStyle.push(t),t._selectedFrame=n.frameNumber,e._selectedTiles.push(t))}function aP(e,t,n){var r;iP(e)?Ze(r=t.contentAvailable?t:t._ancestorWithContentAvailable)?r._shouldSelect=!0:function(e,t,n){var r=tP.stack;for(r.push(t);0<r.length;){tP.stackMaximumLength=Math.max(tP.stackMaximumLength,r.length);for(var i=r.pop().children,o=i.length,a=0;a<o;++a){var s=i[a];JI(s)&&(s.contentAvailable?(hP(e,s,n),sP(e,s,n),oP(e,s,n)):s._depth-t._depth<rP&&r.push(s))}}}(e,t,n):t.contentAvailable&&oP(e,t,n)}function sP(e,t,n){t._touchedFrame!==n.frameNumber&&(e._cache.touch(t),t._touchedFrame=n.frameNumber)}function uP(e,t,n){var r;t._requestedFrame!==n.frameNumber&&(dP(t)||t.contentExpired)&&(!function(e,t,n){if(!e._cullRequestsWhileMoving)return 1;var r=t.boundingSphere,i=Math.max(2*r.radius,1),o=n.camera,a=0!==o.positionWCDeltaMagnitude?o.positionWCDeltaMagnitude:o.positionWCDeltaMagnitudeLastFrame;return e.cullRequestsWhileMovingMultiplier*a/i<1}(e,t,n)||(r=n.camera.timeSinceMoved<e.foveatedTimeDelay,t.priorityDeferred&&r||(!e.enableUndergroundDataDistance||t._distanceToCamera<e.undergroundDataDistance)&&(t._requestedFrame=n.frameNumber,e._requestedTiles.push(t))))}function lP(e,t,n){t._updatedVisibilityFrame!==e._updatedVisibilityFrame&&(t.updateVisibility(n),t._updatedVisibilityFrame=e._updatedVisibilityFrame)}function cP(e,t,n){if(lP(e,t,n),JI(t)){var r=0<t.children.length;if(t.hasTilesetContent&&r){var i=t.children[0];return cP(e,i,n),void(t._visible=i._visible)}if(o=e,s=n,!(Ze(u=(a=t).parent)&&!u.hasTilesetContent&&u.refine===zE.ADD&&a.getScreenSpaceError(s,!0)<=o._maximumScreenSpaceError)){var o,a,s,u,l=t.refine===zE.REPLACE,c=t._optimChildrenWithinParent===VI.USE_OPTIMIZATION;return l&&c&&r&&!function(e,t,n){for(var r=!1,i=t.children,o=i.length,a=0;a<o;++a){var s=i[a];lP(e,s,n),r=r||JI(s)}return r}(e,t,n)&&(++e._statistics.numberOfTilesCulledWithChildrenUnion,void(t._visible=!1))}t._visible=!1}}function hP(e,t,n){var r,i;cP(e,t,n),t.updateExpiration(),t._wasMinPriorityChild=!1,t._priorityHolder=t,i=t,(r=e)._maximumPriority.distance=Math.max(i._priorityHolder._distanceToCamera,r._maximumPriority.distance),r._minimumPriority.distance=Math.min(i._priorityHolder._distanceToCamera,r._minimumPriority.distance),r._maximumPriority.depth=Math.max(i._depth,r._maximumPriority.depth),r._minimumPriority.depth=Math.min(i._depth,r._minimumPriority.depth),r._maximumPriority.foveatedFactor=Math.max(i._priorityHolder._foveatedFactor,r._maximumPriority.foveatedFactor),r._minimumPriority.foveatedFactor=Math.min(i._priorityHolder._foveatedFactor,r._minimumPriority.foveatedFactor),r._maximumPriority.reverseScreenSpaceError=Math.max(i._priorityReverseScreenSpaceError,r._maximumPriority.reverseScreenSpaceError),r._minimumPriority.reverseScreenSpaceError=Math.min(i._priorityReverseScreenSpaceError,r._minimumPriority.reverseScreenSpaceError),t._shouldSelect=!1,t._finalResolution=!0}function fP(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;var n,r=e.parent;Ze(r)&&(n=!dP(r)||r._requestedFrame===t.frameNumber,e._ancestorWithContent=n?r:r._ancestorWithContent,e._ancestorWithContentAvailable=r.contentAvailable?r:r._ancestorWithContentAvailable)}function pP(e){return e.hasEmptyContent||e.hasTilesetContent}function dP(e){return!pP(e)&&e.contentUnloaded}function mP(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}function _P(e,t,n,r){for(var i=t.refine===zE.REPLACE,o=t.children,a=o.length,s=0;s<a;++s)hP(e,o[s],r);o.sort(mP);var u,l,c=!iP(e)&&i&&!pP(t),h=!0,f=!1,p=-1,d=Number.MAX_VALUE;for(s=0;s<a;++s){JI(l=o[s])?(n.push(l),l._foveatedFactor<d&&(p=s,d=l._foveatedFactor),f=!0):(c||e.loadSiblings)&&(l._foveatedFactor<d&&(p=s,d=l._foveatedFactor),uP(e,l,r),sP(e,l,r)),c&&(u=!!l._inRequestVolume&&(pP(l)?vP(e,l,r):l.contentAvailable),h=h&&u)}if(f||(h=!1),-1!==p&&!iP(e)&&i){var m=o[p];m._wasMinPriorityChild=!0;var _=(t._wasMinPriorityChild||t===e.root)&&d<=t._priorityHolder._foveatedFactor?t._priorityHolder:t;for(_._foveatedFactor=Math.min(m._foveatedFactor,_._foveatedFactor),_._distanceToCamera=Math.min(m._distanceToCamera,_._distanceToCamera),s=0;s<a;++s)(l=o[s])._priorityHolder=_}return h}function gP(e,t){return 0!==t.children.length&&(t.hasTilesetContent?!t.contentExpired:t._screenSpaceError>e._maximumScreenSpaceError)}function yP(e,t,n,r,i){var o,a,s,u,l,c,h,f,p,d=$I.stack;for(d.push(t);0<d.length;){$I.stackMaximumLength=Math.max($I.stackMaximumLength,d.length);var m=d.pop();fP(m,i);var _=(f=m,p=n,!iP(h=e)||!h.immediatelyLoadDesiredLevelOfDetail&&(!Ze(f._ancestorWithContent)||(0===f._screenSpaceError?f.parent._screenSpaceError>p:f._screenSpaceError>p))),g=m.refine===zE.ADD,y=m.refine===zE.REPLACE,v=m.parent,x=!Ze(v)||v._refines,b=!1;gP(e,m)&&(b=_P(e,m,d,i)&&x);var E=!b&&x;pP(m)?(c=m,e._emptyTiles.push(c),uP(e,m,i),E&&aP(e,m,i)):g?(aP(e,m,i),uP(e,m,i)):y&&(_?(uP(e,m,i),E&&aP(e,m,i)):E?(aP(e,m,i),uP(e,m,i)):(s=e,l=(u=m)._ancestorWithContent,!s.immediatelyLoadDesiredLevelOfDetail&&(u._priorityProgressiveResolutionScreenSpaceErrorLeaf||Ze(l)&&u._screenSpaceError<l._screenSpaceError/s.skipScreenSpaceErrorFactor&&u._depth>l._depth+s.skipLevels)&&uP(e,m,i))),o=m,a=i,++e._statistics.visited,o._visitedFrame=a.frameNumber,sP(e,m,i),m._refines=b}if(Ze(e._cache))for(var T=e._cache._sentinel;Ze(T.next);)T=T.next}function vP(e,t,n){var r=!0,i=eP.stack;for(i.push(t);0<i.length;){eP.stackMaximumLength=Math.max(eP.stackMaximumLength,i.length);var o=i.pop(),a=o.children,s=a.length,u=pP(o)&&gP(e,o);if(u||o.contentAvailable||(r=!1),hP(e,o,n),JI(o)||(uP(e,o,n),sP(e,o,n)),u)for(var l=0;l<s;++l){var c=a[l];i.push(c)}}return r}function xP(e,t,n){var r=nP.stack,i=nP.ancestorStack;for(r.push(t);0<r.length||0<i.length;){if(nP.stackMaximumLength=Math.max(nP.stackMaximumLength,r.length),nP.ancestorStackMaximumLength=Math.max(nP.ancestorStackMaximumLength,i.length),0<i.length){var o=i.peek();if(o._stackLength===r.length){i.pop(),void 0!==o&&(o._finalResolution=!1),oP(e,o,n);continue}}var a=r.pop();if(Ze(a)){var s=a._shouldSelect,u=a.children,l=u.length,c=gP(e,a);if(s&&oP(e,a,n),c)for(var h=0;h<l;++h){var f=u[h];JI(f)&&r.push(f)}}}}ZI.selectTiles=function(e,t){if(e._requestedTiles.length=0,!e.debugFreezeFrame){e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e._hasMixedContent=!1;var n,r,i,o,a,s,u,l,c,h,f,p,d,m,_,g=e.root;if(hP(e,g,t),JI(g)&&!(g.getScreenSpaceError(t,!0)<=e._maximumScreenSpaceError)){iP(e)?e.immediatelyLoadDesiredLevelOfDetail?(s=e,u=g,l=t,c=Number.MAX_VALUE,h=s._maximumScreenSpaceError,yP(s,u,c,0,l),xP(s,u,l)):(n=e,r=g,i=t,o=Math.max(n.baseScreenSpaceError,n.maximumScreenSpaceError),a=n.maximumScreenSpaceError,yP(n,r,o,0,i),xP(n,r,i)):(p=g,d=t,m=(f=e)._maximumScreenSpaceError,_=f._maximumScreenSpaceError,yP(f,p,m,0,d)),$I.stack.trim($I.stackMaximumLength),eP.stack.trim(eP.stackMaximumLength),tP.stack.trim(tP.stackMaximumLength),nP.stack.trim(nP.stackMaximumLength),nP.ancestorStack.trim(nP.ancestorStackMaximumLength);for(var y=e._requestedTiles,v=y.length,x=0;x<v;++x)y[x].updatePriority()}}};var bP={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8},EP=new Array(bP.NUMBER_OF_PASSES);EP[bP.RENDER]=Object.freeze({traversal:ZI,isRender:!0,requestTiles:!0,ignoreCommands:!1}),EP[bP.PICK]=Object.freeze({traversal:ZI,isRender:!1,requestTiles:!1,ignoreCommands:!1}),EP[bP.SHADOW]=Object.freeze({traversal:ZI,isRender:!1,requestTiles:!0,ignoreCommands:!1}),EP[bP.PRELOAD]=Object.freeze({traversal:ZI,isRender:!1,requestTiles:!0,ignoreCommands:!0}),EP[bP.PRELOAD_FLIGHT]=Object.freeze({traversal:ZI,isRender:!1,requestTiles:!0,ignoreCommands:!0}),EP[bP.REQUEST_RENDER_MODE_DEFER_CHECK]=Object.freeze({traversal:ZI,isRender:!1,requestTiles:!0,ignoreCommands:!0}),EP[bP.MOST_DETAILED_PRELOAD]=Object.freeze({traversal:GI,isRender:!1,requestTiles:!0,ignoreCommands:!0}),EP[bP.MOST_DETAILED_PICK]=Object.freeze({traversal:GI,isRender:!1,requestTiles:!1,ignoreCommands:!1}),bP.getPassOptions=function(e){return EP[e]};var TP=Object.freeze(bP);function SP(e,t){this._tileset=e,this._tile=t,this.featurePropertiesDirty=!1}function CP(e,t,n){n=n||2;var r,i,o,a,s,u,l,c=t&&t.length,h=c?t[0]*n:e.length,f=wP(e,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(c&&(f=function(e,t,n,r){var i,o,a,s,u,l=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=wP(e,a,s,r,!1))===u.next&&(u.steiner=!0),l.push(FP(u));for(l.sort(RP),i=0;i<l.length;i++)DP(l[i],n),n=AP(n,n.next);return n}(e,t,f,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),o<s&&(o=s),a<u&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return IP(f,p,n,r,i,l),p}function wP(e,t,n,r,i){var o,a;if(i===0<jP(e,t,n,r))for(o=t;o<n;o+=r)a=WP(o,e[o],e[o+1],a);else for(o=n-r;t<=o;o-=r)a=WP(o,e[o],e[o+1],a);return a&&UP(a,a.next)&&(YP(a),a=a.next),a}function AP(e,t){if(!e)return e;t=t||e;var n,r=e;do{if(n=!1,r.steiner||!UP(r,r.next)&&0!==BP(r.prev,r,r.next))r=r.next;else{if(YP(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function IP(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;for(;null===i.z&&(i.z=MP(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,o=e=null,a=0;n;){for(a++,r=n,t=s=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;0<s||0<u&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(n=(i=n).nextZ,s--):(r=(i=r).nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(1<a)}(i)}(e,r,i,o);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?OP(e,r,i,o):PP(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),YP(e),e=u.next,l=u.next;else if((e=u)===l){a?1===a?IP(e=LP(AP(e),t,n),t,n,r,i,o,2):2===a&&NP(e,t,n,r,i,o):IP(AP(e),t,n,r,i,o,1);break}}}function PP(e){var t=e.prev,n=e,r=e.next;if(!(0<=BP(t,n,r))){for(var i=e.next.next;i!==e.prev;){if(zP(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=BP(i.prev,i,i.next))return;i=i.next}return 1}}function OP(e,t,n,r){var i=e.prev,o=e,a=e.next;if(!(0<=BP(i,o,a))){for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=MP(s,u,t,n,r),f=MP(l,c,t,n,r),p=e.prevZ,d=e.nextZ;p&&p.z>=h&&d&&d.z<=f;){if(p!==e.prev&&p!==e.next&&zP(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=BP(p.prev,p,p.next))return;if(p=p.prevZ,d!==e.prev&&d!==e.next&&zP(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=BP(d.prev,d,d.next))return;d=d.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&zP(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=BP(p.prev,p,p.next))return;p=p.prevZ}for(;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&zP(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=BP(d.prev,d,d.next))return;d=d.nextZ}return 1}}function LP(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!UP(i,o)&&VP(i,r,r.next,o)&&qP(i,o)&&qP(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),YP(r),YP(r.next),r=e=o),r=r.next}while(r!==e);return AP(r)}function NP(e,t,n,r,i,o){var a,s,u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&(s=l,(a=u).next.i!==s.i&&a.prev.i!==s.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&VP(n,n.next,e,t))return 1;n=n.next}while(n!==e);return}(a,s)&&(qP(a,s)&&qP(s,a)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(a,s)&&(BP(a.prev,a,s.prev)||BP(a,s.prev,s))||UP(a,s)&&0<BP(a.prev,a,a.next)&&0<BP(s.prev,s,s.next)))){var c=HP(u,l),u=AP(u,u.next),c=AP(c,c.next);return IP(u,t,n,r,i,o),void IP(c,t,n,r,i,o)}l=l.next}u=u.next}while(u!==e)}function RP(e,t){return e.x-t.x}function DP(e,t){var n;(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&a<s){if((a=s)===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,h=n.y,f=1/0;r=n;for(;i>=r.x&&r.x>=c&&i!==r.x&&zP(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),qP(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&(d=r,BP((p=n).prev,p,d.prev)<0&&BP(d.next,p,p.next)<0)))&&(n=r,f=u)),r=r.next,r!==l;);var p,d;return n}(e,t))&&AP(n=HP(t,e),n.next)}function MP(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function FP(e){for(var t=e,n=e;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),(t=t.next)!==e;);return n}function zP(e,t,n,r,i,o,a,s){return 0<=(i-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(r-s)-(n-a)*(t-s)&&0<=(n-a)*(o-s)-(i-a)*(r-s)}function BP(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function UP(e,t){return e.x===t.x&&e.y===t.y}function VP(e,t,n,r){var i=GP(BP(e,t,n)),o=GP(BP(e,t,r)),a=GP(BP(n,r,e)),s=GP(BP(n,r,t));return i!==o&&a!==s||(0===i&&kP(e,n,t)||(0===o&&kP(e,r,t)||(0===a&&kP(n,e,r)||!(0!==s||!kP(n,t,r)))))}function kP(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function GP(e){return 0<e?1:e<0?-1:0}function qP(e,t){return BP(e.prev,e,e.next)<0?0<=BP(e,t,e.next)&&0<=BP(e,e.prev,t):BP(e,t,e.prev)<0||BP(e,e.next,t)<0}function HP(e,t){var n=new XP(e.i,e.x,e.y),r=new XP(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(n.next=i).prev=n,(r.next=n).prev=r,(o.next=r).prev=o,r}function WP(e,t,n,r){var i=new XP(e,t,n);return r?(i.next=r.next,(i.prev=r).next.prev=i,r.next=i):(i.prev=i).next=i,i}function YP(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function XP(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jP(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}Object.defineProperties(SP.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},batchTable:{get:function(){}}}),SP.prototype.hasProperty=function(e,t){return!1},SP.prototype.getFeature=function(e){},SP.prototype.applyDebugSettings=function(e,t){},SP.prototype.applyStyle=function(e){},SP.prototype.update=function(e,t){},SP.prototype.isDestroyed=function(){return!1},SP.prototype.destroy=function(){return Vt(this)},CP.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(jP(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(jP(e,l,c,n))}for(var h=0,s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[f]-e[d])*(e[1+p]-e[1+f])-(e[f]-e[p])*(e[1+d]-e[1+f]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},CP.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);0<i&&(r+=e[i-1].length,n.holes.push(r))}return n};var KP=new _t,QP=new _t,ZP={computeArea2D:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++){var o=e[r],a=e[i];n+=o.x*a.y-a.x*o.y}return.5*n},computeWindingOrder2D:function(e){return 0<ZP.computeArea2D(e)?ar.COUNTER_CLOCKWISE:ar.CLOCKWISE},triangulate:function(e,t){return CP(En.packArray(e),t,2)}},JP=new _t,$P=new _t,eO=new _t,tO=new _t,nO=new _t,rO=new _t,iO=new _t;ZP.computeSubdivision=function(e,t,n,r){r=Je(r,pt.RADIANS_PER_DEGREE);for(var i=n.slice(0),o=t.length,a=new Array(3*o),s=0,u=0;u<o;u++){var l=t[u];a[s++]=l.x,a[s++]=l.y,a[s++]=l.z}for(var c=[],h={},f=e.maximumRadius,p=pt.chordLength(r,f),d=p*p;0<i.length;){var m,_,g=i.pop(),y=i.pop(),v=i.pop(),x=_t.fromArray(a,3*v,JP),b=_t.fromArray(a,3*y,$P),E=_t.fromArray(a,3*g,eO),T=_t.multiplyByScalar(_t.normalize(x,tO),f,tO),S=_t.multiplyByScalar(_t.normalize(b,nO),f,nO),C=_t.multiplyByScalar(_t.normalize(E,rO),f,rO),w=_t.magnitudeSquared(_t.subtract(T,S,iO)),A=_t.magnitudeSquared(_t.subtract(S,C,iO)),I=_t.magnitudeSquared(_t.subtract(C,T,iO)),P=Math.max(w,A,I);d<P?w===P?(Ze(u=h[m=Math.min(v,y)+" "+Math.max(v,y)])||(_=_t.add(x,b,iO),_t.multiplyByScalar(_,.5,_),a.push(_.x,_.y,_.z),u=a.length/3-1,h[m]=u),i.push(v,u,g),i.push(u,y,g)):A===P?(Ze(u=h[m=Math.min(y,g)+" "+Math.max(y,g)])||(_=_t.add(b,E,iO),_t.multiplyByScalar(_,.5,_),a.push(_.x,_.y,_.z),u=a.length/3-1,h[m]=u),i.push(y,u,v),i.push(u,g,v)):I===P&&(Ze(u=h[m=Math.min(g,v)+" "+Math.max(g,v)])||(_=_t.add(E,x,iO),_t.multiplyByScalar(_,.5,_),a.push(_.x,_.y,_.z),u=a.length/3-1,h[m]=u),i.push(g,u,y),i.push(u,v,y)):(c.push(v),c.push(y),c.push(g))}return new dc({attributes:{position:new Rd({componentDatatype:Mt.DOUBLE,componentsPerAttribute:3,values:a})},indices:c,primitiveType:Dn.TRIANGLES})};var oO=new Un,aO=new Un,sO=new Un,uO=new Un;ZP.computeRhumbLineSubdivision=function(e,t,n,r){r=Je(r,pt.RADIANS_PER_DEGREE);for(var i=n.slice(0),o=t.length,a=new Array(3*o),s=0,u=0;u<o;u++){var l=t[u];a[s++]=l.x,a[s++]=l.y,a[s++]=l.z}for(var c=[],h={},f=e.maximumRadius,p=pt.chordLength(r,f),d=new kw(void 0,void 0,e),m=new kw(void 0,void 0,e),_=new kw(void 0,void 0,e);0<i.length;){var g=i.pop(),y=i.pop(),v=i.pop(),x=_t.fromArray(a,3*v,JP),b=_t.fromArray(a,3*y,$P),E=_t.fromArray(a,3*g,eO),T=e.cartesianToCartographic(x,oO),S=e.cartesianToCartographic(b,aO),C=e.cartesianToCartographic(E,sO);d.setEndPoints(T,S);var w=d.surfaceDistance;m.setEndPoints(S,C);var A=m.surfaceDistance;_.setEndPoints(C,T);var I,P,O,L,N=_.surfaceDistance,R=Math.max(w,A,N);p<R?w===R?(Ze(u=h[I=Math.min(v,y)+" "+Math.max(v,y)])||(P=d.interpolateUsingFraction(.5,uO),O=.5*(T.height+S.height),L=_t.fromRadians(P.longitude,P.latitude,O,e,iO),a.push(L.x,L.y,L.z),u=a.length/3-1,h[I]=u),i.push(v,u,g),i.push(u,y,g)):A===R?(Ze(u=h[I=Math.min(y,g)+" "+Math.max(y,g)])||(P=m.interpolateUsingFraction(.5,uO),O=.5*(S.height+C.height),L=_t.fromRadians(P.longitude,P.latitude,O,e,iO),a.push(L.x,L.y,L.z),u=a.length/3-1,h[I]=u),i.push(y,u,v),i.push(u,g,v)):N===R&&(Ze(u=h[I=Math.min(g,v)+" "+Math.max(g,v)])||(P=_.interpolateUsingFraction(.5,uO),O=.5*(C.height+T.height),L=_t.fromRadians(P.longitude,P.latitude,O,e,iO),a.push(L.x,L.y,L.z),u=a.length/3-1,h[I]=u),i.push(g,u,y),i.push(u,v,y)):(c.push(v),c.push(y),c.push(g))}return new dc({attributes:{position:new Rd({componentDatatype:Mt.DOUBLE,componentsPerAttribute:3,values:a})},indices:c,primitiveType:Dn.TRIANGLES})},ZP.scaleToGeodeticHeight=function(e,t,n,r){n=Je(n,Wn.WGS84);var i=KP,o=QP;if(t=Je(t,0),r=Je(r,!0),Ze(e))for(var a=e.length,s=0;s<a;s+=3)_t.fromArray(e,s,o),r&&(o=n.scaleToGeodeticSurface(o,o)),0!==t&&(i=n.geodeticSurfaceNormal(o,i),_t.multiplyByScalar(i,t,i),_t.add(o,i,o)),e[s]=o.x,e[s+1]=o.y,e[s+2]=o.z;return e};var lO=Math.cos,cO=Math.sin,hO=Math.sqrt,fO={computePosition:function(e,t,n,r,i,o,a){var s,u=t.radiiSquared,l=e.nwCorner,c=e.boundingRectangle,h=l.latitude-e.granYCos*r+i*e.granXSin,f=lO(h),p=cO(h),d=u.z*p,m=l.longitude+r*e.granYSin+i*e.granXCos,_=f*lO(m),g=f*cO(m),y=u.x*_,v=u.y*g,x=hO(y*_+v*g+d*p);o.x=y/x,o.y=v/x,o.z=d/x,n&&(Ze(s=e.stNwCorner)?(h=s.latitude-e.stGranYCos*r+i*e.stGranXSin,m=s.longitude+r*e.stGranYSin+i*e.stGranXCos,a.x=(m-e.stWest)*e.lonScalar,a.y=(h-e.stSouth)*e.latScalar):(a.x=(m-c.west)*e.lonScalar,a.y=(h-c.south)*e.latScalar))}},pO=new fi,dO=new _t,mO=new Un,_O=new _t,gO=new Zn;function yO(e,t,n,r,i,o,a){var s=Math.cos(t),u=r*s,l=n*s,c=Math.sin(t),h=r*c,f=n*c;dO=gO.project(e,dO),dO=_t.subtract(dO,_O,dO);var p=fi.fromRotation(t,pO);dO=fi.multiplyByVector(p,dO,dO),dO=_t.add(dO,_O,dO),--o,--a;var d=(e=gO.unproject(dO,e)).latitude,m=d+o*f,_=d-u*a,g=d-u*a+o*f,y=Math.max(d,m,_,g),v=Math.min(d,m,_,g),x=e.longitude,b=x+o*l,E=x+a*h,T=x+a*h+o*l;return{north:y,south:v,east:Math.max(x,b,E,T),west:Math.min(x,b,E,T),granYCos:u,granYSin:h,granXCos:l,granXSin:f,nwCorner:e}}fO.computeOptions=function(e,t,n,r,i,o,a){var s=e.east,u=e.west,l=e.north,c=e.south,h=!1,f=!1;l===pt.PI_OVER_TWO&&(h=!0),c===-pt.PI_OVER_TWO&&(f=!0);var p,d,m,_=l-c,g=(p=s<u?pt.TWO_PI-u+s:s-u)/((d=Math.ceil(p/t)+1)-1),y=_/((m=Math.ceil(_/t)+1)-1),v=$n.northwest(e,o),x=$n.center(e,mO);0===n&&0===r||(x.longitude<v.longitude&&(x.longitude+=pt.TWO_PI),_O=gO.project(x,_O));var b,E,T,S=y,C=g,w=$n.clone(e,i),A={granYCos:S,granYSin:0,granXCos:C,granXSin:0,nwCorner:v,boundingRectangle:w,width:d,height:m,northCap:h,southCap:f};return 0!==n&&(l=(b=yO(v,n,g,y,0,d,m)).north,c=b.south,s=b.east,u=b.west,A.granYCos=b.granYCos,A.granYSin=b.granYSin,A.granXCos=b.granXCos,A.granXSin=b.granXSin,w.north=l,w.south=c,w.east=s,w.west=u),0!==r&&(n-=r,T=yO(E=$n.northwest(w,a),n,g,y,0,d,m),A.stGranYCos=T.granYCos,A.stGranXCos=T.granXCos,A.stGranYSin=T.granYSin,A.stGranXSin=T.granXSin,A.stNwCorner=E,A.stWest=T.west,A.stSouth=T.south),A};var vO=new ko,xO=new ko,bO=new _t,EO=new $n;function TO(e,t){var n=e._ellipsoid,r=t.height,i=t.width,o=t.northCap,a=t.southCap,s=r,u=2,l=0,c=4;o&&(--u,--s,l+=1,c-=2),a&&(--u,--s,l+=1,c-=2),l+=u*i+2*s-c;var h,f=new Float64Array(3*l),p=0,d=0,m=bO;if(o)fO.computePosition(t,n,!1,d,0,m),f[p++]=m.x,f[p++]=m.y,f[p++]=m.z;else for(h=0;h<i;h++)fO.computePosition(t,n,!1,d,h,m),f[p++]=m.x,f[p++]=m.y,f[p++]=m.z;for(h=i-1,d=1;d<r;d++)fO.computePosition(t,n,!1,d,h,m),f[p++]=m.x,f[p++]=m.y,f[p++]=m.z;if(d=r-1,!a)for(h=i-2;0<=h;h--)fO.computePosition(t,n,!1,d,h,m),f[p++]=m.x,f[p++]=m.y,f[p++]=m.z;for(h=0,d=r-2;0<d;d--)fO.computePosition(t,n,!1,d,h,m),f[p++]=m.x,f[p++]=m.y,f[p++]=m.z;for(var _=f.length/3*2,g=wa.createTypedArray(f.length/3,_),y=0,v=0;v<f.length/3-1;v++)g[y++]=v,g[y++]=v+1;g[y++]=f.length/3-1,g[y++]=0;var x=new dc({attributes:new Dd,primitiveType:Dn.LINES});return x.attributes.position=new Rd({componentDatatype:Mt.DOUBLE,componentsPerAttribute:3,values:f}),x.indices=g,x}function SO(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).rectangle,n=Je(e.granularity,pt.RADIANS_PER_DEGREE),r=Je(e.ellipsoid,Wn.WGS84),i=Je(e.rotation,0),o=Je(e.height,0),a=Je(e.extrudedHeight,o);this._rectangle=$n.clone(t),this._granularity=n,this._ellipsoid=r,this._surfaceHeight=Math.max(o,a),this._rotation=i,this._extrudedHeight=Math.min(o,a),this._offsetAttribute=e.offsetAttribute,this._workerName="createRectangleOutlineGeometry"}SO.packedLength=$n.packedLength+Wn.packedLength+5,SO.pack=function(e,t,n){return n=Je(n,0),$n.pack(e._rectangle,t,n),n+=$n.packedLength,Wn.pack(e._ellipsoid,t,n),n+=Wn.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._extrudedHeight,t[n]=Je(e._offsetAttribute,-1),t};var CO=new $n,wO=Wn.clone(Wn.UNIT_SPHERE),AO={rectangle:CO,ellipsoid:wO,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};SO.unpack=function(e,t,n){t=Je(t,0);var r=$n.unpack(e,t,CO),i=Wn.unpack(e,t+=$n.packedLength,wO);t+=Wn.packedLength;var o=e[t++],a=e[t++],s=e[t++],u=e[t++],l=e[t];return Ze(n)?(n._rectangle=$n.clone(r,n._rectangle),n._ellipsoid=Wn.clone(i,n._ellipsoid),n._surfaceHeight=a,n._rotation=s,n._extrudedHeight=u,n._offsetAttribute=-1===l?void 0:l,n):(AO.granularity=o,AO.height=a,AO.rotation=s,AO.extrudedHeight=u,AO.offsetAttribute=-1===l?void 0:l,new SO(AO))};var IO=new Un;function PO(e){this.rectangle=$n.clone(e.rectangle),this.minimumHeight=Je(e.minimumHeight,0),this.maximumHeight=Je(e.maximumHeight,0),this.southwestCornerCartesian=new _t,this.northeastCornerCartesian=new _t,this.westNormal=new _t,this.southNormal=new _t,this.eastNormal=new _t,this.northNormal=new _t;var t=Je(e.ellipsoid,Wn.WGS84);!function(e,t,n){n.cartographicToCartesian($n.southwest(t),e.southwestCornerCartesian),n.cartographicToCartesian($n.northeast(t),e.northeastCornerCartesian),FO.longitude=t.west,FO.latitude=.5*(t.south+t.north),FO.height=0;var r=n.cartographicToCartesian(FO,DO),i=_t.cross(r,_t.UNIT_Z,OO);_t.normalize(i,e.westNormal),FO.longitude=t.east;var o=n.cartographicToCartesian(FO,MO),a=_t.cross(_t.UNIT_Z,o,OO);_t.normalize(a,e.eastNormal);var s,u=_t.subtract(r,o,OO),l=_t.normalize(u,RO),c=t.south;{var h,f;s=0<c?(FO.longitude=.5*(t.west+t.east),FO.latitude=c,h=n.cartographicToCartesian(FO,BO.origin),_t.clone(l,BO.direction),f=Zf.fromPointNormal(e.southwestCornerCartesian,e.westNormal,zO),vm.rayPlane(BO,f,e.southwestCornerCartesian),n.geodeticSurfaceNormal(h,LO)):n.geodeticSurfaceNormalCartographic($n.southeast(t),LO)}var p=_t.cross(s,u,NO);_t.normalize(p,e.southNormal);var d,m=t.north;{var _,g;d=m<0?(FO.longitude=.5*(t.west+t.east),FO.latitude=m,_=n.cartographicToCartesian(FO,BO.origin),_t.negate(l,BO.direction),g=Zf.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,zO),vm.rayPlane(BO,g,e.northeastCornerCartesian),n.geodeticSurfaceNormal(_,LO)):n.geodeticSurfaceNormalCartographic($n.northwest(t),LO)}var y=_t.cross(u,d,NO);_t.normalize(y,e.northNormal)}(this,e.rectangle,t),Je(e.computeBoundingVolumes,!0)&&(this._orientedBoundingBox=ab.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,t),this._boundingSphere=ko.fromOrientedBoundingBox(this._orientedBoundingBox))}SO.createGeometry=function(e){var t=e._rectangle,n=e._ellipsoid,r=fO.computeOptions(t,e._granularity,e._rotation,0,EO,IO);if(!pt.equalsEpsilon(t.north,t.south,pt.EPSILON10)&&!pt.equalsEpsilon(t.east,t.west,pt.EPSILON10)){var i,o,a,s,u,l,c,h,f=e._surfaceHeight,p=e._extrudedHeight;return l=!pt.equalsEpsilon(f,p,0,pt.EPSILON2)?(a=function(e,t){var n=e._surfaceHeight,r=e._extrudedHeight,i=e._ellipsoid,o=r,a=n,s=TO(e,t),u=t.height,l=t.width,c=ZP.scaleToGeodeticHeight(s.attributes.position.values,a,i,!1),h=c.length,f=new Float64Array(2*h);f.set(c);var p=ZP.scaleToGeodeticHeight(s.attributes.position.values,o,i);f.set(p,h),s.attributes.position.values=f;var d=t.northCap,m=t.southCap,_=4;d&&--_,m&&--_;for(var g,y,v,x=2*(f.length/3+_),b=wa.createTypedArray(f.length/3,x),h=f.length/6,E=0,T=0;T<h-1;T++)b[E++]=T,b[E++]=T+1,b[E++]=T+h,b[E++]=T+h+1;return b[E++]=h-1,b[E++]=0,b[E++]=h+h-1,b[E++]=h,b[E++]=0,b[E++]=h,g=d?u-1:(y=l-1,b[E++]=y,b[E++]=y+h,l+u-2),b[E++]=g,b[E++]=g+h,m||(v=l+g-1,b[E++]=v,b[E]=v+h),s.indices=b,s}(e,r),Ze(e._offsetAttribute)&&(i=a.attributes.position.values.length/3,o=new Uint8Array(i),o=e._offsetAttribute===Md.TOP?bn(o,1,0,i/2):bn(o,e._offsetAttribute===Md.NONE?0:1),a.attributes.applyOffset=new Rd({componentDatatype:Mt.UNSIGNED_BYTE,componentsPerAttribute:1,values:o})),s=ko.fromRectangle3D(t,n,f,xO),u=ko.fromRectangle3D(t,n,p,vO),ko.union(s,u)):((a=TO(e,r)).attributes.position.values=ZP.scaleToGeodeticHeight(a.attributes.position.values,f,n,!1),Ze(e._offsetAttribute)&&(c=a.attributes.position.values.length,bn(h=new Uint8Array(c/3),e._offsetAttribute===Md.NONE?0:1),a.attributes.applyOffset=new Rd({componentDatatype:Mt.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})),ko.fromRectangle3D(t,n,f)),new dc({attributes:a.attributes,indices:a.indices,primitiveType:Dn.LINES,boundingSphere:l,offsetAttribute:e._offsetAttribute})}},Object.defineProperties(PO.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});var OO=new _t,LO=new _t,NO=new _t,RO=new _t,DO=new _t,MO=new _t,FO=new Un,zO=new Zf(_t.UNIT_X,0),BO=new ym;var UO=new _t,VO=new _t,kO=new _t(0,-1,0),GO=new _t(0,0,-1),qO=new _t;PO.prototype.distanceToCamera=function(e){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m,_,g,y=e.camera,v=y.positionWC,x=y.positionCartographic,b=0;return $n.contains(this.rectangle,x)||(t=this.southwestCornerCartesian,n=this.northeastCornerCartesian,r=this.westNormal,i=this.southNormal,o=this.eastNormal,a=this.northNormal,e.mode!==Tl.SCENE3D&&((t=e.mapProjection.project($n.southwest(this.rectangle),UO)).z=t.y,t.y=t.x,t.x=0,(n=e.mapProjection.project($n.northeast(this.rectangle),VO)).z=n.y,n.y=n.x,n.x=0,r=kO,o=_t.UNIT_Y,i=GO,a=_t.UNIT_Z),s=_t.subtract(v,t,qO),u=_t.dot(s,r),l=_t.dot(s,i),c=_t.subtract(v,n,qO),h=_t.dot(c,o),f=_t.dot(c,a),0<u?b+=u*u:0<h&&(b+=h*h),0<l?b+=l*l:0<f&&(b+=f*f)),(m=e.mode===Tl.SCENE3D?(p=x.height,d=this.minimumHeight,this.maximumHeight):(p=v.x,d=0))<p?b+=(_=p-m)*_:p<d&&(b+=(g=d-p)*g),Math.sqrt(b)},PO.prototype.intersectPlane=function(e){return this._orientedBoundingBox.intersectPlane(e)},PO.prototype.createDebugVolume=function(e){var t=new on.clone(on.IDENTITY);return new bg({geometryInstances:new Nd({geometry:new SO({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight}),id:"outline",modelMatrix:t,attributes:{color:Ld.fromColor(e)}}),appearance:new Jd({translucent:!1,flat:!0}),asynchronous:!1})};var HO=new _t;function WO(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).minimum,n=e.maximum;this._min=_t.clone(t),this._max=_t.clone(n),this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxOutlineGeometry"}WO.fromDimensions=function(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).dimensions,n=_t.multiplyByScalar(t,.5,new _t);return new WO({minimum:_t.negate(n,new _t),maximum:n,offsetAttribute:e.offsetAttribute})},WO.fromAxisAlignedBoundingBox=function(e){return new WO({minimum:e.minimum,maximum:e.maximum})},WO.packedLength=2*_t.packedLength+1,WO.pack=function(e,t,n){return n=Je(n,0),_t.pack(e._min,t,n),_t.pack(e._max,t,n+_t.packedLength),t[n+2*_t.packedLength]=Je(e._offsetAttribute,-1),t};var YO=new _t,XO=new _t,jO={minimum:YO,maximum:XO,offsetAttribute:void 0};WO.unpack=function(e,t,n){t=Je(t,0);var r=_t.unpack(e,t,YO),i=_t.unpack(e,t+_t.packedLength,XO),o=e[t+2*_t.packedLength];return Ze(n)?(n._min=_t.clone(r,n._min),n._max=_t.clone(i,n._max),n._offsetAttribute=-1===o?void 0:o,n):(jO.offsetAttribute=-1===o?void 0:o,new WO(jO))},WO.createGeometry=function(e){var t=e._min,n=e._max;if(!_t.equals(t,n)){var r=new Dd,i=new Uint16Array(24),o=new Float64Array(24);o[0]=t.x,o[1]=t.y,o[2]=t.z,o[3]=n.x,o[4]=t.y,o[5]=t.z,o[6]=n.x,o[7]=n.y,o[8]=t.z,o[9]=t.x,o[10]=n.y,o[11]=t.z,o[12]=t.x,o[13]=t.y,o[14]=n.z,o[15]=n.x,o[16]=t.y,o[17]=n.z,o[18]=n.x,o[19]=n.y,o[20]=n.z,o[21]=t.x,o[22]=n.y,o[23]=n.z,r.position=new Rd({componentDatatype:Mt.DOUBLE,componentsPerAttribute:3,values:o}),i[0]=4,i[1]=5,i[2]=5,i[3]=6,i[4]=6,i[5]=7,i[6]=7,i[7]=4,i[8]=0,i[9]=1,i[10]=1,i[11]=2,i[12]=2,i[13]=3,i[14]=3,i[15]=0,i[16]=0,i[17]=4,i[18]=1,i[19]=5,i[20]=2,i[21]=6,i[22]=3,i[23]=7;var a,s,u=_t.subtract(n,t,HO),l=.5*_t.magnitude(u);return Ze(e._offsetAttribute)&&(a=o.length,bn(s=new Uint8Array(a/3),e._offsetAttribute===Md.NONE?0:1),r.applyOffset=new Rd({componentDatatype:Mt.UNSIGNED_BYTE,componentsPerAttribute:1,values:s})),new dc({attributes:r,indices:i,primitiveType:Dn.LINES,boundingSphere:new ko(_t.ZERO,l),offsetAttribute:e._offsetAttribute})}};var KO=new _t,QO=new _t,ZO=new _t,JO=new _t;function $O(e,t,n){n=_t.cross(e,t,n);var r=_t.magnitude(n);return _t.multiplyByScalar(n,pt.EPSILON7/r,n)}function eL(e,t){var n=_t.normalize(e,JO);return $O(e,_t.equalsEpsilon(n,_t.UNIT_X,pt.EPSILON6)?_t.UNIT_Y:_t.UNIT_X,t)}function tL(e){var t=jt.getColumn(e,0,KO),n=jt.getColumn(e,1,QO),r=jt.getColumn(e,2,ZO),i=_t.equals(t,_t.ZERO),o=_t.equals(n,_t.ZERO),a=_t.equals(r,_t.ZERO);return(i||o||a)&&(i&&o&&a?(e[0]=pt.EPSILON7,e[4]=pt.EPSILON7,e[8]=pt.EPSILON7):(!i||o||a?i||!o||a?i||o||!a?i?o?a||(n=$O(r,t=eL(r,t),n)):r=$O(n,t=eL(n,t),r):r=$O(n=eL(t,n),t,r):r=$O(n,t,r):n=$O(t,r,n):t=$O(n,r,t),jt.setColumn(e,0,t,e),jt.setColumn(e,1,n,e),jt.setColumn(e,2,r,e))),e}function nL(e,t){t=tL(t),this._orientedBoundingBox=new ab(e,t),this._boundingSphere=ko.fromOrientedBoundingBox(this._orientedBoundingBox)}function rL(e,t,n,r){this._tileset=e;var i,o,a,s,u,l,c,h=(this._header=n).content;Ze(n.transform)&&Ze(e.headingPitchRoll)&&(i=_t.fromRadians(e.position.longitude,e.position.latitude,e.position.height),o=bs.headingPitchRollQuaternion(i,e.headingPitchRoll),a=on.unpack(n.transform),s=on.getScale(a,new _t),u=on.fromTranslationQuaternionRotationScale(i,o,s),l=on.inverse(a,new on),c=on.multiply(u,l,new on),e.modelMatrix=c),this.transform=Ze(n.transform)?on.unpack(n.transform):on.clone(on.IDENTITY);var f,p,d,m,_,g,y,v,x,b=Ze(r)?r.computedTransform:e.modelMatrix,E=on.multiply(b,this.transform,new on),T=Ze(r)?r._initialTransform:on.IDENTITY;this._initialTransform=on.multiply(T,this.transform,new on),this.computedTransform=E,this._boundingVolume=this.createBoundingVolume(n.boundingVolume,E),Ze(e.headingPitchRoll)&&b.equals(on.IDENTITY)&&(this._boundingVolume._boundingSphere.center=_t.fromRadians(e.position.longitude,e.position.latitude,e.position.height)),this._boundingVolume2D=void 0,Ze(h)&&Ze(h.boundingVolume)&&(f=this.createBoundingVolume(h.boundingVolume,E)),this._contentBoundingVolume=f,this._contentBoundingVolume2D=void 0,Ze(n.viewerRequestVolume)&&(p=this.createBoundingVolume(n.viewerRequestVolume,E)),this._viewerRequestVolume=p,this.geometricError=n.geometricError,this._geometricError=n.geometricError,Ze(this._geometricError)||(this._geometricError=Ze(r)?r.geometricError:e._geometricError,rL._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead.")),this.updateGeometricErrorScale(),this.geometricError*=this._tileset._geoErrorRatio,this._geometricError*=this._tileset._geoErrorRatio,d=Ze(n.refine)?("replace"!==n.refine&&"add"!==n.refine||rL._deprecationWarning("lowercase-refine",'This tile uses a lowercase refine "'+n.refine+'". Instead use "'+n.refine.toUpperCase()+'".'),"REPLACE"===n.refine.toUpperCase()?zE.REPLACE:zE.ADD):Ze(r)?r.refine:zE.REPLACE,this.refine=d,this.children=[],this.parent=r,t=rt.createIfNeeded(t),Ze(h)?(x=h.uri,Ze(h.url)&&(rL._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),x=h.url),_=!1,g=UI.UNLOADED,y=t.getDerivedResource({url:x,queryParameters:t.queryParameters}),v=Q.getServerKey(y.getUrlComponent())):(m=new SP(e,this),_=!0,g=UI.READY),this._content=m,this._contentResource=y,this._contentState=g,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this._expiredContent=void 0,this._serverKey=v,this.hasEmptyContent=_,this.hasTilesetContent=!1,this.cacheNode=void 0;var S,C,w=n.expire;Ze(w)&&(S=w.duration,Ze(w.date)&&(C=Ja.fromIso8601(w.date))),this.expireDuration=S,this.expireDate=C,this.lastStyleTime=0,this._optimChildrenWithinParent=VI.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.priorityDeferred=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._clippingPlanesState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=It.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,(this._priorityHolder=this)._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new Ja,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0,this._labels=void 0,this.destroySubtreeFunction=void 0,Ze(this.parent)&&Ze(this.parent.sharedResources)&&(this.sharedResources={treeTables:Ze(this.parent.sharedResources.treeTables)?{name:this.parent.sharedResources.treeTables.name,shadredData:this.parent.sharedResources.treeTables.shadredData}:{},instancedPrograms:{name:this.parent.sharedResources.instancedPrograms.name,shadredData:this.parent.sharedResources.instancedPrograms.shadredData},ktxs:this.parent.sharedResources.ktxs}),Ze(this._header)&&Ze(this._header.modeltree)&&function(t,e){var n=e.substr(e.lastIndexOf("/")+1),r=t._contentResource._url.substr(t._contentResource._url.lastIndexOf("/")+1),i=t._contentResource._url.split(r);{var o;e=i[0]+n,Ze(t._contentResource._queryParameters.role_key)&&(o="?role_key="+t._contentResource._queryParameters.role_key,e+=o)}rt.fetchJson(ms(e)).then(function(e){!function e(t){var n=t.children;{if(!Ze(n))return;for(var r=n.length,i=0;i<r;i++)n[i].parentId=t.id,Ze(n[i].children)&&e(n[i])}}(e),t._tileset.sharedResources.treeTables[t._header.modeltree.uri]=e,t._tileset.tramsformTreeTableMap(e)})}(this,this._header.modeltree.uri)}Object.defineProperties(nL.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}}),nL.prototype.distanceToCamera=function(e){return Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC))},nL.prototype.intersectPlane=function(e){return this._orientedBoundingBox.intersectPlane(e)},nL.prototype.update=function(e,t){_t.clone(e,this._orientedBoundingBox.center),t=tL(t),jt.clone(t,this._orientedBoundingBox.halfAxes),ko.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)},nL.prototype.createDebugVolume=function(e){return new bg({geometryInstances:new Nd({geometry:new WO({minimum:new _t(-1,-1,-1),maximum:new _t(1,1,1)}),id:"outline",modelMatrix:on.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center),attributes:{color:Ld.fromColor(e)}}),appearance:new Jd({translucent:!1,flat:!0}),asynchronous:!1})},rL._deprecationWarning=Bt,Object.defineProperties(rL.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return Je(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},extras:{get:function(){return this._header.extras}},color:{get:function(){return Ze(this._color)||(this._color=new It),It.clone(this._color)},set:function(e){this._color=It.clone(e,this._color),this._colorDirty=!0}},contentAvailable:{get:function(){return this.contentReady&&!this.hasEmptyContent&&!this.hasTilesetContent||Ze(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===UI.READY}},contentUnloaded:{get:function(){return this._contentState===UI.UNLOADED}},contentExpired:{get:function(){return this._contentState===UI.EXPIRED}},contentFailed:{get:function(){return this._contentState===UI.FAILED}},contentReadyToProcessPromise:{get:function(){if(Ze(this._contentReadyToProcessPromise))return this._contentReadyToProcessPromise.promise}},contentReadyPromise:{get:function(){if(Ze(this._contentReadyPromise))return this._contentReadyPromise.promise}},commandsLength:{get:function(){return this._commandsLength}}});var iL=new _t;var oL=new Ja;rL.prototype.getScreenSpaceError=function(e,t,n){var r=this._tileset,i=Je(n,1),o=Ze(this.parent)?this.parent.geometricError:r._geometricError,a=t?o:this.geometricError;if(0===a)return 0;var s=e.camera,u=s.frustum,l=e.context,c=l.drawingBufferWidth,h=l.drawingBufferHeight*i;if(e.mode===Tl.SCENE2D||u instanceof rE){Ze(u._offCenterFrustum)&&(u=u._offCenterFrustum);var f=a/(Math.max(u.top-u.bottom,u.right-u.left)/Math.max(c,h))}else{var p,d,m,_=Math.max(this._distanceToCamera,pt.EPSILON7);if(1===this._depth&&Ze(r._maxHeight)&&Ze(r._minHeight)&&Ze(r._distanceLimit)){h=e.camera.positionCartographic.height;return r._maxHeight>=h&&r._minHeight<=h&&r._distance>=_&&r._distanceLimit<=_?r._maximumScreenSpaceError+1:0}Ze(r._distance)?f=r._distance>=_?r._maximumScreenSpaceError*e.pixelRatio+1:0:(f=a*h/(_*s.frustum.sseDenominator),r.reduceRequest&&0<s._positionCartographic.height&&(f*=p=1<(p=s._positionCartographic.height/_)?1:p),r.dynamicScreenSpaceError&&(d=r._dynamicScreenSpaceErrorComputedDensity,m=r.dynamicScreenSpaceErrorFactor,f-=pt.fog(_,d)*m))}return f/=e.pixelRatio},rL.prototype.updateVisibility=function(e){var t,n,r,i,o=this.parent,a=this._tileset,s=Ze(o)?o.computedTransform:a.modelMatrix,u=Ze(o)?o._visibilityPlaneMask:Xx.MASK_INDETERMINATE;this.updateTransform(s),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,a.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,u),this._visible=this._visibilityPlaneMask!==Xx.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=(t=a,r=(n=this).parent,i=Ze(r)&&(!t._skipLevelOfDetail||0===n._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:n._screenSpaceError,t.root._screenSpaceError-i),this._priorityProgressiveResolution=function(e,t){if(e.progressiveResolutionHeightFraction<=0||.5<e.progressiveResolutionHeightFraction)return!1;var n=t._screenSpaceErrorProgressiveResolution>e._maximumScreenSpaceError;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;var r=t.parent,i=e._maximumScreenSpaceError,o=t._screenSpaceErrorProgressiveResolution<=i,a=Ze(r)&&r._screenSpaceErrorProgressiveResolution>i;return o&&a&&(n=t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0),n}(a,this),this.priorityDeferred=function(e,t){var n,r,i,o,a,s=e._tileset,u=t.camera,l=e.boundingSphere,c=l.radius,h=_t.multiplyByScalar(u.directionWC,e._centerZDepth,iL),f=_t.add(u.positionWC,h,iL),p=_t.subtract(f,l.center,iL);c<_t.magnitude(p)?(n=_t.normalize(p,iL),r=_t.multiplyByScalar(n,c,iL),i=_t.add(l.center,r,iL),o=_t.subtract(i,u.positionWC,iL),a=_t.normalize(o,iL),e._foveatedFactor=1-Math.abs(_t.dot(u.directionWC,a))):e._foveatedFactor=0;var d=e.refine===zE.REPLACE,m=s._skipLevelOfDetail;if(d&&!m||!s.foveatedScreenSpaceError||1===s.foveatedConeSize||e._priorityProgressiveResolution&&d&&m||s._pass===TP.PRELOAD_FLIGHT||s._pass===TP.PRELOAD)return!1;var _=1-Math.cos(.5*u.frustum.fov),g=s.foveatedConeSize*_;if(e._foveatedFactor<=g)return!1;var y=_-g,v=pt.clamp((e._foveatedFactor-g)/y,0,1),x=s.foveatedInterpolationCallback(s.foveatedMinimumScreenSpaceErrorRelaxation,s.maximumScreenSpaceError,v),b=0===e._screenSpaceError&&Ze(e.parent)?.5*e.parent._screenSpaceError:e._screenSpaceError;return s.maximumScreenSpaceError-x<=b}(this,e)},rL.prototype.updateExpiration=function(){var e;Ze(this.expireDate)&&this.contentReady&&!this.hasEmptyContent&&(e=Ja.now(oL),Ja.lessThan(this.expireDate,e)&&(this._contentState=UI.EXPIRED,this._expiredContent=this._content))},rL.prototype.requestContent=function(){var i=this,o=this._tileset;if(this.hasEmptyContent)return!1;var e=this._contentResource.clone(),a=this.contentExpired;a&&e.setQueryParameters({expired:this.expireDate.toString()});var t,n=new z({throttle:!1,throttleByServer:!1,type:pe.TILES3D,priorityFunction:function(){return t._priority},serverKey:(t=this)._serverKey});this._request=n,e.request=n;var r=e.fetchArrayBuffer();if(!Ze(r))return!1;var s=this._contentState;this._contentState=UI.LOADING,this._contentReadyToProcessPromise=D.defer(),this._contentReadyPromise=D.defer();var u,l,c=(u=this,l=o,function(e){u._contentState===UI.PROCESSING?--l.statistics.numberOfTilesProcessing:--l.statistics.numberOfPendingRequests,u._contentState=UI.FAILED,u._contentReadyPromise.reject(e),u._contentReadyToProcessPromise.reject(e)});return r.then(function(e){if(!i.isDestroyed()){var t,n=du(new Uint8Array(e)),r=BI[n];return o._disableSkipLevelOfDetail=o._disableSkipLevelOfDetail||"vctr"===n||"geom"===n,Ze(r)?t=r(o,i,i._contentResource,e,0):(t=BI.json(o,i,i._contentResource,e,0),i.hasTilesetContent=!0),a&&(i.expireDate=void 0),i._content=t,i._contentState=UI.PROCESSING,i._contentReadyToProcessPromise.resolve(t),t.readyPromise.then(function(e){var t,n;i._request&&(i._request.deferred=void 0,i._request.requestFunction=void 0,i._request.cancelFunction=void 0,i._request.priorityFunction=void 0,i._request=void 0),i.isDestroyed()?c():(Ze((t=i).expireDuration)&&(n=Ja.now(oL),Ja.addSeconds(n,t.expireDuration,n),Ze(t.expireDate)?Ja.lessThan(t.expireDate,n)&&Ja.clone(n,t.expireDate):t.expireDate=Ja.clone(n)),i._selectedFrame=0,i.lastStyleTime=0,Ja.now(i._loadTimestamp),i._contentState=UI.READY,i._contentReadyPromise.resolve(e))})}c()}).otherwise(function(e){if(n.state===F.CANCELLED)return i._contentState=s,--o.statistics.numberOfPendingRequests,void++o.statistics.numberOfAttemptedRequests;c(e)}),!0},rL.prototype.unloadContent=function(){this.hasEmptyContent||this.hasTilesetContent||(this._content=this._content&&this._content.destroy(),this._contentState=UI.UNLOADED,this._contentReadyToProcessPromise=void 0,this._contentReadyPromise=void 0,this.lastStyleTime=0,this.clippingPlanesDirty=0===this._clippingPlanesState,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var aL=new ko;function sL(e,t){var n,r;return t.mode===Tl.SCENE3D||Ze(e._boundingVolume2D)||(n=e._boundingVolume.boundingSphere,r=ko.projectTo2D(n,t.mapProjection,aL),e._boundingVolume2D=new oy(r.center,r.radius)),t.mode!==Tl.SCENE3D?e._boundingVolume2D:e._boundingVolume}rL.prototype.visibility=function(e,t){var n=e.cullingVolume,r=sL(this,e),i=this._tileset,o=i.clippingPlanes;if(Ze(o)&&o.enabled){var a=o.computeIntersectionWithBoundingVolume(r,i.clippingPlanesOriginMatrix);if(this._isClipped=a!==Jn.INSIDE,a===Jn.OUTSIDE)return Xx.MASK_OUTSIDE}return n.computeVisibilityWithPlaneMask(r,t)},rL.prototype.contentVisibility=function(e){if(!Ze(this._contentBoundingVolume))return Jn.INSIDE;if(this._visibilityPlaneMask===Xx.MASK_INSIDE)return Jn.INSIDE;var t,n,r,i,o=e.cullingVolume,a=(t=this,(n=e).mode===Tl.SCENE3D||Ze(t._contentBoundingVolume2D)||(r=t._contentBoundingVolume.boundingSphere,i=ko.projectTo2D(r,n.mapProjection,aL),t._contentBoundingVolume2D=new oy(i.center,i.radius)),n.mode!==Tl.SCENE3D?t._contentBoundingVolume2D:t._contentBoundingVolume),s=this._tileset,u=s.clippingPlanes;if(Ze(u)&&u.enabled){var l=u.computeIntersectionWithBoundingVolume(a,s.clippingPlanesOriginMatrix);if(this._isClipped=l!==Jn.INSIDE,l===Jn.OUTSIDE)return Jn.OUTSIDE}return o.computeVisibility(a)},rL.prototype.distanceToTile=function(e){return sL(this,e).distanceToCamera(e)};var uL=new _t;rL.prototype.distanceToTileCenter=function(e){var t=sL(this,e).boundingVolume,n=_t.subtract(t.center,e.camera.positionWC,uL);return _t.dot(e.camera.directionWC,n)},rL.prototype.insideViewerRequestVolume=function(e){var t=this._viewerRequestVolume;return!Ze(t)||0===t.distanceToCamera(e)};var lL=new jt,cL=new _t,hL=new jt,fL=new _t,pL=new $n,dL=new ab,mL=new on;function _L(e,t,n,r){return on.equalsEpsilon(t,n,pt.EPSILON8)?Ze(r)?r:new PO({rectangle:$n.unpack(e,0,pL),minimumHeight:e[4],maximumHeight:e[5]}):function(e,t,n,r){var i=$n.unpack(e,0,pL),o=e[4],a=e[5],s=ab.fromRectangle(i,o,a,Wn.WGS84,dL),u=s.center,l=s.halfAxes;t=on.multiplyTransformation(t,on.inverse(n,mL),mL),u=on.multiplyByPoint(t,u,u);var c=on.getMatrix3(t,lL),l=jt.multiply(c,l,l);return Ze(r)&&r instanceof nL?(r.update(u,l),r):new nL(u,l)}(e,t,n,r)}rL.prototype.createBoundingVolume=function(e,t,n){if(!Ze(e))throw new de("boundingVolume must be defined");if(Ze(e.box))return r=e.box,i=t,o=n,a=_t.fromElements(r[0],r[1],r[2],fL),s=jt.fromArray(r,3,hL),a=on.multiplyByPoint(i,a,a),u=on.getMatrix3(i,lL),s=jt.multiply(u,s,s),Ze(o)?(o.update(a,s),o):new nL(a,s);var r,i,o,a,s,u,l,c,h,f,p,d;if(Ze(e.region))return _L(e.region,t,this._initialTransform,n);if(Ze(e.sphere))return l=e.sphere,c=t,h=n,f=_t.fromElements(l[0],l[1],l[2],fL),p=l[3],f=on.multiplyByPoint(c,f,f),d=on.getScale(c,cL),p*=_t.maximumComponent(d),Ze(h)?(h.update(f,p),h):new oy(f,p);throw new de("boundingVolume must contain a sphere, region, or box")},rL.prototype.updateTransform=function(e){e=Je(e,on.IDENTITY);var t,n,r=on.multiply(e,this.transform,mL);on.equals(r,this.computedTransform)||(on.clone(r,this.computedTransform),t=this._header,n=this._header.content,this._boundingVolume=this.createBoundingVolume(t.boundingVolume,this.computedTransform,this._boundingVolume),Ze(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),Ze(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())},rL.prototype.updateGeometricErrorScale=function(){var e=on.getScale(this.computedTransform,cL);_t.maximumComponent(e)},rL.prototype.update=function(e,t,n){var r,i,o,a,s,u,l,c,h,f,p,d,m,_=t.commandList.length;r=this,i=e.clippingPlanes,o=0,Ze(i)&&r._isClipped&&i.enabled&&(o=i.clippingPlanesState),o!==r._clippingPlanesState&&(r._clippingPlanesState=o,r.clippingPlanesDirty=!0),a=this,s=e,u=t,n.isRender&&(l=Ze(a._header.content)&&Ze(a._header.content.boundingVolume),c=a.hasEmptyContent||a.hasTilesetContent,(h=s.debugShowBoundingVolume||s.debugShowContentBoundingVolume&&!l)?(f=a._finalResolution?c?It.DARKGRAY:It.WHITE:It.YELLOW,Ze(a._debugBoundingVolume)||(a._debugBoundingVolume=a._boundingVolume.createDebugVolume(f)),a._debugBoundingVolume.update(u),(p=a._debugBoundingVolume.getGeometryInstanceAttributes("outline")).color=Ld.toValue(f,p.color)):!h&&Ze(a._debugBoundingVolume)&&(a._debugBoundingVolume=a._debugBoundingVolume.destroy()),s.debugShowContentBoundingVolume&&l?(Ze(a._debugContentBoundingVolume)||(a._debugContentBoundingVolume=a._contentBoundingVolume.createDebugVolume(It.BLUE)),a._debugContentBoundingVolume.update(u)):!s.debugShowContentBoundingVolume&&Ze(a._debugContentBoundingVolume)&&(a._debugContentBoundingVolume=a._debugContentBoundingVolume.destroy()),s.debugShowViewerRequestVolume&&Ze(a._viewerRequestVolume)?(Ze(a._debugViewerRequestVolume)||(a._debugViewerRequestVolume=a._viewerRequestVolume.createDebugVolume(It.YELLOW)),a._debugViewerRequestVolume.update(u)):!s.debugShowViewerRequestVolume&&Ze(a._debugViewerRequestVolume)&&(a._debugViewerRequestVolume=a._debugViewerRequestVolume.destroy()),d=s.debugColorizeTiles&&!a._debugColorizeTiles||Ze(s._heatmap.tilePropertyName),m=!s.debugColorizeTiles&&a._debugColorizeTiles,d?(s._heatmap.colorize(a,u),a._debugColorizeTiles=!0,a.color=a._debugColor):m&&(a._debugColorizeTiles=!1,a.color=It.WHITE),a._colorDirty&&(a._colorDirty=!1,a._content.applyDebugSettings(!0,a._color)),m&&s.makeStyleDirty()),function(e,t,n){var r=e._content,i=e._expiredContent;if(Ze(i)){if(!e.contentReady)return i.update(t,n);e._expiredContent.destroy(),e._expiredContent=void 0}r.update(t,n)}(this,e,t),this._commandsLength=t.commandList.length-_,this._labels&&t.passes.pick&&this._labels.update(t),this.clippingPlanesDirty=!1};var gL=[];function yL(e,t,n){var r=e*Math.pow(10,t);return parseInt(r)*Math.pow(10,n)}function vL(e,t,n){return Math.max(pt.normalize(e,t,n)-pt.EPSILON7,0)}function xL(e){Ze((e=Je(e,Je.EMPTY_OBJECT)).tileInfo)&&Ze(e.tileInfo.spatialReference)&&4490===e.tileInfo.spatialReference.wkid?(this._ellipsoid=Je(e.ellipsoid,Wn.CGCS2000),this._numberOfLevelZeroTilesX=Je(e.numberOfLevelZeroTilesX,4),this._numberOfLevelZeroTilesY=Je(e.numberOfLevelZeroTilesY,2)):(this._ellipsoid=Je(e.ellipsoid,Wn.WGS84),this._numberOfLevelZeroTilesX=Je(e.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=Je(e.numberOfLevelZeroTilesY,1)),this._rectangle=Je(e.rectangle,$n.MAX_VALUE),this._projection=new Zn(this._ellipsoid),this._tileInfo=e.tileInfo}rL.prototype.process=function(e,t){var n=t.commandList;t.commandList=gL,this._content.update(e,t),gL.length=0,t.commandList=n},rL.prototype.updatePriority=function(){var e=this.tileset,t=e.preferLeaves,n=e._minimumPriority,r=e._maximumPriority,i=Math.pow(10,8),o=Math.pow(10,9),a=Math.pow(10,10),s=vL(this._depth,n.depth,r.depth),s=t?1-s:s,u=yL(!e._skipLevelOfDetail&&this.refine===zE.REPLACE?vL(this._priorityHolder._distanceToCamera,n.distance,r.distance):vL(this._priorityReverseScreenSpaceError,n.reverseScreenSpaceError,r.reverseScreenSpaceError),4,0),l=this._priorityProgressiveResolution?0:i,c=yL(vL(this._priorityHolder._foveatedFactor,n.foveatedFactor,r.foveatedFactor),4,4),h=this.priorityDeferred?o:0,f=e._pass===TP.PRELOAD_FLIGHT?0:a;this._priority=s+u+l+c+h+f},rL.prototype.isDestroyed=function(){return!1},rL.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),this.sharedResources.instancedPrograms=void 0,this.sharedResources.ktxs=void 0,Vt(this)},Object.defineProperties(xL.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),xL.prototype.getNumberOfXTilesAtLevel=function(t){if(Ze(this._tileInfo)){var e=this._tileInfo.lods.filter(function(e){return e.level===t})[0].resolution;return Math.round(360/(this._tileInfo.rows*e))}return this._numberOfLevelZeroTilesX<<t},xL.prototype.getNumberOfYTilesAtLevel=function(t){if(Ze(this._tileInfo)){var e=this._tileInfo.lods.filter(function(e){return e.level===t})[0].resolution;return Math.round(180/(this._tileInfo.cols*e))}return this._numberOfLevelZeroTilesY<<t},xL.prototype.rectangleToNativeRectangle=function(e,t){var n=pt.toDegrees(e.west),r=pt.toDegrees(e.south),i=pt.toDegrees(e.east),o=pt.toDegrees(e.north);return Ze(t)?(t.west=n,t.south=r,t.east=i,t.north=o,t):new $n(n,r,i,o)},xL.prototype.tileXYToNativeRectangle=function(e,t,n,r){var i=this.tileXYToRectangle(e,t,n,r);return i.west=pt.toDegrees(i.west),i.south=pt.toDegrees(i.south),i.east=pt.toDegrees(i.east),i.north=pt.toDegrees(i.north),i},xL.prototype.tileXYToRectangle=function(e,t,n,r){var i,o,a,s,u,l=this._rectangle,c=0,h=0,f=0,p=0;return h=Ze(this._tileInfo)?(i=this._tileInfo.lods.filter(function(e){return e.level===n})[0].resolution,p=this._tileInfo.origin.y-t*(this._tileInfo.cols*i),f=this._tileInfo.origin.x+e*(this._tileInfo.rows*i),h=this._tileInfo.origin.y-(t+1)*(this._tileInfo.cols*i),c=this._tileInfo.origin.x+(e+1)*(this._tileInfo.rows*i),f=pt.toRadians(f),p=pt.toRadians(p),c=pt.toRadians(c),pt.toRadians(h)):(o=this.getNumberOfXTilesAtLevel(n),a=this.getNumberOfYTilesAtLevel(n),f=e*(s=l.width/o)+l.west,c=(e+1)*s+l.west,u=l.height/a,p=l.north-t*u,l.north-(t+1)*u),Ze(r)||(r=new $n(f,h,c,p)),r.west=f,r.south=h,r.east=c,r.north=p,r},xL.prototype.positionToTileXY=function(e,t,n){var r,i,o,a,s,u,l,c,h,f,p=this._rectangle;if($n.contains(p,e))return Ze(this._tileInfo)?(r=this._tileInfo.lods.filter(function(e){return e.level===t})[0].resolution,i=pt.toDegrees(e.longitude),o=pt.toDegrees(e.latitude),a=Math.floor((i-this._tileInfo.origin.x)/(this._tileInfo.rows*r)),s=Math.floor((this._tileInfo.origin.y-o)/(this._tileInfo.cols*r))):(u=this.getNumberOfXTilesAtLevel(t),l=this.getNumberOfYTilesAtLevel(t),c=p.width/u,h=p.height/l,f=e.longitude,p.east<p.west&&(f+=pt.TWO_PI),u<=(a=(f-p.west)/c|0)&&(a=u-1),l<=(s=(p.north-e.latitude)/h|0)&&(s=l-1)),Ze(n)?(n.x=a,n.y=s,n):new En(a,s)};var bL=new _t,EL=new _t,TL=new Un,SL=new _t,CL=new _t,wL=new ko,AL=new xL,IL=[new Un,new Un,new Un,new Un],PL=new En,OL={};function LL(e){Un.fromRadians(e.east,e.north,0,IL[0]),Un.fromRadians(e.west,e.north,0,IL[1]),Un.fromRadians(e.east,e.south,0,IL[2]),Un.fromRadians(e.west,e.south,0,IL[3]);for(var t=0,n=0,r=0,i=0,o=OL._terrainHeightsMaxLevel,a=0;a<=o;++a){for(var s=!1,u=0;u<4;++u){var l=IL[u];if(AL.positionToTileXY(l,a,PL),0===u)r=PL.x,i=PL.y;else if(r!==PL.x||i!==PL.y){s=!0;break}}if(s)break;t=r,n=i}if(0!==a)return{x:t,y:n,level:o<a?o:a-1}}OL.initialize=function(){var e=OL._initPromise;return Ze(e)?e:(e=rt.fetchJson(ms("Assets/approximateTerrainHeights.js")).then(function(e){OL._terrainHeights=e}),OL._initPromise=e)},OL.getMinimumMaximumHeights=function(e,t){t=Je(t,Wn.WGS84);var n,r,i,o,a=LL(e),s=OL._defaultMinTerrainHeight,u=OL._defaultMaxTerrainHeight;return Ze(a)&&(n=a.level+"-"+a.x+"-"+a.y,Ze(r=OL._terrainHeights[n])&&(s=r[0],u=r[1]),t.cartographicToCartesian($n.northeast(e,TL),bL),t.cartographicToCartesian($n.southwest(e,TL),EL),_t.midpoint(EL,bL,SL),s=Ze(i=t.scaleToGeodeticSurface(SL,CL))?(o=_t.distance(SL,i),Math.min(s,-o)):OL._defaultMinTerrainHeight),{minimumTerrainHeight:s=Math.max(OL._defaultMinTerrainHeight,s),maximumTerrainHeight:u}},OL.getBoundingSphere=function(e,t){t=Je(t,Wn.WGS84);var n,r,i=LL(e),o=OL._defaultMaxTerrainHeight;Ze(i)&&(n=i.level+"-"+i.x+"-"+i.y,Ze(r=OL._terrainHeights[n])&&(o=r[1]));var a=ko.fromRectangle3D(e,t,0);return ko.fromRectangle3D(e,t,o,wL),ko.union(a,wL,a)},OL._terrainHeightsMaxLevel=6,OL._defaultMaxTerrainHeight=9e3,OL._defaultMinTerrainHeight=-1e5,OL._terrainHeights=void 0,OL._initPromise=void 0,Object.defineProperties(OL,{initialized:{get:function(){return Ze(OL._terrainHeights)}}});var NL={},RL=new _t;function DL(){this.head=void 0,this.tail=void 0,this._length=0}function ML(e,t,n){this.item=e,this.previous=t,this.next=n}function FL(e,t){Ze(t.previous)&&Ze(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):Ze(t.previous)?(t.previous.next=void 0,e.tail=t.previous):Ze(t.next)?(t.next.previous=void 0,e.head=t.next):(e.head=void 0,e.tail=void 0),t.next=void 0,t.previous=void 0}function zL(){this._list=new DL,this._sentinel=this._list.add(),this._trimTiles=!1}function BL(e){this.tilePropertyName=e,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE,this._previousMinimum=Number.MAX_VALUE,this._previousMaximum=-Number.MAX_VALUE,this._referenceMinimum={},this._referenceMaximum={}}function UL(e,t){var n="_loadTimestamp"===t?Ja.toDate(e).getTime():e;return n}NL.checkChildrenWithinParent=function(e){var t=e.children,n=t.length,r=e.boundingVolume;if(r instanceof nL||r instanceof PO){var i=r._orientedBoundingBox;e._optimChildrenWithinParent=VI.USE_OPTIMIZATION;for(var o=0;o<n;++o){var a=t[o].boundingVolume;if(!(a instanceof nL||a instanceof PO)){e._optimChildrenWithinParent=VI.SKIP_OPTIMIZATION;break}var s=a._orientedBoundingBox,u=_t.subtract(s.center,i.center,RL),l=_t.magnitude(u);if(_t.divideByScalar(u,l,u),Math.abs(i.halfAxes[0]*u.x)+Math.abs(i.halfAxes[1]*u.y)+Math.abs(i.halfAxes[2]*u.z)+Math.abs(i.halfAxes[3]*u.x)+Math.abs(i.halfAxes[4]*u.y)+Math.abs(i.halfAxes[5]*u.z)+Math.abs(i.halfAxes[6]*u.x)+Math.abs(i.halfAxes[7]*u.y)+Math.abs(i.halfAxes[8]*u.z)<=Math.abs(s.halfAxes[0]*u.x)+Math.abs(s.halfAxes[1]*u.y)+Math.abs(s.halfAxes[2]*u.z)+Math.abs(s.halfAxes[3]*u.x)+Math.abs(s.halfAxes[4]*u.y)+Math.abs(s.halfAxes[5]*u.z)+Math.abs(s.halfAxes[6]*u.x)+Math.abs(s.halfAxes[7]*u.y)+Math.abs(s.halfAxes[8]*u.z)+l){e._optimChildrenWithinParent=VI.SKIP_OPTIMIZATION;break}}}return e._optimChildrenWithinParent===VI.USE_OPTIMIZATION},Object.defineProperties(DL.prototype,{length:{get:function(){return this._length}}}),DL.prototype.add=function(e){var t=new ML(e,this.tail,void 0);return Ze(this.tail)?this.tail.next=t:this.head=t,this.tail=t,++this._length,t},DL.prototype.remove=function(e){Ze(e)&&(FL(this,e),--this._length)},DL.prototype.splice=function(e,t){var n;e!==t&&(FL(this,t),n=e.next,e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e)},zL.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)},zL.prototype.touch=function(e){var t=e.cacheNode;Ze(t)&&this._list.splice(this._sentinel,t)},zL.prototype.add=function(e){Ze(e.cacheNode)||(e.cacheNode=this._list.add(e))},zL.prototype.unloadTile=function(e,t,n){var r=t.cacheNode;Ze(r)&&(this._list.remove(r),t.cacheNode=void 0,n(e,t))},zL.prototype.unloadTiles=function(e,t){var n=this._trimTiles;this._trimTiles=!1;for(var r=this._list,i=1024*e.maximumMemoryUsage*1024,o=this._sentinel,a=r.head;a!==o&&(e.totalMemoryUsageInBytes>i||n)&&Ze(a);){var s=a.item,a=a.next;Ze(s)&&this.unloadTile(e,s,t)}if(e._root._screenSpaceError<=e._maximumScreenSpaceError&&0<r._length)for(a=r.head,e.sharedResources.instancedPrograms={},e.sharedResources.ktxs={},e.gltfShader={};a!==o;){s=a.item;a=a.next,this.unloadTile(e,s,t)}},zL.prototype.trim=function(){this._trimTiles=!0},BL.prototype.setReferenceMinimumMaximum=function(e,t,n){this._referenceMinimum[n]=UL(e,n),this._referenceMaximum[n]=UL(t,n)};var VL=[new It(.1,.1,.1,1),new It(.153,.278,.878,1),new It(.827,.231,.49,1),new It(.827,.188,.22,1),new It(1,.592,.259,1),new It(1,.843,0,1)];function kL(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfPendingRequests=0,this.numberOfTilesProcessing=0,this.numberOfTilesWithContentReady=0,this.numberOfTilesTotal=0,this.numberOfLoadedTilesTotal=0,this.numberOfFeaturesSelected=0,this.numberOfFeaturesLoaded=0,this.numberOfPointsSelected=0,this.numberOfPointsLoaded=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0,this.geometryByteLength=0,this.texturesByteLength=0,this.batchTableByteLength=0}function GL(e,t,n,r){var i=t.innerContents,o=t.pointsLength,a=t.trianglesLength,s=t.featuresLength,u=t.geometryByteLength,l=t.texturesByteLength,c=t.batchTableByteLength;if(r?(e.numberOfFeaturesLoaded+=n?-s:s,e.numberOfPointsLoaded+=n?-o:o,e.geometryByteLength+=n?-u:u,e.texturesByteLength+=n?-l:l,e.batchTableByteLength+=n?-c:c):(e.numberOfFeaturesSelected+=n?-s:s,e.numberOfPointsSelected+=n?-o:o,e.numberOfTrianglesSelected+=n?-a:a),Ze(i))for(var h=i.length,f=0;f<h;++f)GL(e,i[f],n,r)}function qL(){this._style=void 0,this._styleDirty=!1,this._lastStyleTime=0,this.airlineUpdate=!1}function HL(e){e=Je(e,Je.EMPTY_OBJECT),this._url=void 0,this._basePath=void 0,this._root=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._extensionsUsed=void 0,this._extensions=void 0,this._gltfUpAxis=void 0,this._cache=new zL,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._cullWithChildrenBounds=Je(e.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new kI,this._maximumScreenSpaceError=Je(e.maximumScreenSpaceError,16),this._maximumMemoryUsage=Je(e.maximumMemoryUsage,512),this._styleEngine=new qL,this._modelMatrix=Ze(e.modelMatrix)?on.clone(e.modelMatrix):on.clone(on.IDENTITY),this._statistics=new kL,this._statisticsLast=new kL,this._statisticsPerPass=new Array(TP.NUMBER_OF_PASSES);for(var t=0;t<TP.NUMBER_OF_PASSES;++t)this._statisticsPerPass[t]=new kL;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new BL(e.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=Je(e.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=Je(e.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=pt.clamp(Je(e.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=Je(e.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._readyPromise=D.defer(),this._classificationType=e.classificationType,this._ellipsoid=Je(e.ellipsoid,Wn.WGS84),this._initialClippingPlanesOriginMatrix=on.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this._geoErrorRatio=Je(e.geoErrorRatio,1),this.EVDataSetName=void 0,this._distance=Je(e.distance,void 0),this.rollerRegion=new qt(0,0,1,1),this._distanceLimit=Je(e.distanceLimit,void 0),this._maxHeight=Je(e.maxHeight,void 0),this._minHeight=Je(e.minHeight,void 0),this._airDataShowNameCount=Je(e.airDataShowNameCount,void 0),this._annotationLabel=e.annotationLabel,Ze(this._annotationLabel)||(this._annotationLabel={font:"30px sans-serif",fillColor:It.WHITE,outlineColor:It.RED,disableDepthTestDistance:Number.POSITIVE_INFINITY,outlineWidth:5,style:DC.FILL_AND_OUTLINE}),this._airWidth=e.airWidth,this._material=e.material,this._disableDepthTestDistance=e.disableDepthTestDistance,this.gltfShader={},this._startListener=void 0,this._stopListener=void 0,this._timer=void 0,this._useElevation=Je(e.useElevation,!1);this._elevationMap=Je(e.elevationMap,{elevationRamp:[0,.045,.1,.15,.37,.54,1],colorRamp:["rgba(0,0,0,1)","rgba(39,71,224,1)","rgba(211,59,125,1)","rgba(211,48,56,1)","rgba(255,151,66,1)","rgba(255,215,0,1)","rgba(255,255,255,1)"]}),this.reduceRequest=Je(e.reduceRequest,!0),this.enableUndergroundDataDistance=Je(e.enableUndergroundDataDistance,!1),this.undergroundDataDistance=void 0,this.enableUndergroundDataDistance&&(this.undergroundDataDistance=Je(e.undergroundDataDistance,300)),this.specular=Je(e.specular,.5),this.preloadWhenHidden=Je(e.preloadWhenHidden,!1),this.preloadFlightDestinations=Je(e.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=Je(e.dynamicScreenSpaceError,!1),this.foveatedScreenSpaceError=Je(e.foveatedScreenSpaceError,!0),this._foveatedConeSize=Je(e.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=Je(e.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=Je(e.foveatedInterpolationCallback,pt.lerp),this.foveatedTimeDelay=Je(e.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=.00278,this.dynamicScreenSpaceErrorFactor=4,this.dynamicScreenSpaceErrorHeightFalloff=.25,this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=Je(e.shadows,Cd.ENABLED),this.show=Je(e.show,!0),this.colorBlendMode=li.REPLACE,this.colorBlendAmount=.5,this.pointCloudShading=new dT(e.pointCloudShading),this._pointCloudEyeDomeLighting=new lT,this.loadProgress=new U,this.loadedTreeTables=new U,this.allTilesLoaded=new U,this.initialTilesLoaded=new U,this.tileLoad=new U,this.tileUnload=new U,this.tileFailed=new U,this.tileVisible=new U,this.skipLevelOfDetail=Je(e.skipLevelOfDetail,!0),this._skipLevelOfDetail=this.skipLevelOfDetail,this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=Je(e.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=Je(e.skipScreenSpaceErrorFactor,16),this.skipLevels=Je(e.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=Je(e.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=Je(e.loadSiblings,!1),this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._imageBasedLightingFactor=new En(1,1),En.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=e.lightColor,this.luminanceAtZenith=Je(e.luminanceAtZenith,.2),this.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=e.specularEnvironmentMaps,this.debugFreezeFrame=Je(e.debugFreezeFrame,!1),this.debugColorizeTiles=Je(e.debugColorizeTiles,!1),this.debugWireframe=Je(e.debugWireframe,!1),this.debugShowBoundingVolume=Je(e.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=Je(e.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=Je(e.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=Je(e.debugShowGeometricError,!1),this.debugShowRenderingStatistics=Je(e.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=Je(e.debugShowMemoryUsage,!1),this.debugShowUrl=Je(e.debugShowUrl,!1),this.position=Je(e.position,void 0),this.headingPitchRoll=Je(e.headingPitchRoll,void 0),this.sharedResources={treeTables:{},instancedPrograms:{},ktxs:{}},this.treeTableMaps=[],this.selectedTiles=void 0;var c,h=this;D(e.url).then(function(e){var t;return c=rt.createIfNeeded(e),h._credits=c.credits,"json"===c.extension?t=c.getBaseUri(!0):c.isDataUri&&(t=""),h._url=c.url,h._basePath=t,HL.loadJson(c)}).then(function(e){h._root=h.loadTileset(c,e);var t=Ze(e.asset.gltfUpAxis)?xn.fromName(e.asset.gltfUpAxis):xn.Y,n=e.asset;h._asset=n,h._properties=e.properties,h._geometricError=e.geometricError,h._geometricError*=h._geoErrorRatio,h._extensionsUsed=e.extensionsUsed,h._extensions=e.extensions,h._gltfUpAxis=t,h._extras=e.extras,h.EVDataSetName=e.EVDataSetName,e.elevationRange&&(h.elevationMin=e.elevationRange[0],h.elevationMax=e.elevationRange[1]);var r=n.extras;if(Ze(r)&&Ze(r.cesium)&&Ze(r.cesium.credits)){var i=r.cesium.credits,o=h._credits;Ze(o)||(o=[],h._credits=o);for(var a=0;a<i.length;++a){var s=i[a];o.push(new Cf(s.html,s.showOnScreen))}}var u=h._root.createBoundingVolume(e.root.boundingVolume,on.IDENTITY).boundingSphere.center,l=h._ellipsoid.cartesianToCartographic(u);Ze(l)&&l.height>OL._defaultMinTerrainHeight&&(h._initialClippingPlanesOriginMatrix=bs.eastNorthUpToFixedFrame(u)),h._clippingPlanesOriginMatrix=on.clone(h._initialClippingPlanesOriginMatrix),h._readyPromise.resolve(h)}).otherwise(function(e){h._readyPromise.reject(e)})}BL.prototype.colorize=function(e,t){var n,r,i,o,a,s,u,l,c,h,f;Ze(this.tilePropertyName)&&e.contentAvailable&&e._selectedFrame===t.frameNumber&&(n=function(e,t){var n=e.tilePropertyName;if(Ze(n)){var r=UL(t[n],n);return Ze(r)?(e._maximum=Math.max(r,e._maximum),e._minimum=Math.min(r,e._minimum),r):(e.tilePropertyName=void 0,r)}}(this,e),r=this._previousMinimum,i=this._previousMaximum,r!==Number.MAX_VALUE&&i!==-Number.MAX_VALUE&&(o=i-r+pt.EPSILON7,a=pt.clamp(n-r,0,o)/o*(VL.length-1),s=Math.floor(a),u=Math.ceil(a),l=a-s,c=VL[s],h=VL[u],(f=It.clone(It.WHITE)).red=pt.lerp(c.red,h.red,l),f.green=pt.lerp(c.green,h.green,l),f.blue=pt.lerp(c.blue,h.blue,l),e._debugColor=f))},BL.prototype.resetMinimumMaximum=function(){var e,t,n,r=this.tilePropertyName;Ze(r)&&(e=this._referenceMinimum[r],t=this._referenceMaximum[r],n=Ze(e)&&Ze(t),this._previousMinimum=n?e:this._minimum,this._previousMaximum=n?t:this._maximum,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE)},kL.prototype.clear=function(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfFeaturesSelected=0,this.numberOfPointsSelected=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0},kL.prototype.incrementSelectionCounts=function(e){GL(this,e,!1,!1)},kL.prototype.incrementLoadCounts=function(e){GL(this,e,!1,!0)},kL.prototype.decrementLoadCounts=function(e){GL(this,e,!0,!0)},kL.clone=function(e,t){t.selected=e.selected,t.visited=e.visited,t.numberOfCommands=e.numberOfCommands,t.selected=e.selected,t.numberOfAttemptedRequests=e.numberOfAttemptedRequests,t.numberOfPendingRequests=e.numberOfPendingRequests,t.numberOfTilesProcessing=e.numberOfTilesProcessing,t.numberOfTilesWithContentReady=e.numberOfTilesWithContentReady,t.numberOfTilesTotal=e.numberOfTilesTotal,t.numberOfFeaturesSelected=e.numberOfFeaturesSelected,t.numberOfFeaturesLoaded=e.numberOfFeaturesLoaded,t.numberOfPointsSelected=e.numberOfPointsSelected,t.numberOfPointsLoaded=e.numberOfPointsLoaded,t.numberOfTrianglesSelected=e.numberOfTrianglesSelected,t.numberOfTilesStyled=e.numberOfTilesStyled,t.numberOfFeaturesStyled=e.numberOfFeaturesStyled,t.numberOfTilesCulledWithChildrenUnion=e.numberOfTilesCulledWithChildrenUnion,t.geometryByteLength=e.geometryByteLength,t.texturesByteLength=e.texturesByteLength,t.batchTableByteLength=e.batchTableByteLength},Object.defineProperties(qL.prototype,{style:{get:function(){return this._style},set:function(e){this._style=e,this._styleDirty=!0,this.airlineUpdate=!0}}}),qL.prototype.makeDirty=function(){this._styleDirty=!0},qL.prototype.applyStyle=function(e,t){if(e.ready&&(!Ze(this._style)||this._style.ready)){var n=this._styleDirty;t.isRender&&(this._styleDirty=!1),n&&(++this._lastStyleTime,this.airlineUpdate=!0);for(var r=this._lastStyleTime,i=e._statistics,o=n?e._selectedTiles:e._selectedTilesToStyle,a=o.length,s=0;s<a;++s){var u,l=o[s];l.lastStyleTime!==r&&(u=l.content,l.lastStyleTime=r,u.applyStyle(this._style),i.numberOfFeaturesStyled+=u.featuresLength,++i.numberOfTilesStyled)}}},Object.defineProperties(HL.prototype,{isCesium3DTileset:{get:function(){return!0}},asset:{get:function(){return this._asset}},extensions:{get:function(){return this._extensions}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){rp.setOwner(e,this,"_clippingPlanes")}},properties:{get:function(){return this._properties}},ready:{get:function(){return Ze(this._root)}},readyPromise:{get:function(){return this._readyPromise.promise}},tilesLoaded:{get:function(){return this._tilesLoaded}},url:{get:function(){return this._url}},basePath:{get:function(){return Bt("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(e){this._styleEngine.style=e}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(e){this._maximumScreenSpaceError=e}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(e){this._maximumMemoryUsage=e}},root:{get:function(){return this._root}},boundingSphere:{get:function(){return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=on.clone(e,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){var e=this._statistics;return e.texturesByteLength+e.geometryByteLength+e.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return Ze(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(on.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):on.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(e){this._foveatedConeSize=e}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(e){this._foveatedMinimumScreenSpaceErrorRelaxation=e}},extras:{get:function(){return this._extras}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){En.clone(e,this._imageBasedLightingFactor)}},airWidth:{get:function(){return this._airWidth},set:function(e){this._airWidth=e}},treeTable:{get:function(){return Ze(this.sharedResources.treeTables)?this.sharedResources.treeTables:void 0}}}),HL.loadJson=function(e){return rt.createIfNeeded(e).fetchJson()},HL.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()},HL.prototype.loadTileset=function(e,t,n){var r=t.asset;if(!Ze(r))throw new de("Tileset must have an asset property.");if("0.0"!==r.version&&"1.0"!==r.version)throw new de("The tileset must be 3D Tiles version 0.0 or 1.0.");var i=this._statistics,o=r.tilesetVersion;Ze(o)&&(this._basePath+="?v="+o,e.setQueryParameters({v:o}));var a=new rL(this,e,t.root,n);Ze(n)&&(n.children.push(a),a._depth=n._depth+1);var s=[];for(s.push(a),a.sharedResources=this.sharedResources;0<s.length;){var u=s.pop();++i.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&u.refine===zE.ADD;var l=u._header.children;if(Ze(l))for(var c=l.length,h=0;h<c;++h){var f=l[h],p=Jr();Ze(f.content)&&Ze(f.content.uri)?p=f.content.uri:Ze(f.content)&&Ze(f.content.url)&&(p=f.content.url),Ze(this.sharedResources.ktxs)||(this.sharedResources.ktxs={}),this.sharedResources.instancedPrograms[p]={},Ze(f.modeltree)&&(this.sharedResources.treeTables[f.modeltree.uri]={});var d=new rL(this,e,f,u);u.children.push(d),d._depth=u._depth+1,s.push(d),d.sharedResources={treeTables:Ze(f.modeltree)?{name:f.modeltree.uri,shadredData:this.sharedResources.treeTables[f.modeltree.uri]}:{},instancedPrograms:{name:p,shadredData:this.sharedResources.instancedPrograms[p]},ktxs:this.sharedResources.ktxs}}this._cullWithChildrenBounds&&NL.checkChildrenWithinParent(u)}return a};var WL=new _t,YL=new Un,XL=new on,jL=new _t,KL=new _t,QL=new _t;function ZL(e,t){var n,r,i,o,a,s,u,l;t.hasEmptyContent||(n=e._statistics,r=t.contentExpired,t.requestContent()?(r&&(t.hasTilesetContent?function(e,t){var n=t,r=mN;r.push(t);for(;0<r.length;){for(var i=(t=r.pop()).children,o=i.length,a=0;a<o;++a)r.push(i[a]);t!==n&&(gN(e,t),--e._statistics.numberOfTilesTotal)}n.children=[]}(e,t):(n.decrementLoadCounts(t.content),--n.numberOfTilesWithContentReady)),++n.numberOfPendingRequests,e._requestedTilesInFlight.push(t),t.contentReadyToProcessPromise.then((i=e,o=t,function(){i._processingQueue.push(o),--i._statistics.numberOfPendingRequests,++i._statistics.numberOfTilesProcessing})),t.contentReadyPromise.then((u=e,l=t,function(){--u._statistics.numberOfTilesProcessing,l.hasTilesetContent||(u._statistics.incrementLoadCounts(l.content),++u._statistics.numberOfTilesWithContentReady,++u._statistics.numberOfLoadedTilesTotal,u._cache.add(l)),u.tileLoad.raiseEvent(l)})).otherwise((a=e,s=t,function(e){var t=s._contentResource.url,n=Ze(e.message)?e.message:e.toString();0<a.tileFailed.numberOfListeners?a.tileFailed.raiseEvent({url:t,message:n}):(console.log("A 3D tile failed to load: "+t),console.log("Error: "+n))}))):++n.numberOfAttemptedRequests)}function JL(e,t){return e._priority-t._priority}HL.prototype.postPassesUpdate=function(e){this.ready&&(function(e,t){for(var n=e._requestedTilesInFlight,r=0,i=n.length,o=0;o<i;++o){var a=n[o],s=1<=t.frameNumber-a._touchedFrame;a._contentState===UI.LOADING?s?(a._request.cancel(),++r):0<r&&(n[o-r]=a):++r}n.length-=r}(this,e),function(e,t){var n=e._statistics,r=e._statisticsLast,i=n.numberOfPendingRequests,o=n.numberOfTilesProcessing,a=r.numberOfPendingRequests,s=r.numberOfTilesProcessing;kL.clone(n,r);var u=i!==a||o!==s;u&&t.afterRender.push(function(){e.loadProgress.raiseEvent(i,o)});e._tilesLoaded=0===n.numberOfPendingRequests&&0===n.numberOfTilesProcessing&&0===n.numberOfAttemptedRequests,u&&e._tilesLoaded&&(t.afterRender.push(function(){e.allTilesLoaded.raiseEvent()}),e._initialTilesLoaded||(e._initialTilesLoaded=!0,t.afterRender.push(function(){e.initialTilesLoaded.raiseEvent()})))}(this,e),this._cache.unloadTiles(this,_N))},HL.prototype.prePassesUpdate=function(e){var t;this.ready&&(function(e,t){!function(e){for(var t=e._processingQueue,n=t.length,r=0,i=0;i<n;++i){var o=t[i];o._contentState===UI.PROCESSING?0<r&&(t[i-r]=o):++r}t.length-=r}(e);for(var n=e._processingQueue,r=n.length,i=0;i<r;++i)n[i].process(e,t)}(this,e),t=this._clippingPlanes,this._clippingPlanesOriginMatrixDirty=!0,Ze(t)&&t.enabled&&t.update(e),Ze(this._loadTimestamp)||(this._loadTimestamp=Ja.clone(e.time)),this._timeSinceLoad=Math.max(1e3*Ja.secondsDifference(e.time,this._loadTimestamp),0),this._skipLevelOfDetail=this.skipLevelOfDetail&&!Ze(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive,this.dynamicScreenSpaceError&&function(e,t){var n,r,i,o,a,s,u,l,c,h,f,p,d,m=t.camera,_=e._root,g=_.contentBoundingVolume;g instanceof PO?(s=_t.normalize(m.positionWC,WL),u=m.directionWC,l=m.positionCartographic.height,c=g.minimumHeight,h=g.maximumHeight):(n=on.inverseTransformation(_.computedTransform,XL),r=t.mapProjection.ellipsoid,i=g.boundingVolume,o=on.multiplyByPoint(n,i.center,jL),_t.magnitude(o)>r.minimumRadius?(a=Un.fromCartesian(o,r,YL),s=_t.normalize(m.positionWC,WL),u=m.directionWC,l=m.positionCartographic.height,c=0,h=2*a.height):(f=on.multiplyByPoint(n,m.positionWC,KL),s=_t.UNIT_Z,u=on.multiplyByPointAsVector(n,m.directionWC,QL),u=_t.normalize(u,u),l=f.z,g instanceof nL?(p=_._header.boundingVolume.box[11],c=o.z-p,h=o.z+p):g instanceof oy&&(d=i.radius,c=o.z-d,h=o.z+d)));var y=c+(h-c)*e.dynamicScreenSpaceErrorHeightFalloff,v=pt.clamp((l-y)/(h-y),0,1),x=1-Math.abs(_t.dot(u,s));x*=1-v;var b=e.dynamicScreenSpaceErrorDensity;b*=x,e._dynamicScreenSpaceErrorComputedDensity=b}(this,e),e.newFrame&&this._cache.reset())};var $L=new _t,eN={maximumFractionDigits:3};function tN(e){var t=e/1048576;return t<1?t.toLocaleString(void 0,eN):Math.round(t).toLocaleString()}function nN(e){var t,n=e.boundingVolume.boundingVolume,r=n.halfAxes,i=n.radius,o=_t.clone(n.center,$L);return Ze(r)?(o.x+=.75*(r[0]+r[3]+r[6]),o.y+=.75*(r[1]+r[4]+r[7]),o.z+=.75*(r[2]+r[5]+r[8])):Ze(i)&&(t=_t.normalize(n.center,$L),t=_t.multiplyByScalar(t,.75*i,$L),o=_t.add(t,n.center,$L)),o}function rN(e,t,n){var r="",i=0;if(t.debugShowGeometricError&&(r+="\nGeometric error: "+e.geometricError,i++),t.debugShowRenderingStatistics&&(r+="\nCommands: "+e.commandsLength,i++,0<e.content.pointsLength&&(r+="\nPoints: "+e.content.pointsLength,i++),0<e.content.trianglesLength&&(r+="\nTriangles: "+e.content.trianglesLength,i++),r+="\nFeatures: "+e.content.featuresLength,i++),t.debugShowMemoryUsage&&(r+="\nTexture Memory: "+tN(e.content.texturesByteLength),r+="\nGeometry Memory: "+tN(e.content.geometryByteLength),i+=2),t.debugShowUrl&&(r+="\nUrl: "+e._header.content.uri,i++),0!=r.length){var o={text:r.substring(1),position:n,font:19-i+"px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return t._tileDebugLabels.add(o)}}var iN=[],oN=0;function aN(e,t,n){if(Ze(t._airDataShowNameCount)&&0<t._airDataShowNameCount){Ze(e._labels)||(e._labels=new dw);for(var r=0;r<e._labels.length;r++)e._labels.get(r).changed=!1,e._labels.get(r).show=!1;var i=[];oN=0;for(var o=e._content._batchTable,a=o.featuresLength,r=0;r<a;r++){var s,u=o.getProperty(r,"id"),l=o.getProperty(r,"name");if(!Ze(l))return void(t._airDataShowNameCount=0);Ze(u)&&(s={id:u});var c=o.getProperty(r,"Positions");if(!Ze(c))return;for(var h=c.Longitude,f=c.Latitude,p=c.Height,d=[],m=0;m<h.length;m++){var _=h[m],g=f[m],y=p[m];y<1e-7&&(y=0);var v=_t.fromRadians(_,g,y);pN(v,n.cullingVolume)&&d.push(v)}0<d.length&&sN(t,e,d,l,i,n,s)}}else;}function sN(e,t,n,r,i,o,a){var s=o.camera._scene,u=n.length,l=e._airDataShowNameCount,c=t._distanceToCamera;if(2e4<c)lN(h=parseInt(u/2),n,e,t,r,s,i,a);else if(c<=2e4){if(2*l<=u)for(var h,f=parseInt(u/(2*l))+1,p=0;p<l;p++){lN(h=u<=(h=p+(p+1)*f)?h-u:h,n,e,t,r,s,i,a)}else lN(h=parseInt(u/2),n,e,t,r,s,i,a)}}function uN(e,t){for(var n=e.length-1;0<=n;n--){if(tr.intersect(e[n],t)===Jn.INTERSECTING)return 1}}function lN(e,t,n,r,i,o,a,s){for(var u=t.length,l=t[e],c=1,h=fN(n,i,l,o),f=0===(f=parseInt(u/10))?1:f;uN(iN,h)&&c<=f;)h=fN(n,i,l=t[e=u<=e+f?e+f-u:e+f],o),c++;uN(iN,h)||(function(e,t,n,r,i){if(t._labels.length>oN)for(var o=!0,a=0;a<t._labels.length;a++){var s=t._labels.get(a);if(s.text===r&&(o=!1,s.show=!0,!Ze(s.changed)||!s.changed)){s.position=n,s.changed=!0;break}}else{var u={text:r,position:n,properties:i};for(var l in e._annotationLabel)u[l]=e._annotationLabel[l];t._labels.add(u)}if(o){u={text:r,position:n,properties:i};for(var l in e._annotationLabel)u[l]=e._annotationLabel[l];t._labels.add(u)}oN++}(n,r,l,i,s),a.push(l),iN.push(h))}var cN=0,hN=0;function fN(e,t,n,r){if(0===cN){var i=e._annotationLabel.font,o=document.createElement("canvas");o.width=1,o.height=1,o.style.font=i;var a=o.getContext("2d");a.font=i,a.lineJoin="round",a.lineWidth=1;a.imageSmoothingEnabled=!1,a.textBaseline="bottom",o.style.visibility="hidden",document.body.appendChild(o);for(var s=0;s<t.length;s++){var u=t[s],l=PC(a,u,!1,!0);cN+=l.width,hN=Math.max(hN,l.height)}document.body.removeChild(o),o.style.visibility=""}var c=new tr,h=new En;return CT.wgs84ToWindowCoordinates(r,n,h),c.x=h.x,c.y=h.y,c.width=cN,c.height=hN,c}function pN(e,t){for(var n=t.planes,r=!1,i=new Zf(new _t(1,0,0),0),o=0,a=n.length;o<a;++o){var s=Zf.fromCartesian4(n[o],i),u=s.normal;if(_t.dot(u,e)+s.distance<=0)return;r=!0}return r}function dN(e,t,n){e._styleEngine.applyStyle(e,n);var r,i=n.isRender,o=e._statistics,a=t.commandList,s=a.length,u=e._selectedTiles,l=u.length,c=e._emptyTiles,h=c.length,f=e.tileVisible,p=e._skipLevelOfDetail&&e._hasMixedContent&&t.context.stencilBuffer&&0<l;e._backfaceCommands.length=0,p&&(Ze(e._stencilClearCommand)||(e._stencilClearCommand=new iT({stencil:0,pass:yn.CESIUM_3D_TILE,renderState:sr.fromCache({stencilMask:Ti.SKIP_LOD_MASK})})),a.push(e._stencilClearCommand));for(var d=a.length,m=0;m<l;++m)r=u[m],i&&f.raiseEvent(r),r.update(e,t,n),o.incrementSelectionCounts(r.content),++o.selected;for(m=0;m<h;++m)(r=c[m]).update(e,t,n);var _=a.length-d;if(e._backfaceCommands.trim(),p){var g=e._backfaceCommands.values,y=g.length;for(a.length+=y,m=_-1;0<=m;--m)a[d+y+m]=a[d+m];for(m=0;m<y;++m)a[d+m]=g[m]}_=a.length-s,o.numberOfCommands=_,i&&e.pointCloudShading.attenuation&&e.pointCloudShading.eyeDomeLighting&&0<_&&e._pointCloudEyeDomeLighting.update(t,s,e.pointCloudShading,e.boundingSphere),i&&(e.debugShowGeometricError||e.debugShowRenderingStatistics||e.debugShowMemoryUsage||e.debugShowUrl||Ze(e._airDataShowNameCount)?(Ze(e._tileDebugLabels)||(e._tileDebugLabels=new dw),function(e,t){var n,r,i,o=e._selectedTiles,a=o.length,s=e._emptyTiles,u=s.length;if(e._tileDebugLabels.removeAll(),e.debugPickedTileLabelOnly){Ze(e.debugPickedTile)&&(i=Ze(e.debugPickPosition)?e.debugPickPosition:nN(e.debugPickedTile),rN(e.debugPickedTile,e,i).pixelOffset=new En(15,-15))}else{iN=[];var l=t.camera;for(void 0===e._startListener&&(e._startListener=function(){e.show&&(e._timer=setInterval(function(){for(n=0;n<o.length;++n)aN(r=o[n],e,t)},800)),e._stopListener&&l._moveEnd.removeEventListener(e._stopListener),e._stopListener=void 0},l._moveStart.addEventListener(e._startListener)),void 0===e._stopListener&&(e._stopListener=function(){Ze(e._timer)&&(clearInterval(e._timer),e._timer=void 0,e._startListener&&l._moveStart.removeEventListener(e._startListener),e._startListener=void 0)},l._moveEnd.addEventListener(e._stopListener)),n=0;n<a;++n)rN(r=o[n],e,nN(r)),Ze(r._labels)&&r._labels.update(t);for(n=0;n<u;++n)(r=s[n]).hasTilesetContent&&rN(r,e,nN(r))}e._tileDebugLabels.update(t)}(e,t)):e._tileDebugLabels=e._tileDebugLabels&&e._tileDebugLabels.destroy())}var mN=[];function _N(e,t){e.tileUnload.raiseEvent(t),e._statistics.decrementLoadCounts(t.content),--e._statistics.numberOfTilesWithContentReady,t.unloadContent()}function gN(e,t){e._cache.unloadTile(e,t,_N),t.destroy()}function yN(e,t,n,r){if(t.mode===Tl.MORPHING)return!1;if(!e.ready)return!1;var i=e._statistics;i.clear();var o,a,s,u=r.isRender;++e._updatedVisibilityFrame,(o=e)._heatmap.resetMinimumMaximum(),o._minimumPriority.depth=Number.MAX_VALUE,o._maximumPriority.depth=-Number.MAX_VALUE,o._minimumPriority.foveatedFactor=Number.MAX_VALUE,o._maximumPriority.foveatedFactor=-Number.MAX_VALUE,o._minimumPriority.distance=Number.MAX_VALUE,o._maximumPriority.distance=-Number.MAX_VALUE,o._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE,o._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE,a=e,(s=t).frameNumber===a._updatedModelMatrixFrame&&Ze(a._previousModelMatrix)||(a._updatedModelMatrixFrame=s.frameNumber,a._modelMatrixChanged=!on.equals(a.modelMatrix,a._previousModelMatrix),a._previousModelMatrix=on.clone(a.modelMatrix,a._previousModelMatrix)),e._cullRequestsWhileMoving=e.cullRequestsWhileMoving&&!e._modelMatrixChanged;var l=r.traversal.selectTiles(e,t);if(r.requestTiles&&function(e){var t=e._requestedTiles,n=t.length;t.sort(JL);for(var r=0;r<n;++r)ZL(e,t[r])}(e),e.selectedTiles=e._selectedTiles.slice(0),dN(e,t,r),kL.clone(i,n),u){var c=e._credits;if(Ze(c)&&0!==i.selected)for(var h=c.length,f=0;f<h;++f)t.creditDisplay.addCredit(c[f])}return l}function vN(e,t){this._conditionsExpression=$e(e,!0),this._conditions=e.conditions,this._runtimeConditions=void 0,function(e,t){var n=[],r=e._conditions;if(!Ze(r))return;for(var i=r.length,o=0;o<i;++o){var a=r[o],s=String(a[0]),u=String(a[1]);n.push(new xN(new Jc(s,t),new Jc(u,t)))}e._runtimeConditions=n}(this,t)}function xN(e,t){this.condition=e,this.expression=t}function bN(e){var t;this._style={},this._ready=!1,this._show=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._labelColor=void 0,this._labelOutlineColor=void 0,this._labelOutlineWidth=void 0,this._font=void 0,this._labelStyle=void 0,this._labelText=void 0,this._backgroundColor=void 0,this._backgroundPadding=void 0,this._backgroundEnabled=void 0,this._scaleByDistance=void 0,this._translucencyByDistance=void 0,this._distanceDisplayCondition=void 0,this._heightOffset=void 0,this._anchorLineEnabled=void 0,this._anchorLineColor=void 0,this._image=void 0,this._disableDepthTestDistance=void 0,this._horizontalOrigin=void 0,this._verticalOrigin=void 0,this._labelHorizontalOrigin=void 0,this._labelVerticalOrigin=void 0,this._meta=void 0,this._colorShaderFunction=void 0,this._showShaderFunction=void 0,this._pointSizeShaderFunction=void 0,this._colorShaderFunctionReady=!1,this._showShaderFunctionReady=!1,this._pointSizeShaderFunctionReady=!1,this._colorShaderTranslucent=!1,this._exOffset=void 0,this._translation=void 0,this._scale=void 0,this._rotation=void 0,t="string"==typeof e||e instanceof rt?rt.createIfNeeded(e).fetchJson(e):D.resolve(e);var n=this;this._readyPromise=t.then(function(e){return function(e,t){t=Je($e(t,!0),e._style),e._style=t,e.show=t.show,e.color=t.color,e.pointSize=t.pointSize,e.pointOutlineColor=t.pointOutlineColor,e.pointOutlineWidth=t.pointOutlineWidth,e.labelColor=t.labelColor,e.labelOutlineColor=t.labelOutlineColor,e.labelOutlineWidth=t.labelOutlineWidth,e.labelStyle=t.labelStyle,e.font=t.font,e.labelText=t.labelText,e.backgroundColor=t.backgroundColor,e.backgroundPadding=t.backgroundPadding,e.backgroundEnabled=t.backgroundEnabled,e.scaleByDistance=t.scaleByDistance,e.translucencyByDistance=t.translucencyByDistance,e.distanceDisplayCondition=t.distanceDisplayCondition,e.heightOffset=t.heightOffset,e.anchorLineEnabled=t.anchorLineEnabled,e.anchorLineColor=t.anchorLineColor,e.image=t.image,e.disableDepthTestDistance=t.disableDepthTestDistance,e.horizontalOrigin=t.horizontalOrigin,e.verticalOrigin=t.verticalOrigin,e.labelHorizontalOrigin=t.labelHorizontalOrigin,e.labelVerticalOrigin=t.labelVerticalOrigin,e.exOffset=t.exOffset,e.translation=t.translation,e.scale=t.scale,e.rotation=t.rotation;var n={};if(Ze(t.meta)){var r=t.defines,i=Je(t.meta,Je.EMPTY_OBJECT);for(var o in i)i.hasOwnProperty(o)&&(n[o]=new Jc(i[o],r))}e._meta=n,e._ready=!0}(n,e),n})}function EN(e,t){var n=Je(e._style,Je.EMPTY_OBJECT).defines;if(Ze(t))return"boolean"==typeof t||"number"==typeof t?new Jc(String(t)):"string"==typeof t?new Jc(t,n):Ze(t.conditions)?new vN(t,n):t}function TN(e){if(Ze(e))return Ze(e.expression)?e.expression:Ze(e.conditionsExpression)?$e(e.conditionsExpression,!0):e}HL.prototype.trimLoadedTiles=function(){this._cache.trim()},HL.prototype.update=function(e){this.updateForPass(e,e.tilesetPassState)},HL.prototype.updateForPass=function(e,t){var n,r,i,o,a,s,u,l,c=t.pass;c===TP.PRELOAD&&(!this.preloadWhenHidden||this.show)||!(c!==TP.PRELOAD_FLIGHT||this.preloadFlightDestinations&&(this.show||this.preloadWhenHidden))||c===TP.REQUEST_RENDER_MODE_DEFER_CHECK&&(!this._cullRequestsWhileMoving&&this.foveatedTimeDelay<=0||!this.show)||(n=e.commandList,r=e.camera,i=e.cullingVolume,t.ready=!1,a=(o=TP.getPassOptions(c)).ignoreCommands,u=(s=Je(t.commandList,n)).length,e.commandList=s,e.camera=Je(t.camera,r),e.cullingVolume=Je(t.cullingVolume,i),l=this._statisticsPerPass[c],(this.show||a)&&(this._pass=c,t.ready=yN(this,e,l,o)),a&&(s.length=u),e.commandList=n,e.camera=r,e.cullingVolume=i)},HL.prototype.hasExtension=function(e){return!!Ze(this._extensionsUsed)&&-1<this._extensionsUsed.indexOf(e)},HL.prototype.isDestroyed=function(){return!1},HL.prototype.destroy=function(){if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Ze(this._root)){var e=mN;for(e.push(this._root);0<e.length;){var t=e.pop();t.destroy();for(var n=t.children,r=n.length,i=0;i<r;++i)e.push(n[i])}}return this._root=void 0,Vt(this)},HL.prototype.addNode_ev=function(e,t){if(e&&0==e.children.length){var n=rt.createIfNeeded(this._url);if(Ze(t)&&0<t.length)for(var r=0;r<t.length;++r){var i=t[r],o=!1;Ze(i.boundingVolume)||(i.boundingVolume={},i.boundingVolume.sphere=[0,0,0,0],o=!0);var a=new rL(this,n,i,e);o&&(a._boundingVolume=e._boundingVolume),!Ze(a._header.EVID)&&Ze(e._header.EVID)&&(a._header.EVID=e._header.EVID),e.children.push(a),a._depth=e._depth+1,++this._statistics.numberOfTilesTotal}this._cullWithChildrenBounds&&NL.checkChildrenWithinParent(e)}},HL.prototype.tramsformTreeTableMap=function(e){try{var t=!0;for(var n in this.sharedResources.treeTables)Ze(this.sharedResources.treeTables[n].elementName)||(t=!1);t&&this.loadedTreeTables.raiseEvent(this.sharedResources.treeTables);var r=new Od,i=e,o=new kI;for(o.push(i);0<o.length;){var a=o.pop();if(r.get(a.elementName)?r.get(a.elementName).push(a.id):r.set(a.elementName,[a.id]),Ze(a.children))for(var s=0;s<a.children.length;++s){var u=a.children[s];o.push(u)}}this.treeTableMaps.push(r)}catch(e){return e}},Object.defineProperties(vN.prototype,{conditionsExpression:{get:function(){return this._conditionsExpression}}}),vN.prototype.evaluate=function(e,t){var n=this._runtimeConditions;if(Ze(n))for(var r=n.length,i=0;i<r;++i){var o=n[i];if(o.condition.evaluate(e))return o.expression.evaluate(e,t)}},vN.prototype.evaluateColor=function(e,t){var n=this._runtimeConditions;if(Ze(n))for(var r=n.length,i=0;i<r;++i){var o=n[i];if(o.condition.evaluate(e))return o.expression.evaluateColor(e,t)}},vN.prototype.getShaderFunction=function(e,t,n,r){var i=this._runtimeConditions;if(Ze(i)&&0!==i.length){for(var o="",a=i.length,s=0;s<a;++s){var u=i[s];o+="    "+(0===s?"if":"else if")+" ("+u.condition.getShaderExpression(t,n)+") \n    { \n        return "+u.expression.getShaderExpression(t,n)+"; \n    } \n"}return o=r+" "+e+"() \n{ \n"+o+"    return "+r+"(1.0); \n} \n"}},Object.defineProperties(bN.prototype,{style:{get:function(){return this._style}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},show:{get:function(){return this._show},set:function(e){this._show=EN(this,e),this._style.show=TN(this._show),this._showShaderFunctionReady=!1}},color:{get:function(){return this._color},set:function(e){this._color=EN(this,e),this._style.color=TN(this._color),this._colorShaderFunctionReady=!1}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=EN(this,e),this._style.pointSize=TN(this._pointSize),this._pointSizeShaderFunctionReady=!1}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=EN(this,e),this._style.pointOutlineColor=TN(this._pointOutlineColor)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=EN(this,e),this._style.pointOutlineWidth=TN(this._pointOutlineWidth)}},labelColor:{get:function(){return this._labelColor},set:function(e){this._labelColor=EN(this,e),this._style.labelColor=TN(this._labelColor)}},labelOutlineColor:{get:function(){return this._labelOutlineColor},set:function(e){this._labelOutlineColor=EN(this,e),this._style.labelOutlineColor=TN(this._labelOutlineColor)}},labelOutlineWidth:{get:function(){return this._labelOutlineWidth},set:function(e){this._labelOutlineWidth=EN(this,e),this._style.labelOutlineWidth=TN(this._labelOutlineWidth)}},font:{get:function(){return this._font},set:function(e){this._font=EN(this,e),this._style.font=TN(this._font)}},labelStyle:{get:function(){return this._labelStyle},set:function(e){this._labelStyle=EN(this,e),this._style.labelStyle=TN(this._labelStyle)}},labelText:{get:function(){return this._labelText},set:function(e){this._labelText=EN(this,e),this._style.labelText=TN(this._labelText)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=EN(this,e),this._style.backgroundColor=TN(this._backgroundColor)}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){this._backgroundPadding=EN(this,e),this._style.backgroundPadding=TN(this._backgroundPadding)}},backgroundEnabled:{get:function(){return this._backgroundEnabled},set:function(e){this._backgroundEnabled=EN(this,e),this._style.backgroundEnabled=TN(this._backgroundEnabled)}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){this._scaleByDistance=EN(this,e),this._style.scaleByDistance=TN(this._scaleByDistance)}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){this._translucencyByDistance=EN(this,e),this._style.translucencyByDistance=TN(this._translucencyByDistance)}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=EN(this,e),this._style.distanceDisplayCondition=TN(this._distanceDisplayCondition)}},heightOffset:{get:function(){return this._heightOffset},set:function(e){this._heightOffset=EN(this,e),this._style.heightOffset=TN(this._heightOffset)}},exOffset:{get:function(){return this._exOffset},set:function(e){this._exOffset=EN(this,e),this._style.exOffset=TN(this._exOffset)}},translation:{get:function(){return this._translation},set:function(e){this._translation=EN(this,e),this._style.translation=TN(this._translation)}},scale:{get:function(){return this._scale},set:function(e){this._scale=EN(this,e),this._style.scale=TN(this._scale)}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation=EN(this,e),this._style.rotation=TN(this._rotation)}},anchorLineEnabled:{get:function(){return this._anchorLineEnabled},set:function(e){this._anchorLineEnabled=EN(this,e),this._style.anchorLineEnabled=TN(this._anchorLineEnabled)}},anchorLineColor:{get:function(){return this._anchorLineColor},set:function(e){this._anchorLineColor=EN(this,e),this._style.anchorLineColor=TN(this._anchorLineColor)}},image:{get:function(){return this._image},set:function(e){this._image=EN(this,e),this._style.image=TN(this._image)}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance=EN(this,e),this._style.disableDepthTestDistance=TN(this._disableDepthTestDistance)}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin=EN(this,e),this._style.horizontalOrigin=TN(this._horizontalOrigin)}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin=EN(this,e),this._style.verticalOrigin=TN(this._verticalOrigin)}},labelHorizontalOrigin:{get:function(){return this._labelHorizontalOrigin},set:function(e){this._labelHorizontalOrigin=EN(this,e),this._style.labelHorizontalOrigin=TN(this._labelHorizontalOrigin)}},labelVerticalOrigin:{get:function(){return this._labelVerticalOrigin},set:function(e){this._labelVerticalOrigin=EN(this,e),this._style.labelVerticalOrigin=TN(this._labelVerticalOrigin)}},meta:{get:function(){return this._meta},set:function(e){this._meta=e}}}),bN.prototype.getColorShaderFunction=function(e,t,n){return this._colorShaderFunctionReady?n.translucent=this._colorShaderTranslucent:(this._colorShaderFunctionReady=!0,this._colorShaderFunction=Ze(this.color)?this.color.getShaderFunction(e,t,n,"vec4"):void 0,this._colorShaderTranslucent=n.translucent),this._colorShaderFunction},bN.prototype.getShowShaderFunction=function(e,t,n){return this._showShaderFunctionReady||(this._showShaderFunctionReady=!0,this._showShaderFunction=Ze(this.show)?this.show.getShaderFunction(e,t,n,"bool"):void 0),this._showShaderFunction},bN.prototype.getPointSizeShaderFunction=function(e,t,n){return this._pointSizeShaderFunctionReady||(this._pointSizeShaderFunctionReady=!0,this._pointSizeShaderFunction=Ze(this.pointSize)?this.pointSize.getShaderFunction(e,t,n,"float"):void 0),this._pointSizeShaderFunction};var SN=Object.freeze({IMAGE:0,DEM:1,E3M:2,CROSS:3});function CN(e){this._value=void 0,this._hasClone=!1,this._hasEquals=!1,this._definitionChanged=new U,this.setValue(e)}function wN(e){return new CN(e)}function AN(e,t,n){return i="_"+(r=e).toString(),o="_"+e.toString()+"Subscription",a=Je(t,!1),s=Je(n,wN),{configurable:a,get:function(){return this[i]},set:function(e){var t=this[i],n=this[o];Ze(n)&&(n(),this[o]=void 0),void 0===e||Ze(e)&&Ze(e.getValue)||!Ze(s)||(e=s(e)),t!==e&&(this[i]=e,this._definitionChanged.raiseEvent(this,r,e,t)),Ze(e)&&Ze(e.definitionChanged)&&(this[o]=e.definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this,r,e,e)},this))}};var r,i,o,a,s}function IN(){fe.throwInstantiationError()}function PN(e){e=Je(e,Je.EMPTY_OBJECT),this._definitionChanged=new U,this._centreColor=void 0,this._colorSubscription=void 0,this._duration=void 0,this._length=void 0,this._lengthSubscription=void 0,this._sideColor=void 0,this._startTime=void 0,this._stopTime=void 0,this._interval=void 0,this._alpha=1,this.centreColor=Je(e.centreColor,It.WHITE),this.duration=Je(e.duration,10),this.length=Je(e.length,1e-4),this.sideColor=Je(e.sideColor,It.DODGERBLUE),this.startTime=Je(e.startTime,Ja.now()),this.stopTime=Je(e.stopTime,Ja.addSeconds(this.startTime._value,this.duration._value,new Ja)),this.interval=Je(e.interval,.01)}function ON(e){var t=e.name;if(!Ze(t))throw new fe("name is required");if("string"!=typeof t)throw new fe("name is required to be a string ");var n=e.url;if(!Ze(n))throw new fe("url is required");var r,i;/\:\d+$/.test(n)&&(n+="/earthview/services/file/GetFileData/"+t+"/"),"object"!=typeof e.queryParam||(r=R(e.queryParam))&&(-1===(i=n.indexOf("?"))?n+="?"+r:i<n.length-1?n+="&"+r:n+=r),this._name=t,this._url=n,this._type=SN.E3M,this._customTag=e.customTag;var o=Je(e.e3mOption,{});Ze(o.url)||(o.url=n),this._cesiumLayer=new HL(o),this._selectedColor=Je(e.selectedColor,It.LIME),this._selectedName=void 0,this._selectedFeature=void 0,this._timer=void 0,this.layerShownOrHidden=new U,this.selectionChanged=new U,this.featureVisibleArray=new Od,this.flowLineEntities=[],Ze(e.e3mOption)&&Ze(e.e3mOption.meshLine)&&e.e3mOption.meshLine&&(this._cesiumLayer.style=new bN({color:{conditions:[["String(${color}) === 'Y'","rgba(255,255,0,1)"],["String(${color}) === 'G'","rgba(0,255,0,1)"],["String(${color}) === 'R'","rgba(255,0,0,1)"],["String(${color}) === 'B'","rgba(0,0,255,1)"],["true",'color("white")']]}}),this._cesiumLayer.meshLine=e.e3mOption.meshLine,this._cesiumLayer.meshLineColor=this._cesiumLayer.style.color,this._cesiumLayer.colorBlendMode=li.REPLACE),Ze(e.e3mOption)&&Ze(e.e3mOption.highPrecision)&&(this._cesiumLayer.highPrecision=e.e3mOption.highPrecision)}function LN(e,t,n){t.sort(function(e,t){return e-t});var r=t[0],i=[];i.push(r),i.push(n),e.set(r,i);for(var o=1;o<t.length;o++){var a,s=t[o-1];t[o]-1===s?((a=[]).push([r,t[o]]),a.push(n),e.set(r,a)):(Ze(e.get(r))||((a=[]).push(r),a.push(n),e.set(r,a)),r=t[o])}Ze(e.get(r))||((a=[]).push(r),a.push(n),e.set(r,a))}Object.defineProperties(CN.prototype,{isConstant:{value:!0},definitionChanged:{get:function(){return this._definitionChanged}}}),CN.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value},CN.prototype.setValue=function(e){var t,n,r,i=this._value;i!==e&&(n=(t=Ze(e))&&"function"==typeof e.clone,(r=t&&"function"==typeof e.equals)&&e.equals(i)||(this._hasClone=n,this._hasEquals=r,this._value=n?e.clone(this._value):e,this._definitionChanged.raiseEvent(this)))},CN.prototype.equals=function(e){return this===e||e instanceof CN&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))},CN.prototype.valueOf=function(){return this._value},CN.prototype.toString=function(){return String(this._value)},Object.defineProperties(IN.prototype,{isConstant:{get:fe.throwInstantiationError},definitionChanged:{get:fe.throwInstantiationError}}),IN.prototype.getValue=fe.throwInstantiationError,IN.prototype.equals=fe.throwInstantiationError,IN.equals=function(e,t){return e===t||Ze(e)&&e.equals(t)},IN.arrayEquals=function(e,t){if(e===t)return!0;if(!Ze(e)||!Ze(t)||e.length!==t.length)return!1;for(var n=e.length,r=0;r<n;r++)if(!IN.equals(e[r],t[r]))return!1;return!0},IN.isConstant=function(e){return!Ze(e)||e.isConstant},IN.getValueOrUndefined=function(e,t,n){return Ze(e)?e.getValue(t,n):void 0},IN.getValueOrDefault=function(e,t,n,r){return Ze(e)?Je(e.getValue(t,r),n):n},IN.getValueOrClonedDefault=function(e,t,n,r){var i;return Ze(e)&&(i=e.getValue(t,r)),Ze(i)||(i=n.clone(i)),i},Object.defineProperties(PN.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},centreColor:AN("centreColor"),duration:AN("duration"),length:AN("length"),sideColor:AN("sideColor"),startTime:AN("startTime"),stopTime:AN("stopTime"),interval:AN("interval")}),PN.prototype.getType=function(){return"FlowLine"},PN.prototype.getValue=function(e,t){Ze(t)||(t={});var n,r=IN.getValueOrDefault(this._length,e,.2,t.length),i=this._startTime.getValue(e),o=IN.getValueOrUndefined(this._stopTime,e),a=Ja.secondsDifference(e,i);Ze(o)||(n=IN.getValueOrDefault(this._duration,e,60),o=Ja.addSeconds(i,n,new Ja));var s=a/Ja.secondsDifference(o,i),u=this._alpha;return t.centreColor=IN.getValueOrClonedDefault(this._centreColor,e,It.WHITE,t.color),t.length=r,t.time=s,t.sideColor=IN.getValueOrClonedDefault(this._sideColor,e,It.WHITE,t.flyColor),t.interval=IN.getValueOrClonedDefault(this._interval,e,.01,t.interval),t.alpha=u,t},PN.prototype.equals=function(e){return this===e||e instanceof PN&&IN.equals(this._centreColor,e._centreColor)&&IN.equals(this._duration,e._duration)&&IN.equals(this._length,e._length)&&IN.equals(this._sideColor,e._sideColor)&&IN.equals(this._startTime,e._startTime)&&IN.equals(this._interval,e._interval)&&IN.equals(this._stopTime,e._stopTime)},_w.FlowLineType="FlowLine",_w._materialCache.addMaterial(_w.FlowLineType,{fabric:{type:_w.FlowLineType,uniforms:{centreColor:It.WHITE,sideColor:It.WHITE,length:.2,time:0,alpha:1,interval:.01},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n        {\n            czm_material material=czm_getDefaultMaterial(materialInput);\n            vec2 st=materialInput.st;\n            material.diffuse=centreColor.rgb;\n            material.alpha=0.0;\n            float pos = time*interval;\n            float count = mod(st.s,interval);\n            float end = pos - count;\n            if(end>0.0)\n            {\n                if(end<length)\n                {\n                    if(end<length*0.5)\n                    {\n                        float step = 1.0-2.0*end/length;\n                        step = step>0.4? 1.0:step;\n                        vec4 color = mix(centreColor,sideColor,step);\n                         material.diffuse=color.rgb;\n                         material.alpha=color.a;\n                    }else{\n                        float step = 2.0*end/length -1.0;                        step = step>0.4? 1.0:step;\n                        vec4 color = mix(centreColor,sideColor,step);\n                        material.diffuse=color.rgb;\n                        material.alpha=color.a;\n                    }\n                }else{\n                    material.alpha=0.0;\n                }\n            }\n            return material;\n        }"},translucent:function(){return!0}}),Object.defineProperties(ON.prototype,{name:{get:function(){return this._name}},url:{get:function(){return this._url}},type:{get:function(){return this._type}},customTag:{get:function(){return this._customTag},set:function(e){this._customTag=e}},show:{get:function(){return this._cesiumLayer.show},set:function(e){"boolean"!=typeof e?console.warn("visible is required to be a boolean"):this._cesiumLayer.show!==e&&(this._cesiumLayer.show=e,this.layerShownOrHidden.raiseEvent(this,0,this._cesiumLayer.show))}},selectedColor:{get:function(){return this._selectedColor},set:function(e){e instanceof It&&!It.equals(this._selectedColor,e)&&(this._selectedColor=e,UN(this))}},selectedFeature:{get:function(){return this._selectedFeature},set:function(e){this._selectedFeature&&this._selectedFeature!==e&&this._selectedFeature,this._selectedFeature!==e&&(this._selectedFeature=e,UN(this),this.selectionChanged.raiseEvent(this,this._selectedFeature))}}}),ON.prototype.getCesiumLayer=function(){return this._cesiumLayer},ON.prototype.setSelectedComponentName=function(e){"string"==typeof e&&this._selectedName!==e&&(this._selectedName=e,UN(this)),e||this.clearSelection()},ON.prototype.getSelectedComponentName=function(){return this._selectedName},ON.prototype.clearSelection=function(){var e=this.getCesiumLayer(),t=new bN({color:"color('white')"});Ze(e.style)&&(t.show=e.style.show),e.style=t,this._selectedFeature,this._selectedName=void 0,this._selectedFeature=void 0,this.selectionChanged.raiseEvent(this,void 0)},ON.prototype.raiseHeight=function(e){var t=this.getCesiumLayer(),n=Un.fromCartesian(t.boundingSphere.center),r=_t.fromRadians(n.longitude,n.latitude,0),i=_t.fromRadians(n.longitude,n.latitude,e),o=_t.subtract(i,r,new _t);t.modelMatrix=on.fromTranslation(o)},ON.prototype.getCenter=function(){var e=this.getCesiumLayer();return Un.fromCartesian(e.boundingSphere.center)},ON.prototype.setFeaturesVisible=function(e,t,n,r){Ze(r)||(r=!0);for(var i=[],o=0;o<t.length;o++){var a=t[o];"string"==typeof a&&(a='"'+a+'"'),(u=[]).push(a),u.push(n),this.featureVisibleArray.set(a,u)}for(var s=function(e,t,n){var r=new Od,i=[];if(t&&!n||!t&&!n){for(var o=0;o<e.length;o++){(a=e.values[o])[1]&&("number"==typeof a[0]?i.push(a[0]):r.set(a[0],a))}return 0<i.length&&LN(r,i,!0),r}if(t&&n||!t&&n){for(var a,o=0;o<e.length;o++){(a=e.values[o])[1]||("number"==typeof a[0]?i.push(a[0]):r.set(a[0],a))}return 0<i.length&&LN(r,i,!1),r}}(this.featureVisibleArray,n,r),o=0;o<s.length;o++){var u,l,c=[];"number"==typeof(u=s.values[o])[0]?c.push("${"+e+"} === "+u[0]):(l="${"+e+"} >= "+u[0][0]+" && ${"+e+"} <= "+u[0][1],c.push(l)),c.push(u[1]),i.push(c)}var h=[];h.push("true"),h.push(r),i.push(h),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.show={conditions:i},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({show:{conditions:i}})},ON.prototype.setPartFeaturesVisible=function(e,t,n){Ze(n)||(n=!0);for(var r="",i=[],o=[],a=0;a<e.length;a++){r="";var s=e[a];for(var u in s){var l,c=s[u];"number"==typeof c?r+="${"+u+"} ==="+c+" && ":"string"==typeof c?r+="${"+u+'} ==="'+c+'" && ':(l=c.length,i=[],r=r,"number"==typeof c[0]&&(r+="${"+u+"} >="+c[0]+" && "),2==l&&"number"==typeof c[1]&&(r+="${"+u+"} <="+c[1]+" && "),r=r.substr(0,r.length-4),i.push(r),i.push(t),o.push(i))}}var h=[];h.push("true"),h.push(n),o.push(h),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.show={conditions:o},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({show:{conditions:o}})};var NN=[],RN=[];function DN(e){for(var t in e){var n=e[t];Ze(n.children)&&DN(n.children),NN.push(n)}return NN}function MN(e){for(var t=0;t<e.length;t++)RN.push(e[t].id),Ze(e[t].children)&&MN(e[t].children);return RN}function FN(e,t){for(var n=0;n<e.length;n++){var r=e[n];Ze(r.children)?FN(r.children,t):t.push(r.id)}}function zN(e,t,n){for(var r=[],i=0;i<t.length;i++)for(var o=t[i],a=o.property,s=0===n?o.color0:o.color1,u=s.toCssColorString(),l=o[a],c=0;c<l.length;c++){var h=l[c];"string"==typeof h&&(h='"'+h+'"');var f=[];f.push("${"+a+"} === "+h),f.push(u),r.push(f)}var p,d,m=[];m.push("true"),m.push("color('white')"),r.push(m),Ze(e.style)?(p=e.style.show,(d=new bN({color:{conditions:r}})).show=p,e.style=d):e.style=new bN({color:{conditions:r}})}function BN(e){for(var t=[],n=0;n<360;n+=36){var r=pt.toRadians(n);t.push(new En(e*Math.cos(r),e*Math.sin(r)))}return t}function UN(e){var t,n=e.getSelectedComponentName(),r=e.selectedColor;e.show&&n&&((t=[]).push(n),e.setFeaturesColor("name",t,r))}ON.prototype.getIdScope=function(t){var e=this._cesiumLayer.sharedResources.treeTables;NN=[],i=[];var n=DN(e),r=n.filter(function(e){return e.id===t});if(Ze(r)){!Ze(r[0].parentId)&&Ze(r[0].children[0])&&(r[0].parentId=r[0].children[0].parentId);for(var i=MN(n.filter(function(e){if(Ze(e.parentId))return e.parentId===r[0].parentId})),o=i[0],a=i[0],s=1;s<i.length;s++)i[s]>o&&(o=i[s]),i[s]<a&&(a=i[s]);return i=[],[a,o]}},ON.prototype.clearFeaturesVisible=function(){this.featureVisibleArray.removeAll(),this.setFeaturesVisible("id",[],!0)},ON.prototype.setFeaturesColor=function(e,t,n){var r=[];if(!(n instanceof It))throw new fe("必须输入颜色.");for(var i=n.toCssColorString(),o=0;o<t.length;o++){var a=t[o];"string"==typeof a&&(a='"'+a+'"');var s=[];s.push("${"+e+"} === "+a),s.push(i),r.push(s)}var u=[];u.push("true"),u.push("color('white')"),r.push(u),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:r},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({color:{conditions:r}})},ON.prototype.setColorById=function(t,e,n){NN=[],RN=[];var r=[],i=[];if(i.push("${id} === "+t),!(e instanceof It))throw new fe("必须输入颜色.");if(Ze(n)){i=[];var o=this._cesiumLayer.sharedResources.treeTables,a=DN(o);for(var s in o){Ze(o[s].id)}var u=function e(t,n,r){if(null==t)return[];for(var i in t){if(r.push(t[i].id),n(t[i]))return r;if(t[i].children){var o=e(t[i].children,n,r);if(o.length)return o}r.pop()}return[]}(o,function(e){return e.id===t},[]);if(u.pop(),!(n<=u.length))throw new fe("父节点层级数超出范围！");for(var l=MN(a.filter(function(e){if(Ze(e.id))return e.id===u[u.length-n]})),c=l[0],h=l[0],f=1;f<l.length;f++)l[f]>c&&(c=l[f]),l[f]<h&&(h=l[f]);i.push("${id} >= "+h+" && ${id} <= "+c)}var p=e.toCssColorString();i.push(p),r.push(i);var d=[];d.push("true"),d.push("color('white')"),r.push(d),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:r},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({color:{conditions:r}})},ON.prototype.setFeaturesColors=function(e,t,n){for(var r=[],i=0;i<t.length;i++){var o=t[i];"string"==typeof o&&(o='"'+o+'"');var a=[];a.push("${"+e+"} === "+o);var s=n[i];Ze(s)||(s=It.WHITE);var u=s.toCssColorString();a.push(u),r.push(a)}var l=[];l.push("true"),l.push("color('white')"),r.push(l),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:r},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({color:{conditions:r}})},ON.prototype.getFeatureBoundingBoxInWC=function(e,t){var n=void 0,r=this._cesiumLayer.treeTable;if("name"===e){for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){var o=r[i];for((u=new kI).push(o);0<u.length;){if((l=u.pop()).elementName==t){n={MAX:l.MAX,MIN:l.MIN};break}if(Ze(l.children))for(var a=0;a<l.children.length;++a){var s=l.children[a];u.push(s)}}if(Ze(n))break}}else{if("id"!==e)return console.log("属性名不符合要求"),n;for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){var u,l,o=r[i];for((u=new kI).push(o);0<u.length;){if((l=u.pop()).id==t){n={MAX:l.MAX,MIN:l.MIN};break}if(l["id:"]==t){n={MAX:l.MAX,MIN:l.MIN};break}if(Ze(l.children))for(a=0;a<l.children.length;++a){s=l.children[a];u.push(s)}}if(Ze(n))break}}var c=void 0,h=new kI;for(h.push(this._cesiumLayer.root);0<h.length;){var f=h.pop();if(Ze(f._header)&&Ze(f._header.transform)){var p=on.unpack(f.computedTransform),c=on.multiplyTransformation(p,xn.Y_UP_TO_Z_UP,new on);break}if(Ze(f.children))for(var d=0;d<f.children.length;++d){s=f.children[d];h.push(s)}}return Ze(n)&&Ze(c)&&(n.MIN=on.multiplyByPoint(c,_t.unpack(n.MIN),new _t),n.MAX=on.multiplyByPoint(c,_t.unpack(n.MAX),new _t)),n},ON.prototype.getAllChildNode=function(e,t){var n=this._cesiumLayer.treeTable,r=[];if("id"===e)for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var o=n[i],a=new kI,s=new kI;for(a.push(o);0<a.length;){var u=a.pop();if(u.id==t){s=u.children;break}if(Ze(u.children))for(var l=0;l<u.children.length;++l){var c=u.children[l];a.push(c)}}return Ze(s)?FN(s,r):r.push(u.id),r}},ON.prototype.getComponentsInCullingVolume=function(e){var t=void 0,n=new kI;for(n.push(this._cesiumLayer.root);0<n.length;){var r=n.pop();if(Ze(r._header)&&Ze(r._header.transform)){var i=on.unpack(r.computedTransform),t=on.multiplyTransformation(i,xn.Y_UP_TO_Z_UP,new on);break}if(Ze(r.children))for(var o=0;o<r.children.length;++o){var a=r.children[o];n.push(a)}}var s=[];if(!Ze(t))return s;var u=this._cesiumLayer.treeTable;for(var l in u)if(Object.prototype.hasOwnProperty.call(u,l)){var c=u[l],h=new kI;for(h.push(c);0<h.length;){var f=h.pop(),p=on.multiplyByPoint(t,_t.unpack(f.MIN),new _t),d=on.multiplyByPoint(t,_t.unpack(f.MAX),new _t),m=ko.fromCornerPoints(p,d);if(e.computeVisibility(m)!==Jn.OUTSIDE&&s.push(f),Ze(f.children))for(var _=0;_<f.children.length;++_){a=f.children[_];h.push(a)}}0}return s},ON.prototype.setFeaturesColorsByTreeTableMap=function(o,e,t){var a=[];if("name"==o){for(var n=[],r=this._cesiumLayer.treeTableMaps,i=0;i<r.length;i++)for(var s=r[i],u=0;u<e.length;u++)for(var l=s.get(e[u]),c=0;c<l.length;c++)n.push({id:l[c],color:t[u]});o="id",au.object(n,function(e){var t=e.id,n=e.color;"string"==typeof t&&(t='"'+t+'"');var r=[];r.push("${"+o+"} === "+t),Ze(n)||(n=It.WHITE);var i=n.toCssColorString();r.push(i),a.push(r)})}else for(var h=0;h<e.length;h++){var f=e[h];"string"==typeof f&&(f='"'+f+'"');var p=[];p.push("${"+o+"} === "+f);var d=t[h];Ze(d)||(d=It.WHITE);var m=d.toCssColorString();p.push(m),a.push(p)}var _=[];_.push("true"),_.push("color('white')"),a.push(_),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:a},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({color:{conditions:a}})},ON.prototype.setFeaturesAlpha=function(e,t,n){n<0&&(n=0),1<n&&(n=1);var r=[],i='color("white", '+n+")";if(Array.isArray(e)){if(e.length!=t.length||2!=e.length)return;for(var o=[],a=0;a<e.length;a++){for(var s=[],u=0;u<t[a].length;u++){"string"==typeof(f=t[a][u])&&(f='"'+f+'"'),s.push("${"+e[a]+"} === "+f)}o.push(s)}for(a=0;a<o[0].length;a++)for(var l=o[0][a],u=0;u<o[1].length;u++){var c=o[1][u],h=[];h.push(l+"&&"+c),h.push(i),r.push(h)}}else for(var f,a=0;a<t.length;a++){"string"==typeof(f=t[a])&&(f='"'+f+'"'),(s=[]).push("${"+e+"} === "+f),s.push(i),r.push(s)}var p=[];p.push("true"),p.push("color('white')"),r.push(p),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:r},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({color:{conditions:r}})},ON.prototype.setLayerAlpha=function(e){e<0&&(e=0),1<e&&(e=1);var t=[],n='color("white", '+e+")",r=[];r.push("true"),r.push(n),t.push(r),Ze(this._cesiumLayer.style)?(this._cesiumLayer.style.color={conditions:t},this._cesiumLayer._styleEngine._styleDirty=!0):this._cesiumLayer.style=new bN({color:{conditions:t}})},ON.prototype.setFeaturesBlink=function(e,t){var n=0;Ze(this._timer)&&(clearInterval(this._timer),this._timer=void 0);var r=this;this._timer=setInterval(function(){zN(r._cesiumLayer,e,n%2==0?0:1),n++},1e3*t)},ON.prototype.clearFeaturesBlink=function(){Ze(this._timer)&&(clearInterval(this._timer),this._timer=void 0),Ze(this._cesiumLayer.style)&&Ze(this._cesiumLayer.style.color)&&(this._cesiumLayer.style.color=void 0,this._cesiumLayer._styleEngine._styleDirty=!0)},ON.prototype.setFlowLine=function(e,n){var r=this._cesiumLayer,t=e.startTime,i=new PN({duration:e.duration,startTime:t,interval:e.interval}),o=this.flowLineEntities;r.allTilesLoaded.addEventListener(function(){var e=r.flowLines;if(!e)throw new fe("数据不支持显示电流流动!");for(var t=0;t<e.length;t++)o.push(n.add({polylineVolume:{positions:e[t],shape:BN(.023),material:i,isOffset:!0}}))})},ON.prototype.setFlowLineVisible=function(e){if("boolean"==typeof e)for(var t=this.flowLineEntities,n=0;n<t.length;n++)t[n].show=e},ON.prototype.getModelInfoByEVID=function(c,h){var f,p,e,t,n,r;!Ze(c)||(f=this._cesiumLayer).ready&&(p=void 0,r=f._url,Ze(p)||(e=f.EVDataSetName,(t=f._url).endsWith(".json")&&(n=t.lastIndexOf("/"),r=t.substr(0,n+1)),p=r+e+"/DATA/0_0_0/record.json"),D(rt.createIfNeeded(p).fetchJson(),function(e){if(Ze(e)){for(var t,a,s,n=e.recordInfos,r=void 0,i=0;i<n.length;i++){var o=n[i];if(o.EVID==c){(r={content:{},boundingVolume:{}}).content.uri=o.modelPath,r.boundingVolume.sphere=o.sphere;var u=_t.fromDegrees(o.longitude,o.latitude,o.altitude),l=bs.eastNorthUpToFixedFrame(u);r.transform=on.toArray(l);break}}Ze(r)&&(t=rt.createIfNeeded(p),(a=new rL(f,t,r,void 0)).requestContent(),s=void 0,a.contentReadyToProcessPromise.then(function(){var e=a.content;if(e instanceof oE)for(var t=e._contents,n=0;n<t.length;n++){var r=t[n];if(r instanceof qx){var i=$e(r._model,!1),o=$e(a.boundingSphere,!0);(s={}).model=i,s.boundingSphere=o;break}}a.destroy(),Ze(h)&&h(s)}))}}))},ON.prototype.getJsonInfo=function(o){var a={},s=this.url;rt.fetchJson({url:s}).then(function(e){a.gltfUpAxis=e.asset.gltfUpAxis,a.boundingVolume=e.root.boundingVolume;var i=s.lastIndexOf("/"),t=s.slice(0,i+1)+e.root.content.uri;rt.fetchJson({url:t}).then(function(e){var t,n,r;e.root.children[0].modeltree?(t=e.root.children[0].modeltree.uri,a.transform=e.root.children[0].transform,n=t.lastIndexOf("../"),r=s.slice(0,i)+t.slice(n+2,t.length),rt.fetchJson({url:r}).then(function(e){a.modeltree=e,o(a)})):o(a)})})},ON.prototype.changeTilePosition=function(e,t,n,r,i,o,a){var s=this._cesiumLayer;if(s.ready){if(!Ze(e)||!Ze(t))throw new fe("经度和纬度需要传入！");if(Ze(r)&&(!Ze(i)||!Ze(o)))throw new fe("俯仰、偏航、翻滚角都需要传入！");if(Ze(i)&&(!Ze(r)||!Ze(o)))throw new fe("俯仰、偏航、翻滚角都需要传入！");if(Ze(o)&&(!Ze(i)||!Ze(r)))throw new fe("俯仰、偏航、翻滚角都需要传入！");var u,l=Ze(n)?n:0,c=Ze(r)?r:0,h=Ze(i)?i:0,f=Ze(o)?o:0,p=_t.fromRadians(e,t,l),d=new as(c,h,f),m=bs.headingPitchRollToFixedFrame(p,d);if(Ze(a)){if(Ze(s.root))for((u=[]).push(s.root);0<u.length;){if(Ze((y=u.pop())._header)&&Ze(y._header.EVID)&&y._header.EVID==a){y.transform=m;break}for(var _=(I=y.children).length,g=0;g<_;++g)u.push(I[g])}}else if(Ze(s.root)){(u=[]).push(s.root);for(var y,v,x,b,E,T,S,C,w,A=void 0;0<u.length;){if(Ze((y=u.pop())._header)&&Ze(y._header.transform)){A=y._header.transform;break}for(var I,_=(I=y.children).length,g=0;g<_;++g)u.push(I[g])}Ze(A)&&(T=E=void 0,Ze(r)||Ze(i)||Ze(o)||(v=new _t,on.getTranslation(A,v),x=bs.headingPitchRollToFixedFrame(v,new as(0,0,0)),b=new on,E=on.inverse(x,b),T=on.multiply(E,A,b),S=new jt,on.getMatrix3(T,S),C=Si.fromRotationMatrix(S),d=as.fromQuaternion(C),m=bs.headingPitchRollToFixedFrame(p,d)),w=new on,E=on.inverse(A,w),T=on.multiply(m,E,w),s.modelMatrix=T)}}};var VN=6371008.8,kN={meters:VN,metres:VN,millimeters:1e3*VN,millimetres:1e3*VN,centimeters:100*VN,centimetres:100*VN,kilometers:VN/1e3,kilometres:VN/1e3,miles:VN/1609.344,nauticalmiles:VN/1852,inches:39.37*VN,yards:VN/1.0936,feet:3.28084*VN,radians:1,degrees:VN/111325},GN={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/VN,degrees:1/111325},qN={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function HN(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.bbox,i=n.id;if(void 0===e)throw new Error("geometry is required");if(t&&t.constructor!==Object)throw new Error("properties must be an Object");r&&dR(r),i&&mR(i);var o={type:"Feature"};return i&&(o.id=i),r&&(o.bbox=r),o.properties=t||{},o.geometry=e,o}function WN(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r,i=n.bbox;if(!e)throw new Error("type is required");if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");switch(i&&dR(i),e){case"Point":r=YN(t).geometry;break;case"LineString":r=QN(t).geometry;break;case"Polygon":r=jN(t).geometry;break;case"MultiPoint":r=eR(t).geometry;break;case"MultiLineString":r=$N(t).geometry;break;case"MultiPolygon":r=tR(t).geometry;break;default:throw new Error(e+" is invalid")}return i&&(r.bbox=i),r}function YN(e,t,n){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!fR(e[0])||!fR(e[1]))throw new Error("coordinates must contain numbers");return HN({type:"Point",coordinates:e},t,n)}function XN(e,t,n){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return JN(e.map(function(e){return YN(e,t)}),n)}function jN(e,t,n){if(!e)throw new Error("coordinates is required");for(var r=0;r<e.length;r++){var i=e[r];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<i[i.length-1].length;o++){if(0===r&&0===o&&!fR(i[0][0])||!fR(i[0][1]))throw new Error("coordinates must contain numbers");if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}}return HN({type:"Polygon",coordinates:e},t,n)}function KN(e,t,n){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return JN(e.map(function(e){return jN(e,t)}),n)}function QN(e,t,n){if(!e)throw new Error("coordinates is required");if(e.length<2)throw new Error("coordinates must be an array of two or more positions");if(!fR(e[0][1])||!fR(e[0][1]))throw new Error("coordinates must contain numbers");return HN({type:"LineString",coordinates:e},t,n)}function ZN(e,t,n){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return JN(e.map(function(e){return QN(e,t)}),n)}function JN(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.bbox,r=t.id;if(!e)throw new Error("No features passed");if(!Array.isArray(e))throw new Error("features must be an Array");n&&dR(n),r&&mR(r);var i={type:"FeatureCollection"};return r&&(i.id=r),n&&(i.bbox=n),i.features=e,i}function $N(e,t,n){if(!e)throw new Error("coordinates is required");return HN({type:"MultiLineString",coordinates:e},t,n)}function eR(e,t,n){if(!e)throw new Error("coordinates is required");return HN({type:"MultiPoint",coordinates:e},t,n)}function tR(e,t,n){if(!e)throw new Error("coordinates is required");return HN({type:"MultiPolygon",coordinates:e},t,n)}function nR(e,t,n){if(!e)throw new Error("geometries is required");if(!Array.isArray(e))throw new Error("geometries must be an Array");return HN({type:"GeometryCollection",geometries:e},t,n)}function rR(e,t){if(null==e||isNaN(e))throw new Error("num is required");if(t&&!(0<=t))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n}function iR(e,t){if(null==e)throw new Error("radians is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var n=kN[t||"kilometers"];if(!n)throw new Error(t+" units is invalid");return e*n}function oR(e,t){if(null==e)throw new Error("distance is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var n=kN[t||"kilometers"];if(!n)throw new Error(t+" units is invalid");return e/n}function aR(e,t){return uR(oR(e,t))}function sR(e){if(null==e)throw new Error("bearing is required");var t=e%360;return t<0&&(t+=360),t}function uR(e){if(null==e)throw new Error("radians is required");return 180*(e%(2*Math.PI))/Math.PI}function lR(e){if(null==e)throw new Error("degrees is required");return e%360*Math.PI/180}function cR(e,t,n){if(null==e)throw new Error("length is required");if(!(0<=e))throw new Error("length must be a positive number");return iR(oR(e,t),n||"kilometers")}function hR(e,t,n){if(null==e)throw new Error("area is required");if(!(0<=e))throw new Error("area must be a positive number");var r=qN[t||"meters"];if(!r)throw new Error("invalid original units");var i=qN[n||"kilometers"];if(!i)throw new Error("invalid final units");return e/r*i}function fR(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function pR(e){return!!e&&e.constructor===Object}function dR(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(e){if(!fR(e))throw new Error("bbox must only contain numbers")})}function mR(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}var _R=Object.freeze({earthRadius:VN,factors:kN,unitsFactors:GN,areaFactors:qN,feature:HN,geometry:WN,point:YN,points:XN,polygon:jN,polygons:KN,lineString:QN,lineStrings:ZN,featureCollection:JN,multiLineString:$N,multiPoint:eR,multiPolygon:tR,geometryCollection:nR,round:rR,radiansToLength:iR,lengthToRadians:oR,lengthToDegrees:aR,bearingToAzimuth:sR,radiansToDegrees:uR,degreesToRadians:lR,convertLength:cR,convertArea:hR,isNumber:fR,isObject:pR,validateBBox:dR,validateId:mR,radians2degrees:function(){throw new Error("method has been renamed to `radiansToDegrees`")},degrees2radians:function(){throw new Error("method has been renamed to `degreesToRadians`")},distanceToDegrees:function(){throw new Error("method has been renamed to `lengthToDegrees`")},distanceToRadians:function(){throw new Error("method has been renamed to `lengthToRadians`")},radiansToDistance:function(){throw new Error("method has been renamed to `radiansToLength`")},bearingToAngle:function(){throw new Error("method has been renamed to `bearingToAzimuth`")},convertDistance:function(){throw new Error("method has been renamed to `convertLength`")}});function gR(e,t,n){if(null!==e)for(var r,i,o,a,s,u,l,c=0,h=0,f=e.type,p="FeatureCollection"===f,d="Feature"===f,m=p?e.features.length:1,_=0;_<m;_++){a=(l=!!(u=p?e.features[_].geometry:d?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var g=0;g<a;g++){var y,v=0,x=0;if(null!==(y=l?u.geometries[g]:u)){s=y.coordinates;var b=y.type,c=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1;switch(b){case null:break;case"Point":t(s,h,_,v,x),h++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<s.length;r++)t(s[r],h,_,v,x),h++,"MultiPoint"===b&&v++;"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<s.length;r++){for(i=0;i<s[r].length-c;i++)t(s[r][i],h,_,v,x),h++;"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(r=0;r<s.length;r++){for("MultiPolygon"===b&&(x=0),i=0;i<s[r].length;i++){for(o=0;o<s[r][i].length-c;o++)t(s[r][i][o],h,_,v,x),h++;x++}v++}break;case"GeometryCollection":for(r=0;r<y.geometries.length;r++)gR(y.geometries[r],t,n);break;default:throw new Error("Unknown Geometry Type")}}}}}function yR(e,o,a,t){var s=a;return gR(e,function(e,t,n,r,i){s=0===t&&void 0===a?e:o(s,e,t,n,r,i)},t),s}function vR(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length;n++)t(e.features[n].properties,n);break;case"Feature":t(e.properties,0)}}function xR(e,n,r){var i=r;return vR(e,function(e,t){i=0===t&&void 0===r?e:n(i,e,t)}),i}function bR(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)t(e.features[n],n)}function ER(e,n,r){var i=r;return bR(e,function(e,t){i=0===t&&void 0===r?e:n(i,e,t)}),i}function TR(e){var t=[];return gR(e,function(e){t.push(e)}),t}function SR(e,t){for(var n,r,i,o,a,s,u,l,c,h=0,f="FeatureCollection"===e.type,p="Feature"===e.type,d=f?e.features.length:1,m=0;m<d;m++){for(a=f?e.features[m].geometry:p?e.geometry:e,u=f?e.features[m].properties:p?e.properties:{},l=f?e.features[m].bbox:p?e.bbox:void 0,c=f?e.features[m].id:p?e.id:void 0,o=(s=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<o;r++)if(null!==(i=s?a.geometries[r]:a))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":t(i,h,u,l,c);break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)t(i.geometries[n],h,u,l,c);break;default:throw new Error("Unknown Geometry Type")}else t(null,h,u,l,c);h++}}function CR(e,o,a){var s=a;return SR(e,function(e,t,n,r,i){s=0===t&&void 0===a?e:o(s,e,t,n,r,i)}),s}function wR(e,s){SR(e,function(e,n,r,t,i){var o,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return void s(HN(e,r,{bbox:t,id:i}),n,0)}switch(a){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}e.coordinates.forEach(function(e,t){s(HN({type:o,coordinates:e},r),n,t)})})}function AR(e,r,i){var o=i;return wR(e,function(e,t,n){o=0===t&&0===n&&void 0===i?e:r(o,e,t,n)}),o}function IR(e,h){wR(e,function(s,u,l){var e,c=0;!s.geometry||"Point"!==(e=s.geometry.type)&&"MultiPoint"!==e&&yR(s,function(e,t,n,r,i,o){var a=QN([e,t],s.properties);return h(a,u,l,o,c),c++,t})})}function PR(e,o,a){var s=a,u=!1;return IR(e,function(e,t,n,r,i){s=!1===u&&void 0===a?e:o(s,e,t,n,r,i),u=!0}),s}function OR(e,a){if(!e)throw new Error("geojson is required");wR(e,function(e,t,n){if(null!==e.geometry){var r=e.geometry.type,i=e.geometry.coordinates;switch(r){case"LineString":a(e,t,n,0,0);break;case"Polygon":for(var o=0;o<i.length;o++)a(QN(i[o],e.properties),t,n,o)}}})}function LR(e,i,o){var a=o;return OR(e,function(e,t,n,r){a=0===t&&void 0===o?e:i(a,e,t,n,r)}),a}var NR=Object.freeze({coordEach:gR,coordReduce:yR,propEach:vR,propReduce:xR,featureEach:bR,featureReduce:ER,coordAll:TR,geomEach:SR,geomReduce:CR,flattenEach:wR,flattenReduce:AR,segmentEach:IR,segmentReduce:PR,lineEach:OR,lineReduce:LR});function RR(e){var t=[1/0,1/0,-1/0,-1/0];return gR(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}function DR(e){if(!e)throw new Error("obj is required");var t=MR(e);if(1<t.length&&fR(t[0])&&fR(t[1]))return t;throw new Error("Coordinate is not a valid Point")}function MR(e){if(!e)throw new Error("obj is required");var t;if(e.length?t=e:e.coordinates?t=e.coordinates:e.geometry&&e.geometry.coordinates&&(t=e.geometry.coordinates),t)return FR(t),t;throw new Error("No valid coordinates")}function FR(e){if(1<e.length&&fR(e[0])&&fR(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return FR(e[0]);throw new Error("coordinates must only contain numbers")}function zR(e,t,n){if(!t||!n)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.type)}function BR(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)}function UR(e,t,n){if(!e)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0;r<e.features.length;r++){var i=e.features[r];if(!i||"Feature"!==i.type||!i.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!i.geometry||i.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+i.geometry.type)}}function VR(e){if(!e)throw new Error("geojson is required");if(void 0!==e.geometry)return e.geometry;if(e.coordinates||e.geometries)return e;throw new Error("geojson must be a valid Feature or Geometry Object")}function kR(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")}function GR(e,t){if(!e)throw new Error((t||"geojson")+" is required");if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error((t||"geojson")+" is invalid")}var qR=Object.freeze({getCoord:DR,getCoords:MR,containsNumber:FR,geojsonType:zR,featureOf:BR,collectionOf:UR,getGeom:VR,getGeomType:kR,getType:GR}),HR={successCallback:null,verbose:!1},WR={};function YR(e,t,n){n=n||{};for(var r=Object.keys(HR),i=0;i<r.length;i++){var o=r[i],a=null!=(a=n[o])?a:HR[o];WR[o]=a}WR.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+t);var s=function(c){var h=[],f=0;c.rows,c.cols;return c.cells.forEach(function(e,l){e.forEach(function(e,t){if(void 0!==e&&(5!==(u=e).cval&&10!==u.cval)&&!jR(e)){var n=function(e,t,n){var r,i,o=e.length,a=[],s=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],u=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],l=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],c=(e[t][n],e[t][n]),h=c.cval,f=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][h],p=QR(c,f);a.push([n+p[0],t+p[1]]),p=QR(c,f=l[h]),a.push([n+p[0],t+p[1]]),KR(c);var d=n+s[h],m=t+u[h],_=h;for(;0<=d&&0<=m&&m<o&&(d!=n||m!=t)&&void 0!==(c=e[m][d]);){if(0===(h=c.cval)||15===h)return{path:a,info:"mergeable"};f=l[h],r=s[h],i=u[h],5!==h&&10!==h||(5===h?c.flipped?i=(r=-1===u[_]?(f="left",-1):(f="right",1),0):-1===s[_]&&(f="bottom",r=0,i=-1):10===h&&(c.flipped?i=-1===s[_]?(f="top",r=0,1):(f="bottom",r=0,-1):1===u[_]&&(f="left",r=-1,i=0))),p=QR(c,f),a.push([d+p[0],m+p[1]]),KR(c),d+=r,m+=i,_=h}return{path:a,info:"closed"}}(c.cells,l,t),r=!1;if("mergeable"===n.info)for(var i=n.path[n.path.length-1][0],o=n.path[n.path.length-1][1],a=f-1;0<=a;a--)if(Math.abs(h[a][0][0]-i)<=1e-7&&Math.abs(h[a][0][1]-o)<=1e-7){for(var s=n.path.length-2;0<=s;--s)h[a].unshift(n.path[s]);r=!0;break}r||(h[f++]=n.path)}var u})}),h}(function(e,t){for(var n,r,i,o,a=e.length-1,s=e[0].length-1,u={rows:a,cols:s,cells:[]},l=0;l<a;++l){u.cells[l]=[];for(var c=0;c<s;++c){var h,f,p=0,d=e[l+1][c],m=e[l+1][c+1],_=e[l][c+1],g=e[l][c];isNaN(d)||isNaN(m)||isNaN(_)||isNaN(g)||(p|=t<=d?8:0,p|=t<=m?4:0,p|=t<=_?2:0,h=!1,5!==(p|=t<=g?1:0)&&10!==p||(f=(d+m+_+g)/4,5===p&&f<t?(p=10,h=!0):10===p&&f<t&&(p=5,h=!0)),0!==p&&15!==p&&(n=r=i=o=.5,1===p?(i=1-XR(t,d,g),r=1-XR(t,_,g)):2===p?(r=XR(t,g,_),o=1-XR(t,m,_)):3===p?(i=1-XR(t,d,g),o=1-XR(t,m,_)):4===p?(n=XR(t,d,m),o=XR(t,_,m)):5===p?(n=XR(t,d,m),o=XR(t,_,m),r=1-XR(t,_,g),i=1-XR(t,d,g)):6===p?(r=XR(t,g,_),n=XR(t,d,m)):7===p?(i=1-XR(t,d,g),n=XR(t,d,m)):8===p?(i=XR(t,g,d),n=1-XR(t,m,d)):9===p?(r=1-XR(t,_,g),n=1-XR(t,m,d)):10===p?(n=1-XR(t,m,d),o=1-XR(t,m,_),r=XR(t,g,_),i=XR(t,g,d)):11===p?(n=1-XR(t,m,d),o=1-XR(t,m,_)):12===p?(i=XR(t,g,d),o=XR(t,_,m)):13===p?(r=1-XR(t,_,g),o=XR(t,_,m)):14===p?(i=XR(t,g,d),r=XR(t,g,_)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+p),u.cells[l][c]={cval:p,flipped:h,top:n,right:o,bottom:r,left:i}))}}return u}(e,t));return"function"==typeof WR.successCallback&&WR.successCallback(s),s}function XR(e,t,n){return(e-t)/(n-t)}function jR(e){return 0===e.cval||15===e.cval}function KR(e){jR(e)||5===e.cval||10===e.cval||(e.cval=15)}function QR(e,t){return"top"===t?[e.top,1]:"bottom"===t?[e.bottom,0]:"right"===t?[1,e.right]:"left"===t?[0,e.left]:void 0}function ZR(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.zProperty||"elevation",r=t.flip,i=t.flags;UR(e,"Point","input must contain Points");for(var o,a,s=(o=r,a={},bR(e,function(e){var t=MR(e)[1];a[t]||(a[t]=[]),a[t].push(e)}),Object.keys(a).map(function(e){return a[e].sort(function(e,t){return MR(e)[0]-MR(t)[0]})}).sort(function(e,t){return o?MR(e[0])[1]-MR(t[0])[1]:MR(t[0])[1]-MR(e[0])[1]})),u=[],l=0;l<s.length;l++){for(var c=s[l],h=[],f=0;f<c.length;f++){var p=c[f];p.properties[n]?h.push(p.properties[n]):h.push(0),!0===i&&(p.properties.matrixPosition=[l,f])}u.push(h)}return u}var JR=function e(t,n,r,i,o){r=r||0;i=i||t.length-1;o=o||eD;for(;r<i;){var a,s,u,l,c,h,f;600<i-r&&(a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1),h=Math.max(r,Math.floor(n-s*l/a+c)),f=Math.min(i,Math.floor(n+(a-s)*l/a+c)),e(t,n,h,f,o));var p=t[n],d=r,m=i;for($R(t,r,n),0<o(t[i],p)&&$R(t,r,i);d<m;){for($R(t,d,m),d++,m--;o(t[d],p)<0;)d++;for(;0<o(t[m],p);)m--}0===o(t[r],p)?$R(t,r,m):$R(t,++m,i),m<=n&&(r=m+1),n<=m&&(i=m-1)}};function $R(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function eD(e,t){return e<t?-1:t<e?1:0}var tD=nD;function nD(e,t){if(!(this instanceof nD))return new nD(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function rD(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function iD(e,t){oD(e,0,e.children.length,t,e)}function oD(e,t,n,r,i){(i=i||pD(null)).minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=t;a<n;a++)o=e.children[a],aD(i,e.leaf?r(o):o);return i}function aD(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function sD(e,t){return e.minX-t.minX}function uD(e,t){return e.minY-t.minY}function lD(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function cD(e){return e.maxX-e.minX+(e.maxY-e.minY)}function hD(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function fD(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function pD(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function dD(e,t,n,r,i){for(var o,a=[t,n];a.length;)(n=a.pop())-(t=a.pop())<=r||(o=t+Math.ceil((n-t)/r/2)*r,JR(e,o,t,n,i),a.push(t,o,o,n))}function mD(e,t){return e(t={exports:{}},t.exports),t.exports}nD.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,n=[],r=this.toBBox;if(!fD(e,t))return n;for(var i,o,a,s,u=[];t;){for(i=0,o=t.children.length;i<o;i++)a=t.children[i],fD(e,s=t.leaf?r(a):a)&&(t.leaf?n.push(a):hD(e,s)?this._all(a,n):u.push(a));t=u.pop()}return n},collides:function(e){var t=this.data,n=this.toBBox;if(!fD(e,t))return!1;for(var r,i,o,a,s=[];t;){for(r=0,i=t.children.length;r<i;r++)if(o=t.children[r],fD(e,a=t.leaf?n(o):o)){if(t.leaf||hD(e,a))return!0;s.push(o)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var r,i=this._build(e.slice(),0,e.length-1,0);return this.data.children.length?this.data.height===i.height?this._splitRoot(this.data,i):(this.data.height<i.height&&(r=this.data,this.data=i,i=r),this._insert(i,this.data.height-i.height-1,!0)):this.data=i,this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=pD([]),this},remove:function(e,t){if(!e)return this;for(var n,r,i,o,a=this.data,s=this.toBBox(e),u=[],l=[];a||u.length;){if(a||(a=u.pop(),r=u[u.length-1],n=l.pop(),o=!0),a.leaf&&-1!==(i=rD(e,a.children,t)))return a.children.splice(i,1),u.push(a),this._condense(u),this;o||a.leaf||!hD(a,s)?r?(n++,a=r.children[n],o=!1):a=null:(u.push(a),l.push(n),n=0,a=(r=a).children[0])}return this},toBBox:function(e){return e},compareMinX:sD,compareMinY:uD,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},_build:function(e,t,n,r){var i,o=n-t+1,a=this._maxEntries;if(o<=a)return iD(i=pD(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(i=pD([])).leaf=!1,i.height=r;var s,u,l,c,h=Math.ceil(o/a),f=h*Math.ceil(Math.sqrt(a));for(dD(e,t,n,f,this.compareMinX),s=t;s<=n;s+=f)for(dD(e,s,l=Math.min(s+f-1,n),h,this.compareMinY),u=s;u<=l;u+=h)c=Math.min(u+h-1,l),i.children.push(this._build(e,u,c,r-1));return iD(i,this.toBBox),i},_chooseSubtree:function(e,t,n,r){for(var i,o,a,s,u,l,c,h,f,p;r.push(t),!t.leaf&&r.length-1!==n;){for(c=h=1/0,i=0,o=t.children.length;i<o;i++)u=lD(a=t.children[i]),f=e,p=a,(l=(Math.max(p.maxX,f.maxX)-Math.min(p.minX,f.minX))*(Math.max(p.maxY,f.maxY)-Math.min(p.minY,f.minY))-u)<h?(h=l,c=u<c?u:c,s=a):l===h&&u<c&&(c=u,s=a);t=s||t.children[0]}return t},_insert:function(e,t,n){var r=this.toBBox,i=n?e:r(e),o=[],a=this._chooseSubtree(i,this.data,t,o);for(a.children.push(e),aD(a,i);0<=t&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),a=pD(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,iD(n,this.toBBox),iD(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)},_splitRoot:function(e,t){this.data=pD([e,t]),this.data.height=e.height+1,this.data.leaf=!1,iD(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,n){for(var r,i,o,a,s,u,l,c,h,f,p,d,m=s=1/0,_=t;_<=n-t;_++)r=oD(e,0,_,this.toBBox),i=oD(e,_,n,this.toBBox),l=r,c=i,0,h=Math.max(l.minX,c.minX),f=Math.max(l.minY,c.minY),p=Math.min(l.maxX,c.maxX),d=Math.min(l.maxY,c.maxY),o=Math.max(0,p-h)*Math.max(0,d-f),a=lD(r)+lD(i),o<m?(m=o,u=_,s=a<s?a:s):o===m&&a<s&&(s=a,u=_);return u},_chooseSplitAxis:function(e,t,n){var r=e.leaf?this.compareMinX:sD,i=e.leaf?this.compareMinY:uD;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},_allDistMargin:function(e,t,n,r){e.children.sort(r);for(var i,o=this.toBBox,a=oD(e,0,t,o),s=oD(e,n-t,n,o),u=cD(a)+cD(s),l=t;l<n-t;l++)i=e.children[l],aD(a,e.leaf?o(i):i),u+=cD(a);for(l=n-t-1;t<=l;l--)i=e.children[l],aD(s,e.leaf?o(i):i),u+=cD(s);return u},_adjustParentBBoxes:function(e,t,n){for(var r=n;0<=r;r--)aD(t[r],e)},_condense:function(e){for(var t,n=e.length-1;0<=n;n--)0===e[n].children.length?0<n?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():iD(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var _D=function(e,t,n){var r=e*t,i=gD*e,o=i-(i-e),a=e-o,s=gD*t,u=s-(s-t),l=t-u,c=a*l-(r-o*u-a*u-o*l);if(n)return n[0]=c,n[1]=r,n;return[c,r]},gD=+(Math.pow(2,27)+1);function yD(e,t){var n=0|e.length,r=0|t.length;if(1==n&&1==r)return function(e,t){var n=e+t,r=n-e,i=e-(n-r)+(t-r);if(i)return[i,n];return[n]}(e[0],t[0]);var i,o,a=new Array(n+r),s=0,u=0,l=0,c=Math.abs,h=e[u],f=c(h),p=t[l],d=c(p);f<d?(o=h,(u+=1)<n&&(h=e[u],f=c(h))):(o=p,(l+=1)<r&&(p=t[l],d=c(p))),u<n&&f<d||r<=l?(i=h,(u+=1)<n&&(h=e[u],f=c(h))):(i=p,(l+=1)<r&&(p=t[l],d=c(p)));for(var m,_,g=i+o,y=g-i,v=o-y,x=v,b=g;u<n&&l<r;)f<d?(i=h,(u+=1)<n&&(h=e[u],f=c(h))):(i=p,(l+=1)<r&&(p=t[l],d=c(p))),(v=(o=x)-(y=(g=i+o)-i))&&(a[s++]=v),x=b-((m=b+g)-(_=m-b))+(g-_),b=m;for(;u<n;)(v=(o=x)-(y=(g=(i=h)+o)-i))&&(a[s++]=v),x=b-((m=b+g)-(_=m-b))+(g-_),b=m,(u+=1)<n&&(h=e[u]);for(;l<r;)(v=(o=x)-(y=(g=(i=p)+o)-i))&&(a[s++]=v),x=b-((m=b+g)-(_=m-b))+(g-_),b=m,(l+=1)<r&&(p=t[l]);return x&&(a[s++]=x),b&&(a[s++]=b),s||(a[s++]=0),a.length=s,a}var vD=function(e,t,n){var r=e+t,i=r-e,o=t-i,a=e-(r-i);if(n)return n[0]=a+o,n[1]=r,n;return[a+o,r]};function xD(e,t){var n=e.length;if(1===n){var r=_D(e[0],t);return r[0]?r:[r[1]]}var i=new Array(2*n),o=[.1,.1],a=[.1,.1],s=0;_D(e[0],t,o),o[0]&&(i[s++]=o[0]);for(var u=1;u<n;++u){_D(e[u],t,a);var l=o[1];vD(l,a[0],o),o[0]&&(i[s++]=o[0]);var c=a[1],h=o[1],f=c+h,p=h-(f-c);o[1]=f,p&&(i[s++]=p)}return o[1]&&(i[s++]=o[1]),0===s&&(i[s++]=0),i.length=s,i}function bD(e,t){var n=0|e.length,r=0|t.length;if(1==n&&1==r)return function(e,t){var n=e+t,r=n-e,i=e-(n-r)+(t-r);if(i)return[i,n];return[n]}(e[0],-t[0]);var i,o,a=new Array(n+r),s=0,u=0,l=0,c=Math.abs,h=e[u],f=c(h),p=-t[l],d=c(p);f<d?(o=h,(u+=1)<n&&(h=e[u],f=c(h))):(o=p,(l+=1)<r&&(p=-t[l],d=c(p))),u<n&&f<d||r<=l?(i=h,(u+=1)<n&&(h=e[u],f=c(h))):(i=p,(l+=1)<r&&(p=-t[l],d=c(p)));for(var m,_,g=i+o,y=g-i,v=o-y,x=v,b=g;u<n&&l<r;)f<d?(i=h,(u+=1)<n&&(h=e[u],f=c(h))):(i=p,(l+=1)<r&&(p=-t[l],d=c(p))),(v=(o=x)-(y=(g=i+o)-i))&&(a[s++]=v),x=b-((m=b+g)-(_=m-b))+(g-_),b=m;for(;u<n;)(v=(o=x)-(y=(g=(i=h)+o)-i))&&(a[s++]=v),x=b-((m=b+g)-(_=m-b))+(g-_),b=m,(u+=1)<n&&(h=e[u]);for(;l<r;)(v=(o=x)-(y=(g=(i=p)+o)-i))&&(a[s++]=v),x=b-((m=b+g)-(_=m-b))+(g-_),b=m,(l+=1)<r&&(p=-t[l]);return x&&(a[s++]=x),b&&(a[s++]=b),s||(a[s++]=0),a.length=s,a}var ED=mD(function(o){function c(e,t){for(var n=new Array(e.length-1),r=1;r<e.length;++r)for(var i=n[r-1]=new Array(e.length-1),o=0,a=0;o<e.length;++o)o!==t&&(i[a++]=e[r][o]);return n}function h(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var t=e.length>>1;return["sum(",h(e.slice(0,t)),",",h(e.slice(t)),")"].join("")}function f(e){if(2===e.length)return[["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("")];for(var t=[],n=0;n<e.length;++n)t.push(["scale(",h(f(c(e,n))),",",1&n?"-":"",e[0][n],")"].join(""));return t}function a(e){for(var t=[],n=[],r=function(e){for(var t=new Array(e),n=0;n<e;++n){t[n]=new Array(e);for(var r=0;r<e;++r)t[n][r]=["m",r,"[",e-n-1,"]"].join("")}return t}(e),i=[],o=0;o<e;++o)0==(1&o)?t.push.apply(t,f(c(r,o))):n.push.apply(n,f(c(r,o))),i.push("m"+o);var a=h(t),s=h(n),u="orientation"+e+"Exact",l=["function ",u,"(",i.join(),"){var p=",a,",n=",s,",d=sub(p,n);return d[d.length-1];};return ",u].join("");return new Function("sum","prod","scale","sub",l)(yD,_D,xD,bD)}var u=a(3),b=a(4),s=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,n){var r,i=(e[1]-n[1])*(t[0]-n[0]),o=(e[0]-n[0])*(t[1]-n[1]),a=i-o;if(0<i){if(o<=0)return a;r=i+o}else{if(!(i<0))return a;if(0<=o)return a;r=-(i+o)}var s=33306690738754716e-32*r;return s<=a||a<=-s?a:u(e,t,n)},function(e,t,n,r){var i=e[0]-r[0],o=t[0]-r[0],a=n[0]-r[0],s=e[1]-r[1],u=t[1]-r[1],l=n[1]-r[1],c=e[2]-r[2],h=t[2]-r[2],f=n[2]-r[2],p=o*l,d=a*u,m=a*s,_=i*l,g=i*u,y=o*s,v=c*(p-d)+h*(m-_)+f*(g-y),x=7771561172376103e-31*((Math.abs(p)+Math.abs(d))*Math.abs(c)+(Math.abs(m)+Math.abs(_))*Math.abs(h)+(Math.abs(g)+Math.abs(y))*Math.abs(f));return x<v||x<-v?v:b(e,t,n,r)}];!function(){for(;s.length<=5;)s.push(a(s.length));for(var e=[],t=["slow"],n=0;n<=5;++n)e.push("a"+n),t.push("o"+n);for(var r=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"],n=2;n<=5;++n)r.push("case ",n,":return o",n,"(",e.slice(0,n).join(),");");r.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),t.push(r.join(""));var i=Function.apply(void 0,t);for(o.exports=i.apply(void 0,[function(e){return(s[e.length]||(s[e.length]=a(e.length))).apply(void 0,e)}].concat(s)),n=0;n<=5;++n)o.exports[n]=s[n]}()}),TD=function(r){var e=r.length;if(e<3){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return 2===e&&r[0][0]===r[1][0]&&r[0][1]===r[1][1]?[0]:t}for(var i=new Array(e),n=0;n<e;++n)i[n]=n;i.sort(function(e,t){var n=r[e][0]-r[t][0];return n||r[e][1]-r[t][1]});for(var o=[i[0],i[1]],a=[i[0],i[1]],n=2;n<e;++n){for(var s=i[n],u=r[s],l=o.length;1<l&&SD(r[o[l-2]],r[o[l-1]],u)<=0;)--l,o.pop();for(o.push(s),l=a.length;1<l&&0<=SD(r[a[l-2]],r[a[l-1]],u);)--l,a.pop();a.push(s)}for(var t=new Array(a.length+o.length-2),c=0,n=0,h=o.length;n<h;++n)t[c++]=o[n];for(var f=a.length-2;0<f;--f)t[c++]=a[f];return t},SD=ED[3];var CD=AD,wD=AD;function AD(e,t){if(!(this instanceof AD))return new AD(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||ID,0<this.length)for(var n=(this.length>>1)-1;0<=n;n--)this._down(n)}function ID(e,t){return e<t?-1:t<e?1:0}AD.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,r=t[e];0<e;){var i=e-1>>1,o=t[i];if(0<=n(r,o))break;t[e]=o,e=i}t[e]=r},_down:function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&n(t[a],s)<0&&(s=t[o=a]),0<=n(s,i))break;t[e]=s,e=o}t[e]=i}},CD.default=wD;var PD=function(e,t){for(var n=e[0],r=e[1],i=!1,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],u=t[o][1],l=t[a][0],c=t[a][1];r<u!=r<c&&n<(l-s)*(r-u)/(c-u)+s&&(i=!i)}return i},OD=ED[3],LD=ND;function ND(e,t,n){t=Math.max(0,void 0===t?2:t),n=n||0;for(var r,i=function(e){for(var t=e[0],n=e[0],r=e[0],i=e[0],o=0;o<e.length;o++){var a=e[o];a[0]<t[0]&&(t=a),a[0]>r[0]&&(r=a),a[1]<n[1]&&(n=a),a[1]>i[1]&&(i=a)}var s=[t,n,r,i],u=s.slice();for(o=0;o<e.length;o++)PD(e[o],s)||u.push(e[o]);var l=TD(u),c=[];for(o=0;o<l.length;o++)c.push(u[l[o]]);return c}(e),o=tD(16,["[0]","[1]","[0]","[1]"]).load(e),a=[],s=0;s<i.length;s++){var u=i[s];o.remove(u),r=UD(u,r),a.push(r)}for(var l=tD(16),s=0;s<a.length;s++)l.insert(BD(a[s]));for(var c=t*t,h=n*n;a.length;){var f,p=a.shift(),d=p.p,m=p.next.p,_=VD(d,m);_<h||(f=_/c,(u=RD(o,p.prev.p,d,m,p.next.next.p,f,l))&&Math.min(VD(u,d),VD(u,m))<=f&&(a.push(p),a.push(UD(u,p)),o.remove(u),l.remove(p),l.insert(BD(p)),l.insert(BD(p.next))))}p=r;for(var g=[];g.push(p.p),(p=p.next)!==r;);return g.push(p.p),g}function RD(e,t,n,r,i,o,a){for(var s=new CD(null,DD),u=e.data;u;){for(var l=0;l<u.children.length;l++){var c=u.children[l],h=u.leaf?kD(c,n,r):MD(n,r,c);o<h||s.push({node:c,dist:h})}for(;s.length&&!s.peek().node.children;){var f=s.pop(),p=f.node,d=kD(p,t,n),m=kD(p,r,i);if(f.dist<d&&f.dist<m&&zD(n,p,a)&&zD(r,p,a))return p}u=(u=s.pop())&&u.node}return null}function DD(e,t){return e.dist-t.dist}function MD(e,t,n){if(FD(e,n)||FD(t,n))return 0;var r=GD(e[0],e[1],t[0],t[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=GD(e[0],e[1],t[0],t[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=GD(e[0],e[1],t[0],t[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var a=GD(e[0],e[1],t[0],t[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===a?0:Math.min(r,i,o,a)}function FD(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function zD(e,t,n){for(var r,i,o,a,s=Math.min(e[0],t[0]),u=Math.min(e[1],t[1]),l=Math.max(e[0],t[0]),c=Math.max(e[1],t[1]),h=n.search({minX:s,minY:u,maxX:l,maxY:c}),f=0;f<h.length;f++)if(r=h[f].p,i=h[f].next.p,o=e,r!==(a=t)&&i!==o&&0<OD(r,i,o)!=0<OD(r,i,a)&&0<OD(o,a,r)!=0<OD(o,a,i))return;return 1}function BD(e){var t=e.p,n=e.next.p;return e.minX=Math.min(t[0],n[0]),e.minY=Math.min(t[1],n[1]),e.maxX=Math.max(t[0],n[0]),e.maxY=Math.max(t[1],n[1]),e}function UD(e,t){var n={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(n.next=t.next,(n.prev=t).next.prev=n,t.next=n):(n.prev=n).next=n,n}function VD(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function kD(e,t,n){var r,i=t[0],o=t[1],a=n[0]-i,s=n[1]-o;return 0===a&&0===s||(1<(r=((e[0]-i)*a+(e[1]-o)*s)/(a*a+s*s))?(i=n[0],o=n[1]):0<r&&(i+=a*r,o+=s*r)),(a=e[0]-i)*a+(s=e[1]-o)*s}function GD(e,t,n,r,i,o,a,s){var u,l,c,h,f=n-e,p=r-t,d=a-i,m=s-o,_=e-i,g=t-o,y=f*f+p*p,v=f*d+p*m,x=d*d+m*m,b=f*_+p*g,E=d*_+m*g,T=y*x-v*v,S=T,C=T;0==T?(l=0,S=1,h=E,C=x):(h=y*E-v*b,(l=v*E-x*b)<0?(l=0,h=E,C=x):S<l&&(l=S,h=E+v,C=x)),h<0?-b<(h=0)?l=0:y<-b?l=S:(l=-b,S=y):C<h&&(h=C,v-b<0?l=0:y<v-b?l=S:(l=v-b,S=y));var w=(1-(c=0===h?0:h/C))*i+c*a-((1-(u=0===l?0:l/S))*e+u*n),A=(1-c)*o+c*s-((1-u)*t+u*r);return w*w+A*A}function qD(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.concavity||1/0,r=[];if(gR(e,function(e){r.push([e[0],e[1]])}),!r.length)return null;var i=LD(r,n);return 3<i.length?jN([i]):null}function HD(e,t,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.ignoreBoundary;if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var i,o,a=DR(e),s=MR(t),u=t.geometry?t.geometry.type:t.type,l=t.bbox;if(l&&!1==(i=a,(o=l)[0]<=i[0]&&o[1]<=i[1]&&o[2]>=i[0]&&o[3]>=i[1]))return!1;"Polygon"===u&&(s=[s]);for(var c=0,h=!1;c<s.length&&!h;c++)if(WD(a,s[c][0],r)){for(var f=!1,p=1;p<s[c].length&&!f;)WD(a,s[c][p],!r)&&(f=!0),p++;f||(h=!0)}return h}function WD(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,o=t.length-1;i<t.length;o=i++){var a=t[i][0],s=t[i][1],u=t[o][0],l=t[o][1];if(e[1]*(a-u)+s*(u-e[0])+l*(e[0]-a)==0&&(a-e[0])*(u-e[0])<=0&&(s-e[1])*(l-e[1])<=0)return!n;s>e[1]!=l>e[1]&&e[0]<(u-a)*(e[1]-s)/(l-s)+a&&(r=!r)}return r}function YD(e,t){var n=[];return SR(t,function(t){bR(e,function(e){HD(e,t)&&n.push(e)})}),JN(n)}function XD(e,n){if("FeatureCollection"!==e.type)throw new Error("points must be a FeatureCollection");var o=!1;return JN(function(e){if(e.length<3)return[];e.sort(KD);var t,n,r,i,o,a,s=e.length-1,u=e[s].x,l=e[0].x,c=e[s].y,h=c;for(;s--;)e[s].y<c&&(c=e[s].y),e[s].y>h&&(h=e[s].y);var f,p=l-u,d=h-c,m=d<p?p:d,_=.5*(l+u),g=.5*(h+c),y=[new jD({x:_-20*m,y:g-m,__sentinel:!0},{x:_,y:g+20*m,__sentinel:!0},{x:_+20*m,y:g-m,__sentinel:!0})],v=[],x=[];s=e.length;for(;s--;){for(x.length=0,f=y.length;f--;)0<(p=e[s].x-y[f].x)&&p*p>y[f].r?(v.push(y[f]),y.splice(f,1)):(d=e[s].y-y[f].y,p*p+d*d>y[f].r||(x.push(y[f].a,y[f].b,y[f].b,y[f].c,y[f].c,y[f].a),y.splice(f,1)));for(QD(x),f=x.length;f;)n=x[--f],t=x[--f],r=e[s],i=n.x-t.x,o=n.y-t.y,a=2*(i*(r.y-n.y)-o*(r.x-n.x)),1e-12<Math.abs(a)&&y.push(new jD(t,n,r))}Array.prototype.push.apply(v,y),s=v.length;for(;s--;)(v[s].a.__sentinel||v[s].b.__sentinel||v[s].c.__sentinel)&&v.splice(s,1);return v}(e.features.map(function(e){var t={x:e.geometry.coordinates[0],y:e.geometry.coordinates[1]};return n?t.z=e.properties[n]:3===e.geometry.coordinates.length&&(o=!0,t.z=e.geometry.coordinates[2]),t})).map(function(e){var t=[e.a.x,e.a.y],n=[e.b.x,e.b.y],r=[e.c.x,e.c.y],i={};return o?(t.push(e.a.z),n.push(e.b.z),r.push(e.c.z)):i={a:e.a.z,b:e.b.z,c:e.c.z},jN([[t,n,r,t]],i)}))}function jD(e,t,n){this.a=e,this.b=t,this.c=n;var r,i,o=t.x-e.x,a=t.y-e.y,s=n.x-e.x,u=n.y-e.y,l=o*(e.x+t.x)+a*(e.y+t.y),c=s*(e.x+n.x)+u*(e.y+n.y),h=2*(o*(n.y-t.y)-a*(n.x-t.x));this.x=(u*l-a*c)/h,this.y=(o*c-s*l)/h,r=this.x-e.x,i=this.y-e.y,this.r=r*r+i*i}function KD(e,t){return t.x-e.x}function QD(e){var t,n,r,i,o,a=e.length;e:for(;a;)for(n=e[--a],t=e[--a],r=a;r;)if(o=e[--r],t===(i=e[--r])&&n===o||t===o&&n===i){e.splice(a,2),e.splice(r,2),a-=2;continue e}}function ZD(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.units,i=DR(e),o=DR(t),a=lR(o[1]-i[1]),s=lR(o[0]-i[0]),u=lR(i[1]),l=lR(o[1]),c=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(l);return iR(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r)}function JD(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return $D(e);case"FeatureCollection":return t=e,n={type:"FeatureCollection"},Object.keys(t).forEach(function(e){switch(e){case"type":case"features":return;default:n[e]=t[e]}}),n.features=t.features.map($D),n;case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return eM(e);default:throw new Error("unknown GeoJSON type")}var t,n}function $D(t){var n={type:"Feature"};return Object.keys(t).forEach(function(e){switch(e){case"type":case"properties":case"geometry":return;default:n[e]=t[e]}}),n.properties=function n(r){var i={};if(!r)return i;Object.keys(r).forEach(function(e){var t=r[e];"object"==typeof t?null===t?i[e]=null:t.length?i[e]=t.map(function(e){return e}):i[e]=n(t):i[e]=t});return i}(t.properties),n.geometry=eM(t.geometry),n}function eM(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?t.geometries=e.geometries.map(eM):t.coordinates=function t(e){if("object"!=typeof e[0])return e.slice();return e.map(function(e){return t(e)})}(e.coordinates),t}LD.default=ND;function tM(e){return e}var nM=function(e){if(null==e)return tM;var o,a,s=e.scale[0],u=e.scale[1],l=e.translate[0],c=e.translate[1];return function(e,t){t||(o=a=0);var n=2,r=e.length,i=new Array(r);for(i[0]=(o+=e[0])*s+l,i[1]=(a+=e[1])*u+c;n<r;)i[n]=e[n],++n;return i}},rM=function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n};function iM(e,t){var o=nM(e.transform),a=e.arcs;function i(e,t){t.length&&t.pop();for(var n=a[e<0?~e:e],r=0,i=n.length;r<i;++r)t.push(o(n[r],r));e<0&&rM(t,i)}function s(e){return o(e)}function u(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function n(e){for(var t=u(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(n)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=s(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(s);break;case"LineString":n=u(t.arcs);break;case"MultiLineString":n=t.arcs.map(u);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}function oM(u,i){var o={},l={},c={},a=[],s=-1;function e(e,t){for(var n in e){var r=e[n];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){o[e<0?~e:e]=1}),a.push(r)}}return i.forEach(function(e,t){var n,r=u.arcs[e<0?~e:e];r.length<3&&!r[1][0]&&!r[1][1]&&(n=i[++s],i[s]=e,i[t]=n)}),i.forEach(function(e){var t,n,r,i,o=function(e){var t,n=u.arcs[e<0?~e:e],r=n[0];u.transform?(t=[0,0],n.forEach(function(e){t[0]+=e[0],t[1]+=e[1]})):t=n[n.length-1];return e<0?[t,r]:[r,t]}(e),a=o[0],s=o[1];(t=c[a])?(delete c[t.end],t.push(e),t.end=s,(n=l[s])?(delete l[n.start],r=n===t?t:t.concat(n),l[r.start=t.start]=c[r.end=n.end]=r):l[t.start]=c[t.end]=t):(t=l[s])?(delete l[t.start],t.unshift(e),t.start=a,(n=c[a])?(delete c[n.end],i=n===t?t:n.concat(t),l[i.start=n.start]=c[i.end=t.end]=i):l[t.start]=c[t.end]=t):l[(t=[e]).start=a]=c[t.end=s]=t}),e(c,l),e(l,c),i.forEach(function(e){o[e<0?~e:e]||a.push([e])}),a}var aM=function(e){return iM(e,function(s,e){var u={},n=[],r=[];function i(t){t.forEach(function(e){e.forEach(function(e){(u[e=e<0?~e:e]||(u[e]=[])).push(t)})}),n.push(t)}function l(e){return function(e){for(var t,n=-1,r=e.length,i=e[r-1],o=0;++n<r;)t=i,i=e[n],o+=t[0]*i[1]-t[1]*i[0];return Math.abs(o)}(iM(s,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":i(t.arcs);break;case"MultiPolygon":t.arcs.forEach(i)}}),n.forEach(function(e){if(!e._){var t=[],n=[e];for(e._=1,r.push(t);e=n.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){u[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),n.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:r.map(function(e){var t,n=[];if(e.forEach(function(e){e.forEach(function(e){e.forEach(function(e){u[e<0?~e:e].length<2&&n.push(e)})})}),1<(t=(n=oM(s,n)).length))for(var r,i,o=1,a=l(n[0]);o<t;++o)(r=l(n[o]))>a&&(i=n[0],n[0]=n[o],n[o]=i,a=r);return n})}}.apply(this,arguments))};function sM(i,o,a,e,s){3===arguments.length&&(e=Array,s=null);for(var u=new e(i=1<<Math.max(4,Math.ceil(Math.log(i)/Math.LN2))),l=i-1,t=0;t<i;++t)u[t]=s;return{add:function(e){for(var t=o(e)&l,n=u[t],r=0;n!=s;){if(a(n,e))return!0;if(++r>=i)throw new Error("full hashset");n=u[t=t+1&l]}return u[t]=e,!0},has:function(e){for(var t=o(e)&l,n=u[t],r=0;n!=s;){if(a(n,e))return!0;if(++r>=i)break;n=u[t=t+1&l]}return!1},values:function(){for(var e=[],t=0,n=u.length;t<n;++t){var r=u[t];r!=s&&e.push(r)}return e}}}function uM(o,a,s,e,u,t){3===arguments.length&&(e=t=Array,u=null);for(var l=new e(o=1<<Math.max(4,Math.ceil(Math.log(o)/Math.LN2))),c=new t(o),h=o-1,n=0;n<o;++n)l[n]=u;return{set:function(e,t){for(var n=a(e)&h,r=l[n],i=0;r!=u;){if(s(r,e))return c[n]=t;if(++i>=o)throw new Error("full hashmap");r=l[n=n+1&h]}return l[n]=e,c[n]=t},maybeSet:function(e,t){for(var n=a(e)&h,r=l[n],i=0;r!=u;){if(s(r,e))return c[n];if(++i>=o)throw new Error("full hashmap");r=l[n=n+1&h]}return l[n]=e,c[n]=t},get:function(e,t){for(var n=a(e)&h,r=l[n],i=0;r!=u;){if(s(r,e))return c[n];if(++i>=o)break;r=l[n=n+1&h]}return t},keys:function(){for(var e=[],t=0,n=l.length;t<n;++t){var r=l[t];r!=u&&e.push(r)}return e}}}function lM(e,t){return e[0]===t[0]&&e[1]===t[1]}function cM(e){pM[0]=e[0],pM[1]=e[1];var t=dM[0]^dM[1];return 2147483647&(t=t<<5^t>>7^dM[2]^dM[3])}function hM(e){for(var i=e.coordinates,t=e.lines,n=e.rings,r=function(){for(var e=uM(1.4*i.length,b,E,Int32Array,-1,Int32Array),t=new Int32Array(i.length),n=0,r=i.length;n<r;++n)t[n]=e.maybeSet(n,n);return t}(),a=new Int32Array(i.length),s=new Int32Array(i.length),u=new Int32Array(i.length),l=new Int8Array(i.length),c=0,o=0,h=i.length;o<h;++o)a[o]=s[o]=u[o]=-1;for(o=0,h=t.length;o<h;++o){var f=t[o],p=f[0],d=f[1],m=r[p],_=r[++p];for(++c,l[m]=1;++p<=d;)x(o,m,m=_,_=r[p]);++c,l[_]=1}for(o=0,h=i.length;o<h;++o)a[o]=-1;for(o=0,h=n.length;o<h;++o){var g=n[o],y=g[0]+1,v=g[1];for(x(o,r[v-1],m=r[y-1],_=r[y]);++y<=v;)x(o,m,m=_,_=r[y])}function x(e,t,n,r){var i,o;a[n]!==e&&(a[n]=e,0<=(i=s[n])?(o=u[n],i===t&&o===r||i===r&&o===t||(++c,l[n]=1)):(s[n]=t,u[n]=r))}function b(e){return cM(i[e])}function E(e,t){return lM(i[e],i[t])}a=s=u=null;var T,S=sM(1.4*c,cM,lM);for(o=0,h=i.length;o<h;++o)l[T=r[o]]&&S.add(i[T]);return S}var fM=new ArrayBuffer(16),pM=new Float64Array(fM),dM=new Uint32Array(fM);function mM(e,t,n,r){_M(e,t,n),_M(e,t,t+r),_M(e,t+r,n)}function _M(e,t,n){for(var r,i=t+(n---t>>1);t<i;++t,--n)r=e[t],e[t]=e[n],e[n]=r}function gM(e){var t,n,r={};for(t in e)r[t]=null==(n=e[t])?{type:null}:("FeatureCollection"===n.type?function(e){var t={type:"GeometryCollection",geometries:e.features.map(yM)};null!=e.bbox&&(t.bbox=e.bbox);return t}:"Feature"===n.type?yM:vM)(n);return r}function yM(e){var t,n=vM(e.geometry);for(t in null!=e.id&&(n.id=e.id),null!=e.bbox&&(n.bbox=e.bbox),e.properties){n.properties=e.properties;break}return n}function vM(e){if(null==e)return{type:null};var t="GeometryCollection"===e.type?{type:"GeometryCollection",geometries:e.geometries.map(vM)}:"Point"===e.type||"MultiPoint"===e.type?{type:e.type,coordinates:e.coordinates}:{type:e.type,arcs:e.coordinates};return null!=e.bbox&&(t.bbox=e.bbox),t}var xM=function(e,t){var n=function(e){var r=1/0,i=1/0,o=-1/0,a=-1/0;function t(e){null!=e&&n.hasOwnProperty(e.type)&&n[e.type](e)}var n={GeometryCollection:function(e){e.geometries.forEach(t)},Point:function(e){s(e.coordinates)},MultiPoint:function(e){e.coordinates.forEach(s)},LineString:function(e){u(e.arcs)},MultiLineString:function(e){e.arcs.forEach(u)},Polygon:function(e){e.arcs.forEach(u)},MultiPolygon:function(e){e.arcs.forEach(l)}};function s(e){var t=e[0],n=e[1];t<r&&(r=t),o<t&&(o=t),n<i&&(i=n),a<n&&(a=n)}function u(e){e.forEach(s)}function l(e){e.forEach(u)}for(var c in e)t(e[c]);return r<=o&&i<=a?[r,i,o,a]:void 0}(e=gM(e)),r=0<t&&n&&function(e,t,n){var h=t[0],f=t[1],r=t[2],i=t[3],p=r-h?(n-1)/(r-h):1,d=i-f?(n-1)/(i-f):1;function o(e){return[Math.round((e[0]-h)*p),Math.round((e[1]-f)*d)]}function a(e,t){for(var n,r,i,o,a,s=-1,u=0,l=e.length,c=new Array(l);++s<l;)n=e[s],o=Math.round((n[0]-h)*p),a=Math.round((n[1]-f)*d),o===r&&a===i||(c[u++]=[r=o,i=a]);for(c.length=u;u<t;)u=c.push([c[0][0],c[0][1]]);return c}function s(e){return a(e,2)}function u(e){return a(e,4)}function l(e){return e.map(u)}function c(e){null!=e&&m.hasOwnProperty(e.type)&&m[e.type](e)}var m={GeometryCollection:function(e){e.geometries.forEach(c)},Point:function(e){e.coordinates=o(e.coordinates)},MultiPoint:function(e){e.coordinates=e.coordinates.map(o)},LineString:function(e){e.arcs=s(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(s)},Polygon:function(e){e.arcs=l(e.arcs)},MultiPolygon:function(e){e.arcs=e.arcs.map(l)}};for(var _ in e)c(e[_]);return{scale:[1/p,1/d],translate:[h,f]}}(e,n,t),i=function(e){var t,n,c=e.coordinates,r=e.lines,i=e.rings,o=r.length+i.length;for(delete e.lines,delete e.rings,a=0,s=r.length;a<s;++a)for(t=r[a];t=t.next;)++o;for(a=0,s=i.length;a<s;++a)for(n=i[a];n=n.next;)++o;for(var l=uM(2*o*1.4,cM,lM),h=e.arcs=[],a=0,s=r.length;a<s;++a)for(t=r[a];u(t),t=t.next;);for(a=0,s=i.length;a<s;++a)if((n=i[a]).next)for(;u(n),n=n.next;);else f(n);function u(e){var t,n,r,i,o,a,s,u;if(r=l.get(t=c[e[0]]))for(s=0,u=r.length;s<u;++s)if(p(i=r[s],e))return e[0]=i[0],void(e[1]=i[1]);if(o=l.get(n=c[e[1]]))for(s=0,u=o.length;s<u;++s)if(d(a=o[s],e))return e[1]=a[0],void(e[0]=a[1]);r?r.push(e):l.set(t,[e]),o?o.push(e):l.set(n,[e]),h.push(e)}function f(e){var t,n,r,i,o;if(n=l.get(c[e[0]]))for(i=0,o=n.length;i<o;++i){if(m(r=n[i],e))return e[0]=r[0],void(e[1]=r[1]);if(_(r,e))return e[0]=r[1],void(e[1]=r[0])}if(n=l.get(t=c[e[0]+g(e)]))for(i=0,o=n.length;i<o;++i){if(m(r=n[i],e))return e[0]=r[0],void(e[1]=r[1]);if(_(r,e))return e[0]=r[1],void(e[1]=r[0])}n?n.push(e):l.set(t,[e]),h.push(e)}function p(e,t){var n=e[0],r=t[0],i=e[1];if(n-i==r-t[1]){for(;n<=i;++n,++r)if(!lM(c[n],c[r]))return;return 1}}function d(e,t){var n=e[0],r=t[0],i=e[1],o=t[1];if(n-i==r-o){for(;n<=i;++n,--o)if(!lM(c[n],c[o]))return;return 1}}function m(e,t){var n=e[0],r=t[0],i=e[1]-n;if(i==t[1]-r){for(var o=g(e),a=g(t),s=0;s<i;++s)if(!lM(c[n+(s+o)%i],c[r+(s+a)%i]))return;return 1}}function _(e,t){var n=e[0],r=t[0],i=e[1],o=t[1],a=i-n;if(a==o-r){for(var s=g(e),u=a-g(t),l=0;l<a;++l)if(!lM(c[n+(l+s)%a],c[o-(l+u)%a]))return;return 1}}function g(e){for(var t=e[0],n=e[1],r=t,i=r,o=c[r];++r<n;){var a=c[r];(a[0]<o[0]||a[0]===o[0]&&a[1]<o[1])&&(i=r,o=a)}return i-t}return e}(function(e){for(var t,n=hM(e),r=e.coordinates,i=e.lines,o=e.rings,a=0,s=i.length;a<s;++a)for(var u=i[a],l=u[0],c=u[1];++l<c;)n.has(r[l])&&(t={0:l,1:u[1]},u[1]=l,u=u.next=t);for(a=0,s=o.length;a<s;++a)for(var h=o[a],f=h[0],p=f,d=h[1],m=n.has(r[f]);++p<d;)n.has(r[p])&&(m?(t={0:p,1:h[1]},h[1]=p,h=h.next=t):(mM(r,f,d,d-p),r[d]=r[f],m=!0,p=f));return e}(function(e){var i=-1,o=[],a=[],s=[];function t(e){e&&n.hasOwnProperty(e.type)&&n[e.type](e)}var n={GeometryCollection:function(e){e.geometries.forEach(t)},LineString:function(e){e.arcs=r(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(r)},Polygon:function(e){e.arcs=e.arcs.map(u)},MultiPolygon:function(e){e.arcs=e.arcs.map(l)}};function r(e){for(var t=0,n=e.length;t<n;++t)s[++i]=e[t];var r={0:i-n+1,1:i};return o.push(r),r}function u(e){for(var t=0,n=e.length;t<n;++t)s[++i]=e[t];var r={0:i-n+1,1:i};return a.push(r),r}function l(e){return e.map(u)}for(var c in e)t(e[c]);return{type:"Topology",coordinates:s,lines:o,rings:a,objects:e}}(e))),o=i.coordinates,a=uM(1.4*i.arcs.length,bM,EM);function s(e){e&&u.hasOwnProperty(e.type)&&u[e.type](e)}e=i.objects,i.bbox=n,i.arcs=i.arcs.map(function(e,t){return a.set(e,t),o.slice(e[0],e[1]+1)}),delete i.coordinates,o=null;var u={GeometryCollection:function(e){e.geometries.forEach(s)},LineString:function(e){e.arcs=l(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(l)},Polygon:function(e){e.arcs=e.arcs.map(l)},MultiPolygon:function(e){e.arcs=e.arcs.map(c)}};function l(e){var t=[];do{var n=a.get(e);t.push(e[0]<e[1]?n:~n)}while(e=e.next);return t}function c(e){return e.map(l)}for(var h in e)s(e[h]);return r&&(i.transform=r,i.arcs=function(e){for(var t=-1,n=e.length;++t<n;){for(var r,i,o=e[t],a=0,s=1,u=o.length,l=o[0],c=l[0],h=l[1];++a<u;)r=(l=o[a])[0],i=l[1],r===c&&i===h||(o[s++]=[r-c,i-h],c=r,h=i);1===s&&(o[s++]=[0,0]),o.length=s}return e}(i.arcs)),i};function bM(e){var t,n=e[0],r=e[1];return r<n&&(t=n,n=r,r=t),n+31*r}function EM(e,t){var n,r=e[0],i=e[1],o=t[0],a=t[1];return i<r&&(n=r,r=i,i=n),a<o&&(n=o,o=a,a=n),r===o&&i===a}function TM(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.mutate;if("FeatureCollection"!==GR(e))throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(e=JD(e));var r=[],i=LR(e,function(e,t){var n=function(e,t){var n,r=e.geometry.coordinates,i=t.geometry.coordinates,o=SM(r[0]),a=SM(r[r.length-1]),s=SM(i[0]),u=SM(i[i.length-1]);if(o===u)n=i.concat(r.slice(1));else if(s===a)n=r.concat(i.slice(1));else if(o===s)n=r.slice(1).reverse().concat(i);else{if(a!==u)return null;n=r.concat(i.reverse().slice(1))}return QN(n)}(e,t);return n||(r.push(e),t)});return i&&r.push(i),r.length?1===r.length?r[0]:$N(r.map(function(e){return e.coordinates})):null}function SM(e){return e[0].toString()+","+e[1].toString()}function CM(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.mutate;if("FeatureCollection"!==GR(e))throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(e=JD(e));var r=function(e){var t={};wR(e,function(e){t[e.geometry.type]=!0});var n=Object.keys(t);return 1===n.length?n[0]:null}(e);if(!r)throw new Error("geojson must be homogenous");switch(r){case"LineString":return TM(e,t);case"Polygon":return function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.mutate;if("FeatureCollection"!==GR(e))throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(e=JD(e));var r=[];wR(e,function(e){r.push(e.geometry)});var i=xM({geoms:nR(r).geometry});return aM(i,i.objects.geoms.geometries)}(e,t);default:throw new Error(r+" is not supported")}}function wM(e,t){var n="object"==typeof t?t.mutate:t;if(!e)throw new Error("geojson is required");var r=GR(e),i=[];switch(r){case"LineString":i=AM(e);break;case"MultiLineString":case"Polygon":MR(e).forEach(function(e){i.push(AM(e))});break;case"MultiPolygon":MR(e).forEach(function(e){var t=[];e.forEach(function(e){t.push(AM(e))}),i.push(t)});break;case"Point":return e;case"MultiPoint":var o={};MR(e).forEach(function(e){var t=e.join("-");o.hasOwnProperty(t)||(i.push(e),o[t]=!0)});break;default:throw new Error(r+" geometry not supported")}return e.coordinates?!0===n?(e.coordinates=i,e):{type:r,coordinates:i}:!0===n?(e.geometry.coordinates=i,e):HN({type:r,coordinates:i},e.properties,e.bbox,e.id)}function AM(e){var t,n,r,i,o,a=MR(e);if(2===a.length&&(t=a[0],n=a[1],t[0]!==n[0]||t[1]!==n[1]))return a;var s=[],u=a.length-1;s.push(a[0]);for(var l=1;l<u;l++)r=a[l-1],i=a[l],IM(r,o=a[l+1],i)||s.push(i);return s.push(o),s}function IM(e,t,n){var r=n[0],i=n[1],o=e[0],a=e[1],s=t[0],u=t[1],l=s-o,c=u-a;return 0==(r-o)*c-(i-a)*l&&(Math.abs(l)>=Math.abs(c)?0<l?o<=r&&r<=s:s<=r&&r<=o:0<c?a<=i&&i<=u:u<=i&&i<=a)}function PM(e,t){var n=e.length-1,r=[e[0]];return function e(t,n,r,i,o){for(var a,s,u,l,c,h,f,p,d,m=i,_=n+1;_<r;_++){var g=(s=t[_],u=t[n],l=t[r],d=p=f=h=c=void 0,h=u.x,f=u.y,p=l.x-h,d=l.y-f,0===p&&0===d||(1<(c=((s.x-h)*p+(s.y-f)*d)/(p*p+d*d))?(h=l.x,f=l.y):0<c&&(h+=p*c,f+=d*c)),(p=s.x-h)*p+(d=s.y-f)*d);m<g&&(a=_,m=g)}i<m&&(1<a-n&&e(t,n,a,i,o),o.push(t[a]),1<r-a&&e(t,a,r,i,o))}(e,0,n,t,r),r.push(e[n]),r}function OM(e,t,n){if(e.length<=2)return e;var r=void 0!==t?t*t:1;return e=PM(e=n?e:function(e,t){for(var n,r,i,o,a,s=e[0],u=[s],l=1,c=e.length;l<c;l++)n=e[l],i=s,0,o=(r=n).x-i.x,a=r.y-i.y,t<o*o+a*a&&(u.push(n),s=n);return s!==n&&u.push(n),u}(e,r),r)}function LM(e,t,n){return OM(e.map(function(e){return{x:e[0],y:e[1],z:e[2]}}),t,n).map(function(e){return e.z?[e.x,e.y,e.z]:[e.x,e.y]})}function NM(e,r,i){return e.map(function(e){var t=e.map(function(e){return{x:e[0],y:e[1]}});if(t.length<4)throw new Error("invalid polygon");for(var n=OM(t,r,i).map(function(e){return[e.x,e.y]});!RM(n);)n=OM(t,r-=.01*r,i).map(function(e){return[e.x,e.y]});return n[n.length-1][0]===n[0][0]&&n[n.length-1][1]===n[0][1]||n.push(n[0]),n})}function RM(e){return!(e.length<3)&&(3!==e.length||e[2][0]!==e[0][0]||e[2][1]!==e[0][1])}function DM(e){this.points=e.points||[],this.duration=e.duration||1e4,this.sharpness=e.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=e.stepLength||60,this.length=this.points.length;for(var t=this.delay=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(t=0;t<this.length-1;t++){var n=this.points[t],r=this.points[t+1];this.centers.push({x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:(n.z+r.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),t=0;t<this.centers.length-1;t++){var n=this.centers[t],r=this.centers[t+1],i=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,o=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,a=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+i),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+a)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+i),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}function MM(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.resolution||1e4,r=t.sharpness||.85;if(!e)throw new Error("line is required");if(!fR(n))throw new Error("resolution must be an number");if(!fR(r))throw new Error("sharpness must be an number");for(var i=[],o=new DM({points:VR(e).coordinates.map(function(e){return{x:e[0],y:e[1]}}),duration:n,sharpness:r}),a=0;a<o.duration;a+=10){var s=o.pos(a);Math.floor(a/100)%2==0&&i.push([s.x,s.y])}return QN(i,e.properties)}function FM(e){dR(e);var t=Number(e[0]),n=Number(e[1]),r=Number(e[2]),i=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[t,n];return jN([[o,[r,n],[r,i],[t,i],o]])}function zM(e){return FM(RR(e))}function BM(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=ZD(e.slice(0,2),[r,n]);if(ZD(e.slice(0,2),[t,i])<=o){var a=(n+i)/2;return[t,a-(r-t)/2,r,a+(r-t)/2]}var s=(t+r)/2;return[s-(i-n)/2,n,s+(i-n)/2,i]}function UM(e,t,n,r){if(!pR(r=r||{}))throw new Error("options is invalid");var i=r.units,o=r.properties,a=DR(e),s=lR(a[0]),u=lR(a[1]),l=lR(n),c=oR(t,i),h=Math.asin(Math.sin(u)*Math.cos(c)+Math.cos(u)*Math.sin(c)*Math.cos(l));return YN([uR(s+Math.atan2(Math.sin(l)*Math.sin(c)*Math.cos(u),Math.cos(c)-Math.sin(u)*Math.sin(h))),uR(h)],o)}function VM(e,t,n){var r=(n=n||{}).steps||64,i=n.properties;if(!e)throw new Error("center is required");if(!t)throw new Error("radius is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be a number");r=r||64,i=i||e.properties||{};for(var o=[],a=0;a<r;a++)o.push(UM(e,t,-360*a/r,n).geometry.coordinates);return o.push(o[0]),jN([o],i)}function kM(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");if(!0===n.final)return(kM(t,e)+180)%360;var r=DR(e),i=DR(t),o=lR(r[0]),a=lR(i[0]),s=lR(r[1]),u=lR(i[1]),l=Math.sin(a-o)*Math.cos(u),c=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(a-o);return uR(Math.atan2(l,c))}function GM(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.properties;if(!e)throw new Error("geojson is required");var r=RR(e);return YN([(r[0]+r[2])/2,(r[1]+r[3])/2],n)}function qM(e,t){var n=0,r=0,i=0;return gR(e,function(e){n+=e[0],r+=e[1],i++},!0),YN([n/i,r/i],t)}function HM(t){var n=[];return"FeatureCollection"===t.type?bR(t,function(t){gR(t,function(e){n.push(YN(e,t.properties))})}):gR(t,function(e){n.push(YN(e,t.properties))}),JN(n)}DM.prototype.cacheSteps=function(e){var t=[],n=this.pos(0);t.push(0);for(var r=0;r<this.duration;r+=10){var i=this.pos(r);e<Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))&&(t.push(r),n=i)}return t},DM.prototype.vector=function(e){var t=this.pos(e+10),n=this.pos(e-10);return{angle:180*Math.atan2(t.y-n.y,t.x-n.x)/3.14,speed:Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)+(n.z-t.z)*(n.z-t.z))}},DM.prototype.pos=function(e){var t=e-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);var n=t/this.duration;if(1<=n)return this.points[this.length-1];var r,i,o,a,s,u,l,c,h=Math.floor((this.points.length-1)*n),f=(this.length-1)*n-h;return r=f,i=this.points[h],o=this.controls[h][1],a=this.controls[h+1][0],s=this.points[h+1],c=[(l=(u=r)*u)*u,3*l*(1-u),3*u*(1-u)*(1-u),(1-u)*(1-u)*(1-u)],{x:s.x*c[0]+a.x*c[1]+o.x*c[2]+i.x*c[3],y:s.y*c[0]+a.y*c[1]+o.y*c[2]+i.y*c[3],z:s.z*c[0]+a.z*c[1]+o.z*c[2]+i.z*c[3]}};var WM=XM,YM=XM;function XM(e,t,n){n=n||2;var r,i,o,a,s,u,l,c=t&&t.length,h=c?t[0]*n:e.length,f=jM(e,0,h,n,!0),p=[];if(!f)return p;if(c&&(f=function(e,t,n,r){var i,o,a,s,u,l=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(u=jM(e,a,s,r,!1))===u.next&&(u.steiner=!0),l.push(iF(u));for(l.sort(tF),i=0;i<l.length;i++)nF(l[i],n),n=KM(n,n.next);return n}(e,t,f,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),o<s&&(o=s),a<u&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return QM(f,p,n,r,i,l),p}function jM(e,t,n,r,i){var o,a;if(i===0<dF(e,t,n,r))for(o=t;o<n;o+=r)a=hF(o,e[o],e[o+1],a);else for(o=n-r;t<=o;o-=r)a=hF(o,e[o],e[o+1],a);return a&&sF(a,a.next)&&(fF(a),a=a.next),a}function KM(e,t){if(!e)return e;t=t||e;var n,r=e;do{if(n=!1,r.steiner||!sF(r,r.next)&&0!==aF(r.prev,r,r.next))r=r.next;else{if(fF(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function QM(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;for(;null===i.z&&(i.z=rF(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,o=e=null,a=0;n;){for(a++,r=n,t=s=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;0<s||0<u&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(n=(i=n).nextZ,s--):(r=(i=r).nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(1<a)}(i)}(e,r,i,o);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,o?JM(e,r,i,o):ZM(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),fF(e),e=u.next,l=u.next;else if((e=u)===l){a?1===a?QM(e=$M(e,t,n),t,n,r,i,o,2):2===a&&eF(e,t,n,r,i,o):QM(KM(e),t,n,r,i,o,1);break}}}function ZM(e){var t=e.prev,n=e,r=e.next;if(!(0<=aF(t,n,r))){for(var i=e.next.next;i!==e.prev;){if(oF(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=aF(i.prev,i,i.next))return;i=i.next}return 1}}function JM(e,t,n,r){var i=e.prev,o=e,a=e.next;if(!(0<=aF(i,o,a))){for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=rF(s,u,t,n,r),f=rF(l,c,t,n,r),p=e.nextZ;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&oF(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=aF(p.prev,p,p.next))return;p=p.nextZ}for(p=e.prevZ;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&oF(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=aF(p.prev,p,p.next))return;p=p.prevZ}return 1}}function $M(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!sF(i,o)&&uF(i,r,r.next,o)&&lF(i,o)&&lF(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),fF(r),fF(r.next),r=e=o),r=r.next}while(r!==e);return r}function eF(e,t,n,r,i,o){var a,s,u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&(s=l,(a=u).next.i!==s.i&&a.prev.i!==s.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&uF(n,n.next,e,t))return 1;n=n.next}while(n!==e);return}(a,s)&&lF(a,s)&&lF(s,a)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(a,s))){var c=cF(u,l),u=KM(u,u.next),c=KM(c,c.next);return QM(u,t,n,r,i,o),void QM(c,t,n,r,i,o)}l=l.next}u=u.next}while(u!==e)}function tF(e,t){return e.x-t.x}function nF(e,t){var n;(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&a<s){if((a=s)===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n.prev;var u,l=n,c=n.x,h=n.y,f=1/0;r=n.next;for(;r!==l;)i>=r.x&&r.x>=c&&i!==r.x&&oF(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<f||u===f&&r.x>n.x)&&lF(r,e)&&(n=r,f=u),r=r.next;return n}(e,t))&&KM(n=cF(t,e),n.next)}function rF(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function iF(e){for(var t=e,n=e;t.x<n.x&&(n=t),(t=t.next)!==e;);return n}function oF(e,t,n,r,i,o,a,s){return 0<=(i-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(r-s)-(n-a)*(t-s)&&0<=(n-a)*(o-s)-(i-a)*(r-s)}function aF(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function sF(e,t){return e.x===t.x&&e.y===t.y}function uF(e,t,n,r){return sF(e,t)&&sF(n,r)||sF(e,r)&&sF(n,t)||0<aF(e,t,n)!=0<aF(e,t,r)&&0<aF(n,r,e)!=0<aF(n,r,t)}function lF(e,t){return aF(e.prev,e,e.next)<0?0<=aF(e,t,e.next)&&0<=aF(e,e.prev,t):aF(e,t,e.prev)<0||aF(e,e.next,t)<0}function cF(e,t){var n=new pF(e.i,e.x,e.y),r=new pF(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(n.next=i).prev=n,(r.next=n).prev=r,(o.next=r).prev=o,r}function hF(e,t,n,r){var i=new pF(e,t,n);return r?(i.next=r.next,(i.prev=r).next.prev=i,r.next=i):(i.prev=i).next=i,i}function fF(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function pF(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dF(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function mF(e){var r=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);0<i&&(r+=e[i-1].length,n.holes.push(r))}return n}(e),i=WM(r.vertices,r.holes,2),t=[],o=[];i.forEach(function(e,t){var n=i[t];o.push([r.vertices[2*n],r.vertices[2*n+1]])});for(var n=0;n<o.length;n+=3){var a=o.slice(n,n+3);a.push(o[n]),t.push(jN([a]))}return t}function _F(r,e){if(!r)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var i,o=1/0;return bR(e,function(e,t){var n=ZD(r,e);n<o&&((i=JD(e)).properties.featureIndex=t,i.properties.distanceToPoint=n,o=n)}),i}function gF(e,t,n,r,i){!function e(t,n,r,i,o){for(;r<i;){var a,s,u,l,c,h,f;600<i-r&&(a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1),h=Math.max(r,Math.floor(n-s*l/a+c)),f=Math.min(i,Math.floor(n+(a-s)*l/a+c)),e(t,n,h,f,o));var p=t[n],d=r,m=i;for(yF(t,r,n),0<o(t[i],p)&&yF(t,r,i);d<m;){for(yF(t,d,m),d++,m--;o(t[d],p)<0;)d++;for(;0<o(t[m],p);)m--}0===o(t[r],p)?yF(t,r,m):yF(t,++m,i),m<=n&&(r=m+1),n<=m&&(i=m-1)}}(e,t,n||0,r||e.length-1,i||vF)}function yF(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function vF(e,t){return e<t?-1:t<e?1:0}function xF(e,t){if(!(this instanceof xF))return new xF(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function bF(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function EF(e,t){TF(e,0,e.children.length,t,e)}function TF(e,t,n,r,i){(i=i||LF(null)).minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=t;a<n;a++)o=e.children[a],SF(i,e.leaf?r(o):o);return i}function SF(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function CF(e,t){return e.minX-t.minX}function wF(e,t){return e.minY-t.minY}function AF(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function IF(e){return e.maxX-e.minX+(e.maxY-e.minY)}function PF(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function OF(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function LF(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function NF(e,t,n,r,i){for(var o,a=[t,n];a.length;)(n=a.pop())-(t=a.pop())<=r||(gF(e,o=t+Math.ceil((n-t)/r/2)*r,t,n,i),a.push(t,o,o,n))}function RF(e){var t=xF(e);return t.insert=function(e){var t;return Array.isArray(e)?(e=DF(t=e)).bbox=t:e.bbox=e.bbox?e.bbox:MF(e),xF.prototype.insert.call(this,e)},t.load=function(e){var n=[];return Array.isArray(e)?e.forEach(function(e){var t=DF(e);t.bbox=e,n.push(t)}):bR(e,function(e){e.bbox=e.bbox?e.bbox:MF(e),n.push(e)}),xF.prototype.load.call(this,n)},t.remove=function(e){var t;return Array.isArray(e)&&((e=DF(t=e)).bbox=t),xF.prototype.remove.call(this,e)},t.clear=function(){return xF.prototype.clear.call(this)},t.search=function(e){return{type:"FeatureCollection",features:xF.prototype.search.call(this,this.toBBox(e))}},t.collides=function(e){return xF.prototype.collides.call(this,this.toBBox(e))},t.all=function(){return{type:"FeatureCollection",features:xF.prototype.all.call(this)}},t.toJSON=function(){return xF.prototype.toJSON.call(this)},t.fromJSON=function(e){return xF.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t=e.bbox?e.bbox:Array.isArray(e)&&4===e.length?e:MF(e);return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}function DF(e){var t=[e[0],e[1]],n=[e[0],e[3]],r=[e[2],e[3]];return{type:"Feature",bbox:e,properties:{},geometry:{type:"Polygon",coordinates:[[t,[e[2],e[1]],r,n,t]]}}}function MF(e){var t=[1/0,1/0,-1/0,-1/0];return gR(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}function FF(e){if(!e)throw new Error("geojson is required");var t=[];return wR(e,function(e){!function(n,r){var e=[],t=n.geometry;switch(t.type){case"Polygon":e=MR(t);break;case"LineString":e=[MR(t)]}e.forEach(function(e){var t,l,c;(t=e,l=n.properties,c=[],t.reduce(function(e,t){var n,r,i,o,a,s,u=QN([e,t],l);return u.bbox=(r=t,i=(n=e)[0],o=n[1],a=r[0],s=r[1],[i<a?i:a,o<s?o:s,a<i?i:a,s<o?o:s]),c.push(u),t}),c).forEach(function(e){e.id=r.length,r.push(e)})})}(e,t)}),JN(t)}function zF(e,t){var i={},o=[];if("LineString"===e.type&&(e=HN(e)),"LineString"===t.type&&(t=HN(t)),"Feature"===e.type&&"Feature"===t.type&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var n=BF(e,t);return n&&o.push(n),JN(o)}var a=RF();return a.load(FF(t)),bR(FF(e),function(r){bR(a.search(r),function(e){var t,n=BF(r,e);n&&(t=MR(n).join(","),i[t]||(i[t]=!0,o.push(n)))})}),JN(o)}function BF(e,t){var n=MR(e),r=MR(t);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],a=n[1][0],s=n[1][1],u=r[0][0],l=r[0][1],c=r[1][0],h=r[1][1],f=(h-l)*(a-i)-(c-u)*(s-o);if(0==f)return null;var p=((c-u)*(o-l)-(h-l)*(i-u))/f,d=((a-i)*(o-l)-(s-o)*(i-u))/f;return 0<=p&&p<=1&&0<=d&&d<=1?YN([i+p*(a-i),o+p*(s-o)]):null}function UF(e,f,p){if(!pR(p=p||{}))throw new Error("options is invalid");var t=e.geometry?e.geometry.type:e.type;if("LineString"!==t&&"MultiLineString"!==t)throw new Error("lines must be LineString or MultiLineString");var d=YN([1/0,1/0],{dist:1/0}),m=0;return wR(e,function(e){for(var t=MR(e),n=0;n<t.length-1;n++){var r=YN(t[n]);r.properties.dist=ZD(f,r,p);var i=YN(t[n+1]);i.properties.dist=ZD(f,i,p);var o=ZD(r,i,p),a=Math.max(r.properties.dist,i.properties.dist),s=kM(r,i),u=UM(f,a,s+90,p),l=UM(f,a,s-90,p),c=zF(QN([u.geometry.coordinates,l.geometry.coordinates]),QN([r.geometry.coordinates,i.geometry.coordinates])),h=null;0<c.features.length&&((h=c.features[0]).properties.dist=ZD(f,h,p),h.properties.location=m+ZD(r,h,p)),r.properties.dist<d.properties.dist&&((d=r).properties.index=n,d.properties.location=m),i.properties.dist<d.properties.dist&&((d=i).properties.index=n+1,d.properties.location=m+o),h&&h.properties.dist<d.properties.dist&&((d=h).properties.index=n),m+=o}}),d}function VF(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r,i=n.final;if(!e)throw new Error("start point is required");if(!t)throw new Error("end point is required");return 180<(r=i?kF(DR(t),DR(e)):kF(DR(e),DR(t)))?-(360-r):r}function kF(e,t){var n=lR(e[1]),r=lR(t[1]),i=lR(t[0]-e[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(uR(Math.atan2(i,o))+360)%360}function GF(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!e)throw new Error("from point is required");if(!t)throw new Error("to point is required");var i=DR(e),o=DR(t);return o[0]+=180<o[0]-i[0]?-360:180<i[0]-o[0]?360:0,cR(function(e,t,n){var r=n=void 0===n?VN:Number(n),i=e[1]*Math.PI/180,o=t[1]*Math.PI/180,a=o-i,s=Math.abs(t[0]-e[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var u=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),l=1e-11<Math.abs(u)?a/u:Math.cos(i);return Math.sqrt(a*a+l*l*s*s)*r}(i,o),"meters",r)}function qF(e,t){return WF(e,"mercator",t)}function HF(e,t){return WF(e,"wgs84",t)}function WF(e,n,t){if(!pR(t=t||{}))throw new Error("options is invalid");var r=t.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&fR(e[0])?e=("mercator"===n?YF:XF)(e):(!0!==r&&(e=JD(e)),gR(e,function(e){var t=("mercator"===n?YF:XF)(e);e[0]=t[0],e[1]=t[1]})),e}function YF(e){var t,n=Math.PI/180,r=20037508.342789244,i=[6378137*(Math.abs(e[0])<=180?e[0]:e[0]-360*((t=e[0])<0?-1:0<t?1:0))*n,6378137*Math.log(Math.tan(.25*Math.PI+.5*e[1]*n))];return i[0]>r&&(i[0]=r),i[0]<-r&&(i[0]=-r),i[1]>r&&(i[1]=r),i[1]<-r&&(i[1]=-r),i}function XF(e){var t=180/Math.PI;return[e[0]*t/6378137,(.5*Math.PI-2*Math.atan(Math.exp(-e[1]/6378137)))*t]}XM.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(dF(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(dF(e,l,c,n))}for(var h=0,s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[f]-e[d])*(e[1+p]-e[1+f])-(e[f]-e[p])*(e[1+d]-e[1+f]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},XM.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);0<i&&(r+=e[i-1].length,n.holes.push(r))}return n},WM.default=YM,xF.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,n=[],r=this.toBBox;if(!OF(e,t))return n;for(var i,o,a,s,u=[];t;){for(i=0,o=t.children.length;i<o;i++)a=t.children[i],OF(e,s=t.leaf?r(a):a)&&(t.leaf?n.push(a):PF(e,s)?this._all(a,n):u.push(a));t=u.pop()}return n},collides:function(e){var t=this.data,n=this.toBBox;if(!OF(e,t))return!1;for(var r,i,o,a,s=[];t;){for(r=0,i=t.children.length;r<i;r++)if(o=t.children[r],OF(e,a=t.leaf?n(o):o)){if(t.leaf||PF(e,a))return!0;s.push(o)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var r,i=this._build(e.slice(),0,e.length-1,0);return this.data.children.length?this.data.height===i.height?this._splitRoot(this.data,i):(this.data.height<i.height&&(r=this.data,this.data=i,i=r),this._insert(i,this.data.height-i.height-1,!0)):this.data=i,this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=LF([]),this},remove:function(e,t){if(!e)return this;for(var n,r,i,o,a=this.data,s=this.toBBox(e),u=[],l=[];a||u.length;){if(a||(a=u.pop(),r=u[u.length-1],n=l.pop(),o=!0),a.leaf&&-1!==(i=bF(e,a.children,t)))return a.children.splice(i,1),u.push(a),this._condense(u),this;o||a.leaf||!PF(a,s)?r?(n++,a=r.children[n],o=!1):a=null:(u.push(a),l.push(n),n=0,a=(r=a).children[0])}return this},toBBox:function(e){return e},compareMinX:CF,compareMinY:wF,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},_build:function(e,t,n,r){var i,o=n-t+1,a=this._maxEntries;if(o<=a)return EF(i=LF(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(i=LF([])).leaf=!1,i.height=r;var s,u,l,c,h=Math.ceil(o/a),f=h*Math.ceil(Math.sqrt(a));for(NF(e,t,n,f,this.compareMinX),s=t;s<=n;s+=f)for(NF(e,s,l=Math.min(s+f-1,n),h,this.compareMinY),u=s;u<=l;u+=h)c=Math.min(u+h-1,l),i.children.push(this._build(e,u,c,r-1));return EF(i,this.toBBox),i},_chooseSubtree:function(e,t,n,r){for(var i,o,a,s,u,l,c,h,f,p;r.push(t),!t.leaf&&r.length-1!==n;){for(c=h=1/0,i=0,o=t.children.length;i<o;i++)u=AF(a=t.children[i]),f=e,p=a,(l=(Math.max(p.maxX,f.maxX)-Math.min(p.minX,f.minX))*(Math.max(p.maxY,f.maxY)-Math.min(p.minY,f.minY))-u)<h?(h=l,c=u<c?u:c,s=a):l===h&&u<c&&(c=u,s=a);t=s||t.children[0]}return t},_insert:function(e,t,n){var r=this.toBBox,i=n?e:r(e),o=[],a=this._chooseSubtree(i,this.data,t,o);for(a.children.push(e),SF(a,i);0<=t&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),a=LF(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,EF(n,this.toBBox),EF(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)},_splitRoot:function(e,t){this.data=LF([e,t]),this.data.height=e.height+1,this.data.leaf=!1,EF(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,n){for(var r,i,o,a,s,u,l,c,h,f,p,d,m=s=1/0,_=t;_<=n-t;_++)r=TF(e,0,_,this.toBBox),i=TF(e,_,n,this.toBBox),l=r,c=i,0,h=Math.max(l.minX,c.minX),f=Math.max(l.minY,c.minY),p=Math.min(l.maxX,c.maxX),d=Math.min(l.maxY,c.maxY),o=Math.max(0,p-h)*Math.max(0,d-f),a=AF(r)+AF(i),o<m?(m=o,u=_,s=a<s?a:s):o===m&&a<s&&(s=a,u=_);return u},_chooseSplitAxis:function(e,t,n){var r=e.leaf?this.compareMinX:CF,i=e.leaf?this.compareMinY:wF;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},_allDistMargin:function(e,t,n,r){e.children.sort(r);for(var i,o=this.toBBox,a=TF(e,0,t,o),s=TF(e,n-t,n,o),u=IF(a)+IF(s),l=t;l<n-t;l++)i=e.children[l],SF(a,e.leaf?o(i):i),u+=IF(a);for(l=n-t-1;t<=l;l--)i=e.children[l],SF(s,e.leaf?o(i):i),u+=IF(s);return u},_adjustParentBBoxes:function(e,t,n){for(var r=n;0<=r;r--)SF(t[r],e)},_condense:function(e){for(var t,n=e.length-1;0<=n;n--)0===e[n].children.length?0<n?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():EF(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var jF=Object.freeze({toMercator:qF,toWgs84:HF});function KF(e,t,i){if(!pR(i=i||{}))throw new Error("options is invalid");if(!e)throw new Error("pt is required");if(Array.isArray(e)?e=YN(e):"Point"===e.type?e=HN(e):BR(e,"Point","point"),!t)throw new Error("line is required");Array.isArray(t)?t=QN(t):"LineString"===t.type?t=HN(t):BR(t,"LineString","line");var o=1/0,a=e.geometry.coordinates;return IR(t,function(e){var t=e.geometry.coordinates[0],n=e.geometry.coordinates[1],r=function(e,t,n,r){var i=r.mercator,o=(!0!==i?ZD:QF)(t,e,r),a=sR((!0!==i?kM:VF)(t,e)),s=sR((!0!==i?kM:VF)(t,n)),u=Math.abs(a-s);if(90<u)return o;var l=(s+180)%360,c=sR((!0!==i?kM:VF)(n,e)),h=Math.abs(c-l);180<h&&(h=Math.abs(h-360));return 90<h?(!0!==i?ZD:QF)(e,n,r):!0!==i?o*Math.sin(lR(u)):function(e,t,n,r){var i=0;(180<=Math.abs(e[0])||180<=Math.abs(t[0])||180<=Math.abs(n[0]))&&(i=0<e[0]||0<t[0]||0<n[0]?-180:180);var o=YN(n),a=qF([e[0]+i,e[1]]),s=qF([t[0]+i,t[1]]),u=qF([n[0]+i,n[1]]),l=HF(function(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1],s=n[0],u=n[1],l=o-r,c=a-i,h=((s-r)*l+(u-i)*c)/(l*l+c*c);return[r+h*l,i+h*c]}(a,s,u));0!==i&&(l[0]-=i);return GF(o,l,r)}(t,n,e,r)}(a,t,n,i);r<o&&(o=r)}),o}function QF(e,t,n){var r=n.units,i=0;180<=Math.abs(e[0])&&(i=0<e[0]?-180:180),180<=Math.abs(t[0])&&(i=0<t[0]?-180:180);function o(e){return e*e}var a=qF([e[0]+i,e[1]]),s=qF([t[0]+i,t[1]]),u=o(a[0]-s[0])+o(a[1]-s[1]);return cR(Math.sqrt(u),"meters",r)}function ZF(e,t,n,r,i,o,a,s){var u,l,c,h={x:null,y:null,onLine1:!1,onLine2:!1},f=(s-o)*(n-e)-(a-i)*(r-t);return 0==f?null!==h.x&&null!==h.y&&h:(c=(n-e)*(u=t-o)-(r-t)*(l=e-i),u=((a-i)*u-(s-o)*l)/f,l=c/f,h.x=e+u*(n-e),h.y=t+u*(r-t),0<=u&&u<=1&&(h.onLine1=!0),0<=l&&l<=1&&(h.onLine2=!0),!(!h.onLine1||!h.onLine2)&&[h.x,h.y])}function JF(e){for(var t,n="FeatureCollection"===(t=e).type?t:"Feature"===t.type?JN([t]):JN([HN(t)]),r=GM(n),i=!1,o=0;!i&&o<n.features.length;){var a=n.features[o].geometry,s=!1;if("Point"===a.type)r.geometry.coordinates[0]===a.coordinates[0]&&r.geometry.coordinates[1]===a.coordinates[1]&&(i=!0);else if("MultiPoint"===a.type)for(var u=!1,l=0;!u&&l<a.coordinates.length;)r.geometry.coordinates[0]===a.coordinates[l][0]&&r.geometry.coordinates[1]===a.coordinates[l][1]&&(u=i=!0),l++;else if("LineString"===a.type)for(l=0;!s&&l<a.coordinates.length-1;)$F(r.geometry.coordinates[0],r.geometry.coordinates[1],a.coordinates[l][0],a.coordinates[l][1],a.coordinates[l+1][0],a.coordinates[l+1][1])&&(i=s=!0),l++;else if("MultiLineString"===a.type)for(var c=0;c<a.coordinates.length;){s=!1,l=0;for(var h=a.coordinates[c];!s&&l<h.length-1;)$F(r.geometry.coordinates[0],r.geometry.coordinates[1],h[l][0],h[l][1],h[l+1][0],h[l+1][1])&&(i=s=!0),l++;c++}else"Polygon"!==a.type&&"MultiPolygon"!==a.type||HD(r,a)&&(i=!0);o++}if(i)return r;for(var f=JN([]),o=0;o<n.features.length;o++)f.features=f.features.concat(HM(n.features[o]).features);return YN(_F(r,f).geometry.coordinates)}function $F(e,t,n,r,i,o){return Math.sqrt((i-n)*(i-n)+(o-r)*(o-r))===Math.sqrt((e-n)*(e-n)+(t-r)*(t-r))+Math.sqrt((i-e)*(i-e)+(o-t)*(o-t))}function ez(e){return CR(e,function(e,t){return e+function e(t){var n,r=0;switch(t.type){case"Polygon":return nz(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)r+=nz(t.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)r+=e(t.geometries[n]);return r}}(t)},0)}var tz=6378137;function nz(e){var t=0;if(e&&0<e.length){t+=Math.abs(rz(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(rz(e[n]))}return t}function rz(e){var t,n,r,i,o,a,s=0,u=e.length;if(2<u){for(a=0;a<u;a++)o=a===u-2?(r=u-2,i=u-1,0):a===u-1?(r=u-1,i=0,1):(i=(r=a)+1,a+2),t=e[r],n=e[i],s+=(iz(e[o][0])-iz(t[0]))*Math.sin(iz(n[1]));s=s*tz*tz/2}return s}function iz(e){return e*Math.PI/180}function oz(e,r){if(!pR(r=r||{}))throw new Error("options is invalid");if(!e)throw new Error("geojson is required");return PR(e,function(e,t){var n=t.geometry.coordinates;return e+ZD(n[0],n[1],r)},0)}function az(e,t,n,r){if(!pR(r=r||{}))throw new Error("options is invalid");var i,o=[];if("Feature"===e.type)i=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");i=e.coordinates}for(var a,s,u,l=0,c=0;c<i.length&&!(l<=t&&c===i.length-1);c++){if(t<l&&0===o.length){if(!(a=t-l))return o.push(i[c]),QN(o);s=kM(i[c],i[c-1])-180,u=UM(i[c],a,s,r),o.push(u.geometry.coordinates)}if(n<=l)return(a=n-l)?(s=kM(i[c],i[c-1])-180,u=UM(i[c],a,s,r),o.push(u.geometry.coordinates)):o.push(i[c]),QN(o);if(t<=l&&o.push(i[c]),c===i.length-1)return QN(o);l+=ZD(i[c],i[c+1],r)}return QN(i[i.length-1])}function sz(e,t,n){var r=(n=n||{}).ignoreEndVertices;if(!pR(n))throw new Error("invalid options");if(!e)throw new Error("pt is required");if(!t)throw new Error("line is required");for(var i=DR(e),o=MR(t),a=0;a<o.length-1;a++){var s=!1;if(r&&(0===a&&(s="start"),a===o.length-2&&(s="end"),0===a&&a+1===o.length-1&&(s="both")),uz(o[a],o[a+1],i,s))return!0}return!1}function uz(e,t,n,r){var i=n[0],o=n[1],a=e[0],s=e[1],u=t[0],l=t[1],c=u-a,h=l-s;return 0==(n[0]-a)*h-(n[1]-s)*c&&(r?"start"===r?Math.abs(c)>=Math.abs(h)?0<c?a<i&&i<=u:u<=i&&i<a:0<h?s<o&&o<=l:l<=o&&o<s:"end"===r?Math.abs(c)>=Math.abs(h)?0<c?a<=i&&i<u:u<i&&i<=a:0<h?s<=o&&o<l:l<o&&o<=s:"both"===r&&(Math.abs(c)>=Math.abs(h)?0<c?a<i&&i<u:u<i&&i<a:0<h?s<o&&o<l:l<o&&o<s):Math.abs(c)>=Math.abs(h)?0<c?a<=i&&i<=u:u<=i&&i<=a:0<h?s<=o&&o<=l:l<=o&&o<=s)}function lz(e,t){var n=GR(e),r=GR(t),i=VR(e),o=VR(t);switch(n){case"Point":switch(r){case"MultiPoint":return function(e,t){var n,r=!1;for(n=0;n<t.coordinates.length;n++)if(hz(t.coordinates[n],e.coordinates)){r=!0;break}return r}(i,o);case"LineString":return sz(i,o,{ignoreEndVertices:!0});case"Polygon":return HD(i,o,{ignoreBoundary:!0});default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"MultiPoint":return function(e,t){for(var n=0;n<e.coordinates.length;n++){for(var r=!1,i=0;i<t.coordinates.length;i++)hz(e.coordinates[n],t.coordinates[i])&&(r=!0);if(!r)return!1}return!0}(i,o);case"LineString":return function(e,t){for(var n=!1,r=0;r<e.coordinates.length;r++){if(!sz(e.coordinates[r],t))return!1;n=n||sz(e.coordinates[r],t,{ignoreEndVertices:!0})}return n}(i,o);case"Polygon":return function(e,t){for(var n=!0,r=0;r<e.coordinates.length;r++){var i=HD(e.coordinates[1],t);if(!i){n=!1;break}i=HD(e.coordinates[1],t,{ignoreBoundary:!0})}return n&&i}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"LineString":return function(e,t){for(var n=0;n<e.coordinates.length;n++)if(!sz(e.coordinates[n],t))return!1;return!0}(i,o);case"Polygon":return function(e,t){var n=RR(t),r=RR(e);if(!cz(n,r))return!1;for(var i=!1,o=0;o<e.coordinates.length-1;o++){if(!HD(e.coordinates[o],t))return!1;var a;(i=i||HD(e.coordinates[o],t,{ignoreBoundary:!0}))||(s=e.coordinates[o],u=e.coordinates[o+1],a=[(s[0]+u[0])/2,(s[1]+u[1])/2],i=HD(a,t,{ignoreBoundary:!0}))}var s,u;return i}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Polygon":return function(e,t){var n=RR(e);if(!cz(RR(t),n))return!1;for(var r=0;r<e.coordinates[0].length;r++)if(!HD(e.coordinates[0][r],t))return!1;return!0}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function cz(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function hz(e,t){return e[0]===t[0]&&e[1]===t[1]}function fz(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.mask,i=n.properties,o=[];if(null==t)throw new Error("cellSide is required");if(!fR(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(r&&-1===["Polygon","MultiPolygon"].indexOf(GR(r)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=e[0],s=e[1],u=e[2],l=e[3],c=t/ZD([a,s],[u,s],n)*(u-a),h=t/ZD([a,s],[a,l],n)*(l-s),f=u-a,p=l-s,d=Math.floor(f/c),m=(p-Math.floor(p/h)*h)/2,_=a+(f-d*c)/2;_<=u;){for(var g=s+m;g<=l;){var y=YN([_,g],i);(!r||lz(y,r))&&o.push(y),g+=h}_+=c}return JN(o)}function pz(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.precision,r=t.coordinates,i=t.mutate,n=null==n||isNaN(n)?6:n,r=null==r||isNaN(r)?3:r;if(!e)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(e=JSON.parse(JSON.stringify(e)));var o=Math.pow(10,n);return gR(e,function(e){!function(e,t,n){e.length>n&&e.splice(n,e.length);for(var r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t}(e,o,r)}),e}function dz(e,f,t){if("Polygon"!==e.geometry.type)throw new Error("The input feature must be a Polygon");void 0===t&&(t=1);var p=e.geometry.coordinates,d=[],m={};if(t){for(var n=[],r=0;r<p.length;r++)for(var i=0;i<p[r].length-1;i++)n.push(h(r,i));var o=tD();o.load(n)}for(var a=0;a<p.length;a++)for(var s=0;s<p[a].length-1;s++){if(t)o.search(h(a,s)).forEach(function(e){var t=e.ring,n=e.edge;c(a,s,t,n)});else for(var u=0;u<p.length;u++)for(var l=0;l<p[u].length-1;l++)c(a,s,u,l)}return f||(d={type:"Feature",geometry:{type:"MultiPoint",coordinates:d}}),d;function c(e,t,n,r){var i,o,a,s=p[e][t],u=p[e][t+1],l=p[n][r],c=p[n][r+1],h=function(e,t,n,r){if(mz(e,n)||mz(e,r)||mz(t,n)||mz(r,n))return null;var i=e[0],o=e[1],a=t[0],s=t[1],u=n[0],l=n[1],c=r[0],h=r[1],f=(i-a)*(l-h)-(o-s)*(u-c);return 0==f?null:[((i*s-o*a)*(u-c)-(i-a)*(u*h-l*c))/f,((i*s-o*a)*(l-h)-(o-s)*(u*h-l*c))/f]}(s,u,l,c);null!==h&&(o=u[0]!==s[0]?(h[0]-s[0])/(u[0]-s[0]):(h[1]-s[1])/(u[1]-s[1]),a=c[0]!==l[0]?(h[0]-l[0])/(c[0]-l[0]):(h[1]-l[1])/(c[1]-l[1]),1<=o||o<=0||1<=a||a<=0||((i=!m[h])&&(m[h]=!0),f?d.push(f(h,e,t,s,u,o,n,r,l,c,a,i)):d.push(h)))}function h(e,t){var n,r,i=p[e][t],o=p[e][t+1],a=i[0]<o[0]?(n=i[0],o[0]):(n=o[0],i[0]),s=i[1]<o[1]?(r=i[1],o[1]):(r=o[1],i[1]);return{minX:n,minY:r,maxX:a,maxY:s,ring:e,edge:t}}}function mz(e,t){if(e&&t&&e.length===t.length){for(var n=0,r=e.length;n<r;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!mz(e[n],t[n]))return}else if(e[n]!==t[n])return;return 1}}function _z(e){if("Feature"!=e.type)throw new Error("The input must a geojson object of type Feature");if(void 0===e.geometry||null==e.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=e.geometry.type)throw new Error("The input must be a geojson Polygon");for(var t=e.geometry.coordinates.length,n=[],r=0;r<t;r++){var i=e.geometry.coordinates[r];bz(i[0],i[i.length-1])||i.push(i[0]),n.push.apply(n,i.slice(0,i.length-1))}if(!function(e){for(var t={},n=1,r=0,i=e.length;r<i;++r){if(t.hasOwnProperty(e[r])){n=0;break}t[e[r]]=1}return n}(n))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var o=n.length,a=dz(e,function(e,t,n,r,i,o,a,s,u,l,c,h){return[e,t,n,r,i,o,a,s,u,l,c,h]}),s=a.length;if(0==s){for(var u=[],r=0;r<t;r++)u.push(jN([e.geometry.coordinates[r]],{parent:-1,winding:xz(e.geometry.coordinates[r])}));var l=JN(u);return F(),z(),l}for(var c=[],h=[],r=0;r<t;r++){c.push([]);for(var f=0;f<e.geometry.coordinates[r].length-1;f++)c[r].push([new gz(e.geometry.coordinates[r][(f+1).modulo(e.geometry.coordinates[r].length-1)],1,[r,f],[r,(f+1).modulo(e.geometry.coordinates[r].length-1)],void 0)]),h.push(new yz(e.geometry.coordinates[r][f],[r,(f-1).modulo(e.geometry.coordinates[r].length-1)],[r,f],void 0,void 0,!1,!0))}for(r=0;r<s;r++)c[a[r][1]][a[r][2]].push(new gz(a[r][0],a[r][5],[a[r][1],a[r][2]],[a[r][6],a[r][7]],void 0)),a[r][11]&&h.push(new yz(a[r][0],[a[r][1],a[r][2]],[a[r][6],a[r][7]],void 0,void 0,!0,!0));for(var p=h.length,r=0;r<c.length;r++)for(f=0;f<c[r].length;f++)c[r][f].sort(function(e,t){return e.param<t.param?-1:1});for(var d=[],r=0;r<p;r++)d.push({minX:h[r].coord[0],minY:h[r].coord[1],maxX:h[r].coord[0],maxY:h[r].coord[1],index:r});var m=tD();for(m.load(d),r=0;r<c.length;r++)for(f=0;f<c[r].length;f++)for(var _=0;_<c[r][f].length;_++){y=_==c[r][f].length-1?c[r][(f+1).modulo(e.geometry.coordinates[r].length-1)][0].coord:c[r][f][_+1].coord;var g=m.search({minX:y[0],minY:y[1],maxX:y[0],maxY:y[1]})[0];c[r][f][_].nxtIsectAlongEdgeIn=g.index}for(r=0;r<c.length;r++)for(f=0;f<c[r].length;f++)for(_=0;_<c[r][f].length;_++){var y=c[r][f][_].coord,v=(g=m.search({minX:y[0],minY:y[1],maxX:y[0],maxY:y[1]})[0]).index;!(v<o)&&bz(h[v].ringAndEdge1,c[r][f][_].ringAndEdgeIn)?h[v].nxtIsectAlongRingAndEdge1=c[r][f][_].nxtIsectAlongEdgeIn:h[v].nxtIsectAlongRingAndEdge2=c[r][f][_].nxtIsectAlongEdgeIn}for(var x=[],r=0,f=0;f<t;f++){for(var b=r,_=0;_<e.geometry.coordinates[f].length-1;_++)h[r].coord[0]<h[b].coord[0]&&(b=r),r++;for(var E=h[b].nxtIsectAlongRingAndEdge2,_=0;_<h.length;_++)if(h[_].nxtIsectAlongRingAndEdge1==b||h[_].nxtIsectAlongRingAndEdge2==b){var T=_;break}var S=vz([h[T].coord,h[b].coord,h[E].coord],!0)?1:-1;x.push({isect:b,parent:-1,winding:S})}for(x.sort(function(e,t){return h[e.isect].coord>h[t.isect].coord?-1:1}),u=[];0<x.length;){var C,w,A=x.pop(),I=A.isect,P=A.parent,O=A.winding,L=u.length,N=[h[I].coord],R=I;for(w=h[I].ringAndEdge1Walkable?(C=h[I].ringAndEdge1,h[I].nxtIsectAlongRingAndEdge1):(C=h[I].ringAndEdge2,h[I].nxtIsectAlongRingAndEdge2);!bz(h[I].coord,h[w].coord);){N.push(h[w].coord);for(var D,M=void 0,r=0;r<x.length;r++)if(x[r].isect==w){M=r;break}null!=M&&x.splice(M,1),w=bz(C,h[w].ringAndEdge1)?(C=h[w].ringAndEdge2,h[w].ringAndEdge2Walkable=!1,h[w].ringAndEdge1Walkable&&(D={isect:w},vz([h[R].coord,h[w].coord,h[h[w].nxtIsectAlongRingAndEdge2].coord],1==O)?(D.parent=P,D.winding=-O):(D.parent=L,D.winding=O),x.push(D)),h[R=w].nxtIsectAlongRingAndEdge2):(C=h[w].ringAndEdge1,h[w].ringAndEdge1Walkable=!1,h[w].ringAndEdge2Walkable&&(D={isect:w},vz([h[R].coord,h[w].coord,h[h[w].nxtIsectAlongRingAndEdge1].coord],1==O)?(D.parent=P,D.winding=-O):(D.parent=L,D.winding=O),x.push(D)),h[R=w].nxtIsectAlongRingAndEdge1)}N.push(h[w].coord),u.push(jN([N],{index:L,parent:P,winding:O,netWinding:void 0}))}function F(){for(var e=[],t=0;t<l.features.length;t++)-1==l.features[t].properties.parent&&e.push(t);if(1<e.length)for(t=0;t<e.length;t++){for(var n=-1,r=0;r<l.features.length;r++)e[t]!=r&&HD(l.features[e[t]].geometry.coordinates[0][0],l.features[r],{ignoreBoundary:!0})&&ez(l.features[r])<1/0&&(n=r);l.features[e[t]].properties.parent=n}}function z(){for(var e,t=0;t<l.features.length;t++){-1==l.features[t].properties.parent&&(e=l.features[t].properties.winding,B(t,l.features[t].properties.netWinding=e))}}function B(e,t){for(var n,r=0;r<l.features.length;r++){l.features[r].properties.parent==e&&(n=t+l.features[r].properties.winding,B(r,l.features[r].properties.netWinding=n))}}return l=JN(u),F(),z(),l}var gz=function(e,t,n,r,i){this.coord=e,this.param=t,this.ringAndEdgeIn=n,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=i},yz=function(e,t,n,r,i,o,a){this.coord=e,this.ringAndEdge1=t,this.ringAndEdge2=n,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=a};function vz(e,t){if(void 0===t&&(t=!0),3!=e.length)throw new Error("This function requires an array of three points [x,y]");return 0<=(e[1][0]-e[0][0])*(e[2][1]-e[0][1])-(e[1][1]-e[0][1])*(e[2][0]-e[0][0])==t}function xz(e){for(var t=0,n=0;n<e.length-1;n++)e[n][0]<e[t][0]&&(t=n);return vz([e[(t-1).modulo(e.length-1)],e[t],e[(t+1).modulo(e.length-1)]],!0)?1:-1}function bz(e,t){if(e&&t&&e.length==t.length){for(var n=0,r=e.length;n<r;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!bz(e[n],t[n]))return}else if(e[n]!=t[n])return;return 1}}Number.prototype.modulo=function(e){return(this%e+e)%e};function Ez(e,t){this.lon=e,this.lat=t,this.x=Tz*e,this.y=Tz*t}var Tz=Math.PI/180,Sz=180/Math.PI;Ez.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Ez.prototype.antipode=function(){var e=-1*this.lat,t=this.lon<0?180+this.lon:-1*(180-this.lon);return new Ez(t,e)};function Cz(){this.coords=[],this.length=0}Cz.prototype.move_to=function(e){this.length++,this.coords.push(e)};function wz(e){this.properties=e||{},this.geometries=[]}wz.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},wz.prototype.wkt=function(){for(var e="",t="LINESTRING(",n=function(e){t+=e[0]+" "+e[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),e+=t.substring(0,t.length-1)+")"}return e};function Az(e,t,n){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Ez(e.x,e.y),this.end=new Ez(t.x,t.y),this.properties=n||{};var r=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)}function Iz(r,e){var i=[],o=RF();return wR(e,function(e){var t,n;i.forEach(function(e,t){e.id=t}),i.length?(t=o.search(e)).features.length&&(n=Oz(e,t),i=i.filter(function(e){return e.id!==n.id}),o.remove(n),bR(Pz(n,e),function(e){i.push(e),o.insert(e)})):((i=Pz(r,e).features).forEach(function(e){e.bbox||(e.bbox=BM(RR(e)))}),o.load(JN(i)))}),JN(i)}function Pz(e,o){var a=[],t=MR(e)[0],n=MR(e)[e.geometry.coordinates.length-1];if(Lz(t,DR(o))||Lz(n,DR(o)))return JN([e]);var r=RF(),i=FF(e);r.load(i);var s=r.search(o);if(!s.features.length)return JN([e]);var u=Oz(o,s),l=ER(i,function(e,t,n){var r=MR(t)[1],i=DR(o);return n===u.id?(e.push(i),a.push(QN(e)),Lz(i,r)?[i]:[i,r]):(e.push(r),e)},[t]);return 1<l.length&&a.push(QN(l)),JN(a)}function Oz(n,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var r,i=1/0;return bR(e,function(e){var t=UF(e,n).properties.dist;t<i&&(r=e,i=t)}),r}function Lz(e,t){return e[0]===t[0]&&e[1]===t[1]}function Nz(e,t,n,r,i){if(!pR(i=i||{}))throw new Error("options is invalid");var o=i.steps,a=i.units;if(!e)throw new Error("center is required");if(!t)throw new Error("radius is required");if(null==n)throw new Error("bearing1 is required");if(null==r)throw new Error("bearing2 is required");if("object"!=typeof i)throw new Error("options must be an object");o=o||64;var s=Rz(n),u=Rz(r),l=e.properties;if(s===u)return QN(VM(e,t,i).geometry.coordinates[0],l);for(var c=s,h=s<u?u:u+360,f=c,p=[],d=0;f<h;)p.push(UM(e,t,f,a).geometry.coordinates),f=c+360*++d/o;return h<f&&p.push(UM(e,t,h,a).geometry.coordinates),QN(p,l)}function Rz(e){var t=e%360;return t<0&&(t+=360),t}function Dz(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.properties,r=GR(e),i=MR(e),n=n||e.properties||{};if(!i.length)throw new Error("polygon must contain coordinates");switch(r){case"Polygon":return Mz(i,n);case"MultiPolygon":var o=[];return i.forEach(function(e){o.push(Mz(e,n))}),JN(o);default:throw new Error("geom "+r+" not supported")}}function Mz(e,t){return 1<e.length?$N(e,t):QN(e[0],t)}function Fz(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.properties,r=t.autoComplete,i=t.orderCoords;if(!e)throw new Error("lines is required");switch(r=void 0===r||r,i=void 0===i||i,GR(e)){case"FeatureCollection":case"GeometryCollection":var o=[];return(e.features?e.features:e.geometries).forEach(function(e){o.push(MR(zz(e,{},r,i)))}),tR(o,n)}return zz(e,n,r,i)}function zz(e,t,s,u){t=t||e.properties||{};var n=MR(e),r=GR(e);if(!n.length)throw new Error("line must contain coordinates");switch(r){case"LineString":return s&&(n=Bz(n)),jN([n],t);case"MultiLineString":var l=[],c=0;return n.forEach(function(e){var t,n,r,i,o,a;s&&(e=Bz(e)),u?(n=RR(QN(e)),r=n[0],i=n[1],o=n[2],a=n[3],t=Math.abs(r-o)*Math.abs(i-a),c<t?(l.unshift(e),c=t):l.push(e)):l.push(e)}),jN(l,t);default:throw new Error("geometry type "+r+" is not supported")}}function Bz(e){var t=e[0],n=t[0],r=t[1],i=e[e.length-1],o=i[0],a=i[1];return n===o&&r===a||e.push(t),e}Az.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),n=Math.sin(e*this.g)/Math.sin(this.g),r=t*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=t*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),o=t*Math.sin(this.start.y)+n*Math.sin(this.end.y),a=Sz*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[Sz*Math.atan2(i,r),a]},Az.prototype.Arc=function(e,t){var n=[];if(!e||e<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),i=0;i<e;++i){var o=r*i,a=this.interpolate(o);n.push(a)}for(var s=!1,u=0,l=t&&t.offset?t.offset:10,c=180-l,h=-180+l,f=360-l,p=1;p<n.length;++p){var d=n[p-1][0],m=n[p][0],_=Math.abs(m-d);f<_&&(c<m&&d<h||c<d&&m<h)?s=!0:u<_&&(u=_)}var g=[];if(s&&u<l){var y=[];g.push(y);for(var v=0;v<n.length;++v){var x=parseFloat(n[v][0]);if(0<v&&Math.abs(x-n[v-1][0])>f){var b,E,T,S,C=parseFloat(n[v-1][0]),w=parseFloat(n[v-1][1]),A=parseFloat(n[v][0]),I=parseFloat(n[v][1]);if(-180<C&&C<h&&180===A&&v+1<n.length&&-180<n[v-1][0]&&n[v-1][0]<h){y.push([-180,n[v][1]]),v++,y.push([n[v][0],n[v][1]]);continue}if(c<C&&C<180&&-180===A&&v+1<n.length&&n[v-1][0]>c&&n[v-1][0]<180){y.push([180,n[v][1]]),v++,y.push([n[v][0],n[v][1]]);continue}C<h&&c<A&&(b=C,C=A,A=b,E=w,w=I,I=E),c<C&&A<h&&(A+=360),C<=180&&180<=A&&C<A?(S=(T=(180-C)/(A-C))*I+(1-T)*w,y.push([n[v-1][0]>c?180:-180,S]),(y=[]).push([n[v-1][0]>c?-180:180,S])):y=[],g.push(y),y.push([x,n[v][1]])}else y.push([n[v][0],n[v][1]])}}else{var P=[];g.push(P);for(var O=0;O<n.length;++O)P.push([n[O][0],n[O][1]])}for(var L=new wz(this.properties),N=0;N<g.length;++N){var R=new Cz;L.geometries.push(R);for(var D=g[N],M=0;M<D.length;++M)R.move_to(D[M])}return L};var Uz=Vz;function Vz(e,t,n){var r,i,o,a,s,u=e.length,l=Gz(e[0],t),c=[];for(n=n||[],r=1;r<u;r++){for(i=e[r-1],a=s=Gz(o=e[r],t);;){if(!(l|a)){c.push(i),a!==s?(c.push(o),r<u-1&&(n.push(c),c=[])):r===u-1&&c.push(o);break}if(l&a)break;l?l=Gz(i=kz(i,o,l,t),t):a=Gz(o=kz(i,o,a,t),t)}l=s}return c.length&&n.push(c),n}function kz(e,t,n,r){return 8&n?[e[0]+(t[0]-e[0])*(r[3]-e[1])/(t[1]-e[1]),r[3]]:4&n?[e[0]+(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1]),r[1]]:2&n?[r[2],e[1]+(t[1]-e[1])*(r[2]-e[0])/(t[0]-e[0])]:1&n?[r[0],e[1]+(t[1]-e[1])*(r[0]-e[0])/(t[0]-e[0])]:null}function Gz(e,t){var n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function qz(e,t){for(var n=[],r=0;r<e.length;r++){var i=Uz.polygon(e[r],t);0<i.length&&(i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]||i.push(i[0]),4<=i.length&&n.push(i))}return n}(Vz.polyline=Vz).polygon=function(e,t){var n,r,i,o,a,s,u;for(r=1;r<=8;r*=2){for(n=[],i=e[e.length-1],o=!(Gz(i,t)&r),a=0;a<e.length;a++)s=e[a],(u=!(Gz(s,t)&r))!==o&&n.push(kz(i,s,r,t)),u&&n.push(s),i=s,o=u;if(!(e=n).length)break}return n};var Hz=Array.prototype.slice;function Wz(e){return"[object Arguments]"===Object.prototype.toString.call(e)}function Yz(e,t,n){return n=n||{},e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?(n.strict,e===t):function(e,t,n){var r,i;if(Xz(e)||Xz(t))return!1;if(e.prototype!==t.prototype)return!1;if(Wz(e))return!!Wz(t)&&(e=Hz.call(e),t=Hz.call(t),Yz(e,t,n));if(jz(e)){if(!jz(t))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}try{var o=Object.keys(e),a=Object.keys(t)}catch(e){return!1}if(o.length!==a.length)return!1;for(o.sort(),a.sort(),r=o.length-1;0<=r;r--)if(o[r]!==a[r])return!1;for(r=o.length-1;0<=r;r--)if(i=o[r],!Yz(e[i],t[i],n))return!1;return typeof e==typeof t}(e,t,n))}function Xz(e){return null==e}function jz(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.copy||"function"!=typeof e.slice||0<e.length&&"number"!=typeof e[0])}function Kz(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var o,a=n.tolerance||0,s=[],u=RF();return u.load(FF(e)),IR(t,function(r){var i=!1;bR(u.search(r),function(e){var t,n;!1===i&&(Yz(t=MR(r).sort(),n=MR(e).sort())||(0===a?sz(t[0],e)&&sz(t[1],e):UF(e,t[0]).properties.dist<=a&&UF(e,t[1]).properties.dist<=a)?(i=!0,o=o?Qz(o,r):r):(0===a?sz(n[0],r)&&sz(n[1],r):UF(r,n[0]).properties.dist<=a&&UF(r,n[1]).properties.dist<=a)&&(o=o?Qz(o,e):e))}),!1===i&&o&&(s.push(o),o=void 0)}),o&&s.push(o),JN(s)}function Qz(e,t){var n=MR(t),r=MR(e),i=r[0],o=r[r.length-1],a=e.geometry.coordinates;return Yz(n[0],i)?a.unshift(n[1]):Yz(n[0],o)?a.push(n[1]):Yz(n[1],i)?a.unshift(n[0]):Yz(n[1],o)&&a.push(n[0]),e}function Zz(e){var t=e%360;return t<0&&(t+=360),t}function Jz(e,t,n,r){if(!pR(r=r||{}))throw new Error("options is invalid");var i=r.units,o=r.properties;if(!e)throw new Error("origin is required");if(null==t)throw new Error("distance is required");if(null==n)throw new Error("bearing is required");if(!(0<=t))throw new Error("distance must be greater than 0");var a=cR(t,i,"meters"),s=DR(e),u=function(e,t,n,r){r=void 0===r?VN:Number(r);var i=t/r,o=e[0]*Math.PI/180,a=lR(e[1]),s=lR(n),u=i*Math.cos(s),l=a+u;Math.abs(l)>Math.PI/2&&(l=0<l?Math.PI-l:-Math.PI-l);var c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),h=1e-11<Math.abs(c)?u/c:Math.cos(a),f=i*Math.sin(s)/h;return[(180*(o+f)/Math.PI+540)%360-180,180*l/Math.PI]}(s,a,n);return u[0]+=180<u[0]-s[0]?-360:180<s[0]-u[0]?360:0,YN(u,o)}function $z(e,t,n,r,i,o){for(var a=0;a<e.length;a++){var s=e[a],u=e[a+1];a===e.length-1&&(u=e[0]),r=eB(s,u,t),n<=0&&0<r?eB(t,s,i)<0||(i=s):0<n&&r<=0&&(0<eB(t,s,o)||(o=s)),n=r}return[i,o]}function eB(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])}function tB(e){if(!e)throw new Error("line is required");var t=e.geometry?e.geometry.type:e.type;if(!Array.isArray(e)&&"LineString"!==t)throw new Error("geometry must be a LineString");for(var n,r,i=MR(e),o=0,a=1;a<i.length;)n=r||i[0],o+=((r=i[a])[0]-n[0])*(r[1]+n[1]),a++;return 0<o}function nB(e,t){switch("Feature"===e.type?e.geometry.type:e.type){case"GeometryCollection":return SR(e,function(e){nB(e,t)}),e;case"LineString":return rB(MR(e),t),e;case"Polygon":return iB(MR(e),t),e;case"MultiLineString":return MR(e).forEach(function(e){rB(e,t)}),e;case"MultiPolygon":return MR(e).forEach(function(e){iB(e,t)}),e;case"Point":case"MultiPoint":return e}}function rB(e,t){tB(e)===t&&e.reverse()}function iB(e,t){tB(e[0])!==t&&e[0].reverse();for(var n=1;n<e.length;n++)tB(e[n])===t&&e[n].reverse()}function oB(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.zProperty||"elevation",r=t.flip,i=t.flags;UR(e,"Point","input must contain Points");for(var o,a,s=(o=r,a={},bR(e,function(e){var t=MR(e)[1];a[t]||(a[t]=[]),a[t].push(e)}),Object.keys(a).map(function(e){return a[e].sort(function(e,t){return MR(e)[0]-MR(t)[0]})}).sort(function(e,t){return o?MR(e[0])[1]-MR(t[0])[1]:MR(t[0])[1]-MR(e[0])[1]})),u=[],l=0;l<s.length;l++){for(var c=s[l],h=[],f=0;f<c.length;f++){var p=c[f];p.properties[n]?h.push(p.properties[n]):h.push(0),!0===i&&(p.properties.matrixPosition=[l,f])}u.push(h)}return u}var aB={successCallback:null,verbose:!1,polygons:!1},sB={};function uB(e,t,n,r){r=r||{};for(var i=Object.keys(aB),o=0;o<i.length;o++){var a=i[o],s=null!=(s=r[a])?s:aB[a];sB[a]=s}sB.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+t+":"+(t+n)+"]");var u,l,c=function(e,t,n){for(var r,i,o,a,s,u,l,c,h=e.length-1,f=e[0].length-1,p={rows:h,cols:f,cells:[]},d=t+Math.abs(n),m=0;m<h;++m){p.cells[m]=[];for(var _=0;_<f;++_){var g,y,v,x,b=0,E=e[m+1][_],T=e[m+1][_+1],S=e[m][_+1],C=e[m][_];isNaN(E)||isNaN(T)||isNaN(S)||isNaN(C)||(b|=E<t?0:d<E?128:64,b|=T<t?0:d<T?32:16,b|=S<t?0:d<S?8:4,g=+(b|=C<t?0:d<C?2:1),y=0,17!==b&&18!==b&&33!==b&&34!==b&&38!==b&&68!==b&&72!==b&&98!==b&&102!==b&&132!==b&&136!==b&&137!==b&&152!==b&&153!==b||(y=d<(v=(E+T+S+C)/4)?2:v<t?0:1,34===b?1===y?b=35:0===y&&(b=136):136===b?1===y?(b=35,y=4):0===y&&(b=34):17===b?1===y?(b=155,y=4):0===y&&(b=153):68===b?1===y?(b=103,y=4):0===y&&(b=102):153===b?1===y&&(b=155):102===b?1===y&&(b=103):152===b?y<2&&(b=156,y=1):137===b?y<2&&(b=139,y=1):98===b?y<2&&(b=99,y=1):38===b?y<2&&(b=39,y=1):18===b?0<y?(b=156,y=4):b=152:33===b?0<y?(b=139,y=4):b=137:72===b?0<y?(b=99,y=4):b=98:132===b&&(0<y?(b=39,y=4):b=38)),0!=b&&170!=b&&(r=i=o=a=s=u=l=c=.5,x=[],1===b?(o=1-eU(t,S,C),c=1-eU(t,E,C),x.push(jB[b])):169===b?(o=eU(d,C,S),c=eU(d,C,E),x.push(jB[b])):4===b?(u=1-eU(t,T,S),a=eU(t,C,S),x.push(YB[b])):166===b?(u=eU(d,S,T),a=1-eU(d,S,C),x.push(YB[b])):16===b?(s=eU(t,S,T),i=eU(t,E,T),x.push(WB[b])):154===b?(s=1-eU(d,T,S),i=1-eU(d,T,E),x.push(WB[b])):64===b?(l=eU(t,C,E),r=1-eU(t,T,E),x.push(QB[b])):106===b?(l=1-eU(d,E,C),r=eU(d,E,T),x.push(QB[b])):168===b?(a=eU(d,C,S),o=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),x.push(XB[b]),x.push(jB[b])):2===b?(a=1-eU(t,S,C),o=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),x.push(XB[b]),x.push(jB[b])):162===b?(s=eU(d,S,T),u=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),x.push(XB[b]),x.push(jB[b])):8===b?(s=1-eU(t,T,S),u=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),x.push(WB[b]),x.push(YB[b])):138===b?(s=1-eU(t,T,S),u=1-eU(d,T,S),r=1-eU(d,T,E),i=1-eU(t,T,E),x.push(WB[b]),x.push(YB[b])):32===b?(s=eU(d,S,T),u=eU(t,S,T),r=eU(t,E,T),i=eU(d,E,T),x.push(WB[b]),x.push(YB[b])):42===b?(c=1-eU(d,E,C),l=1-eU(t,E,C),r=eU(t,E,T),i=eU(d,E,T),x.push(KB[b]),x.push(QB[b])):128===b&&(c=eU(t,C,E),l=eU(d,C,E),r=1-eU(d,T,E),i=1-eU(t,T,E),x.push(KB[b]),x.push(QB[b])),5===b?(u=1-eU(t,T,S),c=1-eU(t,E,C),x.push(YB[b])):165===b?(u=eU(d,S,T),c=eU(d,C,E),x.push(YB[b])):20===b?(a=eU(t,C,S),i=eU(t,E,T),x.push(XB[b])):150===b?(a=1-eU(d,S,C),i=1-eU(d,T,E),x.push(XB[b])):80===b?(s=eU(t,S,T),l=eU(t,C,E),x.push(WB[b])):90===b?(s=1-eU(d,T,S),l=1-eU(d,E,C),x.push(WB[b])):65===b?(o=1-eU(t,S,C),r=1-eU(t,T,E),x.push(jB[b])):105===b?(o=eU(d,C,S),r=eU(d,E,T),x.push(jB[b])):160===b?(s=eU(d,S,T),u=eU(t,S,T),c=eU(t,C,E),l=eU(d,C,E),x.push(WB[b]),x.push(YB[b])):10===b?(s=1-eU(t,T,S),u=1-eU(d,T,S),c=1-eU(d,E,C),l=1-eU(t,E,C),x.push(WB[b]),x.push(YB[b])):130===b?(a=1-eU(t,S,C),o=1-eU(d,S,C),r=1-eU(d,T,E),i=1-eU(t,T,E),x.push(XB[b]),x.push(jB[b])):40===b?(a=eU(d,C,S),o=eU(t,C,S),r=eU(t,E,T),i=eU(d,E,T),x.push(XB[b]),x.push(jB[b])):101===b?(u=eU(d,S,T),r=eU(d,E,T),x.push(YB[b])):69===b?(u=1-eU(t,T,S),r=1-eU(t,T,E),x.push(YB[b])):149===b?(c=eU(d,C,E),i=1-eU(d,T,E),x.push(KB[b])):21===b?(c=1-eU(t,E,C),i=eU(t,E,T),x.push(KB[b])):86===b?(a=1-eU(d,S,C),l=1-eU(d,E,C),x.push(XB[b])):84===b?(a=eU(t,C,S),l=eU(t,C,E),x.push(XB[b])):89===b?(s=1-eU(d,T,S),o=eU(d,C,S),x.push(jB[b])):81===b?(s=eU(t,S,T),o=1-eU(t,S,C),x.push(jB[b])):96===b?(s=eU(d,S,T),u=eU(t,S,T),l=eU(t,C,E),r=eU(d,E,T),x.push(WB[b]),x.push(YB[b])):74===b?(s=1-eU(t,T,S),u=1-eU(d,T,S),l=1-eU(d,E,C),r=1-eU(t,T,E),x.push(WB[b]),x.push(YB[b])):24===b?(s=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),i=eU(t,E,T),x.push(WB[b]),x.push(jB[b])):146===b?(s=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),i=1-eU(d,T,E),x.push(WB[b]),x.push(jB[b])):6===b?(u=1-eU(t,T,S),a=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),x.push(YB[b]),x.push(XB[b])):164===b?(u=eU(d,S,T),a=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),x.push(YB[b]),x.push(XB[b])):129===b?(o=1-eU(t,S,C),c=eU(d,C,E),r=1-eU(d,T,E),i=1-eU(t,T,E),x.push(jB[b]),x.push(KB[b])):41===b?(o=eU(d,C,S),c=1-eU(t,E,C),r=eU(t,E,T),i=eU(d,E,T),x.push(jB[b]),x.push(KB[b])):66===b?(a=1-eU(t,S,C),o=1-eU(d,S,C),l=1-eU(d,E,C),r=1-eU(t,T,E),x.push(XB[b]),x.push(jB[b])):104===b?(a=eU(d,C,S),o=eU(t,C,S),l=eU(t,C,E),r=eU(d,E,T),x.push(jB[b]),x.push(ZB[b])):144===b?(s=eU(t,S,T),c=eU(t,C,E),l=eU(d,C,E),i=1-eU(d,T,E),x.push(WB[b]),x.push(QB[b])):26===b?(s=1-eU(d,T,S),c=1-eU(d,E,C),l=1-eU(t,E,C),i=eU(t,E,T),x.push(WB[b]),x.push(QB[b])):36===b?(u=eU(d,S,T),a=eU(t,C,S),r=eU(t,E,T),i=eU(d,E,T),x.push(YB[b]),x.push(XB[b])):134===b?(u=1-eU(t,T,S),a=1-eU(d,S,C),r=1-eU(d,T,E),i=1-eU(t,T,E),x.push(YB[b]),x.push(XB[b])):9===b?(s=1-eU(t,T,S),u=1-eU(d,T,S),o=eU(d,C,S),c=1-eU(t,E,C),x.push(WB[b]),x.push(YB[b])):161===b?(s=eU(d,S,T),u=eU(t,S,T),o=1-eU(t,S,C),c=eU(d,C,E),x.push(WB[b]),x.push(YB[b])):37===b?(u=eU(d,S,T),c=1-eU(t,E,C),r=eU(t,E,T),i=eU(d,E,T),x.push(YB[b]),x.push(KB[b])):133===b?(u=1-eU(t,T,S),c=eU(d,C,E),r=1-eU(d,T,E),i=1-eU(t,T,E),x.push(YB[b]),x.push(KB[b])):148===b?(a=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),i=1-eU(d,T,E),x.push(XB[b]),x.push(QB[b])):22===b?(a=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),i=eU(t,E,T),x.push(XB[b]),x.push(QB[b])):82===b?(s=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),l=1-eU(d,E,C),x.push(WB[b]),x.push(jB[b])):88===b?(s=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),l=eU(t,C,E),x.push(WB[b]),x.push(jB[b])):73===b?(s=1-eU(t,T,S),u=1-eU(d,T,S),o=eU(d,C,S),r=1-eU(t,T,E),x.push(WB[b]),x.push(YB[b])):97===b?(s=eU(d,S,T),u=eU(t,S,T),o=1-eU(t,S,C),r=eU(d,E,T),x.push(WB[b]),x.push(YB[b])):145===b?(s=eU(t,S,T),o=1-eU(t,S,C),c=eU(d,C,E),i=1-eU(d,T,E),x.push(WB[b]),x.push(KB[b])):25===b?(s=1-eU(d,T,S),o=eU(d,C,S),c=1-eU(t,E,C),i=eU(t,E,T),x.push(WB[b]),x.push(KB[b])):70===b?(u=1-eU(t,T,S),a=1-eU(d,S,C),l=1-eU(d,E,C),r=1-eU(t,T,E),x.push(YB[b]),x.push(XB[b])):100===b?(u=eU(d,S,T),a=eU(t,C,S),l=eU(t,C,E),r=eU(d,E,T),x.push(YB[b]),x.push(XB[b])):34===b?(i=0===y?(s=1-eU(t,T,S),u=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),r=1-eU(d,T,E),1-eU(t,T,E)):(s=eU(d,S,T),u=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),r=eU(t,E,T),eU(d,E,T)),x.push(WB[b]),x.push(YB[b]),x.push(KB[b]),x.push(QB[b])):35===b?(i=4===y?(s=1-eU(t,T,S),u=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),r=1-eU(d,T,E),1-eU(t,T,E)):(s=eU(d,S,T),u=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),r=eU(t,E,T),eU(d,E,T)),x.push(WB[b]),x.push(YB[b]),x.push(jB[b]),x.push(QB[b])):136===b?(i=0===y?(s=eU(d,S,T),u=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),r=eU(t,E,T),eU(d,E,T)):(s=1-eU(t,T,S),u=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),r=1-eU(d,T,E),1-eU(t,T,E)),x.push(WB[b]),x.push(YB[b]),x.push(KB[b]),x.push(QB[b])):153===b?(i=0===y?(s=eU(t,S,T),o=1-eU(t,S,C),c=1-eU(t,E,C),eU(t,E,T)):(s=1-eU(d,T,S),o=eU(d,C,S),c=eU(d,C,E),1-eU(d,T,E)),x.push(WB[b]),x.push(jB[b])):102===b?(r=0===y?(u=1-eU(t,T,S),a=eU(t,C,S),l=eU(t,C,E),1-eU(t,T,E)):(u=eU(d,S,T),a=1-eU(d,S,C),l=1-eU(d,E,C),eU(d,E,T)),x.push(YB[b]),x.push(QB[b])):155===b?(i=4===y?(s=eU(t,S,T),o=1-eU(t,S,C),c=1-eU(t,E,C),eU(t,E,T)):(s=1-eU(d,T,S),o=eU(d,C,S),c=eU(d,C,E),1-eU(d,T,E)),x.push(WB[b]),x.push(KB[b])):103===b?(r=4===y?(u=1-eU(t,T,S),a=eU(t,C,S),l=eU(t,C,E),1-eU(t,T,E)):(u=eU(d,S,T),a=1-eU(d,S,C),l=1-eU(d,E,C),eU(d,E,T)),x.push(YB[b]),x.push(XB[b])):152===b?(i=0===y?(s=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),eU(t,E,T)):(s=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),1-eU(d,T,E)),x.push(WB[b]),x.push(XB[b]),x.push(jB[b])):156===b?(i=4===y?(s=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),eU(t,E,T)):(s=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),1-eU(d,T,E)),x.push(WB[b]),x.push(jB[b]),x.push(QB[b])):137===b?(i=0===y?(s=eU(d,S,T),u=eU(t,S,T),o=1-eU(t,S,C),c=1-eU(t,E,C),r=eU(t,E,T),eU(d,E,T)):(s=1-eU(t,T,S),u=1-eU(d,T,S),o=eU(d,C,S),c=eU(d,C,E),r=1-eU(d,T,E),1-eU(t,T,E)),x.push(WB[b]),x.push(YB[b]),x.push(jB[b])):139===b?(i=4===y?(s=eU(d,S,T),u=eU(t,S,T),o=1-eU(t,S,C),c=1-eU(t,E,C),r=eU(t,E,T),eU(d,E,T)):(s=1-eU(t,T,S),u=1-eU(d,T,S),o=eU(d,C,S),c=eU(d,C,E),r=1-eU(d,T,E),1-eU(t,T,E)),x.push(WB[b]),x.push(YB[b]),x.push(KB[b])):98===b?(r=0===y?(s=1-eU(t,T,S),u=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),l=eU(t,C,E),1-eU(t,T,E)):(s=eU(d,S,T),u=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),l=1-eU(d,E,C),eU(d,E,T)),x.push(WB[b]),x.push(YB[b]),x.push(QB[b])):99===b?(r=4===y?(s=1-eU(t,T,S),u=1-eU(d,T,S),a=eU(d,C,S),o=eU(t,C,S),l=eU(t,C,E),1-eU(t,T,E)):(s=eU(d,S,T),u=eU(t,S,T),a=1-eU(t,S,C),o=1-eU(d,S,C),l=1-eU(d,E,C),eU(d,E,T)),x.push(WB[b]),x.push(YB[b]),x.push(jB[b])):38===b?(i=0===y?(u=1-eU(t,T,S),a=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),r=1-eU(d,T,E),1-eU(t,T,E)):(u=eU(d,S,T),a=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),r=eU(t,E,T),eU(d,E,T)),x.push(YB[b]),x.push(KB[b]),x.push(QB[b])):39===b?(i=4===y?(u=1-eU(t,T,S),a=eU(t,C,S),c=eU(t,C,E),l=eU(d,C,E),r=1-eU(d,T,E),1-eU(t,T,E)):(u=eU(d,S,T),a=1-eU(d,S,C),c=1-eU(d,E,C),l=1-eU(t,E,C),r=eU(t,E,T),eU(d,E,T)),x.push(YB[b]),x.push(XB[b]),x.push(QB[b])):85===b&&(r=c=o=u=0,i=l=a=s=1),(r<0||1<r||i<0||1<i||s<0||1<s||a<0||1<a||c<0||1<c||l<0||1<l)&&console.log("MarchingSquaresJS-isoBands: "+b+" "+g+" "+E+","+T+","+S+","+C+" "+y+" "+r+" "+i+" "+s+" "+u+" "+a+" "+o+" "+c+" "+l),p.cells[m][_]={cval:b,cval_real:g,flipped:y,topleft:r,topright:i,righttop:s,rightbottom:u,bottomright:a,bottomleft:o,leftbottom:c,lefttop:l,edges:x}))}}return p}(e,t,n),h=sB.polygons?(sB.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),u=[],l=0,c.cells.forEach(function(e,r){e.forEach(function(e,t){var n;void 0!==e&&("object"==typeof(n=$B[e.cval](e))&&tU(n)?"object"==typeof n[0]&&tU(n[0])?"object"==typeof n[0][0]&&tU(n[0][0])?n.forEach(function(e){e.forEach(function(e){e[0]+=t,e[1]+=r}),u[l++]=e}):(n.forEach(function(e){e[0]+=t,e[1]+=r}),u[l++]=n):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates"))})}),u):(sB.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),function(e){for(var t=[],n=e.rows,r=e.cols,i=[],o=0;o<n;o++)for(var a=0;a<r;a++)if(void 0!==e.cells[o][a]&&0<e.cells[o][a].edges.length){var s=rU(e.cells[o][a]),u=null,l=a,c=o;null!==s&&i.push([s.p[0]+l,s.p[1]+c]);do{if(null===(u=iU(e.cells[c][l],s.x,s.y,s.o)))break;if(i.push([u.p[0]+l,u.p[1]+c]),l+=u.x,c+=u.y,s=u,c<0||n<=c||l<0||r<=l||void 0===e.cells[c][l]){l-=u.x,c-=u.y;var h=nU(e,l,c,u.x,u.y,u.o);if(null===h)break;h.path.forEach(function(e){i.push(e)}),l=h.i,c=h.j,s=h}}while(void 0!==e.cells[c][l]&&0<e.cells[c][l].edges.length);t.push(i),i=[],0<e.cells[o][a].edges.length&&a--}return t}(c));return"function"==typeof sB.successCallback&&sB.successCallback(h),h}var lB=64,cB=16,hB=4,fB=1,pB=[],dB=[],mB=[],_B=[],gB=[],yB=[],vB=[],xB=[],bB=[],EB=[],TB=[],SB=[],CB=[],wB=[],AB=[],IB=[],PB=[],OB=[],LB=[],NB=[],RB=[],DB=[],MB=[],FB=[];vB[85]=EB[85]=-1,xB[85]=TB[85]=0,bB[85]=SB[85]=1,LB[85]=DB[85]=1,NB[85]=MB[85]=0,RB[85]=FB[85]=1,pB[85]=_B[85]=0,dB[85]=gB[85]=-1,mB[85]=AB[85]=0,IB[85]=CB[85]=0,PB[85]=wB[85]=1,yB[85]=OB[85]=1,DB[1]=DB[169]=0,MB[1]=MB[169]=-1,FB[1]=FB[169]=0,CB[1]=CB[169]=-1,wB[1]=wB[169]=0,AB[1]=AB[169]=0,EB[4]=EB[166]=0,TB[4]=TB[166]=-1,SB[4]=SB[166]=1,IB[4]=IB[166]=1,PB[4]=PB[166]=0,OB[4]=OB[166]=0,vB[16]=vB[154]=0,xB[16]=xB[154]=1,bB[16]=bB[154]=1,_B[16]=_B[154]=1,gB[16]=gB[154]=0,yB[16]=yB[154]=1,LB[64]=LB[106]=0,NB[64]=NB[106]=1,RB[64]=RB[106]=0,pB[64]=pB[106]=-1,dB[64]=dB[106]=0,mB[64]=mB[106]=1,LB[2]=LB[168]=0,NB[2]=NB[168]=-1,RB[2]=RB[168]=1,DB[2]=DB[168]=0,MB[2]=MB[168]=-1,FB[2]=FB[168]=0,CB[2]=CB[168]=-1,wB[2]=wB[168]=0,AB[2]=AB[168]=0,IB[2]=IB[168]=-1,PB[2]=PB[168]=0,OB[2]=OB[168]=1,vB[8]=vB[162]=0,xB[8]=xB[162]=-1,bB[8]=bB[162]=0,EB[8]=EB[162]=0,TB[8]=TB[162]=-1,SB[8]=SB[162]=1,CB[8]=CB[162]=1,wB[8]=wB[162]=0,AB[8]=AB[162]=1,IB[8]=IB[162]=1,PB[8]=PB[162]=0,OB[8]=OB[162]=0,vB[32]=vB[138]=0,xB[32]=xB[138]=1,bB[32]=bB[138]=1,EB[32]=EB[138]=0,TB[32]=TB[138]=1,SB[32]=SB[138]=0,pB[32]=pB[138]=1,dB[32]=dB[138]=0,mB[32]=mB[138]=0,_B[32]=_B[138]=1,gB[32]=gB[138]=0,yB[32]=yB[138]=1,DB[128]=DB[42]=0,MB[128]=MB[42]=1,FB[128]=FB[42]=1,LB[128]=LB[42]=0,NB[128]=NB[42]=1,RB[128]=RB[42]=0,pB[128]=pB[42]=-1,dB[128]=dB[42]=0,mB[128]=mB[42]=1,_B[128]=_B[42]=-1,gB[128]=gB[42]=0,yB[128]=yB[42]=0,EB[5]=EB[165]=-1,TB[5]=TB[165]=0,SB[5]=SB[165]=0,DB[5]=DB[165]=1,MB[5]=MB[165]=0,FB[5]=FB[165]=0,IB[20]=IB[150]=0,PB[20]=PB[150]=1,OB[20]=OB[150]=1,_B[20]=_B[150]=0,gB[20]=gB[150]=-1,yB[20]=yB[150]=1,vB[80]=vB[90]=-1,xB[80]=xB[90]=0,bB[80]=bB[90]=1,LB[80]=LB[90]=1,NB[80]=NB[90]=0,RB[80]=RB[90]=1,CB[65]=CB[105]=0,wB[65]=wB[105]=1,AB[65]=AB[105]=0,pB[65]=pB[105]=0,dB[65]=dB[105]=-1,mB[65]=mB[105]=0,vB[160]=vB[10]=-1,xB[160]=xB[10]=0,bB[160]=bB[10]=1,EB[160]=EB[10]=-1,TB[160]=TB[10]=0,SB[160]=SB[10]=0,DB[160]=DB[10]=1,MB[160]=MB[10]=0,FB[160]=FB[10]=0,LB[160]=LB[10]=1,NB[160]=NB[10]=0,RB[160]=RB[10]=1,IB[130]=IB[40]=0,PB[130]=PB[40]=1,OB[130]=OB[40]=1,CB[130]=CB[40]=0,wB[130]=wB[40]=1,AB[130]=AB[40]=0,pB[130]=pB[40]=0,dB[130]=dB[40]=-1,mB[130]=mB[40]=0,_B[130]=_B[40]=0,gB[130]=gB[40]=-1,yB[130]=yB[40]=1,EB[37]=EB[133]=0,TB[37]=TB[133]=1,SB[37]=SB[133]=1,DB[37]=DB[133]=0,MB[37]=MB[133]=1,FB[37]=FB[133]=0,pB[37]=pB[133]=-1,dB[37]=dB[133]=0,mB[37]=mB[133]=0,_B[37]=_B[133]=1,gB[37]=gB[133]=0,yB[37]=yB[133]=0,IB[148]=IB[22]=-1,PB[148]=PB[22]=0,OB[148]=OB[22]=0,DB[148]=DB[22]=0,MB[148]=MB[22]=-1,FB[148]=FB[22]=1,LB[148]=LB[22]=0,NB[148]=NB[22]=1,RB[148]=RB[22]=1,_B[148]=_B[22]=-1,gB[148]=gB[22]=0,yB[148]=yB[22]=1,vB[82]=vB[88]=0,xB[82]=xB[88]=-1,bB[82]=bB[88]=1,IB[82]=IB[88]=1,PB[82]=PB[88]=0,OB[82]=OB[88]=1,CB[82]=CB[88]=-1,wB[82]=wB[88]=0,AB[82]=AB[88]=1,LB[82]=LB[88]=0,NB[82]=NB[88]=-1,RB[82]=RB[88]=0,vB[73]=vB[97]=0,xB[73]=xB[97]=1,bB[73]=bB[97]=0,EB[73]=EB[97]=0,TB[73]=TB[97]=-1,SB[73]=SB[97]=0,CB[73]=CB[97]=1,wB[73]=wB[97]=0,AB[73]=AB[97]=0,pB[73]=pB[97]=1,dB[73]=dB[97]=0,mB[73]=mB[97]=1,vB[145]=vB[25]=0,xB[145]=xB[25]=-1,bB[145]=bB[25]=0,CB[145]=CB[25]=1,wB[145]=wB[25]=0,AB[145]=AB[25]=1,DB[145]=DB[25]=0,MB[145]=MB[25]=1,FB[145]=FB[25]=1,_B[145]=_B[25]=-1,gB[145]=gB[25]=0,yB[145]=yB[25]=0,EB[70]=EB[100]=0,TB[70]=TB[100]=1,SB[70]=SB[100]=0,IB[70]=IB[100]=-1,PB[70]=PB[100]=0,OB[70]=OB[100]=1,LB[70]=LB[100]=0,NB[70]=NB[100]=-1,RB[70]=RB[100]=1,pB[70]=pB[100]=1,dB[70]=dB[100]=0,mB[70]=mB[100]=0,EB[101]=EB[69]=0,TB[101]=TB[69]=1,SB[101]=SB[69]=0,pB[101]=pB[69]=1,dB[101]=dB[69]=0,mB[101]=mB[69]=0,DB[149]=DB[21]=0,MB[149]=MB[21]=1,FB[149]=FB[21]=1,_B[149]=_B[21]=-1,gB[149]=gB[21]=0,yB[149]=yB[21]=0,IB[86]=IB[84]=-1,PB[86]=PB[84]=0,OB[86]=OB[84]=1,LB[86]=LB[84]=0,NB[86]=NB[84]=-1,RB[86]=RB[84]=1,vB[89]=vB[81]=0,xB[89]=xB[81]=-1,bB[89]=bB[81]=0,CB[89]=CB[81]=1,wB[89]=wB[81]=0,AB[89]=AB[81]=1,vB[96]=vB[74]=0,xB[96]=xB[74]=1,bB[96]=bB[74]=0,EB[96]=EB[74]=-1,TB[96]=TB[74]=0,SB[96]=SB[74]=1,LB[96]=LB[74]=1,NB[96]=NB[74]=0,RB[96]=RB[74]=0,pB[96]=pB[74]=1,dB[96]=dB[74]=0,mB[96]=mB[74]=1,vB[24]=vB[146]=0,xB[24]=xB[146]=-1,bB[24]=bB[146]=1,IB[24]=IB[146]=1,PB[24]=PB[146]=0,OB[24]=OB[146]=1,CB[24]=CB[146]=0,wB[24]=wB[146]=1,AB[24]=AB[146]=1,_B[24]=_B[146]=0,gB[24]=gB[146]=-1,yB[24]=yB[146]=0,EB[6]=EB[164]=-1,TB[6]=TB[164]=0,SB[6]=SB[164]=1,IB[6]=IB[164]=-1,PB[6]=PB[164]=0,OB[6]=OB[164]=0,DB[6]=DB[164]=0,MB[6]=MB[164]=-1,FB[6]=FB[164]=1,LB[6]=LB[164]=1,NB[6]=NB[164]=0,RB[6]=RB[164]=0,CB[129]=CB[41]=0,wB[129]=wB[41]=1,AB[129]=AB[41]=1,DB[129]=DB[41]=0,MB[129]=MB[41]=1,FB[129]=FB[41]=0,pB[129]=pB[41]=-1,dB[129]=dB[41]=0,mB[129]=mB[41]=0,_B[129]=_B[41]=0,gB[129]=gB[41]=-1,yB[129]=yB[41]=0,IB[66]=IB[104]=0,PB[66]=PB[104]=1,OB[66]=OB[104]=0,CB[66]=CB[104]=-1,wB[66]=wB[104]=0,AB[66]=AB[104]=1,LB[66]=LB[104]=0,NB[66]=NB[104]=-1,RB[66]=RB[104]=0,pB[66]=pB[104]=0,dB[66]=dB[104]=-1,mB[66]=mB[104]=1,vB[144]=vB[26]=-1,xB[144]=xB[26]=0,bB[144]=bB[26]=0,DB[144]=DB[26]=1,MB[144]=MB[26]=0,FB[144]=FB[26]=1,LB[144]=LB[26]=0,NB[144]=NB[26]=1,RB[144]=RB[26]=1,_B[144]=_B[26]=-1,gB[144]=gB[26]=0,yB[144]=yB[26]=1,EB[36]=EB[134]=0,TB[36]=TB[134]=1,SB[36]=SB[134]=1,IB[36]=IB[134]=0,PB[36]=PB[134]=1,OB[36]=OB[134]=0,pB[36]=pB[134]=0,dB[36]=dB[134]=-1,mB[36]=mB[134]=1,_B[36]=_B[134]=1,gB[36]=gB[134]=0,yB[36]=yB[134]=0,vB[9]=vB[161]=-1,xB[9]=xB[161]=0,bB[9]=bB[161]=0,EB[9]=EB[161]=0,TB[9]=TB[161]=-1,SB[9]=SB[161]=0,CB[9]=CB[161]=1,wB[9]=wB[161]=0,AB[9]=AB[161]=0,DB[9]=DB[161]=1,MB[9]=MB[161]=0,FB[9]=FB[161]=1,vB[136]=0,xB[136]=1,bB[136]=1,EB[136]=0,TB[136]=1,SB[136]=0,IB[136]=-1,PB[136]=0,OB[136]=1,CB[136]=-1,wB[136]=0,AB[136]=0,DB[136]=0,MB[136]=-1,FB[136]=0,LB[136]=0,NB[136]=-1,RB[136]=1,pB[136]=1,dB[136]=0,mB[136]=0,_B[136]=1,gB[136]=0,yB[136]=1,vB[34]=0,xB[34]=-1,bB[34]=0,EB[34]=0,TB[34]=-1,SB[34]=1,IB[34]=1,PB[34]=0,OB[34]=0,CB[34]=1,wB[34]=0,AB[34]=1,DB[34]=0,MB[34]=1,FB[34]=1,LB[34]=0,NB[34]=1,RB[34]=0,pB[34]=-1,dB[34]=0,mB[34]=1,_B[34]=-1,gB[34]=0,yB[34]=0,vB[35]=0,xB[35]=1,bB[35]=1,EB[35]=0,TB[35]=-1,SB[35]=1,IB[35]=1,PB[35]=0,OB[35]=0,CB[35]=-1,wB[35]=0,AB[35]=0,DB[35]=0,MB[35]=-1,FB[35]=0,LB[35]=0,NB[35]=1,RB[35]=0,pB[35]=-1,dB[35]=0,mB[35]=1,_B[35]=1,gB[35]=0,yB[35]=1,vB[153]=0,xB[153]=1,bB[153]=1,CB[153]=-1,wB[153]=0,AB[153]=0,DB[153]=0,MB[153]=-1,FB[153]=0,_B[153]=1,gB[153]=0,yB[153]=1,EB[102]=0,TB[102]=-1,SB[102]=1,IB[102]=1,PB[102]=0,OB[102]=0,LB[102]=0,NB[102]=1,RB[102]=0,pB[102]=-1,dB[102]=0,mB[102]=1,vB[155]=0,xB[155]=-1,bB[155]=0,CB[155]=1,wB[155]=0,AB[155]=1,DB[155]=0,MB[155]=1,FB[155]=1,_B[155]=-1,gB[155]=0,yB[155]=0,EB[103]=0,TB[103]=1,SB[103]=0,IB[103]=-1,PB[103]=0,OB[103]=1,LB[103]=0,NB[103]=-1,RB[103]=1,pB[103]=1,dB[103]=0,mB[103]=0,vB[152]=0,xB[152]=1,bB[152]=1,IB[152]=-1,PB[152]=0,OB[152]=1,CB[152]=-1,wB[152]=0,AB[152]=0,DB[152]=0,MB[152]=-1,FB[152]=0,LB[152]=0,NB[152]=-1,RB[152]=1,_B[152]=1,gB[152]=0,yB[152]=1,vB[156]=0,xB[156]=-1,bB[156]=1,IB[156]=1,PB[156]=0,OB[156]=1,CB[156]=-1,wB[156]=0,AB[156]=0,DB[156]=0,MB[156]=-1,FB[156]=0,LB[156]=0,NB[156]=1,RB[156]=1,_B[156]=-1,gB[156]=0,yB[156]=1,vB[137]=0,xB[137]=1,bB[137]=1,EB[137]=0,TB[137]=1,SB[137]=0,CB[137]=-1,wB[137]=0,AB[137]=0,DB[137]=0,MB[137]=-1,FB[137]=0,pB[137]=1,dB[137]=0,mB[137]=0,_B[137]=1,gB[137]=0,yB[137]=1,vB[139]=0,xB[139]=1,bB[139]=1,EB[139]=0,TB[139]=-1,SB[139]=0,CB[139]=1,wB[139]=0,AB[139]=0,DB[139]=0,MB[139]=1,FB[139]=0,pB[139]=-1,dB[139]=0,mB[139]=0,_B[139]=1,gB[139]=0,yB[139]=1,vB[98]=0,xB[98]=-1,bB[98]=0,EB[98]=0,TB[98]=-1,SB[98]=1,IB[98]=1,PB[98]=0,OB[98]=0,CB[98]=1,wB[98]=0,AB[98]=1,LB[98]=0,NB[98]=1,RB[98]=0,pB[98]=-1,dB[98]=0,mB[98]=1,vB[99]=0,xB[99]=1,bB[99]=0,EB[99]=0,TB[99]=-1,SB[99]=1,IB[99]=1,PB[99]=0,OB[99]=0,CB[99]=-1,wB[99]=0,AB[99]=1,LB[99]=0,NB[99]=-1,RB[99]=0,pB[99]=1,dB[99]=0,mB[99]=1,EB[38]=0,TB[38]=-1,SB[38]=1,IB[38]=1,PB[38]=0,OB[38]=0,DB[38]=0,MB[38]=1,FB[38]=1,LB[38]=0,NB[38]=1,RB[38]=0,pB[38]=-1,dB[38]=0,mB[38]=1,_B[38]=-1,gB[38]=0,yB[38]=0,EB[39]=0,TB[39]=1,SB[39]=1,IB[39]=-1,PB[39]=0,OB[39]=0,DB[39]=0,MB[39]=-1,FB[39]=1,LB[39]=0,NB[39]=1,RB[39]=0,pB[39]=-1,dB[39]=0,mB[39]=1,_B[39]=1,gB[39]=0,yB[39]=0;function zB(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]}function BB(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]}function UB(e){return[[e.topright,1],[1,1],[1,e.righttop]]}function VB(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]}function kB(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]}function GB(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]}function qB(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]}function HB(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]}var WB=[],YB=[],XB=[],jB=[],KB=[],QB=[],ZB=[],JB=[];jB[1]=KB[1]=18,jB[169]=KB[169]=18,XB[4]=YB[4]=12,XB[166]=YB[166]=12,WB[16]=JB[16]=4,WB[154]=JB[154]=4,QB[64]=ZB[64]=22,QB[106]=ZB[106]=22,XB[2]=QB[2]=17,jB[2]=KB[2]=18,XB[168]=QB[168]=17,jB[168]=KB[168]=18,WB[8]=jB[8]=9,YB[8]=XB[8]=12,WB[162]=jB[162]=9,YB[162]=XB[162]=12,WB[32]=JB[32]=4,YB[32]=ZB[32]=1,WB[138]=JB[138]=4,YB[138]=ZB[138]=1,KB[128]=JB[128]=21,QB[128]=ZB[128]=22,KB[42]=JB[42]=21,QB[42]=ZB[42]=22,YB[5]=KB[5]=14,YB[165]=KB[165]=14,XB[20]=JB[20]=6,XB[150]=JB[150]=6,WB[80]=QB[80]=11,WB[90]=QB[90]=11,jB[65]=ZB[65]=3,jB[105]=ZB[105]=3,WB[160]=QB[160]=11,YB[160]=KB[160]=14,WB[10]=QB[10]=11,YB[10]=KB[10]=14,XB[130]=JB[130]=6,jB[130]=ZB[130]=3,XB[40]=JB[40]=6,jB[40]=ZB[40]=3,YB[101]=ZB[101]=1,YB[69]=ZB[69]=1,KB[149]=JB[149]=21,KB[21]=JB[21]=21,XB[86]=QB[86]=17,XB[84]=QB[84]=17,WB[89]=jB[89]=9,WB[81]=jB[81]=9,WB[96]=ZB[96]=0,YB[96]=QB[96]=15,WB[74]=ZB[74]=0,YB[74]=QB[74]=15,WB[24]=XB[24]=8,jB[24]=JB[24]=7,WB[146]=XB[146]=8,jB[146]=JB[146]=7,YB[6]=QB[6]=15,XB[6]=KB[6]=16,YB[164]=QB[164]=15,XB[164]=KB[164]=16,jB[129]=JB[129]=7,KB[129]=ZB[129]=20,jB[41]=JB[41]=7,KB[41]=ZB[41]=20,XB[66]=ZB[66]=2,jB[66]=QB[66]=19,XB[104]=ZB[104]=2,jB[104]=QB[104]=19,WB[144]=KB[144]=10,QB[144]=JB[144]=23,WB[26]=KB[26]=10,QB[26]=JB[26]=23,YB[36]=JB[36]=5,XB[36]=ZB[36]=2,YB[134]=JB[134]=5,XB[134]=ZB[134]=2,WB[9]=KB[9]=10,YB[9]=jB[9]=13,WB[161]=KB[161]=10,YB[161]=jB[161]=13,YB[37]=JB[37]=5,KB[37]=ZB[37]=20,YB[133]=JB[133]=5,KB[133]=ZB[133]=20,XB[148]=KB[148]=16,QB[148]=JB[148]=23,XB[22]=KB[22]=16,QB[22]=JB[22]=23,WB[82]=XB[82]=8,jB[82]=QB[82]=19,WB[88]=XB[88]=8,jB[88]=QB[88]=19,WB[73]=ZB[73]=0,YB[73]=jB[73]=13,WB[97]=ZB[97]=0,YB[97]=jB[97]=13,WB[145]=jB[145]=9,KB[145]=JB[145]=21,WB[25]=jB[25]=9,KB[25]=JB[25]=21,YB[70]=ZB[70]=1,XB[70]=QB[70]=17,YB[100]=ZB[100]=1,XB[100]=QB[100]=17,WB[34]=jB[34]=9,YB[34]=XB[34]=12,KB[34]=JB[34]=21,QB[34]=ZB[34]=22,WB[136]=JB[136]=4,YB[136]=ZB[136]=1,XB[136]=QB[136]=17,jB[136]=KB[136]=18,WB[35]=JB[35]=4,YB[35]=XB[35]=12,jB[35]=KB[35]=18,QB[35]=ZB[35]=22,WB[153]=JB[153]=4,jB[153]=KB[153]=18,YB[102]=XB[102]=12,QB[102]=ZB[102]=22,WB[155]=jB[155]=9,KB[155]=JB[155]=23,YB[103]=ZB[103]=1,XB[103]=QB[103]=17,WB[152]=JB[152]=4,XB[152]=QB[152]=17,jB[152]=KB[152]=18,WB[156]=XB[156]=8,jB[156]=KB[156]=18,QB[156]=JB[156]=23,WB[137]=JB[137]=4,YB[137]=ZB[137]=1,jB[137]=KB[137]=18,WB[139]=JB[139]=4,YB[139]=jB[139]=13,KB[139]=ZB[139]=20,WB[98]=jB[98]=9,YB[98]=XB[98]=12,QB[98]=ZB[98]=22,WB[99]=ZB[99]=0,YB[99]=XB[99]=12,jB[99]=QB[99]=19,YB[38]=XB[38]=12,KB[38]=JB[38]=21,QB[38]=ZB[38]=22,YB[39]=JB[39]=5,XB[39]=KB[39]=16,QB[39]=ZB[39]=22;var $B=[];function eU(e,t,n){return(e-t)/(n-t)}function tU(e){return-1<e.constructor.toString().indexOf("Array")}function nU(e,t,n,r,i,o){for(var a=e.cells[n][t],s=a.cval_real,u=t+r,l=n+i,c=[],h=!1;!h;){if(void 0===e.cells[l]||void 0===e.cells[l][u])if(l-=i,u-=r,s=(a=e.cells[l][u]).cval_real,-1===i)if(0===o)if(s&fB)c.push([u,l]),r=-1,o=i=0;else{if(!(s&hB)){c.push([u+a.bottomright,l]),o=i=1,h=!(r=0);break}c.push([u+1,l]),r=1,o=i=0}else{if(!(s&fB)){if(s&hB){c.push([u+a.bottomright,l]),o=i=1,h=!(r=0);break}c.push([u+a.bottomleft,l]),i=1,h=!(o=r=0);break}c.push([u,l]),r=-1,o=i=0}else if(1===i)if(0===o){if(!(s&cB)){if(s&lB){c.push([u+a.topleft,l+1]),i=-1,h=!(o=r=0);break}c.push([u+a.topright,l+1]),i=-1,o=1,h=!(r=0);break}c.push([u+1,l+1]),i=0,o=r=1}else o=r=(c.push([u+1,l+1]),i=0,1);else if(-1===r)if(0===o){if(!(s&lB)){if(s&fB){c.push([u,l+a.leftbottom]),r=1,h=!(o=i=0);break}c.push([u,l+a.lefttop]),o=r=1,h=!(i=0);break}c.push([u,l+1]),i=1,o=r=0}else{if(!(s&lB)){console.log("MarchingSquaresJS-isoBands: wtf");break}c.push([u,l+1]),i=1,o=r=0}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(s&hB)){c.push([u+1,l+a.rightbottom]),r=-1,h=!(o=i=0);break}c.push([u+1,l]),r=0,i=-1,o=1}else{if(!(s&hB)){if(s&cB){c.push([u+1,l+a.righttop]),r=-1,i=0,o=1;break}c.push([u+1,l+a.rightbottom]),r=-1,h=!(o=i=0);break}c.push([u+1,l]),r=0,i=-1,o=1}}else if(s=(a=e.cells[l][u]).cval_real,-1===r)if(0===o)if(void 0!==e.cells[l-1]&&void 0!==e.cells[l-1][u])r=0,i=-1,o=1;else{if(!(s&fB)){c.push([u+a.bottomright,l]),o=i=1,h=!(r=0);break}c.push([u,l])}else{if(!(s&lB)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+u+","+l);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===r){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==e.cells[l+1]&&void 0!==e.cells[l+1][u])i=1,o=r=0;else{if(!(s&cB)){c.push([u+a.topleft,l+1]),i=-1,h=!(o=r=0);break}c.push([u+1,l+1]),i=0,o=r=1}}else if(-1===i){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==e.cells[l][u+1])i=0,o=r=1;else{if(!(s&hB)){c.push([u+1,l+a.righttop]),r=-1,o=1,h=!(i=0);break}c.push([u+1,l]),r=0,i=-1,o=1}}else{if(1!==i){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==e.cells[l][u-1])r=-1,o=i=0;else{if(!(s&lB)){c.push([u,l+a.leftbottom]),r=1,h=!(o=i=0);break}c.push([u,l+1]),i=1,o=r=0}}if(l+=i,(u+=r)===t&&l===n)break}return{path:c,i:u,j:l,x:r,y:i,o:o}}function rU(e){if(0<e.edges.length){var t=e.edges[e.edges.length-1],n=e.cval_real;switch(t){case 0:return n&cB?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.topleft,1],x:0,y:-1,o:0};case 1:return n&hB?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 2:return n&hB?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[e.topleft,1],x:0,y:-1,o:0};case 3:return n&fB?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 4:return n&cB?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};case 5:return n&hB?{p:[e.topright,1],x:0,y:-1,o:1}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 6:return n&hB?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};case 7:return n&fB?{p:[e.topright,1],x:0,y:-1,o:1}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 8:return n&hB?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[1,e.righttop],x:-1,y:0,o:1};case 9:return n&fB?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 10:return n&fB?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[1,e.righttop],x:-1,y:0,o:1};case 11:return n&lB?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[0,e.lefttop],x:1,y:0,o:1};case 12:return n&hB?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 13:return n&fB?{p:[1,e.rightbottom],x:-1,y:0,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 14:return n&fB?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 15:return n&lB?{p:[1,e.rightbottom],x:-1,y:0,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 16:return n&hB?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[0,e.leftbottom],x:1,y:0,o:0};case 17:return n&lB?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[0,e.lefttop],x:1,y:0,o:1};case 18:return n&fB?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 19:return n&lB?{p:[e.bottomleft,0],x:0,y:1,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 20:return n&lB?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[0,e.leftbottom],x:1,y:0,o:0};case 21:return n&cB?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[e.topright,1],x:0,y:-1,o:1};case 22:return n&lB?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 23:return n&cB?{p:[0,e.lefttop],x:1,y:0,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(e)}}return null}function iU(e,t,n,r){var i,o,a,s,u,l=e.cval;switch(t){case-1:switch(r){case 0:i=YB[l],a=EB[l],s=TB[l],u=SB[l];break;default:i=WB[l],a=vB[l],s=xB[l],u=bB[l]}break;case 1:switch(r){case 0:i=KB[l],a=DB[l],s=MB[l],u=FB[l];break;default:i=QB[l],a=LB[l],s=NB[l],u=RB[l]}break;default:switch(n){case-1:switch(r){case 0:i=ZB[l],a=pB[l],s=dB[l],u=mB[l];break;default:i=JB[l],a=_B[l],s=gB[l],u=yB[l]}break;case 1:switch(r){case 0:i=jB[l],a=CB[l],s=wB[l],u=AB[l];break;default:i=XB[l],a=IB[l],s=PB[l],u=OB[l]}}}if(o=e.edges.indexOf(i),void 0===e.edges[o])return null;switch(!function(e,t){delete e.edges[t];for(var n=t+1;n<e.edges.length;n++)e.edges[n-1]=e.edges[n];e.edges.pop()}(e,o),l=e.cval_real,i){case 0:n=l&cB?(t=e.topleft,1):(t=1,e.righttop);break;case 1:n=l&hB?(t=1,e.rightbottom):(t=e.topleft,1);break;case 2:n=l&hB?(t=e.topleft,1):(t=e.bottomright,0);break;case 3:n=l&fB?(t=e.bottomleft,0):(t=e.topleft,1);break;case 4:n=l&cB?(t=e.topright,1):(t=1,e.righttop);break;case 5:n=l&hB?(t=1,e.rightbottom):(t=e.topright,1);break;case 6:n=l&hB?(t=e.topright,1):(t=e.bottomright,0);break;case 7:n=l&fB?(t=e.bottomleft,0):(t=e.topright,1);break;case 8:n=l&hB?(t=1,e.righttop):(t=e.bottomright,0);break;case 9:n=l&fB?(t=e.bottomleft,0):(t=1,e.righttop);break;case 10:n=l&fB?(t=1,e.righttop):(t=0,e.leftbottom);break;case 11:n=l&lB?(t=0,e.lefttop):(t=1,e.righttop);break;case 12:n=l&hB?(t=1,e.rightbottom):(t=e.bottomright,0);break;case 13:n=l&fB?(t=e.bottomleft,0):(t=1,e.rightbottom);break;case 14:n=l&fB?(t=1,e.rightbottom):(t=0,e.leftbottom);break;case 15:n=l&lB?(t=0,e.lefttop):(t=1,e.rightbottom);break;case 16:n=l&hB?(t=0,e.leftbottom):(t=e.bottomright,0);break;case 17:n=l&lB?(t=0,e.lefttop):(t=e.bottomright,0);break;case 18:n=l&fB?(t=e.bottomleft,0):(t=0,e.leftbottom);break;case 19:n=l&lB?(t=0,e.lefttop):(t=e.bottomleft,0);break;case 20:n=l&lB?(t=0,e.leftbottom):(t=e.topleft,1);break;case 21:n=l&cB?(t=e.topright,1):(t=0,e.leftbottom);break;case 22:n=l&lB?(t=0,e.lefttop):(t=e.topleft,1);break;case 23:n=l&cB?(t=e.topright,1):(t=0,e.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(e),null}return void 0!==t&&void 0!==n&&void 0!==a&&void 0!==s&&void 0!==u||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(e),console.log(t+" "+n+" "+a+" "+s+" "+u)),{p:[t,n],x:a,y:s,o:u}}function oU(e){var n=[],r=[];e.forEach(function(e){var t=ez(jN([e]));r.push(t),n.push({ring:e,area:t})}),r.sort(function(e,t){return t-e});var i=[];return r.forEach(function(e){for(var t=0;t<n.length;t++)if(n[t].area===e){i.push(n[t].ring),n.splice(t,1);break}}),i}function aU(e){for(var t=e.map(function(e){return{lrCoordinates:e,grouped:!1}}),n=[];!uU(t);)for(var r=0;r<t.length;r++)if(!t[r].grouped){var i=[];i.push(t[r].lrCoordinates),t[r].grouped=!0;for(var o=jN([t[r].lrCoordinates]),a=r+1;a<t.length;a++){t[a].grouped||sU(jN([t[a].lrCoordinates]),o)&&(i.push(t[a].lrCoordinates),t[a].grouped=!0)}n.push(i)}return n}function sU(e,t){for(var n=HM(e),r=0;r<n.features.length;r++)if(!HD(n.features[r],t))return;return 1}function uU(e){for(var t=0;t<e.length;t++)if(!1===e[t].grouped)return;return 1}function lU(e,i,t){if(!pR(t=t||{}))throw new Error("options is invalid");var o=t.pivot,n=t.mutate;if(!e)throw new Error("geojson is required");if(null==i||isNaN(i))throw new Error("angle is required");return 0===i||(o=o||qM(e),!1!==n&&void 0!==n||(e=JD(e)),gR(e,function(e){var t=VF(o,e)+i,n=GF(o,e),r=MR(Jz(o,n,t));e[0]=r[0],e[1]=r[1]})),e}function cU(n,r,e){if(!pR(e=e||{}))throw new Error("options is invalid");var i=e.origin,t=e.mutate;if(!n)throw new Error("geojson required");if("number"!=typeof r||0===r)throw new Error("invalid factor");var o=Array.isArray(i)||"object"==typeof i;return!0!==t&&(n=JD(n)),"FeatureCollection"!==n.type||o?hU(n,r,i):(bR(n,function(e,t){n.features[t]=hU(e,r,i)}),n)}function hU(e,i,o){var t="Point"===GR(e);return o=function(e,t){null==t&&(t="centroid");if(Array.isArray(t)||"object"==typeof t)return DR(t);var n=e.bbox?e.bbox:RR(e),r=n[0],i=n[1],o=n[2],a=n[3];switch(t){case"sw":case"southwest":case"westsouth":case"bottomleft":return YN([r,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return YN([o,i]);case"nw":case"northwest":case"westnorth":case"topleft":return YN([r,a]);case"ne":case"northeast":case"eastnorth":case"topright":return YN([o,a]);case"center":return GM(e);case void 0:case null:case"centroid":return qM(e);default:throw new Error("invalid origin")}}(e,o),1===i||t||gR(e,function(e){var t=GF(o,e),n=VF(o,e),r=MR(Jz(o,t*i,n));e[0]=r[0],e[1]=r[1],3===e.length&&(e[2]*=i)}),e}function fU(e){var t=e[0],n=e[1];return[n[0]-t[0],n[1]-t[1]]}function pU(e,t){return e[0]*t[1]-t[0]*e[1]}function dU(e,t){return n=t,0!==pU(fU(e),fU(n))&&(i=t,h=(r=e)[0],f=fU(r),p=i[0],d=fU(i),m=pU(f,d),_=pU((a=h,[(o=p)[0]-a[0],o[1]-a[1]]),d),s=h,u=[(l=_/m)*(c=f)[0],l*c[1]],[s[0]+u[0],s[1]+u[1]]);var n,r,i,o,a,s,u,l,c,h,f,p,d,m,_}function mU(e,t,n){var p=[],d=aR(t,n),m=MR(e),_=[];return m.forEach(function(e,t){var n,r,i,o,a,s,u,l,c,h,f;t!==m.length-1&&(o=e,a=m[t+1],s=d,u=Math.sqrt((o[0]-a[0])*(o[0]-a[0])+(o[1]-a[1])*(o[1]-a[1])),l=o[0]+s*(a[1]-o[1])/u,c=a[0]+s*(a[1]-o[1])/u,h=o[1]+s*(o[0]-a[0])/u,f=a[1]+s*(o[0]-a[0])/u,n=[[l,h],[c,f]],p.push(n),0<t&&(!1!==(i=dU(n,r=p[t-1]))&&(r[1]=i,n[0]=i),_.push(r[0]),t===m.length-2&&(_.push(n[0]),_.push(n[1]))),2===m.length&&(_.push(n[0]),_.push(n[1])))}),QN(_,e.properties)}function _U(e,t,n){var r=t[0]-e[0],i=t[1]-e[1],o=n[0]-t[0],a=n[1]-t[1];return Math.sign(r*a-o*i)}function gU(t,e){return e.geometry.coordinates[0].every(function(e){return HD(YN(e),t)})}$B[1]=$B[169]=zB,$B[4]=$B[166]=BB,$B[16]=$B[154]=UB,$B[64]=$B[106]=VB,$B[168]=$B[2]=kB,$B[162]=$B[8]=GB,$B[138]=$B[32]=qB,$B[42]=$B[128]=HB,$B[5]=$B[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},$B[20]=$B[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},$B[80]=$B[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},$B[65]=$B[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},$B[160]=$B[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},$B[130]=$B[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},$B[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},$B[101]=$B[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},$B[149]=$B[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},$B[86]=$B[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},$B[89]=$B[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},$B[96]=$B[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},$B[24]=$B[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},$B[6]=$B[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},$B[129]=$B[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},$B[66]=$B[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},$B[144]=$B[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},$B[36]=$B[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},$B[9]=$B[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},$B[37]=$B[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},$B[148]=$B[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},$B[82]=$B[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},$B[73]=$B[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},$B[145]=$B[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},$B[70]=$B[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},$B[34]=function(e){return[HB(e),GB(e)]},$B[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},$B[136]=function(e){return[qB(e),kB(e)]},$B[153]=function(e){return[UB(e),zB(e)]},$B[102]=function(e){return[BB(e),VB(e)]},$B[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},$B[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},$B[152]=function(e){return[UB(e),kB(e)]},$B[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},$B[137]=function(e){return[qB(e),zB(e)]},$B[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},$B[98]=function(e){return[GB(e),VB(e)]},$B[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},$B[38]=function(e){return[BB(e),HB(e)]},$B[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]};function yU(e){this.id=yU.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}yU.buildId=function(e){return e.join(",")},yU.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(e){return e.from.id!==t.from.id})},yU.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(e){return e.to.id!==t.to.id})},yU.prototype.addOuterEdge=function(e){this.outerEdges.push(e),this.outerEdgesSorted=!1},yU.prototype.sortOuterEdges=function(){var o=this;this.outerEdgesSorted||(this.outerEdges.sort(function(e,t){var n=e.to,r=t.to;if(0<=n.coordinates[0]-o.coordinates[0]&&r.coordinates[0]-o.coordinates[0]<0)return 1;if(n.coordinates[0]-o.coordinates[0]<0&&0<=r.coordinates[0]-o.coordinates[0])return-1;if(n.coordinates[0]-o.coordinates[0]==0&&r.coordinates[0]-o.coordinates[0]==0)return 0<=n.coordinates[1]-o.coordinates[1]||0<=r.coordinates[1]-o.coordinates[1]?n.coordinates[1]-r.coordinates[1]:r.coordinates[1]-n.coordinates[1];var i=_U(o.coordinates,n.coordinates,r.coordinates);return i<0?1:0<i?-1:Math.pow(n.coordinates[0]-o.coordinates[0],2)+Math.pow(n.coordinates[1]-o.coordinates[1],2)-(Math.pow(r.coordinates[0]-o.coordinates[0],2)+Math.pow(r.coordinates[1]-o.coordinates[1],2))}),this.outerEdgesSorted=!0)},yU.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},yU.prototype.getOuterEdge=function(e){return this.sortOuterEdges(),this.outerEdges[e]},yU.prototype.addInnerEdge=function(e){this.innerEdges.push(e)};function vU(e,t){this.from=e,this.to=t,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}vU.prototype.getSymetric=function(){return this.symetric||(this.symetric=new vU(this.to,this.from),this.symetric.symetric=this),this.symetric},vU.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},vU.prototype.isEqual=function(e){return this.from.id===e.from.id&&this.to.id===e.to.id},vU.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},vU.prototype.toLineString=function(){return QN([this.from.coordinates,this.to.coordinates])},vU.prototype.compareTo=function(e){return _U(e.from.coordinates,e.to.coordinates,this.to.coordinates)};function xU(){this.edges=[],this.polygon=void 0,this.envelope=void 0}var bU={length:{configurable:!0}};xU.prototype.push=function(e){this[this.edges.length]=e,this.edges.push(e),this.polygon=this.envelope=void 0},xU.prototype.get=function(e){return this.edges[e]},bU.length.get=function(){return this.edges.length},xU.prototype.forEach=function(e){this.edges.forEach(e)},xU.prototype.map=function(e){return this.edges.map(e)},xU.prototype.some=function(e){return this.edges.some(e)},xU.prototype.isValid=function(){return!0},xU.prototype.isHole=function(){var r=this,e=this.edges.reduce(function(e,t,n){return t.from.coordinates[1]>r.edges[e].from.coordinates[1]&&(e=n),e},0),t=(0===e?this.length:e)-1,n=(e+1)%this.length,i=_U(this.edges[t].from.coordinates,this.edges[e].from.coordinates,this.edges[n].from.coordinates);return 0===i?this.edges[t].from.coordinates[0]>this.edges[n].from.coordinates[0]:0<i},xU.prototype.toMultiPoint=function(){return eR(this.edges.map(function(e){return e.from.coordinates}))},xU.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var e=this.edges.map(function(e){return e.from.coordinates});return e.push(this.edges[0].from.coordinates),this.polygon=jN([e])},xU.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=zM(this.toPolygon())},xU.findEdgeRingContaining=function(l,e){var c,h,f=l.getEnvelope();return e.forEach(function(e){var t,n,r,i,o,a,s,u=e.getEnvelope();h&&(c=h.getEnvelope()),n=f,r=(t=u).geometry.coordinates.map(function(e){return e[0]}),i=t.geometry.coordinates.map(function(e){return e[1]}),o=n.geometry.coordinates.map(function(e){return e[0]}),a=n.geometry.coordinates.map(function(e){return e[1]}),Math.max(null,r)===Math.max(null,o)&&Math.max(null,i)===Math.max(null,a)&&Math.min(null,r)===Math.min(null,o)&&Math.min(null,i)===Math.min(null,a)||!gU(u,f)||(s=l.map(function(e){return e.from.coordinates}).find(function(r){return!e.some(function(e){return t=r,n=e.from.coordinates,t[0]===n[0]&&t[1]===n[1];var t,n})}))&&e.inside(YN(s))&&(h&&!gU(c,u)||(h=e))}),h},xU.prototype.inside=function(e){return HD(e,this.toPolygon())},Object.defineProperties(xU.prototype,bU);function EU(){this.edges=[],this.nodes={}}function TU(e,t){for(var n=0;n<e.coordinates.length-1;n++)if(CU(e.coordinates[n],e.coordinates[n+1],t.coordinates))return 1}function SU(e,t){return 0<zF(t,Dz(e)).features.length}function CU(e,t,n){var r=n[0]-e[0],i=n[1]-e[1],o=t[0]-e[0],a=t[1]-e[1];return 0==r*a-i*o&&(Math.abs(o)>=Math.abs(a)?0<o?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:0<a?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1])}function wU(e,t){return!(e[0]>t[0]||e[2]<t[2]||e[1]>t[1]||e[3]<t[3])}function AU(e,t){return e[0]===t[0]&&e[1]===t[1]}function IU(e,t){for(var n=!1,r=!1,i=e.coordinates.length,o=0;o<i&&!n&&!r;){for(var a=0;a<t.coordinates.length-1;a++){var s=!0;0!==a&&a!==t.coordinates.length-2||(s=!1),LU(t.coordinates[a],t.coordinates[a+1],e.coordinates[o],s)?n=!0:r=!0}o++}return n&&r}function PU(e,t){return 0<zF(e,Dz(t)).features.length}function OU(e,t){for(var n=!1,r=!1,i=e.coordinates[0].length,o=0;o<i&&n&&r;)HD(YN(e.coordinates[0][o]),t)?n=!0:r=!0,o++;return r&&r}function LU(e,t,n,r){var i=n[0]-e[0],o=n[1]-e[1],a=t[0]-e[0],s=t[1]-e[1];return 0==i*s-o*a&&(r?Math.abs(a)>=Math.abs(s)?0<a?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:0<s?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1]:Math.abs(a)>=Math.abs(s)?0<a?e[0]<n[0]&&n[0]<t[0]:t[0]<n[0]&&n[0]<e[0]:0<s?e[1]<n[1]&&n[1]<t[1]:t[1]<n[1]&&n[1]<e[1])}EU.fromGeoJson=function(e){!function(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var i=new EU;return wR(e,function(e){BR(e,"LineString","Graph::fromGeoJson"),yR(e,function(e,t){var n,r;return e&&(n=i.getNode(e),r=i.getNode(t),i.addEdge(n,r)),t})}),i},EU.prototype.getNode=function(e){var t=yU.buildId(e);return this.nodes[t]||(this.nodes[t]=new yU(e))},EU.prototype.addEdge=function(e,t){var n=new vU(e,t),r=n.getSymetric();this.edges.push(n),this.edges.push(r)},EU.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(e){return t.nodes[e]}).forEach(function(e){return t._removeIfDangle(e)})},EU.prototype._removeIfDangle=function(e){var t,n=this;e.innerEdges.length<=1&&(t=e.getOuterEdges().map(function(e){return e.to}),this.removeNode(e),t.forEach(function(e){return n._removeIfDangle(e)}))},EU.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))})},EU.prototype._computeNextCWEdges=function(n){var t=this;void 0===n?Object.keys(this.nodes).forEach(function(e){return t._computeNextCWEdges(t.nodes[e])}):n.getOuterEdges().forEach(function(e,t){n.getOuterEdge((0===t?n.getOuterEdges().length:t)-1).symetric.next=e})},EU.prototype._computeNextCCWEdges=function(e,t){for(var n,r,i=e.getOuterEdges(),o=i.length-1;0<=o;--o){var a=i[o],s=a.symetric,u=void 0,l=void 0;a.label===t&&(u=a),s.label===t&&(l=s),u&&l&&(l&&(r=l),u&&(r&&(r.next=u,r=void 0),n=n||u))}r&&(r.next=n)},EU.prototype._findLabeledEdgeRings=function(){var n=[],r=0;return this.edges.forEach(function(e){if(!(0<=e.label)){n.push(e);for(var t=e;t.label=r,t=t.next,!e.isEqual(t););r++}}),n},EU.prototype.getEdgeRings=function(){var n=this;this._computeNextCWEdges(),this.edges.forEach(function(e){e.label=void 0}),this._findLabeledEdgeRings().forEach(function(t){n._findIntersectionNodes(t).forEach(function(e){n._computeNextCCWEdges(e,t.label)})});var t=[];return this.edges.forEach(function(e){e.ring||t.push(n._findEdgeRing(e))}),t},EU.prototype._findIntersectionNodes=function(n){for(var e=[],r=n,t=function(){var t=0;r.from.getOuterEdges().forEach(function(e){e.label===n.label&&++t}),1<t&&e.push(r.from),r=r.next};t(),!n.isEqual(r););return e},EU.prototype._findEdgeRing=function(e){for(var t=e,n=new xU;n.push(t),t.ring=n,t=t.next,!e.isEqual(t););return n},EU.prototype.removeNode=function(e){var t=this;e.getOuterEdges().forEach(function(e){return t.removeEdge(e)}),e.innerEdges.forEach(function(e){return t.removeEdge(e)}),delete this.nodes[e.id]},EU.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(e){return!e.isEqual(t)}),t.deleteEdge()};function NU(e){this.precision=e&&e.precision?e.precision:17,this.direction=!(!e||!e.direction)&&e.direction,this.pseudoNode=!(!e||!e.pseudoNode)&&e.pseudoNode,this.objectComparator=e&&e.objectComparator?e.objectComparator:BU}var RU=mD(function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"==typeof Object.keys?Object.keys:n).shim=n}),DU=(RU.shim,mD(function(e,t){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:i).supported=r,t.unsupported=i})),MU=(DU.supported,DU.unsupported,mD(function(e){var s=Array.prototype.slice,u=e.exports=function(e,t,n){return n=n||{},e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?n.strict?e===t:e==t:function(e,t,n){var r,i;if(l(e)||l(t))return!1;if(e.prototype!==t.prototype)return!1;if(DU(e))return!!DU(t)&&(e=s.call(e),t=s.call(t),u(e,t,n));if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}try{var o=RU(e),a=RU(t)}catch(e){return!1}if(o.length!=a.length)return!1;for(o.sort(),a.sort(),r=o.length-1;0<=r;r--)if(o[r]!=a[r])return!1;for(r=o.length-1;0<=r;r--)if(i=o[r],!u(e[i],t[i],n))return!1;return typeof e==typeof t}(e,t,n))};function l(e){return null==e}function c(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.copy||"function"!=typeof e.slice||0<e.length&&"number"!=typeof e[0])}}));function FU(t){return t.coordinates.map(function(e){return{type:t.type.replace("Multi",""),coordinates:e}})}function zU(e,t){return e.hasOwnProperty("coordinates")?e.coordinates.length===t.coordinates.length:e.length===t.length}function BU(e,t){return MU(e,t,{strict:!0})}NU.prototype.compare=function(e,t){if(e.type!==t.type||!zU(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates,0,!1);case"Polygon":return this.comparePolygon(e,t);case"Feature":return this.compareFeature(e,t);default:if(0===e.type.indexOf("Multi")){var n=this,r=FU(e),i=FU(t);return r.every(function(t){return this.some(function(e){return n.compare(t,e)})},i)}}return!1},NU.prototype.compareCoord=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n].toFixed(this.precision)!==t[n].toFixed(this.precision))return!1;return!0},NU.prototype.compareLine=function(e,t,n,r){if(!zU(e,t))return!1;var i=this.pseudoNode?e:this.removePseudo(e),o=this.pseudoNode?t:this.removePseudo(t);if(!r||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var a=this.compareCoord(i[n],o[n]);return this.direction||a?this.comparePath(i,o):!!this.compareCoord(i[n],o[o.length-(1+n)])&&this.comparePath(i.slice().reverse(),o)}},NU.prototype.fixStartIndex=function(e,t){for(var n,r=-1,i=0;i<e.length;i++)if(this.compareCoord(e[i],t[0])){r=i;break}return 0<=r&&(n=[].concat(e.slice(r,e.length),e.slice(1,r+1))),n},NU.prototype.comparePath=function(e,t){var n=this;return e.every(function(e,t){return n.compareCoord(e,this[t])},t)},NU.prototype.comparePolygon=function(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){var n=e.coordinates.slice(1,e.coordinates.length),r=t.coordinates.slice(1,t.coordinates.length),i=this;return n.every(function(t){return this.some(function(e){return i.compareLine(t,e,1,!0)})},r)}return!1},NU.prototype.compareFeature=function(e,t){return!(e.id!==t.id||!this.objectComparator(e.properties,t.properties)||!this.compareBBox(e,t))&&this.compare(e.geometry,t.geometry)},NU.prototype.compareBBox=function(e,t){return!!(!e.bbox&&!t.bbox||e.bbox&&t.bbox&&this.compareCoord(e.bbox,t.bbox))},NU.prototype.removePseudo=function(e){return e};var UU=NU;function VU(e,n){if(!e)throw new Error("feature1 is required");if(!n)throw new Error("feature2 is required");var t=GR(e);if(t!==GR(n))throw new Error("features must be of the same type");if("Point"===t)throw new Error("Point geometry not supported");if(new UU({precision:6}).compare(e,n))return!1;var r=0;switch(t){case"MultiPoint":var i=TR(e),o=TR(n);i.forEach(function(t){o.forEach(function(e){t[0]===e[0]&&t[1]===e[1]&&r++})});break;case"LineString":case"MultiLineString":IR(e,function(t){IR(n,function(e){Kz(t,e).features.length&&r++})});break;case"Polygon":case"MultiPolygon":IR(e,function(t){IR(n,function(e){zF(t,e).features.length&&r++})})}return 0<r}var kU=mD(function(e){function t(e,t,n,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(e,t,n,r)}t.prototype.run=function(e,t,n,r){this._init(e,t,n,r);for(var i,o,a=0;a<this._datasetLength;a++){1!==this._visited[a]&&(this._visited[a]=1,(i=this._regionQuery(a)).length<this.minPts?this.noise.push(a):(o=this.clusters.length,this.clusters.push([]),this._addToCluster(a,o),this._expandCluster(o,i)))}return this.clusters},t.prototype._init=function(e,t,n,r){if(e){if(!(e instanceof Array))throw Error("Dataset must be of type array, "+typeof e+" given");this.dataset=e,this.clusters=[],this.noise=[],this._datasetLength=e.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}t&&(this.epsilon=t),n&&(this.minPts=n),r&&(this.distance=r)},t.prototype._expandCluster=function(e,t){for(var n=0;n<t.length;n++){var r,i=t[n];1!==this._visited[i]&&(this._visited[i]=1,(r=this._regionQuery(i)).length>=this.minPts&&(t=this._mergeArrays(t,r))),1!==this._assigned[i]&&this._addToCluster(i,e)}},t.prototype._addToCluster=function(e,t){this.clusters[t].push(e),this._assigned[e]=1},t.prototype._regionQuery=function(e){for(var t=[],n=0;n<this._datasetLength;n++){this.distance(this.dataset[e],this.dataset[n])<this.epsilon&&t.push(n)}return t},t.prototype._mergeArrays=function(e,t){for(var n=t.length,r=0;r<n;r++){var i=t[r];e.indexOf(i)<0&&e.push(i)}return e},t.prototype._euclideanDistance=function(e,t){for(var n=0,r=Math.min(e.length,t.length);r--;)n+=(e[r]-t[r])*(e[r]-t[r]);return Math.sqrt(n)},e.exports&&(e.exports=t)}),GU=mD(function(e){function t(e,t,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(e,t,n)}t.prototype.init=function(e,t,n){this.assignments=[],this.centroids=[],void 0!==e&&(this.dataset=e),void 0!==t&&(this.k=t),void 0!==n&&(this.distance=n)},t.prototype.run=function(e,t){this.init(e,t);for(var n=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var a=new Array(c),s=0,u=0;u<c;u++)a[u]=0;for(var l=0;l<n;l++){var c=this.dataset[l].length;if(o===this.assignments[l]){for(u=0;u<c;u++)a[u]+=this.dataset[l][u];s++}}if(0<s){for(u=0;u<c;u++)a[u]/=s;this.centroids[o]=a}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},t.prototype.randomCentroid=function(){for(var e,t,n=this.dataset.length-1;t=Math.round(Math.random()*n),e=this.dataset[t],0<=this.centroids.indexOf(e););return e},t.prototype.assign=function(){for(var e,t=!1,n=this.dataset.length,r=0;r<n;r++)(e=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=e,t=!0);return t},t.prototype.getClusters=function(){for(var e,t=new Array(this.k),n=0;n<this.assignments.length;n++)void 0===t[e=this.assignments[n]]&&(t[e]=[]),t[e].push(n);return t},t.prototype.argmin=function(e,t,n){for(var r,i=Number.MAX_VALUE,o=0,a=t.length,s=0;s<a;s++)(r=n(e,t[s]))<i&&(i=r,o=s);return o},t.prototype.distance=function(e,t){for(var n=0,r=Math.min(e.length,t.length);r--;){var i=e[r]-t[r];n+=i*i}return Math.sqrt(n)},e.exports&&(e.exports=t)}),qU=mD(function(e){function t(e,t,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(e,t,n)}t.prototype.insert=function(e,t){for(var n=this._queue.length,r=n;r--;){var i=this._priorities[r];"desc"===this._sorting?i<t&&(n=r):t<i&&(n=r)}this._insertAt(e,t,n)},t.prototype.remove=function(e){for(var t=this._queue.length;t--;){if(e===this._queue[t]){this._queue.splice(t,1),this._priorities.splice(t,1);break}}},t.prototype.forEach=function(e){this._queue.forEach(e)},t.prototype.getElements=function(){return this._queue},t.prototype.getElementPriority=function(e){return this._priorities[e]},t.prototype.getPriorities=function(){return this._priorities},t.prototype.getElementsWithPriorities=function(){for(var e=[],t=0,n=this._queue.length;t<n;t++)e.push([this._queue[t],this._priorities[t]]);return e},t.prototype._init=function(e,t,n){if(e&&t){if(this._queue=[],this._priorities=[],e.length!==t.length)throw new Error("Arrays must have the same length");for(var r=0;r<e.length;r++)this.insert(e[r],t[r])}n&&(this._sorting=n)},t.prototype._insertAt=function(e,t,n){this._queue.length===n?(this._queue.push(e),this._priorities.push(t)):(this._queue.splice(n,0,e),this._priorities.splice(n,0,t))},e.exports&&(e.exports=t)}),HU=mD(function(e){var l;function t(e,t,n,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(e,t,n,r)}e.exports&&(l=qU),t.prototype.run=function(e,t,n,r){this._init(e,t,n,r);for(var i,o,a,s=0,u=this.dataset.length;s<u;s++){1!==this._processed[s]&&(this._processed[s]=1,this.clusters.push([s]),i=this.clusters.length-1,this._orderedList.push(s),o=new l(null,null,"asc"),a=this._regionQuery(s),void 0!==this._distanceToCore(s)&&(this._updateQueue(s,a,o),this._expandCluster(i,o)))}return this.clusters},t.prototype.getReachabilityPlot=function(){for(var e=[],t=0,n=this._orderedList.length;t<n;t++){var r=this._orderedList[t],i=this._reachability[r];e.push([r,i])}return e},t.prototype._init=function(e,t,n,r){if(e){if(!(e instanceof Array))throw Error("Dataset must be of type array, "+typeof e+" given");this.dataset=e,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}t&&(this.epsilon=t),n&&(this.minPts=n),r&&(this.distance=r)},t.prototype._updateQueue=function(r,e,i){var o=this;this._coreDistance=this._distanceToCore(r),e.forEach(function(e){var t,n;void 0===o._processed[e]&&(t=o.distance(o.dataset[r],o.dataset[e]),n=Math.max(o._coreDistance,t),void 0===o._reachability[e]?(o._reachability[e]=n,i.insert(e,n)):n<o._reachability[e]&&(o._reachability[e]=n,i.remove(e),i.insert(e,n)))})},t.prototype._expandCluster=function(e,t){for(var n=t.getElements(),r=0,i=n.length;r<i;r++){var o,a=n[r];void 0===this._processed[a]&&(o=this._regionQuery(a),this._processed[a]=1,this.clusters[e].push(a),this._orderedList.push(a),void 0!==this._distanceToCore(a)&&(this._updateQueue(a,o,t),this._expandCluster(e,t)))}},t.prototype._distanceToCore=function(e){for(var t=this.epsilon,n=0;n<t;n++){if(this._regionQuery(e,n).length>=this.minPts)return n}},t.prototype._regionQuery=function(e,t){t=t||this.epsilon;for(var n=[],r=0,i=this.dataset.length;r<i;r++)this.distance(this.dataset[e],this.dataset[r])<t&&n.push(r);return n},t.prototype._euclideanDistance=function(e,t){for(var n=0,r=Math.min(e.length,t.length);r--;)n+=(e[r]-t[r])*(e[r]-t[r]);return Math.sqrt(n)},e.exports&&(e.exports=t)}),WU=mD(function(e){e.exports&&(e.exports={DBSCAN:kU,KMEANS:GU,OPTICS:HU,PriorityQueue:qU})});WU.DBSCAN,WU.KMEANS,WU.OPTICS,WU.PriorityQueue;function YU(e,t,n){var r=Math.abs(e-t);return n?r:r*r}var XU=function(e,t,n){for(var r=e.length,i=0,o=0;o<r;o++){var a=(e[o]||0)-(t[o]||0);i+=a*a}return n?Math.sqrt(i):i},jU=XU,KU=XU,QU=function(e,t){for(var n={},r=[],i=t<<2,o=e.length,a=0<e[0].length;r.length<t&&0<i--;){var s=e[Math.floor(Math.random()*o)],u=a?s.join("_"):""+s;n[u]||(n[u]=!0,r.push(s))}if(r.length<t)throw new Error("Error initializating clusters");return r},ZU=function(e,t){var n=e[0].length?jU:YU,r=[],i=e.length,o=0<e[0].length,a=e[Math.floor(Math.random()*i)];o&&a.join("_");for(r.push(a);r.length<t;){for(var s=[],u=r.length,l=0,c=[],h=0;h<i;h++){for(var f=1/0,p=0;p<u;p++){var d=n(e[h],r[p]);d<=f&&(f=d)}s[h]=f}for(var m=0;m<i;m++)l+=s[m];for(var _=0;_<i;_++)c[_]={i:_,v:e[_],pr:s[_]/l,cs:0};c.sort(function(e,t){return e.pr-t.pr}),c[0].cs=c[0].pr;for(var g=1;g<i;g++)c[g].cs=c[g-1].cs+c[g].pr;for(var y=Math.random(),v=0;v<i-1&&c[v++].cs<y;);r.push(c[v-1].v)}return r};function JU(e,t,n){n=n||[];for(var r=0;r<e;r++)n[r]=t;return n}var $U=function(e,t,n,r){var i=[],o=[],a=[],s=[],u=!1,l=r||1e4,c=e.length,h=e[0].length,f=0<h,p=[];if(n)i="kmrand"==n?QU(e,t):"kmpp"==n?ZU(e,t):n;else for(var d={};i.length<t;){var m=Math.floor(Math.random()*c);d[m]||(d[m]=!0,i.push(e[m]))}do{JU(t,0,p);for(var _=0;_<c;_++){for(var g=1/0,y=0,v=0;v<t;v++){(s=f?KU(e[_],i[v]):Math.abs(e[_]-i[v]))<=g&&(g=s,y=v)}p[a[_]=y]++}for(var x=[],o=[],b=0;b<t;b++)x[b]=f?JU(h,0,x[b]):0,o[b]=i[b];if(f){for(var E=0;E<t;E++)i[E]=[];for(var T=0;T<c;T++)for(var S=x[a[T]],C=e[T],w=0;w<h;w++)S[w]+=C[w];u=!0;for(var A=0;A<t;A++){for(var I=i[A],P=x[A],O=o[A],L=p[A],N=0;N<h;N++)I[N]=P[N]/L||0;if(u)for(var R=0;R<h;R++)if(O[R]!=I[R]){u=!1;break}}}else{for(var D=0;D<c;D++){x[a[D]]+=e[D]}for(var M=0;M<t;M++)i[M]=x[M]/p[M]||0;u=!0;for(var F=0;F<t;F++)if(o[F]!=i[F]){u=!1;break}}u=u||--l<=0}while(!u);return{it:1e4-l,k:t,idxs:a,centroids:i}};function eV(e,t){if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error("Invalid GeoJSON object for "+t)}function tV(e){for(var t=e,n=[];t.parent;)n.unshift(t),t=t.parent;return n}var nV={search:function(e,t,n,r){e.cleanDirty();var i=(r=r||{}).heuristic||nV.heuristics.manhattan,o=r.closest||!1,a=new oV(function(e){return e.f}),s=t;for(t.h=i(t,n),a.push(t);0<a.size();){var u=a.pop();if(u===n)return tV(u);u.closed=!0;for(var l=e.neighbors(u),c=0,h=l.length;c<h;++c){var f,p,d=l[c];d.closed||d.isWall()||(f=u.g+d.getCost(u),(!(p=d.visited)||f<d.g)&&(d.visited=!0,d.parent=u,d.h=d.h||i(d,n),d.g=f,d.f=d.g+d.h,e.markDirty(d),o&&(d.h<s.h||d.h===s.h&&d.g<s.g)&&(s=d),p?a.rescoreElement(d):a.push(d)))}}return o?tV(s):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var n=Math.sqrt(2),r=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return+(r+i)+(n-2)*Math.min(r,i)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function rV(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var n=0;n<e.length;n++){this.grid[n]=[];for(var r=0,i=e[n];r<i.length;r++){var o=new iV(n,r,i[r]);this.grid[n][r]=o,this.nodes.push(o)}}this.init()}function iV(e,t,n){this.x=e,this.y=t,this.weight=n}function oV(e){this.content=[],this.scoreFunction=e}function aV(e,t){for(var n=0;n<t.features.length;n++)if(HD(e,t.features[n]))return!0;return!1}rV.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)nV.cleanNode(this.nodes[e])},rV.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)nV.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},rV.prototype.markDirty=function(e){this.dirtyNodes.push(e)},rV.prototype.neighbors=function(e){var t=[],n=e.x,r=e.y,i=this.grid;return i[n-1]&&i[n-1][r]&&t.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&t.push(i[n+1][r]),i[n]&&i[n][r-1]&&t.push(i[n][r-1]),i[n]&&i[n][r+1]&&t.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&t.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&t.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&t.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&t.push(i[n+1][r+1])),t},rV.prototype.toString=function(){for(var e,t,n,r,i=[],o=this.grid,a=0,s=o.length;a<s;a++){for(e=[],n=0,r=(t=o[a]).length;n<r;n++)e.push(t[n].weight);i.push(e.join(" "))}return i.join("\n")},iV.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},iV.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},iV.prototype.isWall=function(){return 0===this.weight},oV.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return 0<this.content.length&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];0<e;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},bubbleUp:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var i,o,a,s=e+1<<1,u=s-1,l=null;if(u<t&&(i=this.content[u],(o=this.scoreFunction(i))<r&&(l=u)),s<t&&(a=this.content[s],this.scoreFunction(a)<(null===l?r:o)&&(l=s)),null===l)break;this.content[e]=this.content[l],this.content[l]=n,e=l}}};function sV(e){return function(){return e}}function uV(e){return e[0]}function lV(e){return e[1]}function cV(){this._=null}function hV(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function fV(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function pV(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function dV(e){for(;e.L;)e=e.L;return e}function mV(e,t,n,r){var i=[null,null],o=zV.push(i)-1;return i.left=e,i.right=t,n&&gV(i,e,t,n),r&&gV(i,t,e,r),MV[e.index].halfedges.push(o),MV[t.index].halfedges.push(o),i}function _V(e,t,n){var r=[t,n];return r.left=e,r}function gV(e,t,n,r){e[0]||e[1]?e.left===n?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=n)}function yV(e,t,n,r,i){var o=e[0],a=e[1],s=o[0],u=o[1],l=0,c=1,h=a[0]-s,f=a[1]-u,p=t-s;if(h||!(0<p)){if(p/=h,h<0){if(p<l)return;p<c&&(c=p)}else if(0<h){if(c<p)return;l<p&&(l=p)}if(p=r-s,h||!(p<0)){if(p/=h,h<0){if(c<p)return;l<p&&(l=p)}else if(0<h){if(p<l)return;p<c&&(c=p)}if(p=n-u,f||!(0<p)){if(p/=f,f<0){if(p<l)return;p<c&&(c=p)}else if(0<f){if(c<p)return;l<p&&(l=p)}if(p=i-u,f||!(p<0)){if(p/=f,f<0){if(c<p)return;l<p&&(l=p)}else if(0<f){if(p<l)return;p<c&&(c=p)}return 0<l||c<1?(0<l&&(e[0]=[s+l*h,u+l*f]),c<1&&(e[1]=[s+c*h,u+c*f]),1):1}}}}}function vV(e,t,n,r,i){var o=e[1];if(o)return 1;var a,s,u=e[0],l=e.left,c=e.right,h=l[0],f=l[1],p=c[0],d=c[1],m=(h+p)/2,_=(f+d)/2;if(d===f){if(m<t||r<=m)return;if(p<h){if(u){if(u[1]>=i)return}else u=[m,n];o=[m,i]}else{if(u){if(u[1]<n)return}else u=[m,i];o=[m,n]}}else if(s=_-(a=(h-p)/(d-f))*m,a<-1||1<a)if(p<h){if(u){if(u[1]>=i)return}else u=[(n-s)/a,n];o=[(i-s)/a,i]}else{if(u){if(u[1]<n)return}else u=[(i-s)/a,i];o=[(n-s)/a,n]}else if(f<d){if(u){if(u[0]>=r)return}else u=[t,a*t+s];o=[r,a*r+s]}else{if(u){if(u[0]<t)return}else u=[r,a*r+s];o=[t,a*t+s]}return e[0]=u,e[1]=o,1}function xV(e,t){return t[+(t.left!==e.site)]}cV.prototype={constructor:cV,insert:function(e,t){var n,r,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else n=this._?(e=dV(this._),t.P=null,(t.N=e).P=e.L=t,e):(t.P=t.N=null,this._=t,null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(fV(this,n),n=(e=n).U),n.C=!1,r.C=!0,pV(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(pV(this,n),n=(e=n).U),n.C=!1,r.C=!0,fV(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r=e.U,i=e.L,o=e.R,a=i?o?dV(o):i:o;if(r?r.L===e?r.L=a:r.R=a:this._=a,i&&o?(n=a.C,a.C=e.C,((a.L=i).U=a)!==o?(r=a.U,a.U=e.U,e=a.R,r.L=e,(a.R=o).U=a):(a.U=r,e=(r=a).R)):(n=e.C,e=a),e&&(e.U=r),!n)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===r.L){if((t=r.R).C&&(t.C=!1,r.C=!0,fV(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,pV(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,fV(this,r),e=this._;break}}else if((t=r.L).C&&(t.C=!1,r.C=!0,pV(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,fV(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,pV(this,r),e=this._;break}t.C=!0,r=(e=r).U}while(!e.C);e&&(e.C=!1)}}};var bV,EV=[];function TV(){hV(this),this.x=this.y=this.arc=this.site=this.cy=null}function SV(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,i=e.site,o=n.site;if(r!==o){var a=i[0],s=i[1],u=r[0]-a,l=r[1]-s,c=o[0]-a,h=o[1]-s,f=2*(u*h-l*c);if(!(-UV<=f)){var p=u*u+l*l,d=c*c+h*h,m=(h*p-l*d)/f,_=(u*d-c*p)/f,g=EV.pop()||new TV;g.arc=e,g.site=i,g.x=m+a,g.y=(g.cy=_+s)+Math.sqrt(m*m+_*_),e.circle=g;for(var y=null,v=FV._;v;)if(g.y<v.y||g.y===v.y&&g.x<=v.x){if(!v.L){y=v.P;break}v=v.L}else{if(!v.R){y=v;break}v=v.R}FV.insert(y,g),y||(bV=g)}}}}function CV(e){var t=e.circle;t&&(t.P||(bV=t.N),FV.remove(t),EV.push(t),hV(t),e.circle=null)}var wV=[];function AV(){hV(this),this.edge=this.site=this.circle=null}function IV(e){var t=wV.pop()||new AV;return t.site=e,t}function PV(e){CV(e),DV.remove(e),wV.push(e),hV(e)}function OV(e){var t=e.circle,n=t.x,r=t.cy,i=[n,r],o=e.P,a=e.N,s=[e];PV(e);for(var u=o;u.circle&&Math.abs(n-u.circle.x)<BV&&Math.abs(r-u.circle.cy)<BV;)o=u.P,s.unshift(u),PV(u),u=o;s.unshift(u),CV(u);for(var l=a;l.circle&&Math.abs(n-l.circle.x)<BV&&Math.abs(r-l.circle.cy)<BV;)a=l.N,s.push(l),PV(l),l=a;s.push(l),CV(l);for(var c=s.length,h=1;h<c;++h)l=s[h],u=s[h-1],gV(l.edge,u.site,l.site,i);u=s[0],(l=s[c-1]).edge=mV(u.site,l.site,null,i),SV(u),SV(l)}function LV(e){for(var t,n,r,i,o,a=e[0],s=e[1],u=DV._;u;)if(r=NV(u,s)-a,BV<r)u=u.L;else{if(i=a-RV(u,s),!(BV<i)){-BV<r?(t=u.P,n=u):-BV<i?n=(t=u).N:t=n=u;break}if(!u.R){t=u;break}u=u.R}MV[(o=e).index]={site:o,halfedges:[]};var l,c,h,f,p,d,m,_,g,y,v,x,b=IV(e);if(DV.insert(t,b),t||n){if(t===n)return CV(t),n=IV(t.site),DV.insert(b,n),b.edge=n.edge=mV(t.site,b.site),SV(t),void SV(n);n?(CV(t),CV(n),c=(l=t.site)[0],h=l[1],f=e[0]-c,p=e[1]-h,m=(d=n.site)[0]-c,x=[((_=d[1]-h)*(y=f*f+p*p)-p*(v=m*m+_*_))/(g=2*(f*_-p*m))+c,(f*v-m*y)/g+h],gV(n.edge,l,d,x),b.edge=mV(l,e,null,x),n.edge=mV(e,d,null,x),SV(t),SV(n)):b.edge=mV(t.site,b.site)}}function NV(e,t){var n=e.site,r=n[0],i=n[1],o=i-t;if(!o)return r;var a=e.P;if(!a)return-1/0;var s=(n=a.site)[0],u=n[1],l=u-t;if(!l)return s;var c=s-r,h=1/o-1/l,f=c/l;return h?(-f+Math.sqrt(f*f-2*h*(c*c/(-2*l)-u+l/2+i-o/2)))/h+r:(r+s)/2}function RV(e,t){var n=e.N;if(n)return NV(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var DV,MV,FV,zV,BV=1e-6,UV=1e-12;function VV(e,t){return t[1]-e[1]||t[0]-e[0]}function kV(e,t){var n,r,i,o,a,s,u,l=e.sort(VV).pop();for(zV=[],MV=new Array(e.length),DV=new cV,FV=new cV;;)if(i=bV,l&&(!i||l[1]<i.y||l[1]===i.y&&l[0]<i.x))l[0]===n&&l[1]===r||(LV(l),n=l[0],r=l[1]),l=e.pop();else{if(!i)break;OV(i.arc)}!function(){for(var e,t,n,r,i,o,a,s,u=0,l=MV.length;u<l;++u)if((e=MV[u])&&(n=(t=e.halfedges).length)){for(var c=new Array(n),h=new Array(n),f=0;f<n;++f)c[f]=f,h[f]=(r=e,i=zV[t[f]],s=a=void 0,o=r.site,a=i.left,s=i.right,o===s&&(s=a,a=o),s?Math.atan2(s[1]-a[1],s[0]-a[0]):(s=o===a?(a=i[1],i[0]):(a=i[0],i[1]),Math.atan2(a[0]-s[0],s[1]-a[1])));for(c.sort(function(e,t){return h[t]-h[e]}),f=0;f<n;++f)h[f]=t[c[f]];for(f=0;f<n;++f)t[f]=h[f]}}(),t&&(function(e,t,n,r){for(var i,o=zV.length;o--;)vV(i=zV[o],e,t,n,r)&&yV(i,e,t,n,r)&&(Math.abs(i[0][0]-i[1][0])>BV||Math.abs(i[0][1]-i[1][1])>BV)||delete zV[o]}(o=+t[0][0],a=+t[0][1],s=+t[1][0],u=+t[1][1]),function(e,t,n,r){var i,o,a,s,u,l,c,h,f,p,d,m,_,g=MV.length,y=!0;for(A=0;A<g;++A)if(i=MV[A]){for(o=i.site,a=(s=i.halfedges).length;a--;)zV[s[a]]||s.splice(a,1);for(a=0,u=s.length;a<u;)m=i,p=(f=(_=zV[s[a]])[+(_.left===m.site)])[0],d=f[1],c=(l=xV(i,zV[s[++a%u]]))[0],h=l[1],(Math.abs(p-c)>BV||Math.abs(d-h)>BV)&&(s.splice(a,0,zV.push(_V(o,f,Math.abs(p-e)<BV&&BV<r-d?[e,Math.abs(c-e)<BV?h:r]:Math.abs(d-r)<BV&&BV<n-p?[Math.abs(h-r)<BV?c:n,r]:Math.abs(p-n)<BV&&BV<d-t?[n,Math.abs(c-n)<BV?h:t]:Math.abs(d-t)<BV&&BV<p-e?[Math.abs(h-t)<BV?c:e,t]:null))-1),++u);u&&(y=!1)}if(y){for(var v,x,b,E,T,S,C,w=1/0,A=0,y=null;A<g;++A)(i=MV[A])&&(b=(v=(o=i.site)[0]-e)*v+(x=o[1]-t)*x)<w&&(w=b,y=i);y&&(E=[e,t],T=[e,r],S=[n,r],C=[n,t],y.halfedges.push(zV.push(_V(o=y.site,E,T))-1,zV.push(_V(o,T,S))-1,zV.push(_V(o,S,C))-1,zV.push(_V(o,C,E))-1))}for(A=0;A<g;++A)(i=MV[A])&&(i.halfedges.length||delete MV[A])}(o,a,s,u)),this.edges=zV,this.cells=MV,DV=FV=zV=MV=null}kV.prototype={constructor:kV,polygons:function(){var n=this.edges;return this.cells.map(function(t){var e=t.halfedges.map(function(e){return xV(t,n[e])});return e.data=t.site.data,e})},triangles:function(){var f=[],p=this.edges;return this.cells.forEach(function(e,t){if(r=(n=e.halfedges).length)for(var n,r,i,o,a,s,u=e.site,l=-1,c=p[n[r-1]],h=c.left===u?c.right:c.left;++l<r;)i=h,h=(c=p[n[l]]).left===u?c.right:c.left,i&&h&&t<i.index&&t<h.index&&(a=i,s=h,((o=u)[0]-s[0])*(a[1]-o[1])-(o[0]-a[0])*(s[1]-o[1])<0)&&f.push([u.data,i.data,h.data])}),f},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(a,s,e){for(var t,u,l=this,c=l._found||0,n=l.cells.length;!(u=l.cells[c]);)if(++c>=n)return null;for(var r=a-u.site[0],i=s-u.site[1],h=r*r+i*i;u=l.cells[t=c],c=null,u.halfedges.forEach(function(e){var t,n,r,i=l.edges[e],o=i.left;!(o!==u.site&&o||(o=i.right))||(r=(t=a-o[0])*t+(n=s-o[1])*n)<h&&(h=r,c=o.index)}),null!==c;);return l._found=t,null==e||h<=e*e?u.site:null}};function GV(e){return(e=e.slice()).push(e[0]),jN([e])}function qV(e,t,n,r){var i=(r=r||{}).steps||64,o=r.units||"kilometers",a=r.angle||0,s=r.pivot||e,u=r.properties||e.properties||{};if(!e)throw new Error("center is required");if(!t)throw new Error("xSemiAxis is required");if(!n)throw new Error("ySemiAxis is required");if(!pR(r))throw new Error("options must be an object");if(!fR(i))throw new Error("steps must be a number");if(!fR(a))throw new Error("angle must be a number");var l,c=DR(e);"degrees"===o?l=lR(a):(t=Jz(e,t,90,{units:o}),n=Jz(e,n,0,{units:o}),t=DR(t)[0]-c[0],n=DR(n)[1]-c[1]);for(var h=[],f=0;f<i;f+=1){var p,d,m=-360*f/i,_=t*n/Math.sqrt(Math.pow(n,2)+Math.pow(t,2)*Math.pow(HV(m),2)),g=t*n/Math.sqrt(Math.pow(t,2)+Math.pow(n,2)/Math.pow(HV(m),2));m<-90&&-270<=m&&(_=-_),m<-180&&-360<=m&&(g=-g),"degrees"===o&&(p=_*Math.cos(l)+g*Math.sin(l),d=g*Math.cos(l)-_*Math.sin(l),_=p,g=d),h.push([_+c[0],g+c[1]])}return h.push(h[0]),"degrees"===o?jN([h],u):lU(jN([h],u),a,{pivot:s})}function HV(e){var t=e*Math.PI/180;return Math.tan(t)}function WV(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.properties,i=t.weight;if(!e)throw new Error("geojson is required");var o=0,a=0,s=0;return SR(e,function(e,t,n){var r=n[i];if(!fR(r=null==r?1:r))throw new Error("weight value must be a number for feature index "+t);0<(r=Number(r))&&gR(e,function(e){o+=e[0]*r,a+=e[1]*r,s+=r})}),YN([o/s,a/s],n)}function YV(e,t){return{x:e[0]-t[0],y:e[1]-t[1]}}function XV(e){if(pR(e)&&(e=e.bbox),e&&!Array.isArray(e))throw new Error("bbox is invalid");return e?(t=e,[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]):[360*JV(),180*JV()];var t}function jV(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.bbox;null==e&&(e=1);for(var r=[],i=0;i<e;i++)r.push(YN(XV(n)));return JN(r)}function KV(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.bbox,r=t.num_vertices,i=t.max_radial_length;null==e&&(e=1),fR(r)||(r=10),fR(i)||(i=10);for(var o=[],a=0;a<e;a++){var s=[],u=Array.apply(null,new Array(r+1)).map(Math.random);u.forEach(l),u.forEach(c),s[s.length-1]=s[0],s=s.map(ZV(XV(n))),o.push(jN([s]))}function l(e,t,n){n[t]=0<t?e+n[t-1]:e}function c(e){e=2*e*Math.PI/u[u.length-1];var t=Math.random();s.push([t*i*Math.sin(e),t*i*Math.cos(e)])}return JN(o)}function QV(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.bbox,r=t.num_vertices,i=t.max_length,o=t.max_rotation;null==e&&(e=1),(!fR(r)||r<2)&&(r=10),fR(i)||(i=1e-4),fR(o)||(o=Math.PI/8);for(var a=[],s=0;s<e;s++){for(var u=[XV(n)],l=0;l<r-1;l++){var c=(0===l?2*Math.random()*Math.PI:Math.tan((u[l][1]-u[l-1][1])/(u[l][0]-u[l-1][0])))+(Math.random()-.5)*o*2,h=Math.random()*i;u.push([u[l][0]+h*Math.cos(c),u[l][1]+h*Math.sin(c)])}a.push(QN(u))}return JN(a)}function ZV(t){return function(e){return[e[0]+t[0],e[1]+t[1]]}}function JV(){return Math.random()-.5}var $V=Object.freeze({randomPosition:XV,randomPoint:jV,randomPolygon:KV,randomLineString:QV});function ek(e,t){if(!e)throw new Error("geojson is required");if("FeatureCollection"!==e.type)throw new Error("geojson must be a FeatureCollection");if(null==t)throw new Error("filter is required");var n=[];return bR(e,function(e){ik(e.properties,t)&&n.push(e)}),JN(n)}function tk(e,t,n){if(!e)throw new Error("geojson is required");if("FeatureCollection"!==e.type)throw new Error("geojson must be a FeatureCollection");if(null==t)throw new Error("property is required");for(var r=rk(e,t),i=Object.keys(r),o=0;o<i.length;o++){for(var a=i[o],s=r[a],u=[],l=0;l<s.length;l++)u.push(e.features[s[l]]);n(JN(u),a,o)}}function nk(e,t,r,i){var o=i;return tk(e,t,function(e,t,n){o=0===n&&void 0===i?e:r(o,e,t,n)}),o}function rk(e,i){var o={};return bR(e,function(e,t){var n,r=e.properties||{};r.hasOwnProperty(i)&&(n=r[i],o.hasOwnProperty(n)?o[n].push(t):o[n]=[t])}),o}function ik(e,t){if(void 0===e)return!1;var n=typeof t;if("number"==n||"string"==n)return e.hasOwnProperty(t);if(Array.isArray(t)){for(var r=0;r<t.length;r++)if(!ik(e,t[r]))return!1;return!0}return ok(e,t)}function ok(e,t){for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r];if(e[i]!==t[i])return!1}return!0}function ak(e,t){if(!t)return{};if(!t.length)return{};for(var n={},r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(n[i]=e[i])}return n}var sk=Object.freeze({getCluster:ek,clusterEach:tk,clusterReduce:nk,createBins:rk,applyFilter:ik,propertiesContainsFilter:ok,filterProperties:ak});"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e,t,n){if(null==this)throw new TypeError(this+" is not an object");for(var r=Object(this),i=Math.max(Math.min(r.length,9007199254740991),0)||0,o=((o=1 in arguments&&parseInt(Number(t),10)||0)<0?Math.max(i+o,0):Math.min(o,i)),a=((a=2 in arguments&&void 0!==n?parseInt(Number(n),10)||0:i)<0?Math.max(i+n,0):Math.min(a,i));o<a;)r[o]=e,++o;return r},writable:!0}),Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(e){return e!=e},Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function uk(){}uk.prototype.interfaces_=function(){return[]},uk.prototype.getClass=function(){return uk},uk.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};function lk(){}function ck(){}var hk={MAX_VALUE:{configurable:!0}};ck.isNaN=function(e){return Number.isNaN(e)},ck.doubleToLongBits=function(e){return e},ck.longBitsToDouble=function(e){return e},ck.isInfinite=function(e){return!Number.isFinite(e)},hk.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(ck,hk);function fk(){}function pk(){}function dk(){}function mk(){}function _k(){var e;this.x=null,this.y=null,this.z=null,0===arguments.length?(this.x=0,this.y=0,this.z=_k.NULL_ORDINATE):1===arguments.length?(e=arguments[0],this.x=e.x,this.y=e.y,this.z=e.z):2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=_k.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])}var gk={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};_k.prototype.setOrdinate=function(e,t){switch(e){case _k.X:this.x=t;break;case _k.Y:this.y=t;break;case _k.Z:this.z=t;break;default:throw new lk}},_k.prototype.equals2D=function(e,t){if(1===arguments.length)return this.x===e.x&&this.y===e.y;if(2===arguments.length){var n=e,r=t;return uk.equalsWithTolerance(this.x,n.x,r)?!!uk.equalsWithTolerance(this.y,n.y,r):!1}},_k.prototype.getOrdinate=function(e){switch(e){case _k.X:return this.x;case _k.Y:return this.y;case _k.Z:return this.z}throw new lk},_k.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||ck.isNaN(this.z))&&ck.isNaN(e.z)},_k.prototype.equals=function(e){return e instanceof _k&&this.equals2D(e)},_k.prototype.equalInZ=function(e,t){return uk.equalsWithTolerance(this.z,e.z,t)},_k.prototype.compareTo=function(e){return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},_k.prototype.clone=function(){},_k.prototype.copy=function(){return new _k(this)},_k.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},_k.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)},_k.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},_k.prototype.hashCode=function(){var e=17;return e=37*(e=37*e+_k.hashCode(this.x))+_k.hashCode(this.y)},_k.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z},_k.prototype.interfaces_=function(){return[fk,pk,mk]},_k.prototype.getClass=function(){return _k},_k.hashCode=function(e){if(1===arguments.length){var t=ck.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}},gk.DimensionalComparator.get=function(){return yk},gk.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},gk.NULL_ORDINATE.get=function(){return ck.NaN},gk.X.get=function(){return 0},gk.Y.get=function(){return 1},gk.Z.get=function(){return 2},Object.defineProperties(_k,gk);var yk=function(e){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){if(2!==e&&3!==e)throw new lk;this._dimensionsToTest=e}};yk.prototype.compare=function(e,t){var n=e,r=t,i=yk.compare(n.x,r.x);if(0!==i)return i;var o=yk.compare(n.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:yk.compare(n.z,r.z)},yk.prototype.interfaces_=function(){return[dk]},yk.prototype.getClass=function(){return yk},yk.compare=function(e,t){return e<t?-1:t<e?1:ck.isNaN(e)?ck.isNaN(t)?0:-1:ck.isNaN(t)?1:0};function vk(){}vk.prototype.create=function(){},vk.prototype.interfaces_=function(){return[]},vk.prototype.getClass=function(){return vk};function xk(){}var bk={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};xk.prototype.interfaces_=function(){return[]},xk.prototype.getClass=function(){return xk},xk.toLocationSymbol=function(e){switch(e){case xk.EXTERIOR:return"e";case xk.BOUNDARY:return"b";case xk.INTERIOR:return"i";case xk.NONE:return"-"}throw new lk},bk.INTERIOR.get=function(){return 0},bk.BOUNDARY.get=function(){return 1},bk.EXTERIOR.get=function(){return 2},bk.NONE.get=function(){return-1},Object.defineProperties(xk,bk);function Ek(e,t){return e.interfaces_&&-1<e.interfaces_().indexOf(t)}function Tk(){}var Sk={LOG_10:{configurable:!0}};Tk.prototype.interfaces_=function(){return[]},Tk.prototype.getClass=function(){return Tk},Tk.log10=function(e){var t=Math.log(e);return ck.isInfinite(t)||ck.isNaN(t)?t:t/Tk.LOG_10},Tk.min=function(e,t,n,r){var i=e;return t<i&&(i=t),n<i&&(i=n),r<i&&(i=r),i},Tk.clamp=function(e,t,n){return"number"==typeof n&&"number"==typeof e&&"number"==typeof t||Number.isInteger(n)&&Number.isInteger(e)&&Number.isInteger(t)?e<t?t:n<e?n:e:void 0},Tk.wrap=function(e,t){return e<0?t- -e%t:e%t},Tk.max=function(){if(3===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[0];return n<e&&(n=e),n<t&&(n=t),n}if(4===arguments.length){var r=arguments[1],i=arguments[2],o=arguments[3],a=arguments[0];return a<r&&(a=r),a<i&&(a=i),a<o&&(a=o),a}},Tk.average=function(e,t){return(e+t)/2},Sk.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Tk,Sk);function Ck(e){this.str=e}Ck.prototype.append=function(e){this.str+=e},Ck.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)},Ck.prototype.toString=function(){return this.str};function wk(e){this.value=e}wk.prototype.intValue=function(){return this.value},wk.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0},wk.isNaN=function(e){return Number.isNaN(e)};function Ak(){}Ak.isWhitespace=function(e){return e<=32&&0<=e||127===e},Ak.toUpperCase=function(e){return e.toUpperCase()};function Ik(){var e,t,n,r;this._hi=0,(this._lo=0)===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]?(e=arguments[0],this.init(e)):arguments[0]instanceof Ik?(t=arguments[0],this.init(t)):"string"==typeof arguments[0]&&Ik.call(this,Ik.parse(arguments[0])):2===arguments.length&&(n=arguments[0],r=arguments[1],this.init(n,r))}var Pk={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ik.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo},Ik.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),r=Ik.magnitude(n._hi),i=Ik.TEN.pow(r);(n=n.divide(i)).gt(Ik.TEN)?(n=n.divide(Ik.TEN),r+=1):n.lt(Ik.ONE)&&(n=n.multiply(Ik.TEN),--r);for(var o=r+1,a=new Ck,s=Ik.MAX_PRINT_DIGITS-1,u=0;u<=s;u++){e&&u===o&&a.append(".");var l=Math.trunc(n._hi);if(l<0)break;var c=!1,h=0,h=9<l?(c=!0,"9"):"0"+l;a.append(h),n=n.subtract(Ik.valueOf(l)).multiply(Ik.TEN),c&&n.selfAdd(Ik.TEN);var f=!0,p=Ik.magnitude(n._hi);if(p<0&&Math.abs(p)>=s-u&&(f=!1),!f)break}return t[0]=r,a.toString()},Ik.prototype.sqr=function(){return this.multiply(this)},Ik.prototype.doubleValue=function(){return this._hi+this._lo},Ik.prototype.subtract=function(e){return e instanceof Ik?this.add(e.negate()):"number"==typeof e?this.add(-e):void 0},Ik.prototype.equals=function(e){if(1===arguments.length)return this._hi===e._hi&&this._lo===e._lo},Ik.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Ik.prototype.selfSubtract=function(e){if(e instanceof Ik){var t=e;return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof e){var n=e;return this.isNaN()?this:this.selfAdd(-n,0)}},Ik.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Ik.prototype.min=function(e){return this.le(e)?this:e},Ik.prototype.selfDivide=function(e,t){if(1===arguments.length){if(e instanceof Ik)return this.selfDivide(e._hi,e._lo);if("number"==typeof e)return this.selfDivide(e,0)}else if(2===arguments.length){var n,r,i,o=null,a=null,s=null,u=null,l=this._hi/e;return u=(o=(s=Ik.SPLIT*l)-(o=s-l))*(a=(u=Ik.SPLIT*e)-(a=u-e))-(i=l*e)+o*(r=e-a)+(n=l-o)*a+n*r,u=l+(s=(this._hi-i-u+this._lo-l*t)/e),this._hi=u,this._lo=l-u+s,this}},Ik.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Ik.prototype.divide=function(e){if(e instanceof Ik){var t,n,r,i=null,o=null,a=null,s=null,u=(r=this._hi/e._hi)-(i=(a=Ik.SPLIT*r)-(i=a-r));return s=i*(o=(s=Ik.SPLIT*e._hi)-(o=s-e._hi))-(n=r*e._hi)+i*(t=e._hi-o)+u*o+u*t,a=(this._hi-n-s+this._lo-r*e._lo)/e._hi,new Ik(s=r+a,r-s+a)}if("number"==typeof e){var l=e;return ck.isNaN(l)?Ik.createNaN():Ik.copy(this).selfDivide(l,0)}},Ik.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo},Ik.prototype.pow=function(e){if(0===e)return Ik.valueOf(1);var t=new Ik(this),n=Ik.valueOf(1),r=Math.abs(e);if(1<r)for(;0<r;)r%2==1&&n.selfMultiply(t),0<(r/=2)&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n},Ik.prototype.ceil=function(){if(this.isNaN())return Ik.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new Ik(e,t)},Ik.prototype.compareTo=function(e){return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},Ik.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Ik.prototype.setValue=function(e){return e instanceof Ik||"number"==typeof e?(this.init(e),this):void 0},Ik.prototype.max=function(e){return this.ge(e)?this:e},Ik.prototype.sqrt=function(){if(this.isZero())return Ik.valueOf(0);if(this.isNegative())return Ik.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=Ik.valueOf(t),r=this.subtract(n.sqr())._hi*(.5*e);return n.add(r)},Ik.prototype.selfAdd=function(e,t){if(1===arguments.length){if(e instanceof Ik)return this.selfAdd(e._hi,e._lo);if("number"==typeof e){var n,r,i,o,a=null,a=(i=this._hi+e)-(o=i-this._hi),s=(r=(a=e-o+(this._hi-a))+this._lo)+(i-(n=i+r));return this._hi=n+s,this._lo=s+(n-this._hi),this}}else if(2===arguments.length){var u,l,c=null,h=null,f=null,p=this._hi+e,d=this._lo+t,h=p-(f=p-this._hi),c=d-(l=d-this._lo),m=(u=p+(f=(h=e-f+(this._hi-h))+d))+(f=(c=t-l+(this._lo-c))+(f+(p-u))),_=f+(u-m);return this._hi=m,this._lo=_,this}},Ik.prototype.selfMultiply=function(e,t){if(1===arguments.length){if(e instanceof Ik)return this.selfMultiply(e._hi,e._lo);if("number"==typeof e)return this.selfMultiply(e,0)}else if(2===arguments.length){var n,r,i=null,o=null,a=null,s=null,i=(a=Ik.SPLIT*this._hi)-this._hi,s=Ik.SPLIT*e;i=a-i,n=this._hi-i,o=s-e;var u=(a=this._hi*e)+(s=i*(o=s-o)-a+i*(r=e-o)+n*o+n*r+(this._hi*t+this._lo*e)),l=s+(i=a-u);return this._hi=u,this._lo=l,this}},Ik.prototype.selfSqr=function(){return this.selfMultiply(this)},Ik.prototype.floor=function(){if(this.isNaN())return Ik.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new Ik(e,t)},Ik.prototype.negate=function(){return this.isNaN()?this:new Ik(-this._hi,-this._lo)},Ik.prototype.clone=function(){},Ik.prototype.multiply=function(e){if(e instanceof Ik){var t=e;return t.isNaN()?Ik.createNaN():Ik.copy(this).selfMultiply(t)}if("number"==typeof e){var n=e;return ck.isNaN(n)?Ik.createNaN():Ik.copy(this).selfMultiply(n,0)}},Ik.prototype.isNaN=function(){return ck.isNaN(this._hi)},Ik.prototype.intValue=function(){return Math.trunc(this._hi)},Ik.prototype.toString=function(){var e=Ik.magnitude(this._hi);return-3<=e&&e<=20?this.toStandardNotation():this.toSciNotation()},Ik.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(null!==e)return e;var t,n=new Array(1).fill(null),r=this.extractSignificantDigits(!0,n),i=n[0]+1,o=r;return"."===r.charAt(0)?o="0"+r:i<0?o="0."+Ik.stringOfChar("0",-i)+r:-1===r.indexOf(".")&&(t=i-r.length,o=r+Ik.stringOfChar("0",t)+".0"),this.isNegative()?"-"+o:o},Ik.prototype.reciprocal=function(){var e,t,n,r=null,i=null,o=null,a=null,s=(n=1/this._hi)-(r=(o=Ik.SPLIT*n)-(r=o-n)),i=(a=Ik.SPLIT*this._hi)-this._hi,u=n+(o=(1-(t=n*this._hi)-(a=r*(i=a-i)-t+r*(e=this._hi-i)+s*i+s*e)-n*this._lo)/this._hi);return new Ik(u,n-u+o)},Ik.prototype.toSciNotation=function(){if(this.isZero())return Ik.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(null!==e)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),r=Ik.SCI_NOT_EXPONENT_CHAR+t[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var i="";1<n.length&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r},Ik.prototype.abs=function(){return this.isNaN()?Ik.NaN:this.isNegative()?this.negate():new Ik(this)},Ik.prototype.isPositive=function(){return(0<this._hi||0===this._hi)&&0<this._lo},Ik.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo},Ik.prototype.add=function(e){if(e instanceof Ik){var t=e;return Ik.copy(this).selfAdd(t)}if("number"==typeof e){var n=e;return Ik.copy(this).selfAdd(n)}},Ik.prototype.init=function(e,t){var n,r;1===arguments.length?"number"==typeof e?(this._hi=e,this._lo=0):e instanceof Ik&&(n=e,this._hi=n._hi,this._lo=n._lo):2===arguments.length&&(r=t,this._hi=e,this._lo=r)},Ik.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo},Ik.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Ik.prototype.trunc=function(){return this.isNaN()?Ik.NaN:this.isPositive()?this.floor():this.ceil()},Ik.prototype.signum=function(){return 0<this._hi?1:this._hi<0?-1:0<this._lo?1:this._lo<0?-1:0},Ik.prototype.interfaces_=function(){return[mk,fk,pk]},Ik.prototype.getClass=function(){return Ik},Ik.sqr=function(e){return Ik.valueOf(e).selfMultiply(e)},Ik.valueOf=function(e){return"string"==typeof e?Ik.parse(e):"number"==typeof e?new Ik(e):void 0},Ik.sqrt=function(e){return Ik.valueOf(e).sqrt()},Ik.parse=function(t){for(var e=0,n=t.length;Ak.isWhitespace(t.charAt(e));)e++;var r,i=!1;e<n&&("-"!==(r=t.charAt(e))&&"+"!==r||(e++,"-"===r&&(i=!0)));for(var o=new Ik,a=0,s=0,u=0;!(n<=e);){var l=t.charAt(e);if(e++,Ak.isDigit(l)){var c=l-"0";o.selfMultiply(Ik.TEN),o.selfAdd(c),a++}else{if("."!==l){if("e"!==l&&"E"!==l)throw new Error("Unexpected character '"+l+"' at position "+e+" in string "+t);var h=t.substring(e);try{u=wk.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}s=a}}var f,p,d=o,m=a-s-u;return 0==m?d=o:0<m?(f=Ik.TEN.pow(m),d=o.divide(f)):m<0&&(p=Ik.TEN.pow(-m),d=o.multiply(p)),i?d.negate():d},Ik.createNaN=function(){return new Ik(ck.NaN,ck.NaN)},Ik.copy=function(e){return new Ik(e)},Ik.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=t&&(r+=1),r},Ik.stringOfChar=function(e,t){for(var n=new Ck,r=0;r<t;r++)n.append(e);return n.toString()},Pk.PI.get=function(){return new Ik(3.141592653589793,12246467991473532e-32)},Pk.TWO_PI.get=function(){return new Ik(6.283185307179586,24492935982947064e-32)},Pk.PI_2.get=function(){return new Ik(1.5707963267948966,6123233995736766e-32)},Pk.E.get=function(){return new Ik(2.718281828459045,14456468917292502e-32)},Pk.NaN.get=function(){return new Ik(ck.NaN,ck.NaN)},Pk.EPS.get=function(){return 123259516440783e-46},Pk.SPLIT.get=function(){return 134217729},Pk.MAX_PRINT_DIGITS.get=function(){return 32},Pk.TEN.get=function(){return Ik.valueOf(10)},Pk.ONE.get=function(){return Ik.valueOf(1)},Pk.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Pk.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Ik,Pk);function Ok(){}var Lk={DP_SAFE_EPSILON:{configurable:!0}};Ok.prototype.interfaces_=function(){return[]},Ok.prototype.getClass=function(){return Ok},Ok.orientationIndex=function(e,t,n){var r=Ok.orientationIndexFilter(e,t,n);if(r<=1)return r;var i=Ik.valueOf(t.x).selfAdd(-e.x),o=Ik.valueOf(t.y).selfAdd(-e.y),a=Ik.valueOf(n.x).selfAdd(-t.x),s=Ik.valueOf(n.y).selfAdd(-t.y);return i.selfMultiply(s).selfSubtract(o.selfMultiply(a)).signum()},Ok.signOfDet2x2=function(e,t,n,r){return e.multiply(r).selfSubtract(t.multiply(n)).signum()},Ok.intersection=function(e,t,n,r){var i=Ik.valueOf(r.y).selfSubtract(n.y).selfMultiply(Ik.valueOf(t.x).selfSubtract(e.x)),o=Ik.valueOf(r.x).selfSubtract(n.x).selfMultiply(Ik.valueOf(t.y).selfSubtract(e.y)),a=i.subtract(o),s=Ik.valueOf(r.x).selfSubtract(n.x).selfMultiply(Ik.valueOf(e.y).selfSubtract(n.y)),u=Ik.valueOf(r.y).selfSubtract(n.y).selfMultiply(Ik.valueOf(e.x).selfSubtract(n.x)),l=s.subtract(u).selfDivide(a).doubleValue(),c=Ik.valueOf(e.x).selfAdd(Ik.valueOf(t.x).selfSubtract(e.x).selfMultiply(l)).doubleValue(),h=Ik.valueOf(t.x).selfSubtract(e.x).selfMultiply(Ik.valueOf(e.y).selfSubtract(n.y)),f=Ik.valueOf(t.y).selfSubtract(e.y).selfMultiply(Ik.valueOf(e.x).selfSubtract(n.x)),p=h.subtract(f).selfDivide(a).doubleValue(),d=Ik.valueOf(n.y).selfAdd(Ik.valueOf(r.y).selfSubtract(n.y).selfMultiply(p)).doubleValue();return new _k(c,d)},Ok.orientationIndexFilter=function(e,t,n){var r=null,i=(e.x-n.x)*(t.y-n.y),o=(e.y-n.y)*(t.x-n.x),a=i-o;if(0<i){if(o<=0)return Ok.signum(a);r=i+o}else{if(!(i<0))return Ok.signum(a);if(0<=o)return Ok.signum(a);r=-i-o}var s=Ok.DP_SAFE_EPSILON*r;return s<=a||s<=-a?Ok.signum(a):2},Ok.signum=function(e){return 0<e?1:e<0?-1:0},Lk.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Ok,Lk);function Nk(){}var Rk={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Rk.X.get=function(){return 0},Rk.Y.get=function(){return 1},Rk.Z.get=function(){return 2},Rk.M.get=function(){return 3},Nk.prototype.setOrdinate=function(){},Nk.prototype.size=function(){},Nk.prototype.getOrdinate=function(){},Nk.prototype.getCoordinate=function(){},Nk.prototype.getCoordinateCopy=function(){},Nk.prototype.getDimension=function(){},Nk.prototype.getX=function(){},Nk.prototype.clone=function(){},Nk.prototype.expandEnvelope=function(){},Nk.prototype.copy=function(){},Nk.prototype.getY=function(){},Nk.prototype.toCoordinateArray=function(){},Nk.prototype.interfaces_=function(){return[pk]},Nk.prototype.getClass=function(){return Nk},Object.defineProperties(Nk,Rk);function Dk(){}var Mk,Fk=((Mk=Dk)&&(zk.__proto__=Mk),((zk.prototype=Object.create(Mk&&Mk.prototype)).constructor=zk).prototype.interfaces_=function(){return[]},zk.prototype.getClass=function(){return zk},zk);function zk(){Mk.call(this,"Projective point not representable on the Cartesian plane.")}function Bk(){}Bk.arraycopy=function(e,t,n,r,i){for(var o=0,a=t;a<t+i;a++)n[r+o]=e[a],o++},Bk.getProperty=function(e){return{"line.separator":"\n"}[e]};function Uk(){var e,t,n,r,i,o,a,s,u,l,c,h,f,p,d,m,_,g,y,v;this.x=null,this.y=null,this.w=null,0===arguments.length?(this.x=0,this.y=0,this.w=1):1===arguments.length?(e=arguments[0],this.x=e.x,this.y=e.y,this.w=1):2===arguments.length?"number"==typeof arguments[0]&&"number"==typeof arguments[1]?(t=arguments[0],n=arguments[1],this.x=t,this.y=n,this.w=1):arguments[0]instanceof Uk&&arguments[1]instanceof Uk?(r=arguments[0],i=arguments[1],this.x=r.y*i.w-i.y*r.w,this.y=i.x*r.w-r.x*i.w,this.w=r.x*i.y-i.x*r.y):arguments[0]instanceof _k&&arguments[1]instanceof _k&&(o=arguments[0],a=arguments[1],this.x=o.y-a.y,this.y=a.x-o.x,this.w=o.x*a.y-a.x*o.y):3===arguments.length?(s=arguments[0],u=arguments[1],l=arguments[2],this.x=s,this.y=u,this.w=l):4===arguments.length&&(h=arguments[1],f=arguments[2],p=arguments[3],d=(c=arguments[0]).y-h.y,m=h.x-c.x,_=c.x*h.y-h.x*c.y,g=f.y-p.y,y=p.x-f.x,v=f.x*p.y-p.x*f.y,this.x=m*v-y*_,this.y=g*_-d*v,this.w=d*y-g*m)}Uk.prototype.getY=function(){var e=this.y/this.w;if(ck.isNaN(e)||ck.isInfinite(e))throw new Fk;return e},Uk.prototype.getX=function(){var e=this.x/this.w;if(ck.isNaN(e)||ck.isInfinite(e))throw new Fk;return e},Uk.prototype.getCoordinate=function(){var e=new _k;return e.x=this.getX(),e.y=this.getY(),e},Uk.prototype.interfaces_=function(){return[]},Uk.prototype.getClass=function(){return Uk},Uk.intersection=function(e,t,n,r){var i=e.y-t.y,o=t.x-e.x,a=e.x*t.y-t.x*e.y,s=n.y-r.y,u=r.x-n.x,l=n.x*r.y-r.x*n.y,c=i*u-s*o,h=(o*l-u*a)/c,f=(s*a-i*l)/c;if(ck.isNaN(h)||ck.isInfinite(h)||ck.isNaN(f)||ck.isInfinite(f))throw new Fk;return new _k(h,f)};function Vk(){var e,t,n,r,i,o,a,s;this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length?this.init():1===arguments.length?arguments[0]instanceof _k?(e=arguments[0],this.init(e.x,e.x,e.y,e.y)):arguments[0]instanceof Vk&&(t=arguments[0],this.init(t)):2===arguments.length?(n=arguments[0],r=arguments[1],this.init(n.x,r.x,n.y,r.y)):4===arguments.length&&(i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],this.init(i,o,a,s))}var kk={serialVersionUID:{configurable:!0}};Vk.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Vk.prototype.equals=function(e){if(!(e instanceof Vk))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()},Vk.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new Vk;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,r=this._maxx<e._maxx?this._maxx:e._maxx,i=this._maxy<e._maxy?this._maxy:e._maxy;return new Vk(t,r,n,i)},Vk.prototype.isNull=function(){return this._maxx<this._minx},Vk.prototype.getMaxX=function(){return this._maxx},Vk.prototype.covers=function(e,t){if(1===arguments.length){if(e instanceof _k)return this.covers(e.x,e.y);if(e instanceof Vk){var n=e;return this.isNull()||n.isNull()?!1:n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(2===arguments.length){var r=e,i=t;return this.isNull()?!1:r>=this._minx&&r<=this._maxx&&i>=this._miny&&i<=this._maxy}},Vk.prototype.intersects=function(e,t){if(1===arguments.length){if(e instanceof Vk){var n=e;return this.isNull()||n.isNull()?!1:!(n._minx>this._maxx||n._maxx<this._minx||n._miny>this._maxy||n._maxy<this._miny)}if(e instanceof _k)return this.intersects(e.x,e.y)}else if(2===arguments.length){var r=e,i=t;return this.isNull()?!1:!(r>this._maxx||r<this._minx||i>this._maxy||i<this._miny)}},Vk.prototype.getMinY=function(){return this._miny},Vk.prototype.getMinX=function(){return this._minx},Vk.prototype.expandToInclude=function(e,t){var n,r;if(1===arguments.length){if(e instanceof _k)this.expandToInclude(e.x,e.y);else if(e instanceof Vk){var i=e;if(i.isNull())return null;this.isNull()?(this._minx=i.getMinX(),this._maxx=i.getMaxX(),this._miny=i.getMinY(),this._maxy=i.getMaxY()):(i._minx<this._minx&&(this._minx=i._minx),i._maxx>this._maxx&&(this._maxx=i._maxx),i._miny<this._miny&&(this._miny=i._miny),i._maxy>this._maxy&&(this._maxy=i._maxy))}}else 2===arguments.length&&(n=e,r=t,this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r)))},Vk.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t},Vk.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},Vk.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0},Vk.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)},Vk.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},Vk.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},Vk.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},Vk.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return t<e?e:t},Vk.prototype.expandBy=function(e,t){if(1===arguments.length)this.expandBy(e,e);else if(2===arguments.length){var n=e,r=t;if(this.isNull())return null;this._minx-=n,this._maxx+=n,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},Vk.prototype.contains=function(e,t){if(1===arguments.length){if(e instanceof Vk)return this.covers(e);if(e instanceof _k)return this.covers(e)}else if(2===arguments.length){return this.covers(e,t)}},Vk.prototype.centre=function(){return this.isNull()?null:new _k((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Vk.prototype.init=function(e,t,n,r){var i,o,a,s,u;0===arguments.length?this.setToNull():1===arguments.length?e instanceof _k?this.init(e.x,e.x,e.y,e.y):e instanceof Vk&&(i=e,this._minx=i._minx,this._maxx=i._maxx,this._miny=i._miny,this._maxy=i._maxy):2===arguments.length?this.init(e.x,t.x,e.y,t.y):4===arguments.length&&(s=n,u=r,(o=e)<(a=t)?(this._minx=o,this._maxx=a):(this._minx=a,this._maxx=o),s<u?(this._miny=s,this._maxy=u):(this._miny=u,this._maxy=s))},Vk.prototype.getMaxY=function(){return this._maxy},Vk.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),0===t?n:0===n?t:Math.sqrt(t*t+n*n)},Vk.prototype.hashCode=function(){var e=17;return e=37*(e=37*(e=37*(e=37*e+_k.hashCode(this._minx))+_k.hashCode(this._maxx))+_k.hashCode(this._miny))+_k.hashCode(this._maxy)},Vk.prototype.interfaces_=function(){return[fk,mk]},Vk.prototype.getClass=function(){return Vk},Vk.intersects=function(e,t,n,r){if(3===arguments.length)return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y);if(4===arguments.length){var i=e,o=t,a=n,s=r,u=Math.min(a.x,s.x),l=Math.max(a.x,s.x),c=Math.min(i.x,o.x),h=Math.max(i.x,o.x);return l<c?!1:!(h<u)&&(u=Math.min(a.y,s.y),l=Math.max(a.y,s.y),c=Math.min(i.y,o.y),h=Math.max(i.y,o.y),!(l<c)&&!(h<u))}},kk.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Vk,kk);function Gk(e){this.geometryFactory=e||new Kq}var qk={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};Gk.prototype.read=function(e){var t,n,r;e=e.replace(/[\n\r]/g," ");var i=qk.typeStr.exec(e);if(-1!==e.search("EMPTY")&&((i=qk.emptyTypeStr.exec(e))[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],Yk[n]&&(t=Yk[n].apply(this,[r]))),void 0===t)throw new Error("Could not parse WKT "+e);return t},Gk.prototype.write=function(e){return this.extractGeometry(e)},Gk.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!Wk[t])return null;var n=t.toUpperCase(),r=e.isEmpty()?n+" EMPTY":n+"("+Wk[t].apply(this,[e])+")";return r};function Hk(e){this.parser=new Gk(e)}var Wk={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Wk.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push("("+Wk.point.apply(this,[e._geometries[n]])+")");return t.join(",")},linestring:function(e){for(var t=[],n=0,r=e._points._coordinates.length;n<r;++n)t.push(Wk.coordinate.apply(this,[e._points._coordinates[n]]));return t.join(",")},linearring:function(e){for(var t=[],n=0,r=e._points._coordinates.length;n<r;++n)t.push(Wk.coordinate.apply(this,[e._points._coordinates[n]]));return t.join(",")},multilinestring:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push("("+Wk.linestring.apply(this,[e._geometries[n]])+")");return t.join(",")},polygon:function(e){var t=[];t.push("("+Wk.linestring.apply(this,[e._shell])+")");for(var n=0,r=e._holes.length;n<r;++n)t.push("("+Wk.linestring.apply(this,[e._holes[n]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push("("+Wk.polygon.apply(this,[e._geometries[n]])+")");return t.join(",")},geometrycollection:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push(this.extractGeometry(e._geometries[n]));return t.join(",")}},Yk={point:function(e){if(void 0===e)return this.geometryFactory.createPoint();var t=e.trim().split(qk.spaces);return this.geometryFactory.createPoint(new _k(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t;if(void 0===e)return this.geometryFactory.createMultiPoint();for(var n=e.trim().split(","),r=[],i=0,o=n.length;i<o;++i)t=n[i].replace(qk.trimParens,"$1"),r.push(Yk.point.apply(this,[t]));return this.geometryFactory.createMultiPoint(r)},linestring:function(e){if(void 0===e)return this.geometryFactory.createLineString();for(var t,n=e.trim().split(","),r=[],i=0,o=n.length;i<o;++i)t=n[i].trim().split(qk.spaces),r.push(new _k(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(void 0===e)return this.geometryFactory.createLinearRing();for(var t,n=e.trim().split(","),r=[],i=0,o=n.length;i<o;++i)t=n[i].trim().split(qk.spaces),r.push(new _k(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){var t;if(void 0===e)return this.geometryFactory.createMultiLineString();for(var n=e.trim().split(qk.parenComma),r=[],i=0,o=n.length;i<o;++i)t=n[i].replace(qk.trimParens,"$1"),r.push(Yk.linestring.apply(this,[t]));return this.geometryFactory.createMultiLineString(r)},polygon:function(e){var t,n,r;if(void 0===e)return this.geometryFactory.createPolygon();for(var i,o=e.trim().split(qk.parenComma),a=[],s=0,u=o.length;s<u;++s)t=o[s].replace(qk.trimParens,"$1"),n=Yk.linestring.apply(this,[t]),r=this.geometryFactory.createLinearRing(n._points),0===s?i=r:a.push(r);return this.geometryFactory.createPolygon(i,a)},multipolygon:function(e){var t;if(void 0===e)return this.geometryFactory.createMultiPolygon();for(var n=e.trim().split(qk.doubleParenComma),r=[],i=0,o=n.length;i<o;++i)t=n[i].replace(qk.trimParens,"$1"),r.push(Yk.polygon.apply(this,[t]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(e){if(void 0===e)return this.geometryFactory.createGeometryCollection();for(var t=(e=e.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],r=0,i=t.length;r<i;++r)n.push(this.read(t[r]));return this.geometryFactory.createGeometryCollection(n)}};Hk.prototype.write=function(e){return this.parser.write(e)},Hk.toLineString=function(e,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var Xk,jk=((Xk=Error)&&(Kk.__proto__=Xk),(Kk.prototype=Object.create(Xk&&Xk.prototype)).constructor=Kk);function Kk(e){Xk.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new Xk).stack}var Qk,Zk=((Qk=jk)&&(Jk.__proto__=Qk),((Jk.prototype=Object.create(Qk&&Qk.prototype)).constructor=Jk).prototype.interfaces_=function(){return[]},Jk.prototype.getClass=function(){return Jk},Jk);function Jk(){var e;Qk.call(this),0===arguments.length?Qk.call(this):1===arguments.length&&(e=arguments[0],Qk.call(this,e))}function $k(){}$k.prototype.interfaces_=function(){return[]},$k.prototype.getClass=function(){return $k},$k.shouldNeverReachHere=function(e){if(0===arguments.length)$k.shouldNeverReachHere(null);else if(1===arguments.length){throw new Zk("Should never reach here"+(null!==e?": "+e:""))}},$k.isTrue=function(e,t){var n;if(1===arguments.length)$k.isTrue(e,null);else if(2===arguments.length&&(n=t,!e))throw null===n?new Zk:new Zk(n)},$k.equals=function(e,t,n){var r,i,o;if(2===arguments.length)$k.equals(r=e,i=t,null);else if(3===arguments.length&&(r=e,o=n,!(i=t).equals(r)))throw new Zk("Expected "+r+" but encountered "+i+(null!==o?": "+o:""))};function eG(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new _k,this._intPt[1]=new _k,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}var tG={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};eG.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]},eG.prototype.getTopologySummary=function(){var e=new Ck;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()},eG.prototype.computeIntersection=function(e,t,n,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,n,r)},eG.prototype.getIntersectionNum=function(){return this._result},eG.prototype.computeIntLineIndex=function(e){var t,n;0===arguments.length?null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1)):1===arguments.length&&(t=e,n=this.getEdgeDistance(t,0),this.getEdgeDistance(t,1)<n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0))},eG.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},eG.prototype.setPrecisionModel=function(e){this._precisionModel=e},eG.prototype.isInteriorIntersection=function(e){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=e,n=0;n<this._result;n++)if(!this._intPt[n].equals2D(this._inputLines[t][0])&&!this._intPt[n].equals2D(this._inputLines[t][1]))return!0;return!1}},eG.prototype.getIntersection=function(e){return this._intPt[e]},eG.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},eG.prototype.hasIntersection=function(){return this._result!==eG.NO_INTERSECTION},eG.prototype.getEdgeDistance=function(e,t){return eG.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1])},eG.prototype.isCollinear=function(){return this._result===eG.COLLINEAR_INTERSECTION},eG.prototype.toString=function(){return Hk.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Hk.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},eG.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]},eG.prototype.isIntersection=function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1},eG.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]},eG.prototype.interfaces_=function(){return[]},eG.prototype.getClass=function(){return eG},eG.computeEdgeDistance=function(e,t,n){var r,i,o=Math.abs(n.x-t.x),a=Math.abs(n.y-t.y),s=-1;return e.equals(t)?s=0:e.equals(n)?s=a<o?o:a:(r=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y),0!==(s=a<o?r:i)||e.equals(t)||(s=Math.max(r,i))),$k.isTrue(!(0===s&&!e.equals(t)),"Bad distance calculation"),s},eG.nonRobustComputeEdgeDistance=function(e,t){var n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);return $k.isTrue(!(0===i&&!e.equals(t)),"Invalid distance calculation"),i},tG.DONT_INTERSECT.get=function(){return 0},tG.DO_INTERSECT.get=function(){return 1},tG.COLLINEAR.get=function(){return 2},tG.NO_INTERSECTION.get=function(){return 0},tG.POINT_INTERSECTION.get=function(){return 1},tG.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(eG,tG);var nG,rG=((nG=eG)&&(iG.__proto__=nG),((iG.prototype=Object.create(nG&&nG.prototype)).constructor=iG).prototype.isInSegmentEnvelopes=function(e){var t=new Vk(this._inputLines[0][0],this._inputLines[0][1]),n=new Vk(this._inputLines[1][0],this._inputLines[1][1]);return t.contains(e)&&n.contains(e)},iG.prototype.computeIntersection=function(e,t,n){if(3!==arguments.length)return nG.prototype.computeIntersection.apply(this,arguments);var r=e,i=t,o=n;if(this._isProper=!1,Vk.intersects(i,o,r)&&0===sG.orientationIndex(i,o,r)&&0===sG.orientationIndex(o,i,r))return this._isProper=!0,(r.equals(i)||r.equals(o))&&(this._isProper=!1),this._result=nG.POINT_INTERSECTION,null;this._result=nG.NO_INTERSECTION},iG.prototype.normalizeToMinimum=function(e,t,n,r,i){i.x=this.smallestInAbsValue(e.x,t.x,n.x,r.x),i.y=this.smallestInAbsValue(e.y,t.y,n.y,r.y),e.x-=i.x,e.y-=i.y,t.x-=i.x,t.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},iG.prototype.safeHCoordinateIntersection=function(t,n,r,i){var o=null;try{o=Uk.intersection(t,n,r,i)}catch(e){if(!(e instanceof Fk))throw e;o=iG.nearestEndpoint(t,n,r,i)}return o},iG.prototype.intersection=function(e,t,n,r){var i=this.intersectionWithNormalization(e,t,n,r);return this.isInSegmentEnvelopes(i)||(i=new _k(iG.nearestEndpoint(e,t,n,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(i),i},iG.prototype.smallestInAbsValue=function(e,t,n,r){var i=e,o=Math.abs(i);return Math.abs(t)<o&&(i=t,o=Math.abs(t)),Math.abs(n)<o&&(i=n,o=Math.abs(n)),Math.abs(r)<o&&(i=r),i},iG.prototype.checkDD=function(e,t,n,r,i){var o=Ok.intersection(e,t,n,r),a=this.isInSegmentEnvelopes(o);Bk.out.println("DD in env = "+a+"  --------------------- "+o),1e-4<i.distance(o)&&Bk.out.println("Distance = "+i.distance(o))},iG.prototype.intersectionWithNormalization=function(e,t,n,r){var i=new _k(e),o=new _k(t),a=new _k(n),s=new _k(r),u=new _k;this.normalizeToEnvCentre(i,o,a,s,u);var l=this.safeHCoordinateIntersection(i,o,a,s);return l.x+=u.x,l.y+=u.y,l},iG.prototype.computeCollinearIntersection=function(e,t,n,r){var i=Vk.intersects(e,t,n),o=Vk.intersects(e,t,r),a=Vk.intersects(n,r,e),s=Vk.intersects(n,r,t);return i&&o?(this._intPt[0]=n,this._intPt[1]=r,nG.COLLINEAR_INTERSECTION):a&&s?(this._intPt[0]=e,this._intPt[1]=t,nG.COLLINEAR_INTERSECTION):i&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||o||s?nG.COLLINEAR_INTERSECTION:nG.POINT_INTERSECTION):i&&s?(this._intPt[0]=n,this._intPt[1]=t,!n.equals(t)||o||a?nG.COLLINEAR_INTERSECTION:nG.POINT_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||i||s?nG.COLLINEAR_INTERSECTION:nG.POINT_INTERSECTION):o&&s?(this._intPt[0]=r,this._intPt[1]=t,!r.equals(t)||i||a?nG.COLLINEAR_INTERSECTION:nG.POINT_INTERSECTION):nG.NO_INTERSECTION},iG.prototype.normalizeToEnvCentre=function(e,t,n,r,i){var o=e.x<t.x?e.x:t.x,a=e.y<t.y?e.y:t.y,s=e.x>t.x?e.x:t.x,u=e.y>t.y?e.y:t.y,l=n.x<r.x?n.x:r.x,c=n.y<r.y?n.y:r.y,h=n.x>r.x?n.x:r.x,f=n.y>r.y?n.y:r.y,p=((l<o?o:l)+(s<h?s:h))/2,d=((c<a?a:c)+(u<f?u:f))/2;i.x=p,i.y=d,e.x-=i.x,e.y-=i.y,t.x-=i.x,t.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},iG.prototype.computeIntersect=function(e,t,n,r){if(this._isProper=!1,!Vk.intersects(e,t,n,r))return nG.NO_INTERSECTION;var i=sG.orientationIndex(e,t,n),o=sG.orientationIndex(e,t,r);if(0<i&&0<o||i<0&&o<0)return nG.NO_INTERSECTION;var a=sG.orientationIndex(n,r,e),s=sG.orientationIndex(n,r,t);return 0<a&&0<s||a<0&&s<0?nG.NO_INTERSECTION:0===i&&0===o&&0===a&&0===s?this.computeCollinearIntersection(e,t,n,r):(0===i||0===o||0===a||0===s?(this._isProper=!1,e.equals2D(n)||e.equals2D(r)?this._intPt[0]=e:t.equals2D(n)||t.equals2D(r)?this._intPt[0]=t:0===i?this._intPt[0]=new _k(n):0===o?this._intPt[0]=new _k(r):0===a?this._intPt[0]=new _k(e):0===s&&(this._intPt[0]=new _k(t))):(this._isProper=!0,this._intPt[0]=this.intersection(e,t,n,r)),nG.POINT_INTERSECTION)},iG.prototype.interfaces_=function(){return[]},iG.prototype.getClass=function(){return iG},iG.nearestEndpoint=function(e,t,n,r){var i=e,o=sG.distancePointLine(e,n,r),a=sG.distancePointLine(t,n,r);return a<o&&(o=a,i=t),(a=sG.distancePointLine(n,e,t))<o&&(o=a,i=n),(a=sG.distancePointLine(r,e,t))<o&&(o=a,i=r),i},iG);function iG(){nG.apply(this,arguments)}function oG(){}oG.prototype.interfaces_=function(){return[]},oG.prototype.getClass=function(){return oG},oG.orientationIndex=function(e,t,n){var r=t.x-e.x,i=t.y-e.y,o=n.x-t.x,a=n.y-t.y;return oG.signOfDet2x2(r,i,o,a)},oG.signOfDet2x2=function(e,t,n,r){var i=null,o=null,a=null,i=1;if(0===e||0===r)return 0===t||0===n?0:0<t?0<n?-i:i:0<n?i:-i;if(0===t||0===n)return 0<r?0<e?i:-i:0<e?-i:i;if(0<t?0<r?t<=r||(i=-i,o=e,e=n,n=o,o=t,t=r,r=o):r=t<=-r?(i=-i,n=-n,-r):(o=e,e=-n,n=o,o=t,t=-r,o):0<r?-t<=r?(i=-i,e=-e,t=-t):(o=-e,e=n,n=o,o=-t,t=r,r=o):r=r<=t?(e=-e,t=-t,n=-n,-r):(i=-i,o=-e,e=-n,n=o,o=-t,t=-r,o),0<e){if(!(0<n))return i;if(!(e<=n))return i}else{if(0<n)return-i;if(!(n<=e))return-i;i=-i,e=-e,n=-n}for(;;){if((r-=(a=Math.floor(n/e))*t)<0)return-i;if(t<r)return i;if((n-=a*e)+n<e){if(t<r+r)return i}else{if(r+r<t)return-i;n=e-n,r=t-r,i=-i}if(0===r)return 0===n?0:-i;if(0===n)return i;if((t-=(a=Math.floor(e/n))*r)<0)return i;if(r<t)return-i;if((e-=a*n)+e<n){if(r<t+t)return-i}else{if(t+t<r)return i;e=n-e,t=r-t,i=-i}if(0===t)return 0===e?0:i;if(0===e)return-i}};function aG(e){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=e}aG.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,r=t.x;return r<n&&(n=t.x,r=e.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var i=e.x-this._p.x,o=e.y-this._p.y,a=t.x-this._p.x,s=t.y-this._p.y,u=oG.signOfDet2x2(i,o,a,s);if(0===u)return this._isPointOnSegment=!0,null;s<o&&(u=-u),0<u&&this._crossingCount++}},aG.prototype.isPointInPolygon=function(){return this.getLocation()!==xk.EXTERIOR},aG.prototype.getLocation=function(){return this._isPointOnSegment?xk.BOUNDARY:this._crossingCount%2==1?xk.INTERIOR:xk.EXTERIOR},aG.prototype.isOnSegment=function(){return this._isPointOnSegment},aG.prototype.interfaces_=function(){return[]},aG.prototype.getClass=function(){return aG},aG.locatePointInRing=function(e,t){if(e instanceof _k&&Ek(t,Nk)){for(var n=t,r=new aG(e),i=new _k,o=new _k,a=1;a<n.size();a++)if(n.getCoordinate(a,i),n.getCoordinate(a-1,o),r.countSegment(i,o),r.isOnSegment())return r.getLocation();return r.getLocation()}if(e instanceof _k&&t instanceof Array){for(var s=t,u=new aG(e),l=1;l<s.length;l++){var c=s[l],h=s[l-1];if(u.countSegment(c,h),u.isOnSegment())return u.getLocation()}return u.getLocation()}};var sG=function(){},uG={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};sG.prototype.interfaces_=function(){return[]},sG.prototype.getClass=function(){return sG},sG.orientationIndex=function(e,t,n){return Ok.orientationIndex(e,t,n)},sG.signedArea=function(e){if(e instanceof Array){var t=e;if(t.length<3)return 0;for(var n=0,r=t[0].x,i=1;i<t.length-1;i++){var o=t[i].x-r,a=t[i+1].y;n+=o*(t[i-1].y-a)}return n/2}if(Ek(e,Nk)){var s=e,u=s.size();if(u<3)return 0;var l=new _k,c=new _k,h=new _k;s.getCoordinate(0,c),s.getCoordinate(1,h);var f=c.x;h.x-=f;for(var p=0,d=1;d<u-1;d++)l.y=c.y,c.x=h.x,c.y=h.y,s.getCoordinate(d+1,h),h.x-=f,p+=c.x*(l.y-h.y);return p/2}},sG.distanceLineLine=function(e,t,n,r){if(e.equals(t))return sG.distancePointLine(e,n,r);if(n.equals(r))return sG.distancePointLine(r,e,t);var i,o,a,s,u=!1;return!Vk.intersects(e,t,n,r)||0==(i=(t.x-e.x)*(r.y-n.y)-(t.y-e.y)*(r.x-n.x))?u=!0:(o=(e.y-n.y)*(r.x-n.x)-(e.x-n.x)*(r.y-n.y),a=((e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y))/i,((s=o/i)<0||1<s||a<0||1<a)&&(u=!0)),u?Tk.min(sG.distancePointLine(e,n,r),sG.distancePointLine(t,n,r),sG.distancePointLine(n,e,t),sG.distancePointLine(r,e,t)):0},sG.isPointInRing=function(e,t){return sG.locatePointInRing(e,t)!==xk.EXTERIOR},sG.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,r=new _k;e.getCoordinate(0,r);for(var i=r.x,o=r.y,a=1;a<t;a++){e.getCoordinate(a,r);var s=r.x,u=r.y,l=s-i,c=u-o;n+=Math.sqrt(l*l+c*c),i=s,o=u}return n},sG.isCCW=function(e){var t=e.length-1;if(t<3)throw new lk;for(var n=e[0],r=0,i=1;i<=t;i++){var o=e[i];o.y>n.y&&(n=o,r=i)}for(var a=r;--a<0&&(a=t),e[a].equals2D(n)&&a!==r;);for(var s=r;e[s=(s+1)%t].equals2D(n)&&s!==r;);var u=e[a],l=e[s];if(u.equals2D(n)||l.equals2D(n)||u.equals2D(l))return!1;var c=sG.computeOrientation(u,n,l),h=!1;return h=0===c?u.x>l.x:0<c,h},sG.locatePointInRing=function(e,t){return aG.locatePointInRing(e,t)},sG.distancePointLinePerpendicular=function(e,t,n){var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),i=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(i)*Math.sqrt(r)},sG.computeOrientation=function(e,t,n){return sG.orientationIndex(e,t,n)},sG.distancePointLine=function(e,t,n){if(2===arguments.length){var r=e,i=t;if(0===i.length)throw new lk;for(var o=r.distance(i[0]),a=0;a<i.length-1;a++){var s=sG.distancePointLine(r,i[a],i[a+1]);s<o&&(o=s)}return o}if(3===arguments.length){var u=e,l=t,c=n;if(l.x===c.x&&l.y===c.y)return u.distance(l);var h=(c.x-l.x)*(c.x-l.x)+(c.y-l.y)*(c.y-l.y),f=((u.x-l.x)*(c.x-l.x)+(u.y-l.y)*(c.y-l.y))/h;if(f<=0)return u.distance(l);if(1<=f)return u.distance(c);var p=((l.y-u.y)*(c.x-l.x)-(l.x-u.x)*(c.y-l.y))/h;return Math.abs(p)*Math.sqrt(h)}},sG.isOnLine=function(e,t){for(var n=new rG,r=1;r<t.length;r++){var i=t[r-1],o=t[r];if(n.computeIntersection(e,i,o),n.hasIntersection())return!0}return!1},uG.CLOCKWISE.get=function(){return-1},uG.RIGHT.get=function(){return sG.CLOCKWISE},uG.COUNTERCLOCKWISE.get=function(){return 1},uG.LEFT.get=function(){return sG.COUNTERCLOCKWISE},uG.COLLINEAR.get=function(){return 0},uG.STRAIGHT.get=function(){return sG.COLLINEAR},Object.defineProperties(sG,uG);function lG(){}lG.prototype.filter=function(){},lG.prototype.interfaces_=function(){return[]},lG.prototype.getClass=function(){return lG};function cG(e){var t=e;this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()}var hG={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};cG.prototype.isGeometryCollection=function(){return this.getSortIndex()===cG.SORTINDEX_GEOMETRYCOLLECTION},cG.prototype.getFactory=function(){return this._factory},cG.prototype.getGeometryN=function(){return this},cG.prototype.getArea=function(){return 0},cG.prototype.isRectangle=function(){return!1},cG.prototype.equals=function(e){if(e instanceof cG)return null!==e&&this.equalsTopo(e);if(e instanceof Object){if(!(e instanceof cG))return!1;return this.equalsExact(e)}},cG.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)},cG.prototype.geometryChanged=function(){this.apply(cG.geometryChangedFilter)},cG.prototype.geometryChangedAction=function(){this._envelope=null},cG.prototype.equalsNorm=function(e){return null!==e&&this.norm().equalsExact(e.norm())},cG.prototype.getLength=function(){return 0},cG.prototype.getNumGeometries=function(){return 1},cG.prototype.compareTo=function(e,t){if(1===arguments.length){var n=e,r=n;return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(n)}if(2===arguments.length){var i=e,o=t;return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,o)}},cG.prototype.getUserData=function(){return this._userData},cG.prototype.getSRID=function(){return this._SRID},cG.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},cG.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===cG.SORTINDEX_GEOMETRYCOLLECTION)throw new lk},cG.prototype.equal=function(e,t,n){return 0===n?e.equals(t):e.distance(t)<=n},cG.prototype.norm=function(){var e=this.copy();return e.normalize(),e},cG.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},cG.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new Vk(this._envelope)},cG.prototype.setSRID=function(e){this._SRID=e},cG.prototype.setUserData=function(e){this._userData=e},cG.prototype.compare=function(e,t){for(var n=e.iterator(),r=t.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),a=i.compareTo(o);if(0!==a)return a}return n.hasNext()?1:r.hasNext()?-1:0},cG.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},cG.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===cG.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===cG.SORTINDEX_MULTIPOINT||this.getSortIndex()===cG.SORTINDEX_MULTILINESTRING||this.getSortIndex()===cG.SORTINDEX_MULTIPOLYGON},cG.prototype.interfaces_=function(){return[pk,fk,mk]},cG.prototype.getClass=function(){return cG},cG.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1},cG.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(null===e[t])return!0;return!1},hG.serialVersionUID.get=function(){return 0x799ea46522854c00},hG.SORTINDEX_POINT.get=function(){return 0},hG.SORTINDEX_MULTIPOINT.get=function(){return 1},hG.SORTINDEX_LINESTRING.get=function(){return 2},hG.SORTINDEX_LINEARRING.get=function(){return 3},hG.SORTINDEX_MULTILINESTRING.get=function(){return 4},hG.SORTINDEX_POLYGON.get=function(){return 5},hG.SORTINDEX_MULTIPOLYGON.get=function(){return 6},hG.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},hG.geometryChangedFilter.get=function(){return fG},Object.defineProperties(cG,hG);var fG=function(){};fG.interfaces_=function(){return[lG]},fG.filter=function(e){e.geometryChangedAction()};function pG(){}pG.prototype.filter=function(){},pG.prototype.interfaces_=function(){return[]},pG.prototype.getClass=function(){return pG};function dG(){}var mG={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};dG.prototype.isInBoundary=function(){},dG.prototype.interfaces_=function(){return[]},dG.prototype.getClass=function(){return dG},mG.Mod2BoundaryNodeRule.get=function(){return _G},mG.EndPointBoundaryNodeRule.get=function(){return gG},mG.MultiValentEndPointBoundaryNodeRule.get=function(){return yG},mG.MonoValentEndPointBoundaryNodeRule.get=function(){return vG},mG.MOD2_BOUNDARY_RULE.get=function(){return new _G},mG.ENDPOINT_BOUNDARY_RULE.get=function(){return new gG},mG.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new yG},mG.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new vG},mG.OGC_SFS_BOUNDARY_RULE.get=function(){return dG.MOD2_BOUNDARY_RULE},Object.defineProperties(dG,mG);var _G=function(){};_G.prototype.isInBoundary=function(e){return e%2==1},_G.prototype.interfaces_=function(){return[dG]},_G.prototype.getClass=function(){return _G};var gG=function(){};gG.prototype.isInBoundary=function(e){return 0<e},gG.prototype.interfaces_=function(){return[dG]},gG.prototype.getClass=function(){return gG};var yG=function(){};yG.prototype.isInBoundary=function(e){return 1<e},yG.prototype.interfaces_=function(){return[dG]},yG.prototype.getClass=function(){return yG};var vG=function(){};vG.prototype.isInBoundary=function(e){return 1===e},vG.prototype.interfaces_=function(){return[dG]},vG.prototype.getClass=function(){return vG};function xG(){}xG.prototype.add=function(){},xG.prototype.addAll=function(){},xG.prototype.isEmpty=function(){},xG.prototype.iterator=function(){},xG.prototype.size=function(){},xG.prototype.toArray=function(){},xG.prototype.remove=function(){};function bG(){}var EG=function(t){function e(e){t.call(this),this.message=e||""}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={name:{configurable:!0}};return n.name.get=function(){return"IndexOutOfBoundsException"},Object.defineProperties(e,n),e}(Error);bG.prototype.hasNext=function(){},bG.prototype.next=function(){},bG.prototype.remove=function(){};var TG,SG=((TG=xG)&&(CG.__proto__=TG),((CG.prototype=Object.create(TG&&TG.prototype)).constructor=CG).prototype.get=function(){},CG.prototype.set=function(){},CG.prototype.isEmpty=function(){},CG);function CG(){TG.apply(this,arguments)}function wG(e){this.message=e||""}(wG.prototype=new Error).name="NoSuchElementException";var AG,IG=((AG=SG)&&(PG.__proto__=AG),((PG.prototype=Object.create(AG&&AG.prototype)).constructor=PG).prototype.ensureCapacity=function(){},PG.prototype.interfaces_=function(){return[AG,xG]},PG.prototype.add=function(e,t){return 1===arguments.length?this.array_.push(e):this.array_.splice(e,t),!0},PG.prototype.clear=function(){this.array_=[]},PG.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},PG.prototype.set=function(e,t){var n=this.array_[e];return this.array_[e]=t,n},PG.prototype.iterator=function(){return new LG(this)},PG.prototype.get=function(e){if(e<0||e>=this.size())throw new EG;return this.array_[e]},PG.prototype.isEmpty=function(){return 0===this.array_.length},PG.prototype.size=function(){return this.array_.length},PG.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e},PG.prototype.remove=function(e){for(var t=!1,n=0,r=this.array_.length;n<r;n++)if(this.array_[n]===e){this.array_.splice(n,1),t=!0;break}return t},PG);function PG(){AG.call(this),this.array_=[],arguments[0]instanceof xG&&this.addAll(arguments[0])}var OG,LG=((OG=bG)&&(NG.__proto__=OG),((NG.prototype=Object.create(OG&&OG.prototype)).constructor=NG).prototype.next=function(){if(this.position_===this.arrayList_.size())throw new wG;return this.arrayList_.get(this.position_++)},NG.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},NG.prototype.set=function(e){return this.arrayList_.set(this.position_-1,e)},NG.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},NG);function NG(e){OG.call(this),this.arrayList_=e,this.position_=0}function RG(){}var DG=function(g){function e(){var e,t,n;g.call(this),0===arguments.length||(1===arguments.length?(e=arguments[0],this.ensureCapacity(e.length),this.add(e,!0)):2===arguments.length&&(t=arguments[0],n=arguments[1],this.ensureCapacity(t.length),this.add(t,n)))}g&&(e.__proto__=g),(e.prototype=Object.create(g&&g.prototype)).constructor=e;var t={coordArrayType:{configurable:!0}};return t.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(e){return this.get(e)},e.prototype.addAll=function(e,t){if(2!==arguments.length)return g.prototype.addAll.apply(this,arguments);for(var n=t,r=!1,i=e.iterator();i.hasNext();)this.add(i.next(),n),r=!0;return r},e.prototype.clone=function(){for(var e=g.prototype.clone.call(this),t=0;t<this.size();t++)e.add(t,this.get(t).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(e,t,n,r){if(1===arguments.length)g.prototype.add.call(this,e);else if(2===arguments.length){if(e instanceof Array&&"boolean"==typeof t)return this.add(e,t,!0),!0;if(e instanceof _k&&"boolean"==typeof t){var i=e;if(!t)if(1<=this.size())if(this.get(this.size()-1).equals2D(i))return null;g.prototype.add.call(this,i)}else if(e instanceof Object&&"boolean"==typeof t){return this.add(e,t),!0}}else if(3===arguments.length){if("boolean"==typeof n&&e instanceof Array&&"boolean"==typeof t){var o=e,a=t;if(n)for(var s=0;s<o.length;s++)this.add(o[s],a);else for(var u=o.length-1;0<=u;u--)this.add(o[u],a);return!0}if("boolean"==typeof n&&Number.isInteger(e)&&t instanceof _k){var l=e,c=t;if(!n){var h=this.size();if(0<h){if(0<l)if(this.get(l-1).equals2D(c))return null;if(l<h)if(this.get(l).equals2D(c))return null}}g.prototype.add.call(this,l,c)}}else if(4===arguments.length){var f=e,p=t,d=r,m=1;d<n&&(m=-1);for(var _=n;_!==d;_+=m)this.add(f[_],p);return!0}},e.prototype.closeRing=function(){0<this.size()&&this.add(new _k(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,t),e}(IG),MG={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};MG.ForwardComparator.get=function(){return FG},MG.BidirectionalComparator.get=function(){return zG},MG.coordArrayType.get=function(){return new Array(0).fill(null)},RG.prototype.interfaces_=function(){return[]},RG.prototype.getClass=function(){return RG},RG.isRing=function(e){return!(e.length<4)&&!!e[0].equals2D(e[e.length-1])},RG.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(RG.indexOf(r,t)<0)return r}return null},RG.scroll=function(e,t){var n=RG.indexOf(t,e);if(n<0)return null;var r=new Array(e.length).fill(null);Bk.arraycopy(e,n,r,0,e.length-n),Bk.arraycopy(e,0,r,e.length-n,n),Bk.arraycopy(r,0,e,0,e.length)},RG.equals=function(e,t,n){if(2===arguments.length){var r=e,i=t;if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var o=0;o<r.length;o++)if(!r[o].equals(i[o]))return!1;return!0}if(3===arguments.length){var a=e,s=t,u=n;if(a===s)return!0;if(null===a||null===s)return!1;if(a.length!==s.length)return!1;for(var l=0;l<a.length;l++)if(0!==u.compare(a[l],s[l]))return!1;return!0}},RG.intersection=function(e,t){for(var n=new DG,r=0;r<e.length;r++)t.intersects(e[r])&&n.add(e[r],!0);return n.toCoordinateArray()},RG.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1},RG.removeRepeatedPoints=function(e){return RG.hasRepeatedPoints(e)?new DG(e,!1).toCoordinateArray():e},RG.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),r=0;r<=n;r++){var i=e[r];e[r]=e[t-r],e[t-r]=i}},RG.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)null!==e[n]&&t++;var r=new Array(t).fill(null);if(0===t)return r;for(var i=0,o=0;o<e.length;o++)null!==e[o]&&(r[i++]=e[o]);return r},RG.copyDeep=function(e,t,n,r,i){if(1===arguments.length){for(var o=e,a=new Array(o.length).fill(null),s=0;s<o.length;s++)a[s]=new _k(o[s]);return a}if(5===arguments.length)for(var u=e,l=t,c=n,h=r,f=i,p=0;p<f;p++)c[h+p]=new _k(u[l+p])},RG.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=t[e.length-n-1];if(0!==r.compareTo(i))return!1}return!0},RG.envelope=function(e){for(var t=new Vk,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t},RG.toCoordinateArray=function(e){return e.toArray(RG.coordArrayType)},RG.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]},RG.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1},RG.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,r=e[t].compareTo(e[n]);if(0!==r)return r}return 1},RG.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var r=e[n].compareTo(t[n]);if(0!==r)return r;n++}return n<t.length?-1:n<e.length?1:0},RG.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(null===t||0<t.compareTo(e[n]))&&(t=e[n]);return t},RG.extract=function(e,t,n){t=Tk.clamp(t,0,e.length);var r=(n=Tk.clamp(n,-1,e.length))<0?0:n-t+1;t>=e.length&&(r=0),n<t&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var o=0,a=t;a<=n;a++)i[o++]=e[a];return i},Object.defineProperties(RG,MG);var FG=function(){};FG.prototype.compare=function(e,t){return RG.compare(e,t)},FG.prototype.interfaces_=function(){return[dk]},FG.prototype.getClass=function(){return FG};var zG=function(){};zG.prototype.compare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=RG.compare(n,r);return RG.isEqualReversed(n,r)?0:i},zG.prototype.OLDcompare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=RG.increasingDirection(n),o=RG.increasingDirection(r),a=0<i?0:n.length-1,s=0<o?0:n.length-1,u=0;u<n.length;u++){var l=n[a].compareTo(r[s]);if(0!==l)return l;a+=i,s+=o}return 0},zG.prototype.interfaces_=function(){return[dk]},zG.prototype.getClass=function(){return zG};function BG(){}BG.prototype.get=function(){},BG.prototype.put=function(){},BG.prototype.size=function(){},BG.prototype.values=function(){},BG.prototype.entrySet=function(){};var UG,VG=((UG=BG)&&(kG.__proto__=UG),(kG.prototype=Object.create(UG&&UG.prototype)).constructor=kG);function kG(){UG.apply(this,arguments)}function GG(e){this.message=e||""}function qG(){}(GG.prototype=new Error).name="OperationNotSupported",(qG.prototype=new xG).contains=function(){};var HG,WG=((HG=qG)&&(YG.__proto__=HG),((YG.prototype=Object.create(HG&&HG.prototype)).constructor=YG).prototype.contains=function(e){for(var t=0,n=this.array_.length;t<n;t++)if(this.array_[t]===e)return!0;return!1},YG.prototype.add=function(e){return!this.contains(e)&&(this.array_.push(e),!0)},YG.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},YG.prototype.remove=function(){throw new Error},YG.prototype.size=function(){return this.array_.length},YG.prototype.isEmpty=function(){return 0===this.array_.length},YG.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e},YG.prototype.iterator=function(){return new jG(this)},YG);function YG(){HG.call(this),this.array_=[],arguments[0]instanceof xG&&this.addAll(arguments[0])}var XG,jG=((XG=bG)&&(KG.__proto__=XG),((KG.prototype=Object.create(XG&&XG.prototype)).constructor=KG).prototype.next=function(){if(this.position_===this.hashSet_.size())throw new wG;return this.hashSet_.array_[this.position_++]},KG.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},KG.prototype.remove=function(){throw new GG},KG);function KG(e){XG.call(this),this.hashSet_=e,this.position_=0}var QG=0;function ZG(e){return null===e?QG:e.color}function JG(e){return null===e?null:e.parent}function $G(e,t){null!==e&&(e.color=t)}function eq(e){return null===e?null:e.left}function tq(e){return null===e?null:e.right}function nq(){this.root_=null,this.size_=0}(nq.prototype=new VG).get=function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(0<n))return t.value;t=t.right}}return null},nq.prototype.put=function(e,t){if(null===this.root_)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:QG,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=e.compareTo(i.key))<0)i=i.left;else{if(!(0<r)){var o=i.value;return i.value=t,o}i=i.right}}while(null!==i);var a={key:e,left:null,right:null,value:t,parent:n,color:QG,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=a:n.right=a,this.fixAfterInsertion(a),this.size_++,null},nq.prototype.fixAfterInsertion=function(e){var t,n;for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;){JG(e)===eq(JG(JG(e)))?1===ZG(t=tq(JG(JG(e))))?($G(JG(e),QG),$G(t,QG),$G(JG(JG(e)),1),e=JG(JG(e))):(e===tq(JG(e))&&(e=JG(e),this.rotateLeft(e)),$G(JG(e),QG),$G(JG(JG(e)),1),this.rotateRight(JG(JG(e)))):1===ZG(n=eq(JG(JG(e))))?($G(JG(e),QG),$G(n,QG),$G(JG(JG(e)),1),e=JG(JG(e))):(e===eq(JG(e))&&(e=JG(e),this.rotateRight(e)),$G(JG(e),QG),$G(JG(JG(e)),1),this.rotateLeft(JG(JG(e))))}this.root_.color=QG},nq.prototype.values=function(){var e=new IG,t=this.getFirstEntry();if(null!==t)for(e.add(t.value);null!==(t=nq.successor(t));)e.add(t.value);return e},nq.prototype.entrySet=function(){var e=new WG,t=this.getFirstEntry();if(null!==t)for(e.add(t);null!==(t=nq.successor(t));)e.add(t);return e},nq.prototype.rotateLeft=function(e){var t;null!=e&&(t=e.right,e.right=t.left,null!=t.left&&(t.left.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,(t.left=e).parent=t)},nq.prototype.rotateRight=function(e){var t;null!=e&&(t=e.left,e.left=t.right,null!=t.right&&(t.right.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,(t.right=e).parent=t)},nq.prototype.getFirstEntry=function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e},nq.successor=function(e){if(null===e)return null;if(null!==e.right){for(var t=e.right;null!==t.left;)t=t.left;return t}for(var n=e.parent,r=e;null!==n&&r===n.right;)n=(r=n).parent;return n},nq.prototype.size=function(){return this.size_};function rq(){}function iq(){}function oq(){this.array_=[],arguments[0]instanceof xG&&this.addAll(arguments[0])}rq.prototype.interfaces_=function(){return[]},rq.prototype.getClass=function(){return rq},iq.prototype=new qG,(oq.prototype=new iq).contains=function(e){for(var t=0,n=this.array_.length;t<n;t++){if(0===this.array_[t].compareTo(e))return!0}return!1},oq.prototype.add=function(e){if(this.contains(e))return!1;for(var t=0,n=this.array_.length;t<n;t++){if(1===this.array_[t].compareTo(e))return this.array_.splice(t,0,e),!0}return this.array_.push(e),!0},oq.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},oq.prototype.remove=function(e){throw new GG},oq.prototype.size=function(){return this.array_.length},oq.prototype.isEmpty=function(){return 0===this.array_.length},oq.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e},oq.prototype.iterator=function(){return new aq(this)};var aq=function(e){this.treeSet_=e,this.position_=0};aq.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new wG;return this.treeSet_.array_[this.position_++]},aq.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},aq.prototype.remove=function(){throw new GG};function sq(){}sq.sort=function(e,t,n,r){var i,o,a,s,u=e;if(1===arguments.length)s=function(e,t){return e.compareTo(t)},u.sort(s);else if(2===arguments.length)a=t,s=function(e,t){return a.compare(e,t)},u.sort(s);else if(3===arguments.length){(o=u.slice(t,n)).sort();var l=u.slice(0,t).concat(o,u.slice(n,u.length));for(u.splice(0,u.length),i=0;i<l.length;i++)u.push(l[i])}else if(4===arguments.length)for(o=u.slice(t,n),a=r,s=function(e,t){return a.compare(e,t)},o.sort(s),l=u.slice(0,t).concat(o,u.slice(n,u.length)),u.splice(0,u.length),i=0;i<l.length;i++)u.push(l[i])},sq.asList=function(e){for(var t=new IG,n=0,r=e.length;n<r;n++)t.add(e[n]);return t};function uq(){}var lq={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};lq.P.get=function(){return 0},lq.L.get=function(){return 1},lq.A.get=function(){return 2},lq.FALSE.get=function(){return-1},lq.TRUE.get=function(){return-2},lq.DONTCARE.get=function(){return-3},lq.SYM_FALSE.get=function(){return"F"},lq.SYM_TRUE.get=function(){return"T"},lq.SYM_DONTCARE.get=function(){return"*"},lq.SYM_P.get=function(){return"0"},lq.SYM_L.get=function(){return"1"},lq.SYM_A.get=function(){return"2"},uq.prototype.interfaces_=function(){return[]},uq.prototype.getClass=function(){return uq},uq.toDimensionSymbol=function(e){switch(e){case uq.FALSE:return uq.SYM_FALSE;case uq.TRUE:return uq.SYM_TRUE;case uq.DONTCARE:return uq.SYM_DONTCARE;case uq.P:return uq.SYM_P;case uq.L:return uq.SYM_L;case uq.A:return uq.SYM_A}throw new lk},uq.toDimensionValue=function(e){switch(Ak.toUpperCase(e)){case uq.SYM_FALSE:return uq.FALSE;case uq.SYM_TRUE:return uq.TRUE;case uq.SYM_DONTCARE:return uq.DONTCARE;case uq.SYM_P:return uq.P;case uq.SYM_L:return uq.L;case uq.SYM_A:return uq.A}throw new lk},Object.defineProperties(uq,lq);function cq(){}cq.prototype.filter=function(){},cq.prototype.interfaces_=function(){return[]},cq.prototype.getClass=function(){return cq};function hq(){}hq.prototype.filter=function(){},hq.prototype.isDone=function(){},hq.prototype.isGeometryChanged=function(){},hq.prototype.interfaces_=function(){return[]},hq.prototype.getClass=function(){return hq};var fq=function(a){function n(e,t){if(a.call(this,t),this._geometries=e||[],a.hasNullElements(this._geometries))throw new lk}a&&(n.__proto__=a);var e={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(a&&a.prototype)).constructor=n).prototype.computeEnvelopeInternal=function(){for(var e=new Vk,t=0;t<this._geometries.length;t++)e.expandToInclude(this._geometries[t].getEnvelopeInternal());return e},n.prototype.getGeometryN=function(e){return this._geometries[e]},n.prototype.getSortIndex=function(){return a.SORTINDEX_GEOMETRYCOLLECTION},n.prototype.getCoordinates=function(){for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getCoordinates(),i=0;i<r.length;i++)e[++t]=r[i];return e},n.prototype.getArea=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getArea();return e},n.prototype.equalsExact=function(e,t){if(2!==arguments.length)return a.prototype.equalsExact.apply(this,arguments);var n=e,r=t;if(!this.isEquivalentClass(n))return!1;var i=n;if(this._geometries.length!==i._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!this._geometries[o].equalsExact(i._geometries[o],r))return!1;return!0},n.prototype.normalize=function(){for(var e=0;e<this._geometries.length;e++)this._geometries[e].normalize();sq.sort(this._geometries)},n.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},n.prototype.getBoundaryDimension=function(){for(var e=uq.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getBoundaryDimension());return e},n.prototype.getDimension=function(){for(var e=uq.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getDimension());return e},n.prototype.getLength=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getLength();return e},n.prototype.getNumPoints=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getNumPoints();return e},n.prototype.getNumGeometries=function(){return this._geometries.length},n.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),n=0;n<this._geometries.length;n++)t[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(t)},n.prototype.compareToSameClass=function(e,t){if(1===arguments.length){var n=e,r=new oq(sq.asList(this._geometries)),i=new oq(sq.asList(n._geometries));return this.compare(r,i)}if(2===arguments.length){for(var o=t,a=e,s=this.getNumGeometries(),u=a.getNumGeometries(),l=0;l<s&&l<u;){var c=this.getGeometryN(l),h=a.getGeometryN(l),f=c.compareToSameClass(h,o);if(0!==f)return f;l++}return l<s?1:l<u?-1:0}},n.prototype.apply=function(e){if(Ek(e,pG))for(var t=e,n=0;n<this._geometries.length;n++)this._geometries[n].apply(t);else if(Ek(e,hq)){var r=e;if(0===this._geometries.length)return null;for(var i=0;i<this._geometries.length&&(this._geometries[i].apply(r),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else if(Ek(e,cq)){var o=e;o.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(o)}else if(Ek(e,lG)){var s=e;s.filter(this);for(var u=0;u<this._geometries.length;u++)this._geometries[u].apply(s)}},n.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),$k.shouldNeverReachHere(),null},n.prototype.clone=function(){var e=a.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var t=0;t<this._geometries.length;t++)e._geometries[t]=this._geometries[t].clone();return e},n.prototype.getGeometryType=function(){return"GeometryCollection"},n.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new n(e,this._factory)},n.prototype.isEmpty=function(){for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isEmpty())return!1;return!0},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},e.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(n,e),n}(cG),pq=function(i){function n(){i.apply(this,arguments)}i&&(n.__proto__=i);var e={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(i&&i.prototype)).constructor=n).prototype.getSortIndex=function(){return cG.SORTINDEX_MULTILINESTRING},n.prototype.equalsExact=function(e,t){if(2!==arguments.length)return i.prototype.equalsExact.apply(this,arguments);var n=e,r=t;return!!this.isEquivalentClass(n)&&i.prototype.equalsExact.call(this,n,r)},n.prototype.getBoundaryDimension=function(){return this.isClosed()?uq.FALSE:0},n.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isClosed())return!1;return!0},n.prototype.getDimension=function(){return 1},n.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),n=0;n<this._geometries.length;n++)t[e-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(t)},n.prototype.getBoundary=function(){return new dq(this).getBoundary()},n.prototype.getGeometryType=function(){return"MultiLineString"},n.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new n(e,this._factory)},n.prototype.interfaces_=function(){return[rq]},n.prototype.getClass=function(){return n},e.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(n,e),n}(fq),dq=function(e,t){var n,r,i,o;this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length?(n=e,r=dG.MOD2_BOUNDARY_RULE,this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r):2===arguments.length&&(i=e,o=t,this._geom=i,this._geomFact=i.getFactory(),this._bnRule=o)};dq.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return 1===t.length?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)},dq.prototype.getBoundary=function(){return this._geom instanceof wq?this.boundaryLineString(this._geom):this._geom instanceof pq?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},dq.prototype.boundaryLineString=function(e){return this._geom.isEmpty()?this.getEmptyMultiPoint():e.isClosed()?this._bnRule.isInBoundary(2)?e.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])},dq.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},dq.prototype.computeBoundaryCoordinates=function(e){var t=new IG;this._endpointMap=new nq;for(var n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);0!==r.getNumPoints()&&(this.addEndpoint(r.getCoordinateN(0)),this.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var i=this._endpointMap.entrySet().iterator();i.hasNext();){var o=i.next(),a=o.getValue().count;this._bnRule.isInBoundary(a)&&t.add(o.getKey())}return RG.toCoordinateArray(t)},dq.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);null===t&&(t=new mq,this._endpointMap.put(e,t)),t.count++},dq.prototype.interfaces_=function(){return[]},dq.prototype.getClass=function(){return dq},dq.getBoundary=function(e,t){return 1===arguments.length?new dq(e).getBoundary():2===arguments.length?new dq(e,t).getBoundary():void 0};var mq=function(){this.count=null};function _q(){}function gq(){}mq.prototype.interfaces_=function(){return[]},mq.prototype.getClass=function(){return mq};function yq(){}function vq(){}function xq(){}function bq(){}function Eq(){}var Tq={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Eq.prototype.interfaces_=function(){return[]},Eq.prototype.getClass=function(){return Eq},Eq.chars=function(e,t){for(var n=new Array(t).fill(null),r=0;r<t;r++)n[r]=e;return String(n)},Eq.getStackTrace=function(e,t){if(1===arguments.length){var n=new vq,r=new _q;return e.printStackTrace(r),n.toString()}if(2===arguments.length){for(var i=t,o="",a=new bq(new gq(Eq.getStackTrace(e))),s=0;s<i;s++)try{o+=a.readLine()+Eq.NEWLINE}catch(e){if(!(e instanceof xq))throw e;$k.shouldNeverReachHere()}return o}},Eq.split=function(e,t){for(var n=t.length,r=new IG,i=""+e,o=i.indexOf(t);0<=o;){var a=i.substring(0,o);r.add(a),o=(i=i.substring(o+n)).indexOf(t)}0<i.length&&r.add(i);for(var s=new Array(r.size()).fill(null),u=0;u<s.length;u++)s[u]=r.get(u);return s},Eq.toString=function(e){if(1===arguments.length)return Eq.SIMPLE_ORDINATE_FORMAT.format(e)},Eq.spaces=function(e){return Eq.chars(" ",e)},Tq.NEWLINE.get=function(){return Bk.getProperty("line.separator")},Tq.SIMPLE_ORDINATE_FORMAT.get=function(){return new yq},Object.defineProperties(Eq,Tq);function Sq(){}Sq.prototype.interfaces_=function(){return[]},Sq.prototype.getClass=function(){return Sq},Sq.copyCoord=function(e,t,n,r){for(var i=Math.min(e.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,e.getOrdinate(t,o))},Sq.isRing=function(e){var t=e.size();return 0===t||!(t<=3)&&(e.getOrdinate(0,Nk.X)===e.getOrdinate(t-1,Nk.X)&&e.getOrdinate(0,Nk.Y)===e.getOrdinate(t-1,Nk.Y))},Sq.isEqual=function(e,t){var n=e.size();if(n!==t.size())return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),i=0;i<n;i++)for(var o=0;o<r;o++){var a=e.getOrdinate(i,o),s=t.getOrdinate(i,o);if(e.getOrdinate(i,o)!==t.getOrdinate(i,o)&&(!ck.isNaN(a)||!ck.isNaN(s)))return!1}return!0},Sq.extend=function(e,t,n){var r=e.create(n,t.getDimension()),i=t.size();if(Sq.copy(t,0,r,0,i),0<i)for(var o=i;o<n;o++)Sq.copy(t,i-1,r,o,1);return r},Sq.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),r=0;r<=n;r++)Sq.swap(e,r,t-r)},Sq.swap=function(e,t,n){if(t===n)return null;for(var r=0;r<e.getDimension();r++){var i=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(n,r)),e.setOrdinate(n,r,i)}},Sq.copy=function(e,t,n,r,i){for(var o=0;o<i;o++)Sq.copyCoord(e,t+o,n,r+o)},Sq.toString=function(e){if(1===arguments.length){var t=e,n=t.size();if(0===n)return"()";var r=t.getDimension(),i=new Ck;i.append("(");for(var o=0;o<n;o++){0<o&&i.append(" ");for(var a=0;a<r;a++)0<a&&i.append(","),i.append(Eq.toString(t.getOrdinate(o,a)))}return i.append(")"),i.toString()}},Sq.ensureValidRing=function(e,t){var n=t.size();return 0===n?t:n<=3?Sq.createClosedRing(e,t,4):t.getOrdinate(0,Nk.X)===t.getOrdinate(n-1,Nk.X)&&t.getOrdinate(0,Nk.Y)===t.getOrdinate(n-1,Nk.Y)?t:Sq.createClosedRing(e,t,n+1)},Sq.createClosedRing=function(e,t,n){var r=e.create(n,t.getDimension()),i=t.size();Sq.copy(t,0,r,0,i);for(var o=i;o<n;o++)Sq.copy(t,0,r,o,1);return r};function Cq(){}var wq=function(a){function t(e,t){a.call(this,t),this._points=null,this.init(e)}a&&(t.__proto__=a);var e={serialVersionUID:{configurable:!0}};return((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Vk:this._points.expandEnvelope(new Vk)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return a.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(e,t){if(2!==arguments.length)return a.prototype.equalsExact.apply(this,arguments);var n=e,r=t;if(!this.isEquivalentClass(n))return!1;var i=n;if(this._points.size()!==i._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!this.equal(this._points.getCoordinate(o),i._points.getCoordinate(o),r))return!1;return!0},t.prototype.normalize=function(){for(var e=0;e<Math.trunc(this._points.size()/2);e++){var t=this._points.size()-1-e;if(!this._points.getCoordinate(e).equals(this._points.getCoordinate(t)))return 0<this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t))&&Sq.reverse(this._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?uq.FALSE:0},t.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return sG.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var e=this._points.copy();return Sq.reverse(e),this.getFactory().createLineString(e)},t.prototype.compareToSameClass=function(e,t){if(1===arguments.length){for(var n=e,r=0,i=0;r<this._points.size()&&i<n._points.size();){var o=this._points.getCoordinate(r).compareTo(n._points.getCoordinate(i));if(0!==o)return o;r++,i++}return r<this._points.size()?1:i<n._points.size()?-1:0}if(2===arguments.length)return t.compare(this._points,e._points)},t.prototype.apply=function(e){if(Ek(e,pG))for(var t=e,n=0;n<this._points.size();n++)t.filter(this._points.getCoordinate(n));else if(Ek(e,hq)){var r=e;if(0===this._points.size())return null;for(var i=0;i<this._points.size()&&(r.filter(this._points,i),!r.isDone());i++);r.isGeometryChanged()&&this.geometryChanged()}else{(Ek(e,cq)||Ek(e,lG))&&e.filter(this)}},t.prototype.getBoundary=function(){return new dq(this).getBoundary()},t.prototype.isEquivalentClass=function(e){return e instanceof t},t.prototype.clone=function(){var e=a.prototype.clone.call(this);return e._points=this._points.clone(),e},t.prototype.getCoordinateN=function(e){return this._points.getCoordinate(e)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return 0===this._points.size()},t.prototype.init=function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new lk(e.size());this._points=e},t.prototype.isCoordinate=function(e){for(var t=0;t<this._points.size();t++)if(this._points.getCoordinate(t).equals(e))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(e){return this.getFactory().createPoint(this._points.getCoordinate(e))},t.prototype.interfaces_=function(){return[rq]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,e),t}(cG);Cq.prototype.interfaces_=function(){return[]},Cq.prototype.getClass=function(){return Cq};function Aq(){}var Iq=function(i){function e(e,t){i.call(this,t),this._coordinates=e||null,this.init(this._coordinates)}i&&(e.__proto__=i);var t={serialVersionUID:{configurable:!0}};return((e.prototype=Object.create(i&&i.prototype)).constructor=e).prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Vk;var e=new Vk;return e.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),e},e.prototype.getSortIndex=function(){return i.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(e,t){if(2!==arguments.length)return i.prototype.equalsExact.apply(this,arguments);var n=e,r=t;return!!this.isEquivalentClass(n)&&(!(!this.isEmpty()||!n.isEmpty())||this.isEmpty()===n.isEmpty()&&this.equal(n.getCoordinate(),this.getCoordinate(),r))},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return uq.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(e,t){if(1===arguments.length){var n=e;return this.getCoordinate().compareTo(n.getCoordinate())}if(2===arguments.length)return t.compare(this._coordinates,e._coordinates)},e.prototype.apply=function(e){if(Ek(e,pG)){var t=e;if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(Ek(e,hq)){var n=e;if(this.isEmpty())return null;n.filter(this._coordinates,0),n.isGeometryChanged()&&this.geometryChanged()}else{(Ek(e,cq)||Ek(e,lG))&&e.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=i.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),$k.isTrue(e.size()<=1),this._coordinates=e},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Cq]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,t),e}(cG);Aq.prototype.interfaces_=function(){return[]},Aq.prototype.getClass=function(){return Aq};function Pq(e){this._factory=e||null,this._isUserDataCopied=!1}var Oq=function(u){function r(e,t,n){if(u.call(this,n),this._shell=null,(this._holes=null)===e&&(e=this.getFactory().createLinearRing()),null===t&&(t=[]),u.hasNullElements(t))throw new lk;if(e.isEmpty()&&u.hasNonEmptyElements(t))throw new lk;this._shell=e,this._holes=t}u&&(r.__proto__=u);var e={serialVersionUID:{configurable:!0}};return((r.prototype=Object.create(u&&u.prototype)).constructor=r).prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},r.prototype.getSortIndex=function(){return u.SORTINDEX_POLYGON},r.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=this._shell.getCoordinates(),r=0;r<n.length;r++)e[++t]=n[r];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),a=0;a<o.length;a++)e[++t]=o[a];return e},r.prototype.getArea=function(){var e=0;e+=Math.abs(sG.signedArea(this._shell.getCoordinateSequence()));for(var t=0;t<this._holes.length;t++)e-=Math.abs(sG.signedArea(this._holes[t].getCoordinateSequence()));return e},r.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var e=this._shell.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var r=e.getX(n);if(r!==t.getMinX()&&r!==t.getMaxX())return!1;var i=e.getY(n);if(i!==t.getMinY()&&i!==t.getMaxY())return!1}for(var o=e.getX(0),a=e.getY(0),s=1;s<=4;s++){var u=e.getX(s),l=e.getY(s);if(u!==o==(l!==a))return!1;o=u,a=l}return!0},r.prototype.equalsExact=function(e,t){if(2!==arguments.length)return u.prototype.equalsExact.apply(this,arguments);var n=e,r=t;if(!this.isEquivalentClass(n))return!1;var i=n,o=this._shell,a=i._shell;if(!o.equalsExact(a,r))return!1;if(this._holes.length!==i._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(i._holes[s],r))return!1;return!0},r.prototype.normalize=function(e,t){if(0===arguments.length){this.normalize(this._shell,!0);for(var n=0;n<this._holes.length;n++)this.normalize(this._holes[n],!1);sq.sort(this._holes)}else if(2===arguments.length){var r=e,i=t;if(r.isEmpty())return null;var o=new Array(r.getCoordinates().length-1).fill(null);Bk.arraycopy(r.getCoordinates(),0,o,0,o.length);var a=RG.minCoordinate(r.getCoordinates());RG.scroll(o,a),Bk.arraycopy(o,0,r.getCoordinates(),0,o.length),r.getCoordinates()[o.length]=o[0],sG.isCCW(r.getCoordinates())===i&&RG.reverse(r.getCoordinates())}},r.prototype.getCoordinate=function(){return this._shell.getCoordinate()},r.prototype.getNumInteriorRing=function(){return this._holes.length},r.prototype.getBoundaryDimension=function(){return 1},r.prototype.getDimension=function(){return 2},r.prototype.getLength=function(){var e=0;e+=this._shell.getLength();for(var t=0;t<this._holes.length;t++)e+=this._holes[t].getLength();return e},r.prototype.getNumPoints=function(){for(var e=this._shell.getNumPoints(),t=0;t<this._holes.length;t++)e+=this._holes[t].getNumPoints();return e},r.prototype.reverse=function(){var e=this.copy();e._shell=this._shell.copy().reverse(),e._holes=new Array(this._holes.length).fill(null);for(var t=0;t<this._holes.length;t++)e._holes[t]=this._holes[t].copy().reverse();return e},r.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},r.prototype.compareToSameClass=function(e,t){if(1===arguments.length){var n=this._shell,r=e._shell;return n.compareToSameClass(r)}if(2===arguments.length){var i=t,o=e,a=this._shell,s=o._shell,u=a.compareToSameClass(s,i);if(0!==u)return u;for(var l=this.getNumInteriorRing(),c=o.getNumInteriorRing(),h=0;h<l&&h<c;){var f=this.getInteriorRingN(h),p=o.getInteriorRingN(h),d=f.compareToSameClass(p,i);if(0!==d)return d;h++}return h<l?1:h<c?-1:0}},r.prototype.apply=function(e){if(Ek(e,pG)){this._shell.apply(e);for(var t=0;t<this._holes.length;t++)this._holes[t].apply(e)}else if(Ek(e,hq)){if(this._shell.apply(e),!e.isDone())for(var n=0;n<this._holes.length&&(this._holes[n].apply(e),!e.isDone());n++);e.isGeometryChanged()&&this.geometryChanged()}else if(Ek(e,cq))e.filter(this);else if(Ek(e,lG)){e.filter(this),this._shell.apply(e);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(e)}},r.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var t=0;t<this._holes.length;t++)e[t+1]=this._holes[t];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)},r.prototype.clone=function(){var e=u.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var t=0;t<this._holes.length;t++)e._holes[t]=this._holes[t].clone();return e},r.prototype.getGeometryType=function(){return"Polygon"},r.prototype.copy=function(){for(var e=this._shell.copy(),t=new Array(this._holes.length).fill(null),n=0;n<t.length;n++)t[n]=this._holes[n].copy();return new r(e,t,this._factory)},r.prototype.getExteriorRing=function(){return this._shell},r.prototype.isEmpty=function(){return this._shell.isEmpty()},r.prototype.getInteriorRingN=function(e){return this._holes[e]},r.prototype.interfaces_=function(){return[Aq]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(r,e),r}(cG),Lq=function(i){function n(){i.apply(this,arguments)}i&&(n.__proto__=i);var e={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(i&&i.prototype)).constructor=n).prototype.getSortIndex=function(){return cG.SORTINDEX_MULTIPOINT},n.prototype.isValid=function(){return!0},n.prototype.equalsExact=function(e,t){if(2!==arguments.length)return i.prototype.equalsExact.apply(this,arguments);var n=e,r=t;return!!this.isEquivalentClass(n)&&i.prototype.equalsExact.call(this,n,r)},n.prototype.getCoordinate=function(e){return 1!==arguments.length?i.prototype.getCoordinate.apply(this,arguments):this._geometries[e].getCoordinate()},n.prototype.getBoundaryDimension=function(){return uq.FALSE},n.prototype.getDimension=function(){return 0},n.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},n.prototype.getGeometryType=function(){return"MultiPoint"},n.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new n(e,this._factory)},n.prototype.interfaces_=function(){return[Cq]},n.prototype.getClass=function(){return n},e.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(n,e),n}(fq),Nq=function(n){function e(e,t){e instanceof _k&&t instanceof Kq&&(e=t.getCoordinateSequenceFactory().create(e)),n.call(this,e,t),this.validateConstruction()}n&&(e.__proto__=n);var t={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.getSortIndex=function(){return cG.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return uq.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||n.prototype.isClosed.call(this)},e.prototype.reverse=function(){var e=this._points.copy();return Sq.reverse(e),this.getFactory().createLinearRing(e)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!n.prototype.isClosed.call(this))throw new lk;if(1<=this.getCoordinateSequence().size()&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new lk(this.getCoordinateSequence().size())},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},t.MINIMUM_VALID_SIZE.get=function(){return 4},t.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,t),e}(wq),Rq=function(i){function n(){i.apply(this,arguments)}i&&(n.__proto__=i);var e={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(i&&i.prototype)).constructor=n).prototype.getSortIndex=function(){return cG.SORTINDEX_MULTIPOLYGON},n.prototype.equalsExact=function(e,t){if(2!==arguments.length)return i.prototype.equalsExact.apply(this,arguments);var n=e,r=t;return!!this.isEquivalentClass(n)&&i.prototype.equalsExact.call(this,n,r)},n.prototype.getBoundaryDimension=function(){return 1},n.prototype.getDimension=function(){return 2},n.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),n=0;n<this._geometries.length;n++)t[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(t)},n.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new IG,t=0;t<this._geometries.length;t++)for(var n=this._geometries[t].getBoundary(),r=0;r<n.getNumGeometries();r++)e.add(n.getGeometryN(r));var i=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(i))},n.prototype.getGeometryType=function(){return"MultiPolygon"},n.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new n(e,this._factory)},n.prototype.interfaces_=function(){return[Aq]},n.prototype.getClass=function(){return n},e.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(n,e),n}(fq),Dq={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Pq.prototype.setCopyUserData=function(e){this._isUserDataCopied=e},Pq.prototype.edit=function(e,t){if(null===e)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n},Pq.prototype.editInternal=function(e,t){return null===this._factory&&(this._factory=e.getFactory()),e instanceof fq?this.editGeometryCollection(e,t):e instanceof Oq?this.editPolygon(e,t):e instanceof Iq||e instanceof wq?t.edit(e,this._factory):($k.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)},Pq.prototype.editGeometryCollection=function(e,t){for(var n=t.edit(e,this._factory),r=new IG,i=0;i<n.getNumGeometries();i++){var o=this.edit(n.getGeometryN(i),t);null===o||o.isEmpty()||r.add(o)}return n.getClass()===Lq?this._factory.createMultiPoint(r.toArray([])):n.getClass()===pq?this._factory.createMultiLineString(r.toArray([])):n.getClass()===Rq?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},Pq.prototype.editPolygon=function(e,t){var n=t.edit(e,this._factory);if(null===n&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var r=this.edit(n.getExteriorRing(),t);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var i=new IG,o=0;o<n.getNumInteriorRing();o++){var a=this.edit(n.getInteriorRingN(o),t);null===a||a.isEmpty()||i.add(a)}return this._factory.createPolygon(r,i.toArray([]))},Pq.prototype.interfaces_=function(){return[]},Pq.prototype.getClass=function(){return Pq},Pq.GeometryEditorOperation=function(){},Dq.NoOpGeometryOperation.get=function(){return Mq},Dq.CoordinateOperation.get=function(){return Fq},Dq.CoordinateSequenceOperation.get=function(){return zq},Object.defineProperties(Pq,Dq);var Mq=function(){};Mq.prototype.edit=function(e){return e},Mq.prototype.interfaces_=function(){return[Pq.GeometryEditorOperation]},Mq.prototype.getClass=function(){return Mq};var Fq=function(){};Fq.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return null===n?e:e instanceof Nq?t.createLinearRing(n):e instanceof wq?t.createLineString(n):e instanceof Iq?0<n.length?t.createPoint(n[0]):t.createPoint():e},Fq.prototype.interfaces_=function(){return[Pq.GeometryEditorOperation]},Fq.prototype.getClass=function(){return Fq};var zq=function(){};zq.prototype.edit=function(e,t){return e instanceof Nq?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof wq?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Iq?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e},zq.prototype.interfaces_=function(){return[Pq.GeometryEditorOperation]},zq.prototype.getClass=function(){return zq};function Bq(e,t){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(e instanceof Array)this._coordinates=e,this._dimension=3;else if(Number.isInteger(e)){var n=e;this._coordinates=new Array(n).fill(null);for(var r=0;r<n;r++)this._coordinates[r]=new _k}else if(Ek(e,Nk)){var i=e;if(null===i)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var o=0;o<this._coordinates.length;o++)this._coordinates[o]=i.getCoordinateCopy(o)}}else if(2===arguments.length)if(e instanceof Array&&Number.isInteger(t)){var a=e,s=t;this._coordinates=a,this._dimension=s,null===a&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(e)&&Number.isInteger(t)){var u=e,l=t;this._coordinates=new Array(u).fill(null),this._dimension=l;for(var c=0;c<u;c++)this._coordinates[c]=new _k}}var Uq={serialVersionUID:{configurable:!0}};Bq.prototype.setOrdinate=function(e,t,n){switch(t){case Nk.X:this._coordinates[e].x=n;break;case Nk.Y:this._coordinates[e].y=n;break;case Nk.Z:this._coordinates[e].z=n;break;default:throw new lk}},Bq.prototype.size=function(){return this._coordinates.length},Bq.prototype.getOrdinate=function(e,t){switch(t){case Nk.X:return this._coordinates[e].x;case Nk.Y:return this._coordinates[e].y;case Nk.Z:return this._coordinates[e].z}return ck.NaN},Bq.prototype.getCoordinate=function(e,t){var n,r;if(1===arguments.length)return this._coordinates[e];2===arguments.length&&(n=e,(r=t).x=this._coordinates[n].x,r.y=this._coordinates[n].y,r.z=this._coordinates[n].z)},Bq.prototype.getCoordinateCopy=function(e){return new _k(this._coordinates[e])},Bq.prototype.getDimension=function(){return this._dimension},Bq.prototype.getX=function(e){return this._coordinates[e].x},Bq.prototype.clone=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].clone();return new Bq(e,this._dimension)},Bq.prototype.expandEnvelope=function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e},Bq.prototype.copy=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].copy();return new Bq(e,this._dimension)},Bq.prototype.toString=function(){if(0<this._coordinates.length){var e=new Ck(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"},Bq.prototype.getY=function(e){return this._coordinates[e].y},Bq.prototype.toCoordinateArray=function(){return this._coordinates},Bq.prototype.interfaces_=function(){return[Nk,mk]},Bq.prototype.getClass=function(){return Bq},Uq.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Bq,Uq);function Vq(){}var kq={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Vq.prototype.readResolve=function(){return Vq.instance()},Vq.prototype.create=function(e,t){if(1===arguments.length){if(e instanceof Array)return new Bq(e);if(Ek(e,Nk))return new Bq(e)}else if(2===arguments.length){var n=e,r=t;return 3<r&&(r=3),r<2?new Bq(n):new Bq(n,r)}},Vq.prototype.interfaces_=function(){return[vk,mk]},Vq.prototype.getClass=function(){return Vq},Vq.instance=function(){return Vq.instanceObject},kq.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},kq.instanceObject.get=function(){return new Vq},Object.defineProperties(Vq,kq);var Gq,qq=((Gq=BG)&&(Hq.__proto__=Gq),((Hq.prototype=Object.create(Gq&&Gq.prototype)).constructor=Hq).prototype.get=function(e){return this.map_.get(e)||null},Hq.prototype.put=function(e,t){return this.map_.set(e,t),t},Hq.prototype.values=function(){for(var e=new IG,t=this.map_.values(),n=t.next();!n.done;)e.add(n.value),n=t.next();return e},Hq.prototype.entrySet=function(){var t=new WG;return this.map_.entries().forEach(function(e){return t.add(e)}),t},Hq.prototype.size=function(){return this.map_.size()},Hq);function Hq(){Gq.call(this),this.map_=new Map}function Wq(){var e,t,n;this._modelType=null,this._scale=null,0===arguments.length?this._modelType=Wq.FLOATING:1===arguments.length&&(arguments[0]instanceof Xq?(e=arguments[0],(this._modelType=e)===Wq.FIXED&&this.setScale(1)):"number"==typeof arguments[0]?(t=arguments[0],this._modelType=Wq.FIXED,this.setScale(t)):arguments[0]instanceof Wq&&(n=arguments[0],this._modelType=n._modelType,this._scale=n._scale))}var Yq={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Wq.prototype.equals=function(e){if(!(e instanceof Wq))return!1;return this._modelType===e._modelType&&this._scale===e._scale},Wq.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new wk(n).compareTo(new wk(r))},Wq.prototype.getScale=function(){return this._scale},Wq.prototype.isFloating=function(){return this._modelType===Wq.FLOATING||this._modelType===Wq.FLOATING_SINGLE},Wq.prototype.getType=function(){return this._modelType},Wq.prototype.toString=function(){var e="UNKNOWN";return this._modelType===Wq.FLOATING?e="Floating":this._modelType===Wq.FLOATING_SINGLE?e="Floating-Single":this._modelType===Wq.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e},Wq.prototype.makePrecise=function(e){if("number"==typeof e){var t=e;return ck.isNaN(t)?t:this._modelType!==Wq.FLOATING_SINGLE&&this._modelType===Wq.FIXED?Math.round(t*this._scale)/this._scale:t}if(e instanceof _k){var n=e;if(this._modelType===Wq.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}},Wq.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===Wq.FLOATING?e=16:this._modelType===Wq.FLOATING_SINGLE?e=6:this._modelType===Wq.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e},Wq.prototype.setScale=function(e){this._scale=Math.abs(e)},Wq.prototype.interfaces_=function(){return[mk,fk]},Wq.prototype.getClass=function(){return Wq},Wq.mostPrecise=function(e,t){return 0<=e.compareTo(t)?e:t},Yq.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Yq.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(Wq,Yq);var Xq=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},jq={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Xq.prototype.readResolve=function(){return Xq.nameToTypeMap.get(this._name)},Xq.prototype.toString=function(){return this._name},Xq.prototype.interfaces_=function(){return[mk]},Xq.prototype.getClass=function(){return Xq},jq.serialVersionUID.get=function(){return-552860263173159e4},jq.nameToTypeMap.get=function(){return new qq},Object.defineProperties(Xq,jq),Wq.Type=Xq,Wq.FIXED=new Xq("FIXED"),Wq.FLOATING=new Xq("FLOATING"),Wq.FLOATING_SINGLE=new Xq("FLOATING SINGLE");var Kq=function e(){this._precisionModel=new Wq,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Ek(arguments[0],vk)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Wq&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Qq={serialVersionUID:{configurable:!0}};Kq.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new _k(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new _k(e.getMinX(),e.getMinY()),new _k(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new _k(e.getMinX(),e.getMinY()),new _k(e.getMinX(),e.getMaxY()),new _k(e.getMaxX(),e.getMaxY()),new _k(e.getMaxX(),e.getMinY()),new _k(e.getMinX(),e.getMinY())]),null)},Kq.prototype.createLineString=function(e){return e?e instanceof Array?new wq(this.getCoordinateSequenceFactory().create(e),this):Ek(e,Nk)?new wq(e,this):void 0:new wq(this.getCoordinateSequenceFactory().create([]),this)},Kq.prototype.createMultiLineString=function(e){return 0===arguments.length?new pq(null,this):1===arguments.length?new pq(e,this):void 0},Kq.prototype.buildGeometry=function(e){for(var t=null,n=!1,r=!1,i=e.iterator();i.hasNext();){var o=i.next(),a=o.getClass();null===t&&(t=a),a!==t&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===t)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(Kq.toGeometryArray(e));var s=e.iterator().next();if(1<e.size()){if(s instanceof Oq)return this.createMultiPolygon(Kq.toPolygonArray(e));if(s instanceof wq)return this.createMultiLineString(Kq.toLineStringArray(e));if(s instanceof Iq)return this.createMultiPoint(Kq.toPointArray(e));$k.shouldNeverReachHere("Unhandled class: "+s.getClass().getName())}return s},Kq.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)},Kq.prototype.createPoint=function(e){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(e instanceof _k){var t=e;return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(Ek(e,Nk))return new Iq(e,this)}},Kq.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},Kq.prototype.createPolygon=function(e,t){if(0===arguments.length)return new Oq(null,null,this);if(1===arguments.length){if(Ek(e,Nk))return this.createPolygon(this.createLinearRing(e));if(e instanceof Array)return this.createPolygon(this.createLinearRing(e));if(e instanceof Nq)return this.createPolygon(e,null)}else if(2===arguments.length){return new Oq(e,t,this)}},Kq.prototype.getSRID=function(){return this._SRID},Kq.prototype.createGeometryCollection=function(e){return 0===arguments.length?new fq(null,this):1===arguments.length?new fq(e,this):void 0},Kq.prototype.createGeometry=function(e){return new Pq(this).edit(e,{edit:function(){if(2===arguments.length){var e=arguments[0];return this._coordinateSequenceFactory.create(e)}}})},Kq.prototype.getPrecisionModel=function(){return this._precisionModel},Kq.prototype.createLinearRing=function(e){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(e instanceof Array){var t=e;return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Ek(e,Nk))return new Nq(e,this)}},Kq.prototype.createMultiPolygon=function(e){return 0===arguments.length?new Rq(null,this):1===arguments.length?new Rq(e,this):void 0},Kq.prototype.createMultiPoint=function(e){if(0===arguments.length)return new Lq(null,this);if(1===arguments.length){if(e instanceof Array)return new Lq(e,this);if(e instanceof Array){var t=e;return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Ek(e,Nk)){var n=e;if(null===n)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(n.size()).fill(null),i=0;i<n.size();i++){var o=this.getCoordinateSequenceFactory().create(1,n.getDimension());Sq.copy(n,i,o,0,1),r[i]=this.createPoint(o)}return this.createMultiPoint(r)}}},Kq.prototype.interfaces_=function(){return[mk]},Kq.prototype.getClass=function(){return Kq},Kq.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.toGeometryArray=function(e){if(null===e)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.getDefaultCoordinateSequenceFactory=function(){return Vq.instance()},Kq.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},Kq.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)},Qq.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(Kq,Qq);function Zq(e){this.geometryFactory=e||new Kq}var Jq=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];Zq.prototype.read=function(e){var t="string"==typeof e?JSON.parse(e):e,n=t.type;if(!$q[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==Jq.indexOf(n)?$q[n].apply(this,[t.coordinates]):"GeometryCollection"===n?$q[n].apply(this,[t.geometries]):$q[n].apply(this,[t])},Zq.prototype.write=function(e){var t=e.getGeometryType();if(!eH[t])throw new Error("Geometry is not supported");return eH[t].apply(this,[e])};var $q={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var r=e.geometry.type;if(!$q[r])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=$q.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t={};if(e.features){t.features=[];for(var n=0;n<e.features.length;++n)t.features.push(this.read(e.features[n]))}return e.bbox&&(t.bbox=this.parse.bbox.apply(this,[e.bbox])),t},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(new _k(r[0],r[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new _k(e[0],e[1]),new _k(e[2],e[1]),new _k(e[2],e[3]),new _k(e[0],e[3]),new _k(e[0],e[1])])},Point:function(e){var t=new _k(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=[],n=0;n<e.length;++n)t.push($q.Point.apply(this,[e[n]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(e){var t=$q.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=[],n=0;n<e.length;++n)t.push($q.LineString.apply(this,[e[n]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(e){for(var t=$q.coordinates.apply(this,[e[0]]),n=this.geometryFactory.createLinearRing(t),r=[],i=1;i<e.length;++i){var o=e[i],a=$q.coordinates.apply(this,[o]),s=this.geometryFactory.createLinearRing(a);r.push(s)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push($q.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(this.read(r))}return this.geometryFactory.createGeometryCollection(t)}},eH={coordinate:function(e){return[e.x,e.y]},Point:function(e){return{type:"Point",coordinates:eH.coordinate.apply(this,[e.getCoordinate()])}},MultiPoint:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=eH.Point.apply(this,[r]);t.push(i.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(e){for(var t=[],n=e.getCoordinates(),r=0;r<n.length;++r){var i=n[r];t.push(eH.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:t}},MultiLineString:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=eH.LineString.apply(this,[r]);t.push(i.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(e){var t=[],n=eH.LineString.apply(this,[e._shell]);t.push(n.coordinates);for(var r=0;r<e._holes.length;++r){var i=e._holes[r],o=eH.LineString.apply(this,[i]);t.push(o.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=eH.Polygon.apply(this,[r]);t.push(i.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=r.getGeometryType();t.push(eH[i].apply(this,[r]))}return{type:"GeometryCollection",geometries:t}}},tH=function(e){this.geometryFactory=e||new Kq,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Zq(this.geometryFactory)};tH.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===Wq.FIXED&&this.reducePrecision(t),t},tH.prototype.reducePrecision=function(e){var t,n;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(t=0,n=e.points.length;t<n;t++)this.precisionModel.makePrecise(e.points[t]);else if(e.geometries)for(t=0,n=e.geometries.length;t<n;t++)this.reducePrecision(e.geometries[t])};var nH=function(){this.parser=new Zq(this.geometryFactory)};nH.prototype.write=function(e){return this.parser.write(e)};function rH(){}var iH={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function oH(e){this.message=e||""}function aH(){this.array_=[]}rH.prototype.interfaces_=function(){return[]},rH.prototype.getClass=function(){return rH},rH.opposite=function(e){return e===rH.LEFT?rH.RIGHT:e===rH.RIGHT?rH.LEFT:e},iH.ON.get=function(){return 0},iH.LEFT.get=function(){return 1},iH.RIGHT.get=function(){return 2},Object.defineProperties(rH,iH),(oH.prototype=new Error).name="EmptyStackException",(aH.prototype=new SG).add=function(e){return this.array_.push(e),!0},aH.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]},aH.prototype.push=function(e){return this.array_.push(e),e},aH.prototype.pop=function(e){if(0===this.array_.length)throw new oH;return this.array_.pop()},aH.prototype.peek=function(){if(0===this.array_.length)throw new oH;return this.array_[this.array_.length-1]},aH.prototype.empty=function(){return 0===this.array_.length},aH.prototype.isEmpty=function(){return this.empty()},aH.prototype.search=function(e){return this.array_.indexOf(e)},aH.prototype.size=function(){return this.array_.length},aH.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e};function sH(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}sH.prototype.getCoordinate=function(){return this._minCoord},sH.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n},sH.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();$k.isTrue(0<this._minIndex&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],r=sG.computeOrientation(this._minCoord,n,t),i=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&r===sG.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&r===sG.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)},sH.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var r=rH.LEFT;return n[t].y<n[t+1].y&&(r=rH.RIGHT),r},sH.prototype.getEdge=function(){return this._orientedDe},sH.prototype.checkForRightmostCoordinate=function(e){for(var t=e.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this._minCoord||t[n].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=n,this._minCoord=t[n])},sH.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},sH.prototype.findEdge=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}$k.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===rH.LEFT&&(this._orientedDe=this._minDe.getSym())},sH.prototype.interfaces_=function(){return[]},sH.prototype.getClass=function(){return sH};var uH,lH=((uH=jk)&&(cH.__proto__=uH),cH.prototype=Object.create(uH&&uH.prototype),(cH.prototype.constructor=cH).prototype.getCoordinate=function(){return this.pt},cH.prototype.interfaces_=function(){return[]},cH.prototype.getClass=function(){return cH},cH.msgWithCoord=function(e,t){return t?e:e+" [ "+t+" ]"},cH);function cH(e,t){uH.call(this,cH.msgWithCoord(e,t)),this.pt=t?new _k(t):null,this.name="TopologyException"}function hH(){this.array_=[]}hH.prototype.addLast=function(e){this.array_.push(e)},hH.prototype.removeFirst=function(){return this.array_.shift()},hH.prototype.isEmpty=function(){return 0===this.array_.length};function fH(){this._finder=null,this._dirEdgeList=new IG,this._nodes=new IG,this._rightMostCoord=null,this._env=null,this._finder=new sH}fH.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){e.next().setVisited(!1)}},fH.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},fH.prototype.computeNodeDepth=function(e){for(var t=null,n=e.getEdges().iterator();n.hasNext();){var r=n.next();if(r.isVisited()||r.getSym().isVisited()){t=r;break}}if(null===t)throw new lH("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(t);for(var i=e.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},fH.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(rH.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)},fH.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},fH.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();1<=t.getDepth(rH.RIGHT)&&t.getDepth(rH.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}},fH.prototype.computeDepths=function(e){var t=new WG,n=new hH,r=e.getNode();for(n.addLast(r),t.add(r),e.setVisited(!0);!n.isEmpty();){var i=n.removeFirst();t.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var a,s=o.next().getSym();s.isVisited()||(a=s.getNode(),t.contains(a)||(n.addLast(a),t.add(a)))}}},fH.prototype.compareTo=function(e){return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},fH.prototype.getEnvelope=function(){if(null===this._env){for(var e=new Vk,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),r=0;r<n.length-1;r++)e.expandToInclude(n[r]);this._env=e}return this._env},fH.prototype.addReachable=function(e){var t=new aH;for(t.add(e);!t.empty();){var n=t.pop();this.add(n,t)}},fH.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(rH.LEFT,e.getDepth(rH.RIGHT)),t.setDepth(rH.RIGHT,e.getDepth(rH.LEFT))},fH.prototype.add=function(e,t){e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var r=n.next();this._dirEdgeList.add(r);var i=r.getSym().getNode();i.isVisited()||t.push(i)}},fH.prototype.getNodes=function(){return this._nodes},fH.prototype.getDirectedEdges=function(){return this._dirEdgeList},fH.prototype.interfaces_=function(){return[fk]},fH.prototype.getClass=function(){return fH};function pH(){var e,t,n;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[rH.ON]=i}else if(arguments[0]instanceof pH){var o=arguments[0];if(this.init(o.location.length),null!==o)for(var a=0;a<this.location.length;a++)this.location[a]=o.location[a]}}else 3===arguments.length&&(e=arguments[0],t=arguments[1],n=arguments[2],this.init(3),this.location[rH.ON]=e,this.location[rH.LEFT]=t,this.location[rH.RIGHT]=n)}pH.prototype.setAllLocations=function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e},pH.prototype.isNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==xk.NONE)return!1;return!0},pH.prototype.setAllLocationsIfNull=function(e){for(var t=0;t<this.location.length;t++)this.location[t]===xk.NONE&&(this.location[t]=e)},pH.prototype.isLine=function(){return 1===this.location.length},pH.prototype.merge=function(e){var t;e.location.length>this.location.length&&((t=new Array(3).fill(null))[rH.ON]=this.location[rH.ON],t[rH.LEFT]=xk.NONE,t[rH.RIGHT]=xk.NONE,this.location=t);for(var n=0;n<this.location.length;n++)this.location[n]===xk.NONE&&n<e.location.length&&(this.location[n]=e.location[n])},pH.prototype.getLocations=function(){return this.location},pH.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[rH.LEFT];this.location[rH.LEFT]=this.location[rH.RIGHT],this.location[rH.RIGHT]=e},pH.prototype.toString=function(){var e=new Ck;return 1<this.location.length&&e.append(xk.toLocationSymbol(this.location[rH.LEFT])),e.append(xk.toLocationSymbol(this.location[rH.ON])),1<this.location.length&&e.append(xk.toLocationSymbol(this.location[rH.RIGHT])),e.toString()},pH.prototype.setLocations=function(e,t,n){this.location[rH.ON]=e,this.location[rH.LEFT]=t,this.location[rH.RIGHT]=n},pH.prototype.get=function(e){return e<this.location.length?this.location[e]:xk.NONE},pH.prototype.isArea=function(){return 1<this.location.length},pH.prototype.isAnyNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===xk.NONE)return!0;return!1},pH.prototype.setLocation=function(e,t){1===arguments.length?this.setLocation(rH.ON,e):2===arguments.length&&(this.location[e]=t)},pH.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(xk.NONE)},pH.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]},pH.prototype.allPositionsEqual=function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0},pH.prototype.interfaces_=function(){return[]},pH.prototype.getClass=function(){return pH};function dH(){var e,t,n,r,i,o,a,s,u,l,c;this.elt=new Array(2).fill(null),1===arguments.length?Number.isInteger(arguments[0])?(e=arguments[0],this.elt[0]=new pH(e),this.elt[1]=new pH(e)):arguments[0]instanceof dH&&(t=arguments[0],this.elt[0]=new pH(t.elt[0]),this.elt[1]=new pH(t.elt[1])):2===arguments.length?(n=arguments[0],r=arguments[1],this.elt[0]=new pH(xk.NONE),this.elt[1]=new pH(xk.NONE),this.elt[n].setLocation(r)):3===arguments.length?(i=arguments[0],o=arguments[1],a=arguments[2],this.elt[0]=new pH(i,o,a),this.elt[1]=new pH(i,o,a)):4===arguments.length&&(s=arguments[0],u=arguments[1],l=arguments[2],c=arguments[3],this.elt[0]=new pH(xk.NONE,xk.NONE,xk.NONE),this.elt[1]=new pH(xk.NONE,xk.NONE,xk.NONE),this.elt[s].setLocations(u,l,c))}dH.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e},dH.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)},dH.prototype.isNull=function(e){return this.elt[e].isNull()},dH.prototype.setAllLocationsIfNull=function(e,t){var n;1===arguments.length?(n=e,this.setAllLocationsIfNull(0,n),this.setAllLocationsIfNull(1,n)):2===arguments.length&&this.elt[e].setAllLocationsIfNull(t)},dH.prototype.isLine=function(e){return this.elt[e].isLine()},dH.prototype.merge=function(e){for(var t=0;t<2;t++)null===this.elt[t]&&null!==e.elt[t]?this.elt[t]=new pH(e.elt[t]):this.elt[t].merge(e.elt[t])},dH.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},dH.prototype.getLocation=function(e,t){return 1===arguments.length?this.elt[e].get(rH.ON):2===arguments.length?this.elt[e].get(t):void 0},dH.prototype.toString=function(){var e=new Ck;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()},dH.prototype.isArea=function(e){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[e].isArea():void 0},dH.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()},dH.prototype.setLocation=function(e,t,n){2===arguments.length?this.elt[e].setLocation(rH.ON,t):3===arguments.length&&this.elt[e].setLocation(t,n)},dH.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)},dH.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)},dH.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new pH(this.elt[e].location[0]))},dH.prototype.interfaces_=function(){return[]},dH.prototype.getClass=function(){return dH},dH.toLineLabel=function(e){for(var t=new dH(xk.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};function mH(e,t){this._startDe=null,this._maxNodeDegree=-1,this._edges=new IG,this._pts=new IG,this._label=new dH(xk.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new IG,this._geometryFactory=null;var n=e;this._geometryFactory=t,this.computePoints(n),this.computeRing()}mH.prototype.computeRing=function(){if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=sG.isCCW(this._ring.getCoordinates())},mH.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},mH.prototype.computePoints=function(e){var t=this._startDe=e,n=!0;do{if(null===t)throw new lH("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new lH("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var r=t.getLabel();$k.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)},mH.prototype.getLinearRing=function(){return this._ring},mH.prototype.getCoordinate=function(e){return this._pts.get(e)},mH.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},mH.prototype.addPoints=function(e,t,n){var r=e.getCoordinates();if(t){var i=1;n&&(i=0);for(var o=i;o<r.length;o++)this._pts.add(r[o])}else{var a=r.length-2;n&&(a=r.length-1);for(var s=a;0<=s;s--)this._pts.add(r[s])}},mH.prototype.isHole=function(){return this._isHole},mH.prototype.setInResult=function(){for(var e=this._startDe;e.getEdge().setInResult(!0),(e=e.getNext())!==this._startDe;);},mH.prototype.containsPoint=function(e){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(e))return!1;if(!sG.isPointInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();){if(n.next().containsPoint(e))return!1}return!0},mH.prototype.addHole=function(e){this._holes.add(e)},mH.prototype.isShell=function(){return null===this._shell},mH.prototype.getLabel=function(){return this._label},mH.prototype.getEdges=function(){return this._edges},mH.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},mH.prototype.getShell=function(){return this._shell},mH.prototype.mergeLabel=function(e,t){if(1===arguments.length){var n=e;this.mergeLabel(n,0),this.mergeLabel(n,1)}else if(2===arguments.length){var r=t,i=e.getLocation(r,rH.RIGHT);if(i===xk.NONE)return null;if(this._label.getLocation(r)===xk.NONE)return this._label.setLocation(r,i),null}},mH.prototype.setShell=function(e){null!==(this._shell=e)&&e.addHole(this)},mH.prototype.toPolygon=function(e){for(var t=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)t[n]=this._holes.get(n).getLinearRing();return e.createPolygon(this.getLinearRing(),t)},mH.prototype.interfaces_=function(){return[]},mH.prototype.getClass=function(){return mH};var _H,gH=((_H=mH)&&(yH.__proto__=_H),((yH.prototype=Object.create(_H&&_H.prototype)).constructor=yH).prototype.setEdgeRing=function(e,t){e.setMinEdgeRing(t)},yH.prototype.getNext=function(e){return e.getNextMin()},yH.prototype.interfaces_=function(){return[]},yH.prototype.getClass=function(){return yH},yH);function yH(){var e=arguments[0],t=arguments[1];_H.call(this,e,t)}var vH,xH=((vH=mH)&&(bH.__proto__=vH),((bH.prototype=Object.create(vH&&vH.prototype)).constructor=bH).prototype.buildMinimalRings=function(){for(var e,t=new IG,n=this._startDe;null===n.getMinEdgeRing()&&(e=new gH(n,this._geometryFactory),t.add(e)),(n=n.getNext())!==this._startDe;);return t},bH.prototype.setEdgeRing=function(e,t){e.setEdgeRing(t)},bH.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){for(var e=this._startDe;e.getNode().getEdges().linkMinimalDirectedEdges(this),(e=e.getNext())!==this._startDe;);},bH.prototype.getNext=function(e){return e.getNext()},bH.prototype.interfaces_=function(){return[]},bH.prototype.getClass=function(){return bH},bH);function bH(){var e=arguments[0],t=arguments[1];vH.call(this,e,t)}function EH(e){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length||1===arguments.length&&(this._label=e)}EH.prototype.setVisited=function(e){this._isVisited=e},EH.prototype.setInResult=function(e){this._isInResult=e},EH.prototype.isCovered=function(){return this._isCovered},EH.prototype.isCoveredSet=function(){return this._isCoveredSet},EH.prototype.setLabel=function(e){this._label=e},EH.prototype.getLabel=function(){return this._label},EH.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0},EH.prototype.updateIM=function(e){$k.isTrue(2<=this._label.getGeometryCount(),"found partial label"),this.computeIM(e)},EH.prototype.isInResult=function(){return this._isInResult},EH.prototype.isVisited=function(){return this._isVisited},EH.prototype.interfaces_=function(){return[]},EH.prototype.getClass=function(){return EH};var TH,SH=((TH=EH)&&(CH.__proto__=TH),((CH.prototype=Object.create(TH&&TH.prototype)).constructor=CH).prototype.isIncidentEdgeInResult=function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1},CH.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},CH.prototype.getCoordinate=function(){return this._coord},CH.prototype.print=function(e){e.println("node "+this._coord+" lbl: "+this._label)},CH.prototype.computeIM=function(){},CH.prototype.computeMergedLocation=function(e,t){var n,r=xk.NONE,r=this._label.getLocation(t);return e.isNull(t)||(n=e.getLocation(t),r!==xk.BOUNDARY&&(r=n)),r},CH.prototype.setLabel=function(e,t){if(2!==arguments.length)return TH.prototype.setLabel.apply(this,arguments);var n=e,r=t;null===this._label?this._label=new dH(n,r):this._label.setLocation(n,r)},CH.prototype.getEdges=function(){return this._edges},CH.prototype.mergeLabel=function(e){if(e instanceof CH)this.mergeLabel(e._label);else if(e instanceof dH)for(var t=e,n=0;n<2;n++){var r=this.computeMergedLocation(t,n);this._label.getLocation(n)===xk.NONE&&this._label.setLocation(n,r)}},CH.prototype.add=function(e){this._edges.insert(e),e.setNode(this)},CH.prototype.setLabelBoundary=function(e){if(null===this._label)return null;var t=xk.NONE;null!==this._label&&(t=this._label.getLocation(e));var n=null;switch(t){case xk.BOUNDARY:n=xk.INTERIOR;break;case xk.INTERIOR:default:n=xk.BOUNDARY}this._label.setLocation(e,n)},CH.prototype.interfaces_=function(){return[]},CH.prototype.getClass=function(){return CH},CH);function CH(){TH.call(this),this._coord=null,this._edges=null;var e=arguments[0],t=arguments[1];this._coord=e,this._edges=t,this._label=new dH(0,xk.NONE)}function wH(e){this.nodeMap=new nq,this.nodeFact=null,this.nodeFact=e}wH.prototype.find=function(e){return this.nodeMap.get(e)},wH.prototype.addNode=function(e){if(e instanceof _k){var t=e,n=this.nodeMap.get(t);return null===n&&(n=this.nodeFact.createNode(t),this.nodeMap.put(t,n)),n}if(e instanceof SH){var r=e,i=this.nodeMap.get(r.getCoordinate());return null===i?(this.nodeMap.put(r.getCoordinate(),r),r):(i.mergeLabel(r),i)}},wH.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){t.next().print(e)}},wH.prototype.iterator=function(){return this.nodeMap.values().iterator()},wH.prototype.values=function(){return this.nodeMap.values()},wH.prototype.getBoundaryNodes=function(e){for(var t=new IG,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(e)===xk.BOUNDARY&&t.add(r)}return t},wH.prototype.add=function(e){var t=e.getCoordinate();this.addNode(t).add(e)},wH.prototype.interfaces_=function(){return[]},wH.prototype.getClass=function(){return wH};function AH(){}var IH={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};AH.prototype.interfaces_=function(){return[]},AH.prototype.getClass=function(){return AH},AH.isNorthern=function(e){return e===AH.NE||e===AH.NW},AH.isOpposite=function(e,t){return e!==t&&2==(e-t+4)%4},AH.commonHalfPlane=function(e,t){if(e===t)return e;if(2==(e-t+4)%4)return-1;var n=e<t?e:t;return 0===n&&3===(t<e?e:t)?3:n},AH.isInHalfPlane=function(e,t){return t===AH.SE?e===AH.SE||e===AH.SW:e===t||e===t+1},AH.quadrant=function(e,t){if("number"==typeof e&&"number"==typeof t){if(0===e&&0===t)throw new lk;return 0<=e?0<=t?AH.NE:AH.SE:0<=t?AH.NW:AH.SW}if(e instanceof _k&&t instanceof _k){if(t.x===e.x&&t.y===e.y)throw new lk;return t.x>=e.x?t.y>=e.y?AH.NE:AH.SE:t.y>=e.y?AH.NW:AH.SW}},IH.NE.get=function(){return 0},IH.NW.get=function(){return 1},IH.SW.get=function(){return 2},IH.SE.get=function(){return 3},Object.defineProperties(AH,IH);function PH(e,t,n,r){var i,o,a,s,u;this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length?this._edge=e:3===arguments.length?(i=t,o=n,this._edge=e,this.init(i,o),this._label=null):4===arguments.length&&(a=t,s=n,u=r,this._edge=e,this.init(a,s),this._label=u)}PH.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:sG.computeOrientation(e._p0,e._p1,this._p1)},PH.prototype.getDy=function(){return this._dy},PH.prototype.getCoordinate=function(){return this._p0},PH.prototype.setNode=function(e){this._node=e},PH.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);e.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)},PH.prototype.compareTo=function(e){return this.compareDirection(e)},PH.prototype.getDirectedCoordinate=function(){return this._p1},PH.prototype.getDx=function(){return this._dx},PH.prototype.getLabel=function(){return this._label},PH.prototype.getEdge=function(){return this._edge},PH.prototype.getQuadrant=function(){return this._quadrant},PH.prototype.getNode=function(){return this._node},PH.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label},PH.prototype.computeLabel=function(){},PH.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=AH.quadrant(this._dx,this._dy),$k.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},PH.prototype.interfaces_=function(){return[fk]},PH.prototype.getClass=function(){return PH};var OH,LH=((OH=PH)&&(NH.__proto__=OH),((NH.prototype=Object.create(OH&&OH.prototype)).constructor=NH).prototype.getNextMin=function(){return this._nextMin},NH.prototype.getDepth=function(e){return this._depth[e]},NH.prototype.setVisited=function(e){this._isVisited=e},NH.prototype.computeDirectedLabel=function(){this._label=new dH(this._edge.getLabel()),this._isForward||this._label.flip()},NH.prototype.getNext=function(){return this._next},NH.prototype.setDepth=function(e,t){if(-999!==this._depth[e]&&this._depth[e]!==t)throw new lH("assigned depths do not match",this.getCoordinate());this._depth[e]=t},NH.prototype.isInteriorAreaEdge=function(){for(var e=!0,t=0;t<2;t++)this._label.isArea(t)&&this._label.getLocation(t,rH.LEFT)===xk.INTERIOR&&this._label.getLocation(t,rH.RIGHT)===xk.INTERIOR||(e=!1);return e},NH.prototype.setNextMin=function(e){this._nextMin=e},NH.prototype.print=function(e){OH.prototype.print.call(this,e),e.print(" "+this._depth[rH.LEFT]+"/"+this._depth[rH.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},NH.prototype.setMinEdgeRing=function(e){this._minEdgeRing=e},NH.prototype.isLineEdge=function(){var e=this._label.isLine(0)||this._label.isLine(1),t=!this._label.isArea(0)||this._label.allPositionsEqual(0,xk.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,xk.EXTERIOR);return e&&t&&n},NH.prototype.setEdgeRing=function(e){this._edgeRing=e},NH.prototype.getMinEdgeRing=function(){return this._minEdgeRing},NH.prototype.getDepthDelta=function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e},NH.prototype.setInResult=function(e){this._isInResult=e},NH.prototype.getSym=function(){return this._sym},NH.prototype.isForward=function(){return this._isForward},NH.prototype.getEdge=function(){return this._edge},NH.prototype.printEdge=function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)},NH.prototype.setSym=function(e){this._sym=e},NH.prototype.setVisitedEdge=function(e){this.setVisited(e),this._sym.setVisited(e)},NH.prototype.setEdgeDepths=function(e,t){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;e===rH.LEFT&&(r=-1);var i=rH.opposite(e),o=t+n*r;this.setDepth(e,t),this.setDepth(i,o)},NH.prototype.getEdgeRing=function(){return this._edgeRing},NH.prototype.isInResult=function(){return this._isInResult},NH.prototype.setNext=function(e){this._next=e},NH.prototype.isVisited=function(){return this._isVisited},NH.prototype.interfaces_=function(){return[]},NH.prototype.getClass=function(){return NH},NH.depthFactor=function(e,t){return e===xk.EXTERIOR&&t===xk.INTERIOR?1:e===xk.INTERIOR&&t===xk.EXTERIOR?-1:0},NH);function NH(){var e,t=arguments[0],n=arguments[1];OH.call(this,t),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],(this._isForward=n)?this.init(t.getCoordinate(0),t.getCoordinate(1)):(e=t.getNumPoints()-1,this.init(t.getCoordinate(e),t.getCoordinate(e-1))),this.computeDirectedLabel()}function RH(){}RH.prototype.createNode=function(e){return new SH(e,null)},RH.prototype.interfaces_=function(){return[]},RH.prototype.getClass=function(){return RH};function DH(e){this._edges=new IG,this._nodes=null,this._edgeEndList=new IG,0===arguments.length?this._nodes=new wH(new RH):1===arguments.length&&(this._nodes=new wH(e))}DH.prototype.printEdges=function(e){e.println("Edges:");for(var t=0;t<this._edges.size();t++){e.println("edge "+t+":");var n=this._edges.get(t);n.print(e),n.eiList.print(e)}},DH.prototype.find=function(e){return this._nodes.find(e)},DH.prototype.addNode=function(e){return e instanceof SH||e instanceof _k?this._nodes.addNode(e):void 0},DH.prototype.getNodeIterator=function(){return this._nodes.iterator()},DH.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){e.next().getEdges().linkResultDirectedEdges()}},DH.prototype.debugPrintln=function(e){Bk.out.println(e)},DH.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(e)===xk.BOUNDARY},DH.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){e.next().getEdges().linkAllDirectedEdges()}},DH.prototype.matchInSameDirection=function(e,t,n,r){return!!e.equals(n)&&(sG.computeOrientation(e,t,r)===sG.COLLINEAR&&AH.quadrant(e,t)===AH.quadrant(n,r))},DH.prototype.getEdgeEnds=function(){return this._edgeEndList},DH.prototype.debugPrint=function(e){Bk.out.print(e)},DH.prototype.getEdgeIterator=function(){return this._edges.iterator()},DH.prototype.findEdgeInSameDirection=function(e,t){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(this.matchInSameDirection(e,t,i[0],i[1]))return r;if(this.matchInSameDirection(e,t,i[i.length-1],i[i.length-2]))return r}return null},DH.prototype.insertEdge=function(e){this._edges.add(e)},DH.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null},DH.prototype.addEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();this._edges.add(n);var r=new LH(n,!0),i=new LH(n,!1);r.setSym(i),i.setSym(r),this.add(r),this.add(i)}},DH.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)},DH.prototype.getNodes=function(){return this._nodes.values()},DH.prototype.findEdge=function(e,t){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(e.equals(i[0])&&t.equals(i[1]))return r}return null},DH.prototype.interfaces_=function(){return[]},DH.prototype.getClass=function(){return DH},DH.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){t.next().getEdges().linkResultDirectedEdges()}};function MH(e){this._geometryFactory=null,this._shellList=new IG,this._geometryFactory=e}MH.prototype.sortShellsAndHoles=function(e,t,n){for(var r=e.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):t.add(i)}},MH.prototype.computePolygons=function(e){for(var t=new IG,n=e.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);t.add(r)}return t},MH.prototype.placeFreeHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();if(null===r.getShell()){var i=this.findEdgeRingContaining(r,e);if(null===i)throw new lH("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(i)}}},MH.prototype.buildMinimalEdgeRings=function(e,t,n){for(var r=new IG,i=e.iterator();i.hasNext();){var o,a,s=i.next();2<s.getMaxNodeDegree()?(s.linkDirectedEdgesForMinimalEdgeRings(),o=s.buildMinimalRings(),null!==(a=this.findShell(o))?(this.placePolygonHoles(a,o),t.add(a)):n.addAll(o)):r.add(s)}return r},MH.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){if(t.next().containsPoint(e))return!0}return!1},MH.prototype.buildMaximalEdgeRings=function(e){for(var t=new IG,n=e.iterator();n.hasNext();){var r,i=n.next();i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()&&(r=new xH(i,this._geometryFactory),t.add(r),r.setInResult())}return t},MH.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(e)}},MH.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},MH.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,a=null,s=t.iterator();s.hasNext();){var u=s.next(),l=u.getLinearRing(),c=l.getEnvelopeInternal();null!==o&&(a=o.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(r)&&sG.isPointInRing(i,l.getCoordinates())&&(h=!0),h&&(null!==o&&!a.contains(c)||(o=u))}return o},MH.prototype.findShell=function(e){for(var t=0,n=null,r=e.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,t++)}return $k.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n},MH.prototype.add=function(e,t){var n,r,i,o,a;1===arguments.length?(n=e,this.add(n.getEdgeEnds(),n.getNodes())):2===arguments.length&&(r=e,DH.linkResultDirectedEdges(t),i=this.buildMaximalEdgeRings(r),o=new IG,a=this.buildMinimalEdgeRings(i,this._shellList,o),this.sortShellsAndHoles(a,this._shellList,o),this.placeFreeHoles(this._shellList,o))},MH.prototype.interfaces_=function(){return[]},MH.prototype.getClass=function(){return MH};function FH(){}FH.prototype.getBounds=function(){},FH.prototype.interfaces_=function(){return[]},FH.prototype.getClass=function(){return FH};function zH(e,t){this._bounds=null,this._item=null;var n=t;this._bounds=e,this._item=n}zH.prototype.getItem=function(){return this._item},zH.prototype.getBounds=function(){return this._bounds},zH.prototype.interfaces_=function(){return[FH,mk]},zH.prototype.getClass=function(){return zH};function BH(){this._size=null,this._items=null,this._size=0,this._items=new IG,this._items.add(null)}BH.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),--this._size,this.reorder(1),e},BH.prototype.size=function(){return this._size},BH.prototype.reorder=function(e){for(var t=null,n=this._items.get(e);2*e<=this._size&&((t=2*e)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(n)<0);e=t)this._items.set(e,this._items.get(t));this._items.set(e,n)},BH.prototype.clear=function(){this._size=0,this._items.clear()},BH.prototype.isEmpty=function(){return 0===this._size},BH.prototype.add=function(e){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,e)},BH.prototype.interfaces_=function(){return[]},BH.prototype.getClass=function(){return BH};function UH(){}UH.prototype.visitItem=function(){},UH.prototype.interfaces_=function(){return[]},UH.prototype.getClass=function(){return UH};function VH(){}VH.prototype.insert=function(){},VH.prototype.remove=function(){},VH.prototype.query=function(){},VH.prototype.interfaces_=function(){return[]},VH.prototype.getClass=function(){return VH};function kH(e){this._childBoundables=new IG,this._bounds=null,this._level=null,0===arguments.length||1===arguments.length&&(this._level=e)}var GH={serialVersionUID:{configurable:!0}};kH.prototype.getLevel=function(){return this._level},kH.prototype.size=function(){return this._childBoundables.size()},kH.prototype.getChildBoundables=function(){return this._childBoundables},kH.prototype.addChildBoundable=function(e){$k.isTrue(null===this._bounds),this._childBoundables.add(e)},kH.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},kH.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},kH.prototype.interfaces_=function(){return[FH,mk]},kH.prototype.getClass=function(){return kH},GH.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(kH,GH);function qH(){}qH.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}},qH.min=function(e){return qH.sort(e),e.get(0)},qH.sort=function(e,t){var n=e.toArray();t?sq.sort(n,t):sq.sort(n);for(var r=e.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])},qH.singletonList=function(e){var t=new IG;return t.add(e),t};function HH(e,t,n){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var r=t,i=n;this._boundable1=e,this._boundable2=r,this._itemDistance=i,this._distance=this.distance()}HH.prototype.expandToQueue=function(e,t){var n=HH.isComposite(this._boundable1),r=HH.isComposite(this._boundable2);if(n&&r)return HH.area(this._boundable1)>HH.area(this._boundable2)?this.expand(this._boundable1,this._boundable2,e,t):this.expand(this._boundable2,this._boundable1,e,t),null;if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new lk},HH.prototype.isLeaves=function(){return!(HH.isComposite(this._boundable1)||HH.isComposite(this._boundable2))},HH.prototype.compareTo=function(e){return this._distance<e._distance?-1:this._distance>e._distance?1:0},HH.prototype.expand=function(e,t,n,r){for(var i=e.getChildBoundables().iterator();i.hasNext();){var o=i.next(),a=new HH(o,t,this._itemDistance);a.getDistance()<r&&n.add(a)}},HH.prototype.getBoundable=function(e){return 0===e?this._boundable1:this._boundable2},HH.prototype.getDistance=function(){return this._distance},HH.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},HH.prototype.interfaces_=function(){return[fk]},HH.prototype.getClass=function(){return HH},HH.area=function(e){return e.getBounds().getArea()},HH.isComposite=function(e){return e instanceof kH};function WH(){var e,t;this._root=null,this._built=!1,this._itemBoundables=new IG,this._nodeCapacity=null,0===arguments.length?(e=WH.DEFAULT_NODE_CAPACITY,this._nodeCapacity=e):1===arguments.length&&($k.isTrue(1<(t=arguments[0]),"Node capacity must be greater than 1"),this._nodeCapacity=t)}var YH={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};WH.prototype.getNodeCapacity=function(){return this._nodeCapacity},WH.prototype.lastNode=function(e){return e.get(e.size()-1)},WH.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();n instanceof kH?e+=this.size(n):n instanceof zH&&(e+=1)}return e}},WH.prototype.removeItem=function(e,t){for(var n=null,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof zH&&i.getItem()===t&&(n=i)}return null!==n&&(e.getChildBoundables().remove(n),!0)},WH.prototype.itemsTree=function(e){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new IG:t}if(1===arguments.length){for(var n=e,r=new IG,i=n.getChildBoundables().iterator();i.hasNext();){var o,a=i.next();a instanceof kH?null!==(o=this.itemsTree(a))&&r.add(o):a instanceof zH?r.add(a.getItem()):$k.shouldNeverReachHere()}return r.size()<=0?null:r}},WH.prototype.insert=function(e,t){$k.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new zH(e,t))},WH.prototype.boundablesAtLevel=function(e,t,n){if(1===arguments.length){var r=e,i=new IG;return this.boundablesAtLevel(r,this._root,i),i}if(3===arguments.length){var o=e,a=t,s=n;if($k.isTrue(-2<o),a.getLevel()===o)return s.add(a),null;for(var u=a.getChildBoundables().iterator();u.hasNext();){var l=u.next();l instanceof kH?this.boundablesAtLevel(o,l,s):($k.isTrue(l instanceof zH),-1===o&&s.add(l))}return null}},WH.prototype.query=function(e,t,n){if(1===arguments.length){var r=e;this.build();var i=new IG;return this.isEmpty()?i:(this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i),i)}if(2===arguments.length){var o=e,a=t;if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.query(o,this._root,a)}else if(3===arguments.length)if(Ek(n,UH)&&e instanceof Object&&t instanceof kH)for(var s=e,u=n,l=t.getChildBoundables(),c=0;c<l.size();c++){var h=l.get(c);this.getIntersectsOp().intersects(h.getBounds(),s)&&(h instanceof kH?this.query(s,h,u):h instanceof zH?u.visitItem(h.getItem()):$k.shouldNeverReachHere())}else if(Ek(n,SG)&&e instanceof Object&&t instanceof kH)for(var f=e,p=n,d=t.getChildBoundables(),m=0;m<d.size();m++){var _=d.get(m);this.getIntersectsOp().intersects(_.getBounds(),f)&&(_ instanceof kH?this.query(f,_,p):_ instanceof zH?p.add(_.getItem()):$k.shouldNeverReachHere())}},WH.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},WH.prototype.getRoot=function(){return this.build(),this._root},WH.prototype.remove=function(e,t,n){if(2===arguments.length){var r=e,i=t;return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.remove(r,this._root,i)}if(3===arguments.length){var o=e,a=t,s=n,u=this.removeItem(a,s);if(u)return!0;for(var l=null,c=a.getChildBoundables().iterator();c.hasNext();){var h=c.next();if(this.getIntersectsOp().intersects(h.getBounds(),o)&&(h instanceof kH&&(u=this.remove(o,h,s)))){l=h;break}}return null!==l&&l.getChildBoundables().isEmpty()&&a.getChildBoundables().remove(l),u}},WH.prototype.createHigherLevels=function(e,t){$k.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)},WH.prototype.depth=function(e){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,n=e.getChildBoundables().iterator();n.hasNext();){var r,i=n.next();i instanceof kH&&(t<(r=this.depth(i))&&(t=r))}return t+1}},WH.prototype.createParentBoundables=function(e,t){$k.isTrue(!e.isEmpty());var n=new IG;n.add(this.createNode(t));var r=new IG(e);qH.sort(r,this.getComparator());for(var i=r.iterator();i.hasNext();){var o=i.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(o)}return n},WH.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},WH.prototype.interfaces_=function(){return[mk]},WH.prototype.getClass=function(){return WH},WH.compareDoubles=function(e,t){return t<e?1:e<t?-1:0},YH.IntersectsOp.get=function(){return jH},YH.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},YH.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(WH,YH);function XH(){}var jH=function(){};XH.prototype.distance=function(){},XH.prototype.interfaces_=function(){return[]},XH.prototype.getClass=function(){return XH};var KH,QH=function(i){function g(e){e=e||g.DEFAULT_NODE_CAPACITY,i.call(this,e)}i&&(g.__proto__=i);var e={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return((g.prototype=Object.create(i&&i.prototype)).constructor=g).prototype.createParentBoundablesFromVerticalSlices=function(e,t){$k.isTrue(0<e.length);for(var n=new IG,r=0;r<e.length;r++)n.addAll(this.createParentBoundablesFromVerticalSlice(e[r],t));return n},g.prototype.createNode=function(e){return new ZH(e)},g.prototype.size=function(){return 0===arguments.length?i.prototype.size.call(this):i.prototype.size.apply(this,arguments)},g.prototype.insert=function(e,t){if(2!==arguments.length)return i.prototype.insert.apply(this,arguments);var n=e,r=t;if(n.isNull())return null;i.prototype.insert.call(this,n,r)},g.prototype.getIntersectsOp=function(){return g.intersectsOp},g.prototype.verticalSlices=function(e,t){for(var n=Math.trunc(Math.ceil(e.size()/t)),r=new Array(t).fill(null),i=e.iterator(),o=0;o<t;o++){r[o]=new IG;for(var a=0;i.hasNext()&&a<n;){var s=i.next();r[o].add(s),a++}}return r},g.prototype.query=function(e,t,n){if(1===arguments.length)return i.prototype.query.call(this,e);2===arguments.length?i.prototype.query.call(this,e,t):3===arguments.length&&(Ek(n,UH)&&e instanceof Object&&t instanceof kH||Ek(n,SG)&&e instanceof Object&&t instanceof kH)&&i.prototype.query.call(this,e,t,n)},g.prototype.getComparator=function(){return g.yComparator},g.prototype.createParentBoundablesFromVerticalSlice=function(e,t){return i.prototype.createParentBoundables.call(this,e,t)},g.prototype.remove=function(e,t){return 2!==arguments.length?i.prototype.remove.apply(this,arguments):i.prototype.remove.call(this,e,t)},g.prototype.depth=function(){return 0===arguments.length?i.prototype.depth.call(this):i.prototype.depth.apply(this,arguments)},g.prototype.createParentBoundables=function(e,t){$k.isTrue(!e.isEmpty());var n=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),r=new IG(e);qH.sort(r,g.xComparator);var i=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(i,t)},g.prototype.nearestNeighbour=function(e,t,n){if(1===arguments.length){if(Ek(e,XH)){var r=e,i=new HH(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(i)}if(e instanceof HH)return this.nearestNeighbour(e,ck.POSITIVE_INFINITY)}else if(2===arguments.length){if(e instanceof g&&Ek(t,XH)){var o=e,a=t,s=new HH(this.getRoot(),o.getRoot(),a);return this.nearestNeighbour(s)}if(e instanceof HH&&"number"==typeof t){var u=e,l=t,c=null,h=new BH;for(h.add(u);!h.isEmpty()&&0<l;){var f=h.poll(),p=f.getDistance();if(l<=p)break;f.isLeaves()?(l=p,c=f):f.expandToQueue(h,l)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var d=n,m=new zH(e,t),_=new HH(this.getRoot(),m,d);return this.nearestNeighbour(_)[0]}},g.prototype.interfaces_=function(){return[VH,mk]},g.prototype.getClass=function(){return g},g.centreX=function(e){return g.avg(e.getMinX(),e.getMaxX())},g.avg=function(e,t){return(e+t)/2},g.centreY=function(e){return g.avg(e.getMinY(),e.getMaxY())},e.STRtreeNode.get=function(){return ZH},e.serialVersionUID.get=function(){return 0x39920f7d5f261e0},e.xComparator.get=function(){return{interfaces_:function(){return[dk]},compare:function(e,t){return i.compareDoubles(g.centreX(e.getBounds()),g.centreX(t.getBounds()))}}},e.yComparator.get=function(){return{interfaces_:function(){return[dk]},compare:function(e,t){return i.compareDoubles(g.centreY(e.getBounds()),g.centreY(t.getBounds()))}}},e.intersectsOp.get=function(){return{interfaces_:function(){return[i.IntersectsOp]},intersects:function(e,t){return e.intersects(t)}}},e.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(g,e),g}(WH),ZH=((KH=kH)&&(JH.__proto__=KH),((JH.prototype=Object.create(KH&&KH.prototype)).constructor=JH).prototype.computeBounds=function(){for(var e=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===e?e=new Vk(n.getBounds()):e.expandToInclude(n.getBounds())}return e},JH.prototype.interfaces_=function(){return[]},JH.prototype.getClass=function(){return JH},JH);function JH(){var e=arguments[0];KH.call(this,e)}function $H(){}$H.prototype.interfaces_=function(){return[]},$H.prototype.getClass=function(){return $H},$H.relativeSign=function(e,t){return e<t?-1:t<e?1:0},$H.compare=function(e,t,n){if(t.equals2D(n))return 0;var r=$H.relativeSign(t.x,n.x),i=$H.relativeSign(t.y,n.y);switch(e){case 0:return $H.compareValue(r,i);case 1:return $H.compareValue(i,r);case 2:return $H.compareValue(i,-r);case 3:return $H.compareValue(-r,i);case 4:return $H.compareValue(-r,-i);case 5:return $H.compareValue(-i,-r);case 6:return $H.compareValue(-i,r);case 7:return $H.compareValue(r,-i)}return $k.shouldNeverReachHere("invalid octant value"),0},$H.compareValue=function(e,t){return e<0?-1:0<e?1:t<0?-1:0<t?1:0};function eW(e,t,n,r){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var i=e,o=t,a=n,s=r;this._segString=i,this.coord=new _k(o),this.segmentIndex=a,this._segmentOctant=s,this._isInterior=!o.equals2D(i.getCoordinate(a))}eW.prototype.getCoordinate=function(){return this.coord},eW.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)},eW.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:$H.compare(this._segmentOctant,this.coord,t.coord)},eW.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===e},eW.prototype.isInterior=function(){return this._isInterior},eW.prototype.interfaces_=function(){return[fk]},eW.prototype.getClass=function(){return eW};function tW(e){this._nodeMap=new nq,this._edge=null,this._edge=e}tW.prototype.getSplitCoordinates=function(){var e=new DG;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next();this.addEdgeCoordinates(n,r,e),n=r}return e.toCoordinateArray()},tW.prototype.addCollapsedNodes=function(){var e=new IG;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var n=t.next().intValue();this.add(this._edge.getCoordinate(n),n)}},tW.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){t.next().print(e)}},tW.prototype.findCollapsesFromExistingVertices=function(e){for(var t=0;t<this._edge.size()-2;t++){var n=this._edge.getCoordinate(t),r=this._edge.getCoordinate(t+2);n.equals2D(r)&&e.add(new wk(t+1))}},tW.prototype.addEdgeCoordinates=function(e,t,n){var r=this._edge.getCoordinate(t.segmentIndex),i=t.isInterior()||!t.coord.equals2D(r);n.add(new _k(e.coord),!1);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)n.add(this._edge.getCoordinate(o));i&&n.add(new _k(t.coord))},tW.prototype.iterator=function(){return this._nodeMap.values().iterator()},tW.prototype.addSplitEdges=function(e){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next(),i=this.createSplitEdge(n,r);e.add(i),n=r}},tW.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,1===r&&(n[0]=e.segmentIndex+1,!0)},tW.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=new Array(1).fill(null),n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();this.findCollapseIndex(r,i,t)&&e.add(new wk(t[0])),r=i}},tW.prototype.getEdge=function(){return this._edge},tW.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)},tW.prototype.createSplitEdge=function(e,t){var n=t.segmentIndex-e.segmentIndex+2,r=this._edge.getCoordinate(t.segmentIndex),i=t.isInterior()||!t.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),a=0;o[a++]=new _k(e.coord);for(var s=e.segmentIndex+1;s<=t.segmentIndex;s++)o[a++]=this._edge.getCoordinate(s);return i&&(o[a]=new _k(t.coord)),new oW(o,this._edge.getData())},tW.prototype.add=function(e,t){var n=new eW(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(n);return null!==r?($k.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)},tW.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new jk("bad split edge start point at "+n);var r=e.get(e.size()-1).getCoordinates(),i=r[r.length-1];if(!i.equals2D(t[t.length-1]))throw new jk("bad split edge end point at "+i)},tW.prototype.interfaces_=function(){return[]},tW.prototype.getClass=function(){return tW};function nW(){}nW.prototype.interfaces_=function(){return[]},nW.prototype.getClass=function(){return nW},nW.octant=function(e,t){if("number"==typeof e&&"number"==typeof t){var n=e,r=t;if(0===n&&0===r)throw new lk;var i=Math.abs(n),o=Math.abs(r);return 0<=n?0<=r?o<=i?0:1:o<=i?7:6:0<=r?o<=i?3:2:o<=i?4:5}if(e instanceof _k&&t instanceof _k){var a=t.x-e.x,s=t.y-e.y;if(0==a&&0==s)throw new lk;return nW.octant(a,s)}};function rW(){}rW.prototype.getCoordinates=function(){},rW.prototype.size=function(){},rW.prototype.getCoordinate=function(){},rW.prototype.isClosed=function(){},rW.prototype.setData=function(){},rW.prototype.getData=function(){},rW.prototype.interfaces_=function(){return[]},rW.prototype.getClass=function(){return rW};function iW(){}iW.prototype.addIntersection=function(){},iW.prototype.interfaces_=function(){return[rW]},iW.prototype.getClass=function(){return iW};var oW=function(e,t){this._nodeList=new tW(this),this._pts=null,this._data=null;var n=t;this._pts=e,this._data=n};oW.prototype.getCoordinates=function(){return this._pts},oW.prototype.size=function(){return this._pts.length},oW.prototype.getCoordinate=function(e){return this._pts[e]},oW.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},oW.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))},oW.prototype.setData=function(e){this._data=e},oW.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:nW.octant(e,t)},oW.prototype.getData=function(){return this._data},oW.prototype.addIntersection=function(e,t,n,r){var i,o;2===arguments.length?this.addIntersectionNode(e,t):4===arguments.length&&(i=t,o=new _k(e.getIntersection(r)),this.addIntersection(o,i))},oW.prototype.toString=function(){return Hk.toLineString(new Bq(this._pts))},oW.prototype.getNodeList=function(){return this._nodeList},oW.prototype.addIntersectionNode=function(e,t){var n,r=t,i=r+1;return i<this._pts.length&&(n=this._pts[i],e.equals2D(n)&&(r=i)),this._nodeList.add(e,r)},oW.prototype.addIntersections=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,n,r)},oW.prototype.interfaces_=function(){return[iW]},oW.prototype.getClass=function(){return oW},oW.getNodedSubstrings=function(e,t){if(1===arguments.length){var n=e,r=new IG;return oW.getNodedSubstrings(n,r),r}if(2===arguments.length)for(var i=t,o=e.iterator();o.hasNext();){o.next().getNodeList().addSplitEdges(i)}};function aW(e,t,n,r){var i,o,a;this.p0=null,this.p1=null,0===arguments.length?(this.p0=new _k,this.p1=new _k):1===arguments.length?(i=e,this.p0=new _k(i.p0),this.p1=new _k(i.p1)):2===arguments.length?(this.p0=e,this.p1=t):4===arguments.length&&(o=n,a=r,this.p0=new _k(e,t),this.p1=new _k(o,a))}var sW={serialVersionUID:{configurable:!0}};aW.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},aW.prototype.orientationIndex=function(e){if(e instanceof aW){var t=e,n=sG.orientationIndex(this.p0,this.p1,t.p0),r=sG.orientationIndex(this.p0,this.p1,t.p1);return 0<=n&&0<=r?Math.max(n,r):n<=0&&r<=0?Math.max(n,r):0}if(e instanceof _k)return sG.orientationIndex(this.p0,this.p1,e)},aW.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])},aW.prototype.isVertical=function(){return this.p0.x===this.p1.x},aW.prototype.equals=function(e){if(!(e instanceof aW))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)},aW.prototype.intersection=function(e){var t=new rG;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null},aW.prototype.project=function(e){if(e instanceof _k){var t=e;if(t.equals(this.p0)||t.equals(this.p1))return new _k(t);var n=this.projectionFactor(t),r=new _k;return r.x=this.p0.x+n*(this.p1.x-this.p0.x),r.y=this.p0.y+n*(this.p1.y-this.p0.y),r}if(e instanceof aW){var i=e,o=this.projectionFactor(i.p0),a=this.projectionFactor(i.p1);if(1<=o&&1<=a)return null;if(o<=0&&a<=0)return null;var s=this.project(i.p0);o<0&&(s=this.p0),1<o&&(s=this.p1);var u=this.project(i.p1);return a<0&&(u=this.p0),1<a&&(u=this.p1),new aW(s,u)}},aW.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},aW.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},aW.prototype.getCoordinate=function(e){return 0===e?this.p0:this.p1},aW.prototype.distancePerpendicular=function(e){return sG.distancePointLinePerpendicular(e,this.p0,this.p1)},aW.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},aW.prototype.midPoint=function(){return aW.midPoint(this.p0,this.p1)},aW.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=t*t+n*n;return r<=0?ck.NaN:((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/r},aW.prototype.closestPoints=function(e){var t=this.intersection(e);if(null!==t)return[t,t];var n=new Array(2).fill(null),r=ck.MAX_VALUE,i=null,o=this.closestPoint(e.p0),r=o.distance(e.p0);n[0]=o,n[1]=e.p0;var a=this.closestPoint(e.p1);(i=a.distance(e.p1))<r&&(r=i,n[0]=a,n[1]=e.p1);var s=e.closestPoint(this.p0);(i=s.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=s);var u=e.closestPoint(this.p1);return(i=u.distance(this.p1))<r&&(r=i,n[0]=this.p1,n[1]=u),n},aW.prototype.closestPoint=function(e){var t=this.projectionFactor(e);return 0<t&&t<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1},aW.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},aW.prototype.getLength=function(){return this.p0.distance(this.p1)},aW.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)},aW.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e},aW.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)},aW.prototype.lineIntersection=function(e){try{return Uk.intersection(this.p0,this.p1,e.p0,e.p1)}catch(e){if(!(e instanceof Fk))throw e}return null},aW.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},aW.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(i*i+o*o),s=0,u=0;if(0!==t){if(a<=0)throw new Error("Cannot compute offset from zero-length line segment");s=t*i/a,u=t*o/a}return new _k(n-u,r+s)},aW.prototype.setCoordinates=function(e,t){var n,r;1===arguments.length?this.setCoordinates(e.p0,e.p1):2===arguments.length&&(n=e,r=t,this.p0.x=n.x,this.p0.y=n.y,this.p1.x=r.x,this.p1.y=r.y)},aW.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(1<t||ck.isNaN(t))&&(t=1),t},aW.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},aW.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},aW.prototype.distance=function(e){return e instanceof aW?sG.distanceLineLine(this.p0,this.p1,e.p0,e.p1):e instanceof _k?sG.distancePointLine(e,this.p0,this.p1):void 0},aW.prototype.pointAlong=function(e){var t=new _k;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t},aW.prototype.hashCode=function(){var e=ck.doubleToLongBits(this.p0.x);e^=31*ck.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),n=ck.doubleToLongBits(this.p1.x);return n^=31*ck.doubleToLongBits(this.p1.y),t^(Math.trunc(n)^Math.trunc(n>>32))},aW.prototype.interfaces_=function(){return[fk,mk]},aW.prototype.getClass=function(){return aW},aW.midPoint=function(e,t){return new _k((e.x+t.x)/2,(e.y+t.y)/2)},sW.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(aW,sW);function uW(){this.tempEnv1=new Vk,this.tempEnv2=new Vk,this._overlapSeg1=new aW,this._overlapSeg2=new aW}uW.prototype.overlap=function(e,t,n,r){var i,o;2===arguments.length||4===arguments.length&&(i=n,o=r,e.getLineSegment(t,this._overlapSeg1),i.getLineSegment(o,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2))},uW.prototype.interfaces_=function(){return[]},uW.prototype.getClass=function(){return uW};function lW(e,t,n,r){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var i=t,o=n,a=r;this._pts=e,this._start=i,this._end=o,this._context=a}lW.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]},lW.prototype.computeSelect=function(e,t,n,r){var i=this._pts[t],o=this._pts[n];if(r.tempEnv1.init(i,o),n-t==1)return r.select(this,t),null;if(!e.intersects(r.tempEnv1))return null;var a=Math.trunc((t+n)/2);t<a&&this.computeSelect(e,t,a,r),a<n&&this.computeSelect(e,a,n,r)},lW.prototype.getCoordinates=function(){for(var e=new Array(this._end-this._start+1).fill(null),t=0,n=this._start;n<=this._end;n++)e[t++]=this._pts[n];return e},lW.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)},lW.prototype.setId=function(e){this._id=e},lW.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)},lW.prototype.getEnvelope=function(){var e,t;return null===this._env&&(e=this._pts[this._start],t=this._pts[this._end],this._env=new Vk(e,t)),this._env},lW.prototype.getEndIndex=function(){return this._end},lW.prototype.getStartIndex=function(){return this._start},lW.prototype.getContext=function(){return this._context},lW.prototype.getId=function(){return this._id},lW.prototype.computeOverlapsInternal=function(e,t,n,r,i,o){var a=this._pts[e],s=this._pts[t],u=n._pts[r],l=n._pts[i];if(t-e==1&&i-r==1)return o.overlap(this,e,n,r),null;if(o.tempEnv1.init(a,s),o.tempEnv2.init(u,l),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((e+t)/2),h=Math.trunc((r+i)/2);e<c&&(r<h&&this.computeOverlapsInternal(e,c,n,r,h,o),h<i&&this.computeOverlapsInternal(e,c,n,h,i,o)),c<t&&(r<h&&this.computeOverlapsInternal(c,t,n,r,h,o),h<i&&this.computeOverlapsInternal(c,t,n,h,i,o))},lW.prototype.interfaces_=function(){return[]},lW.prototype.getClass=function(){return lW};function cW(){}cW.prototype.interfaces_=function(){return[]},cW.prototype.getClass=function(){return cW},cW.getChainStartIndices=function(e){var t=0,n=new IG;n.add(new wk(t));do{var r=cW.findChainEnd(e,t);n.add(new wk(r)),t=r}while(t<e.length-1);return cW.toIntArray(n)},cW.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var r=AH.quadrant(e[n],e[n+1]),i=t+1;i<e.length;){if(!e[i-1].equals2D(e[i]))if(AH.quadrant(e[i-1],e[i])!==r)break;i++}return i-1},cW.getChains=function(e,t){if(1===arguments.length)return cW.getChains(e,null);if(2===arguments.length){for(var n=e,r=t,i=new IG,o=cW.getChainStartIndices(n),a=0;a<o.length-1;a++){var s=new lW(n,o[a],o[a+1],r);i.add(s)}return i}},cW.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};function hW(){}hW.prototype.computeNodes=function(){},hW.prototype.getNodedSubstrings=function(){},hW.prototype.interfaces_=function(){return[]},hW.prototype.getClass=function(){return hW};function fW(e){this._segInt=null,0===arguments.length||1===arguments.length&&this.setSegmentIntersector(e)}fW.prototype.setSegmentIntersector=function(e){this._segInt=e},fW.prototype.interfaces_=function(){return[hW]},fW.prototype.getClass=function(){return fW};var pW,dW=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new IG,this._index=new QH,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t);var n={SegmentOverlapAction:{configurable:!0}};return((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return oW.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(e){for(var t=cW.getChains(e.getCoordinates(),e).iterator();t.hasNext();){var n=t.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}},e.prototype.computeNodes=function(e){for(var t=(this._nodedSegStrings=e).iterator();t.hasNext();)this.add(t.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var e=new mW(this._segInt),t=this._monoChains.iterator();t.hasNext();)for(var n=t.next(),r=this._index.query(n.getEnvelope()).iterator();r.hasNext();){var i=r.next();if(i.getId()>n.getId()&&(n.computeOverlaps(i,e),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return mW},Object.defineProperties(e,n),e}(fW),mW=((pW=uW)&&(_W.__proto__=pW),((_W.prototype=Object.create(pW&&pW.prototype)).constructor=_W).prototype.overlap=function(e,t,n,r){if(4!==arguments.length)return pW.prototype.overlap.apply(this,arguments);var i=t,o=n,a=r,s=e.getContext(),u=o.getContext();this._si.processIntersections(s,i,u,a)},_W.prototype.interfaces_=function(){return[]},_W.prototype.getClass=function(){return _W},_W);function _W(){pW.call(this),this._si=null;var e=arguments[0];this._si=e}function gW(){var e,t,n,r,i,o,a;this._quadrantSegments=gW.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=gW.CAP_ROUND,this._joinStyle=gW.JOIN_ROUND,this._mitreLimit=gW.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=gW.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length||(1===arguments.length?(e=arguments[0],this.setQuadrantSegments(e)):2===arguments.length?(t=arguments[0],n=arguments[1],this.setQuadrantSegments(t),this.setEndCapStyle(n)):4===arguments.length&&(r=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],this.setQuadrantSegments(r),this.setEndCapStyle(i),this.setJoinStyle(o),this.setMitreLimit(a)))}var yW={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};gW.prototype.getEndCapStyle=function(){return this._endCapStyle},gW.prototype.isSingleSided=function(){return this._isSingleSided},gW.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,0===this._quadrantSegments&&(this._joinStyle=gW.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=gW.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==gW.JOIN_ROUND&&(this._quadrantSegments=gW.DEFAULT_QUADRANT_SEGMENTS)},gW.prototype.getJoinStyle=function(){return this._joinStyle},gW.prototype.setJoinStyle=function(e){this._joinStyle=e},gW.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e},gW.prototype.getSimplifyFactor=function(){return this._simplifyFactor},gW.prototype.getQuadrantSegments=function(){return this._quadrantSegments},gW.prototype.setEndCapStyle=function(e){this._endCapStyle=e},gW.prototype.getMitreLimit=function(){return this._mitreLimit},gW.prototype.setMitreLimit=function(e){this._mitreLimit=e},gW.prototype.setSingleSided=function(e){this._isSingleSided=e},gW.prototype.interfaces_=function(){return[]},gW.prototype.getClass=function(){return gW},gW.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)},yW.CAP_ROUND.get=function(){return 1},yW.CAP_FLAT.get=function(){return 2},yW.CAP_SQUARE.get=function(){return 3},yW.JOIN_ROUND.get=function(){return 1},yW.JOIN_MITRE.get=function(){return 2},yW.JOIN_BEVEL.get=function(){return 3},yW.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},yW.DEFAULT_MITRE_LIMIT.get=function(){return 5},yW.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(gW,yW);function vW(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=sG.COUNTERCLOCKWISE,this._inputLine=e||null}var xW={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};vW.prototype.isDeletable=function(e,t,n,r){var i=this._inputLine[e],o=this._inputLine[t],a=this._inputLine[n];return!!this.isConcave(i,o,a)&&(!!this.isShallow(i,o,a,r)&&this.isShallowSampled(i,o,e,n,r))},vW.prototype.deleteShallowConcavities=function(){for(var e=1,t=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(t),r=!1;n<this._inputLine.length;){var i=!1;this.isDeletable(e,t,n,this._distanceTol)&&(this._isDeleted[t]=vW.DELETE,r=i=!0),e=i?n:t,t=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(t)}return r},vW.prototype.isShallowConcavity=function(e,t,n,r){return sG.computeOrientation(e,t,n)===this._angleOrientation&&sG.distancePointLine(t,e,n)<r},vW.prototype.isShallowSampled=function(e,t,n,r,i){var o=Math.trunc((r-n)/vW.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var a=n;a<r;a+=o)if(!this.isShallow(e,t,this._inputLine[a],i))return!1;return!0},vW.prototype.isConcave=function(e,t,n){var r=sG.computeOrientation(e,t,n)===this._angleOrientation;return r},vW.prototype.simplify=function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=sG.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);for(;this.deleteShallowConcavities(););return this.collapseLine()},vW.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===vW.DELETE;)t++;return t},vW.prototype.isShallow=function(e,t,n,r){return sG.distancePointLine(t,e,n)<r},vW.prototype.collapseLine=function(){for(var e=new DG,t=0;t<this._inputLine.length;t++)this._isDeleted[t]!==vW.DELETE&&e.add(this._inputLine[t]);return e.toCoordinateArray()},vW.prototype.interfaces_=function(){return[]},vW.prototype.getClass=function(){return vW},vW.simplify=function(e,t){return new vW(e).simplify(t)},xW.INIT.get=function(){return 0},xW.DELETE.get=function(){return 1},xW.KEEP.get=function(){return 1},xW.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(vW,xW);function bW(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new IG}var EW={COORDINATE_ARRAY_TYPE:{configurable:!0}};bW.prototype.getCoordinates=function(){return this._ptList.toArray(bW.COORDINATE_ARRAY_TYPE)},bW.prototype.setPrecisionModel=function(e){this._precisionModel=e},bW.prototype.addPt=function(e){var t=new _k(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)},bW.prototype.revere=function(){},bW.prototype.addPts=function(e,t){if(t)for(var n=0;n<e.length;n++)this.addPt(e[n]);else for(var r=e.length-1;0<=r;r--)this.addPt(e[r])},bW.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance},bW.prototype.toString=function(){return(new Kq).createLineString(this.getCoordinates()).toString()},bW.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new _k(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)},bW.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e},bW.prototype.interfaces_=function(){return[]},bW.prototype.getClass=function(){return bW},EW.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(bW,EW);function TW(){}var SW={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};TW.prototype.interfaces_=function(){return[]},TW.prototype.getClass=function(){return TW},TW.toDegrees=function(e){return 180*e/Math.PI},TW.normalize=function(e){for(;e>Math.PI;)e-=TW.PI_TIMES_2;for(;e<=-Math.PI;)e+=TW.PI_TIMES_2;return e},TW.angle=function(e,t){if(1===arguments.length)return Math.atan2(e.y,e.x);if(2===arguments.length){var n=t.x-e.x,r=t.y-e.y;return Math.atan2(r,n)}},TW.isAcute=function(e,t,n){var r=e.x-t.x,i=e.y-t.y;return 0<r*(n.x-t.x)+i*(n.y-t.y)},TW.isObtuse=function(e,t,n){var r=e.x-t.x,i=e.y-t.y;return r*(n.x-t.x)+i*(n.y-t.y)<0},TW.interiorAngle=function(e,t,n){var r=TW.angle(t,e),i=TW.angle(t,n);return Math.abs(i-r)},TW.normalizePositive=function(e){if(e<0){for(;e<0;)e+=TW.PI_TIMES_2;TW.PI_TIMES_2<=e&&(e=0)}else{for(;TW.PI_TIMES_2<=e;)e-=TW.PI_TIMES_2;e<0&&(e=0)}return e},TW.angleBetween=function(e,t,n){var r=TW.angle(t,e),i=TW.angle(t,n);return TW.diff(r,i)},TW.diff=function(e,t){var n=null;return(n=e<t?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n},TW.toRadians=function(e){return e*Math.PI/180},TW.getTurn=function(e,t){var n=Math.sin(t-e);return 0<n?TW.COUNTERCLOCKWISE:n<0?TW.CLOCKWISE:TW.NONE},TW.angleBetweenOriented=function(e,t,n){var r=TW.angle(t,e),i=TW.angle(t,n)-r;return i<=-Math.PI?i+TW.PI_TIMES_2:i>Math.PI?i-TW.PI_TIMES_2:i},SW.PI_TIMES_2.get=function(){return 2*Math.PI},SW.PI_OVER_2.get=function(){return Math.PI/2},SW.PI_OVER_4.get=function(){return Math.PI/4},SW.COUNTERCLOCKWISE.get=function(){return sG.COUNTERCLOCKWISE},SW.CLOCKWISE.get=function(){return sG.CLOCKWISE},SW.NONE.get=function(){return sG.COLLINEAR},Object.defineProperties(TW,SW);function CW(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new aW,this._seg1=new aW,this._offset0=new aW,this._offset1=new aW,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=t,this._li=new rG,this._filletAngleQuantum=Math.PI/2/t.getQuadrantSegments(),8<=t.getQuadrantSegments()&&t.getJoinStyle()===gW.JOIN_ROUND&&(this._closingSegLengthFactor=CW.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)}var wW={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};CW.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=sG.computeOrientation(this._s0,this._s1,this._s2),r=n===sG.CLOCKWISE&&this._side===rH.LEFT||n===sG.COUNTERCLOCKWISE&&this._side===rH.RIGHT;0===n?this.addCollinear(t):r?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)},CW.prototype.addLineEndCap=function(e,t){var n=new aW(e,t),r=new aW;this.computeOffsetSegment(n,rH.LEFT,this._distance,r);var i=new aW;this.computeOffsetSegment(n,rH.RIGHT,this._distance,i);var o=t.x-e.x,a=t.y-e.y,s=Math.atan2(a,o);switch(this._bufParams.getEndCapStyle()){case gW.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,s+Math.PI/2,s-Math.PI/2,sG.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case gW.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case gW.CAP_SQUARE:var u=new _k;u.x=Math.abs(this._distance)*Math.cos(s),u.y=Math.abs(this._distance)*Math.sin(s);var l=new _k(r.p1.x+u.x,r.p1.y+u.y),c=new _k(i.p1.x+u.x,i.p1.y+u.y);this._segList.addPt(l),this._segList.addPt(c)}},CW.prototype.getCoordinates=function(){return this._segList.getCoordinates()},CW.prototype.addMitreJoin=function(e,t,n,r){var i=!0,o=null;try{o=Uk.intersection(t.p0,t.p1,n.p0,n.p1);(r<=0?1:o.distance(e)/Math.abs(r))>this._bufParams.getMitreLimit()&&(i=!1)}catch(e){if(!(e instanceof Fk))throw e;o=new _k(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(t,n,r,this._bufParams.getMitreLimit())},CW.prototype.addFilletCorner=function(e,t,n,r,i){var o=t.x-e.x,a=t.y-e.y,s=Math.atan2(a,o),u=n.x-e.x,l=n.y-e.y,c=Math.atan2(l,u);r===sG.CLOCKWISE?s<=c&&(s+=2*Math.PI):c<=s&&(s-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,s,c,r,i),this._segList.addPt(n)},CW.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*CW.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===gW.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===gW.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))},CW.prototype.createSquare=function(e){this._segList.addPt(new _k(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new _k(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new _k(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new _k(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()},CW.prototype.addSegments=function(e,t){this._segList.addPts(e,t)},CW.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},CW.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},CW.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},CW.prototype.addLimitedMitreJoin=function(e,t,n,r){var i=this._seg0.p1,o=TW.angle(i,this._seg0.p0),a=TW.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,s=TW.normalize(o+a),u=TW.normalize(s+Math.PI),l=r*n,c=n-l*Math.abs(Math.sin(a)),h=i.x+l*Math.cos(u),f=i.y+l*Math.sin(u),p=new _k(h,f),d=new aW(i,p),m=d.pointAlongOffset(1,c),_=d.pointAlongOffset(1,-c);this._side===rH.LEFT?(this._segList.addPt(m),this._segList.addPt(_)):(this._segList.addPt(_),this._segList.addPt(m))},CW.prototype.computeOffsetSegment=function(e,t,n,r){var i=t===rH.LEFT?1:-1,o=e.p1.x-e.p0.x,a=e.p1.y-e.p0.y,s=Math.sqrt(o*o+a*a),u=i*n*o/s,l=i*n*a/s;r.p0.x=e.p0.x-l,r.p0.y=e.p0.y+u,r.p1.x=e.p1.x-l,r.p1.y=e.p1.y+u},CW.prototype.addFilletArc=function(e,t,n,r,i){var o=r===sG.CLOCKWISE?-1:1,a=Math.abs(t-n),s=Math.trunc(a/this._filletAngleQuantum+.5);if(s<1)return null;for(var u=a/s,l=0,c=new _k;l<a;){var h=t+o*l;c.x=e.x+i*Math.cos(h),c.y=e.y+i*Math.sin(h),this._segList.addPt(c),l+=u}},CW.prototype.addInsideTurn=function(){var e,t;this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection()?this._segList.addPt(this._li.getIntersection(0)):(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*CW.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR?this._segList.addPt(this._offset0.p1):(this._segList.addPt(this._offset0.p1),0<this._closingSegLengthFactor?(e=new _k((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1)),this._segList.addPt(e),t=new _k((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1)),this._segList.addPt(t)):this._segList.addPt(this._s1),this._segList.addPt(this._offset1.p0)))},CW.prototype.createCircle=function(e){var t=new _k(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},CW.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)},CW.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new bW,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*CW.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},CW.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),2<=this._li.getIntersectionNum()&&(this._bufParams.getJoinStyle()===gW.JOIN_BEVEL||this._bufParams.getJoinStyle()===gW.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,sG.CLOCKWISE,this._distance))},CW.prototype.closeRing=function(){this._segList.closeRing()},CW.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},CW.prototype.interfaces_=function(){return[]},CW.prototype.getClass=function(){return CW},wW.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},wW.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},wW.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},wW.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(CW,wW);function AW(e,t){this._distance=0,this._precisionModel=null,this._bufParams=null;var n=t;this._precisionModel=e,this._bufParams=n}AW.prototype.getOffsetCurve=function(e,t){if(0===(this._distance=t))return null;var n=t<0,r=Math.abs(t),i=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],i):this.computeOffsetCurve(e,n,i);var o=i.getCoordinates();return n&&RG.reverse(o),o},AW.prototype.computeSingleSidedBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var i=vW.simplify(e,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],rH.LEFT),n.addFirstSegment();for(var a=o-2;0<=a;a--)n.addNextSegment(i[a],!0)}else{n.addSegments(e,!1);var s=vW.simplify(e,r),u=s.length-1;n.initSideSegments(s[0],s[1],rH.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(s[l],!0)}n.addLastSegment(),n.closeRing()},AW.prototype.computeRingBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);t===rH.RIGHT&&(r=-r);var i=vW.simplify(e,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],t);for(var a=1;a<=o;a++){var s=1!==a;n.addNextSegment(i[a],s)}n.closeRing()},AW.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),r=vW.simplify(e,n),i=r.length-1;t.initSideSegments(r[0],r[1],rH.LEFT);for(var o=2;o<=i;o++)t.addNextSegment(r[o],!0);t.addLastSegment(),t.addLineEndCap(r[i-1],r[i]);var a=vW.simplify(e,-n),s=a.length-1;t.initSideSegments(a[s],a[s-1],rH.LEFT);for(var u=s-2;0<=u;u--)t.addNextSegment(a[u],!0);t.addLastSegment(),t.addLineEndCap(a[1],a[0]),t.closeRing()},AW.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case gW.CAP_ROUND:t.createCircle(e);break;case gW.CAP_SQUARE:t.createSquare(e)}},AW.prototype.getLineCurve=function(e,t){if((this._distance=t)<0&&!this._bufParams.isSingleSided())return null;if(0===t)return null;var n,r=Math.abs(t),i=this.getSegGen(r);return e.length<=1?this.computePointCurve(e[0],i):this._bufParams.isSingleSided()?(n=t<0,this.computeSingleSidedBufferCurve(e,n,i)):this.computeLineBufferCurve(e,i),i.getCoordinates()},AW.prototype.getBufferParameters=function(){return this._bufParams},AW.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()},AW.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(0===n)return AW.copyCoordinates(e);var r=this.getSegGen(n);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()},AW.prototype.computeOffsetCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){var i=vW.simplify(e,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],rH.LEFT),n.addFirstSegment();for(var a=o-2;0<=a;a--)n.addNextSegment(i[a],!0)}else{var s=vW.simplify(e,r),u=s.length-1;n.initSideSegments(s[0],s[1],rH.LEFT),n.addFirstSegment();for(var l=2;l<=u;l++)n.addNextSegment(s[l],!0)}n.addLastSegment()},AW.prototype.getSegGen=function(e){return new CW(this._precisionModel,this._bufParams,e)},AW.prototype.interfaces_=function(){return[]},AW.prototype.getClass=function(){return AW},AW.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new _k(e[n]);return t};function IW(e){this._subgraphs=null,this._seg=new aW,this._cga=new sG,this._subgraphs=e}var PW={DepthSegment:{configurable:!0}};IW.prototype.findStabbedSegments=function(e,t,n){var r=this;if(1===arguments.length){for(var i=e,o=new IG,a=this._subgraphs.iterator();a.hasNext();){var s=a.next(),u=s.getEnvelope();i.y<u.getMinY()||i.y>u.getMaxY()||r.findStabbedSegments(i,s.getDirectedEdges(),o)}return o}if(3===arguments.length)if(Ek(n,SG)&&e instanceof _k&&t instanceof LH)for(var l,c,h=e,f=t,p=n,d=f.getEdge().getCoordinates(),m=0;m<d.length-1;m++){r._seg.p0=d[m],r._seg.p1=d[m+1],r._seg.p0.y>r._seg.p1.y&&r._seg.reverse(),Math.max(r._seg.p0.x,r._seg.p1.x)<h.x||r._seg.isHorizontal()||h.y<r._seg.p0.y||h.y>r._seg.p1.y||sG.computeOrientation(r._seg.p0,r._seg.p1,h)!==sG.RIGHT&&(l=f.getDepth(rH.LEFT),r._seg.p0.equals(d[m])||(l=f.getDepth(rH.RIGHT)),c=new OW(r._seg,l),p.add(c))}else if(Ek(n,SG)&&e instanceof _k&&Ek(t,SG))for(var _=e,g=n,y=t.iterator();y.hasNext();){var v=y.next();v.isForward()&&r.findStabbedSegments(_,v,g)}},IW.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);return 0===t.size()?0:qH.min(t)._leftDepth},IW.prototype.interfaces_=function(){return[]},IW.prototype.getClass=function(){return IW},PW.DepthSegment.get=function(){return OW},Object.defineProperties(IW,PW);var OW=function(e,t){this._upwardSeg=null,this._leftDepth=null;var n=t;this._upwardSeg=new aW(e),this._leftDepth=n};OW.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return 0!==n||0!==(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(t._upwardSeg)},OW.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return 0!==n?n:e.p1.compareTo(t.p1)},OW.prototype.toString=function(){return this._upwardSeg.toString()},OW.prototype.interfaces_=function(){return[fk]},OW.prototype.getClass=function(){return OW};function LW(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null}LW.prototype.area=function(){return LW.area(this.p0,this.p1,this.p2)},LW.prototype.signedArea=function(){return LW.signedArea(this.p0,this.p1,this.p2)},LW.prototype.interpolateZ=function(e){if(null===e)throw new lk;return LW.interpolateZ(e,this.p0,this.p1,this.p2)},LW.prototype.longestSideLength=function(){return LW.longestSideLength(this.p0,this.p1,this.p2)},LW.prototype.isAcute=function(){return LW.isAcute(this.p0,this.p1,this.p2)},LW.prototype.circumcentre=function(){return LW.circumcentre(this.p0,this.p1,this.p2)},LW.prototype.area3D=function(){return LW.area3D(this.p0,this.p1,this.p2)},LW.prototype.centroid=function(){return LW.centroid(this.p0,this.p1,this.p2)},LW.prototype.inCentre=function(){return LW.inCentre(this.p0,this.p1,this.p2)},LW.prototype.interfaces_=function(){return[]},LW.prototype.getClass=function(){return LW},LW.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)},LW.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2},LW.det=function(e,t,n,r){return e*r-t*n},LW.interpolateZ=function(e,t,n,r){var i=t.x,o=t.y,a=n.x-i,s=r.x-i,u=n.y-o,l=r.y-o,c=a*l-s*u,h=e.x-i,f=e.y-o,p=(l*h-s*f)/c,d=(-u*h+a*f)/c;return t.z+p*(n.z-t.z)+d*(r.z-t.z)},LW.longestSideLength=function(e,t,n){var r=e.distance(t),i=t.distance(n),o=n.distance(e),a=r;return a<i&&(a=i),a<o&&(a=o),a},LW.isAcute=function(e,t,n){return!!TW.isAcute(e,t,n)&&(!!TW.isAcute(t,n,e)&&!!TW.isAcute(n,e,t))},LW.circumcentre=function(e,t,n){var r=n.x,i=n.y,o=e.x-r,a=e.y-i,s=t.x-r,u=t.y-i,l=2*LW.det(o,a,s,u),c=LW.det(a,o*o+a*a,u,s*s+u*u),h=LW.det(o,o*o+a*a,s,s*s+u*u);return new _k(r-c/l,i+h/l)},LW.perpendicularBisector=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=new Uk(e.x+n/2,e.y+r/2,1),o=new Uk(e.x-r+n/2,e.y+n+r/2,1);return new Uk(i,o)},LW.angleBisector=function(e,t,n){var r=t.distance(e),i=r/(r+t.distance(n)),o=n.x-e.x,a=n.y-e.y;return new _k(e.x+i*o,e.y+i*a)},LW.area3D=function(e,t,n){var r=t.x-e.x,i=t.y-e.y,o=t.z-e.z,a=n.x-e.x,s=n.y-e.y,u=n.z-e.z,l=i*u-o*s,c=o*a-r*u,h=r*s-i*a,f=l*l+c*c+h*h,p=Math.sqrt(f)/2;return p},LW.centroid=function(e,t,n){var r=(e.x+t.x+n.x)/3,i=(e.y+t.y+n.y)/3;return new _k(r,i)},LW.inCentre=function(e,t,n){var r=t.distance(n),i=e.distance(n),o=e.distance(t),a=r+i+o,s=(r*e.x+i*t.x+o*n.x)/a,u=(r*e.y+i*t.y+o*n.y)/a;return new _k(s,u)};function NW(e,t,n){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new IG;var r=t,i=n;this._inputGeom=e,this._distance=r,this._curveBuilder=i}NW.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,xk.EXTERIOR,xk.INTERIOR)},NW.prototype.addPolygon=function(e){var t=this._distance,n=rH.LEFT;this._distance<0&&(t=-this._distance,n=rH.RIGHT);var r=e.getExteriorRing(),i=RG.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&i.length<3)return null;this.addPolygonRing(i,t,n,xk.EXTERIOR,xk.INTERIOR);for(var o=0;o<e.getNumInteriorRing();o++){var a=e.getInteriorRingN(o),s=RG.removeRepeatedPoints(a.getCoordinates());0<this._distance&&this.isErodedCompletely(a,-this._distance)||this.addPolygonRing(s,t,rH.opposite(n),xk.INTERIOR,xk.EXTERIOR)}},NW.prototype.isTriangleErodedCompletely=function(e,t){var n=new LW(e[0],e[1],e[2]),r=n.inCentre();return sG.distancePointLine(r,n.p0,n.p1)<Math.abs(t)},NW.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=RG.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,xk.EXTERIOR,xk.INTERIOR)},NW.prototype.addCurve=function(e,t,n){if(null===e||e.length<2)return null;var r=new oW(e,new dH(0,xk.BOUNDARY,t,n));this._curveList.add(r)},NW.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},NW.prototype.addPolygonRing=function(e,t,n,r,i){if(0===t&&e.length<Nq.MINIMUM_VALID_SIZE)return null;var o=r,a=i;e.length>=Nq.MINIMUM_VALID_SIZE&&sG.isCCW(e)&&(o=i,a=r,n=rH.opposite(n));var s=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(s,o,a)},NW.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Oq?this.addPolygon(e):e instanceof wq?this.addLineString(e):e instanceof Iq?this.addPoint(e):(e instanceof Lq||e instanceof pq||e instanceof Rq||e instanceof fq)&&this.addCollection(e)},NW.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var r=e.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>i},NW.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var n=e.getGeometryN(t);this.add(n)}},NW.prototype.interfaces_=function(){return[]},NW.prototype.getClass=function(){return NW};function RW(){}RW.prototype.locate=function(){},RW.prototype.interfaces_=function(){return[]},RW.prototype.getClass=function(){return RW};function DW(e){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=e;this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()}DW.prototype.next=function(){if(this._atStart)return this._atStart=!1,DW.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new wG;var e=this._parent.getGeometryN(this._index++);return e instanceof fq?(this._subcollectionIterator=new DW(e),this._subcollectionIterator.next()):e},DW.prototype.remove=function(){throw new Error(this.getClass().getName())},DW.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},DW.prototype.interfaces_=function(){return[bG]},DW.prototype.getClass=function(){return DW},DW.isAtomic=function(e){return!(e instanceof fq)};function MW(e){this._geom=null,this._geom=e}MW.prototype.locate=function(e){return MW.locate(e,this._geom)},MW.prototype.interfaces_=function(){return[RW]},MW.prototype.getClass=function(){return MW},MW.isPointInRing=function(e,t){return!!t.getEnvelopeInternal().intersects(e)&&sG.isPointInRing(e,t.getCoordinates())},MW.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!MW.isPointInRing(e,n))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var i=t.getInteriorRingN(r);if(MW.isPointInRing(e,i))return!1}return!0},MW.containsPoint=function(e,t){if(t instanceof Oq)return MW.containsPointInPolygon(e,t);if(t instanceof fq)for(var n=new DW(t);n.hasNext();){var r=n.next();if(r!==t&&MW.containsPoint(e,r))return!0}return!1},MW.locate=function(e,t){return!t.isEmpty()&&MW.containsPoint(e,t)?xk.INTERIOR:xk.EXTERIOR};function FW(){this._edgeMap=new nq,this._edgeList=null,this._ptInAreaLocation=[xk.NONE,xk.NONE]}FW.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return 0===t&&(n=this._edgeList.size()-1),this._edgeList.get(n)},FW.prototype.propagateSideLabels=function(e){for(var t=xk.NONE,n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.isArea(e)&&r.getLocation(e,rH.LEFT)!==xk.NONE&&(t=r.getLocation(e,rH.LEFT))}if(t===xk.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getLabel();if(s.getLocation(e,rH.ON)===xk.NONE&&s.setLocation(e,rH.ON,i),s.isArea(e)){var u=s.getLocation(e,rH.LEFT),l=s.getLocation(e,rH.RIGHT);if(l!==xk.NONE){if(l!==i)throw new lH("side location conflict",a.getCoordinate());u===xk.NONE&&$k.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),i=u}else $k.isTrue(s.getLocation(e,rH.LEFT)===xk.NONE,"found single null side"),s.setLocation(e,rH.RIGHT,i),s.setLocation(e,rH.LEFT,i)}}},FW.prototype.getCoordinate=function(){var e=this.iterator();return e.hasNext()?e.next().getCoordinate():null},FW.prototype.print=function(e){Bk.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){t.next().print(e)}},FW.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},FW.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,r=t.get(n).getLabel().getLocation(e,rH.LEFT);$k.isTrue(r!==xk.NONE,"Found unlabelled area edge");for(var i=r,o=this.iterator();o.hasNext();){var a=o.next().getLabel();$k.isTrue(a.isArea(e),"Found non-area edge");var s=a.getLocation(e,rH.LEFT),u=a.getLocation(e,rH.RIGHT);if(s===u)return!1;if(u!==i)return!1;i=s}return!0},FW.prototype.findIndex=function(e){this.iterator();for(var t=0;t<this._edgeList.size();t++){if(this._edgeList.get(t)===e)return t}return-1},FW.prototype.iterator=function(){return this.getEdges().iterator()},FW.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new IG(this._edgeMap.values())),this._edgeList},FW.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===xk.NONE&&(this._ptInAreaLocation[e]=MW.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]},FW.prototype.toString=function(){var e=new Ck;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append("\n")}return e.toString()},FW.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){t.next().computeLabel(e)}},FW.prototype.computeLabelling=function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var r=n.next().getLabel(),i=0;i<2;i++)r.isLine(i)&&r.getLocation(i)===xk.BOUNDARY&&(t[i]=!0);for(var o=this.iterator();o.hasNext();)for(var a,s,u=o.next(),l=u.getLabel(),c=0;c<2;c++){l.isAnyNull(c)&&(s=xk.NONE,s=t[c]?xk.EXTERIOR:(a=u.getCoordinate(),this.getLocation(c,a,e)),l.setAllLocationsIfNull(c,s))}},FW.prototype.getDegree=function(){return this._edgeMap.size()},FW.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null},FW.prototype.interfaces_=function(){return[]},FW.prototype.getClass=function(){return FW};var zW,BW=((zW=FW)&&(UW.__proto__=zW),((UW.prototype=Object.create(zW&&zW.prototype)).constructor=UW).prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var e=null,t=null,n=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var i=this._resultAreaEdgeList.get(r),o=i.getSym();if(i.getLabel().isArea())switch(null===e&&i.isInResult()&&(e=i),n){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;t=o,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!i.isInResult())continue;t.setNext(i),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===e)throw new lH("no outgoing dirEdge found",this.getCoordinate());$k.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),t.setNext(e)}},UW.prototype.insert=function(e){this.insertEdgeEnd(e,e)},UW.prototype.getRightmostEdge=function(){var e=this.getEdges(),t=e.size();if(t<1)return null;var n=e.get(0);if(1===t)return n;var r=e.get(t-1),i=n.getQuadrant(),o=r.getQuadrant();return AH.isNorthern(i)&&AH.isNorthern(o)?n:AH.isNorthern(i)||AH.isNorthern(o)?0!==n.getDy()?n:0!==r.getDy()?r:($k.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},UW.prototype.print=function(e){Bk.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();e.print("out "),n.print(e),e.println(),e.print("in "),n.getSym().print(e),e.println()}},UW.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new IG;for(var e=this.iterator();e.hasNext();){var t=e.next();(t.isInResult()||t.getSym().isInResult())&&this._resultAreaEdgeList.add(t)}return this._resultAreaEdgeList},UW.prototype.updateLabelling=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,e.getLocation(0)),n.setAllLocationsIfNull(1,e.getLocation(1))}},UW.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var e=null,t=null,n=this._edgeList.size()-1;0<=n;n--){var r=this._edgeList.get(n),i=r.getSym();null===t&&(t=i),null!==e&&i.setNext(e),e=r}t.setNext(e)},UW.prototype.computeDepths=function(e,t,n){if(1===arguments.length){var r=e,i=this.findIndex(r),o=r.getDepth(rH.LEFT),a=r.getDepth(rH.RIGHT),s=this.computeDepths(i+1,this._edgeList.size(),o);if(this.computeDepths(0,i,s)!==a)throw new lH("depth mismatch at "+r.getCoordinate())}else if(3===arguments.length){for(var u=t,l=n,c=e;c<u;c++){var h=this._edgeList.get(c);h.setEdgeDepths(rH.RIGHT,l),l=h.getDepth(rH.LEFT)}return l}},UW.prototype.mergeSymLabels=function(){for(var e=this.iterator();e.hasNext();){var t=e.next();t.getLabel().merge(t.getSym().getLabel())}},UW.prototype.linkMinimalDirectedEdges=function(e){for(var t=null,n=null,r=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;0<=i;i--){var o=this._resultAreaEdgeList.get(i),a=o.getSym();switch(null===t&&o.getEdgeRing()===e&&(t=o),r){case this._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==e)continue;n=a,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==e)continue;n.setNextMin(o),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&($k.isTrue(null!==t,"found null for first outgoing dirEdge"),$k.isTrue(t.getEdgeRing()===e,"unable to link last incoming dirEdge"),n.setNextMin(t))},UW.prototype.getOutgoingDegree=function(e){if(0===arguments.length){for(var t=0,n=this.iterator();n.hasNext();)n.next().isInResult()&&t++;return t}if(1===arguments.length){for(var r=e,i=0,o=this.iterator();o.hasNext();)o.next().getEdgeRing()===r&&i++;return i}},UW.prototype.getLabel=function(){return this._label},UW.prototype.findCoveredLineEdges=function(){for(var e=xk.NONE,t=this.iterator();t.hasNext();){var n=t.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){e=xk.INTERIOR;break}if(r.isInResult()){e=xk.EXTERIOR;break}}}if(e===xk.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getSym();a.isLineEdge()?a.getEdge().setCovered(i===xk.INTERIOR):(a.isInResult()&&(i=xk.EXTERIOR),s.isInResult()&&(i=xk.INTERIOR))}},UW.prototype.computeLabelling=function(e){zW.prototype.computeLabelling.call(this,e),this._label=new dH(xk.NONE);for(var t=this.iterator();t.hasNext();)for(var n=t.next().getEdge().getLabel(),r=0;r<2;r++){var i=n.getLocation(r);i!==xk.INTERIOR&&i!==xk.BOUNDARY||this._label.setLocation(r,xk.INTERIOR)}},UW.prototype.interfaces_=function(){return[]},UW.prototype.getClass=function(){return UW},UW);function UW(){zW.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}var VW,kW=((VW=RH)&&(GW.__proto__=VW),((GW.prototype=Object.create(VW&&VW.prototype)).constructor=GW).prototype.createNode=function(e){return new SH(e,new BW)},GW.prototype.interfaces_=function(){return[]},GW.prototype.getClass=function(){return GW},GW);function GW(){VW.apply(this,arguments)}function qW(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=qW.orientation(e)}qW.prototype.compareTo=function(e){return qW.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},qW.prototype.interfaces_=function(){return[fk]},qW.prototype.getClass=function(){return qW},qW.orientation=function(e){return 1===RG.increasingDirection(e)},qW.compareOriented=function(e,t,n,r){for(var i=t?1:-1,o=r?1:-1,a=t?e.length:-1,s=r?n.length:-1,u=t?0:e.length-1,l=r?0:n.length-1;;){var c=e[u].compareTo(n[l]);if(0!==c)return c;var h=(u+=i)===a,f=(l+=o)===s;if(h&&!f)return-1;if(!h&&f)return 1;if(h&&f)return 0}};function HW(){this._edges=new IG,this._ocaMap=new nq}HW.prototype.print=function(e){e.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var n=this._edges.get(t);0<t&&e.print(","),e.print("(");for(var r=n.getCoordinates(),i=0;i<r.length;i++)0<i&&e.print(","),e.print(r[i].x+" "+r[i].y);e.println(")")}e.print(")  ")},HW.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next())},HW.prototype.findEdgeIndex=function(e){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(e))return t;return-1},HW.prototype.iterator=function(){return this._edges.iterator()},HW.prototype.getEdges=function(){return this._edges},HW.prototype.get=function(e){return this._edges.get(e)},HW.prototype.findEqualEdge=function(e){var t=new qW(e.getCoordinates());return this._ocaMap.get(t)},HW.prototype.add=function(e){this._edges.add(e);var t=new qW(e.getCoordinates());this._ocaMap.put(t,e)},HW.prototype.interfaces_=function(){return[]},HW.prototype.getClass=function(){return HW};function WW(){}WW.prototype.processIntersections=function(){},WW.prototype.isDone=function(){},WW.prototype.interfaces_=function(){return[]},WW.prototype.getClass=function(){return WW};function YW(e){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=e}YW.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&1===this._li.getIntersectionNum()){if(YW.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var i=e.size()-1;if(0===t&&r===i||0===r&&t===i)return!0}}return!1},YW.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},YW.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},YW.prototype.getLineIntersector=function(){return this._li},YW.prototype.hasProperIntersection=function(){return this._hasProper},YW.prototype.processIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},YW.prototype.hasIntersection=function(){return this._hasIntersection},YW.prototype.isDone=function(){return!1},YW.prototype.hasInteriorIntersection=function(){return this._hasInterior},YW.prototype.interfaces_=function(){return[WW]},YW.prototype.getClass=function(){return YW},YW.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)};function XW(e,t,n){this.coord=null,this.segmentIndex=null,this.dist=null;var r=t,i=n;this.coord=new _k(e),this.segmentIndex=r,this.dist=i}XW.prototype.getSegmentIndex=function(){return this.segmentIndex},XW.prototype.getCoordinate=function(){return this.coord},XW.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)},XW.prototype.compareTo=function(e){return this.compare(e.segmentIndex,e.dist)},XW.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e},XW.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},XW.prototype.getDistance=function(){return this.dist},XW.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0},XW.prototype.interfaces_=function(){return[fk]},XW.prototype.getClass=function(){return XW};function jW(e){this._nodeMap=new nq,this.edge=null,this.edge=e}jW.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){t.next().print(e)}},jW.prototype.iterator=function(){return this._nodeMap.values().iterator()},jW.prototype.addSplitEdges=function(e){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next(),i=this.createSplitEdge(n,r);e.add(i),n=r}},jW.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)},jW.prototype.createSplitEdge=function(e,t){var n=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],i=0<t.dist||!t.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),a=0;o[a++]=new _k(e.coord);for(var s=e.segmentIndex+1;s<=t.segmentIndex;s++)o[a++]=this.edge.pts[s];return i&&(o[a]=t.coord),new eY(o,new dH(this.edge._label))},jW.prototype.add=function(e,t,n){var r=new XW(e,t,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)},jW.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){if(t.next().coord.equals(e))return!0}return!1},jW.prototype.interfaces_=function(){return[]},jW.prototype.getClass=function(){return jW};function KW(){}KW.prototype.getChainStartIndices=function(e){var t=0,n=new IG;n.add(new wk(t));do{var r=this.findChainEnd(e,t);n.add(new wk(r)),t=r}while(t<e.length-1);return KW.toIntArray(n)},KW.prototype.findChainEnd=function(e,t){for(var n=AH.quadrant(e[t],e[t+1]),r=t+1;r<e.length;){if(AH.quadrant(e[r-1],e[r])!==n)break;r++}return r-1},KW.prototype.interfaces_=function(){return[]},KW.prototype.getClass=function(){return KW},KW.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};function QW(e){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Vk,this.env2=new Vk;var t=e;this.e=t,this.pts=t.getCoordinates();var n=new KW;this.startIndex=n.getChainStartIndices(this.pts)}QW.prototype.getCoordinates=function(){return this.pts},QW.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return n<t?t:n},QW.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n},QW.prototype.computeIntersectsForChain=function(e,t,n,r,i,o){if(4===arguments.length)this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],r);else if(6===arguments.length){var a=e,s=t,u=n,l=r,c=i,h=o,f=this.pts[a],p=this.pts[s],d=u.pts[l],m=u.pts[c];if(s-a==1&&c-l==1)return h.addIntersections(this.e,a,u.e,l),null;if(this.env1.init(f,p),this.env2.init(d,m),!this.env1.intersects(this.env2))return null;var _=Math.trunc((a+s)/2),g=Math.trunc((l+c)/2);a<_&&(l<g&&this.computeIntersectsForChain(a,_,u,l,g,h),g<c&&this.computeIntersectsForChain(a,_,u,g,c,h)),_<s&&(l<g&&this.computeIntersectsForChain(_,s,u,l,g,h),g<c&&this.computeIntersectsForChain(_,s,u,g,c,h))}},QW.prototype.getStartIndexes=function(){return this.startIndex},QW.prototype.computeIntersects=function(e,t){for(var n=0;n<this.startIndex.length-1;n++)for(var r=0;r<e.startIndex.length-1;r++)this.computeIntersectsForChain(n,e,r,t)},QW.prototype.interfaces_=function(){return[]},QW.prototype.getClass=function(){return QW};function ZW(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var e=0;e<2;e++)for(var t=0;t<3;t++)this._depth[e][t]=ZW.NULL_VALUE}var JW={NULL_VALUE:{configurable:!0}};ZW.prototype.getDepth=function(e,t){return this._depth[e][t]},ZW.prototype.setDepth=function(e,t,n){this._depth[e][t]=n},ZW.prototype.isNull=function(e,t){if(0!==arguments.length)return 1===arguments.length?this._depth[e][1]===ZW.NULL_VALUE:2===arguments.length?this._depth[e][t]===ZW.NULL_VALUE:void 0;for(var n=0;n<2;n++)for(var r=0;r<3;r++)if(this._depth[n][r]!==ZW.NULL_VALUE)return!1;return!0},ZW.prototype.normalize=function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var n=1;n<3;n++){var r=0;this._depth[e][n]>t&&(r=1),this._depth[e][n]=r}}},ZW.prototype.getDelta=function(e){return this._depth[e][rH.RIGHT]-this._depth[e][rH.LEFT]},ZW.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?xk.EXTERIOR:xk.INTERIOR},ZW.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},ZW.prototype.add=function(e,t,n){if(1===arguments.length)for(var r=e,i=0;i<2;i++)for(var o=1;o<3;o++){var a=r.getLocation(i,o);a!==xk.EXTERIOR&&a!==xk.INTERIOR||(this.isNull(i,o)?this._depth[i][o]=ZW.depthAtLocation(a):this._depth[i][o]+=ZW.depthAtLocation(a))}else 3===arguments.length&&n===xk.INTERIOR&&this._depth[e][t]++},ZW.prototype.interfaces_=function(){return[]},ZW.prototype.getClass=function(){return ZW},ZW.depthAtLocation=function(e){return e===xk.EXTERIOR?0:e===xk.INTERIOR?1:ZW.NULL_VALUE},JW.NULL_VALUE.get=function(){return-1},Object.defineProperties(ZW,JW);var $W,eY=(($W=EH)&&(tY.__proto__=$W),tY.prototype=Object.create($W&&$W.prototype),(tY.prototype.constructor=tY).prototype.getDepth=function(){return this._depth},tY.prototype.getCollapsedEdge=function(){var e=new Array(2).fill(null);return e[0]=this.pts[0],e[1]=this.pts[1],new tY(e,dH.toLineLabel(this._label))},tY.prototype.isIsolated=function(){return this._isIsolated},tY.prototype.getCoordinates=function(){return this.pts},tY.prototype.setIsolated=function(e){this._isIsolated=e},tY.prototype.setName=function(e){this._name=e},tY.prototype.equals=function(e){if(!(e instanceof tY))return!1;var t=e;if(this.pts.length!==t.pts.length)return!1;for(var n=!0,r=!0,i=this.pts.length,o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(t.pts[o])||(n=!1),this.pts[o].equals2D(t.pts[--i])||(r=!1),!n&&!r)return!1;return!0},tY.prototype.getCoordinate=function(e){return 0===arguments.length?0<this.pts.length?this.pts[0]:null:1===arguments.length?this.pts[e]:void 0},tY.prototype.print=function(e){e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)0<t&&e.print(","),e.print(this.pts[t].x+" "+this.pts[t].y);e.print(")  "+this._label+" "+this._depthDelta)},tY.prototype.computeIM=function(e){tY.updateIM(this._label,e)},tY.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},tY.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},tY.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},tY.prototype.getDepthDelta=function(){return this._depthDelta},tY.prototype.getNumPoints=function(){return this.pts.length},tY.prototype.printReverse=function(e){e.print("edge "+this._name+": ");for(var t=this.pts.length-1;0<=t;t--)e.print(this.pts[t]+" ");e.println("")},tY.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new QW(this)),this._mce},tY.prototype.getEnvelope=function(){if(null===this._env){this._env=new Vk;for(var e=0;e<this.pts.length;e++)this._env.expandToInclude(this.pts[e])}return this._env},tY.prototype.addIntersection=function(e,t,n,r){var i,o=new _k(e.getIntersection(r)),a=t,s=e.getEdgeDistance(n,r),u=a+1;u<this.pts.length&&(i=this.pts[u],o.equals2D(i)&&(a=u,s=0)),this.eiList.add(o,a,s)},tY.prototype.toString=function(){var e=new Ck;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)0<t&&e.append(","),e.append(this.pts[t].x+" "+this.pts[t].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()},tY.prototype.isPointwiseEqual=function(e){if(this.pts.length!==e.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(e.pts[t]))return!1;return!0},tY.prototype.setDepthDelta=function(e){this._depthDelta=e},tY.prototype.getEdgeIntersectionList=function(){return this.eiList},tY.prototype.addIntersections=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,n,r)},tY.prototype.interfaces_=function(){return[]},tY.prototype.getClass=function(){return tY},tY.updateIM=function(e,t){if(2!==arguments.length)return $W.prototype.updateIM.apply(this,arguments);var n=e,r=t;r.setAtLeastIfValid(n.getLocation(0,rH.ON),n.getLocation(1,rH.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,rH.LEFT),n.getLocation(1,rH.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,rH.RIGHT),n.getLocation(1,rH.RIGHT),2))},tY);function tY(){var e,t,n;$W.call(this),this.pts=null,this._env=null,this.eiList=new jW(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ZW,this._depthDelta=0,1===arguments.length?(e=arguments[0],tY.call(this,e,null)):2===arguments.length&&(t=arguments[0],n=arguments[1],this.pts=t,this._label=n)}function nY(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new HW,this._bufParams=e||null}nY.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e},nY.prototype.insertUniqueEdge=function(e){var t,n,r,i,o=this._edgeList.findEqualEdge(e);null!==o?(t=o.getLabel(),n=e.getLabel(),o.isPointwiseEqual(e)||(n=new dH(e.getLabel())).flip(),t.merge(n),r=nY.depthDelta(n),i=o.getDepthDelta()+r,o.setDepthDelta(i)):(this._edgeList.add(e),e.setDepthDelta(nY.depthDelta(e.getLabel())))},nY.prototype.buildSubgraphs=function(e,t){for(var n=new IG,r=e.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),a=new IW(n).getDepth(o);i.computeDepth(a),i.findResultEdges(),n.add(i),t.add(i.getDirectedEdges(),i.getNodes())}},nY.prototype.createSubgraphs=function(e){for(var t=new IG,n=e.getNodes().iterator();n.hasNext();){var r,i=n.next();i.isVisited()||((r=new fH).create(i),t.add(r))}return qH.sort(t,qH.reverseOrder()),t},nY.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},nY.prototype.getNoder=function(e){if(null!==this._workingNoder)return this._workingNoder;var t=new dW,n=new rG;return n.setPrecisionModel(e),t.setSegmentIntersector(new YW(n)),t},nY.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;null===n&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new AW(n,this._bufParams),i=new NW(e,t,r).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new DH(new kW),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),a=new MH(this._geomFact);this.buildSubgraphs(o,a);var s=a.getPolygons();return s.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(s)},nY.prototype.computeNodedEdges=function(e,t){var n=this.getNoder(t);n.computeNodes(e);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var i,o,a=r.next(),s=a.getCoordinates();2===s.length&&s[0].equals2D(s[1])||(i=a.getData(),o=new eY(a.getCoordinates(),new dH(i)),this.insertUniqueEdge(o))}},nY.prototype.setNoder=function(e){this._workingNoder=e},nY.prototype.interfaces_=function(){return[]},nY.prototype.getClass=function(){return nY},nY.depthDelta=function(e){var t=e.getLocation(0,rH.LEFT),n=e.getLocation(0,rH.RIGHT);return t===xk.INTERIOR&&n===xk.EXTERIOR?1:t===xk.EXTERIOR&&n===xk.INTERIOR?-1:0},nY.convertSegStrings=function(e){for(var t=new Kq,n=new IG;e.hasNext();){var r=e.next(),i=t.createLineString(r.getCoordinates());n.add(i)}return t.buildGeometry(n)};function rY(e,t,n,r){var i,o,a,s;this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length?(i=t,this._noder=e,this._scaleFactor=i,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()):4===arguments.length&&(o=t,a=n,s=r,this._noder=e,this._scaleFactor=o,this._offsetX=a,this._offsetY=s,this._isScaled=!this.isIntegerPrecision())}rY.prototype.rescale=function(e){if(Ek(e,xG))for(var t=e.iterator();t.hasNext();){var n=t.next();this.rescale(n.getCoordinates())}else if(e instanceof Array){for(var r=e,i=0;i<r.length;i++)r[i].x=r[i].x/this._scaleFactor+this._offsetX,r[i].y=r[i].y/this._scaleFactor+this._offsetY;2===r.length&&r[0].equals2D(r[1])&&Bk.out.println(r)}},rY.prototype.scale=function(e){if(Ek(e,xG)){for(var t=e,n=new IG,r=t.iterator();r.hasNext();){var i=r.next();n.add(new oW(this.scale(i.getCoordinates()),i.getData()))}return n}if(e instanceof Array){for(var o=e,a=new Array(o.length).fill(null),s=0;s<o.length;s++)a[s]=new _k(Math.round((o[s].x-this._offsetX)*this._scaleFactor),Math.round((o[s].y-this._offsetY)*this._scaleFactor),o[s].z);return RG.removeRepeatedPoints(a)}},rY.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},rY.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e},rY.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)},rY.prototype.interfaces_=function(){return[hW]},rY.prototype.getClass=function(){return rY};function iY(e){this._li=new rG,this._segStrings=null,this._segStrings=e}var oY={fact:{configurable:!0}};iY.prototype.checkEndPtVertexIntersections=function(e,t){if(0===arguments.length)for(var n=this._segStrings.iterator();n.hasNext();){var r=n.next().getCoordinates();this.checkEndPtVertexIntersections(r[0],this._segStrings),this.checkEndPtVertexIntersections(r[r.length-1],this._segStrings)}else if(2===arguments.length)for(var i=e,o=t.iterator();o.hasNext();)for(var a=o.next().getCoordinates(),s=1;s<a.length-1;s++)if(a[s].equals(i))throw new jk("found endpt/interior pt intersection at index "+s+" :pt "+i)},iY.prototype.checkInteriorIntersections=function(e,t,n,r){if(0===arguments.length)for(var i=this._segStrings.iterator();i.hasNext();)for(var o=i.next(),a=this._segStrings.iterator();a.hasNext();){var s=a.next();this.checkInteriorIntersections(o,s)}else if(2===arguments.length)for(var u=e,l=t,c=u.getCoordinates(),h=l.getCoordinates(),f=0;f<c.length-1;f++)for(var p=0;p<h.length-1;p++)this.checkInteriorIntersections(u,f,l,p);else if(4===arguments.length){var d=e,m=t,_=n,g=r;if(d===_&&m===g)return null;var y=d.getCoordinates()[m],v=d.getCoordinates()[m+1],x=_.getCoordinates()[g],b=_.getCoordinates()[g+1];if(this._li.computeIntersection(y,v,x,b),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,y,v)||this.hasInteriorIntersection(this._li,x,b)))throw new jk("found non-noded intersection at "+y+"-"+v+" and "+x+"-"+b)}},iY.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},iY.prototype.checkCollapses=function(e){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next();this.checkCollapses(n)}else if(1===arguments.length)for(var r=e.getCoordinates(),i=0;i<r.length-2;i++)this.checkCollapse(r[i],r[i+1],r[i+2])},iY.prototype.hasInteriorIntersection=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++){var i=e.getIntersection(r);if(!i.equals(t)&&!i.equals(n))return!0}return!1},iY.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new jk("found non-noded collapse at "+iY.fact.createLineString([e,t,n]))},iY.prototype.interfaces_=function(){return[]},iY.prototype.getClass=function(){return iY},oY.fact.get=function(){return new Kq},Object.defineProperties(iY,oY);function aY(e,t,n){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var r=e,i=t,o=n;if(this._originalPt=r,this._pt=r,this._scaleFactor=i,this._li=o,i<=0)throw new lk;1!==i&&(this._pt=new _k(this.scale(r.x),this.scale(r.y)),this._p0Scaled=new _k,this._p1Scaled=new _k),this.initCorners(this._pt)}var sY={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};aY.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),i=Math.min(e.y,t.y),o=Math.max(e.y,t.y),a=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(a)return!1;var s=this.intersectsToleranceSquare(e,t);return $k.isTrue(!(a&&s),"Found bad envelope test"),s},aY.prototype.initCorners=function(e){this._minx=e.x-.5,this._maxx=e.x+.5,this._miny=e.y-.5,this._maxy=e.y+.5,this._corner[0]=new _k(this._maxx,this._maxy),this._corner[1]=new _k(this._minx,this._maxy),this._corner[2]=new _k(this._minx,this._miny),this._corner[3]=new _k(this._maxx,this._miny)},aY.prototype.intersects=function(e,t){return 1===this._scaleFactor?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},aY.prototype.scale=function(e){return Math.round(e*this._scaleFactor)},aY.prototype.getCoordinate=function(){return this._originalPt},aY.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)},aY.prototype.getSafeEnvelope=function(){var e;return null===this._safeEnv&&(e=aY.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor,this._safeEnv=new Vk(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)),this._safeEnv},aY.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},aY.prototype.intersectsToleranceSquare=function(e,t){var n=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.isProper()||(!(!n||!r)||(!!e.equals(this._pt)||!!t.equals(this._pt))))))},aY.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),r=e.getCoordinate(t+1);return!!this.intersects(n,r)&&(e.addIntersection(this.getCoordinate(),t),!0)},aY.prototype.interfaces_=function(){return[]},aY.prototype.getClass=function(){return aY},sY.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(aY,sY);function uY(){this.tempEnv1=new Vk,this.selectedSegment=new aW}uY.prototype.select=function(e,t){1===arguments.length||2===arguments.length&&(e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment))},uY.prototype.interfaces_=function(){return[]},uY.prototype.getClass=function(){return uY};function lY(e){this._index=null,this._index=e}var cY={HotPixelSnapAction:{configurable:!0}};lY.prototype.snap=function(e,t,n){if(1===arguments.length)return this.snap(e,null,-1);if(3===arguments.length){var r=e,i=t,o=n,a=r.getSafeEnvelope(),s=new fY(r,i,o);return this._index.query(a,{interfaces_:function(){return[UH]},visitItem:function(e){e.select(a,s)}}),s.isNodeAdded()}},lY.prototype.interfaces_=function(){return[]},lY.prototype.getClass=function(){return lY},cY.HotPixelSnapAction.get=function(){return fY},Object.defineProperties(lY,cY);var hY,fY=((hY=uY)&&(pY.__proto__=hY),((pY.prototype=Object.create(hY&&hY.prototype)).constructor=pY).prototype.isNodeAdded=function(){return this._isNodeAdded},pY.prototype.select=function(e,t){if(2!==arguments.length)return hY.prototype.select.apply(this,arguments);var n=t,r=e.getContext();if(null!==this._parentEdge&&r===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,n)},pY.prototype.interfaces_=function(){return[]},pY.prototype.getClass=function(){return pY},pY);function pY(){hY.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=t,this._hotPixelVertexIndex=n}function dY(e){this._li=null,this._interiorIntersections=null,this._li=e,this._interiorIntersections=new IG}dY.prototype.processIntersections=function(e,t,n,r){if(e===n&&t===r)return null;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];if(this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var u=0;u<this._li.getIntersectionNum();u++)this._interiorIntersections.add(this._li.getIntersection(u));e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)}},dY.prototype.isDone=function(){return!1},dY.prototype.getInteriorIntersections=function(){return this._interiorIntersections},dY.prototype.interfaces_=function(){return[WW]},dY.prototype.getClass=function(){return dY};function mY(e){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=e;this._pm=t,this._li=new rG,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()}mY.prototype.checkCorrectness=function(e){var t=oW.getNodedSubstrings(e),n=new iY(t);try{n.checkValid()}catch(e){if(!(e instanceof Dk))throw e;e.printStackTrace()}},mY.prototype.getNodedSubstrings=function(){return oW.getNodedSubstrings(this._nodedSegStrings)},mY.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)},mY.prototype.findInteriorIntersections=function(e,t){var n=new dY(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()},mY.prototype.computeVertexSnaps=function(e){if(Ek(e,xG))for(var t=e.iterator();t.hasNext();){var n=t.next();this.computeVertexSnaps(n)}else if(e instanceof oW)for(var r=e,i=r.getCoordinates(),o=0;o<i.length;o++){var a=new aY(i[o],this._scaleFactor,this._li);this._pointSnapper.snap(a,r,o)&&r.addIntersection(i[o],o)}},mY.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new dW,this._pointSnapper=new lY(this._noder.getIndex()),this.snapRound(e,this._li)},mY.prototype.computeIntersectionSnaps=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next(),r=new aY(n,this._scaleFactor,this._li);this._pointSnapper.snap(r)}},mY.prototype.interfaces_=function(){return[hW]},mY.prototype.getClass=function(){return mY};var _Y=function(e,t){var n;this._argGeom=null,this._distance=null,this._bufParams=new gW,this._resultGeometry=null,this._saveException=null,1===arguments.length?this._argGeom=e:2===arguments.length&&(n=t,this._argGeom=e,this._bufParams=n)},gY={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};_Y.prototype.bufferFixedPrecision=function(e){var t=new rY(new mY(new Wq(1)),e.getScale()),n=new nY(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)},_Y.prototype.bufferReducedPrecision=function(e){var t,n;if(0===arguments.length){for(var r=_Y.MAX_PRECISION_DIGITS;0<=r;r--){try{this.bufferReducedPrecision(r)}catch(e){if(!(e instanceof lH))throw e;this._saveException=e}if(null!==this._resultGeometry)return null}throw this._saveException}1===arguments.length&&(t=_Y.precisionScaleFactor(this._argGeom,this._distance,e),n=new Wq(t),this.bufferFixedPrecision(n))},_Y.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===Wq.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()},_Y.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)},_Y.prototype.bufferOriginalPrecision=function(){try{var e=new nY(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(e){if(!(e instanceof jk))throw e;this._saveException=e}},_Y.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry},_Y.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)},_Y.prototype.interfaces_=function(){return[]},_Y.prototype.getClass=function(){return _Y},_Y.bufferOp=function(e,t,n,r){if(2===arguments.length){var i=t;return new _Y(e).getResultGeometry(i)}if(3===arguments.length){if(Number.isInteger(n)&&e instanceof cG&&"number"==typeof t){var o=t,a=n,s=new _Y(e);return s.setQuadrantSegments(a),s.getResultGeometry(o)}if(n instanceof gW&&e instanceof cG&&"number"==typeof t){var u=t;return new _Y(e,n).getResultGeometry(u)}}else if(4===arguments.length){var l=t,c=n,h=r,f=new _Y(e);return f.setQuadrantSegments(c),f.setEndCapStyle(h),f.getResultGeometry(l)}},_Y.precisionScaleFactor=function(e,t,n){var r=e.getEnvelopeInternal(),i=Tk.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(0<t?t:0),o=n-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},gY.CAP_ROUND.get=function(){return gW.CAP_ROUND},gY.CAP_BUTT.get=function(){return gW.CAP_FLAT},gY.CAP_FLAT.get=function(){return gW.CAP_FLAT},gY.CAP_SQUARE.get=function(){return gW.CAP_SQUARE},gY.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(_Y,gY);function yY(){this._pt=[new _k,new _k],this._distance=ck.NaN,this._isNull=!0}yY.prototype.getCoordinates=function(){return this._pt},yY.prototype.getCoordinate=function(e){return this._pt[e]},yY.prototype.setMinimum=function(e,t){if(1===arguments.length)this.setMinimum(e._pt[0],e._pt[1]);else if(2===arguments.length){var n=e,r=t;if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i<this._distance&&this.initialize(n,r,i)}},yY.prototype.initialize=function(e,t,n){var r,i,o,a;0===arguments.length?this._isNull=!0:2===arguments.length?(r=e,i=t,this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(i),this._distance=r.distance(i),this._isNull=!1):3===arguments.length&&(o=t,a=n,this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(o),this._distance=a,this._isNull=!1)},yY.prototype.getDistance=function(){return this._distance},yY.prototype.setMaximum=function(e,t){if(1===arguments.length)this.setMaximum(e._pt[0],e._pt[1]);else if(2===arguments.length){var n=e,r=t;if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i>this._distance&&this.initialize(n,r,i)}},yY.prototype.interfaces_=function(){return[]},yY.prototype.getClass=function(){return yY};function vY(){}vY.prototype.interfaces_=function(){return[]},vY.prototype.getClass=function(){return vY},vY.computeDistance=function(e,t,n){if(n instanceof yY&&e instanceof wq&&t instanceof _k)for(var r=t,i=n,o=e.getCoordinates(),a=new aW,s=0;s<o.length-1;s++){a.setCoordinates(o[s],o[s+1]);var u=a.closestPoint(r);i.setMinimum(u,r)}else if(n instanceof yY&&e instanceof Oq&&t instanceof _k){var l=e,c=t,h=n;vY.computeDistance(l.getExteriorRing(),c,h);for(var f=0;f<l.getNumInteriorRing();f++)vY.computeDistance(l.getInteriorRingN(f),c,h)}else if(n instanceof yY&&e instanceof cG&&t instanceof _k){var p=e,d=t,m=n;if(p instanceof wq)vY.computeDistance(p,d,m);else if(p instanceof Oq)vY.computeDistance(p,d,m);else if(p instanceof fq)for(var _=p,g=0;g<_.getNumGeometries();g++){var y=_.getGeometryN(g);vY.computeDistance(y,d,m)}else m.setMinimum(p.getCoordinate(),d)}else{var v,x,b;n instanceof yY&&e instanceof aW&&t instanceof _k&&(v=t,x=n,b=e.closestPoint(v),x.setMinimum(b,v))}};function xY(e){this._maxPtDist=new yY,this._inputGeom=e||null}var bY={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};xY.prototype.computeMaxMidpointDistance=function(e){var t=new TY(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},xY.prototype.computeMaxVertexDistance=function(e){var t=new EY(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},xY.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()},xY.prototype.getDistancePoints=function(){return this._maxPtDist},xY.prototype.interfaces_=function(){return[]},xY.prototype.getClass=function(){return xY},bY.MaxPointDistanceFilter.get=function(){return EY},bY.MaxMidpointDistanceFilter.get=function(){return TY},Object.defineProperties(xY,bY);var EY=function(e){this._maxPtDist=new yY,this._minPtDist=new yY,this._geom=e||null};EY.prototype.filter=function(e){this._minPtDist.initialize(),vY.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},EY.prototype.getMaxPointDistance=function(){return this._maxPtDist},EY.prototype.interfaces_=function(){return[pG]},EY.prototype.getClass=function(){return EY};var TY=function(e){this._maxPtDist=new yY,this._minPtDist=new yY,this._geom=e||null};TY.prototype.filter=function(e,t){if(0===t)return null;var n=e.getCoordinate(t-1),r=e.getCoordinate(t),i=new _k((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),vY.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},TY.prototype.isDone=function(){return!1},TY.prototype.isGeometryChanged=function(){return!1},TY.prototype.getMaxPointDistance=function(){return this._maxPtDist},TY.prototype.interfaces_=function(){return[hq]},TY.prototype.getClass=function(){return TY};function SY(e){this._comps=e||null}SY.prototype.filter=function(e){e instanceof Oq&&this._comps.add(e)},SY.prototype.interfaces_=function(){return[cq]},SY.prototype.getClass=function(){return SY},SY.getPolygons=function(e,t){if(1===arguments.length)return SY.getPolygons(e,new IG);if(2===arguments.length){var n=e,r=t;return n instanceof Oq?r.add(n):n instanceof fq&&n.apply(new SY(r)),r}};function CY(e,t){var n;this._lines=null,this._isForcedToLineString=!1,1===arguments.length?this._lines=e:2===arguments.length&&(n=t,this._lines=e,this._isForcedToLineString=n)}CY.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Nq){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof wq&&this._lines.add(e)},CY.prototype.setForceToLineString=function(e){this._isForcedToLineString=e},CY.prototype.interfaces_=function(){return[lG]},CY.prototype.getClass=function(){return CY},CY.getGeometry=function(e,t){if(1===arguments.length){var n=e;return n.getFactory().buildGeometry(CY.getLines(n))}if(2===arguments.length){var r=e,i=t;return r.getFactory().buildGeometry(CY.getLines(r,i))}},CY.getLines=function(e,t,n){if(1===arguments.length)return CY.getLines(e,!1);if(2===arguments.length){if(Ek(e,xG)&&Ek(t,xG)){for(var r=t,i=e.iterator();i.hasNext();){var o=i.next();CY.getLines(o,r)}return r}if(e instanceof cG&&"boolean"==typeof t){var a=e,s=t,u=new IG;return a.apply(new CY(u,s)),u}if(e instanceof cG&&Ek(t,xG)){var l=e,c=t;return l instanceof wq?c.add(l):l.apply(new CY(c)),c}}else if(3===arguments.length){if("boolean"==typeof n&&Ek(e,xG)&&Ek(t,xG)){for(var h=t,f=n,p=e.iterator();p.hasNext();){var d=p.next();CY.getLines(d,h,f)}return h}if("boolean"==typeof n&&e instanceof cG&&Ek(t,xG)){var m=t;return e.apply(new CY(m,n)),m}}};function wY(e){if(this._boundaryRule=dG.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){if(null===e)throw new lk;this._boundaryRule=e}}wY.prototype.locateInternal=function(e,t){if(e instanceof _k&&t instanceof Oq){var n=e,r=t;if(r.isEmpty())return xk.EXTERIOR;var i=r.getExteriorRing(),o=this.locateInPolygonRing(n,i);if(o===xk.EXTERIOR)return xk.EXTERIOR;if(o===xk.BOUNDARY)return xk.BOUNDARY;for(var a=0;a<r.getNumInteriorRing();a++){var s=r.getInteriorRingN(a),u=this.locateInPolygonRing(n,s);if(u===xk.INTERIOR)return xk.EXTERIOR;if(u===xk.BOUNDARY)return xk.BOUNDARY}return xk.INTERIOR}if(e instanceof _k&&t instanceof wq){var l=e,c=t;if(!c.getEnvelopeInternal().intersects(l))return xk.EXTERIOR;var h=c.getCoordinates();return c.isClosed()||!l.equals(h[0])&&!l.equals(h[h.length-1])?sG.isOnLine(l,h)?xk.INTERIOR:xk.EXTERIOR:xk.BOUNDARY}if(e instanceof _k&&t instanceof Iq){var f=e;return t.getCoordinate().equals2D(f)?xk.INTERIOR:xk.EXTERIOR}},wY.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?sG.locatePointInRing(e,t.getCoordinates()):xk.EXTERIOR},wY.prototype.intersects=function(e,t){return this.locate(e,t)!==xk.EXTERIOR},wY.prototype.updateLocationInfo=function(e){e===xk.INTERIOR&&(this._isIn=!0),e===xk.BOUNDARY&&this._numBoundaries++},wY.prototype.computeLocation=function(e,t){if(t instanceof Iq&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof wq)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Oq)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof pq)for(var n=t,r=0;r<n.getNumGeometries();r++){var i=n.getGeometryN(r);this.updateLocationInfo(this.locateInternal(e,i))}else if(t instanceof Rq)for(var o=t,a=0;a<o.getNumGeometries();a++){var s=o.getGeometryN(a);this.updateLocationInfo(this.locateInternal(e,s))}else if(t instanceof fq)for(var u=new DW(t);u.hasNext();){var l=u.next();l!==t&&this.computeLocation(e,l)}},wY.prototype.locate=function(e,t){return t.isEmpty()?xk.EXTERIOR:t instanceof wq||t instanceof Oq?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?xk.BOUNDARY:0<this._numBoundaries||this._isIn?xk.INTERIOR:xk.EXTERIOR)},wY.prototype.interfaces_=function(){return[]},wY.prototype.getClass=function(){return wY};function AY(){var e,t,n;this._component=null,this._segIndex=null,this._pt=null,2===arguments.length?AY.call(this,arguments[0],AY.INSIDE_AREA,arguments[1]):3===arguments.length&&(e=arguments[0],t=arguments[1],n=arguments[2],this._component=e,this._segIndex=t,this._pt=n)}var IY={INSIDE_AREA:{configurable:!0}};AY.prototype.isInsideArea=function(){return this._segIndex===AY.INSIDE_AREA},AY.prototype.getCoordinate=function(){return this._pt},AY.prototype.getGeometryComponent=function(){return this._component},AY.prototype.getSegmentIndex=function(){return this._segIndex},AY.prototype.interfaces_=function(){return[]},AY.prototype.getClass=function(){return AY},IY.INSIDE_AREA.get=function(){return-1},Object.defineProperties(AY,IY);function PY(e){this._pts=e||null}PY.prototype.filter=function(e){e instanceof Iq&&this._pts.add(e)},PY.prototype.interfaces_=function(){return[cq]},PY.prototype.getClass=function(){return PY},PY.getPoints=function(e,t){if(1===arguments.length){var n=e;return n instanceof Iq?qH.singletonList(n):PY.getPoints(n,new IG)}if(2===arguments.length){var r=e,i=t;return r instanceof Iq?i.add(r):r instanceof fq&&r.apply(new PY(i)),i}};function OY(e){this._locations=null,this._locations=e}OY.prototype.filter=function(e){(e instanceof Iq||e instanceof wq||e instanceof Oq)&&this._locations.add(new AY(e,0,e.getCoordinate()))},OY.prototype.interfaces_=function(){return[cq]},OY.prototype.getClass=function(){return OY},OY.getLocations=function(e){var t=new IG;return e.apply(new OY(t)),t};function LY(e,t,n){var r,i,o;this._geom=null,this._terminateDistance=0,this._ptLocator=new wY,this._minDistanceLocation=null,this._minDistance=ck.MAX_VALUE,2===arguments.length?(this._geom=[e,t],this._terminateDistance=0):3===arguments.length&&(r=e,i=t,o=n,this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=i,this._terminateDistance=o)}LY.prototype.computeContainmentDistance=function(e,t,n){if(0===arguments.length){var r=new Array(2).fill(null);if(this.computeContainmentDistance(0,r),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,r)}else if(2===arguments.length){var i=e,o=t,a=1-i,s=SY.getPolygons(this._geom[i]);if(0<s.size()){var u=OY.getLocations(this._geom[a]);if(this.computeContainmentDistance(u,s,o),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[a]=o[0],this._minDistanceLocation[i]=o[1],null}}else if(3===arguments.length)if(n instanceof Array&&Ek(e,SG)&&Ek(t,SG)){for(var l=e,c=t,h=n,f=0;f<l.size();f++)for(var p=l.get(f),d=0;d<c.size();d++)if(this.computeContainmentDistance(p,c.get(d),h),this._minDistance<=this._terminateDistance)return null}else if(n instanceof Array&&e instanceof AY&&t instanceof Oq){var m=e,_=t,g=n,y=m.getCoordinate();if(xk.EXTERIOR!==this._ptLocator.locate(y,_))return g[this._minDistance=0]=m,g[1]=new AY(_,y),null}},LY.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var r=0;r<e.size();r++)for(var i=e.get(r),o=0;o<t.size();o++){var a=t.get(o);if(this.computeMinDistance(i,a,n),this._minDistance<=this._terminateDistance)return null}},LY.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=CY.getLines(this._geom[0]),n=CY.getLines(this._geom[1]),r=PY.getPoints(this._geom[0]),i=PY.getPoints(this._geom[1]);return this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,i,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,r,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistancePoints(r,i,e),void this.updateMinDistance(e,!1))))},LY.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},LY.prototype.updateMinDistance=function(e,t){if(null===e[0])return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])},LY.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},LY.prototype.computeMinDistance=function(e,t,n){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(n instanceof Array&&e instanceof wq&&t instanceof Iq){var r=e,i=t,o=n;if(r.getEnvelopeInternal().distance(i.getEnvelopeInternal())>this._minDistance)return null;for(var a=r.getCoordinates(),s=i.getCoordinate(),u=0;u<a.length-1;u++){var l,c=sG.distancePointLine(s,a[u],a[u+1]);if(c<this._minDistance&&(this._minDistance=c,l=new aW(a[u],a[u+1]).closestPoint(s),o[0]=new AY(r,u,l),o[1]=new AY(i,0,s)),this._minDistance<=this._terminateDistance)return null}}else if(n instanceof Array&&e instanceof wq&&t instanceof wq){var h=e,f=t,p=n;if(h.getEnvelopeInternal().distance(f.getEnvelopeInternal())>this._minDistance)return null;for(var d=h.getCoordinates(),m=f.getCoordinates(),_=0;_<d.length-1;_++)for(var g=0;g<m.length-1;g++){var y,v,x,b=sG.distanceLineLine(d[_],d[_+1],m[g],m[g+1]);if(b<this._minDistance&&(this._minDistance=b,y=new aW(d[_],d[_+1]),v=new aW(m[g],m[g+1]),x=y.closestPoints(v),p[0]=new AY(h,_,x[0]),p[1]=new AY(f,g,x[1])),this._minDistance<=this._terminateDistance)return null}}},LY.prototype.computeMinDistancePoints=function(e,t,n){for(var r=0;r<e.size();r++)for(var i=e.get(r),o=0;o<t.size();o++){var a=t.get(o),s=i.getCoordinate().distance(a.getCoordinate());if(s<this._minDistance&&(this._minDistance=s,n[0]=new AY(i,0,i.getCoordinate()),n[1]=new AY(a,0,a.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},LY.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new lk;return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},LY.prototype.computeMinDistanceLines=function(e,t,n){for(var r=0;r<e.size();r++)for(var i=e.get(r),o=0;o<t.size();o++){var a=t.get(o);if(this.computeMinDistance(i,a,n),this._minDistance<=this._terminateDistance)return null}},LY.prototype.interfaces_=function(){return[]},LY.prototype.getClass=function(){return LY},LY.distance=function(e,t){return new LY(e,t).distance()},LY.isWithinDistance=function(e,t,n){return new LY(e,t,n).distance()<=n},LY.nearestPoints=function(e,t){return new LY(e,t).nearestPoints()};function NY(){this._pt=[new _k,new _k],this._distance=ck.NaN,this._isNull=!0}NY.prototype.getCoordinates=function(){return this._pt},NY.prototype.getCoordinate=function(e){return this._pt[e]},NY.prototype.setMinimum=function(e,t){if(1===arguments.length)this.setMinimum(e._pt[0],e._pt[1]);else if(2===arguments.length){var n=e,r=t;if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i<this._distance&&this.initialize(n,r,i)}},NY.prototype.initialize=function(e,t,n){var r,i,o,a;0===arguments.length?this._isNull=!0:2===arguments.length?(r=e,i=t,this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(i),this._distance=r.distance(i),this._isNull=!1):3===arguments.length&&(o=t,a=n,this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(o),this._distance=a,this._isNull=!1)},NY.prototype.toString=function(){return Hk.toLineString(this._pt[0],this._pt[1])},NY.prototype.getDistance=function(){return this._distance},NY.prototype.setMaximum=function(e,t){if(1===arguments.length)this.setMaximum(e._pt[0],e._pt[1]);else if(2===arguments.length){var n=e,r=t;if(this._isNull)return this.initialize(n,r),null;var i=n.distance(r);i>this._distance&&this.initialize(n,r,i)}},NY.prototype.interfaces_=function(){return[]},NY.prototype.getClass=function(){return NY};function RY(){}RY.prototype.interfaces_=function(){return[]},RY.prototype.getClass=function(){return RY},RY.computeDistance=function(e,t,n){if(n instanceof NY&&e instanceof wq&&t instanceof _k)for(var r=e,i=t,o=n,a=new aW,s=r.getCoordinates(),u=0;u<s.length-1;u++){a.setCoordinates(s[u],s[u+1]);var l=a.closestPoint(i);o.setMinimum(l,i)}else if(n instanceof NY&&e instanceof Oq&&t instanceof _k){var c=e,h=t,f=n;RY.computeDistance(c.getExteriorRing(),h,f);for(var p=0;p<c.getNumInteriorRing();p++)RY.computeDistance(c.getInteriorRingN(p),h,f)}else if(n instanceof NY&&e instanceof cG&&t instanceof _k){var d=e,m=t,_=n;if(d instanceof wq)RY.computeDistance(d,m,_);else if(d instanceof Oq)RY.computeDistance(d,m,_);else if(d instanceof fq)for(var g=d,y=0;y<g.getNumGeometries();y++){var v=g.getGeometryN(y);RY.computeDistance(v,m,_)}else _.setMinimum(d.getCoordinate(),m)}else{var x,b,E;n instanceof NY&&e instanceof aW&&t instanceof _k&&(x=t,b=n,E=e.closestPoint(x),b.setMinimum(E,x))}};function DY(e,t){this._g0=null,this._g1=null,this._ptDist=new NY,this._densifyFrac=0;var n=t;this._g0=e,this._g1=n}var MY={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};DY.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},DY.prototype.setDensifyFraction=function(e){if(1<e||e<=0)throw new lk;this._densifyFrac=e},DY.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)},DY.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},DY.prototype.computeOrientedDistance=function(e,t,n){var r,i=new FY(t);e.apply(i),n.setMaximum(i.getMaxPointDistance()),0<this._densifyFrac&&(r=new zY(t,this._densifyFrac),e.apply(r),n.setMaximum(r.getMaxPointDistance()))},DY.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},DY.prototype.interfaces_=function(){return[]},DY.prototype.getClass=function(){return DY},DY.distance=function(e,t,n){if(2===arguments.length)return new DY(e,t).distance();if(3===arguments.length){var r=n,i=new DY(e,t);return i.setDensifyFraction(r),i.distance()}},MY.MaxPointDistanceFilter.get=function(){return FY},MY.MaxDensifiedByFractionDistanceFilter.get=function(){return zY},Object.defineProperties(DY,MY);var FY=function(e){this._maxPtDist=new NY,this._minPtDist=new NY,this._euclideanDist=new RY,this._geom=null,this._geom=e};FY.prototype.filter=function(e){this._minPtDist.initialize(),RY.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},FY.prototype.getMaxPointDistance=function(){return this._maxPtDist},FY.prototype.interfaces_=function(){return[pG]},FY.prototype.getClass=function(){return FY};var zY=function(e,t){this._maxPtDist=new NY,this._minPtDist=new NY,this._geom=null,this._numSubSegs=0;var n=t;this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/n))};zY.prototype.filter=function(e,t){if(0===t)return null;for(var n=e.getCoordinate(t-1),r=e.getCoordinate(t),i=(r.x-n.x)/this._numSubSegs,o=(r.y-n.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var s=n.x+a*i,u=n.y+a*o,l=new _k(s,u);this._minPtDist.initialize(),RY.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},zY.prototype.isDone=function(){return!1},zY.prototype.isGeometryChanged=function(){return!1},zY.prototype.getMaxPointDistance=function(){return this._maxPtDist},zY.prototype.interfaces_=function(){return[hq]},zY.prototype.getClass=function(){return zY};function BY(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null}var UY={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};BY.prototype.checkMaximumDistance=function(e,t,n){var r,i=new DY(t,e);i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>n&&(this._isValid=!1,r=i.getCoordinates(),this._errorLocation=r[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Hk.toLineString(r[0],r[1])+")")},BY.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=BY.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,!(!this._input.isEmpty()&&!this._result.isEmpty())||(0<this._bufDistance?this.checkPositiveValid():this.checkNegativeValid(),BY.VERBOSE&&Bk.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},BY.prototype.checkNegativeValid=function(){if(!(this._input instanceof Oq||this._input instanceof Rq||this._input instanceof fq))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)},BY.prototype.getErrorIndicator=function(){return this._errorIndicator},BY.prototype.checkMinimumDistance=function(e,t,n){var r,i=new LY(e,t,n);this._minDistanceFound=i.distance(),this._minDistanceFound<n&&(this._isValid=!1,r=i.nearestPoints(),this._errorLocation=i.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Hk.toLineString(r[0],r[1])+" )")},BY.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)},BY.prototype.getErrorLocation=function(){return this._errorLocation},BY.prototype.getPolygonLines=function(e){for(var t=new IG,n=new CY(t),r=SY.getPolygons(e).iterator();r.hasNext();){r.next().apply(n)}return e.getFactory().buildGeometry(t)},BY.prototype.getErrorMessage=function(){return this._errMsg},BY.prototype.interfaces_=function(){return[]},BY.prototype.getClass=function(){return BY},UY.VERBOSE.get=function(){return!1},UY.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(BY,UY);function VY(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null}var kY={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};VY.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid&&this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid},VY.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*VY.MAX_ENV_DIFF_FRAC;0===e&&(e=.001);var t=new Vk(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new Vk(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},VY.prototype.checkDistance=function(){var e=new BY(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")},VY.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();0<this._distance&&t<e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},VY.prototype.checkPolygonal=function(){this._result instanceof Oq||this._result instanceof Rq||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},VY.prototype.getErrorIndicator=function(){return this._errorIndicator},VY.prototype.getErrorLocation=function(){return this._errorLocation},VY.prototype.checkExpectedEmpty=function(){return 2<=this._input.getDimension()||0<this._distance?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},VY.prototype.report=function(e){if(!VY.VERBOSE)return null;Bk.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))},VY.prototype.getErrorMessage=function(){return this._errorMsg},VY.prototype.interfaces_=function(){return[]},VY.prototype.getClass=function(){return VY},VY.isValidMsg=function(e,t,n){var r=new VY(e,t,n);return r.isValid()?null:r.getErrorMessage()},VY.isValid=function(e,t,n){return!!new VY(e,t,n).isValid()},kY.VERBOSE.get=function(){return!1},kY.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(VY,kY);function GY(e,t){this._pts=null,this._data=null;var n=t;this._pts=e,this._data=n}GY.prototype.getCoordinates=function(){return this._pts},GY.prototype.size=function(){return this._pts.length},GY.prototype.getCoordinate=function(e){return this._pts[e]},GY.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},GY.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:nW.octant(this.getCoordinate(e),this.getCoordinate(e+1))},GY.prototype.setData=function(e){this._data=e},GY.prototype.getData=function(){return this._data},GY.prototype.toString=function(){return Hk.toLineString(new Bq(this._pts))},GY.prototype.interfaces_=function(){return[rW]},GY.prototype.getClass=function(){return GY};function qY(e){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new IG,this._intersectionCount=0,this._keepIntersections=!0,this._li=e,this._interiorIntersection=null}qY.prototype.getInteriorIntersection=function(){return this._interiorIntersection},qY.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e},qY.prototype.getIntersectionSegments=function(){return this._intSegments},qY.prototype.count=function(){return this._intersectionCount},qY.prototype.getIntersections=function(){return this._intersections},qY.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},qY.prototype.setKeepIntersections=function(e){this._keepIntersections=e},qY.prototype.processIntersections=function(e,t,n,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(e===n&&t===r)return null;if(this._isCheckEndSegmentsOnly&&!(this.isEndSegment(e,t)||this.isEndSegment(n,r)))return null;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=a,this._intSegments[3]=s,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},qY.prototype.isEndSegment=function(e,t){return 0===t||t>=e.size()-2},qY.prototype.hasIntersection=function(){return null!==this._interiorIntersection},qY.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},qY.prototype.interfaces_=function(){return[WW]},qY.prototype.getClass=function(){return qY},qY.createAllIntersectionsFinder=function(e){var t=new qY(e);return t.setFindAllIntersections(!0),t},qY.createAnyIntersectionFinder=function(e){return new qY(e)},qY.createIntersectionCounter=function(e){var t=new qY(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};function HY(e){this._li=new rG,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=e}HY.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},HY.prototype.getIntersections=function(){return this._segInt.getIntersections()},HY.prototype.isValid=function(){return this.execute(),this._isValid},HY.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},HY.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new qY(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new dW;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},HY.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new lH(this.getErrorMessage(),this._segInt.getInteriorIntersection())},HY.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Hk.toLineString(e[0],e[1])+" and "+Hk.toLineString(e[2],e[3])},HY.prototype.interfaces_=function(){return[]},HY.prototype.getClass=function(){return HY},HY.computeIntersections=function(e){var t=new HY(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};function WY(){this._nv=null;var e=arguments[0];this._nv=new HY(WY.toSegmentStrings(e))}WY.prototype.checkValid=function(){this._nv.checkValid()},WY.prototype.interfaces_=function(){return[]},WY.prototype.getClass=function(){return WY},WY.toSegmentStrings=function(e){for(var t=new IG,n=e.iterator();n.hasNext();){var r=n.next();t.add(new GY(r.getCoordinates(),r))}return t},WY.checkValid=function(e){new WY(e).checkValid()};function YY(e){this._mapOp=e}YY.prototype.map=function(e){for(var t=new IG,n=0;n<e.getNumGeometries();n++){var r=this._mapOp.map(e.getGeometryN(n));r.isEmpty()||t.add(r)}return e.getFactory().createGeometryCollection(Kq.toGeometryArray(t))},YY.prototype.interfaces_=function(){return[]},YY.prototype.getClass=function(){return YY},YY.map=function(e,t){return new YY(t).map(e)};function XY(e,t,n){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new IG,this._resultLineList=new IG;var r=t,i=n;this._op=e,this._geometryFactory=r,this._ptLocator=i}XY.prototype.collectLines=function(e){for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next();this.collectLineEdge(n,e,this._lineEdgesList),this.collectBoundaryTouchEdge(n,e,this._lineEdgesList)}},XY.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)},XY.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList},XY.prototype.collectLineEdge=function(e,t,n){var r=e.getLabel(),i=e.getEdge();e.isLineEdge()&&(e.isVisited()||!BX.isResultOfOp(r,t)||i.isCovered()||(n.add(i),e.setVisitedEdge(!0)))},XY.prototype.findCoveredLineEdges=function(){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){e.next().getEdges().findCoveredLineEdges()}for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var n,r=t.next(),i=r.getEdge();r.isLineEdge()&&!i.isCoveredSet()&&(n=this._op.isCoveredByA(r.getCoordinate()),i.setCovered(n))}},XY.prototype.labelIsolatedLines=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next(),r=n.getLabel();n.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},XY.prototype.buildLines=function(){for(var e=this._lineEdgesList.iterator();e.hasNext();){var t=e.next(),n=this._geometryFactory.createLineString(t.getCoordinates());this._resultLineList.add(n),t.setInResult(!0)}},XY.prototype.collectBoundaryTouchEdge=function(e,t,n){var r=e.getLabel();return e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult()?null:($k.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),void(BX.isResultOfOp(r,t)&&t===BX.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))))},XY.prototype.interfaces_=function(){return[]},XY.prototype.getClass=function(){return XY};function jY(e,t){this._op=null,this._geometryFactory=null,this._resultPointList=new IG;var n=t;this._op=e,this._geometryFactory=n}jY.prototype.filterCoveredNodeToPoint=function(e){var t,n=e.getCoordinate();this._op.isCoveredByLA(n)||(t=this._geometryFactory.createPoint(n),this._resultPointList.add(t))},jY.prototype.extractNonCoveredResultNodes=function(e){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n,r=t.next();r.isInResult()||r.isIncidentEdgeInResult()||0!==r.getEdges().getDegree()&&e!==BX.INTERSECTION||(n=r.getLabel(),BX.isResultOfOp(n,e)&&this.filterCoveredNodeToPoint(r))}},jY.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList},jY.prototype.interfaces_=function(){return[]},jY.prototype.getClass=function(){return jY};function KY(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1}KY.prototype.transformPoint=function(e){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))},KY.prototype.transformPolygon=function(e){var t=!0,n=this.transformLinearRing(e.getExteriorRing(),e);null!==n&&n instanceof Nq&&!n.isEmpty()||(t=!1);for(var r=new IG,i=0;i<e.getNumInteriorRing();i++){var o=this.transformLinearRing(e.getInteriorRingN(i),e);null===o||o.isEmpty()||(o instanceof Nq||(t=!1),r.add(o))}if(t)return this._factory.createPolygon(n,r.toArray([]));var a=new IG;return null!==n&&a.add(n),a.addAll(r),this._factory.buildGeometry(a)},KY.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)},KY.prototype.getInputGeometry=function(){return this._inputGeom},KY.prototype.transformMultiLineString=function(e){for(var t=new IG,n=0;n<e.getNumGeometries();n++){var r=this.transformLineString(e.getGeometryN(n),e);null!==r&&(r.isEmpty()||t.add(r))}return this._factory.buildGeometry(t)},KY.prototype.transformCoordinates=function(e){return this.copy(e)},KY.prototype.transformLineString=function(e){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))},KY.prototype.transformMultiPoint=function(e){for(var t=new IG,n=0;n<e.getNumGeometries();n++){var r=this.transformPoint(e.getGeometryN(n),e);null!==r&&(r.isEmpty()||t.add(r))}return this._factory.buildGeometry(t)},KY.prototype.transformMultiPolygon=function(e){for(var t=new IG,n=0;n<e.getNumGeometries();n++){var r=this.transformPolygon(e.getGeometryN(n),e);null!==r&&(r.isEmpty()||t.add(r))}return this._factory.buildGeometry(t)},KY.prototype.copy=function(e){return e.copy()},KY.prototype.transformGeometryCollection=function(e){for(var t=new IG,n=0;n<e.getNumGeometries();n++){var r=this.transform(e.getGeometryN(n));null!==r&&(this._pruneEmptyGeometry&&r.isEmpty()||t.add(r))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Kq.toGeometryArray(t)):this._factory.buildGeometry(t)},KY.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof Iq)return this.transformPoint(e,null);if(e instanceof Lq)return this.transformMultiPoint(e,null);if(e instanceof Nq)return this.transformLinearRing(e,null);if(e instanceof wq)return this.transformLineString(e,null);if(e instanceof pq)return this.transformMultiLineString(e,null);if(e instanceof Oq)return this.transformPolygon(e,null);if(e instanceof Rq)return this.transformMultiPolygon(e,null);if(e instanceof fq)return this.transformGeometryCollection(e,null);throw new lk(e.getClass().getName())},KY.prototype.transformLinearRing=function(e){var t=this.transformCoordinates(e.getCoordinateSequence(),e);if(null===t)return this._factory.createLinearRing(null);var n=t.size();return 0<n&&n<4&&!this._preserveType?this._factory.createLineString(t):this._factory.createLinearRing(t)},KY.prototype.interfaces_=function(){return[]},KY.prototype.getClass=function(){return KY};function QY(){var e,t,n;this._snapTolerance=0,this._srcPts=null,this._seg=new aW,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof wq&&"number"==typeof arguments[1]?(e=arguments[1],QY.call(this,arguments[0].getCoordinates(),e)):arguments[0]instanceof Array&&"number"==typeof arguments[1]&&(t=arguments[0],n=arguments[1],this._srcPts=t,this._isClosed=QY.isClosed(t),this._snapTolerance=n)}QY.prototype.snapVertices=function(e,t){for(var n=this._isClosed?e.size()-1:e.size(),r=0;r<n;r++){var i=e.get(r),o=this.findSnapForVertex(i,t);null!==o&&(e.set(r,new _k(o)),0===r&&this._isClosed&&e.set(e.size()-1,new _k(o)))}},QY.prototype.findSnapForVertex=function(e,t){for(var n=0;n<t.length;n++){if(e.equals2D(t[n]))return null;if(e.distance(t[n])<this._snapTolerance)return t[n]}return null},QY.prototype.snapTo=function(e){var t=new DG(this._srcPts);return this.snapVertices(t,e),this.snapSegments(t,e),t.toCoordinateArray()},QY.prototype.snapSegments=function(e,t){if(0===t.length)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var r=0;r<n;r++){var i=t[r],o=this.findSegmentIndexToSnap(i,e);0<=o&&e.add(o+1,new _k(i),!1)}},QY.prototype.findSegmentIndexToSnap=function(e,t){for(var n=ck.MAX_VALUE,r=-1,i=0;i<t.size()-1;i++){if(this._seg.p0=t.get(i),this._seg.p1=t.get(i+1),this._seg.p0.equals2D(e)||this._seg.p1.equals2D(e)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(e);o<this._snapTolerance&&o<n&&(n=o,r=i)}return r},QY.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e},QY.prototype.interfaces_=function(){return[]},QY.prototype.getClass=function(){return QY},QY.isClosed=function(e){return!(e.length<=1)&&e[0].equals2D(e[e.length-1])};function ZY(e){this._srcGeom=e||null}var JY={SNAP_PRECISION_FACTOR:{configurable:!0}};ZY.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e);return new eX(t,n).transform(this._srcGeom)},ZY.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),r=new eX(e,n,!0).transform(this._srcGeom),i=r;return t&&Ek(i,Aq)&&(i=r.buffer(0)),i},ZY.prototype.computeSnapTolerance=function(e){return this.computeMinimumSegmentLength(e)/10},ZY.prototype.extractTargetCoordinates=function(e){for(var t=new oq,n=e.getCoordinates(),r=0;r<n.length;r++)t.add(n[r]);return t.toArray(new Array(0).fill(null))},ZY.prototype.computeMinimumSegmentLength=function(e){for(var t=ck.MAX_VALUE,n=0;n<e.length-1;n++){var r=e[n].distance(e[n+1]);r<t&&(t=r)}return t},ZY.prototype.interfaces_=function(){return[]},ZY.prototype.getClass=function(){return ZY},ZY.snap=function(e,t,n){var r=new Array(2).fill(null),i=new ZY(e);r[0]=i.snapTo(t,n);var o=new ZY(t);return r[1]=o.snapTo(r[0],n),r},ZY.computeOverlaySnapTolerance=function(e,t){if(1===arguments.length){var n,r=e,i=ZY.computeSizeBasedSnapTolerance(r),o=r.getPrecisionModel();return o.getType()!==Wq.FIXED||i<(n=1/o.getScale()*2/1.415)&&(i=n),i}if(2===arguments.length){var a=t;return Math.min(ZY.computeOverlaySnapTolerance(e),ZY.computeOverlaySnapTolerance(a))}},ZY.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal();return Math.min(t.getHeight(),t.getWidth())*ZY.SNAP_PRECISION_FACTOR},ZY.snapToSelf=function(e,t,n){return new ZY(e).snapToSelf(t,n)},JY.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(ZY,JY);var $Y,eX=(($Y=KY)&&(tX.__proto__=$Y),((tX.prototype=Object.create($Y&&$Y.prototype)).constructor=tX).prototype.snapLine=function(e,t){var n=new QY(e,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(t)},tX.prototype.transformCoordinates=function(e){var t=e.toCoordinateArray(),n=this.snapLine(t,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(n)},tX.prototype.interfaces_=function(){return[]},tX.prototype.getClass=function(){return tX},tX);function tX(e,t,n){$Y.call(this),this._snapTolerance=e||null,this._snapPts=t||null,this._isSelfSnap=void 0!==n&&n}function nX(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null}nX.prototype.getCommon=function(){return ck.longBitsToDouble(this._commonBits)},nX.prototype.add=function(e){var t=ck.doubleToLongBits(e);return this._isFirst?(this._commonBits=t,this._commonSignExp=nX.signExpBits(this._commonBits),this._isFirst=!1,null):nX.signExpBits(t)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=nX.numCommonMostSigMantissaBits(this._commonBits,t),void(this._commonBits=nX.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},nX.prototype.toString=function(e){if(1===arguments.length){var t=e,n=ck.longBitsToDouble(t),r="0000000000000000000000000000000000000000000000000000000000000000"+ck.toBinaryString(t),i=r.substring(r.length-64);return i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+n+" ]"}},nX.prototype.interfaces_=function(){return[]},nX.prototype.getClass=function(){return nX},nX.getBit=function(e,t){return 0!=(e&1<<t)?1:0},nX.signExpBits=function(e){return e>>52},nX.zeroLowerBits=function(e,t){return e&~((1<<t)-1)},nX.numCommonMostSigMantissaBits=function(e,t){for(var n=0,r=52;0<=r;r--){if(nX.getBit(e,r)!==nX.getBit(t,r))return n;n++}return 52};function rX(){this._commonCoord=null,this._ccFilter=new oX}var iX={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};rX.prototype.addCommonBits=function(e){var t=new aX(this._commonCoord);e.apply(t),e.geometryChanged()},rX.prototype.removeCommonBits=function(e){if(0===this._commonCoord.x&&0===this._commonCoord.y)return e;var t=new _k(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new aX(t);return e.apply(n),e.geometryChanged(),e},rX.prototype.getCommonCoordinate=function(){return this._commonCoord},rX.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},rX.prototype.interfaces_=function(){return[]},rX.prototype.getClass=function(){return rX},iX.CommonCoordinateFilter.get=function(){return oX},iX.Translater.get=function(){return aX},Object.defineProperties(rX,iX);var oX=function(){this._commonBitsX=new nX,this._commonBitsY=new nX};oX.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)},oX.prototype.getCommonCoordinate=function(){return new _k(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},oX.prototype.interfaces_=function(){return[pG]},oX.prototype.getClass=function(){return oX};var aX=function(e){this.trans=null;this.trans=e};aX.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,r=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,r)},aX.prototype.isDone=function(){return!1},aX.prototype.isGeometryChanged=function(){return!0},aX.prototype.interfaces_=function(){return[hq]},aX.prototype.getClass=function(){return aX};function sX(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()}sX.prototype.selfSnap=function(e){return new ZY(e).snapTo(e,this._snapTolerance)},sX.prototype.removeCommonBits=function(e){this._cbr=new rX,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t},sX.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e},sX.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=BX.overlayOp(t[0],t[1],e);return this.prepareResult(n)},sX.prototype.checkValid=function(e){e.isValid()||Bk.out.println("Snapped geometry is invalid")},sX.prototype.computeSnapTolerance=function(){this._snapTolerance=ZY.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},sX.prototype.snap=function(e){var t=this.removeCommonBits(e);return ZY.snap(t[0],t[1],this._snapTolerance)},sX.prototype.interfaces_=function(){return[]},sX.prototype.getClass=function(){return sX},sX.overlayOp=function(e,t,n){return new sX(e,t).getResultGeometry(n)},sX.union=function(e,t){return sX.overlayOp(e,t,BX.UNION)},sX.intersection=function(e,t){return sX.overlayOp(e,t,BX.INTERSECTION)},sX.symDifference=function(e,t){return sX.overlayOp(e,t,BX.SYMDIFFERENCE)},sX.difference=function(e,t){return sX.overlayOp(e,t,BX.DIFFERENCE)};function uX(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t}uX.prototype.getResultGeometry=function(e){var t=null,n=!1,r=null;try{t=BX.overlayOp(this._geom[0],this._geom[1],e);n=!0}catch(e){if(!(e instanceof jk))throw e;r=e}if(!n)try{t=sX.overlayOp(this._geom[0],this._geom[1],e)}catch(e){throw e instanceof jk?r:e}return t},uX.prototype.interfaces_=function(){return[]},uX.prototype.getClass=function(){return uX},uX.overlayOp=function(e,t,n){return new uX(e,t).getResultGeometry(n)},uX.union=function(e,t){return uX.overlayOp(e,t,BX.UNION)},uX.intersection=function(e,t){return uX.overlayOp(e,t,BX.INTERSECTION)},uX.symDifference=function(e,t){return uX.overlayOp(e,t,BX.SYMDIFFERENCE)},uX.difference=function(e,t){return uX.overlayOp(e,t,BX.DIFFERENCE)};function lX(e,t){this.mce=null,this.chainIndex=null;var n=t;this.mce=e,this.chainIndex=n}lX.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)},lX.prototype.interfaces_=function(){return[]},lX.prototype.getClass=function(){return lX};function cX(){var e,t,n,r,i;this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length?(e=arguments[0],t=arguments[1],this._eventType=cX.DELETE,this._xValue=e,this._insertEvent=t):3===arguments.length&&(n=arguments[0],r=arguments[1],i=arguments[2],this._eventType=cX.INSERT,this._label=n,this._xValue=r,this._obj=i)}var hX={INSERT:{configurable:!0},DELETE:{configurable:!0}};cX.prototype.isDelete=function(){return this._eventType===cX.DELETE},cX.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e},cX.prototype.getObject=function(){return this._obj},cX.prototype.compareTo=function(e){return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},cX.prototype.getInsertEvent=function(){return this._insertEvent},cX.prototype.isInsert=function(){return this._eventType===cX.INSERT},cX.prototype.isSameLabel=function(e){return null!==this._label&&this._label===e._label},cX.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},cX.prototype.interfaces_=function(){return[fk]},cX.prototype.getClass=function(){return cX},hX.INSERT.get=function(){return 1},hX.DELETE.get=function(){return 2},Object.defineProperties(cX,hX);function fX(){}fX.prototype.interfaces_=function(){return[]},fX.prototype.getClass=function(){return fX};function pX(e,t,n){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var r=t,i=n;this._li=e,this._includeProper=r,this._recordIsolated=i}pX.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&1===this._li.getIntersectionNum()){if(pX.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var i=e.getNumPoints()-1;if(0===t&&r===i||0===r&&t===i)return!0}}return!1},pX.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},pX.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e},pX.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},pX.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next().getCoordinate();if(e.isIntersection(r))return!0}return!1},pX.prototype.hasProperIntersection=function(){return this._hasProper},pX.prototype.hasIntersection=function(){return this._hasIntersection},pX.prototype.isDone=function(){return this._isDone},pX.prototype.isBoundaryPoint=function(e,t){return null!==t&&(!!this.isBoundaryPointInternal(e,t[0])||!!this.isBoundaryPointInternal(e,t[1]))},pX.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t},pX.prototype.addIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],a=n.getCoordinates()[r],s=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},pX.prototype.interfaces_=function(){return[]},pX.prototype.getClass=function(){return pX},pX.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)};var dX,mX=((dX=fX)&&(_X.__proto__=dX),((_X.prototype=Object.create(dX&&dX.prototype)).constructor=_X).prototype.prepareEvents=function(){qH.sort(this.events);for(var e=0;e<this.events.size();e++){var t=this.events.get(e);t.isDelete()&&t.getInsertEvent().setDeleteEventIndex(e)}},_X.prototype.computeIntersections=function(e,t,n){var r,i,o,a;if(1===arguments.length){var s=e;this.nOverlaps=0,this.prepareEvents();for(var u=0;u<this.events.size();u++){var l=this.events.get(u);if(l.isInsert()&&this.processOverlaps(u,l.getDeleteEventIndex(),l,s),s.isDone())break}}else 3===arguments.length&&(n instanceof pX&&Ek(e,SG)&&Ek(t,SG)?(r=t,i=n,this.addEdges(e,e),this.addEdges(r,r),this.computeIntersections(i)):"boolean"==typeof n&&Ek(e,SG)&&t instanceof pX&&(o=e,a=t,n?this.addEdges(o,null):this.addEdges(o),this.computeIntersections(a)))},_X.prototype.addEdge=function(e,t){for(var n=e.getMonotoneChainEdge(),r=n.getStartIndexes(),i=0;i<r.length-1;i++){var o=new lX(n,i),a=new cX(t,n.getMinX(i),o);this.events.add(a),this.events.add(new cX(n.getMaxX(i),a))}},_X.prototype.processOverlaps=function(e,t,n,r){for(var i=n.getObject(),o=e;o<t;o++){var a,s=this.events.get(o);s.isInsert()&&(a=s.getObject(),n.isSameLabel(s)||(i.computeIntersections(a,r),this.nOverlaps++))}},_X.prototype.addEdges=function(e,t){if(1===arguments.length)for(var n=e.iterator();n.hasNext();){var r=n.next();this.addEdge(r,r)}else if(2===arguments.length)for(var i=t,o=e.iterator();o.hasNext();){var a=o.next();this.addEdge(a,i)}},_X.prototype.interfaces_=function(){return[]},_X.prototype.getClass=function(){return _X},_X);function _X(){dX.call(this),this.events=new IG,this.nOverlaps=null}function gX(){this._min=ck.POSITIVE_INFINITY,this._max=ck.NEGATIVE_INFINITY}var yX={NodeComparator:{configurable:!0}};gX.prototype.getMin=function(){return this._min},gX.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)},gX.prototype.getMax=function(){return this._max},gX.prototype.toString=function(){return Hk.toLineString(new _k(this._min,0),new _k(this._max,0))},gX.prototype.interfaces_=function(){return[]},gX.prototype.getClass=function(){return gX},yX.NodeComparator.get=function(){return vX},Object.defineProperties(gX,yX);var vX=function(){};vX.prototype.compare=function(e,t){var n=(e._min+e._max)/2,r=(t._min+t._max)/2;return n<r?-1:r<n?1:0},vX.prototype.interfaces_=function(){return[dk]},vX.prototype.getClass=function(){return vX};var xX,bX=((xX=gX)&&(EX.__proto__=xX),((EX.prototype=Object.create(xX&&xX.prototype)).constructor=EX).prototype.query=function(e,t,n){if(!this.intersects(e,t))return null;n.visitItem(this._item)},EX.prototype.interfaces_=function(){return[]},EX.prototype.getClass=function(){return EX},EX);function EX(){xX.call(this),this._item=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._min=e,this._max=t,this._item=n}var TX,SX=((TX=gX)&&(CX.__proto__=TX),((CX.prototype=Object.create(TX&&TX.prototype)).constructor=CX).prototype.buildExtent=function(e,t){this._min=Math.min(e._min,t._min),this._max=Math.max(e._max,t._max)},CX.prototype.query=function(e,t,n){if(!this.intersects(e,t))return null;null!==this._node1&&this._node1.query(e,t,n),null!==this._node2&&this._node2.query(e,t,n)},CX.prototype.interfaces_=function(){return[]},CX.prototype.getClass=function(){return CX},CX);function CX(){TX.call(this),this._node1=null,this._node2=null;var e=arguments[0],t=arguments[1];this._node1=e,this._node2=t,this.buildExtent(this._node1,this._node2)}function wX(){this._leaves=new IG,this._root=null,this._level=0}wX.prototype.buildTree=function(){qH.sort(this._leaves,new gX.NodeComparator);for(var e=this._leaves,t=null,n=new IG;;){if(this.buildLevel(e,n),1===n.size())return n.get(0);t=e,e=n,n=t}},wX.prototype.insert=function(e,t,n){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new bX(e,t,n))},wX.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)},wX.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},wX.prototype.printNode=function(e){Bk.out.println(Hk.toLineString(new _k(e._min,this._level),new _k(e._max,this._level)))},wX.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},wX.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var r,i=e.get(n);null===(n+1<e.size()?e.get(n):null)?t.add(i):(r=new SX(e.get(n),e.get(n+1)),t.add(r))}},wX.prototype.interfaces_=function(){return[]},wX.prototype.getClass=function(){return wX};function AX(){this._items=new IG}AX.prototype.visitItem=function(e){this._items.add(e)},AX.prototype.getItems=function(){return this._items},AX.prototype.interfaces_=function(){return[UH]},AX.prototype.getClass=function(){return AX};function IX(e){this._index=null;var t=e;if(!Ek(t,Aq))throw new lk;this._index=new LX(t)}var PX={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};IX.prototype.locate=function(e){var t=new aG(e),n=new OX(t);return this._index.query(e.y,e.y,n),t.getLocation()},IX.prototype.interfaces_=function(){return[RW]},IX.prototype.getClass=function(){return IX},PX.SegmentVisitor.get=function(){return OX},PX.IntervalIndexedGeometry.get=function(){return LX},Object.defineProperties(IX,PX);var OX=function(e){this._counter=null;this._counter=e};OX.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))},OX.prototype.interfaces_=function(){return[UH]},OX.prototype.getClass=function(){return OX};var LX=function(e){this._index=new wX;this.init(e)};LX.prototype.init=function(e){for(var t=CY.getLines(e).iterator();t.hasNext();){var n=t.next().getCoordinates();this.addLine(n)}},LX.prototype.addLine=function(e){for(var t=1;t<e.length;t++){var n=new aW(e[t-1],e[t]),r=Math.min(n.p0.y,n.p1.y),i=Math.max(n.p0.y,n.p1.y);this._index.insert(r,i,n)}},LX.prototype.query=function(e,t,n){if(2===arguments.length){var r=e,i=t,o=new AX;return this._index.query(r,i,o),o.getItems()}3===arguments.length&&this._index.query(e,t,n)},LX.prototype.interfaces_=function(){return[]},LX.prototype.getClass=function(){return LX};var NX,RX=((NX=DH)&&(DX.__proto__=NX),((DX.prototype=Object.create(NX&&NX.prototype)).constructor=DX).prototype.insertBoundaryPoint=function(e,t){var n=this._nodes.addNode(t).getLabel(),r=1;n.getLocation(e,rH.ON)===xk.BOUNDARY&&r++;var i=DX.determineBoundary(this._boundaryNodeRule,r);n.setLocation(e,i)},DX.prototype.computeSelfNodes=function(e,t,n){if(2===arguments.length)return this.computeSelfNodes(e,t,!1);if(3===arguments.length){var r=t,i=n,o=new pX(e,!0,!1);o.setIsDoneIfProperInt(i);var a=this.createEdgeSetIntersector(),s=this._parentGeom instanceof Nq||this._parentGeom instanceof Oq||this._parentGeom instanceof Rq,u=r||!s;return a.computeIntersections(this._edges,o,u),this.addSelfIntersectionNodes(this._argIndex),o}},DX.prototype.computeSplitEdges=function(e){for(var t=this._edges.iterator();t.hasNext();)t.next().eiList.addSplitEdges(e)},DX.prototype.computeEdgeIntersections=function(e,t,n){var r=new pX(t,n,!0);return r.setBoundaryNodes(this.getBoundaryNodes(),e.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,e._edges,r),r},DX.prototype.getGeometry=function(){return this._parentGeom},DX.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},DX.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},DX.prototype.addPoint=function(e){var t;e instanceof Iq?(t=e.getCoordinate(),this.insertPoint(this._argIndex,t,xk.INTERIOR)):e instanceof _k&&this.insertPoint(this._argIndex,e,xk.INTERIOR)},DX.prototype.addPolygon=function(e){this.addPolygonRing(e.getExteriorRing(),xk.EXTERIOR,xk.INTERIOR);for(var t=0;t<e.getNumInteriorRing();t++){var n=e.getInteriorRingN(t);this.addPolygonRing(n,xk.INTERIOR,xk.EXTERIOR)}},DX.prototype.addEdge=function(e){this.insertEdge(e);var t=e.getCoordinates();this.insertPoint(this._argIndex,t[0],xk.BOUNDARY),this.insertPoint(this._argIndex,t[t.length-1],xk.BOUNDARY)},DX.prototype.addLineString=function(e){var t=RG.removeRepeatedPoints(e.getCoordinates());if(t.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=t[0],null;var n=new eY(t,new dH(this._argIndex,xk.INTERIOR));this._lineEdgeMap.put(e,n),this.insertEdge(n),$k.isTrue(2<=t.length,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,t[0]),this.insertBoundaryPoint(this._argIndex,t[t.length-1])},DX.prototype.getInvalidPoint=function(){return this._invalidPoint},DX.prototype.getBoundaryPoints=function(){for(var e=this.getBoundaryNodes(),t=new Array(e.size()).fill(null),n=0,r=e.iterator();r.hasNext();){var i=r.next();t[n++]=i.getCoordinate().copy()}return t},DX.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},DX.prototype.addSelfIntersectionNode=function(e,t,n){if(this.isBoundaryNode(e,t))return null;n===xk.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(e,t):this.insertPoint(e,t,n)},DX.prototype.addPolygonRing=function(e,t,n){if(e.isEmpty())return null;var r=RG.removeRepeatedPoints(e.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=t,o=n;sG.isCCW(r)&&(i=n,o=t);var a=new eY(r,new dH(this._argIndex,xk.BOUNDARY,i,o));this._lineEdgeMap.put(e,a),this.insertEdge(a),this.insertPoint(this._argIndex,r[0],xk.BOUNDARY)},DX.prototype.insertPoint=function(e,t,n){var r=this._nodes.addNode(t),i=r.getLabel();null===i?r._label=new dH(e,n):i.setLocation(e,n)},DX.prototype.createEdgeSetIntersector=function(){return new mX},DX.prototype.addSelfIntersectionNodes=function(e){for(var t=this._edges.iterator();t.hasNext();)for(var n=t.next(),r=n.getLabel().getLocation(e),i=n.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(e,o.coord,r)}},DX.prototype.add=function(e){if(1!==arguments.length)return NX.prototype.add.apply(this,arguments);var t=e;if(t.isEmpty())return null;if(t instanceof Rq&&(this._useBoundaryDeterminationRule=!1),t instanceof Oq)this.addPolygon(t);else if(t instanceof wq)this.addLineString(t);else if(t instanceof Iq)this.addPoint(t);else if(t instanceof Lq)this.addCollection(t);else if(t instanceof pq)this.addCollection(t);else if(t instanceof Rq)this.addCollection(t);else{if(!(t instanceof fq))throw new Error(t.getClass().getName());this.addCollection(t)}},DX.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var n=e.getGeometryN(t);this.add(n)}},DX.prototype.locate=function(e){return Ek(this._parentGeom,Aq)&&50<this._parentGeom.getNumGeometries()?(null===this._areaPtLocator&&(this._areaPtLocator=new IX(this._parentGeom)),this._areaPtLocator.locate(e)):this._ptLocator.locate(e,this._parentGeom)},DX.prototype.findEdge=function(e){return 1!==arguments.length?NX.prototype.findEdge.apply(this,arguments):this._lineEdgeMap.get(e)},DX.prototype.interfaces_=function(){return[]},DX.prototype.getClass=function(){return DX},DX.determineBoundary=function(e,t){return e.isInBoundary(t)?xk.BOUNDARY:xk.INTERIOR},DX);function DX(){var e,t,n,r,i,o;NX.call(this),this._parentGeom=null,this._lineEdgeMap=new qq,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new wY,2===arguments.length?(e=arguments[0],t=arguments[1],n=dG.OGC_SFS_BOUNDARY_RULE,this._argIndex=e,this._parentGeom=t,this._boundaryNodeRule=n,null!==t&&this.add(t)):3===arguments.length&&(r=arguments[0],i=arguments[1],o=arguments[2],this._argIndex=r,this._parentGeom=i,this._boundaryNodeRule=o,null!==i&&this.add(i))}function MX(e,t,n){var r,i,o,a,s,u,l;this._li=new rG,this._resultPrecisionModel=null,this._arg=null,1===arguments.length?(r=e,this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new RX(0,r)):2===arguments.length?(o=t,a=dG.OGC_SFS_BOUNDARY_RULE,0<=(i=e).getPrecisionModel().compareTo(o.getPrecisionModel())?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new RX(0,i,a),this._arg[1]=new RX(1,o,a)):3===arguments.length&&(u=t,l=n,0<=(s=e).getPrecisionModel().compareTo(u.getPrecisionModel())?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(u.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new RX(0,s,l),this._arg[1]=new RX(1,u,l))}MX.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()},MX.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)},MX.prototype.interfaces_=function(){return[]},MX.prototype.getClass=function(){return MX};function FX(){}FX.prototype.interfaces_=function(){return[]},FX.prototype.getClass=function(){return FX},FX.map=function(e,t){if(e instanceof cG&&Ek(t,FX.MapOp)){for(var n=e,r=t,i=new IG,o=0;o<n.getNumGeometries();o++){var a=r.map(n.getGeometryN(o));null!==a&&i.add(a)}return n.getFactory().buildGeometry(i)}if(Ek(e,xG)&&Ek(t,FX.MapOp)){for(var s=e,u=t,l=new IG,c=s.iterator();c.hasNext();){var h=c.next(),f=u.map(h);null!==f&&l.add(f)}return l}},FX.MapOp=function(){};var zX,BX=((zX=MX)&&(UX.__proto__=zX),((UX.prototype=Object.create(zX&&zX.prototype)).constructor=UX).prototype.insertUniqueEdge=function(e){var t,n,r,i=this._edgeList.findEqualEdge(e);null!==i?(t=i.getLabel(),n=e.getLabel(),i.isPointwiseEqual(e)||(n=new dH(e.getLabel())).flip(),(r=i.getDepth()).isNull()&&r.add(t),r.add(n),t.merge(n)):this._edgeList.add(e)},UX.prototype.getGraph=function(){return this._graph},UX.prototype.cancelDuplicateResultEdges=function(){for(var e=this._graph.getEdgeEnds().iterator();e.hasNext();){var t=e.next(),n=t.getSym();t.isInResult()&&n.isInResult()&&(t.setInResult(!1),n.setInResult(!1))}},UX.prototype.isCoveredByLA=function(e){return!!this.isCovered(e,this._resultLineList)||!!this.isCovered(e,this._resultPolyList)},UX.prototype.computeGeometry=function(e,t,n,r){var i=new IG;return i.addAll(e),i.addAll(t),i.addAll(n),i.isEmpty()?UX.createEmptyResult(r,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(i)},UX.prototype.mergeSymLabels=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().mergeSymLabels()},UX.prototype.isCovered=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();if(this._ptLocator.locate(e,r)!==xk.EXTERIOR)return!0}return!1},UX.prototype.replaceCollapsedEdges=function(){for(var e=new IG,t=this._edgeList.iterator();t.hasNext();){var n=t.next();n.isCollapsed()&&(t.remove(),e.add(n.getCollapsedEdge()))}this._edgeList.addAll(e)},UX.prototype.updateNodeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),n=t.getEdges().getLabel();t.getLabel().merge(n)}},UX.prototype.getResultGeometry=function(e){return this.computeOverlay(e),this._resultGeom},UX.prototype.insertUniqueEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();this.insertUniqueEdge(n)}},UX.prototype.computeOverlay=function(e){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var t=new IG;this._arg[0].computeSplitEdges(t),this._arg[1].computeSplitEdges(t),this.insertUniqueEdges(t),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),WY.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(e),this.cancelDuplicateResultEdges();var n=new MH(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var r=new XY(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(e);var i=new jY(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(e),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,e)},UX.prototype.labelIncompleteNode=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._arg[t].getGeometry());e.getLabel().setLocation(t,n)},UX.prototype.copyPoints=function(e){for(var t=this._arg[e].getNodeIterator();t.hasNext();){var n=t.next();this._graph.addNode(n.getCoordinate()).setLabel(e,n.getLabel().getLocation(e))}},UX.prototype.findResultAreaEdges=function(e){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var n=t.next(),r=n.getLabel();r.isArea()&&!n.isInteriorAreaEdge()&&UX.isResultOfOp(r.getLocation(0,rH.RIGHT),r.getLocation(1,rH.RIGHT),e)&&n.setInResult(!0)}},UX.prototype.computeLabelsFromDepths=function(){for(var e=this._edgeList.iterator();e.hasNext();){var t=e.next(),n=t.getLabel(),r=t.getDepth();if(!r.isNull()){r.normalize();for(var i=0;i<2;i++)n.isNull(i)||!n.isArea()||r.isNull(i)||(0===r.getDelta(i)?n.toLine(i):($k.isTrue(!r.isNull(i,rH.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(i,rH.LEFT,r.getLocation(i,rH.LEFT)),$k.isTrue(!r.isNull(i,rH.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(i,rH.RIGHT,r.getLocation(i,rH.RIGHT))))}}},UX.prototype.computeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},UX.prototype.labelIncompleteNodes=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),n=t.getLabel();t.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(t,0):this.labelIncompleteNode(t,1)),t.getEdges().updateLabelling(n)}},UX.prototype.isCoveredByA=function(e){return!!this.isCovered(e,this._resultPolyList)},UX.prototype.interfaces_=function(){return[]},UX.prototype.getClass=function(){return UX},UX);function UX(){var e=arguments[0],t=arguments[1];zX.call(this,e,t),this._ptLocator=new wY,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new HW,this._resultPolyList=new IG,this._resultLineList=new IG,this._resultPointList=new IG,this._graph=new DH(new kW),this._geomFact=e.getFactory()}BX.overlayOp=function(e,t,n){return new BX(e,t).getResultGeometry(n)},BX.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return BX.createEmptyResult(BX.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return YY.map(e,{interfaces_:function(){return[FX.MapOp]},map:function(e){return e.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),uX.overlayOp(e,t,BX.INTERSECTION)},BX.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return BX.createEmptyResult(BX.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),uX.overlayOp(e,t,BX.SYMDIFFERENCE)},BX.resultDimension=function(e,t,n){var r=t.getDimension(),i=n.getDimension(),o=-1;switch(e){case BX.INTERSECTION:o=Math.min(r,i);break;case BX.UNION:o=Math.max(r,i);break;case BX.DIFFERENCE:o=r;break;case BX.SYMDIFFERENCE:o=Math.max(r,i)}return o},BX.createEmptyResult=function(e,t,n,r){var i=null;switch(BX.resultDimension(e,t,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon()}return i},BX.difference=function(e,t){return e.isEmpty()?BX.createEmptyResult(BX.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),uX.overlayOp(e,t,BX.DIFFERENCE))},BX.isResultOfOp=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],n=e.getLocation(0),r=e.getLocation(1);return BX.isResultOfOp(n,r,t)}if(3===arguments.length){var i=arguments[0],o=arguments[1];switch(i===xk.BOUNDARY&&(i=xk.INTERIOR),o===xk.BOUNDARY&&(o=xk.INTERIOR),arguments[2]){case BX.INTERSECTION:return i===xk.INTERIOR&&o===xk.INTERIOR;case BX.UNION:return i===xk.INTERIOR||o===xk.INTERIOR;case BX.DIFFERENCE:return i===xk.INTERIOR&&o!==xk.INTERIOR;case BX.SYMDIFFERENCE:return i===xk.INTERIOR&&o!==xk.INTERIOR||i!==xk.INTERIOR&&o===xk.INTERIOR}return!1}},BX.INTERSECTION=1,BX.UNION=2,BX.DIFFERENCE=3,BX.SYMDIFFERENCE=4;function VX(e,t){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new wY,this._seg=new aW;var n=e,r=t;this._g=n,this._boundaryDistanceTolerance=r,this._linework=this.extractLinework(n)}VX.prototype.isWithinToleranceOfBoundary=function(e){for(var t=0;t<this._linework.getNumGeometries();t++)for(var n=this._linework.getGeometryN(t).getCoordinateSequence(),r=0;r<n.size()-1;r++){if(n.getCoordinate(r,this._seg.p0),n.getCoordinate(r+1,this._seg.p1),this._seg.distance(e)<=this._boundaryDistanceTolerance)return!0}return!1},VX.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?xk.BOUNDARY:this._ptLocator.locate(e,this._g)},VX.prototype.extractLinework=function(e){var t=new kX;e.apply(t);var n=t.getLinework(),r=Kq.toLineStringArray(n);return e.getFactory().createMultiLineString(r)},VX.prototype.interfaces_=function(){return[]},VX.prototype.getClass=function(){return VX};var kX=function(){this._linework=null,this._linework=new IG};kX.prototype.getLinework=function(){return this._linework},kX.prototype.filter=function(e){if(e instanceof Oq){var t=e;this._linework.add(t.getExteriorRing());for(var n=0;n<t.getNumInteriorRing();n++)this._linework.add(t.getInteriorRingN(n))}},kX.prototype.interfaces_=function(){return[cq]},kX.prototype.getClass=function(){return kX};function GX(e){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=e}GX.prototype.extractPoints=function(e,t,n){for(var r=e.getCoordinates(),i=0;i<r.length-1;i++)this.computeOffsetPoints(r[i],r[i+1],t,n)},GX.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t},GX.prototype.getPoints=function(e){for(var t=new IG,n=CY.getLines(this._g).iterator();n.hasNext();){var r=n.next();this.extractPoints(r,e,t)}return t},GX.prototype.computeOffsetPoints=function(e,t,n,r){var i,o,a=t.x-e.x,s=t.y-e.y,u=Math.sqrt(a*a+s*s),l=n*a/u,c=n*s/u,h=(t.x+e.x)/2,f=(t.y+e.y)/2;this._doLeft&&(i=new _k(h-c,f+l),r.add(i)),this._doRight&&(o=new _k(h+c,f-l),r.add(o))},GX.prototype.interfaces_=function(){return[]},GX.prototype.getClass=function(){return GX};function qX(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=qX.TOLERANCE,this._testCoords=new IG;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=qX.computeBoundaryDistanceTolerance(e,t),this._geom=[e,t,n],this._locFinder=[new VX(this._geom[0],this._boundaryDistanceTolerance),new VX(this._geom[1],this._boundaryDistanceTolerance),new VX(this._geom[2],this._boundaryDistanceTolerance)]}var HX={TOLERANCE:{configurable:!0}};qX.prototype.reportResult=function(e,t,n){Bk.out.println("Overlay result invalid - A:"+xk.toLocationSymbol(t[0])+" B:"+xk.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+xk.toLocationSymbol(t[2]))},qX.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t},qX.prototype.checkValid=function(e,t){if(1===arguments.length){for(var n=e,r=0;r<this._testCoords.size();r++){var i=this._testCoords.get(r);if(!this.checkValid(n,i))return this._invalidLocation=i,!1}return!0}if(2===arguments.length){var o=e,a=t;return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),!!qX.hasLocation(this._location,xk.BOUNDARY)||this.isValidResult(o,this._location)}},qX.prototype.addTestPts=function(e){var t=new GX(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))},qX.prototype.isValidResult=function(e,t){var n=BX.isResultOfOp(t[0],t[1],e),r=!(n^t[2]===xk.INTERIOR);return r||this.reportResult(e,t,n),r},qX.prototype.getInvalidLocation=function(){return this._invalidLocation},qX.prototype.interfaces_=function(){return[]},qX.prototype.getClass=function(){return qX},qX.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1},qX.computeBoundaryDistanceTolerance=function(e,t){return Math.min(ZY.computeSizeBasedSnapTolerance(e),ZY.computeSizeBasedSnapTolerance(t))},qX.isValid=function(e,t,n,r){return new qX(e,t,r).isValid(n)},HX.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(qX,HX);function WX(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=WX.extractFactory(e),this._inputGeoms=e}WX.prototype.extractElements=function(e,t){if(null===e)return null;for(var n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);this._skipEmpty&&r.isEmpty()||t.add(r)}},WX.prototype.combine=function(){for(var e=new IG,t=this._inputGeoms.iterator();t.hasNext();){var n=t.next();this.extractElements(n,e)}return 0===e.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)},WX.prototype.interfaces_=function(){return[]},WX.prototype.getClass=function(){return WX},WX.combine=function(e,t,n){return 1===arguments.length?new WX(e).combine():2===arguments.length?new WX(WX.createList(e,t)).combine():3===arguments.length?new WX(WX.createList(e,t,n)).combine():void 0},WX.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()},WX.createList=function(e,t,n){if(2===arguments.length){var r=e,i=t,o=new IG;return o.add(r),o.add(i),o}if(3===arguments.length){var a=e,s=t,u=n,l=new IG;return l.add(a),l.add(s),l.add(u),l}};function YX(e){this._inputPolys=null,this._geomFactory=null,this._inputPolys=e,null===this._inputPolys&&(this._inputPolys=new IG)}var XX={STRTREE_NODE_CAPACITY:{configurable:!0}};YX.prototype.reduceToGeometries=function(e){for(var t=new IG,n=e.iterator();n.hasNext();){var r=n.next(),i=null;Ek(r,SG)?i=this.unionTree(r):r instanceof cG&&(i=r),t.add(i)}return t},YX.prototype.extractByEnvelope=function(e,t,n){for(var r=new IG,i=0;i<t.getNumGeometries();i++){var o=t.getGeometryN(i);o.getEnvelopeInternal().intersects(e)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)},YX.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!n.intersects(r))return WX.combine(e,t);if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var i=n.intersection(r);return this.unionUsingEnvelopeIntersection(e,t,i)},YX.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new QH(YX.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=e.itemsTree();return this.unionTree(r)},YX.prototype.binaryUnion=function(e,t,n){if(1===arguments.length)return this.binaryUnion(e,0,e.size());if(3===arguments.length){var r=e,i=t,o=n;if(o-i<=1){var a=YX.getGeometry(r,i);return this.unionSafe(a,null)}if(o-i==2)return this.unionSafe(YX.getGeometry(r,i),YX.getGeometry(r,i+1));var s=Math.trunc((o+i)/2),u=this.binaryUnion(r,i,s),l=this.binaryUnion(r,s,o);return this.unionSafe(u,l)}},YX.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();)var r=n.next(),t=null===t?r.copy():t.union(r);return t},YX.prototype.unionSafe=function(e,t){return null===e&&null===t?null:null===e?t.copy():null===t?e.copy():this.unionOptimized(e,t)},YX.prototype.unionActual=function(e,t){return YX.restrictToPolygons(e.union(t))},YX.prototype.unionTree=function(e){var t=this.reduceToGeometries(e);return this.binaryUnion(t)},YX.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var r=new IG,i=this.extractByEnvelope(n,e,r),o=this.extractByEnvelope(n,t,r),a=this.unionActual(i,o);return r.add(a),WX.combine(r)},YX.prototype.bufferUnion=function(e,t){if(1===arguments.length){var n=e;return n.get(0).getFactory().buildGeometry(n).buffer(0)}if(2===arguments.length){var r=e,i=t;return r.getFactory().createGeometryCollection([r,i]).buffer(0)}},YX.prototype.interfaces_=function(){return[]},YX.prototype.getClass=function(){return YX},YX.restrictToPolygons=function(e){if(Ek(e,Aq))return e;var t=SY.getPolygons(e);return 1===t.size()?t.get(0):e.getFactory().createMultiPolygon(Kq.toPolygonArray(t))},YX.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)},YX.union=function(e){return new YX(e).union()},XX.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(YX,XX);var jX=function(){};function KX(e){switch(e.type){case"Polygon":return 1<ez(e)?e:null;case"MultiPolygon":var t=[];if(wR(e,function(e){1<ez(e)&&t.push(e.geometry.coordinates)}),t.length)return{type:"MultiPolygon",coordinates:t}}}jX.prototype.interfaces_=function(){return[]},jX.prototype.getClass=function(){return jX},jX.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return BX.createEmptyResult(BX.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),uX.overlayOp(e,t,BX.UNION)};function QX(){return new ZX}function ZX(){this.reset()}ZX.prototype={constructor:ZX,reset:function(){this.s=this.t=0},add:function(e){$X(JX,e,this.t),$X(this,JX.s,this.s),this.s?this.t+=JX.t:this.s=JX.t},valueOf:function(){return this.s}};var JX=new ZX;function $X(e,t,n){var r=e.s=t+n,i=r-t,o=r-i;e.t=t-o+(n-i)}var ej=1e-6,tj=Math.PI,nj=tj/2,rj=tj/4,ij=2*tj,oj=180/tj,aj=tj/180,sj=Math.abs,uj=Math.atan,lj=Math.atan2,cj=Math.cos,hj=Math.exp,fj=Math.log,pj=Math.sin,dj=Math.sqrt,mj=Math.tan;function _j(e){return 1<e?nj:e<-1?-nj:Math.asin(e)}function gj(){}function yj(e,t){e&&xj.hasOwnProperty(e.type)&&xj[e.type](e,t)}var vj={Feature:function(e,t){yj(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)yj(n[r].geometry,t)}},xj={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){bj(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)bj(n[r],t,0)},Polygon:function(e,t){Ej(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Ej(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)yj(n[r],t)}};function bj(e,t,n){var r,i=-1,o=e.length-n;for(t.lineStart();++i<o;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function Ej(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)bj(e[n],t,1);t.polygonEnd()}var Tj=function(e,t){e&&vj.hasOwnProperty(e.type)?vj[e.type](e,t):yj(e,t)};QX(),QX();function Sj(e){return[lj(e[1],e[0]),_j(e[2])]}function Cj(e){var t=e[0],n=e[1],r=cj(n);return[r*cj(t),r*pj(t),pj(n)]}function wj(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Aj(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Ij(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Pj(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Oj(e){var t=dj(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}QX();var Lj=function(n,r){function e(e,t){return e=n(e,t),r(e[0],e[1])}return n.invert&&r.invert&&(e.invert=function(e,t){return(e=r.invert(e,t))&&n.invert(e[0],e[1])}),e};function Nj(e,t){return[tj<e?e-ij:e<-tj?e+ij:e,t]}function Rj(e,t,n){return(e%=ij)?t||n?Lj(Mj(e),Fj(t,n)):Mj(e):t||n?Fj(t,n):Nj}function Dj(n){return function(e,t){return[tj<(e+=n)?e-ij:e<-tj?e+ij:e,t]}}function Mj(e){var t=Dj(e);return t.invert=Dj(-e),t}function Fj(e,t){var s=cj(e),u=pj(e),l=cj(t),c=pj(t);function n(e,t){var n=cj(t),r=cj(e)*n,i=pj(e)*n,o=pj(t),a=o*s+r*u;return[lj(i*l-a*c,r*s-o*u),_j(a*l+i*c)]}return n.invert=function(e,t){var n=cj(t),r=cj(e)*n,i=pj(e)*n,o=pj(t),a=o*l-i*c;return[lj(i*l+o*c,r*s+a*u),_j(a*s-r*u)]},n}Nj.invert=Nj;function zj(e,t){(t=Cj(t))[0]-=e,Oj(t);var n,r=1<(n=-t[1])?0:n<-1?tj:Math.acos(n);return((-t[2]<0?-r:r)+ij-ej)%ij}function Bj(e,t){return sj(e[0]-t[0])<ej&&sj(e[1]-t[1])<ej}var Uj=function(){var n,t=[];return{point:function(e,t){n.push([e,t])},lineStart:function(){t.push(n=[])},lineEnd:gj,rejoin:function(){1<t.length&&t.push(t.pop().concat(t.shift()))},result:function(){var e=t;return t=[],n=null,e}}},Vj=function(e,t,n,r,i,o){var a=e[0],s=e[1],u=0,l=1,c=t[0]-a,h=t[1]-s,f=n-a;if(c||!(0<f)){if(f/=c,c<0){if(f<u)return;f<l&&(l=f)}else if(0<c){if(l<f)return;u<f&&(u=f)}if(f=i-a,c||!(f<0)){if(f/=c,c<0){if(l<f)return;u<f&&(u=f)}else if(0<c){if(f<u)return;f<l&&(l=f)}if(f=r-s,h||!(0<f)){if(f/=h,h<0){if(f<u)return;f<l&&(l=f)}else if(0<h){if(l<f)return;u<f&&(u=f)}if(f=o-s,h||!(f<0)){if(f/=h,h<0){if(l<f)return;u<f&&(u=f)}else if(0<h){if(f<u)return;f<l&&(l=f)}return 0<u&&(e[0]=a+u*c,e[1]=s+u*h),l<1&&(t[0]=a+l*c,t[1]=s+l*h),!0}}}}};function kj(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var Gj=function(e,t,n,r,o){var a,i,s=[],u=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],i=e[t];if(Bj(r,i)){for(o.lineStart(),a=0;a<t;++a)o.point((r=e[a])[0],r[1]);o.lineEnd()}else s.push(n=new kj(r,e,null,!0)),u.push(n.o=new kj(r,null,n,!1)),s.push(n=new kj(i,e,null,!1)),u.push(n.o=new kj(i,null,n,!0))}}),s.length){for(u.sort(t),qj(s),qj(u),a=0,i=u.length;a<i;++a)u[a].e=n=!n;for(var l,c,h=s[0];;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;l=f.z,o.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(a=0,i=l.length;a<i;++a)o.point((c=l[a])[0],c[1]);else r(f.x,f.n.x,1,o);f=f.n}else{if(p)for(l=f.p.z,a=l.length-1;0<=a;--a)o.point((c=l[a])[0],c[1]);else r(f.x,f.p.x,-1,o);f=f.p}l=(f=f.o).z,p=!p}while(!f.v);o.lineEnd()}}};function qj(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Hj(e,t){return e<t?-1:t<e?1:t<=e?0:NaN}1===(Wj=Hj).length&&(Yj=Wj,Wj=function(e,t){return Hj(Yj(e),t)});var Wj,Yj,Xj=function(e){for(var t,n,r,i=e.length,o=-1,a=0;++o<i;)a+=e[o].length;for(n=new Array(a);0<=--i;)for(t=(r=e[i]).length;0<=--t;)n[--a]=r[t];return n},jj=1e9,Kj=-jj;function Qj(g,y,v,x){function b(e,t){return g<=e&&e<=v&&y<=t&&t<=x}function E(e,t,n,r){var i=0,o=0;if(null==e||(i=a(e,n))!==(o=a(t,n))||s(e,t)<0^0<n)for(;r.point(0===i||3===i?g:v,1<i?x:y),(i=(i+n+4)%4)!==o;);else r.point(t[0],t[1])}function a(e,t){return sj(e[0]-g)<ej?0<t?0:3:sj(e[0]-v)<ej?0<t?2:1:sj(e[1]-y)<ej?0<t?1:0:0<t?3:2}function T(e,t){return s(e.x,t.x)}function s(e,t){var n=a(e,1),r=a(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(r){var i,h,o,a,s,u,l,c,f,p,d,m=r,e=Uj(),t={point:n,lineStart:function(){t.point=_,h&&h.push(o=[]);p=!0,f=!1,l=c=NaN},lineEnd:function(){i&&(_(a,s),u&&f&&e.rejoin(),i.push(e.result()));t.point=n,f&&m.lineEnd()},polygonStart:function(){m=e,i=[],h=[],d=!0},polygonEnd:function(){var e=function(){for(var e=0,t=0,n=h.length;t<n;++t)for(var r,i,o=h[t],a=1,s=o.length,u=o[0],l=u[0],c=u[1];a<s;++a)r=l,i=c,u=o[a],l=u[0],c=u[1],i<=x?x<c&&(c-i)*(g-r)<(l-r)*(x-i)&&++e:c<=x&&(l-r)*(x-i)<(c-i)*(g-r)&&--e;return e}(),t=d&&e,n=(i=Xj(i)).length;(t||n)&&(r.polygonStart(),t&&(r.lineStart(),E(null,null,1,r),r.lineEnd()),n&&Gj(i,T,e,E,r),r.polygonEnd());m=r,i=h=o=null}};function n(e,t){b(e,t)&&m.point(e,t)}function _(e,t){var n,r,i=b(e,t);h&&o.push([e,t]),p?(a=e,s=t,p=!1,(u=i)&&(m.lineStart(),m.point(e,t))):i&&f?m.point(e,t):(n=[l=Math.max(Kj,Math.min(jj,l)),c=Math.max(Kj,Math.min(jj,c))],r=[e=Math.max(Kj,Math.min(jj,e)),t=Math.max(Kj,Math.min(jj,t))],Vj(n,r,g,y,v,x)?(f||(m.lineStart(),m.point(n[0],n[1])),m.point(r[0],r[1]),i||m.lineEnd(),d=!1):i&&(m.lineStart(),m.point(e,t),d=!1)),l=e,c=t,f=i}return t}}var Zj=QX(),Jj=(QX(),function(e){return e}),$j=(QX(),QX(),1/0),eK=$j,tK=-$j,nK=tK,rK={point:function(e,t){e<$j&&($j=e);tK<e&&(tK=e);t<eK&&(eK=t);nK<t&&(nK=t)},lineStart:gj,lineEnd:gj,polygonStart:gj,polygonEnd:gj,result:function(){var e=[[$j,eK],[tK,nK]];return tK=nK=-(eK=$j=1/0),e}};function iK(y,v,x,b){return function(r,s){var u,l,c,i=v(s),t=r.invert(b[0],b[1]),h=Uj(),f=v(h),p=!1,n={point:o,lineStart:a,lineEnd:d,polygonStart:function(){n.point=m,n.lineStart=_,n.lineEnd=g,l=[],u=[]},polygonEnd:function(){n.point=o,n.lineStart=a,n.lineEnd=d,l=Xj(l);var e=function(e,t){var n=t[0],r=t[1],i=[pj(n),-cj(n),0],o=0,a=0;Zj.reset();for(var s=0,u=e.length;s<u;++s)if(c=(l=e[s]).length)for(var l,c,h=l[c-1],f=h[0],p=h[1]/2+rj,d=pj(p),m=cj(p),_=0;_<c;++_,f=b,d=T,m=S,h=x){var g,y,v,x=l[_],b=x[0],E=x[1]/2+rj,T=pj(E),S=cj(E),C=b-f,w=0<=C?1:-1,A=w*C,I=tj<A,P=d*T;Zj.add(lj(P*w*pj(A),m*S+P*cj(A))),o+=I?C+w*ij:C,I^n<=f^n<=b&&(Oj(g=Aj(Cj(h),Cj(x))),Oj(y=Aj(i,g)),((v=(I^0<=C?-1:1)*_j(y[2]))<r||r===v&&(g[0]||g[1]))&&(a+=I^0<=C?1:-1))}return(o<-ej||o<ej&&Zj<-ej)^1&a}(u,t);l.length?(p||(s.polygonStart(),p=!0),Gj(l,aK,e,x,s)):e&&(p||(s.polygonStart(),p=!0),s.lineStart(),x(null,null,1,s),s.lineEnd()),p&&(s.polygonEnd(),p=!1),l=u=null},sphere:function(){s.polygonStart(),s.lineStart(),x(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function o(e,t){var n=r(e,t);y(e=n[0],t=n[1])&&s.point(e,t)}function e(e,t){var n=r(e,t);i.point(n[0],n[1])}function a(){n.point=e,i.lineStart()}function d(){n.point=o,i.lineEnd()}function m(e,t){c.push([e,t]);var n=r(e,t);f.point(n[0],n[1])}function _(){f.lineStart(),c=[]}function g(){m(c[0][0],c[0][1]),f.lineEnd();var e,t,n,r,i=f.clean(),o=h.result(),a=o.length;if(c.pop(),u.push(c),c=null,a)if(1&i){if(0<(t=(n=o[0]).length-1)){for(p||(s.polygonStart(),p=!0),s.lineStart(),e=0;e<t;++e)s.point((r=n[e])[0],r[1]);s.lineEnd()}}else 1<a&&2&i&&o.push(o.pop().concat(o.shift())),l.push(o.filter(oK))}return n}}QX();function oK(e){return 1<e.length}function aK(e,t){return((e=e.x)[0]<0?e[1]-nj-ej:nj-e[1])-((t=t.x)[0]<0?t[1]-nj-ej:nj-t[1])}var sK=iK(function(){return 1},function(h){var f,p=NaN,d=NaN,m=NaN;return{lineStart:function(){h.lineStart(),f=1},point:function(e,t){var n,r,i,o,a,s,u,l=0<e?tj:-tj,c=sj(e-p);sj(c-tj)<ej?(h.point(p,d=0<(d+t)/2?nj:-nj),h.point(m,d),h.lineEnd(),h.lineStart(),h.point(l,d),h.point(e,d),f=0):m!==l&&tj<=c&&(sj(p-m)<ej&&(p-=m*ej),sj(e-l)<ej&&(e-=l*ej),r=d,o=t,u=pj((n=p)-(i=e)),d=sj(u)>ej?uj((pj(r)*(s=cj(o))*pj(i)-pj(o)*(a=cj(r))*pj(n))/(a*s*u)):(r+o)/2,h.point(m,d),h.lineEnd(),h.lineStart(),h.point(l,d),f=0),h.point(p=e,d=t),m=l},lineEnd:function(){h.lineEnd(),p=d=NaN},clean:function(){return 2-f}}},function(e,t,n,r){var i;{var o;null==e?(i=n*nj,r.point(-tj,i),r.point(0,i),r.point(tj,i),r.point(tj,0),r.point(tj,-i),r.point(0,-i),r.point(-tj,-i),r.point(-tj,0),r.point(-tj,i)):sj(e[0]-t[0])>ej?(o=e[0]<t[0]?tj:-tj,i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)):r.point(t[0],t[1])}},[-tj,-nj]);var uK=function(i,o){var w=cj(i),p=0<w,d=sj(w)>ej;function m(e,t){return cj(e)*cj(t)>w}function _(e,t,n){var r=[1,0,0],i=Aj(Cj(e),Cj(t)),o=wj(i,i),a=i[0],s=o-a*a;if(!s)return!n&&e;var u=w*o/s,l=-w*a/s,c=Aj(r,i),h=Pj(r,u);Ij(h,Pj(i,l));var f=c,p=wj(h,f),d=wj(f,f),m=p*p-d*(wj(h,h)-1);if(!(m<0)){var _=dj(m),g=Pj(f,(-p-_)/d);if(Ij(g,h),g=Sj(g),!n)return g;var y,v=e[0],x=t[0],b=e[1],E=t[1];x<v&&(y=v,v=x,x=y);var T=x-v,S=sj(T-tj)<ej;if(!S&&E<b&&(y=b,b=E,E=y),S||T<ej?S?0<b+E^g[1]<(sj(g[0]-v)<ej?b:E):b<=g[1]&&g[1]<=E:tj<T^(v<=g[0]&&g[0]<=x)){var C=Pj(f,(-p+_)/d);return Ij(C,h),[g,Sj(C)]}}}function g(e,t){var n=p?i:tj-i,r=0;return e<-n?r|=1:n<e&&(r|=2),t<-n?r|=4:n<t&&(r|=8),r}return iK(m,function(s){var u,l,c,h,f;return{lineStart:function(){h=c=!1,f=1},point:function(e,t){var n,r,i=[e,t],o=m(e,t),a=p?o?0:g(e,t):o?g(e+(e<0?tj:-tj),t):0;!u&&(h=c=o)&&s.lineStart(),o!==c&&((n=_(u,i))&&!Bj(u,n)&&!Bj(i,n)||(i[0]+=ej,i[1]+=ej,o=m(i[0],i[1]))),o!==c?(f=0,o?(s.lineStart(),n=_(i,u),s.point(n[0],n[1])):(n=_(u,i),s.point(n[0],n[1]),s.lineEnd()),u=n):d&&u&&p^o&&(a&l||!(r=_(i,u,!0))||(f=0,p?(s.lineStart(),s.point(r[0][0],r[0][1]),s.point(r[1][0],r[1][1]),s.lineEnd()):(s.point(r[1][0],r[1][1]),s.lineEnd(),s.lineStart(),s.point(r[0][0],r[0][1])))),!o||u&&Bj(u,i)||s.point(i[0],i[1]),u=i,c=o,l=a},lineEnd:function(){c&&s.lineEnd(),u=null},clean:function(){return f|(h&&c)<<1}}},function(e,t,n,r){!function(e,t,n,r,i,o){if(n){var a=cj(t),s=pj(t),u=r*n;null==i?(i=t+r*ij,o=t-u/2):(i=zj(a,i),o=zj(a,o),(0<r?i<o:o<i)&&(i+=r*ij));for(var l,c=i;0<r?o<c:c<o;c-=u)l=Sj([a,-s*cj(c),-s*pj(c)]),e.point(l[0],l[1])}}(r,i,o,n,e,t)},p?[0,-i]:[-tj,i-tj])};function lK(r){return function(e){var t=new cK;for(var n in r)t[n]=r[n];return t.stream=e,t}}function cK(){}function hK(e,t,n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],o=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),null!=o&&e.clipExtent(null),Tj(n,e.stream(rK));var a=rK.result(),s=Math.min(r/(a[1][0]-a[0][0]),i/(a[1][1]-a[0][1])),u=+t[0][0]+(r-s*(a[1][0]+a[0][0]))/2,l=+t[0][1]+(i-s*(a[1][1]+a[0][1]))/2;return null!=o&&e.clipExtent(o),e.scale(150*s).translate([u,l])}cK.prototype={constructor:cK,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var fK=cj(30*aj),pK=function(e,t){return+t?(P=e,O=t,function(i){var n,r,o,a,s,u,l,c,h,f,p,d,m={point:e,lineStart:t,lineEnd:g,polygonStart:function(){i.polygonStart(),m.lineStart=y},polygonEnd:function(){i.polygonEnd(),m.lineStart=t}};function e(e,t){e=P(e,t),i.point(e[0],e[1])}function t(){c=NaN,m.point=_,i.lineStart()}function _(e,t){var n=Cj([e,t]),r=P(e,t);L(c,h,l,f,p,d,c=r[0],h=r[1],l=e,f=n[0],p=n[1],d=n[2],16,i),i.point(c,h)}function g(){m.point=e,i.lineEnd()}function y(){t(),m.point=v,m.lineEnd=x}function v(e,t){_(n=e,t),r=c,o=h,a=f,s=p,u=d,m.point=_}function x(){L(c,h,l,f,p,d,r,o,n,a,s,u,16,i),(m.lineEnd=g)()}return m}):(n=e,lK({point:function(e,t){e=n(e,t),this.stream.point(e[0],e[1])}}));var n,P,O;function L(e,t,n,r,i,o,a,s,u,l,c,h,f,p){var d,m,_,g,y,v,x,b,E,T,S,C,w=a-e,A=s-t,I=w*w+A*A;4*O<I&&f--&&(_=o+h,y=_j(_/=g=dj((d=r+l)*d+(m=i+c)*m+_*_)),v=sj(sj(_)-1)<ej||sj(n-u)<ej?(n+u)/2:lj(m,d),b=(x=P(v,y))[0],E=x[1],(O<(C=A*(T=b-e)-w*(S=E-t))*C/I||.3<sj((w*T+A*S)/I-.5)||r*l+i*c+o*h<fK)&&(L(e,t,n,r,i,o,b,E,v,d/=g,m/=g,_,f,p),p.point(b,E),L(b,E,v,d,m,_,a,s,u,l,c,h,f,p)))}};var dK=lK({point:function(e,t){this.stream.point(e*aj,t*aj)}});function mK(e){return a=function(){return e},g=150,y=480,v=250,S=T=E=b=x=0,w=sK,A=C=null,I=Jj,O=pK(r,P=.5),n.stream=function(e){return m&&_===e?m:m=dK(w(c,O(I(_=e))))},n.clipAngle=function(e){return arguments.length?(w=+e?uK(C=e*aj,6*aj):(C=null,sK),o()):C*oj},n.clipExtent=function(e){return arguments.length?(I=null==e?(A=f=p=d=null,Jj):Qj(A=+e[0][0],f=+e[0][1],p=+e[1][0],d=+e[1][1]),o()):null==A?null:[[A,f],[p,d]]},n.scale=function(e){return arguments.length?(g=+e,i()):g},n.translate=function(e){return arguments.length?(y=+e[0],v=+e[1],i()):[y,v]},n.center=function(e){return arguments.length?(x=e[0]%360*aj,b=e[1]%360*aj,i()):[x*oj,b*oj]},n.rotate=function(e){return arguments.length?(E=e[0]%360*aj,T=e[1]%360*aj,S=2<e.length?e[2]%360*aj:0,i()):[E*oj,T*oj,S*oj]},n.precision=function(e){return arguments.length?(O=pK(r,P=e*e),o()):dj(P)},n.fitExtent=function(e,t){return hK(n,e,t)},n.fitSize=function(e,t){return hK(n,[[0,0],e],t)},function(){return s=a.apply(this,arguments),n.invert=s.invert&&t,i()}();function n(e){return[(e=h(e[0]*aj,e[1]*aj))[0]*g+u,l-e[1]*g]}function t(e){return(e=h.invert((e[0]-u)/g,(l-e[1])/g))&&[e[0]*oj,e[1]*oj]}function r(e,t){return[(e=s(e,t))[0]*g+u,l-e[1]*g]}function i(){h=Lj(c=Rj(E,T,S),s);var e=s(x,b);return u=y-e[0]*g,l=v+e[1]*g,o()}function o(){return m=_=null,n}var a,s,u,l,c,h,f,p,d,m,_,g,y,v,x,b,E,T,S,C,w,A,I,P,O}function _K(e,t){return[e,fj(mj((nj+t)/2))]}function gK(r){var i,o,a,s=mK(r),t=s.center,u=s.scale,n=s.translate,l=s.clipExtent,c=null;function h(){var t,e=tj*u(),n=s((t=Rj((t=s.rotate())[0]*aj,t[1]*aj,2<t.length?t[2]*aj:0),function(e){return(e=t.invert(e[0]*aj,e[1]*aj))[0]*=oj,e[1]*=oj,e}([0,0])));return l(null==c?[[n[0]-e,n[1]-e],[n[0]+e,n[1]+e]]:r===_K?[[Math.max(n[0]-e,c),i],[Math.min(n[0]+e,o),a]]:[[c,Math.max(n[1]-e,i)],[o,Math.min(n[1]+e,a)]])}return s.scale=function(e){return arguments.length?(u(e),h()):u()},s.translate=function(e){return arguments.length?(n(e),h()):n()},s.center=function(e){return arguments.length?(t(e),h()):t()},s.clipExtent=function(e){return arguments.length?(null==e?c=i=o=a=null:(c=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1]),h()):null==c?null:[[c,i],[o,a]]},h()}function yK(e,t){return[fj(mj((nj+t)/2)),-e]}_K.invert=function(e,t){return[e,2*uj(hj(t))-nj]},yK.invert=function(e,t){return[-t,2*uj(hj(e))-nj]};var vK=function(){var e=gK(yK),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],2<e.length?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)};function xK(e,n,r){var t=e.properties||{},i="Feature"===e.type?e.geometry:e;if("GeometryCollection"===i.type){var o=[];return SR(e,function(e){var t=xK(e,n,r);t&&o.push(t)}),JN(o)}var a=RR(e),s=50<a[1]&&50<a[3],u=s?{type:i.type,coordinates:function t(e,n){if("object"!=typeof e[0])return n(e);return e.map(function(e){return t(e,n)})}(i.coordinates,bK(i))}:qF(i),l=(new tH).read(u),c=iR(oR(n,r),"meters"),h=_Y.bufferOp(l,c);if(!function e(t){if(Array.isArray(t[0]))return e(t[0]);return isNaN(t[0])}((h=(new nH).write(h)).coordinates)){var f=s?{type:h.type,coordinates:function t(e,n){if("object"!=typeof e[0])return n.invert(e);return e.map(function(e){return t(e,n)})}(h.coordinates,bK(i))}:HF(h);return f.geometry?f:HN(f,t)}}function bK(e){var t=GM(e).geometry.coordinates.reverse(),n=t.map(function(e){return-e});return vK().center(t).rotate(n).scale(VN)}function EK(){for(var e=new tH,t=e.read(JSON.stringify(arguments[0].geometry)),n=1;n<arguments.length;n++)t=jX.union(t,e.read(JSON.stringify(arguments[n].geometry)));return{type:"Feature",geometry:t=(new nH).write(t),properties:arguments[0].properties}}function TK(e,t){var n=VR(e),r=VR(t);if(wM(pz(r,{precision:4})).coordinates[0].length<4)return null;if(wM(pz(n,{precision:4})).coordinates[0].length<4)return null;var i=new tH,o=i.read(pz(n)),a=i.read(pz(r)),s=BX.intersection(o,a);return s.isEmpty()?null:HN((new nH).write(s))}function SK(e,t){return function(r,e,i){var o,a;if(!Array.isArray(e))throw new Error("Get closest expects an array as second argument");return e.forEach(function(e,t){var n=i(e,r);0<=n&&(void 0===a||n<a)&&(a=n,o=t)}),o}(e,t,function(e,t){return e-t})}function CK(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.properties||{},i=n.triangles,o=n.mask;if(null==t)throw new Error("cellSide is required");if(!fR(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(o&&-1===["Polygon","MultiPolygon"].indexOf(GR(o)))throw new Error("options.mask must be a (Multi)Polygon");var a=e[0],s=e[1],u=e[2],l=e[3],c=(s+l)/2,h=(a+u)/2,f=2*t/ZD([a,c],[u,c],n)*(u-a),p=2*t/ZD([h,s],[h,l],n)*(l-s),d=f/2,m=2*d,_=Math.sqrt(3)/2*p,g=u-a,y=l-s,v=.75*m,x=_,b=(g-m)/(m-d/2),E=Math.floor(b),T=(E*v-d/2-g)/2-d/2+v/2,S=Math.floor((y-_)/_),C=(y-S*_)/2,w=_/2<S*_-y;w&&(C-=_/4);for(var A=[],I=[],P=0;P<6;P++){var O=2*Math.PI/6*P;A.push(Math.cos(O)),I.push(Math.sin(O))}for(var L=[],N=0;N<=E;N++)for(var R=0;R<=S;R++){var D,M,F,z=N%2==1;0===R&&z||0===R&&w||(D=N*v+a-T,M=R*x+s+C,z&&(M-=_/2),!0===i?AK([D,M],f/2,p/2,r,A,I).forEach(function(e){(!o||TK(o,e))&&L.push(e)}):(F=wK([D,M],f/2,p/2,r,A,I),o&&!TK(o,F)||L.push(F)))}return JN(L)}function wK(e,t,n,r,i,o){for(var a=[],s=0;s<6;s++){var u=e[0]+t*i[s],l=e[1]+n*o[s];a.push([u,l])}return a.push(a[0].slice()),jN([a],r)}function AK(e,t,n,r,i,o){for(var a=[],s=0;s<6;s++){var u=[];u.push(e),u.push([e[0]+t*i[s],e[1]+n*o[s]]),u.push([e[0]+t*i[(s+1)%6],e[1]+n*o[(s+1)%6]]),u.push(e),a.push(jN([u],r))}return a}function IK(e){if(e.features.length<=1)return e;var t,n,r,o=(t=e,n=tD(),r=[],wR(t,function(e,t){var n=RR(e);r.push({minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],geojson:e,index:t})}),n.load(r),n),a=[],s={};return wR(e,function(e,t){if(s[t])return 1;for(o.remove({index:t},PK),s[t]=!0;;){var n,r=RR(e),i=o.search({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]});if(0<i.length&&((n=i.map(function(e){return s[e.index]=!0,o.remove({index:e.index},PK),e.geojson})).push(e),e=EK.apply(this,n)),0===i.length)break}a.push(e)}),JN(a)}function PK(e,t){return e.index===t.index}function OK(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.properties,i=n.mask,o=[];if(null==t)throw new Error("cellSide is required");if(!fR(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(GR(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=e[0],s=e[1],u=e[2],l=e[3],c=t/ZD([a,s],[u,s],n)*(u-a),h=t/ZD([a,s],[a,l],n)*(l-s),f=u-a,p=l-s,d=Math.floor(f/c),m=Math.floor(p/h),_=(p-m*h)/2,g=a+(f-d*c)/2,y=0;y<d;y++){for(var v=s+_,x=0;x<m;x++){var b=jN([[[g,v],[g,v+h],[g+c,v+h],[g+c,v],[g,v]]],r);(!i||TK(i,b))&&o.push(b),v+=h}g+=c}return JN(o)}function LK(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.properties,i=n.mask,o=[];if(null==t)throw new Error("cellSide is required");if(!fR(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(GR(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=t/ZD([e[0],e[1]],[e[2],e[1]],n)*(e[2]-e[0]),s=t/ZD([e[0],e[1]],[e[0],e[3]],n)*(e[3]-e[1]),u=0,l=e[0];l<=e[2];){for(var c=0,h=e[1];h<=e[3];){var f=null,p=null;u%2==0&&c%2==0?(f=jN([[[l,h],[l,h+s],[l+a,h],[l,h]]],r),p=jN([[[l,h+s],[l+a,h+s],[l+a,h],[l,h+s]]],r)):u%2==0&&c%2==1?(f=jN([[[l,h],[l+a,h+s],[l+a,h],[l,h]]],r),p=jN([[[l,h],[l,h+s],[l+a,h+s],[l,h]]],r)):c%2==0&&u%2==1?(f=jN([[[l,h],[l,h+s],[l+a,h+s],[l,h]]],r),p=jN([[[l,h],[l+a,h+s],[l+a,h],[l,h]]],r)):c%2==1&&u%2==1&&(f=jN([[[l,h],[l,h+s],[l+a,h],[l,h]]],r),p=jN([[[l,h+s],[l+a,h+s],[l+a,h],[l,h+s]]],r)),i?(TK(i,f)&&o.push(f),TK(i,p)&&o.push(p)):(o.push(f),o.push(p)),h+=s,c++}u++,l+=a}return JN(o)}var NK={projection:jF,random:$V,clusters:sk,helpers:_R,invariant:qR,meta:NR,isolines:function(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(UR(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks must be an Array");if(!pR(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var a,s,u,l,c,h,f,p,d,m,_,g=ZR(e,{zProperty:r,flip:!0}),y=function(e,t,n,r,i){for(var o=[],a=1;a<t.length;a++){var s=+t[a],u=Object.assign({},r,i[a]);u[n]=s;var l=$N(YR(e,s),u);o.push(l)}return o}(g,t,r,i,o);function v(e){e[0]=e[0]*m+h,e[1]=e[1]*_+f}return JN((a=y,s=g,u=RR(e),l=u[2]-u[0],c=u[3]-u[1],h=u[0],f=u[1],p=s[0].length-1,d=s.length-1,m=l/p,_=c/d,a.forEach(function(e){gR(e,v)}),a))},convex:qD,pointsWithinPolygon:YD,concave:function(e,s){if(!pR(s=s||{}))throw new Error("options is invalid");if(!e)throw new Error("points is required");var u=s.maxEdge||1/0;if(!fR(u))throw new Error("maxEdge is invalid");var n,r,t=XD((n=[],r={},bR(e,function(e){var t;e.geometry&&(t=e.geometry.coordinates.join("-"),r.hasOwnProperty(t)||(n.push(e),r[t]=!0))}),JN(n)));if(t.features=t.features.filter(function(e){var t=e.geometry.coordinates[0][0],n=e.geometry.coordinates[0][1],r=e.geometry.coordinates[0][2],i=ZD(t,n,s),o=ZD(n,r,s),a=ZD(t,r,s);return i<=u&&o<=u&&a<=u}),t.features.length<1)return null;var i=CM(t,s);return 1===i.coordinates.length&&(i.coordinates=i.coordinates[0],i.type="Polygon"),HN(i)},collect:function(e,t,n,i){var o=tD(6),r=t.features.map(function(e){return{minX:e.geometry.coordinates[0],minY:e.geometry.coordinates[1],maxX:e.geometry.coordinates[0],maxY:e.geometry.coordinates[1],property:e.properties[n]}});return o.load(r),e.features.forEach(function(t){t.properties||(t.properties={});var e=RR(t),n=o.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}),r=[];n.forEach(function(e){HD([e.minX,e.minY],t)&&r.push(e.property)}),t.properties[i]=r}),e},flip:function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.mutate;if(!e)throw new Error("geojson is required");return!1!==n&&void 0!==n||(e=JD(e)),gR(e,function(e){var t=e[0],n=e[1];e[0]=n,e[1]=t}),e},simplify:function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=void 0!==t.tolerance?t.tolerance:1,r=t.highQuality||!1,i=t.mutate||!1;if(!e)throw new Error("geojson is required");if(n&&n<0)throw new Error("invalid tolerance");return!0!==i&&(e=JD(e)),SR(e,function(e){!function(e,t,n){var r=e.type;if("Point"===r||"MultiPoint"===r)return;wM(e,!0);var i=e.coordinates;switch(r){case"LineString":e.coordinates=LM(i,t,n);break;case"MultiLineString":e.coordinates=i.map(function(e){return LM(e,t,n)});break;case"Polygon":e.coordinates=NM(i,t,n);break;case"MultiPolygon":e.coordinates=i.map(function(e){return NM(e,t,n)})}}(e,n,r)}),e},bezierSpline:MM,tag:function(e,n,r,i){return e=JD(e),n=JD(n),bR(e,function(t){t.properties||(t.properties={}),bR(n,function(e){void 0===t.properties[i]&&HD(t,e)&&(t.properties[i]=e.properties[r])})}),e},sample:function(e,t){if(!e)throw new Error("featurecollection is required");if(null==t)throw new Error("num is required");if("number"!=typeof t)throw new Error("num must be a number");return JN(function(e,t){var n,r,i=e.slice(0),o=e.length,a=o-t;for(;o-- >a;)r=Math.floor((o+1)*Math.random()),n=i[r],i[r]=i[o],i[o]=n;return i.slice(a)}(e.features,t))},envelope:zM,square:BM,circle:VM,midpoint:function(e,t){return UM(e,ZD(e,t)/2,kM(e,t))},center:GM,centerOfMass:function e(t,n){switch(GR(t)){case"Point":return t;case"Polygon":var r=[];gR(t,function(e){r.push(e)});for(var i,o,a,s,u,l,c,h=qM(t,n),f=h.geometry.coordinates,p=0,d=0,m=0,_=r.map(function(e){return[e[0]-f[0],e[1]-f[1]]}),g=0;g<r.length-1;g++)a=(i=_[g])[0],u=i[1],s=(o=_[g+1])[0],m+=c=a*(l=o[1])-s*u,p+=(a+s)*c,d+=(u+l)*c;if(0===m)return h;var y=1/(.5*m*6);return YN([f[0]+y*p,f[1]+y*d],n);default:var v=qD(t);return v?e(v,n):qM(t,n)}},centroid:qM,combine:function(e){var r={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},t=Object.keys(r).reduce(function(e,t){return e[t.replace("Multi","")]=t,e},{});function n(e,t,n){n?r[t].coordinates=r[t].coordinates.concat(e.geometry.coordinates):r[t].coordinates.push(e.geometry.coordinates),r[t].properties.push(e.properties)}return bR(e,function(e){e.geometry&&(r[e.geometry.type]?n(e,e.geometry.type,!0):t[e.geometry.type]&&n(e,t[e.geometry.type],!1))}),JN(Object.keys(r).filter(function(e){return r[e].coordinates.length}).sort().map(function(e){return HN({type:e,coordinates:r[e].coordinates},{collectedProperties:r[e].properties})}))},distance:ZD,explode:HM,bbox:RR,tesselate:function(e){if(!e.geometry||"Polygon"!==e.geometry.type&&"MultiPolygon"!==e.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var t={type:"FeatureCollection",features:[]};return"Polygon"===e.geometry.type?t.features=mF(e.geometry.coordinates):e.geometry.coordinates.forEach(function(e){t.features=t.features.concat(mF(e))}),t},bboxPolygon:FM,booleanPointInPolygon:HD,nearestPoint:_F,nearestPointOnLine:UF,nearestPointToLine:function(e,n,t){if(!pR(t=t||{}))throw new Error("options is invalid");var r=t.units,i=t.properties||{};if(!e)throw new Error("points is required");if(!(e=function(e){var t=[];switch(e.geometry?e.geometry.type:e.type){case"GeometryCollection":return SR(e,function(e){"Point"===e.type&&t.push({type:"Feature",properties:{},geometry:e})}),{type:"FeatureCollection",features:t};case"FeatureCollection":return e.features=e.features.filter(function(e){return"Point"===e.geometry.type}),e;default:throw new Error("points must be a Point Collection")}}(e)).features.length)throw new Error("points must contain features");if(!n)throw new Error("line is required");if("LineString"!==GR(n))throw new Error("line must be a LineString");var o=1/0,a=null;return bR(e,function(e){var t=KF(e,n,{units:r});t<o&&(o=t,a=e)}),a&&(a.properties=Object.assign({dist:o},a.properties,i)),a},planepoint:function(e,t){var n=DR(e),r=VR(t).coordinates[0];if(r.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var i=t.properties||{},o=i.a,a=i.b,s=i.c,u=n[0],l=n[1],c=r[0][0],h=r[0][1],f=void 0!==o?o:r[0][2],p=r[1][0],d=r[1][1],m=void 0!==a?a:r[1][2],_=r[2][0],g=r[2][1],y=void 0!==s?s:r[2][2];return(y*(u-c)*(l-d)+f*(u-p)*(l-g)+m*(u-_)*(l-h)-m*(u-c)*(l-g)-y*(u-p)*(l-h)-f*(u-_)*(l-d))/((u-c)*(l-d)+(u-p)*(l-g)+(u-_)*(l-h)-(u-c)*(l-g)-(u-p)*(l-h)-(u-_)*(l-d))},tin:XD,bearing:kM,destination:UM,kinks:function(e){var t,o={type:"FeatureCollection",features:[]},n="Feature"===e.type?e.geometry:e;if("LineString"===n.type)t=[n.coordinates];else if("MultiLineString"===n.type)t=n.coordinates;else if("MultiPolygon"===n.type)t=[].concat.apply([],n.coordinates);else{if("Polygon"!==n.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");t=n.coordinates}return t.forEach(function(i){t.forEach(function(e){for(var t=0;t<i.length-1;t++)for(var n=t;n<e.length-1;n++){if(i===e){if(1===Math.abs(t-n))continue;if(0===t&&n===i.length-2&&i[t][0]===i[i.length-1][0]&&i[t][1]===i[i.length-1][1])continue}var r=ZF(i[t][0],i[t][1],i[t+1][0],i[t+1][1],e[n][0],e[n][1],e[n+1][0],e[n+1][1]);r&&o.features.push(YN([r[0],r[1]]))}})}),o},pointOnFeature:JF,area:ez,along:function(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r;if("Feature"===e.type)r=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");r=e.coordinates}if(!fR(t))throw new Error("distance must be a number");for(var i=0,o=0;o<r.length&&!(i<=t&&o===r.length-1);o++){if(t<=i){var a=t-i;if(a){var s=kM(r[o],r[o-1])-180;return UM(r[o],a,s,n)}return YN(r[o])}i+=ZD(r[o],r[o+1],n)}return YN(r[r.length-1])},length:oz,lineSlice:function(e,t,n){var r=MR(n);if("LineString"!==GR(n))throw new Error("line must be a LineString");for(var i=UF(n,e),o=UF(n,t),a=i.properties.index<=o.properties.index?[i,o]:[o,i],s=[a[0].geometry.coordinates],u=a[0].properties.index+1;u<a[1].properties.index+1;u++)s.push(r[u]);return s.push(a[1].geometry.coordinates),QN(s,n.properties)},lineSliceAlong:az,pointGrid:fz,truncate:pz,flatten:function(e){if(!e)throw new Error("geojson is required");var t=[];return wR(e,function(e){t.push(e)}),JN(t)},lineIntersect:zF,lineChunk:function(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.units,i=n.reverse;if(!e)throw new Error("geojson is required");if(t<=0)throw new Error("segmentLength must be greater than 0");var o=[];return wR(e,function(e){i&&(e.geometry.coordinates=e.geometry.coordinates.reverse()),function(e,t,n,r){var i=oz(e,{units:n});if(i<=t)return r(e);var o=i/t;Number.isInteger(o)||(o=Math.floor(o)+1);for(var a=0;a<o;a++){var s=az(e,t*a,t*(a+1),{units:n});r(s,a)}}(e,t,r,function(e){o.push(e)})}),JN(o)},unkinkPolygon:function(e){var n=[];return wR(e,function(t){"Polygon"===t.geometry.type&&bR(_z(t),function(e){n.push(jN(e.geometry.coordinates,t.properties))})}),JN(n)},greatCircle:function(e,t,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.properties,i=n.npoints,o=n.offset;return e=DR(e),t=DR(t),r=r||{},i=i||100,o=o||10,new Az({x:e[0],y:e[1]},{x:t[0],y:t[1]},r).Arc(i,{offset:o}).json()},lineSegment:FF,lineSplit:function(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var n=GR(e),r=GR(t);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var i=pz(t,{precision:7});switch(r){case"Point":return Pz(e,i);case"MultiPoint":return Iz(e,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return Iz(e,zF(e,i))}},lineArc:Nz,polygonToLine:Dz,lineToPolygon:Fz,bboxClip:function(e,t){var n,r=(n=e).geometry?n.geometry.type:n.type,i=MR(e),o=e.properties;switch(r){case"LineString":case"MultiLineString":var a=[];return"LineString"===r&&(i=[i]),i.forEach(function(e){Uz(e,t,a)}),1===a.length?QN(a[0],o):$N(a,o);case"Polygon":return jN(qz(i,t),o);case"MultiPolygon":return tR(i.map(function(e){return qz(e,t)}),o);default:throw new Error("geometry "+r+" not supported")}},lineOverlap:Kz,sector:function(e,t,n,r,i){if(!pR(i=i||{}))throw new Error("options is invalid");if(!e)throw new Error("center is required");if(null==n)throw new Error("bearing1 is required");if(null==r)throw new Error("bearing2 is required");if(!t)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if(Zz(n)===Zz(r))return VM(e,t,i);var o=MR(e),a=Nz(e,t,n,r,i),s=[[o]];return gR(a,function(e){s[0].push(e)}),s[0].push(o),jN(s)},rhumbBearing:VF,rhumbDistance:GF,rhumbDestination:Jz,polygonTangents:function(e,t){var n,r=MR(e),i=MR(t);switch(GR(t)){case"Polygon":a=i[0][0],s=i[0][0],n=eB(i[0][0],i[0][i[0].length-1],r);var o=$z(i[0],r,n,void 0,a,s),a=o[0],s=o[1];break;case"MultiPolygon":a=i[0][0][0],s=i[0][0][0],n=eB(i[0][0][0],i[0][0][i[0][0].length-1],r),i.forEach(function(e){var t=$z(e[0],r,n,void 0,a,s);a=t[0],s=t[1]})}return JN([YN(a),YN(s)])},rewind:function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.reverse||!1,r=t.mutate||!1;if(!e)throw new Error("<geojson> is required");if("boolean"!=typeof n)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof r)throw new Error("<mutate> must be a boolean");!1===r&&(e=JD(e));var i=[];switch(e.type){case"GeometryCollection":return SR(e,function(e){nB(e,n)}),e;case"FeatureCollection":return bR(e,function(e){bR(nB(e,n),function(e){i.push(e)})}),JN(i)}return nB(e,n)},isobands:function(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(UR(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks is not an Array");if(!pR(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var a,s,u,l,c,h,f,p,d,m,_,g=oB(e,{zProperty:r,flip:!0}),y=function(e,t,n){for(var r=[],i=1;i<t.length;i++){var o=+t[i-1],a=+t[i],s=aU(oU(uB(e,o,a-o))),u={};u.groupedRings=s,u[n]=o+"-"+a,r.push(u)}return r}(g,t,r);function v(e){e[0]=e[0]*m+h,e[1]=e[1]*_+f}return a=y,s=g,u=RR(e),l=u[2]-u[0],c=u[3]-u[1],h=u[0],f=u[1],p=s[0].length-1,d=s.length-1,m=l/p,_=c/d,a.forEach(function(e){e.groupedRings.forEach(function(e){e.forEach(function(e){e.forEach(v)})})}),JN((y=a).map(function(e,t){if(o[t]&&!pR(o[t]))throw new Error("Each mappedProperty is required to be an Object");var n=Object.assign({},i,o[t]);return n[r]=e[r],tR(e.groupedRings,n)}))},transformRotate:lU,transformScale:cU,transformTranslate:function(e,n,r,t){if(!pR(t=t||{}))throw new Error("options is invalid");var i=t.units,o=t.zTranslation,a=t.mutate;if(!e)throw new Error("geojson is required");if(null==n||isNaN(n))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===n&&0===o)return e;if(null==r||isNaN(r))throw new Error("direction is required");return n<0&&(n=-n,r=-r),!1!==a&&void 0!==a||(e=JD(e)),gR(e,function(e){var t=MR(Jz(e,n,r,{units:i}));e[0]=t[0],e[1]=t[1],o&&3===e.length&&(e[2]+=o)}),e},lineOffset:function(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!e)throw new Error("geojson is required");if(null==t||isNaN(t))throw new Error("distance is required");var i=GR(e),o=e.properties;switch(i){case"LineString":return mU(e,t,r);case"MultiLineString":var a=[];return wR(e,function(e){a.push(mU(e,t,r).geometry.coordinates)}),$N(a,o);default:throw new Error("geometry "+i+" is not supported")}},polygonize:function(e){var t=EU.fromGeoJson(e);t.deleteDangles(),t.deleteCutEdges();var n=[],r=[];return t.getEdgeRings().filter(function(e){return e.isValid()}).forEach(function(e){e.isHole()?n.push(e):r.push(e)}),n.forEach(function(e){xU.findEdgeRingContaining(e,r)&&r.push(e)}),JN(r.map(function(e){return e.toPolygon()}))},booleanDisjoint:function(e,n){var r;return wR(e,function(t){wR(n,function(e){!1!==r&&(r=function(e,t){switch(e.type){case"Point":switch(t.type){case"Point":return!function(e,t){return e[0]===t[0]&&e[1]===t[1]}(e.coordinates,t.coordinates);case"LineString":return!TU(t,e);case"Polygon":return!HD(e,t)}break;case"LineString":switch(t.type){case"Point":return!TU(e,t);case"LineString":return!function(e,t){if(0<zF(e,t).features.length)return 1;return}(e,t);case"Polygon":return!SU(t,e)}break;case"Polygon":switch(t.type){case"Point":return!HD(t,e);case"LineString":return!SU(e,t);case"Polygon":return!function(e,t){for(var n=0;n<e.coordinates[0].length;n++)if(HD(e.coordinates[0][n],t))return 1;for(var r=0;r<t.coordinates[0].length;r++)if(HD(t.coordinates[0][r],e))return 1;return}(t,e)}}}(t.geometry,e.geometry))})}),r},booleanContains:function(e,t){var n=GR(e),r=GR(t),i=VR(e),o=VR(t),a=MR(e),s=MR(t);switch(n){case"Point":switch(r){case"Point":return AU(a,s);default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"Point":return function(e,t){var n,r=!1;for(n=0;n<e.coordinates.length;n++)if(AU(e.coordinates[n],t.coordinates)){r=!0;break}return r}(i,o);case"MultiPoint":return function(e,t){for(var n=0;n<t.coordinates.length;n++){for(var r=!1,i=0;i<e.coordinates.length;i++)if(AU(t.coordinates[n],e.coordinates[i])){r=!0;break}if(!r)return!1}return!0}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"Point":return sz(o,i,{ignoreEndVertices:!0});case"LineString":return function(e,t){for(var n=!1,r=0;r<t.coordinates.length;r++)if(sz({type:"Point",coordinates:t.coordinates[r]},e,{ignoreEndVertices:!0})&&(n=!0),!sz({type:"Point",coordinates:t.coordinates[r]},e,{ignoreEndVertices:!1}))return!1;return n}(i,o);case"MultiPoint":return function(e,t){for(var n=!1,r=0;r<t.coordinates.length;r++)if(sz(t.coordinates[r],e,{ignoreEndVertices:!0})&&(n=!0),!sz(t.coordinates[r],e))return!1;if(n)return!0;return!1}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Point":return HD(o,i,{ignoreBoundary:!0});case"LineString":return function(e,t){var n=!1,r=0,i=RR(e),o=RR(t);if(!wU(i,o))return!1;for(;r<t.coordinates.length-1;r++){if(HD({type:"Point",coordinates:(a=t.coordinates[r],s=t.coordinates[r+1],[(a[0]+s[0])/2,(a[1]+s[1])/2])},e,{ignoreBoundary:!0})){n=!0;break}}var a,s;return n}(i,o);case"Polygon":return function(e,t){var n=RR(e),r=RR(t);if(!wU(n,r))return!1;for(var i=0;i<t.coordinates[0].length;i++)if(!HD(t.coordinates[0][i],e))return!1;return!0}(i,o);case"MultiPoint":return function(e,t){for(var n=0;n<t.coordinates.length;n++)if(!HD(t.coordinates[n],e,{ignoreBoundary:!0}))return!1;return!0}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}},booleanCrosses:function(e,t){var n=GR(e),r=GR(t),i=VR(e),o=VR(t);switch(n){case"MultiPoint":switch(r){case"LineString":return IU(i,o);case"Polygon":return OU(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"MultiPoint":return IU(o,i);case"LineString":return function(e,t){if(0<zF(e,t).features.length)for(var n=0;n<e.coordinates.length-1;n++)for(var r=0;r<t.coordinates.length-1;r++){var i=!0;if(0!==r&&r!==t.coordinates.length-2||(i=!1),LU(e.coordinates[n],e.coordinates[n+1],t.coordinates[r],i))return!0}return!1}(i,o);case"Polygon":return PU(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"MultiPoint":return OU(o,i);case"LineString":return PU(o,i);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}},booleanClockwise:tB,booleanOverlap:VU,booleanPointOnLine:sz,booleanEqual:function(e,t){if(!e)throw new Error("feature1 is required");if(!t)throw new Error("feature2 is required");return GR(e)===GR(t)&&new UU({precision:6}).compare(wM(e),wM(t))},booleanWithin:lz,clone:JD,cleanCoords:wM,clustersDbscan:function(n,e,t){if("object"!=typeof(t=t||{}))throw new Error("options is invalid");var r=t.minPoints,i=t.units;if(UR(n,"Point","Input must contain Points"),null==e)throw new Error("maxDistance is required");if(!(0<Math.sign(e)))throw new Error("Invalid maxDistance");if(!(null==r||0<Math.sign(r)))throw new Error("Invalid minPoints");n=JD(n),r=r||3;var o=new WU.DBSCAN,a=o.run(TR(n),cR(e,i),r,ZD),s=-1;return a.forEach(function(e){s++,e.forEach(function(e){var t=n.features[e];t.properties||(t.properties={}),t.properties.cluster=s,t.properties.dbscan="core"})}),o.noise.forEach(function(e){var t=n.features[e];t.properties||(t.properties={}),t.properties.cluster?t.properties.dbscan="edge":t.properties.dbscan="noise"}),n},clustersKmeans:function(e,t){if("object"!=typeof(t=t||{}))throw new Error("options is invalid");var n=t.numberOfClusters,r=t.mutate;UR(e,"Point","Input must contain Points");var i=e.features.length;i<(n=n||Math.round(Math.sqrt(i/2)))&&(n=i),!1!==r&&void 0!==r||(e=JD(e));var o=TR(e),a=o.slice(0,n),s=$U(o,n,a),u={};return s.centroids.forEach(function(e,t){u[t]=e}),bR(e,function(e,t){var n=s.idxs[t];e.properties.cluster=n,e.properties.centroid=u[n]}),e},pointToLineDistance:KF,booleanParallel:function(e,t){if(!e)throw new Error("line1 is required");if(!t)throw new Error("line2 is required");if("LineString"!==eV(e,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==eV(t,"line2"))throw new Error("line2 must be a LineString");for(var n,r,i,o,a=FF(wM(e)).features,s=FF(wM(t)).features,u=0;u<a.length;u++){var l=a[u].geometry.coordinates;if(!s[u])break;var c=s[u].geometry.coordinates;if(r=c,0,i=sR(VF((n=l)[0],n[1])),o=sR(VF(r[0],r[1])),i!==o)return!1}return!0},shortestPath:function(e,t,n){if(!pR(n=n||{}))throw new Error("options is invalid");var r=n.resolution,i=n.minDistance,o=n.obstacles||JN([]);if(!e)throw new Error("start is required");if(!t)throw new Error("end is required");if(r&&!fR(r)||r<=0)throw new Error("options.resolution must be a number, greater than 0");if(i)throw new Error("options.minDistance is not yet implemented");var a=DR(e),s=DR(t);switch(e=YN(a),t=YN(s),GR(o)){case"FeatureCollection":if(0===o.features.length)return QN([a,s]);break;case"Polygon":o=JN([HN(VR(o))]);break;default:throw new Error("invalid obstacles")}var u=o;u.features.push(e),u.features.push(t);var l=RR(cU(FM(RR(u)),1.15));r=r||ZD([l[0],l[1]],[l[2],l[1]],n)/100,u.features.pop(),u.features.pop();for(var c=l[0],h=l[1],f=l[2],p=l[3],d=r/ZD([c,h],[f,h],n)*(f-c),m=r/ZD([c,h],[c,p],n)*(p-h),_=f-c,g=p-h,y=Math.floor(_/d),v=Math.floor(g/m),x=(_-y*d)/2,b=[],E=[],T=[],S=[],C=1/0,w=1/0,A=p-(g-v*m)/2,I=0;h<=A;){for(var P=[],O=[],L=c+x,N=0;L<=f;){var R=YN([L,A]),D=aV(R,o);P.push(D?0:1),O.push(L+"|"+A);var M=ZD(R,e);!D&&M<C&&(C=M,T={x:N,y:I});var F=ZD(R,t);!D&&F<w&&(w=F,S={x:N,y:I}),L+=d,N++}E.push(P),b.push(O),A-=m,I++}var z=new rV(E,{diagonal:!0}),B=z.grid[T.y][T.x],U=z.grid[S.y][S.x],V=nV.search(z,B,U),k=[a];return V.forEach(function(e){var t=b[e.x][e.y].split("|");k.push([+t[0],+t[1]])}),k.push(s),wM(QN(k))},voronoi:function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var i,o,n,r=t.bbox||[-180,-85,180,85];if(!e)throw new Error("points is required");if(!Array.isArray(r))throw new Error("bbox is invalid");return UR(e,"Point","points"),JN((i=uV,o=lV,n=null,a.polygons=function(e){return a(e).polygons()},a.links=function(e){return a(e).links()},a.triangles=function(e){return a(e).triangles()},a.x=function(e){return arguments.length?(i="function"==typeof e?e:sV(+e),a):i},a.y=function(e){return arguments.length?(o="function"==typeof e?e:sV(+e),a):o},a.extent=function(e){return arguments.length?(n=null==e?null:[[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]],a):n&&[[n[0][0],n[0][1]],[n[1][0],n[1][1]]]},a.size=function(e){return arguments.length?(n=null==e?null:[[0,0],[+e[0],+e[1]]],a):n&&[n[1][0]-n[0][0],n[1][1]-n[0][1]]},a.x(function(e){return e.geometry.coordinates[0]}).y(function(e){return e.geometry.coordinates[1]}).extent([[r[0],r[1]],[r[2],r[3]]]).polygons(e.features).map(GV)));function a(r){return new kV(r.map(function(e,t){var n=[Math.round(i(e,t,r)/BV)*BV,Math.round(o(e,t,r)/BV)*BV];return n.index=t,n.data=e,n}),n)}},ellipse:qV,centerMean:WV,centerMedian:function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.counter||10;if(!fR(n))throw new Error("counter must be a number");var r=t.weight,i=WV(e,{weight:t.weight}),o=JN([]);return bR(e,function(e){o.features.push(qM(e,{weight:e.properties[r]}))}),o.properties={tolerance:t.tolerance,medianCandidates:[]},function e(o,t,n,r){var i=n.properties.tolerance||.001;var a=0;var s=0;var u=0;var l=0;bR(n,function(e){var t,n,r=e.properties.weight,i=null==r?1:r;if(!fR(i=Number(i)))throw new Error("weight value must be a number");0<i&&(l+=1,0===(t=i*ZD(e,o))&&(t=1),n=i/t,a+=e.geometry.coordinates[0]*n,s+=e.geometry.coordinates[1]*n,u+=n)});if(l<1)throw new Error("no features to measure");var c=a/u;var h=s/u;return 1===l||0===r||Math.abs(c-t[0])<i&&Math.abs(h-t[1])<i?YN([c,h],{medianCandidates:n.properties.medianCandidates}):(n.properties.medianCandidates.push([c,h]),e([c,h],o,n,r-1))}(i.geometry.coordinates,[0,0],o,n)},standardDeviationalEllipse:function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var n=t.steps||64,r=t.weight,i=t.properties||{};if(!fR(n))throw new Error("steps must be a number");if(!pR(i))throw new Error("properties must be a number");var o=TR(e).length,a=WV(e,{weight:r}),s=0,u=0,l=0;bR(e,function(e){var t=e.properties[r]||1,n=YV(MR(e),MR(a));s+=Math.pow(n.x,2)*t,u+=Math.pow(n.y,2)*t,l+=n.x*n.y*t});var c=s-u,h=Math.sqrt(Math.pow(c,2)+4*Math.pow(l,2)),f=2*l,p=Math.atan((c+h)/f),d=180*p/Math.PI,m=0,_=0,g=0;bR(e,function(e){var t=e.properties[r]||1,n=YV(MR(e),MR(a));m+=Math.pow(n.x*Math.cos(p)-n.y*Math.sin(p),2)*t,_+=Math.pow(n.x*Math.sin(p)+n.y*Math.cos(p),2)*t,g+=t});var y=Math.sqrt(2*m/g),v=Math.sqrt(2*_/g),x=qV(a,y,v,{units:"degrees",angle:d,steps:n,properties:i}),b=YD(e,JN([x])),E={meanCenterCoordinates:MR(a),semiMajorAxis:y,semiMinorAxis:v,numberOfFeatures:o,angle:d,percentageWithinEllipse:100*TR(b).length/o};return x.properties.standardDeviationalEllipse=E,x},difference:function(e,t){var n=VR(e),r=VR(t),i=e.properties||{},n=KX(n),r=KX(r);if(!n)return null;if(!r)return HN(n,i);var o=new tH,a=o.read(n),s=o.read(r),u=BX.difference(a,s);return u.isEmpty()?null:HN((new nH).write(u),i)},buffer:function(e,n,t){var r=(t=t||{}).units,i=t.steps||64;if(!e)throw new Error("geojson is required");if("object"!=typeof t)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===n)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");i=i||64,r=r||"kilometers";var o=[];switch(e.type){case"GeometryCollection":return SR(e,function(e){var t=xK(e,n,r);t&&o.push(t)}),JN(o);case"FeatureCollection":return bR(e,function(e){var t=xK(e,n,r);t&&bR(t,function(e){e&&o.push(e)})}),JN(o)}return xK(e,n,r)},union:EK,intersect:TK,dissolve:function(e,t){if(!pR(t=t||{}))throw new Error("options is invalid");var s=t.propertyName;UR(e,"Polygon","dissolve");var n=JD(e),u=n.features,l=[];u.forEach(function(e,t){e.properties.origIndexPosition=t});var c=RF();for(var h in c.load(n),u){var f=u[h],p=!1;if(c.search(f).features.forEach(function(e){f=u[h];var t,n,r,i,o,a=e.properties.origIndexPosition;0<l.length&&0!==a&&(a>l[l.length-1]?a-=l.length:0!==(t=SK(a,l))&&(a-=t)),a===+h||(n=u[a])&&f&&(void 0!==s&&n.properties[s]!==f.properties[s]||VU(f,n)&&(r=n,i=QN(TR(f)),o=QN(TR(r)),0<zF(i,o).features.length)&&(u[h]=EK(f,n),l.push(e.properties.origIndexPosition),l.sort(function(e,t){return e-t}),c.remove(e),u.splice(a,1),f.properties.origIndexPosition=h,c.remove(f,function(e,t){return e.properties.origIndexPosition===t.properties.origIndexPosition}),p=!0))}),p){if(!f)continue;f.properties.origIndexPosition=h,c.insert(f),h--}}return u.forEach(function(e){delete e.properties.origIndexPosition,delete e.bbox}),n},hexGrid:CK,mask:function(e,t){var n,i,o,r,a,s,u=jN((n=t)&&n.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),l=(i=[],o=[],wR(e,function(e){var t=e.geometry.coordinates,n=t[0],r=t.slice(1);i.push(jN([n])),r.forEach(function(e){o.push(jN([e]))})}),[JN(i),JN(o)]),c=l[1],h=IK(h=l[0]),c=IK(c);return r=h,a=c,(s=[]).push(u.geometry.coordinates[0]),wR(r,function(e){s.push(e.geometry.coordinates[0])}),wR(a,function(e){s.push(e.geometry.coordinates[0])}),jN(s)},squareGrid:OK,triangleGrid:LK,interpolate:function(t,e,s){if("object"!=typeof(s=s||{}))throw new Error("options is invalid");var u=s.gridType,l=s.property,c=s.weight;if(!t)throw new Error("points is required");if(UR(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(void 0!==c&&"number"!=typeof c)throw new Error("weight must be a number");l=l||"elevation",u=u||"square",c=c||1;var n,r=RR(t);switch(u){case"point":case"points":n=fz(r,e,s);break;case"square":case"squares":n=OK(r,e,s);break;case"hex":case"hexes":n=CK(r,e,s);break;case"triangle":case"triangles":n=LK(r,e,s);break;default:throw new Error("invalid gridType")}var h=[];return bR(n,function(i){var o=0,a=0;bR(t,function(e){var t,n=ZD("point"===u?i:qM(i),e,s);if(void 0!==l&&(t=e.properties[l]),void 0===t&&(t=e.geometry.coordinates[2]),void 0===t)throw new Error("zValue is missing");0===n&&(o=t);var r=1/Math.pow(n,c);a+=r,o+=r*t});var e=JD(i);e.properties[l]=o/a,h.push(e)}),JN(h)},pointOnSurface:JF,polygonToLineString:Dz,lineStringToPolygon:Fz,inside:HD,within:YD,bezier:MM,nearest:_F,pointOnLine:UF,lineDistance:oz,radians2degrees:uR,degrees2radians:lR,distanceToDegrees:aR,distanceToRadians:oR,radiansToDistance:iR,bearingToAngle:sR,convertDistance:cR,toMercator:qF,toWgs84:HF,randomPosition:XV,randomPoint:jV,randomPolygon:KV,randomLineString:QV,getCluster:ek,clusterEach:tk,clusterReduce:nk,createBins:rk,applyFilter:ik,propertiesContainsFilter:ok,filterProperties:ak,earthRadius:VN,factors:kN,unitsFactors:GN,areaFactors:qN,feature:HN,geometry:WN,point:YN,points:XN,polygon:jN,polygons:KN,lineString:QN,lineStrings:ZN,featureCollection:JN,multiLineString:$N,multiPoint:eR,multiPolygon:tR,geometryCollection:nR,round:rR,radiansToLength:iR,lengthToRadians:oR,lengthToDegrees:aR,bearingToAzimuth:sR,radiansToDegrees:uR,degreesToRadians:lR,convertLength:cR,convertArea:hR,isNumber:fR,isObject:pR,validateBBox:dR,validateId:mR,getCoord:DR,getCoords:MR,containsNumber:FR,geojsonType:zR,featureOf:BR,collectionOf:UR,getGeom:VR,getGeomType:kR,getType:GR,coordEach:gR,coordReduce:yR,propEach:vR,propReduce:xR,featureEach:bR,featureReduce:ER,coordAll:TR,geomEach:SR,geomReduce:CR,flattenEach:wR,flattenReduce:AR,segmentEach:IR,segmentReduce:PR,lineEach:OR,lineReduce:LR};function RK(e){Nn._maximumCombinedTextureImageUnits=Cesium.ContextLimits._maximumCombinedTextureImageUnits,Nn._maximumCubeMapSize=Cesium.ContextLimits._maximumCubeMapSize,Nn._maximumFragmentUniformVectors=Cesium.ContextLimits._maximumFragmentUniformVectors,Nn._maximumTextureImageUnits=Cesium.ContextLimits._maximumTextureImageUnits,Nn._maximumRenderbufferSize=Cesium.ContextLimits._maximumRenderbufferSize,Nn._maximumTextureSize=Cesium.ContextLimits._maximumTextureSize,Nn._maximumVertexAttributes=Cesium.ContextLimits._maximumVertexAttributes,Nn._maximumVertexTextureImageUnits=Cesium.ContextLimits._maximumVertexTextureImageUnits,Nn._maximumVertexUniformVectors=Cesium.ContextLimits._maximumVertexUniformVectors,Nn._minimumAliasedLineWidth=Cesium.ContextLimits._minimumAliasedLineWidth,Nn._maximumAliasedLineWidth=Cesium.ContextLimits._maximumAliasedLineWidth,Nn._minimumAliasedPointSize=Cesium.ContextLimits._minimumAliasedPointSize,Nn._maximumAliasedPointSize=Cesium.ContextLimits._maximumAliasedPointSize,Nn._maximumViewportWidth=Cesium.ContextLimits._maximumViewportWidth,Nn._maximumViewportHeight=Cesium.ContextLimits._maximumViewportHeight,Nn._highpFloatSupported=Cesium.ContextLimits._highpFloatSupported,Nn._highpIntSupported=Cesium.ContextLimits._highpIntSupported,Nn._maximumTextureFilterAnisotropy=Cesium.ContextLimits._maximumTextureFilterAnisotropy,Nn._maximumDrawBuffers=Cesium.ContextLimits._maximumDrawBuffers,Nn._maximumColorAttachments=Cesium.ContextLimits._maximumColorAttachments,this._scene=e,this._primitives=e._primitives,this._e3ms=new Od,this.layerAddedEvent=new U,this.layerRemovedEvent=new U,this.layerMovedEvent=new U,this.layerShownOrHiddenEvent=new U,this.selectionChanged=new U,this.featureSelectionChanged=new U,this._selectedFeature=void 0,this._scene.logarithmicDepthBuffer=!0,this._scene.postProcessStages._fxaa.enabled=!0,this._scene._context._gl.getExtension("EXT_shader_texture_lod")}function DK(e,t){return Ze(t)&&Ze(t.name)&&Ze(t.url)?MK(e,t.name):(console.warn("please check layer content. name and url is required!"),!1)}function MK(e,t){var n=e._e3ms.get(t),r=n.getCesiumLayer();return e._scene._primitives.remove(r),e._e3ms.remove(t),n&&e.layerRemovedEvent.raiseEvent(n),n}function FK(e){return e._e3ms}function zK(e,t,n){var r={},i=_t.subtract(t,e,new _t),o=_t.subtract(n,e,new _t),a=_t.normalize(i,new _t),s=_t.normalize(o,new _t),u=_t.dot(a,s);if(u<=0)return r.distance=_t.distance(n,e,new _t),r.point=e,r;var l=_t.subtract(e,t,new _t),c=_t.subtract(n,t,new _t),h=_t.normalize(l,new _t),f=_t.normalize(c,new _t);if(_t.dot(h,f)<=0)return r.distance=_t.distance(n,t),r.point=t,r;var p=Math.sqrt(1-u*u),d=_t.distance(n,e),m=new _t;return _t.multiplyByScalar(a,d*u,m),_t.add(e,m,m),r.distance=d*p,r.point=m,r}function BK(e,t){for(var n=t.planes,r=!1,i=new Zf(new _t(1,0,0),0),o=0,a=n.length;o<a;++o){var s=Zf.fromCartesian4(n[o],i),u=s.normal;if(_t.dot(u,e)+s.distance<=0)return;r=!0}return r}function UK(e,t){for(var n=t.center,r=Un.fromCartesian(n),i=Un.fromCartesian(e[0]).height,o=_t.fromRadians(r.longitude,r.latitude,i),a=0;a<e.length;a++){var s=e[a];if(_t.distance(s,o)<t.radius)return 1}}function VK(e,t){for(var n=[],r=[],i=0;i<e.length;i++){var o=Un.fromCartesian(e[i]),a=NK.radiansToDegrees(o.longitude),s=NK.radiansToDegrees(o.latitude);r.push([a,s])}o=Un.fromCartesian(e[0]),a=NK.radiansToDegrees(o.longitude),s=NK.radiansToDegrees(o.latitude);r.push([a,s]);for(var u=NK.polygon([r]),i=0;i<t.length;i++){for(var l=t[i],c=[],h=0;h<l.length;h+=3){a=NK.radiansToDegrees(l[h]),s=NK.radiansToDegrees(l[h+1]);c.push([a,s])}var f=NK.lineString(c),p=NK.lineIntersect(u,f);0<p.features.length&&n.push({index:i,intersects:p})}return n}Object.defineProperties(RK.prototype,{scene:{get:function(){return this._scene}},selectedFeature:{get:function(){return this._selectedFeature},set:function(e){this._selectedFeature!==e&&(this._selectedFeature=e,this.featureSelectionChanged.raiseEvent(this._selectedFeature))}}}),RK.prototype.add=function(e){var t=function(o,e){var t=e.name;if(!Ze(t))throw new fe("name is required");if(!Ze(e.url))throw new fe("url is required");{if("string"!=typeof t)throw new fe("name is required to be a string");if(Ze(function(e,t){var n=FK(e);return n.contains(t)?n.get(t):null}(o,t)))throw new fe(t+"already exists")}var n=new ON(e);o._primitives.add(n.getCesiumLayer());var r=n.layerShownOrHidden._listeners;0===r.length&&n.layerShownOrHidden.addEventListener(function(e,t,n){var r,i;r=e,i=n,o.layerShownOrHiddenEvent.raiseEvent(r,i)});0===(r=n.selectionChanged._listeners).length&&n.selectionChanged.addEventListener(function(e,t){var n,r;n=e,r=t,o.selectionChanged.raiseEvent(n,r)});return FK(o).set(t,n),o.layerAddedEvent.raiseEvent(n),n}(this,e);return Ze(t.scene)||(t.scene=this._scene),t},RK.prototype.remove=function(e){return(e instanceof ON?DK:MK)(this,e)},RK.prototype.removeAll=function(){var e=FK(this);if(!e)return!1;for(var t=e.values;0<t.length;){if(!DK(this,t[0]))return!1}return!0},RK.prototype.get=function(e){if(!Ze(e))throw new fe("name is required.");var t=FK(this);if(!Ze(t))throw new fe("name is error");if("string"==typeof e){if(t.contains(e))return n=t.get(e),Array.isArray(n._name)?n._cesiumLayer.getLayer(e):n}else if("number"==typeof e){var n=t.values[e];return Array.isArray(n._name)?n._cesiumLayer.getLayer(e):n}return null},RK.prototype.getLayerCount=function(){return this._e3ms.length},RK.prototype.isLayerExits=function(e){var t=FK(this);return!!t&&t.contains(e)},RK.prototype.getLayerCollection=function(){return FK(this)},RK.prototype.getE3mLayer=function(e){return function(e,t){for(var n=FK(e).values,r=0;r<n.length;r++){var i=n[r];if(i.getCesiumLayer()===t)return i}return t}(this,e)},RK.prototype.getNearestTileProperty=function(e){var t=this.scene.camera,n=t.position.clone(),r=t.direction.clone(),i=_t.multiplyByScalar(r,5,new Cesium.Cartesian3);_t.add(n,i,n);for(var o=this._e3ms.values,a=[],s=0;s<o.length;s++){var u=o[s].getCesiumLayer();if(Ze(u.flowLines)&&u.show)for(var l=u.selectedTiles,c=0;c<l.length;c++){var h=l[c],f=h.boundingSphere.center;if(_t.distance(n,f)<h.boundingSphere.radius+e)if(Ze(h.content._contents)){for(var p=h.content._contents,d=0;d<p.length;d++)if(Ze(p[d].flowLines))for(var m=0;m<p[d].flowLines.length;m++){if((x=zK((v=p[d].flowLines[m])[0],v[1],n)).distance<e&&BK(x.point,t.frustum._offCenterFrustum._cullingVolume)){var _={};for(var g in p[d].batchTable._properties)_[g]=p[d].batchTable._properties[g][m];_.result=x,a.push(_)}}}else{var y=h.content;if(Ze(y.flowLines))for(var v,x,m=0;m<y.flowLines.length;m++){if((x=zK((v=y.flowLines[m])[0],v[1],n)).distance<e&&BK(x.point,t.frustum._offCenterFrustum._cullingVolume)){_={};for(var g in y.batchTable._properties)_[g]=y.batchTable._properties[g][m];_.result=x,a.push(_)}}}}}return a},RK.prototype.getNearestTileCentreLine=function(){for(var e=this.scene.camera.position,t=this._e3ms.values,n=[],r=0;r<t.length;r++){var i=t[r].getCesiumLayer();if(Ze(i.flowLines)&&i.show)for(var o=i.selectedTiles,a=0;a<o.length;a++){var s=o[a],u=s.boundingSphere.center;if(_t.distance(e,u)<s.boundingSphere.radius)if(Ze(s.content._contents)){for(var l=s.content._contents,c=0;c<l.length;c++)if(Ze(l[c].centreLine)){n.push(l[c].centreLine);break}}else Ze(s.content.centreLine)&&n.push(s.content.centreLine)}}return n},RK.prototype.queryTile=function(e){for(var t=this._e3ms.values,n=[],r=0;r<t.length;r++){var i=t[r],o=i.getCesiumLayer();if(Ze(o.flowLines)&&o.show)for(var a=o.selectedTiles,s=0;s<a.length;s++){var u=a[s];if(UK(e,u.boundingSphere)){var l={};if(l.dataSet=i.customTag.name,Ze(u.content._contents)){l.content={};for(var c,h=u.content._contents,f=0;f<h.length;f++){if(h[f].centreLine)if(0<(c=VK(e,h[f].centreLine)).length){for(var p=0;p<c.length;p++){var d=c[p].index;for(var m in h[f].batchTable._properties)l.content[m]=h[f].batchTable._properties[m][d]}n.push(l)}}}else{if(!u.content.centreLine)continue;if(0<(c=VK(e,u.content.centreLine)).length){l.content={};for(p=0;p<c.length;p++){d=c[p].index;for(var m in u.content.batchTable._properties)l.content[m]=u.content.batchTable._properties[m][d]}n.push(l)}}}}}return n};var kK=Object.freeze({LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19}),GK="undefined"!=typeof performance&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()},qK=GK,HK=Object.freeze({SHIFT:0,CTRL:1,ALT:2});function WK(e,t,n){var r=e._element;if(r===document)return n.x=t.clientX,n.y=t.clientY,n;var i=r.getBoundingClientRect();return n.x=t.clientX-i.left,n.y=t.clientY-i.top,n}function YK(e,t){var n=e;return Ze(t)&&(n+="+"+t),n}function XK(e){return e.shiftKey?HK.SHIFT:e.ctrlKey?HK.CTRL:e.altKey?HK.ALT:void 0}var jK={LEFT:0,MIDDLE:1,RIGHT:2};function KK(t,e,n,r){function i(e){r(t,e)}et.isInternetExplorer()?n.addEventListener(e,i,!1):n.addEventListener(e,i,{capture:!1,passive:!1}),t._removalFunctions.push(function(){n.removeEventListener(e,i,!1)})}var QK={position:new En};function ZK(e){e._lastSeenTouchEvent=qK()}function JK(e){return qK()-e._lastSeenTouchEvent>CQ.mouseEmulationIgnoreMilliseconds}function $K(e,t,n){var r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)<n}function eQ(e,t){if(JK(e)){var n,r=t.button;if(e._buttonDown[r]=!0,r===jK.LEFT)n=kK.LEFT_DOWN;else if(r===jK.MIDDLE)n=kK.MIDDLE_DOWN;else{if(r!==jK.RIGHT)return;n=kK.RIGHT_DOWN}var i=WK(e,t,e._primaryPosition);En.clone(i,e._primaryStartPosition),En.clone(i,e._primaryPreviousPosition);var o=XK(t),a=e.getInputAction(n,o);Ze(a)&&(En.clone(i,QK.position),a(QK),t.preventDefault())}}var tQ={position:new En},nQ={position:new En};function rQ(e,t,n,r){var i,o=XK(r),a=e.getInputAction(t,o),s=e.getInputAction(n,o);(Ze(a)||Ze(s))&&(i=WK(e,r,e._primaryPosition),Ze(a)&&(En.clone(i,tQ.position),a(tQ)),Ze(s)&&$K(e._primaryStartPosition,i,e._clickPixelTolerance)&&(En.clone(i,nQ.position),s(nQ)))}function iQ(e,t){var n,r;JK(e)&&((n=t.button)!==jK.LEFT&&n!==jK.MIDDLE&&n!==jK.RIGHT||(e._buttonDown[jK.LEFT]&&(rQ(e,kK.LEFT_UP,kK.LEFT_CLICK,t),e._buttonDown[jK.LEFT]=!1),e._buttonDown[jK.MIDDLE]&&((r=document.getElementById("focalPointCanvas"))&&document.body.removeChild(r),rQ(e,kK.MIDDLE_UP,kK.MIDDLE_CLICK,t),e._buttonDown[jK.MIDDLE]=!1),e._buttonDown[jK.RIGHT]&&((r=document.getElementById("focalPointCanvas"))&&document.body.removeChild(r),rQ(e,kK.RIGHT_UP,kK.RIGHT_CLICK,t),e._buttonDown[jK.RIGHT]=!1)))}var oQ={startPosition:new En,endPosition:new En};function aQ(e,t){var n,r,i,o;JK(e)&&(n=XK(t),r=WK(e,t,e._primaryPosition),i=e._primaryPreviousPosition,Ze(o=e.getInputAction(kK.MOUSE_MOVE,n))&&(En.clone(i,oQ.startPosition),En.clone(r,oQ.endPosition),o(oQ)),En.clone(r,i),(e._buttonDown[jK.LEFT]||e._buttonDown[jK.MIDDLE]||e._buttonDown[jK.RIGHT])&&t.preventDefault())}var sQ={position:new En};function uQ(e,t){var n,r,i;t.button===jK.LEFT&&(n=kK.LEFT_DOUBLE_CLICK,r=XK(t),Ze(i=e.getInputAction(n,r))&&(WK(e,t,sQ.position),i(sQ)))}function lQ(e,t){var n,r,i,o;r=Ze(t.deltaY)?(n=t.deltaMode)===t.DOM_DELTA_PIXEL?-t.deltaY:n===t.DOM_DELTA_LINE?40*-t.deltaY:120*-t.deltaY:0<t.detail?-120*t.detail:t.wheelDelta,Ze(r)&&(i=XK(t),Ze(o=e.getInputAction(kK.WHEEL,i))&&(o(r),t.preventDefault()))}function cQ(e,t){ZK(e);for(var n,r,i=t.changedTouches,o=i.length,a=e._positions,s=0;s<o;++s)r=(n=i[s]).identifier,a.set(r,WK(e,n,new En));gQ(e,t);var u=e._previousPositions;for(s=0;s<o;++s)r=(n=i[s]).identifier,u.set(r,En.clone(a.get(r)))}function hQ(e,t){ZK(e);for(var n,r=t.changedTouches,i=r.length,o=e._positions,a=0;a<i;++a)n=r[a].identifier,o.remove(n);gQ(e,t);var s=e._previousPositions;for(a=0;a<i;++a)n=r[a].identifier,s.remove(n)}var fQ={position:new En},pQ={position1:new En,position2:new En},dQ={position:new En},mQ={position:new En},_Q={position:new En};function gQ(e,t){var n,r,i,o=XK(t),a=e._positions,s=a.length,u=e._isPinching;1!==s&&e._buttonDown[jK.LEFT]&&(e._buttonDown[jK.LEFT]=!1,Ze(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),Ze(n=e.getInputAction(kK.LEFT_UP,o))&&(En.clone(e._primaryPosition,dQ.position),n(dQ)),0!==s||e._isTouchHolding||Ze(r=e.getInputAction(kK.LEFT_CLICK,o))&&$K(e._primaryStartPosition,e._previousPositions.values[0],e._clickPixelTolerance)&&(En.clone(e._primaryPosition,mQ.position),r(mQ)),e._isTouchHolding=!1),0===s&&u&&(e._isPinching=!1,Ze(n=e.getInputAction(kK.PINCH_END,o))&&n()),1!==s||u||(i=a.values[0],En.clone(i,e._primaryPosition),En.clone(i,e._primaryStartPosition),En.clone(i,e._primaryPreviousPosition),e._buttonDown[jK.LEFT]=!0,Ze(n=e.getInputAction(kK.LEFT_DOWN,o))&&(En.clone(i,fQ.position),n(fQ)),e._touchHoldTimer=setTimeout(function(){e.isDestroyed()||(e._touchHoldTimer=void 0,e._isTouchHolding=!0,Ze(r=e.getInputAction(kK.RIGHT_CLICK,o))&&$K(e._primaryStartPosition,e._previousPositions.values[0],e._holdPixelTolerance)&&(En.clone(e._primaryPosition,_Q.position),r(_Q)))},CQ.touchHoldDelayMilliseconds),t.preventDefault()),2!==s||u||(e._isPinching=!0,Ze(n=e.getInputAction(kK.PINCH_START,o))&&(En.clone(a.values[0],pQ.position1),En.clone(a.values[1],pQ.position2),n(pQ),t.preventDefault()))}function yQ(e,t){ZK(e);for(var n,r,i=t.changedTouches,o=i.length,a=e._positions,s=0;s<o;++s){r=(n=i[s]).identifier;var u=a.get(r);Ze(u)&&WK(e,n,u)}bQ(e,t);var l=e._previousPositions;for(s=0;s<o;++s)r=(n=i[s]).identifier,En.clone(a.get(r),l.get(r))}var vQ={startPosition:new En,endPosition:new En},xQ={distance:{startPosition:new En,endPosition:new En},angleAndHeight:{startPosition:new En,endPosition:new En}};function bQ(e,t){var n,r,i,o,a,s,u,l,c,h,f,p,d,m,_,g,y,v=XK(t),x=e._positions,b=e._previousPositions,E=x.length;1===E&&e._buttonDown[jK.LEFT]?(n=x.values[0],En.clone(n,e._primaryPosition),r=e._primaryPreviousPosition,Ze(i=e.getInputAction(kK.MOUSE_MOVE,v))&&(En.clone(r,vQ.startPosition),En.clone(n,vQ.endPosition),i(vQ)),En.clone(n,r),t.preventDefault()):2===E&&e._isPinching&&Ze(i=e.getInputAction(kK.PINCH_MOVE,v))&&(o=x.values[0],a=x.values[1],s=b.values[0],u=b.values[1],l=a.x-o.x,c=a.y-o.y,h=.25*Math.sqrt(l*l+c*c),f=u.x-s.x,p=u.y-s.y,d=.25*Math.sqrt(f*f+p*p),m=.125*(a.y+o.y),_=.125*(u.y+s.y),g=Math.atan2(c,l),y=Math.atan2(p,f),En.fromElements(0,d,xQ.distance.startPosition),En.fromElements(0,h,xQ.distance.endPosition),En.fromElements(y,_,xQ.angleAndHeight.startPosition),En.fromElements(g,m,xQ.angleAndHeight.endPosition),i(xQ))}function EQ(e,t){var n,r;t.target.setPointerCapture(t.pointerId),"touch"===t.pointerType?(n=e._positions,r=t.pointerId,n.set(r,WK(e,t,new En)),gQ(e,t),e._previousPositions.set(r,En.clone(n.get(r)))):eQ(e,t)}function TQ(e,t){var n,r;"touch"===t.pointerType?(n=e._positions,r=t.pointerId,n.remove(r),gQ(e,t),e._previousPositions.remove(r)):iQ(e,t)}function SQ(e,t){if("touch"===t.pointerType){var n=e._positions,r=t.pointerId,i=n.get(r);if(!Ze(i))return;WK(e,t,i),bQ(e,t);var o=e._previousPositions;En.clone(n.get(r),o.get(r))}else aQ(e,t)}function CQ(e){var t,n,r;this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-CQ.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new En,this._primaryPosition=new En,this._primaryPreviousPosition=new En,this._positions=new Od,this._previousPositions=new Od,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=Je(e,document),n=(t=this)._element,r=Ze(n.disableRootEvents)?n:document,et.supportsPointerEvents()?(KK(t,"pointerdown",n,EQ),KK(t,"pointerup",n,TQ),KK(t,"pointermove",n,SQ),KK(t,"pointercancel",n,TQ)):(KK(t,"mousedown",n,eQ),KK(t,"mouseup",r,iQ),KK(t,"mousemove",r,aQ),KK(t,"touchstart",n,cQ),KK(t,"touchend",r,hQ),KK(t,"touchmove",r,yQ),KK(t,"touchcancel",r,hQ)),KK(t,"dblclick",n,uQ),KK(t,"onwheel"in n?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",n,lQ)}CQ.prototype.setInputAction=function(e,t,n){var r=YK(t,n);this._inputEvents[r]=e},CQ.prototype.getInputAction=function(e,t){var n=YK(e,t);return this._inputEvents[n]},CQ.prototype.removeInputAction=function(e,t){var n=YK(e,t);delete this._inputEvents[n]},CQ.prototype.isDestroyed=function(){return!1},CQ.prototype.destroy=function(){return function(e){for(var t=e._removalFunctions,n=0;n<t.length;++n)t[n]()}(this),Vt(this)},CQ.mouseEmulationIgnoreMilliseconds=800,CQ.touchHoldDelayMilliseconds=1500;var wQ="uniform sampler2D colorTexture;\nuniform sampler2D bloomTexture;\nuniform bool glowOnly;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec4 color = texture2D(colorTexture, v_textureCoordinates);\n#ifdef CZM_SELECTED_FEATURE\nif (czm_selected()) {\ngl_FragColor = color;\nreturn;\n}\n#endif\nvec4 bloom = texture2D(bloomTexture, v_textureCoordinates);\ngl_FragColor = glowOnly ? bloom : bloom + color;\n}\n";function AQ(){this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=void 0,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new En,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10}function IQ(e){var t=e._framebuffers;if(Ze(t)){for(var n=t.length,r=0;r<n;++r)t[r].destroy();e._framebuffers=void 0,e._previousLuminance.destroy(),e._previousLuminance=void 0}}function PQ(e){var t=e._commands;if(Ze(t)){for(var n=t.length,r=0;r<n;++r)t[r].shaderProgram.destroy();e._commands=void 0}}function OQ(e,t){var n,r;return(r=0===t?{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions}}:(n=e._framebuffers[t-1].getColorTexture(0),{colorTexture:function(){return n},colorTextureDimensions:function(){return n.dimensions}})).minMaxLuminance=function(){return e._minMaxLuminance},r.previousLuminance=function(){return e._previousLuminance.getColorTexture(0)},r}function LQ(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0,this.viewport=void 0}Object.defineProperties(AQ.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},outputTexture:{get:function(){var e=this._framebuffers;if(Ze(e))return e[e.length-1].getColorTexture(0)}}}),AQ.prototype.clear=function(e){var t=this._framebuffers;if(Ze(t)){var n=this._clearCommand;Ze(n)||(n=this._clearCommand=new iT({color:new It(0,0,0,0),framebuffer:void 0}));for(var r=t.length,i=0;i<r;++i)n.framebuffer=t[i],n.execute(e)}},AQ.prototype.update=function(e){var t=e.drawingBufferWidth,n=e.drawingBufferHeight;t===this._width&&n===this._height||(this._width=t,this._height=n,function(e,t){IQ(e);for(var n=e._width,r=e._height,i=Ln.RGBA,o=t.halfFloatingPointTexture?Pn.HALF_FLOAT:Pn.FLOAT,a=Math.ceil(Math.log(Math.max(n,r))/Math.log(3)),s=new Array(a),u=0;u<a;++u)n=Math.max(Math.ceil(n/3),1),r=Math.max(Math.ceil(r/3),1),s[u]=new sT({context:t,colorTextures:[new ti({context:t,width:n,height:r,pixelFormat:i,pixelDatatype:o,sampler:Nr.NEAREST})]});var l=s[a-1].getColorTexture(0);e._previousLuminance=new sT({context:t,colorTextures:[new ti({context:t,width:l.width,height:l.height,pixelFormat:i,pixelDatatype:o,sampler:Nr.NEAREST})]}),e._framebuffers=s}(this,e),function(e,t){PQ(e);for(var n,r,i=e._framebuffers,o=i.length,a=new Array(o),s=0;s<o;++s)a[s]=t.createViewportQuadCommand((r=void 0,r="uniform sampler2D colorTexture; \nvarying vec2 v_textureCoordinates; \nfloat sampleTexture(vec2 offset) { \n",r+=0===(n=s)?"    vec4 color = texture2D(colorTexture, v_textureCoordinates + offset); \n    return czm_luminance(color.rgb); \n":"    return texture2D(colorTexture, v_textureCoordinates + offset).r; \n",r+="}\n\n",r+="uniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color = 0.0; \n    float xStep = 1.0 / colorTextureDimensions.x; \n    float yStep = 1.0 / colorTextureDimensions.y; \n    int count = 0; \n    for (int i = 0; i < 3; ++i) { \n        for (int j = 0; j < 3; ++j) { \n            vec2 offset; \n            offset.x = -xStep + float(i) * xStep; \n            offset.y = -yStep + float(j) * yStep; \n            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \n                continue; \n            } \n            color += sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count > 0) { \n        color /= float(count); \n    } \n",n===o-1&&(r+="    float previous = texture2D(previousLuminance, vec2(0.5)).r; \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color = previous + (color - previous) / (60.0 * 1.5); \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n"),r+="    gl_FragColor = vec4(color); \n} \n"),{framebuffer:i[s],uniformMap:OQ(e,s)});e._commands=a}(this,e),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;var r=this._framebuffers,i=r[r.length-1];r[r.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance,this._previousLuminance=i},AQ.prototype.execute=function(e,t){this._colorTexture=t;var n=this._commands;if(Ze(n))for(var r=n.length,i=0;i<r;++i)n[i].execute(e)},AQ.prototype.isDestroyed=function(){return!1},AQ.prototype.destroy=function(){return IQ(this),PQ(this),Vt(this)};var NQ={NEAREST:0,LINEAR:1};function RQ(e){var t=(e=Je(e,Je.EMPTY_OBJECT)).fragmentShader,n=Je(e.textureScale,1),r=Je(e.pixelFormat,Ln.RGBA);this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=n,this._forcePowerOfTwo=Je(e.forcePowerOfTwo,!1),this._sampleMode=Je(e.sampleMode,NQ.NEAREST),this._pixelFormat=r,this._pixelDatatype=Je(e.pixelDatatype,Pn.UNSIGNED_BYTE),this._clearColor=Je(e.clearColor,It.BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;var i=new LQ;i.scissorTest={enabled:!0,rectangle:Ze(e.scissorRectangle)?tr.clone(e.scissorRectangle):new tr},this._passState=i,this._ready=!1;var o=e.name;Ze(o)||(o=Jr()),this._name=o,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0,this.updateFunction=Je(e.updateFunction,void 0),this.type=Je(e.type,void 0),this.getDepthTextureFunction=Je(e.getDepthTextureFunction,void 0),this.preUpdateFunction=Je(e.preUpdateFunction,void 0),this.blShaderUseDepths=Je(e.blShaderUseDepths,!1),this.depthTextureIndex=Je(e.depthTextureIndex,0)}Object.defineProperties(RQ.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(Ze(this._textureCache)){var e=this._textureCache.getFramebuffer(this._name);if(Ze(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});var DQ=/uniform\s+sampler2D\s+depthTexture/g;function MQ(i,o,a){var e=o[a];return("string"==typeof e||e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof ImageData)&&i._dirtyUniforms.push(a),{get:function(){return o[a]},set:function(e){var t=o[a];o[a]=e;var n=i._actualUniforms,r=n[a];Ze(r)&&r!==t&&r instanceof ti&&!Ze(i._textureCache.getStageByName(a))&&(i._texturesToRelease.push(r),delete n[a],delete n[a+"Dimensions"]),t instanceof ti&&i._texturesToRelease.push(t),"string"==typeof e||e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof ImageData?i._dirtyUniforms.push(a):n[a]=e}}}function FQ(t,n){return function(){var e=t._actualUniforms[n];return"function"==typeof e?e():e}}function zQ(t,n){return function(){var e=t[n]();if(Ze(e))return e.dimensions}}function BQ(e){if(Ze(e._uniformMap)&&Ze(e.updateFunction)&&(e.updateFunction(e.type),function(e){if(Ze(e.type)){var t=e.type;for(var n in t)"function"!=typeof t[n]&&Ze(e._uniforms[n])?e._uniforms[n]=e.type[n]:"_intensity"===n&&(e._uniforms.intensity=e.type[n])}}(e)),!Ze(e._uniformMap)){var t,n={},r={},i=e._uniforms,o=e._actualUniforms;for(var a in i){i.hasOwnProperty(a)&&("function"!=typeof i[a]?(n[a]=FQ(e,a),r[a]=MQ(e,i,a)):(n[a]=i[a],r[a]=i[a]),o[a]=i[a],("string"==typeof(t=n[a]())||t instanceof ti||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)&&(n[a+"Dimensions"]=zQ(n,a)))}e._uniforms={},Object.defineProperties(e._uniforms,r),e._uniformMap=ne(n,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}}function UQ(t,n){return function(e){t._texturesToCreate.push({name:n,source:e})}}function VQ(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function kQ(e){Ze(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();var t=e._textureCache;if(Ze(t)){var n=e._uniforms,r=e._actualUniforms;for(var i in r)r.hasOwnProperty(i)&&r[i]instanceof ti&&(Ze(t.getStageByName(n[i]))||r[i].destroy(),e._dirtyUniforms.push(i))}}function GQ(e){e=Je(e,Je.EMPTY_OBJECT),this._stages=e.stages,this._inputPreviousStageTexture=Je(e.inputPreviousStageTexture,!0);var t=e.name;Ze(t)||(t=Jr()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}RQ.prototype._isSupported=function(e){return!DQ.test(this._fragmentShader)||e.depthTexture},RQ.prototype.preUpdate=function(e){Ze(this.preUpdateFunction)&&Ze(this.type)&&this.preUpdateFunction(this.type,e)},RQ.prototype.update=function(e,t){var n,r,i,o,a,s,u,l,c,h,f;this.enabled===this._enabled||this.enabled||kQ(this),this._enabled=this.enabled,this._enabled&&(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=function(e){var t=Ze(e._selected)?e._selected.length:0,n=Ze(e._parentSelected)?e._parentSelected:0,r=(r=e._selected!==e._selectedShadow||t!==e._selectedLength)||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength;if(Ze(e._selected)&&Ze(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Ze(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!r&&Ze(e._combinedSelected)){if(!Ze(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var i=0;i<t;++i)if(e._combinedSelected[i]!==e._combinedSelectedShadow[i])return!0}return r}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Ze(this._selected)?this._selected.length:0,this._parentSelectedLength=Ze(this._parentSelected)?this._parentSelected.length:0,function(e,t){if(e._selectedDirty){e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;var n=e._combinedSelected;if(Ze(n)){for(var r,i,o=0,a=n.length,s=0;s<a;++s)Ze((r=n[s]).pickIds)?o+=r.pickIds.length:Ze(r.pickId)&&++o;if(0===a||0===o){var u=new Uint8Array(4);return u[0]=255,u[1]=255,u[2]=255,u[3]=255,e._selectedIdTexture=new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.UNSIGNED_BYTE,source:{arrayBufferView:u,width:1,height:1},sampler:Nr.NEAREST})}var l=0,c=new Uint8Array(4*o);for(s=0;s<a;++s)if(Ze((r=n[s]).pickIds))for(var h=r.pickIds,f=h.length,p=0;p<f;++p)i=h[p].color,c[l]=It.floatToByte(i.red),c[l+1]=It.floatToByte(i.green),c[l+2]=It.floatToByte(i.blue),c[l+3]=It.floatToByte(i.alpha),l+=4;else Ze(r.pickId)&&(i=r.pickId.color,c[l]=It.floatToByte(i.red),c[l+1]=It.floatToByte(i.green),c[l+2]=It.floatToByte(i.blue),c[l+3]=It.floatToByte(i.alpha),l+=4);e._selectedIdTexture=new ti({context:t,pixelFormat:Ln.RGBA,pixelDatatype:Pn.UNSIGNED_BYTE,source:{arrayBufferView:c,width:o,height:1},sampler:Nr.NEAREST})}}}(this,e),BQ(this),function(e,t){var n,r=e._texturesToRelease,i=r.length;for(f=0;f<i;++f)n=(n=r[f])&&n.destroy();r.length=0;var o=e._texturesToCreate,i=o.length;for(f=0;f<i;++f){var a=o[f],s=a.name,u=a.source;e._actualUniforms[s]=new ti("samplerPrec"===s?{context:t,source:u,sampler:new Nr({wrapS:Lr.REPEAT,wrapT:Lr.REPEAT,minificationFilter:Pr.NEAREST,magnificationFilter:Ar.NEAREST,maximumAnisotropy:16})}:{context:t,source:u})}o.length=0;var l=e._dirtyUniforms;if(0!==l.length||Ze(e._texturePromise)){if(0!==l.length&&!Ze(e._texturePromise)){i=l.length;for(var c=e._uniforms,h=[],f=0;f<i;++f){var p,d=c[s=l[f]];Ze(e._textureCache.getStageByName(d))?e._actualUniforms[s]=VQ(e,d):"string"==typeof d?(p=new rt({url:d}),h.push(p.fetchImage().then(UQ(e,s)))):e._texturesToCreate.push({name:s,source:d})}(l.length=0)<h.length?(e._ready=!1,e._texturePromise=D.all(h).then(function(){e._ready=!0,e._texturePromise=void 0})):e._ready=!0}}else e._ready=!0}(this,e),r=e,Ze((n=this)._command)&&!n._logDepthChanged&&!n._selectedDirty||(i=n._fragmentShader,Ze(n._selectedIdTexture)&&(i="#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < "+n._selectedIdTexture.width+"; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n"+(i=i.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""))),o=new Xr({defines:[n._useLogDepth?"LOG_DEPTH":""],sources:[i]}),n._command=r.createViewportQuadCommand(o,{uniformMap:n._uniformMap,owner:n})),u=(a=this)._sampleMode===NQ.LINEAR?(s=Pr.LINEAR,Ar.LINEAR):(s=Pr.NEAREST,Ar.NEAREST),Ze(l=a._sampler)&&l.minificationFilter===s&&l.magnificationFilter===u||(a._sampler=new Nr({wrapS:Lr.CLAMP_TO_EDGE,wrapT:Lr.CLAMP_TO_EDGE,minificationFilter:s,magnificationFilter:u})),this._selectedDirty=!1,this._ready&&(c=this._textureCache.getFramebuffer(this._name),Ze(this._command.framebuffer=c)&&((h=c.getColorTexture(0)).width===e.drawingBufferWidth&&h.height===e.drawingBufferHeight||Ze(f=this._renderState)&&h.width===f.viewport.width&&h.height===f.viewport.height||(this._renderState=sr.fromCache({viewport:new tr(0,0,h.width,h.height)})),this._command.renderState=f)))},RQ.prototype.execute=function(e,t,n,r){var i;Ze(this._command)&&Ze(this._command.framebuffer)&&this._ready&&this._enabled&&(!Ze(this.blShaderUseDepths)||!0!==this.blShaderUseDepths||this._useLogDepth?(this._colorTexture=t,this._depthTexture=n,this._idTexture=r,Nr.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler),Ze(i=0<this.scissorRectangle.width&&0<this.scissorRectangle.height?this._passState:void 0)&&(i.context=e),this._command.execute(e,i)):function(e,t,n,r,i){if(!(Ze(e._command)&&Ze(e._command.framebuffer)&&e._ready&&e._enabled&&Ze(e.getDepthTextureFunction)))return;if(!Ze(r=e.getDepthTextureFunction(e,t)))return;e._colorTexture=n,e._depthTexture=r,e._idTexture=i,Nr.equals(e._colorTexture.sampler,e._sampler)||(e._colorTexture.sampler=e._sampler);var o=0<e.scissorRectangle.width&&0<e.scissorRectangle.height?e._passState:void 0;Ze(o)&&(o.context=t);e._command.execute(t,o)}(this,e,t,n,r))},RQ.prototype.isDestroyed=function(){return!1},RQ.prototype.destroy=function(){return kQ(this),Vt(this)},Object.defineProperties(GQ.prototype,{ready:{get:function(){for(var e=this._stages,t=e.length,n=0;n<t;++n)if(!e[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){for(var t=this._stages,n=t.length,r=0;r<n;++r)t[r].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),GQ.prototype._isSupported=function(e){for(var t=this._stages,n=t.length,r=0;r<n;++r)if(!t[r]._isSupported(e))return!1;return!0},GQ.prototype.get=function(e){return this._stages[e]},GQ.prototype.update=function(e,t){this._selectedDirty=function(e){var t=Ze(e._selected)?e._selected.length:0,n=Ze(e._parentSelected)?e._parentSelected:0,r=(r=e._selected!==e._selectedShadow||t!==e._selectedLength)||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength;if(Ze(e._selected)&&Ze(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Ze(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!r&&Ze(e._combinedSelected)){if(!Ze(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var i=0;i<t;++i)if(e._combinedSelected[i]!==e._combinedSelectedShadow[i])return!0}return r}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Ze(this._selected)?this._selected.length:0,this._parentSelectedLength=Ze(this._parentSelected)?this._parentSelected.length:0;for(var n=this._stages,r=n.length,i=0;i<r;++i){var o=n[i];this._selectedDirty&&(o.parentSelected=this._combinedSelected),o.update(e,t)}},GQ.prototype.isDestroyed=function(){return!1},GQ.prototype.destroy=function(){for(var e=this._stages,t=e.length,n=0;n<t;++n)e[n].destroy();return Vt(this)};var qQ={};function HQ(e){var t="#define USE_STEP_SIZE\n#define SAMPLES 8\nuniform float delta;\nuniform float sigma;\nuniform float direction;\nuniform sampler2D colorTexture;\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec2 st = v_textureCoordinates;\nvec2 dir = vec2(1.0 - direction, direction);\n#ifdef USE_STEP_SIZE\nvec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));\n#else\nvec2 step = step;\n#endif\nvec3 g;\ng.x = 1.0 / (sqrt(czm_twoPi) * sigma);\ng.y = exp((-0.5 * delta * delta) / (sigma * sigma));\ng.z = g.y * g.y;\nvec4 result = texture2D(colorTexture, st) * g.x;\nfor (int i = 1; i < SAMPLES; ++i)\n{\ng.xy *= g.yz;\nvec2 offset = float(i) * dir * step;\nresult += texture2D(colorTexture, st - offset) * g.x;\nresult += texture2D(colorTexture, st + offset) * g.x;\n}\ngl_FragColor = result;\n}\n",r=new RQ({name:e+"_x_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:NQ.LINEAR}),i=new RQ({name:e+"_y_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:NQ.LINEAR}),n={};return Object.defineProperties(n,{delta:{get:function(){return r.uniforms.delta},set:function(e){var t=r.uniforms,n=i.uniforms;t.delta=n.delta=e}},sigma:{get:function(){return r.uniforms.sigma},set:function(e){var t=r.uniforms,n=i.uniforms;t.sigma=n.sigma=e}},stepSize:{get:function(){return r.uniforms.stepSize},set:function(e){var t=r.uniforms,n=i.uniforms;t.stepSize=n.stepSize=e}}}),new GQ({name:e,stages:[r,i],uniforms:n})}qQ.createBlurStage=function(){return HQ("czm_blur")},qQ.createDepthOfFieldStage=function(){var t=HQ("czm_depth_of_field_blur"),n=new RQ({name:"czm_depth_of_field_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D blurTexture;\nuniform sampler2D depthTexture;\nuniform float focalDistance;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(vec2 uv, float depth)\n{\nvec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\nvec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\nposInCamera = posInCamera / posInCamera.w;\nreturn posInCamera;\n}\nfloat computeDepthBlur(float depth)\n{\nfloat f;\nif (depth < focalDistance)\n{\nf = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\n}\nelse\n{\nf = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\nf = pow(f, 0.1);\n}\nf *= f;\nf = clamp(f, 0.0, 1.0);\nreturn pow(f, 0.5);\n}\nvoid main(void)\n{\nfloat depth = czm_readDepth(depthTexture, v_textureCoordinates);\nvec4 posInCamera = toEye(v_textureCoordinates, depth);\nfloat d = computeDepthBlur(-posInCamera.z);\ngl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\n}\n",uniforms:{focalDistance:5,blurTexture:t.name}}),e={};return Object.defineProperties(e,{focalDistance:{get:function(){return n.uniforms.focalDistance},set:function(e){n.uniforms.focalDistance=e}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}}}),new GQ({name:"czm_depth_of_field",stages:[t,n],inputPreviousStageTexture:!1,uniforms:e})},qQ.isDepthOfFieldSupported=function(e){return e.context.depthTexture},qQ.createEdgeDetectionStage=function(){return new RQ({name:"czm_edge_detection_"+Jr(),fragmentShader:"uniform sampler2D depthTexture;\nuniform float length;\nuniform vec4 color;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nfloat directions[3];\ndirections[0] = -1.0;\ndirections[1] = 0.0;\ndirections[2] = 1.0;\nfloat scalars[3];\nscalars[0] = 3.0;\nscalars[1] = 10.0;\nscalars[2] = 3.0;\nfloat padx = czm_pixelRatio / czm_viewport.z;\nfloat pady = czm_pixelRatio / czm_viewport.w;\n#ifdef CZM_SELECTED_FEATURE\nbool selected = false;\nfor (int i = 0; i < 3; ++i)\n{\nfloat dir = directions[i];\nselected = selected || czm_selected(vec2(-padx, dir * pady));\nselected = selected || czm_selected(vec2(padx, dir * pady));\nselected = selected || czm_selected(vec2(dir * padx, -pady));\nselected = selected || czm_selected(vec2(dir * padx, pady));\nif (selected)\n{\nbreak;\n}\n}\nif (!selected)\n{\ngl_FragColor = vec4(color.rgb, 0.0);\nreturn;\n}\n#endif\nfloat horizEdge = 0.0;\nfloat vertEdge = 0.0;\nfor (int i = 0; i < 3; ++i)\n{\nfloat dir = directions[i];\nfloat scale = scalars[i];\nhorizEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\nhorizEdge += texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\nvertEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\nvertEdge += texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\n}\nfloat len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\ngl_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);\n}\n",uniforms:{length:.25,color:It.clone(It.BLACK)}})},qQ.isEdgeDetectionSupported=function(e){return e.context.depthTexture},qQ.createSilhouetteStage=function(e){var t=function(e){if(!Ze(e))return qQ.createEdgeDetectionStage();for(var t=new GQ({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),n={},r="",i="",o=0;o<e.length;++o)r+="uniform sampler2D edgeTexture"+o+"; \n",i+="        vec4 edge"+o+" = texture2D(edgeTexture"+o+", v_textureCoordinates); \n        if (edge"+o+".a > 0.0) \n        { \n            color = edge"+o+"; \n            break; \n        } \n",n["edgeTexture"+o]=e[o].name;return new GQ({name:"czm_edge_detection_composite",stages:[t,new RQ({name:"czm_edge_detection_combine",fragmentShader:r+"varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < "+e.length+"; i++) \n    { \n"+i+"    } \n    gl_FragColor = color; \n} \n",uniforms:n})]})}(e);return new GQ({name:"czm_silhouette",stages:[t,new RQ({name:"czm_silhouette_color_edges",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D silhouetteTexture;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec4 silhouetteColor = texture2D(silhouetteTexture, v_textureCoordinates);\nvec4 color = texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor = mix(color, silhouetteColor, silhouetteColor.a);\n}\n",uniforms:{silhouetteTexture:t.name}})],inputPreviousStageTexture:!1,uniforms:t.uniforms})},qQ.isSilhouetteSupported=function(e){return e.context.depthTexture},qQ.createBloomStage=function(){var t=new RQ({name:"czm_bloom_contrast_bias",fragmentShader:"uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\nsceneColor = czm_RGBToHSB(sceneColor);\nsceneColor.z += brightness;\nsceneColor = czm_HSBToRGB(sceneColor);\nfloat factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\nsceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\ngl_FragColor = vec4(sceneColor, 1.0);\n}\n",uniforms:{contrast:128,brightness:-.3}}),n=HQ("czm_bloom_blur"),e=new GQ({name:"czm_bloom_contrast_bias_blur",stages:[t,n]}),r=new RQ({name:"czm_bloom_generate_composite",fragmentShader:wQ,uniforms:{glowOnly:!1,bloomTexture:e.name}}),i={};return Object.defineProperties(i,{glowOnly:{get:function(){return r.uniforms.glowOnly},set:function(e){r.uniforms.glowOnly=e}},contrast:{get:function(){return t.uniforms.contrast},set:function(e){t.uniforms.contrast=e}},brightness:{get:function(){return t.uniforms.brightness},set:function(e){t.uniforms.brightness=e}},delta:{get:function(){return n.uniforms.delta},set:function(e){n.uniforms.delta=e}},sigma:{get:function(){return n.uniforms.sigma},set:function(e){n.uniforms.sigma=e}},stepSize:{get:function(){return n.uniforms.stepSize},set:function(e){n.uniforms.stepSize=e}}}),new GQ({name:"czm_bloom",stages:[e,r],inputPreviousStageTexture:!1,uniforms:i})},qQ.createSelectedBloomStage=function(e){var t=new RQ({name:"czm_selected_bloom_contrast_bias",fragmentShader:"uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\n#ifdef CZM_SELECTED_FEATURE\nif(czm_selected()) {\nvec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\nsceneColor = czm_RGBToHSB(sceneColor);\nsceneColor.z += brightness;\nsceneColor = czm_HSBToRGB(sceneColor);\nfloat factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\nsceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\ngl_FragColor = vec4(sceneColor, 1.0);\n}\n#endif\n}\n",uniforms:{contrast:128,brightness:1}}),n=HQ("czm_selected_bloom_blur"),r=new GQ({name:"czm_selected_bloom_contrast_bias_blur",stages:[t,n]}),i=new RQ({name:"czm_selected_bloom_generate_composite",fragmentShader:wQ,uniforms:{glowOnly:!1,bloomTexture:r.name}}),o={};return Object.defineProperties(o,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(e){i.uniforms.glowOnly=e}},contrast:{get:function(){return t.uniforms.contrast},set:function(e){t.uniforms.contrast=e}},brightness:{get:function(){return t.uniforms.brightness},set:function(e){t.uniforms.brightness=e}},delta:{get:function(){return n.uniforms.delta},set:function(e){n.uniforms.delta=e}},sigma:{get:function(){return n.uniforms.sigma},set:function(e){n.uniforms.sigma=e}},stepSize:{get:function(){return n.uniforms.stepSize},set:function(e){n.uniforms.stepSize=e}}}),Ze(e)&&(o.glowOnly=Boolean(e.glowOnly),o.contrast=Number(e.contrast),o.brightness=Number(e.brightness),o.delta=Number(e.delta),o.sigma=Number(e.sigma),o.stepSize=Number(e.stepSize)),new GQ({name:"czm_selected_bloom",stages:[r,i],inputPreviousStageTexture:!1,uniforms:o})},qQ.createAmbientOcclusionStage=function(){var t=new RQ({name:"czm_ambient_occlusion_generate",fragmentShader:"uniform sampler2D randomTexture;\nuniform sampler2D depthTexture;\nuniform float intensity;\nuniform float bias;\nuniform float lengthCap;\nuniform float stepSize;\nuniform float frustumLength;\nvarying vec2 v_textureCoordinates;\nvec4 clipToEye(vec2 uv, float depth)\n{\nvec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\nvec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\nposEC = posEC / posEC.w;\nreturn posEC;\n}\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\n{\nvec4 posInCameraUp = clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\nvec4 posInCameraDown = clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\nvec4 posInCameraLeft = clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\nvec4 posInCameraRight = clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\nvec3 up = posInCamera.xyz - posInCameraUp.xyz;\nvec3 down = posInCameraDown.xyz - posInCamera.xyz;\nvec3 left = posInCamera.xyz - posInCameraLeft.xyz;\nvec3 right = posInCameraRight.xyz - posInCamera.xyz;\nvec3 DX = length(left) < length(right) ? left : right;\nvec3 DY = length(up) < length(down) ? up : down;\nreturn normalize(cross(DY, DX));\n}\nvoid main(void)\n{\nfloat depth = czm_readDepth(depthTexture, v_textureCoordinates);\nvec4 posInCamera = clipToEye(v_textureCoordinates, depth);\nif (posInCamera.z > frustumLength)\n{\ngl_FragColor = vec4(1.0);\nreturn;\n}\nvec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\nfloat depthU = czm_readDepth(depthTexture, v_textureCoordinates - vec2(0.0, pixelSize.y));\nfloat depthD = czm_readDepth(depthTexture, v_textureCoordinates + vec2(0.0, pixelSize.y));\nfloat depthL = czm_readDepth(depthTexture, v_textureCoordinates - vec2(pixelSize.x, 0.0));\nfloat depthR = czm_readDepth(depthTexture, v_textureCoordinates + vec2(pixelSize.x, 0.0));\nvec3 normalInCamera = getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\nfloat ao = 0.0;\nvec2 sampleDirection = vec2(1.0, 0.0);\nfloat gapAngle = 90.0 * czm_radiansPerDegree;\nfloat randomVal = texture2D(randomTexture, v_textureCoordinates).x;\nfor (int i = 0; i < 4; i++)\n{\nfloat newGapAngle = gapAngle * (float(i) + randomVal);\nfloat cosVal = cos(newGapAngle);\nfloat sinVal = sin(newGapAngle);\nvec2 rotatedSampleDirection = vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\nfloat localAO = 0.0;\nfloat localStepSize = stepSize;\nfor (int j = 0; j < 6; j++)\n{\nvec2 newCoords = v_textureCoordinates + rotatedSampleDirection * localStepSize * pixelSize;\nif(newCoords.x > 1.0 || newCoords.y > 1.0 || newCoords.x < 0.0 || newCoords.y < 0.0)\n{\nbreak;\n}\nfloat stepDepthInfo = czm_readDepth(depthTexture, newCoords);\nvec4 stepPosInCamera = clipToEye(newCoords, stepDepthInfo);\nvec3 diffVec = stepPosInCamera.xyz - posInCamera.xyz;\nfloat len = length(diffVec);\nif (len > lengthCap)\n{\nbreak;\n}\nfloat dotVal = clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\nfloat weight = len / lengthCap;\nweight = 1.0 - weight * weight;\nif (dotVal < bias)\n{\ndotVal = 0.0;\n}\nlocalAO = max(localAO, dotVal * weight);\nlocalStepSize += stepSize;\n}\nao += localAO;\n}\nao /= 4.0;\nao = 1.0 - clamp(ao, 0.0, 1.0);\nao = pow(ao, intensity);\ngl_FragColor = vec4(vec3(ao), 1.0);\n}\n",uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),n=HQ("czm_ambient_occlusion_blur");n.uniforms.stepSize=.86;var e=new GQ({name:"czm_ambient_occlusion_generate_blur",stages:[t,n]}),r=new RQ({name:"czm_ambient_occlusion_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D ambientOcclusionTexture;\nuniform bool ambientOcclusionOnly;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 color = texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 ao = texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\ngl_FragColor.rgb = ambientOcclusionOnly ? ao : ao * color;\n}\n",uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:e.name}}),i={};return Object.defineProperties(i,{intensity:{get:function(){return t.uniforms.intensity},set:function(e){t.uniforms.intensity=e}},bias:{get:function(){return t.uniforms.bias},set:function(e){t.uniforms.bias=e}},lengthCap:{get:function(){return t.uniforms.lengthCap},set:function(e){t.uniforms.lengthCap=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}},frustumLength:{get:function(){return t.uniforms.frustumLength},set:function(e){t.uniforms.frustumLength=e}},randomTexture:{get:function(){return t.uniforms.randomTexture},set:function(e){t.uniforms.randomTexture=e}},delta:{get:function(){return n.uniforms.delta},set:function(e){n.uniforms.delta=e}},sigma:{get:function(){return n.uniforms.sigma},set:function(e){n.uniforms.sigma=e}},blurStepSize:{get:function(){return n.uniforms.stepSize},set:function(e){n.uniforms.stepSize=e}},ambientOcclusionOnly:{get:function(){return r.uniforms.ambientOcclusionOnly},set:function(e){r.uniforms.ambientOcclusionOnly=e}}}),new GQ({name:"czm_ambient_occlusion",stages:[e,r],inputPreviousStageTexture:!1,uniforms:i})},qQ.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};function WQ(e){var t;this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=Je(e.ellipsoid,Wn.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this._material=e.material,this.highPrecision=e.highPrecision,Ze(e.material)&&!this.highPrecision?Ze(e.material.glowPower)&&Ze(e.material.color)?this._material=_w.fromType(_w.PolylineGlowType,{color:e.material.color,glowPower:e.material.glowPower}):Ze(e.material.gapColor)?this._material=_w.fromType(_w.PolylineDashType,{color:e.material.color,gapColor:e.material.gapColor,dashLength:Ze(e.material.dashLength)?e.material.dashLength:16,dashPattern:Ze(e.material.dashPattern)?e.material.dashPattern:255}):Ze(e.material.color)&&(this._material=_w.fromType(_w.ColorType,{color:e.material.color})):this._material=_w.fromType(_w.ColorType,{color:new It(1,1,1,1)}),this.highPrecision&&(t=this._widths[0],this._material=_w.fromType(_w.PolylineGlowType,{color:It.WHITE,glowPower:.2*t})),this._shaderDisableDepthDistance=!1;var n=e.disableDepthTestDistance;Ze(n)||(n=0),0<(n*=n)&&(this._shaderDisableDepthDistance=!0,n===Number.POSITIVE_INFINITY&&(n=-1)),this.disableDepthTestDistance=new Float32Array(this._widths.length);for(var r=0;r<this._widths.length;r++)this.disableDepthTestDistance[r]=n;this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=It.clone(It.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._readyPromise=D.defer(),this._verticesPromise=void 0,this.useHdr=!0,this.rollerRegion=e.rollerRegion}qQ.createFXAAStage=function(){return new RQ({name:"czm_FXAA",fragmentShader:"#define FXAA_QUALITY_PRESET 39 \n#if (FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\nFxaaFloat4 FxaaPixelShader(\nFxaaFloat2 pos,\nFxaaTex tex,\nFxaaFloat2 fxaaQualityRcpFrame,\nFxaaFloat fxaaQualitySubpix,\nFxaaFloat fxaaQualityEdgeThreshold,\nFxaaFloat fxaaQualityEdgeThresholdMin\n) {\nFxaaFloat2 posM;\nposM.x = pos.x;\nposM.y = pos.y;\nFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\nFxaaFloat maxSM = max(lumaS, lumaM);\nFxaaFloat minSM = min(lumaS, lumaM);\nFxaaFloat maxESM = max(lumaE, maxSM);\nFxaaFloat minESM = min(lumaE, minSM);\nFxaaFloat maxWN = max(lumaN, lumaW);\nFxaaFloat minWN = min(lumaN, lumaW);\nFxaaFloat rangeMax = max(maxWN, maxESM);\nFxaaFloat rangeMin = min(minWN, minESM);\nFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\nFxaaFloat range = rangeMax - rangeMin;\nFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\nFxaaBool earlyExit = range < rangeMaxClamped;\nif(earlyExit)\nreturn rgbyM;\nFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNS = lumaN + lumaS;\nFxaaFloat lumaWE = lumaW + lumaE;\nFxaaFloat subpixRcpRange = 1.0/range;\nFxaaFloat subpixNSWE = lumaNS + lumaWE;\nFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\nFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\nFxaaFloat lumaNESE = lumaNE + lumaSE;\nFxaaFloat lumaNWNE = lumaNW + lumaNE;\nFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\nFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\nFxaaFloat lumaNWSW = lumaNW + lumaSW;\nFxaaFloat lumaSWSE = lumaSW + lumaSE;\nFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\nFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\nFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\nFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\nFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\nFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\nFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\nFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\nFxaaBool horzSpan = edgeHorz >= edgeVert;\nFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\nif(!horzSpan) lumaN = lumaW;\nif(!horzSpan) lumaS = lumaE;\nif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\nFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\nFxaaFloat gradientN = lumaN - lumaM;\nFxaaFloat gradientS = lumaS - lumaM;\nFxaaFloat lumaNN = lumaN + lumaM;\nFxaaFloat lumaSS = lumaS + lumaM;\nFxaaBool pairN = abs(gradientN) >= abs(gradientS);\nFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\nif(pairN) lengthSign = -lengthSign;\nFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\nFxaaFloat2 posB;\nposB.x = posM.x;\nposB.y = posM.y;\nFxaaFloat2 offNP;\noffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\noffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\nif(!horzSpan) posB.x += lengthSign * 0.5;\nif( horzSpan) posB.y += lengthSign * 0.5;\nFxaaFloat2 posN;\nposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\nposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\nFxaaFloat2 posP;\nposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\nposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\nFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\nFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\nFxaaFloat subpixE = subpixC * subpixC;\nFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\nif(!pairN) lumaNN = lumaSS;\nFxaaFloat gradientScaled = gradient * 1.0/4.0;\nFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\nFxaaFloat subpixF = subpixD * subpixE;\nFxaaBool lumaMLTZero = lumaMM < 0.0;\nlumaEndN -= lumaNN * 0.5;\nlumaEndP -= lumaNN * 0.5;\nFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\nFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\nFxaaBool doneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\nFxaaFloat dstN = posM.x - posN.x;\nFxaaFloat dstP = posP.x - posM.x;\nif(!horzSpan) dstN = posM.y - posN.y;\nif(!horzSpan) dstP = posP.y - posM.y;\nFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\nFxaaFloat spanLength = (dstP + dstN);\nFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\nFxaaFloat spanLengthRcp = 1.0/spanLength;\nFxaaBool directionN = dstN < dstP;\nFxaaFloat dst = min(dstN, dstP);\nFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\nFxaaFloat subpixG = subpixF * subpixF;\nFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\nFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\nFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\nFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\nif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\nif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\nreturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n}\n\nvarying vec2 v_textureCoordinates;\nuniform sampler2D colorTexture;\nconst float fxaaQualitySubpix = 0.5;\nconst float fxaaQualityEdgeThreshold = 0.125;\nconst float fxaaQualityEdgeThresholdMin = 0.0833;\nvoid main()\n{\nvec2 fxaaQualityRcpFrame = vec2(1.0) / czm_viewport.zw;\nvec4 color = FxaaPixelShader(\nv_textureCoordinates,\ncolorTexture,\nfxaaQualityRcpFrame,\nfxaaQualitySubpix,\nfxaaQualityEdgeThreshold,\nfxaaQualityEdgeThresholdMin);\nfloat alpha = texture2D(colorTexture, v_textureCoordinates).a;\ngl_FragColor = vec4(color.rgb, alpha);\n}\n",sampleMode:NQ.LINEAR})},qQ.createAcesTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new RQ({name:"czm_aces",fragmentShader:t+="uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\nvec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\ncolor /= texture2D(autoExposure, vec2(0.5)).r;\n#endif\ncolor = czm_acesTonemapping(color);\ncolor = czm_inverseGamma(color);\ngl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},qQ.createFilmicTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new RQ({name:"czm_filmic",fragmentShader:t+="uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\nvec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure = texture2D(autoExposure, vec2(0.5)).r;\ncolor /= exposure;\n#endif\nconst float A = 0.22;\nconst float B = 0.30;\nconst float C = 0.10;\nconst float D = 0.20;\nconst float E = 0.01;\nconst float F = 0.30;\nconst float white = 11.2;\nvec3 c = ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;\nfloat w = ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;\nc = czm_inverseGamma(c / w);\ngl_FragColor = vec4(c, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},qQ.createReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new RQ({name:"czm_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\nvec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure = texture2D(autoExposure, vec2(0.5)).r;\ncolor /= exposure;\n#endif\ncolor = color / (1.0 + color);\ncolor = czm_inverseGamma(color);\ngl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},qQ.createModifiedReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new RQ({name:"czm_modified_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\nuniform vec3 white;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\nvec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure = texture2D(autoExposure, vec2(0.5)).r;\ncolor /= exposure;\n#endif\ncolor = (color * (1.0 + color / white)) / (1.0 + color);\ncolor = czm_inverseGamma(color);\ngl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{white:It.WHITE,autoExposure:void 0}})},qQ.createAutoExposureStage=function(){return new AQ},qQ.createBlackAndWhiteStage=function(){return new RQ({name:"czm_black_and_white",fragmentShader:"uniform sampler2D colorTexture;\nuniform float gradations;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n#ifdef CZM_SELECTED_FEATURE\nif (czm_selected()) {\ngl_FragColor = vec4(rgb, 1.0);\nreturn;\n}\n#endif\nfloat luminance = czm_luminance(rgb);\nfloat darkness = luminance * gradations;\ndarkness = (darkness - fract(darkness)) / gradations;\ngl_FragColor = vec4(vec3(darkness), 1.0);\n}\n",uniforms:{gradations:5}})},qQ.createBrightnessStage=function(){return new RQ({name:"czm_brightness",fragmentShader:"uniform sampler2D colorTexture;\nuniform float brightness;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 target = vec3(0.0);\ngl_FragColor = vec4(mix(target, rgb, brightness), 1.0);\n}\n",uniforms:{brightness:.5}})},qQ.createNightVisionStage=function(){return new RQ({name:"czm_night_vision",fragmentShader:"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nfloat rand(vec2 co)\n{\nreturn fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\n}\nvoid main(void)\n{\nfloat noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\nvec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 green = vec3(0.0, 1.0, 0.0);\ngl_FragColor = vec4((noiseValue + rgb) * green, 1.0);\n}\n"})},qQ.createDepthViewStage=function(){return new RQ({name:"czm_depth_view",fragmentShader:"uniform sampler2D depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nfloat depth = czm_readDepth(depthTexture, v_textureCoordinates);\ngl_FragColor = vec4(vec3(depth), 1.0);\n}\n"})},qQ.createLensFlareStage=function(){return new RQ({name:"czm_lens_flare",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D dirtTexture;\nuniform sampler2D starTexture;\nuniform vec2 dirtTextureDimensions;\nuniform float distortion;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform float dirtAmount;\nuniform float earthRadius;\nuniform float intensity;\nvarying vec2 v_textureCoordinates;\n#define DISTANCE_TO_SPACE 6500000.0\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\n{\nvec4 positionEC = czm_view * vec4(WC, 1.0);\npositionEC = vec4(positionEC.x + earthRadius, positionEC.y, positionEC.z, 1.0);\nvec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\nreturn czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n}\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\n{\nvec2 NDC = texcoord * 2.0 - 1.0;\nvec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);\nvec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);\nNDC.xy -= earthPosSC.xy;\nfloat X = abs(NDC.x) * sceneSize.x;\nfloat Y = abs(NDC.y) * sceneSize.y;\nreturn clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\n}\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\n{\nvec2 sceneSize = czm_viewport.zw;\nvec3 color;\nif(isSpace)\n{\ncolor.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\ncolor.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\ncolor.b = isInEarth(texcoord + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\n}\nelse\n{\ncolor.r = texture2D(tex, texcoord + direction * distortion.r).r;\ncolor.g = texture2D(tex, texcoord + direction * distortion.g).g;\ncolor.b = texture2D(tex, texcoord + direction * distortion.b).b;\n}\nreturn vec4(clamp(color, 0.0, 1.0), 0.0);\n}\nvoid main(void)\n{\nvec4 originalColor = texture2D(colorTexture, v_textureCoordinates);\nvec3 rgb = originalColor.rgb;\nbool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;\nvec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\nvec4 sunPositionEC = czm_view * sunPos;\nvec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);\nsunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\nif(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))\n{\ngl_FragColor = originalColor;\nreturn;\n}\nvec2 texcoord = vec2(1.0) - v_textureCoordinates;\nvec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\nvec2 invPixelSize = 1.0 / pixelSize;\nvec3 distortionVec = pixelSize.x * vec3(-distortion, 0.0, distortion);\nvec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;\nvec3 direction = normalize(vec3(ghostVec, 0.0));\nvec4 result = vec4(0.0);\nvec4 ghost = vec4(0.0);\nfor (int i = 0; i < 4; ++i)\n{\nvec2 offset = fract(texcoord + ghostVec * float(i));\nghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\n}\nresult += ghost;\nvec2 haloVec = normalize(ghostVec) * haloWidth;\nfloat weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\nweightForHalo = pow(1.0 - weightForHalo, 5.0);\nresult += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\nvec2 dirtTexCoords = (v_textureCoordinates * invPixelSize) / dirtTextureDimensions;\nif (dirtTexCoords.x > 1.0)\n{\ndirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\n}\nif (dirtTexCoords.y > 1.0)\n{\ndirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\n}\nresult += dirtAmount * texture2D(dirtTexture, dirtTexCoords);\nfloat camrot = czm_view[0].z + czm_view[1].y;\nfloat cosValue = cos(camrot);\nfloat sinValue = sin(camrot);\nmat3 rotation = mat3(\ncosValue, -sinValue, 0.0,\nsinValue, cosValue, 0.0,\n0.0, 0.0, 1.0\n);\nvec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\nvec3 st2 = vec3((rotation * st1).xy, 1.0);\nvec3 st3 = st2 * 0.5 + vec3(0.5);\nvec2 lensStarTexcoord = st3.xy;\nfloat weightForLensFlare = length(vec3(sunPos.xy, 0.0));\nfloat oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);\nif (!isSpace)\n{\nresult *= oneMinusWeightForLensFlare * intensity * 0.2;\n}\nelse\n{\nresult *= oneMinusWeightForLensFlare * intensity;\nresult *= texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\n}\nresult += texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor = result;\n}\n",uniforms:{dirtTexture:ms("Assets/Textures/LensFlare/DirtMask.jpg"),starTexture:ms("Assets/Textures/LensFlare/StarBurst.jpg"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:Wn.WGS84.maximumRadius}})},Object.defineProperties(WQ.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise.promise}}});var YQ=new Df("createVectorTilePolylines"),XQ={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4,disableDepthTestDistance:5};function jQ(n,e){if(!Ze(n._va)){if(!Ze(n._verticesPromise)){var t=n._positions,r=n._widths,i=n._counts,o=n._transferrableBatchIds,a=n.disableDepthTestDistance,s=n._packedBuffer;Ze(s)||(t=n._positions=Uo(t),r=n._widths=Uo(r),i=n._counts=Uo(i),o=n._transferrableBatchIds=Uo(n._batchIds),s=n._packedBuffer=(p=(f=n)._rectangle,d=f._minimumHeight,m=f._maximumHeight,_=f._ellipsoid,g=f._center,y=new Float64Array(2+$n.packedLength+Wn.packedLength+_t.packedLength),v=0,y[v++]=d,y[v++]=m,$n.pack(p,y,v),Wn.pack(_,y,v+=$n.packedLength),_t.pack(g,y,v+=Wn.packedLength),y));var u=[t.buffer,r.buffer,i.buffer,o.buffer,s.buffer,a.buffer],l=n.highPrecision,c={positions:t.buffer,widths:r.buffer,counts:i.buffer,batchIds:o.buffer,packedBuffer:s.buffer,highPrecision:l,disableDepthTestDistance:a.buffer},h=n._verticesPromise=YQ.scheduleTask(c,u);if(!Ze(h))return;D(h,function(e){n._currentPositions=new Float32Array(e.currentPositions),n._previousPositions=new Float32Array(e.previousPositions),n._nextPositions=new Float32Array(e.nextPositions),n._expandAndWidth=new Float32Array(e.expandAndWidth),n._vertexBatchIds=new Uint16Array(e.batchIds),n._disableDepthTestDistance=new Float32Array(e.disableDepthTestDistance);var t=e.indexDatatype;n._indices=new(t===wa.UNSIGNED_SHORT?Uint16Array:Uint32Array)(e.indices),n._ready=!0})}var f,p,d,m,_,g,y,v,x,b,E,T,S,C,w,A,I,P,O,L,N,R;n._ready&&!Ze(n._va)&&(x=n._currentPositions,b=n._previousPositions,E=n._nextPositions,T=n._expandAndWidth,S=n._vertexBatchIds,C=n._indices,w=b.byteLength+x.byteLength+E.byteLength,w+=T.byteLength+S.byteLength+C.byteLength,n._trianglesLength=C.length/3,n._geometryByteLength=w,A=Al.createVertexBuffer({context:e,typedArray:b,usage:wl.STATIC_DRAW}),I=Al.createVertexBuffer({context:e,typedArray:x,usage:wl.STATIC_DRAW}),P=Al.createVertexBuffer({context:e,typedArray:E,usage:wl.STATIC_DRAW}),O=Al.createVertexBuffer({context:e,typedArray:T,usage:wl.STATIC_DRAW}),L=Al.createVertexBuffer({context:e,typedArray:S,usage:wl.STATIC_DRAW}),N=Al.createIndexBuffer({context:e,typedArray:C,usage:wl.STATIC_DRAW,indexDatatype:2===C.BYTES_PER_ELEMENT?wa.UNSIGNED_SHORT:wa.UNSIGNED_INT}),(R=[{index:XQ.previousPosition,vertexBuffer:A,componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{index:XQ.currentPosition,vertexBuffer:I,componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{index:XQ.nextPosition,vertexBuffer:P,componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{index:XQ.expandAndWidth,vertexBuffer:O,componentDatatype:Mt.FLOAT,componentsPerAttribute:3},{index:XQ.a_batchId,vertexBuffer:L,componentDatatype:Mt.UNSIGNED_SHORT,componentsPerAttribute:1}]).push({index:XQ.disableDepthTestDistance,vertexBuffer:Al.createVertexBuffer({context:e,typedArray:n._disableDepthTestDistance,usage:wl.STATIC_DRAW}),componentDatatype:Mt.FLOAT,componentsPerAttribute:1}),n._va=new Ac({context:e,attributes:R,indexBuffer:N}),n._positions=void 0,n._widths=void 0,n._counts=void 0,n._ellipsoid=void 0,n._minimumHeight=void 0,n._maximumHeight=void 0,n._rectangle=void 0,n._transferrableBatchIds=void 0,n._packedBuffer=void 0,n._currentPositions=void 0,n._previousPositions=void 0,n._nextPositions=void 0,n._expandAndWidth=void 0,n._vertexBatchIds=void 0,n._indices=void 0,n.disableDepthTestDistance=void 0,n._disableDepthTestDistance=void 0,n._readyPromise.resolve())}}var KQ=new on,QQ=new _t;var ZQ=new qt(0,0,1,1);WQ.prototype.createFeatures=function(e,t){for(var n=this._batchIds,r=n.length,i=0;i<r;++i){var o=n[i];t[o]=new Fo(e,o)}},WQ.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};var JQ=new It,$Q=It.WHITE;function eZ(e,t,n,r,i){this._tileset=e,this._tile=t,this._resource=n,this._polygons=void 0,this._polylines=void 0,this._points=void 0,this._contentReadyPromise=void 0,this._readyPromise=D.defer(),this._batchTable=void 0,this._features=void 0,this.featurePropertiesDirty=!1,function(e,t,n){n=Je(n,0);var r=new Uint8Array(t),i=new DataView(t);n+=tZ;var o=i.getUint32(n,!0);if(1!==o)throw new de("Only Vector tile version 1 is supported.  Version "+o+" is not.");n+=tZ;var a=i.getUint32(n,!0);if(n+=tZ,0===a)return e._readyPromise.resolve(e);var s=i.getUint32(n,!0);if(n+=tZ,0===s)throw new de("Feature table must have a byte length greater than zero");var u=i.getUint32(n,!0);n+=tZ;var l=i.getUint32(n,!0);n+=tZ;var c=i.getUint32(n,!0);n+=tZ;var h=i.getUint32(n,!0);n+=tZ;var f=i.getUint32(n,!0);n+=tZ;var p=i.getUint32(n,!0);n+=tZ;var d=i.getUint32(n,!0),m=kt(r,n+=tZ,s),_=JSON.parse(m);n+=s;var g,y,v=new Uint8Array(t,n,u);{var x;n+=u,0<l&&(x=kt(r,n,l),g=JSON.parse(x),n+=l,0<c&&(y=new Uint8Array(t,n,c),y=new Uint8Array(y),n+=c))}var b=Je(_.POLYGONS_LENGTH,0),E=Je(_.POLYLINES_LENGTH,0),T=Je(_.POINTS_LENGTH,0),S=b+E+T,C=new no(e,S,g,y,function(n){return function(e,t){Ze(n._polygons)&&n._polygons.updateCommands(e,t)}}(e));if(e._batchTable=C,0===S)return;var w=new zo(_,v);if(Ze(w.json.FLOWLINE)){var A=w.json.FLOWLINE;for(var I in A){for(var P=[],O=0;O<A[I].length;O+=3){var L=_t.fromRadians(A[I][O+0],A[I][O+1],A[I][O+2]);P.push(L)}Ze(e.tileset.flowLines)||(e.tileset.flowLines=[]),e.tileset.flowLines.push(P)}}var N=w.getGlobalProperty("REGION");if(!Ze(N))throw new de("Feature table global property: REGION must be defined");var R=$n.unpack(N),D=N[4],M=N[5],F=e._tile.computedTransform,z=w.getGlobalProperty("RTC_CENTER",Mt.FLOAT,3);Ze(z)?(z=_t.unpack(z),on.multiplyByPoint(F,z,z)):((z=$n.center(R)).height=pt.lerp(D,M,.5),z=Wn.WGS84.cartographicToCartesian(z));var B,U,V=function(e,t){var n,r,i,o,a=Je(e.POLYGONS_LENGTH,0),s=Je(e.POLYLINES_LENGTH,0),u=Je(e.POINTS_LENGTH,0);{var l;0<a&&Ze(e.POLYGON_BATCH_IDS)&&(l=t.byteOffset+e.POLYGON_BATCH_IDS.byteOffset,n=new Uint16Array(t.buffer,l,a))}{var c;0<s&&Ze(e.POLYLINE_BATCH_IDS)&&(c=t.byteOffset+e.POLYLINE_BATCH_IDS.byteOffset,r=new Uint16Array(t.buffer,c,s))}{var h;0<u&&Ze(e.POINT_BATCH_IDS)&&(h=t.byteOffset+e.POINT_BATCH_IDS.byteOffset,i=new Uint16Array(t.buffer,h,u))}var f=Ze(n)||Ze(r)||Ze(i),p=0<a&&!Ze(n)||0<s&&!Ze(r)||0<u&&!Ze(i);if(f&&p)throw new de("If one group of batch ids is defined, then all batch ids must be defined.");if(!Ze(n)&&!Ze(r)&&!Ze(i)){var d=0;if(!Ze(n)&&0<a)for(n=new Uint16Array(a),o=0;o<a;++o)n[o]=d++;if(!Ze(r)&&0<s)for(r=new Uint16Array(s),o=0;o<s;++o)r[o]=d++;if(!Ze(i)&&0<u)for(i=new Uint16Array(u),o=0;o<u;++o)i[o]=d++}return{polygons:n,polylines:r,points:i}}(_,v);if(n+=n%4,0<b){w.featuresLength=b;var k=Je(w.getPropertyArray("POLYGON_COUNTS",Mt.UNSIGNED_INT,1),w.getPropertyArray("POLYGON_COUNT",Mt.UNSIGNED_INT,1));if(!Ze(k))throw new de("Feature table property: POLYGON_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var G=Je(w.getPropertyArray("POLYGON_INDEX_COUNTS",Mt.UNSIGNED_INT,1),w.getPropertyArray("POLYGON_INDEX_COUNT",Mt.UNSIGNED_INT,1));if(!Ze(G))throw new de("Feature table property: POLYGON_INDEX_COUNTS must be defined when POLYGONS_LENGTH is greater than 0");var q=k.reduce(function(e,t){return e+2*t},0),H=G.reduce(function(e,t){return e+t},0),W=new Uint32Array(t,n,H);n+=h;var Y=new Uint16Array(t,n,q);n+=f,Ze(_.POLYGON_MINIMUM_HEIGHTS)&&Ze(_.POLYGON_MAXIMUM_HEIGHTS)&&(B=w.getPropertyArray("POLYGON_MINIMUM_HEIGHTS",Mt.FLOAT,1),U=w.getPropertyArray("POLYGON_MAXIMUM_HEIGHTS",Mt.FLOAT,1)),e._polygons=new bI({positions:Y,counts:k,indexCounts:G,indices:W,minimumHeight:D,maximumHeight:M,polygonMinimumHeights:B,polygonMaximumHeights:U,center:z,rectangle:R,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:C,batchIds:V.polygons,modelMatrix:F})}if(0<E){w.featuresLength=E;var X=Je(w.getPropertyArray("POLYLINE_COUNTS",Mt.UNSIGNED_INT,1),w.getPropertyArray("POLYLINE_COUNT",Mt.UNSIGNED_INT,1));if(!Ze(X))throw new de("Feature table property: POLYLINE_COUNTS must be defined when POLYLINES_LENGTH is greater than 0");var j=w.getPropertyArray("POLYLINE_WIDTHS",Mt.UNSIGNED_SHORT,1);if(!Ze(j)){j=new Uint16Array(E);var K=2;Ze(e._tileset._airWidth)&&(K=e._tileset._airWidth);for(O=0;O<E;++O)j[O]=K}var Q,Z=X.reduce(function(e,t){return e+3*t},0),J=w.getGlobalProperty("HIGHTPRECISION",Mt.UNSIGNED_INT,1);Ze(J)||(J=e._tileset.highPrecision),Q=new(Ze(J)&&J?Uint32Array:Uint16Array)(t,n,Z),n+=p,e._polylines=new WQ({positions:Q,widths:j,counts:X,batchIds:V.polylines,minimumHeight:D,maximumHeight:M,center:z,rectangle:R,boundingVolume:e.tile.boundingVolume.boundingVolume,batchTable:C,material:e._tileset._material,highPrecision:J,disableDepthTestDistance:e._tileset._disableDepthTestDistance,rollerRegion:e._tileset.rollerRegion})}{var $;0<T&&($=new Uint16Array(t,n,3*T),n+=d,e._points=new uI({positions:$,batchIds:V.points,minimumHeight:D,maximumHeight:M,rectangle:R,batchTable:C,heightReference:e._tileset.heightReference}))}}(this,r,i)}WQ.prototype.applyStyle=function(e,t){if(Ze(e)){Ze(this._batchTable._content.tileset.meshLine)&&(this.meshLine=this._batchTable._content.tileset.meshLine),Ze(this._batchTable.batchInitValues)&&(this._batchTable._batchValues=void 0,this._batchTable._batchValues=Uo(this._batchTable.batchInitValues),this._batchTable._batchValuesDirty=!0),this.meshLine&&!Ze(this._batchTable._batchValues)&&(e.color=this._batchTable._content.tileset.meshLineColor);for(var n=this._batchIds,r=n.length,i=0;i<r;++i){var o,a=t[n[i]];if(this.meshLine){if(Ze(e.color)&&(o=e.color.evaluateColor(a,JQ),It.equals(o,$Q)))continue;a.color=Ze(e.color)?o:$Q}else a.color=Ze(e.color)?e.color.evaluateColor(a,JQ):$Q;a.show=!Ze(e.show)||e.show.evaluate(a)}this.meshLine&&!Ze(this._batchTable.batchInitValues)&&Ze(this._batchTable._batchValues)&&(this._batchTable.batchInitValues=Uo(this._batchTable._batchValues))}else!function(e,t){for(var n=e._batchIds,r=n.length,i=0;i<r;++i){var o=t[n[i]];o.show=!0,o.color=It.WHITE}}(this,t)},WQ.prototype.update=function(e){var t,n,r,i,o,a,s,u,l,c,h,f,p,d,m=e.context;jQ(this,m),n=m,Ze((t=this)._uniformMap)||(t._uniformMap={u_modifiedModelView:function(){var e=n.uniformState.view;return on.clone(e,KQ),on.multiplyByPoint(KQ,t._center,QQ),on.setTranslation(KQ,QQ,KQ),KQ},u_highlightColor:function(){return t._highlightColor},u_rollerRegion:function(){return t.rollerRegion}}),i=m,Ze((r=this)._sp)||(a=(o=r._batchTable).getVertexShaderCallback(!1,"a_batchId",void 0)(CI),u=o.getFragmentShaderCallback()("uniform vec4 u_highlightColor; \nvoid main()\n{\n    gl_FragColor = u_highlightColor;\n}\n",!1,void 0),s=new Xr({defines:["VECTOR_TILE",et.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[mw,a]}),r._shaderDisableDepthDistance&&s.defines.push("DISABLE_DEPTH_DISTANCE"),"PolylineDash"===r._material.type&&s.defines.push("POLYLINE_DASH"),l=new Xr({defines:["VECTOR_TILE"],sources:[u=r._material.shaderSource+u]}),r.rollerRegion.equals(ZQ)||l.defines.push("APPLY_ROLLER"),l.sources=l.sources.map(function(e){return e=(e=e.replace("tile_color(tile_featureColor);","#ifdef APPLY_ROLLER\n    czm_rollerShutter(gl_FragCoord.xy,u_rollerRegion);\n#endif\nczm_materialInput materialInput;\n\n    materialInput.s = v_st.s;\n    materialInput.st = v_st;\n    materialInput.str = vec3(v_st, 0.0);\n\n    czm_material material = czm_getMaterial(materialInput);\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#ifdef VECTOR_TILE\n    gl_FragColor*= u_highlightColor;\n#endif\nfloat highlight = ceil(tile_colorBlend); \ngl_FragColor.rgb *= mix(gl_FragColor.rgb, tile_featureColor.rgb, highlight);\n    czm_writeLogDepth();")).replace("varying vec4 tile_featureColor;","varying vec4 tile_featureColor;\nvarying vec2 v_st;\nuniform vec4 u_rollerRegion;")}),r._sp=ic.fromCache({context:i,vertexShaderSource:s,fragmentShaderSource:l,attributeLocations:XQ})),Ze((c=this)._rs)||(c._rs=sr.fromCache({blending:ui.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:{enabled:!0,factor:-5,units:-5}})),!this._ready||((h=e.passes).render||h.pick)&&(p=e,Ze((f=this)._command)||(d=ne(d=f._batchTable.getUniformMapCallback()(f._uniformMap),f._material._uniforms),f._command=new Mn({owner:f,vertexArray:f._va,renderState:f._rs,shaderProgram:f._sp,uniformMap:d,boundingVolume:f._boundingVolume,pass:yn.TRANSLUCENT,pickId:f._batchTable.getPickId()})),f._command.dirty=f.useHdr!==p.camera._scene._hdr,f.useHdr=p.camera._scene._hdr,p.commandList.push(f._command))},WQ.prototype.isDestroyed=function(){return!1},WQ.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),Vt(this)},Object.defineProperties(eZ.prototype,{featuresLength:{get:function(){return Ze(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return Ze(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){var e=0;return Ze(this._polygons)&&(e+=this._polygons.trianglesLength),Ze(this._polylines)&&(e+=this._polylines.trianglesLength),e}},geometryByteLength:{get:function(){var e=0;return Ze(this._polygons)&&(e+=this._polygons.geometryByteLength),Ze(this._polylines)&&(e+=this._polylines.geometryByteLength),e}},texturesByteLength:{get:function(){return Ze(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return Ze(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var tZ=Uint32Array.BYTES_PER_ELEMENT;function nZ(e){var t,n=e.featuresLength;!Ze(e._features)&&0<n&&(t=new Array(n),Ze(e._polygons)&&e._polygons.createFeatures(e,t),Ze(e._polylines)&&e._polylines.createFeatures(e,t),Ze(e._points)&&e._points.createFeatures(e,t),e._features=t)}function rZ(e,t){this._viewer=e,this._evLayerManager=t,this._eventHandler=new CQ(e.canvas),this._selectedFeature=void 0,this._selectedColor=It.LIME,this.eventTypes=[],this._silhouetteStage=void 0,this._edgeDetectionStage=void 0}eZ.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},eZ.prototype.getFeature=function(e){return nZ(this),this._features[e]},eZ.prototype.applyDebugSettings=function(e,t){Ze(this._polygons)&&this._polygons.applyDebugSettings(e,t),Ze(this._polylines)&&this._polylines.applyDebugSettings(e,t),Ze(this._points)&&this._points.applyDebugSettings(e,t)},eZ.prototype.applyStyle=function(e){nZ(this),Ze(this._polygons)&&this._polygons.applyStyle(e,this._features),Ze(this._polylines)&&this._polylines.applyStyle(e,this._features),Ze(this._points)&&this._points.applyStyle(e,this._features)},eZ.prototype.update=function(e,t){var n,r,i,o,a=!0;Ze(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(t),a=a&&this._polygons._ready),Ze(this._polylines)&&(this._polylines.update(t),a=a&&this._polylines._ready),Ze(this._points)&&(this._points.update(t),a=a&&this._points._ready),Ze(this._batchTable)&&a&&this._batchTable.update(e,t),Ze(this._contentReadyPromise)||(n=Ze(this._points)?this._points.readyPromise:void 0,r=Ze(this._polygons)?this._polygons.readyPromise:void 0,i=Ze(this._polylines)?this._polylines.readyPromise:void 0,(o=this)._contentReadyPromise=D.all([n,r,i]).then(function(){o._readyPromise.resolve(o)}))},eZ.prototype.isDestroyed=function(){return!1},eZ.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Vt(this)},Object.defineProperties(rZ.prototype,{selectedColor:{get:function(){return this._selectedColor},set:function(e){e instanceof It&&(this._selectedColor=e)}}}),rZ.prototype.start=function(){var c;(c=this)._eventHandler.setInputAction(function(e){var t=c._viewer,n=e.position;c._actionType===kK.MOUSE_MOVE&&(n=e.endPosition);var r=t.scene.pick(n);if(Ze(r)){c._selectedFeature=r;var i,o,a=c._evLayerManager;r instanceof Fo?(i=r.getProperty("name"))&&(o=r.tileset,(s=a.getE3mLayer(o))&&s.setSelectedComponentName&&i!==s.getSelectedComponentName()&&(s.setSelectedComponentName(i),s.selectedFeature=r)):a.selectionChanged.raiseEvent(s,r.name)}else for(var s,u=c._evLayerManager._e3ms._array,l=0;l<u.length;l++){(s=u[l]).clearSelection(),c._selectedFeature=void 0}},kK.LEFT_CLICK)},rZ.prototype.stop=function(){var e;(e=this)._eventHandler.removeInputAction(kK.LEFT_CLICK),e._selectedFeature=void 0};var iZ=[],oZ=void 0,aZ=[];function sZ(e){-1===iZ.indexOf(e)&&iZ.push(e);for(var t=0;t<iZ.length;t++)Ze(iZ[t].style)&&iZ[t].style.color&&(iZ[t].style.color=void 0,iZ[t]._styleEngine._styleDirty=!0)}function uZ(e){var t;e=Je(e,Je.EMPTY_OBJECT),this._ellipsoid=Je(e.ellipsoid,Wn.WGS84),this._numberOfLevelZeroTilesX=Je(e.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=Je(e.numberOfLevelZeroTilesY,1),this._projection=new fg(this._ellipsoid),Ze(e.rectangleSouthwestInMeters)&&Ze(e.rectangleNortheastInMeters)?(this._rectangleSouthwestInMeters=e.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=e.rectangleNortheastInMeters):(t=this._ellipsoid.maximumRadius*Math.PI,this._rectangleSouthwestInMeters=new En(-t,-t),this._rectangleNortheastInMeters=new En(t,t));var n=this._projection.unproject(this._rectangleSouthwestInMeters),r=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new $n(n.longitude,n.latitude,r.longitude,r.latitude)}function lZ(){this._demLayers=[],this._tilingScheme=void 0,this._maxLevel=void 0}function cZ(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n]}function hZ(e){for(var t=void 0,n=e._demLayers,r=0;r<n.length;r++){var i=n[r];i._vaild&&i._show&&(!Ze(t)||t<n[r]._maxDataLevel)&&(t=n[r]._maxDataLevel)}Ze(t)&&(e._maxLevel=t,e._tilingScheme instanceof uZ&&e._maxLevel--)}function fZ(e){var t=e.name;if(!Ze(t))throw new fe("name is required");if("string"!=typeof t)throw new fe("name is required to be a string ");var n=e.url;if(!Ze(n))throw new fe("url is required");if(this._scene=e.scene,this._name=t,this._url=n,this._type=SN.DEM,this._minDataLevel=0,this._maxDataLevel=0,this._rectangle=void 0,this._vaild=!1,this._tilingScheme=void 0,this._demType=void 0,this._tileSize=void 0,this._heightMapWidth=void 0,this._readyPromise=D.defer(),this._customTag=e.customTag,Ze(e.demOption)&&Ze(e.demOption.heightMapWidth)){var r=e.demOption.heightMapWidth;if("number"!=typeof r)throw new fe("heightMapWidth is required to be a number ");e.heightMapWidth=r,this._heightMapWidth=r}e.url=e.url+"/EV_WebService/MetadataService/GetDEMObjectInfo?demName="+e.name,this._cesiumLayer=void 0,this.layerShownOrHidden=new U,this._show=!0}rZ.prototype.startSelected=function(b,e){Ze(e)||(e=kK.LEFT_CLICK),-1===this.eventTypes.indexOf(e)&&this.eventTypes.push(e);var E=this,T=this._viewer;E._eventHandler.setInputAction(function(e){var t=Ze(e.endPosition)?e.endPosition:e.position,n=T.scene.pick(t);if(Ze(n)){var r,i=E._evLayerManager;if(n instanceof Fo){var o=n.tileset,a=i.getE3mLayer(o);if(sZ(o),0===b){n.primitive.colorBlendMode=gp.HIGHLIGHT;var s=n.getProperty("phaseType"),u=n.getProperty("id");if(Ze(s)&&Ze(u)){var l=E._selectedColor.toCssColorString(),c=[],h=[];(x=[]).push(v='${phaseType} === "'+s+'" && ${id} ==='+u),x.push(l),h.push("true"),h.push("color('white')"),c.push(x),c.push(h),Ze(o.style)?(o.style.color={conditions:c},o._styleEngine._styleDirty=!0):o.style=new bN({color:{conditions:c}})}else{var f,p=n.getProperty("EVID");if(Ze(p)){var d=[];d.push(p),a.setFeaturesColor("EVID",d,E._selectedColor)}else{-1!=(f=n.getPropertyNames()).indexOf("name")&&-1!=f.indexOf("id")&&f.splice(f.indexOf("name"),1);for(var m=[],_=n.content._features.length,g=0;g<_;g++){var y=n._content.batchTable.getProperty(g,f[0]);-1===m.indexOf(y)&&m.push(y)}a.setFeaturesColor(f[0],m,E._selectedColor)}}}else if(1===b){n.content instanceof eZ&&(n.primitive.colorBlendMode=gp.REPLACE),-1!=(f=n.getPropertyNames()).indexOf("name")&&-1!=f.indexOf("id")&&f.splice(f.indexOf("name"),1);for(var v="",g=0;g<f.length;g++){"number"==typeof(y=n.getProperty(f[g]))?v+="${"+f[g]+"} ==="+y+" && ":"string"==typeof y&&(v+="${"+f[g]+'} ==="'+y+'" && ')}v=v.substr(0,v.length-4);var x,l=E._selectedColor.toCssColorString(),c=[],h=[];(x=[]).push(v),x.push(l),h.push("true"),h.push("color('white')"),c.push(x),c.push(h),Ze(o.style)?(o.style.color={conditions:c},o._styleEngine._styleDirty=!0):o.style=new bN({color:{conditions:c}})}else{2===b&&qQ.isSilhouetteSupported(T.scene)&&(Ze(E._silhouetteStage)||(E._edgeDetectionStage=qQ.createEdgeDetectionStage(),E._edgeDetectionStage.uniforms.color=E._selectedColor,E._edgeDetectionStage.uniforms.length=.01,E._edgeDetectionStage.selected=[]),Ze(E._silhouetteStage)||(E._silhouetteStage=qQ.createSilhouetteStage([E._edgeDetectionStage]),T.scene.postProcessStages.add(E._silhouetteStage)),n===E._edgeDetectionStage.selected[0]&&(E._edgeDetectionStage.selected=[]),E._edgeDetectionStage.selected=[n])}a.selectedFeature=n,i.selectedFeature=n}else{Ze(n.primitive)&&Ze(n.primitive.crossid)?(r=n.primitive.owner,a=i._crossDataSources.get(r),Ze(oZ)&&i._crossDataSources.get(oZ.owner).setSelectedColor(oZ.crossid,It.WHITE),a.setSelectedColor(n.primitive.crossid,E._selectedColor),i.selectedFeature=n.primitive,oZ=n.primitive):E.clear()}}else E.clear()},e),1===b&&E._eventHandler.setInputAction(function(e){var t=Ze(e.endPosition)?e.endPosition:e.position,n=T.scene.pick(t);if(Ze(n)){var r=E._evLayerManager;if(n instanceof Fo){var i=n.tileset,o=r.getE3mLayer(i);if(sZ(i),1===b){var a=n.getPropertyNames();-1!=a.indexOf("name")&&-1!=a.indexOf("id")&&a.splice(a.indexOf("name"),1);for(var s="",u=0;u<a.length;u++){var l=n.getProperty(a[u]);"number"==typeof l?s+="${"+a[u]+"} ==="+l+" && ":"string"==typeof l&&(s+="${"+a[u]+'} ==="'+l+'" && ')}s=s.substr(0,s.length-4);var c=E._selectedColor.toCssColorString(),h=[],f=[],p=[];h.push(s),h.push(c),-1===aZ.indexOf(h)&&aZ.push(h),p.push("true"),p.push("color('white')");for(var d=0;d<aZ.length;d++)f.push(aZ[d]);f.push(p),Ze(i.style)?(i.style.color={conditions:f},i._styleEngine._styleDirty=!0):i.style=new bN({color:{conditions:f}})}o.selectedFeature=n,r.selectedFeature=n}}else E.clear()},kK.LEFT_CLICK,HK.CTRL)},rZ.prototype.clear=function(){for(var e=0;e<iZ.length;e++)Ze(iZ[e].style)&&iZ[e].style.color&&(iZ[e].style.color=void 0,iZ[e]._styleEngine._styleDirty=!0);iZ=[];var t=this._viewer;Ze(this._silhouetteStage)&&(this._edgeDetectionStage.selected=[]),Ze(this._silhouetteStage)&&(t.scene.postProcessStages.remove(this._silhouetteStage),this._edgeDetectionStage=void 0,this._silhouetteStage=void 0)},rZ.prototype.stopSelected=function(){for(var e=this,t=0;t<e.eventTypes.length;t++)e._eventHandler.removeInputAction(e.eventTypes[t]);e.eventTypes=[];var n=e._viewer;Ze(e._silhouetteStage)&&(e._edgeDetectionStage.selected=[]),Ze(e._silhouetteStage)&&(n.scene.postProcessStages.remove(e._silhouetteStage),e._edgeDetectionStage=void 0,e._silhouetteStage=void 0),this._evLayerManager._selectedFeature=void 0},rZ.prototype.getPropertyNames=function(r){this._eventHandler.setInputAction(function(e){var t=e.position,n=viewer.scene.pick(t);return Ze(n)?r(n instanceof Fo?n.getPropertyNames():void 0):r(void 0)},kK.LEFT_CLICK)},Object.defineProperties(uZ.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),uZ.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},uZ.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},uZ.prototype.rectangleToNativeRectangle=function(e,t){var n=this._projection,r=n.project($n.southwest(e)),i=n.project($n.northeast(e));return Ze(t)?(t.west=r.x,t.south=r.y,t.east=i.x,t.north=i.y,t):new $n(r.x,r.y,i.x,i.y)},uZ.prototype.tileXYToNativeRectangle=function(e,t,n,r){var i=this.getNumberOfXTilesAtLevel(n),o=this.getNumberOfYTilesAtLevel(n),a=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/i,s=this._rectangleSouthwestInMeters.x+e*a,u=this._rectangleSouthwestInMeters.x+(e+1)*a,l=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/o,c=this._rectangleNortheastInMeters.y-t*l,h=this._rectangleNortheastInMeters.y-(t+1)*l;return Ze(r)?(r.west=s,r.south=h,r.east=u,r.north=c,r):new $n(s,h,u,c)},uZ.prototype.tileXYToRectangle=function(e,t,n,r){var i=this.tileXYToNativeRectangle(e,t,n,r),o=this._projection,a=o.unproject(new En(i.west,i.south)),s=o.unproject(new En(i.east,i.north));return i.west=a.longitude,i.south=a.latitude,i.east=s.longitude,i.north=s.latitude,i},uZ.prototype.positionToTileXY=function(e,t,n){var r=this._rectangle;if($n.contains(r,e)){var i=this.getNumberOfXTilesAtLevel(t),o=this.getNumberOfYTilesAtLevel(t),a=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/i,s=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/o,u=this._projection.project(e),l=(u.x-this._rectangleSouthwestInMeters.x)/a|0;i<=l&&(l=i-1);var c=(this._rectangleNortheastInMeters.y-u.y)/s|0;return(o<=c&&(c=o-1),Ze(n))?(n.x=l,n.y=c,n):new En(l,c)}},Object.defineProperties(lZ.prototype,{tiling:{get:function(){return this._tilingScheme}},maxLevel:{get:function(){return this._maxLevel}}}),lZ.prototype.addDEMLayer=function(a){var s=a._name,e=a._url;if(!Ze(s)||!Ze(e))throw new fe("图层名称或者服务器地址未定义！");if(!Ze(cZ(this._demLayers,s))){var t=e+"/EV_WebService/MetadataService/GetDEMObjectInfo?demName="+s,n=rt.createIfNeeded(t),u=this;return D(n.fetchXML(),r,l),a}function r(e){if(Ze(e.getElementsByTagName("minDataLevel")[0])){a._minDataLevel=parseInt(e.getElementsByTagName("minDataLevel")[0].textContent),a._maxDataLevel=parseInt(e.getElementsByTagName("maxDataLevel")[0].textContent);var t=e.getElementsByTagName("SRS")[0].textContent;if("WGS_1984"===t){if(Ze(u._tilingScheme)){if(u._tilingScheme instanceof uZ)throw new fe("图层投影坐标系不一致！");a._tilingScheme=u._tilingScheme}else a._tilingScheme=new xL({numberOfLevelZeroTilesX:18,numberOfLevelZeroTilesY:9});var n=pt.toRadians(parseFloat(e.getElementsByTagName("minX")[0].textContent)),r=pt.toRadians(parseFloat(e.getElementsByTagName("minY")[0].textContent)),i=pt.toRadians(parseFloat(e.getElementsByTagName("maxX")[0].textContent)),o=pt.toRadians(parseFloat(e.getElementsByTagName("maxY")[0].textContent));a._rectangle=new $n(n,r,i,o)}else{if("Mercator_Web"!==t)return void l();if(Ze(u._tilingScheme)){if(u._tilingScheme instanceof xL)throw new fe("图层投影坐标系不一致！");a._tilingScheme=u._tilingScheme}else a._tilingScheme=new uZ;n=parseFloat(e.getElementsByTagName("minX")[0].textContent),r=parseFloat(e.getElementsByTagName("minY")[0].textContent),i=parseFloat(e.getElementsByTagName("maxX")[0].textContent);o=c(o=parseFloat(e.getElementsByTagName("maxY")[0].textContent)),r=c(r),a._rectangle=new $n(n,r,i,o)}Ze(u._tilingScheme)||(u._tilingScheme=a._tilingScheme),a._demType=e.getElementsByTagName("demType")[0].textContent,a._tileSize=parseInt(e.getElementsByTagName("samplesPerTile")[0].textContent),a._vaild=!0,u._demLayers.push(a),hZ(u),a._readyPromise.resolve(!0)}else console.log(s+" 添加失败,错误的源数据格式！")}function l(e){console.log(s+" 添加失败，请求访问失败！")}function c(e){var t=180/(4*Math.atan(1)),n=Math.atan(Math.sinh(e));return 85<(n*=t)&&(n=90),n<-85&&(n=-90),pt.toRadians(n)}console.log("添加失败，已经存在此名称的图层！")},lZ.prototype.removeDEMLayer=function(e){var t,n,r=void 0;"string"==typeof e?r=this.getDEMLayer(e):"object"==typeof e&&(r=e),t=this._demLayers,-1<(n=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return-1}(t,r))&&t.splice(n,1),hZ(this)},lZ.prototype.getDEMLayer=function(e){return cZ(this._demLayers,e)},lZ.prototype.getFitLayer=function(e,t,n){if(Ze(this._tilingScheme)){for(var r=void 0,i=this._tilingScheme.tileXYToRectangle(e,t,n),o=0;o<this._demLayers.length;o++){var a=this._demLayers[o];a._vaild&&a._show&&$n.simpleIntersection(i,a._rectangle)&&(Ze(r)||(r=a),a._maxDataLevel>r._maxDataLevel&&(r=a))}return r}},lZ.prototype.isTileDataAvailable=function(e,t,n){if(Ze(this._maxLevel)||hZ(this),Ze(this._maxLevel)&&this._maxLevel<n)return!1;if(0==n)return!0;if(!Ze(this._tilingScheme))return!1;for(var r=this._tilingScheme.tileXYToRectangle(e,t,n),i=!0,o=0;o<this._demLayers.length;o++){var a=this._demLayers[o];if(a._vaild&&a._show&&$n.simpleIntersection(r,a._rectangle)){i=!1;break}}return!i&&void 0},lZ.prototype.getRectangles=function(){for(var e=[],t=0;t<this._demLayers.length;t++){var n=this._demLayers[t];n._vaild&&n._show&&e.push(n._rectangle)}return e},lZ.prototype.getFitLayers=function(e,t,n){if(Ze(this._tilingScheme)){for(var r=[],i=void 0,o=this._tilingScheme.tileXYToRectangle(e,t,n),a=0;a<this._demLayers.length;a++){var s=this._demLayers[a];s._vaild&&s._show&&$n.simpleIntersection(o,s._rectangle)&&(Ze(i)||(i=s),s._maxDataLevel>i._maxDataLevel&&(i=s),s._maxDataLevel>=n&&r.push(s))}return 0==r.length&&r.push(i),r}},Object.defineProperties(fZ.prototype,{name:{get:function(){return this._name}},url:{get:function(){return this._url}},type:{get:function(){return this._type}},readyPromise:{get:function(){return this._readyPromise.promise}},customTag:{get:function(){return this._customTag},set:function(e){this._customTag=e}},show:{get:function(){return this._show},set:function(e){"boolean"!=typeof e?console.warn("visible is required to be a boolean"):this._show!==e&&(this._show=e,this.layerShownOrHidden.raiseEvent(this,0,this._show))}},rectangle:{get:function(){return this._rectangle}},vaild:{get:function(){return this._vaild}},minDataLevel:{get:function(){return this._minDataLevel}},maxDataLevel:{get:function(){return this._maxDataLevel}},useIndexedDBCache:{get:function(){return this._useIndexedDBCache},set:function(e){this._useIndexedDBCache="boolean"==typeof e&&e}},scene:{get:function(){return this._scene},set:function(e){if(!(e instanceof Scene))throw new fe("value must be a instance of Scene.");this._scene=e}}}),fZ.prototype.getCesiumLayer=function(){return this._cesiumLayer};var pZ=new _t,dZ=new _t,mZ=new Un,_Z=new ym;function gZ(e,t){return $n.contains(e.rectangle,t)?e:void 0}fZ.prototype.getHeight=function(e){var t=this._scene.globe,n=t._surface._levelZeroTiles;if(Ze(n)){for(var r,i=n.length,o=0;o<i&&(r=n[o],!$n.contains(r.rectangle,e));++o);if(!(i<=o)){for(;r._lastSelectionResult===TileSelectionResult.REFINED;)r=gZ(r.southwestChild,e)||gZ(r.southeastChild,e)||gZ(r.northwestChild,e)||r.northeastChild;if(Ze(r.data)&&Ze(r.data.renderedMesh)){var a,s,u=t._surface._tileProvider.tilingScheme.ellipsoid,l=_t.fromRadians(e.longitude,e.latitude,0,u,pZ),c=_Z,h=u.geodeticSurfaceNormal(l,c.direction);Ze(u.getSurfaceNormalIntersectionWithZAxis(l,11500,c.origin))||(a=Math.min(defaultValue(r.data.minimumHeight,0),-11500),s=_t.multiplyByScalar(h,Math.abs(a)+1,dZ),_t.subtract(l,s,c.origin));var f=r.data.pick(c,void 0,void 0,!1,dZ);if(Ze(f)){var p=u.cartesianToCartographic(f,mZ).height;return p=p<0?0:p}}}}};var yZ=Object.freeze({NONE:0,LERC:1});function vZ(e,t){this._ellipsoid=e,this._cameraPosition=new _t,this._cameraPositionInScaledSpace=new _t,this._distanceToLimbInScaledSpaceSquared=0,Ze(t)&&(this.cameraPosition=t)}Object.defineProperties(vZ.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){var t=this._ellipsoid.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),n=_t.magnitudeSquared(t)-1;_t.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=t,this._distanceToLimbInScaledSpaceSquared=n}}});var xZ=new _t;vZ.prototype.isPointVisible=function(e){return PZ(this._ellipsoid.transformPositionToScaledSpace(e,xZ),this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)},vZ.prototype.isScaledSpacePointVisible=function(e){return PZ(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var bZ=new _t;vZ.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(e,t){var n,r=this._ellipsoid,i=Ze(t)&&t<0&&r.minimumRadius>-t?((n=bZ).x=this._cameraPosition.x/(r.radii.x+t),n.y=this._cameraPosition.y/(r.radii.y+t),n.z=this._cameraPosition.z/(r.radii.z+t),n.x*n.x+n.y*n.y+n.z*n.z-1):(n=this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared);return PZ(e,n,i)},vZ.prototype.computeHorizonCullingPoint=function(e,t,n){return wZ(this._ellipsoid,e,t,n)};var EZ=Wn.clone(Wn.UNIT_SPHERE);vZ.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,n,r){return wZ(CZ(this._ellipsoid,n,EZ),e,t,r)},vZ.prototype.computeHorizonCullingPointFromVertices=function(e,t,n,r,i){return IZ(this._ellipsoid,e,t,n,r,i)},vZ.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,n,r,i,o){return IZ(CZ(this._ellipsoid,i,EZ),e,t,n,r,o)};var TZ=[];vZ.prototype.computeHorizonCullingPointFromRectangle=function(e,t,n){var r=$n.subsample(e,t,0,TZ),i=ko.fromPoints(r);if(!(_t.magnitude(i.center)<.1*t.minimumRadius))return this.computeHorizonCullingPoint(i.center,r,n)};var SZ=new _t;function CZ(e,t,n){var r;return Ze(t)&&t<0&&e.minimumRadius>-t&&(r=_t.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,SZ),e=Wn.fromCartesian3(r,n)),e}function wZ(e,t,n,r){Ze(r)||(r=new _t);for(var i=MZ(e,t),o=0,a=0,s=n.length;a<s;++a){var u=NZ(e,n[a],i);if(u<0)return;o=Math.max(o,u)}return RZ(i,o,r)}var AZ=new _t;function IZ(e,t,n,r,i,o){Ze(o)||(o=new _t),r=Je(r,3),i=Je(i,_t.ZERO);for(var a=MZ(e,t),s=0,u=0,l=n.length;u<l;u+=r){AZ.x=n[u]+i.x,AZ.y=n[u+1]+i.y,AZ.z=n[u+2]+i.z;var c=NZ(e,AZ,a);if(c<0)return;s=Math.max(s,c)}return RZ(a,s,o)}function PZ(e,t,n){var r=t,i=n,o=_t.subtract(e,r,xZ),a=-_t.dot(o,r);return!(i<0?0<a:i<a&&a*a/_t.magnitudeSquared(o)>i)}var OZ=new _t,LZ=new _t;function NZ(e,t,n){var r=e.transformPositionToScaledSpace(t,OZ),i=_t.magnitudeSquared(r),o=Math.sqrt(i),a=_t.divideByScalar(r,o,LZ),i=Math.max(1,i),s=1/(o=Math.max(1,o));return 1/(_t.dot(a,n)*s-_t.magnitude(_t.cross(a,n,a))*(Math.sqrt(i-1)*s))}function RZ(e,t,n){if(!(t<=0||t===1/0||t!=t))return _t.multiplyByScalar(e,t,n)}var DZ=new _t;function MZ(e,t){return _t.equals(t,_t.ZERO)?t:(e.transformPositionToScaledSpace(t,DZ),_t.normalize(DZ,DZ))}var FZ=Object.freeze({NONE:0,BITS12:1}),zZ=new _t,BZ=new _t,UZ=new En,VZ=new on,kZ=new on,GZ=Math.pow(2,12);function qZ(e,t,n,r,i,o){var a,s,u,l,c,h,f,p,d,m,_,g,y=FZ.NONE;Ze(e)&&Ze(t)&&Ze(n)&&Ze(r)&&(s=e.minimum,u=e.maximum,l=_t.subtract(u,s,BZ),c=n-t,y=Math.max(_t.maximumComponent(l),c)<GZ-1?FZ.BITS12:FZ.NONE,h=e.center,f=on.inverseTransformation(r,new on),p=_t.negate(s,zZ),on.multiply(on.fromTranslation(p,VZ),f,f),(d=zZ).x=1/l.x,d.y=1/l.y,d.z=1/l.z,on.multiply(on.fromScale(d,VZ),f,f),a=on.clone(r),on.setTranslation(a,_t.ZERO,a),r=on.clone(r,new on),m=on.fromTranslation(s,VZ),_=on.fromScale(l,kZ),g=on.multiply(m,_,VZ),on.multiply(r,g,r),on.multiply(a,g,a)),this.quantization=y,this.minimumHeight=t,this.maximumHeight=n,this.center=h,this.toScaledENU=f,this.fromScaledENU=r,this.matrix=a,this.hasVertexNormals=i,this.hasWebMercatorT=Je(o,!1)}qZ.prototype.encode=function(e,t,n,r,i,o,a){var s,u,l,c,h,f,p=r.x,d=r.y;return this.quantization===FZ.BITS12?((n=on.multiplyByPoint(this.toScaledENU,n,zZ)).x=pt.clamp(n.x,0,1),n.y=pt.clamp(n.y,0,1),n.z=pt.clamp(n.z,0,1),s=this.maximumHeight-this.minimumHeight,u=pt.clamp((i-this.minimumHeight)/s,0,1),En.fromElements(n.x,n.y,UZ),l=Hf.compressTextureCoordinates(UZ),En.fromElements(n.z,u,UZ),c=Hf.compressTextureCoordinates(UZ),En.fromElements(p,d,UZ),h=Hf.compressTextureCoordinates(UZ),e[t++]=l,e[t++]=c,e[t++]=h,this.hasWebMercatorT&&(En.fromElements(a,0,UZ),f=Hf.compressTextureCoordinates(UZ),e[t++]=f)):(_t.subtract(n,this.center,zZ),e[t++]=zZ.x,e[t++]=zZ.y,e[t++]=zZ.z,e[t++]=i,e[t++]=p,e[t++]=d,this.hasWebMercatorT&&(e[t++]=a)),this.hasVertexNormals&&(e[t++]=Hf.octPackFloat(o)),t},qZ.prototype.decodePosition=function(e,t,n){if(Ze(n)||(n=new _t),t*=this.getStride(),this.quantization!==FZ.BITS12)return n.x=e[t],n.y=e[t+1],n.z=e[t+2],_t.add(n,this.center,n);var r=Hf.decompressTextureCoordinates(e[t],UZ);n.x=r.x,n.y=r.y;var i=Hf.decompressTextureCoordinates(e[t+1],UZ);return n.z=i.x,on.multiplyByPoint(this.fromScaledENU,n,n)},qZ.prototype.decodeTextureCoordinates=function(e,t,n){return Ze(n)||(n=new En),t*=this.getStride(),this.quantization===FZ.BITS12?Hf.decompressTextureCoordinates(e[t+2],n):En.fromElements(e[t+4],e[t+5],n)},qZ.prototype.decodeHeight=function(e,t){return t*=this.getStride(),this.quantization!==FZ.BITS12?e[t+3]:Hf.decompressTextureCoordinates(e[t+1],UZ).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight},qZ.prototype.decodeWebMercatorT=function(e,t){return t*=this.getStride(),this.quantization===FZ.BITS12?Hf.decompressTextureCoordinates(e[t+3],UZ).x:e[t+6]},qZ.prototype.getOctEncodedNormal=function(e,t,n){var r=e[t=(t+1)*this.getStride()-1]/256,i=Math.floor(r);return En.fromElements(i,256*(r-i),n)},qZ.prototype.getStride=function(){var e;switch(this.quantization){case FZ.BITS12:e=3;break;default:e=6}return this.hasWebMercatorT&&++e,this.hasVertexNormals&&++e,e};var HZ={position3DAndHeight:0,textureCoordAndEncodedNormals:1},WZ={compressed0:0,compressed1:1};qZ.prototype.getAttributes=function(e){var t,n=Mt.FLOAT,r=Mt.getSizeInBytes(n);if(this.quantization===FZ.NONE){var i=2;return this.hasWebMercatorT&&++i,this.hasVertexNormals&&++i,[{index:HZ.position3DAndHeight,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:4,offsetInBytes:0,strideInBytes:t=(4+i)*r},{index:HZ.textureCoordAndEncodedNormals,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:i,offsetInBytes:4*r,strideInBytes:t}]}var o=3,a=0;return(this.hasWebMercatorT||this.hasVertexNormals)&&++o,this.hasWebMercatorT&&this.hasVertexNormals?[{index:WZ.compressed0,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:o,offsetInBytes:0,strideInBytes:t=(o+ ++a)*r},{index:WZ.compressed1,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:a,offsetInBytes:o*r,strideInBytes:t}]:[{index:WZ.compressed0,vertexBuffer:e,componentDatatype:n,componentsPerAttribute:o}]},qZ.prototype.getAttributeLocations=function(){return this.quantization===FZ.NONE?HZ:WZ},qZ.clone=function(e,t){return Ze(t)||(t=new qZ),t.quantization=e.quantization,t.minimumHeight=e.minimumHeight,t.maximumHeight=e.maximumHeight,t.center=_t.clone(e.center),t.toScaledENU=on.clone(e.toScaledENU),t.fromScaledENU=on.clone(e.fromScaledENU),t.matrix=on.clone(e.matrix),t.hasVertexNormals=e.hasVertexNormals,t.hasWebMercatorT=e.hasWebMercatorT,t};var YZ={};YZ.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var XZ=new _t,jZ=new on,KZ=new _t,QZ=new _t;function ZZ(e,t,n,r,i,o,a,s,u,l,c,h,f,p,d,m,_){this.center=e,this.vertices=t,this.stride=Je(l,6),this.indices=n,this.indexCountWithoutSkirts=r,this.vertexCountWithoutSkirts=i,this.minimumHeight=o,this.maximumHeight=a,this.boundingSphere3D=s,this.occludeePointInScaledSpace=u,this.orientedBoundingBox=c,this.encoding=h,this.exaggeration=f,this.westIndicesSouthToNorth=p,this.southIndicesEastToWest=d,this.eastIndicesNorthToSouth=m,this.northIndicesWestToEast=_}function JZ(){fe.throwInstantiationError()}YZ.computeVertices=function(e){var t,n,r,i=Math.cos,o=Math.sin,a=Math.sqrt,s=Math.atan,u=Math.exp,l=pt.PI_OVER_TWO,c=pt.toRadians,h=e.isUpsample,f=e.heightmap,p=e.width,d=e.height,m=e.skirtHeight,_=Je(e.isGeographic,!0),g=Je(e.ellipsoid,Wn.WGS84),y=1/g.maximumRadius,v=e.nativeRectangle,x=e.rectangle,b=Ze(x)?(t=x.west,n=x.south,r=x.east,x.north):_?(t=c(v.west),n=c(v.south),r=c(v.east),c(v.north)):(t=v.west*y,n=l-2*s(u(-v.south*y)),r=v.east*y,l-2*s(u(-v.north*y))),E=Ze(T=e.relativeToCenter),T=E?T:_t.ZERO,S=Je(e.exaggeration,1),C=Je(e.includeWebMercatorT,!1),w=Je(e.structure,YZ.DEFAULT_STRUCTURE),A=Je(w.heightScale,YZ.DEFAULT_STRUCTURE.heightScale),I=Je(w.heightOffset,YZ.DEFAULT_STRUCTURE.heightOffset),P=Je(w.elementsPerHeight,YZ.DEFAULT_STRUCTURE.elementsPerHeight),O=Je(w.stride,YZ.DEFAULT_STRUCTURE.stride),L=Je(w.elementMultiplier,YZ.DEFAULT_STRUCTURE.elementMultiplier),N=Je(w.isBigEndian,YZ.DEFAULT_STRUCTURE.isBigEndian),R=$n.computeWidth(v),D=$n.computeHeight(v),M=R/(p-1),F=D/(d-1);_||(R*=y,D*=y);var z,B,U=g.radiiSquared,V=U.x,k=U.y,G=U.z,q=65536,H=-65536,W=bs.eastNorthUpToFixedFrame(T,g),Y=on.inverseTransformation(W,jZ);C&&(z=fg.geodeticLatitudeToMercatorAngle(n),B=1/(fg.geodeticLatitudeToMercatorAngle(b)-z));var X=KZ;X.x=Number.POSITIVE_INFINITY,X.y=Number.POSITIVE_INFINITY,X.z=Number.POSITIVE_INFINITY;var j=QZ;j.x=Number.NEGATIVE_INFINITY,j.y=Number.NEGATIVE_INFINITY,j.z=Number.NEGATIVE_INFINITY;var K=Number.POSITIVE_INFINITY,Q=p*d,Z=Q+(0<m?2*p+2*d:0),J=new Array(Z),$=new Array(Z),ee=new Array(Z),te=C?new Array(Z):[],ne=0,re=d,ie=0,oe=p;0<m&&(--ne,++re,--ie,++oe);_||(1.4844222297453322==x.north?x.north=l:-1.4844222297453324==x.south&&(x.south=-l),n=x.south,b=x.north);for(var ae=ne;ae<re;++ae){var se=ae;se<0&&(se=0),d<=se&&(se=d-1);var ue=v.north-F*se;_?ue=c(ue):1.4844222297453322==(ue=l-2*s(u(-ue*y)))?ue=l:-1.4844222297453324==ue&&(ue=-l);var le=(ue-n)/(b-n),le=pt.clamp(le,0,1),ce=ae===ne,he=ae===re-1;0<m&&(ce?ue+=1e-5*D:he&&(ue-=1e-5*D));var fe,pe=i(ue),de=o(ue),me=G*de;C&&(fe=(fg.geodeticLatitudeToMercatorAngle(ue)-z)*B);for(var _e=ie;_e<oe;++_e){var ge=_e;ge<0&&(ge=0),p<=ge&&(ge=p-1);var ye=se*(p*O)+ge*O;if(1===P)xe=f[ye];else{var ve,xe=0;if(N)for(ve=0;ve<P;++ve)xe=xe*L+f[ye+ve];else for(ve=P-1;0<=ve;--ve)xe=xe*L+f[ye+ve]}xe=(xe*A+I)*S,H=Math.max(H,xe),q=Math.min(q,xe);var be=v.west+M*ge;_?be=c(be):be*=y;var Ee=(be-t)/(r-t),Ee=pt.clamp(Ee,0,1),Te=se*p+ge;if(0<m){var Se=_e===ie,Ce=_e===oe-1,we=ce||he||Se||Ce;if((ce||he)&&(Se||Ce))continue;we&&(xe-=m,Se?(Te=d-se-1+Q,be-=1e-5*R):he?Te=Q+d+(p-ge-1):Ce?(Te=Q+d+p+se,be+=1e-5*R):ce&&(Te=Q+d+p+d+ge))}var Ae=pe*i(be),Ie=pe*o(be),Pe=V*Ae,Oe=k*Ie,Le=1/a(Pe*Ae+Oe*Ie+me*de),Ne=Pe*Le,Re=Oe*Le,De=me*Le,Me=Je(e.createdByUpsampling,!1),Fe=e.structure.terrainModifyInfoCollection;if(Ze(Fe)){for(var ze=Fe._array.length,Be=0;Be<ze;Be++){var Ue=Fe._array[Be],Ve=YZ.isPointInsidePolygon(Ue._points,ue,be),ke=Ue._terrainModifyType,Ge=Ue._value;!0===Ve&&(0!=ke||Me?1!=ke||Me?2==ke&&(xe=Ge):h||(xe+=Ge):h||(xe*=Ge))}H=Math.max(H,xe),q=Math.min(q,xe)}var qe=new _t;qe.x=Ne+Ae*xe,qe.y=Re+Ie*xe,qe.z=De+de*xe,J[Te]=qe,$[Te]=xe,ee[Te]=new En(Ee,le),C&&(te[Te]=fe),on.multiplyByPoint(Y,qe,XZ),_t.minimumByComponent(XZ,X,X),_t.maximumByComponent(XZ,j,j),K=Math.min(K,xe)}}var He,We,Ye=ko.fromPoints(J);Ze(x)&&(He=ab.fromRectangle(x,q,H,g)),E&&(We=new vZ(g).computeHorizonCullingPointPossiblyUnderEllipsoid(T,J,q));for(var Xe=new qZ(new Jx(X,j,T),K,H,W,!1,C),je=new Float32Array(Z*Xe.getStride()),Ke=0,Qe=0;Qe<Z;++Qe)Ke=Xe.encode(je,Ke,J[Qe],ee[Qe],$[Qe],void 0,te[Qe]);return{vertices:je,maximumHeight:H,minimumHeight:q,encoding:Xe,boundingSphere3D:Ye,orientedBoundingBox:He,occludeePointInScaledSpace:We}},YZ.isPointInsidePolygon=function(e,t,n){var r=e.length;if(r<=2)return!1;for(var i=!1,o=0,a=r-1;o<r;o++){var s=e[o],u=e[a];(s.latitude<t&&u.latitude>=t||u.latitude<t&&s.latitude>=t)&&s.longitude+(t-s.latitude)/(u.latitude-s.latitude)*(u.longitude-s.longitude)<n&&(i=!i),a=o}return i},Object.defineProperties(JZ.prototype,{errorEvent:{get:fe.throwInstantiationError},credit:{get:fe.throwInstantiationError},tilingScheme:{get:fe.throwInstantiationError},ready:{get:fe.throwInstantiationError},readyPromise:{get:fe.throwInstantiationError},hasWaterMask:{get:fe.throwInstantiationError},hasVertexNormals:{get:fe.throwInstantiationError},availability:{get:fe.throwInstantiationError}});var $Z=[];JZ.getRegularGridIndices=function(e,t){var n=$Z[e];Ze(n)||($Z[e]=n=[]);var r=n[t];return Ze(r)||rJ(e,t,r=e*t<pt.SIXTY_FOUR_KILOBYTES?n[t]=new Uint16Array((e-1)*(t-1)*6):n[t]=new Uint32Array((e-1)*(t-1)*6),0),r};var eJ=[];JZ.getRegularGridIndicesAndEdgeIndices=function(e,t){var n=eJ[e];Ze(n)||(eJ[e]=n=[]);var r,i,o,a,s,u,l=n[t];return Ze(l)||(r=JZ.getRegularGridIndices(e,t),o=(i=nJ(e,t)).westIndicesSouthToNorth,a=i.southIndicesEastToWest,s=i.eastIndicesNorthToSouth,u=i.northIndicesWestToEast,l=n[t]={indices:r,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:s,northIndicesWestToEast:u}),l};var tJ=[];function nJ(e,t){for(var n=new Array(t),r=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)r[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,n[a]=(t-a-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:r,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function rJ(e,t,n,r){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i+e,u=s+1,l=i+1;n[r++]=i,n[r++]=s,n[r++]=l,n[r++]=l,n[r++]=s,n[r++]=u,++i}++i}}function iJ(e,t,n,r){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];n[r++]=i,n[r++]=s,n[r++]=t,n[r++]=t,n[r++]=s,n[r++]=t+1,i=s,++t}return r}function oJ(e){this._isUpsample=e.isUpsample,this._buffer=e.buffer,this._width=e.width,this._height=e.height,this._childTileMask=Je(e.childTileMask,15),this._encoding=Je(e.encoding,yZ.NONE);var t=YZ.DEFAULT_STRUCTURE,n=e.structure;Ze(n)?n!==t&&(n.heightScale=Je(n.heightScale,t.heightScale),n.heightOffset=Je(n.heightOffset,t.heightOffset),n.elementsPerHeight=Je(n.elementsPerHeight,t.elementsPerHeight),n.stride=Je(n.stride,t.stride),n.elementMultiplier=Je(n.elementMultiplier,t.elementMultiplier),n.isBigEndian=Je(n.isBigEndian,t.isBigEndian)):n=t,this._structure=n,this._createdByUpsampling=Je(e.createdByUpsampling,!1),this._waterMask=e.waterMask,this._skirtHeight=void 0,this._bufferType=this._encoding===yZ.LERC?Float32Array:this._buffer.constructor,this._mesh=void 0,this._invalidHeightIndex=Je(e.invalidHeightIndex,[])}JZ.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var n=tJ[e];Ze(n)||(tJ[e]=n=[]);var r,i,o,a,s,u,l,c,h,f,p,d=n[t];return Ze(d)||(a=(r=e*t)+(o=2*e+2*t),s=(i=(e-1)*(t-1)*6)+6*Math.max(0,o-4),l=(u=nJ(e,t)).westIndicesSouthToNorth,c=u.southIndicesEastToWest,h=u.eastIndicesNorthToSouth,f=u.northIndicesWestToEast,rJ(e,t,p=wa.createTypedArray(a,s),0),JZ.addSkirtIndices(l,c,h,f,r,p,i),d=n[t]={indices:p,westIndicesSouthToNorth:l,southIndicesEastToWest:c,eastIndicesNorthToSouth:h,northIndicesWestToEast:f,indexCountWithoutSkirts:i}),d},JZ.addSkirtIndices=function(e,t,n,r,i,o,a){var s=i;a=iJ(e,s,o,a),a=iJ(t,s+=e.length,o,a),a=iJ(n,s+=t.length,o,a),iJ(r,s+=n.length,o,a)},JZ.heightmapTerrainQuality=.25,JZ.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,n){return 2*e.maximumRadius*Math.PI*JZ.heightmapTerrainQuality/(t*n)},JZ.prototype.requestTileGeometry=fe.throwInstantiationError,JZ.prototype.getLevelMaximumGeometricError=fe.throwInstantiationError,JZ.prototype.getTileDataAvailable=fe.throwInstantiationError,JZ.prototype.loadTileDataAvailability=fe.throwInstantiationError,Object.defineProperties(oJ.prototype,{credits:{get:function(){}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}}});var aJ=new Df("createVerticesFromHeightmap");function sJ(e,t,n,r,i,o,a,s,u,l){var c=(s-i.west)*(o-1)/(i.east-i.west),h=(u-i.south)*(a-1)/(i.north-i.south),f=0|c,p=f+1;o<=p&&(p=o-1,f=o-2),a<=(_=(m=0|h)+1)&&(_=a-1,m=a-2);var d=h-m,m=a-1-m,_=a-1-_;return uJ(c-f,d,(t.decodeHeight(e,m*o+f)/l-n)/r,(t.decodeHeight(e,m*o+p)/l-n)/r,(t.decodeHeight(e,_*o+f)/l-n)/r,(t.decodeHeight(e,_*o+p)/l-n)/r)}function uJ(e,t,n,r,i,o){return t<e?n+e*(r-n)+t*(o-r):n+e*(o-i)+t*(i-n)}function lJ(e,t,n,r,i,o){o*=r;var a,s=0;if(i)for(a=0;a<t;++a)s=s*n+e[o+a];else for(a=t-1;0<=a;--a)s=s*n+e[o+a];return s}function cJ(e,t,n,r,i,o,a,s){var u;if(a*=i,o)for(u=0;u<t-1;++u)e[a+u]=s/r|0,s-=e[a+u]*r,r/=n;else for(u=t-1;0<u;--u)e[a+u]=s/r|0,s-=e[a+u]*r,r/=n;e[a+u]=s}function hJ(e){e=Je(e,Je.EMPTY_OBJECT),this._errorEvent=new U,this._ready=!1,this._readyPromise=D.defer(),this._heightmapWidth=Je(e.heightMapWidth,65),this._terrainModifyInfoCollection=new Od,this._terrainDataStructure={heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:-2147483648,highestEncodedHeight:2147483647,terrainModifyInfoCollection:this._terrainModifyInfoCollection};var t=e.credit;"string"==typeof t&&(t=new Cf({text:t})),this._credit=t,this._heightmapWidth=Je(e.heightMapWidth,65),this._heightmapHeight=this._heightmapWidth,this._demLayerCollection=e.demLayerCollection,this._tilingScheme=this._demLayerCollection._tilingScheme,this._levelZeroMaximumGeometricError=JZ.getEstimatedLevelZeroGeometricErrorForAHeightmap(Wn.WGS84,this._heightmapHeight,this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0)}oJ.prototype.createMesh=function(e,t,n,r,i){var o=e.ellipsoid,a=e.tileXYToNativeRectangle(t,n,r),s=e.tileXYToRectangle(t,n,r);i=Je(i,1);var u,l=o.cartographicToCartesian($n.center(s)),c=this._structure,h=JZ.getEstimatedLevelZeroGeometricErrorForAHeightmap(o,this._width,e.getNumberOfXTilesAtLevel(0))/(1<<r);this._skirtHeight=Math.min(4*h,1e3),16<r&&r<24?(u=16*Math.ceil((r-16)/4),this._skirtHeight=Math.min(h*u,1e3)):24<=r&&(u=32*Math.ceil((r-16)/4),this._skirtHeight=Math.min(h*u,1e3));var f=aJ.scheduleTask({isUpsample:this._isUpsample,heightmap:this._buffer,structure:c,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:a,rectangle:s,relativeToCenter:l,ellipsoid:o,skirtHeight:this._skirtHeight,isGeographic:e.projection instanceof Zn,exaggeration:i,encoding:this._encoding});if(Ze(f)){var p=this;return D(f,function(e){var t=0<p._skirtHeight?JZ.getRegularGridAndSkirtIndicesAndEdgeIndices(e.gridWidth,e.gridHeight):JZ.getRegularGridIndicesAndEdgeIndices(e.gridWidth,e.gridHeight),n=e.gridWidth*e.gridHeight;return p._mesh=new ZZ(l,new Float32Array(e.vertices),t.indices,t.indexCountWithoutSkirts,n,e.minimumHeight,e.maximumHeight,ko.clone(e.boundingSphere3D),_t.clone(e.occludeePointInScaledSpace),e.numberOfAttributes,ab.clone(e.orientedBoundingBox),qZ.clone(e.encoding),i,t.westIndicesSouthToNorth,t.southIndicesEastToWest,t.eastIndicesNorthToSouth,t.northIndicesWestToEast),p._buffer=void 0,p._mesh})}},oJ.prototype._createMeshSync=function(e,t,n,r,i){var o=e.ellipsoid,a=e.tileXYToNativeRectangle(t,n,r),s=e.tileXYToRectangle(t,n,r);i=Je(i,1);var u,l=o.cartographicToCartesian($n.center(s)),c=this._structure,h=JZ.getEstimatedLevelZeroGeometricErrorForAHeightmap(o,this._width,e.getNumberOfXTilesAtLevel(0))/(1<<r);this._skirtHeight=Math.min(4*h,1e3),16<r&&r<24?(u=16*Math.ceil((r-16)/4),this._skirtHeight=Math.min(h*u,1e3)):24<=r&&(u=32*Math.ceil((r-16)/4),this._skirtHeight=Math.min(h*u,1e3));var f,p=YZ.computeVertices({heightmap:this._buffer,structure:c,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:a,rectangle:s,relativeToCenter:l,ellipsoid:o,skirtHeight:this._skirtHeight,isGeographic:e.projection instanceof Zn,exaggeration:i});this._buffer=void 0,f=0<this._skirtHeight?JZ.getRegularGridAndSkirtIndicesAndEdgeIndices(this._width,this._height):JZ.getRegularGridIndicesAndEdgeIndices(this._width,this._height);var d=p.gridWidth*p.gridHeight;return new ZZ(l,p.vertices,f.indices,f.indexCountWithoutSkirts,d,p.minimumHeight,p.maximumHeight,p.boundingSphere3D,p.occludeePointInScaledSpace,p.encoding.getStride(),p.orientedBoundingBox,p.encoding,i,f.westIndicesSouthToNorth,f.southIndicesEastToWest,f.eastIndicesNorthToSouth,f.northIndicesWestToEast)},oJ.prototype.interpolateHeight=function(e,t,n){var r=this._width,i=this._height,o=this._structure,a=o.stride,s=o.elementsPerHeight,u=o.elementMultiplier,l=o.isBigEndian,c=o.heightOffset,h=o.heightScale;return Ze(this._mesh)?sJ(this._mesh.vertices,this._mesh.encoding,c,h,e,r,i,t,n,this._mesh.exaggeration):function(e,t,n,r,i,o,a,s,u,l){var c=(u-o.west)*(a-1)/(o.east-o.west),h=(l-o.south)*(s-1)/(o.north-o.south),f=0|c,p=f+1;a<=p&&(p=a-1,f=a-2);var d=0|h,m=d+1;s<=m&&(m=s-1,d=s-2);var _=c-f,g=h-d;m=s-1-m;var y=lJ(e,t,n,r,i,(d=s-1-d)*a+f),v=lJ(e,t,n,r,i,d*a+p),x=lJ(e,t,n,r,i,m*a+f),b=lJ(e,t,n,r,i,m*a+p);return uJ(_,g,y,v,x,b)}(this._buffer,s,u,a,l,e,r,i,t,n)*h+c},oJ.prototype.upsample=function(e,t,n,r,i,o,a){var s=this._mesh;if(Ze(s)){for(var u=this._width,l=this._height,c=this._structure,h=c.stride,f=new this._bufferType(u*l*h),p=s.vertices,d=s.encoding,m=e.tileXYToRectangle(t,n,r),_=e.tileXYToRectangle(i,o,a),g=c.heightOffset,y=c.heightScale,v=s.exaggeration,x=c.elementsPerHeight,b=c.elementMultiplier,E=c.isBigEndian,T=Math.pow(b,x-1),S=0;S<l;++S)for(var C=pt.lerp(_.north,_.south,S/(l-1)),w=0;w<u;++w){var A=sJ(p,d,g,y,m,u,l,pt.lerp(_.west,_.east,w/(u-1)),C,v);cJ(f,x,b,T,h,E,S*u+w,A=(A=A<c.lowestEncodedHeight?c.lowestEncodedHeight:A)>c.highestEncodedHeight?c.highestEncodedHeight:A)}return new oJ({buffer:f,width:u,height:l,childTileMask:0,structure:this._structure,createdByUpsampling:!0,isUpsample:!0})}},oJ.prototype.isChildAvailable=function(e,t,n,r){var i=2;return n!==2*e&&++i,r!==2*t&&(i-=2),0!=(this._childTileMask&1<<i)},oJ.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling},Object.defineProperties(hJ.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},terrainModifyInfoCollection:{get:function(){return this._terrainModifyInfoCollection}},maxDataLevel:{get:function(){return this._demLayerCollection._maxLevel}},useIndexedDBCache:{get:function(){return this._useIndexedDBCache},set:function(e){this._useIndexedDBCache="boolean"==typeof e&&e}}}),hJ.prototype.getRequestTileGeometryUrlAndUpsampling=function(e,t,n,r){var i=n,o=t,a=e;this._tilingScheme instanceof xL?o=this._tilingScheme.getNumberOfYTilesAtLevel(n)-t-1:i++;var s=void 0,s=Ze(r)?r:this._demLayerCollection.getFitLayer(e,t,n);if(!Ze(s))return{url:void 0,createdByUpsampling:!1};s._tileSize,s._demType;var u=!1;return s._maxDataLevel<n&&(u=!0),{url:s._url+"/EV_WebService/get/globeservice/10000/GetDEMData/"+s._name+"/"+i+"/"+o+"/"+a,createdByUpsampling:u}},hJ.prototype.getFitLayers=function(e,t,n){return this._tilingScheme instanceof xL&&this._tilingScheme.getNumberOfYTilesAtLevel(n),this._demLayerCollection.getFitLayers(e,t,n)},hJ.prototype.createHeightmapTerrainData=function(e,t,n,r,i){var o=new oJ({buffer:e,width:this._heightmapWidth,height:this._heightmapWidth,childTileMask:pJ(this,n,r,t),structure:this._terrainDataStructure,createdByUpsampling:i}),a=this.tilingScheme.ellipsoid,s=JZ.getEstimatedLevelZeroGeometricErrorForAHeightmap(a,o._width,this.tilingScheme.getNumberOfXTilesAtLevel(0))/(1<<t);return o._skirtHeight=Math.min(64*s,1e3),o},hJ.prototype.requestTileGeometry=function(y,v,x,e,t){var n=x,r=v,i=y;this._tilingScheme instanceof xL?r=this._tilingScheme.getNumberOfYTilesAtLevel(x)-v-1:n++;var b=this,o=Ze(t)?t:this._demLayerCollection.getFitLayer(y,v,x);if(!Ze(o))return D(new Promise(function(e,t){e()}),function(){return new oJ({buffer:new Float32Array(289),width:17,height:17,childTileMask:pJ(b,y,v,x),structure:b._terrainDataStructure,createdByUpsampling:!1})});var E=o._tileSize,A=o._demType,T=o._maxDataLevel,a=o._url+"/EV_WebService/get/globeservice/10000/GetDEMData/"+o._name+"/"+n+"/"+r+"/"+i,s=rt.createIfNeeded(a).fetchArrayBuffer();return Ze(s)?(Ze(e)&&(e.url=a),D(s,function(e){if((!Ze(e)||0==e.byteLength)&&0!==x)return D.reject();var w,t,n=[],r=b._heightmapWidth*b._heightmapWidth;if("DEM_Byte"==A?(w=new Uint8Array(e),t=new Float32Array(r)):"DEM_UInt16"==A||"DEM_UInt"==A?(w=new Uint16Array(e),t=new Float32Array(r)):"DEM_Int16"==A||"DEM_Int"==A?(w=new Int16Array(e),t=new Float32Array(r)):"DEM_UInt32"==A?(w=new Uint32Array(e),t=new Float32Array(r)):"DEM_Int32"==A?(w=new Int32Array(e),t=new Float32Array(r)):"DEM_Float32"==A||"DEM_Float"==A?(w=new Float32Array(e),t=new Float32Array(r)):"DEM_Float64"!=A&&"DEM_Double"!=A||(w=new Float64Array(e),t=new Float64Array(r)),E==b._heightmapWidth)for(var i=0;i<b._heightmapWidth;++i)for(var o=0;o<b._heightmapWidth;++o){var a=i*b._heightmapWidth+o;!isNaN(w[a])&&w[a]<9999&&-2e4<w[a]?t[a]=w[a]:n.push(a)}else{var s=0,u=0,l=b._tilingScheme.tileXYToRectangle(y,v,x),c=pt.toDegrees(l.west),h=pt.toDegrees(l.south),f=pt.toDegrees(l.east),p=pt.toDegrees(l.north),d=!1;T<x&&(d=!0);for(var m=(p-h)/(b._heightmapWidth-1),_=(f-c)/(b._heightmapWidth-1),i=0;i<b._heightmapWidth;++i){s=i==b._heightmapWidth-1?h:p-i*m;for(o=0;o<b._heightmapWidth;++o){180<(u=o==b._heightmapWidth-1?f:c+o*_)?u-=360:u<-180&&(u=360+u),90<s?s=180-s:s<-90&&(s=-s-180);var a=i*b._heightmapWidth+o,g=function(e,t,n,r,i,o,a){if(!w||0===w.length)return 0;var s=(n-e)*(a-1)/(n-i),u=(t-r)*(a-1)/(o-r),l=Math.floor(s),c=Math.ceil(s),h=Math.floor(u);a<=l&&(l=a-1),a<=c&&(c=a-1),a<=h&&(h=a-1);var f=s-l,p=l*a+h,d=p+1,m=c*a+h,_=m+1;0<w.length&&p>=w.length&&(p=w.length-1),0<w.length&&d>=w.length&&(d=w.length-1),0<w.length&&m>=w.length&&(m=w.length-1),0<w.length&&_>=w.length&&(_=w.length-1);var g=0,y=0,v=w.byteLength,x=!0,b=0;"DEM_Float32"!=A&&"DEM_Float"!=A||(v<4*p||v<4*m||v<4*d||v<4*_)&&(x=!1);var E=w[p];x&&!mJ(E)&&(x=!1);var T=w[m];x&&!mJ(T)&&(x=!1);var S=w[d];x&&!mJ(S)&&(x=!1);var C=w[_];return x&&!mJ(C)&&(x=!1),x&&(g=E*(1-f)+T*f,y=S*(1-f)+C*f),1e5<Math.abs(g)&&(x=!1),1e5<Math.abs(y)&&(x=!1),x&&(b=g*(1-(f=u-h))+y*f),b}(s,u,p,c,h,f,E);isNaN(g)||(t[a]=g)}}}return t&&0<t.length?new oJ({buffer:t,width:b._heightmapWidth,height:b._heightmapWidth,childTileMask:pJ(b,y,v,x),structure:b._terrainDataStructure,createdByUpsampling:d,invalidHeightIndex:n}):new oJ({buffer:new Float32Array(r),width:b._heightmapWidth,height:b._heightmapWidth,childTileMask:pJ(b,y,v,x),structure:b._terrainDataStructure,createdByUpsampling:d})})):void 0},hJ.prototype.getLevelMaximumGeometricError=function(e){return this._levelZeroMaximumGeometricError/(1<<e)};var fJ=new $n;function pJ(e,t,n,r){var i=e._tilingScheme,o=e._demLayerCollection.getRectangles(),a=i.tileXYToRectangle(t,n,r),s=15;if(r>e._demLayerCollection._maxLevel-1)return 0;for(var u=0;u<o.length&&15!==s;++u){var l,c=o[u];c.maxLevel<=r||(l=c.rectangle,Ze($n.intersection(l,a,fJ))&&(dJ(i,l,2*t,2*n,r+1)&&(s|=4),dJ(i,l,2*t+1,2*n,r+1)&&(s|=8),dJ(i,l,2*t,2*n+1,r+1)&&(s|=1),dJ(i,l,2*t+1,2*n+1,r+1)&&(s|=2)))}return s}function dJ(e,t,n,r,i){var o=e.tileXYToRectangle(n,r,i);return Ze($n.intersection(o,t,fJ))}function mJ(e){return 1e-4<Math.abs(Math.abs(e)-9999)}hJ.prototype.getTileDataAvailable=function(e,t,n){return this._demLayerCollection.isTileDataAvailable(e,t,n)},hJ.prototype.addTerrainModifyInfo=function(e){if(!(Ze(e)&&Ze(e.name)&&Ze(e.terrainModifyType)&&Ze(e.points)&&Ze(e.value)))throw new fe("terrainModifyInfo name,terrainModifyType,polygonGraphics,value is required.");return this._terrainModifyInfoCollection.contains(e.name)?(console.log("地形修改名称已经存在"),!1):(this._terrainModifyInfoCollection.set(e.name,e),!0)},hJ.prototype.containsTerrainModifyInfo=function(e){return this._terrainModifyInfoCollection.contains(e)},hJ.prototype.removeTerrainModifyInfo=function(e){this._terrainModifyInfoCollection.contains(e)&&this._terrainModifyInfoCollection.remove(e)},hJ.prototype.removeAllTerrainModifyInfo=function(){this._terrainModifyInfoCollection.removeAll()},hJ.prototype.getTerrainModifyInfo=function(e){return this._terrainModifyInfoCollection.contains(e)?this._terrainModifyInfoCollection.get(e):null};e.Batched3DModel3DTileContent=qx,e.Cesium3DTile=rL,e.Cesium3DTileContentFactory=BI,e.Cesium3DTileset=HL,e.EV_E3MLayer=ON,e.EV_E3mLayerManager=RK,e.EV_SelectorEventHandler=rZ,e.EarthViewTerrainProvider=hJ,e.Instanced3DModel3DTileContent=RE,e.Model=av,e.ModelInstanceCollection=xE,e.Resource=rt,e.TerrainLayer=fZ,e.TerrainLayerCollection=lZ,e.VERSION="1.69",e.Vector3DTileContent=MI,e.Vector3DTilePolylines=wI,e.createTerrainProvider=function(e){var t=new lZ;t._tilingScheme=new uZ;var n=new fZ({name:e.name,url:e.url}),r=t.addDEMLayer(n);Ze(r)&&r.readyPromise.then(function(){i._heightmapWidth=Je(r._heightMapWidth,65),i._demLayerCollection=t,i._tilingScheme=t._tilingScheme,i._levelZeroMaximumGeometricError=JZ.getEstimatedLevelZeroGeometricErrorForAHeightmap(Wn.WGS84,i._heightmapWidth,i._tilingScheme.getNumberOfXTilesAtLevel(0))});var i=new hJ({demLayerCollection:t});return i},Object.defineProperty(e,"__esModule",{value:!0})});
