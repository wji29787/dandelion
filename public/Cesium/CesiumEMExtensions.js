!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).CesiumEMExtensions={})}(this,function(e){"use strict";function oe(e){return null!=e}function x(e){var t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(e){t=e.stack}this.stack=t}function o(e){var t;e instanceof o?(this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment):e&&(t=i.exec(e),this.scheme=t[1],this.authority=t[2],this.path=t[3],this.query=t[4],this.fragment=t[5])}oe(Object.create)&&((x.prototype=Object.create(Error.prototype)).constructor=x),x.prototype.toString=function(){var e=this.name+": "+this.message;return oe(this.stack)&&(e+="\n"+this.stack.toString()),e},x.throwInstantiationError=function(){throw new x("This function defines an interface and should not be called directly.")},o.prototype.scheme=null,o.prototype.authority=null,o.prototype.path="",o.prototype.query=null,o.prototype.fragment=null;var i=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");o.prototype.getScheme=function(){return this.scheme},o.prototype.getAuthority=function(){return this.authority},o.prototype.getPath=function(){return this.path},o.prototype.getQuery=function(){return this.query},o.prototype.getFragment=function(){return this.fragment},o.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},o.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},o.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},o.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(u,m).replace(t,l)),this.path&&(this.path=this.path.replace(t,l)),this.query&&(this.query=this.query.replace(t,l)),this.fragment&&(this.fragment=this.fragment.replace(t,l))};var n,r,c,t=/%[0-9a-z]{2}/gi,s=/[a-zA-Z0-9\-\._~]/,u=/(.*@)?([^@:]*)(:.*)?/;function l(e){var t=unescape(e);return s.test(t)?t:e.toUpperCase()}function m(e,t,i,n){return(t||"")+i.toLowerCase()+(n||"")}function z(e,t){return null!=e?e:t}function d(e,t){var i;return"undefined"!=typeof document&&(i=document),d._implementation(e,t,i)}function C(e,t,i,n){return h(e).then(t,i,n)}function h(e){var t,i,n=e instanceof f?e:_(e)?(t=g(),e.then(function(e){t.resolve(e)},function(e){t.reject(e)},function(e){t.progress(e)}),t.promise):(i=e,new f(function(e){try{return h(e?e(i):i)}catch(e){return p(e)}}));return n}function f(e){this.then=e}function p(i){return new f(function(e,t){try{return t?h(t(i)):p(i)}catch(e){return p(e)}})}function g(){var e=new f(r),o=[],s=[],n=function(t,i,n){var r=g(),a="function"==typeof n?function(e){try{r.progress(n(e))}catch(e){r.progress(e)}}:function(e){r.progress(e)};return o.push(function(e){e.then(t,i).then(r.resolve,r.reject,a)}),s.push(a),r.promise},t=function(e){return w(s,e),e},i=function(e){return e=h(e),n=e.then,i=h,t=E,w(o,e),s=o=c,e};return{then:r,resolve:a,reject:u,progress:l,promise:e,resolver:{resolve:a,reject:u,progress:l}};function r(e,t,i){return n(e,t,i)}function a(e){return i(e)}function u(e){return i(p(e))}function l(e){return t(e)}}function _(e){return e&&"function"==typeof e.then}function v(e,h,f,p,_){return A(2,arguments),C(e,function(e){var t,i,n,r,a=e.length>>>0,o=Math.max(0,Math.min(h,a)),s=[],u=a-o+1,l=[],c=g();if(o)for(n=c.progress,i=function(e){l.push(e),--u||(t=i=E,c.reject(l))},t=function(e){s.push(e),--o||(t=i=E,c.resolve(s))},r=0;r<a;++r)r in e&&C(e[r],d,m,n);else c.resolve(s);return c.then(f,p,_);function m(e){i(e)}function d(e){t(e)}})}function y(e,t,i,n){return A(1,arguments),T(e,S).then(t,i,n)}function T(e,s){return C(e,function(e){var t,i,n,r=t=e.length>>>0,a=[],o=g();if(r)for(i=function(e,t){C(e,s).then(function(e){a[t]=e,--r||o.resolve(a)},o.reject)},n=0;n<t;n++)n in e?i(e[n],n):--r;else o.resolve(a);return o.promise})}function w(e,t){for(var i,n=0;i=e[n++];)i(t)}function A(e,t){for(var i,n=t.length;e<n;)if(null!=(i=t[--n])&&"function"!=typeof i)throw new Error("arg "+n+" must be a function")}function E(){}function S(e){return e}function b(e){return 0!==e.length&&"/"===e[e.length-1]||(e+="/"),e}o.prototype.resolve=function(e){var t=new o;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?t.path=this.path:e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments(),t.query=this.query))),t.fragment=this.fragment,t},o.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),i=[],n=""==t[0];n&&t.shift();for(""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?i.pop():"."!=e&&i.push(e);"."!=e&&".."!=e||i.push(""),n&&i.unshift(""),this.path=i.join("/")},o.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},z.EMPTY_OBJECT=Object.freeze({}),d._implementation=function(e,t,i){if(!oe(t)){if(void 0===i)return e;t=z(i.baseURI,i.location.href)}var n=new o(t);return new o(e).resolve(n).toString()},C.defer=g,C.resolve=h,C.reject=function(e){return C(e,p)},C.join=function(){return T(arguments,S)},C.all=y,C.map=T,C.reduce=function(e,a){var t=r.call(arguments,1);return C(e,function(e){var r=e.length;return t[0]=function(e,i,n){return C(e,function(t){return C(i,function(e){return a(t,e,n,r)})})},n.apply(e,t)})},C.any=function(e,t,i,n){return v(e,1,function(e){return t?t(e[0]):e[0]},i,n)},C.some=v,C.chain=function(e,t,i){var n=2<arguments.length;return C(e,function(e){return e=n?i:e,t.resolve(e),e},function(e){return t.reject(e),p(e)},t.progress)},C.isPromise=_,f.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(c,e)},yield:function(e){return this.then(function(){return e})},spread:function(t){return this.then(function(e){return y(e,function(e){return t.apply(c,e)})})}},r=[].slice,n=[].reduce||function(e){var t,i=0,n=Object(this),r=n.length>>>0,a=arguments;if(a.length<=1)for(;;){if(i in n){t=n[i++];break}if(++i>=r)throw new TypeError}else t=a[1];for(;i<r;++i)i in n&&(t=e(t,n[i],i,n));return t};var M={};function R(e,t,i){return"Expected "+i+" to be typeof "+t+", actual typeof was "+e}function D(e,t){if(null===e||"object"!=typeof e)return e;t=z(t,!1);var i,n=new e.constructor;for(var r in e){e.hasOwnProperty(r)&&(i=e[r],t&&(i=D(i,t)),n[r]=i)}return n}function P(e,t,i){i=z(i,!1);var n,r,a,o={},s=oe(e),u=oe(t);if(s)for(n in e)e.hasOwnProperty(n)&&(r=e[n],u&&i&&"object"==typeof r&&t.hasOwnProperty(n)?(a=t[n],o[n]="object"==typeof a?P(r,a,i):r):o[n]=r);if(u)for(n in t)t.hasOwnProperty(n)&&!o.hasOwnProperty(n)&&(a=t[n],o[n]=a);return o}M.typeOf={},M.defined=function(e,t){if(!oe(t))throw new x(e+" is required, actual value was undefined")},M.typeOf.func=function(e,t){if("function"!=typeof t)throw new x(R(typeof t,"function",e))},M.typeOf.string=function(e,t){if("string"!=typeof t)throw new x(R(typeof t,"string",e))},M.typeOf.number=function(e,t){if("number"!=typeof t)throw new x(R(typeof t,"number",e))},M.typeOf.number.lessThan=function(e,t,i){if(M.typeOf.number(e,t),i<=t)throw new x("Expected "+e+" to be less than "+i+", actual value was "+t)},M.typeOf.number.lessThanOrEquals=function(e,t,i){if(M.typeOf.number(e,t),i<t)throw new x("Expected "+e+" to be less than or equal to "+i+", actual value was "+t)},M.typeOf.number.greaterThan=function(e,t,i){if(M.typeOf.number(e,t),t<=i)throw new x("Expected "+e+" to be greater than "+i+", actual value was "+t)},M.typeOf.number.greaterThanOrEquals=function(e,t,i){if(M.typeOf.number(e,t),t<i)throw new x("Expected "+e+" to be greater than or equal to"+i+", actual value was "+t)},M.typeOf.object=function(e,t){if("object"!=typeof t)throw new x(R(typeof t,"object",e))},M.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new x(R(typeof t,"boolean",e))},M.typeOf.number.equals=function(e,t,i,n){if(M.typeOf.number(e,i),M.typeOf.number(t,n),i!==n)throw new x(e+" must be equal to "+t+", the actual values are "+i+" and "+n)};var I,O=/^blob:/i;function L(e){return O.test(e)}function N(e){oe(I)||(I=document.createElement("a")),I.href=window.location.href;var t=I.host,i=I.protocol;return I.href=e,I.href=I.href,i!==I.protocol||t!==I.host}var B=/^data:/i;function F(e){return B.test(e)}function V(e){var t={};if(""===e)return t;for(var i=e.replace(/\+/g,"%20").split(/[&;]/),n=0,r=i.length;n<r;++n){var a=i[n].split("="),o=decodeURIComponent(a[0]),s=oe(s=a[1])?decodeURIComponent(s):"",u=t[o];"string"==typeof u?t[o]=[u,s]:Array.isArray(u)?u.push(s):t[o]=s}return t}var U=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),G=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3});function k(e){e=z(e,z.EMPTY_OBJECT);var t=z(e.throttleByServer,!1),i=z(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=z(e.priority,0),this.throttle=i,this.throttleByServer=t,this.type=z(e.type,G.OTHER),this.serverKey=void 0,this.state=U.UNISSUED,this.deferred=void 0,this.cancelled=!1}function H(e,t,i){this.statusCode=e,this.response=t,this.responseHeaders=i,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var i=e.split("\r\n"),n=0;n<i.length;++n){var r,a,o=i[n],s=o.indexOf(": ");0<s&&(r=o.substring(0,s),a=o.substring(s+2),t[r]=a)}return t}(this.responseHeaders))}function W(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function q(e,t){return t-e}function j(e){this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function Y(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}k.prototype.cancel=function(){this.cancelled=!0},k.prototype.clone=function(e){return oe(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new k(this)},H.prototype.toString=function(){var e="Request has failed.";return oe(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e},Object.defineProperties(W.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),W.prototype.addEventListener=function(e,t){this._listeners.push(e),this._scopes.push(t);var i=this;return function(){i.removeEventListener(e,t)}},W.prototype.removeEventListener=function(e,t){for(var i=this._listeners,n=this._scopes,r=-1,a=0;a<i.length;a++)if(i[a]===e&&n[a]===t){r=a;break}return-1!==r&&(this._insideRaiseEvent?(this._toRemove.push(r),i[r]=void 0,n[r]=void 0):(i.splice(r,1),n.splice(r,1)),!0)},W.prototype.raiseEvent=function(){this._insideRaiseEvent=!0;for(var e=this._listeners,t=this._scopes,i=e.length,n=0;n<i;n++){oe(e[n])&&e[n].apply(t[n],arguments)}var r=this._toRemove;if(0<(i=r.length)){for(r.sort(q),n=0;n<i;n++){var a=r[n];e.splice(a,1),t.splice(a,1)}r.length=0}this._insideRaiseEvent=!1},Object.defineProperties(j.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){this._maximumLength=e,this._length>e&&0<e&&(this._length=e,this._array.length=e)}},comparator:{get:function(){return this._comparator}}}),j.prototype.reserve=function(e){e=z(e,this._length),this._array.length=e},j.prototype.heapify=function(e){e=z(e,0);for(var t=this._length,i=this._comparator,n=this._array,r=-1,a=!0;a;){var o=2*(e+1),s=o-1,r=s<t&&i(n[s],n[e])<0?s:e;o<t&&i(n[o],n[r])<0&&(r=o),r!==e?(Y(n,r,e),e=r):a=!1}},j.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);0<=t;--t)this.heapify(t)},j.prototype.insert=function(e){var t,i=this._array,n=this._comparator,r=this._maximumLength,a=this._length++;for(a<i.length?i[a]=e:i.push(e);0!==a;){var o=Math.floor((a-1)/2);if(!(n(i[a],i[o])<0))break;Y(i,a,o),a=o}return oe(r)&&this._length>r&&(t=i[r],this._length=r),t},j.prototype.pop=function(e){if(e=z(e,0),0!==this._length){var t=this._array,i=t[e];return Y(t,e,--this._length),this.heapify(e),i}};var X={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},K=2e4,Z=new j({comparator:function(e,t){return e.priority-t.priority}});Z.maximumLength=K,Z.reserve(K);var J=[],Q={},$="undefined"!=typeof document?new o(document.location.href):new o,ee=new W;function te(){}function ie(e){oe(e.priorityFunction)&&(e.priority=e.priorityFunction())}function ne(e){var t=z(te.requestsByServer[e],te.maximumRequestsPerServer);return Q[e]<t}function re(e){return e.state===U.UNISSUED&&(e.state=U.ISSUED,e.deferred=C.defer()),e.deferred.promise}function ae(e){var t,i,n=re(e);return e.state=U.ACTIVE,J.push(e),++X.numberOfActiveRequests,++X.numberOfActiveRequestsEver,++Q[e.serverKey],e.requestFunction().then((i=e,function(e){i.state!==U.CANCELLED&&(--X.numberOfActiveRequests,--Q[i.serverKey],ee.raiseEvent(),i.state=U.RECEIVED,i.deferred.resolve(e))})).otherwise((t=e,function(e){t.state!==U.CANCELLED&&(++X.numberOfFailedRequests,--X.numberOfActiveRequests,--Q[t.serverKey],ee.raiseEvent(e),t.state=U.FAILED,t.deferred.reject(e))})),n}function se(e){var t=e.state===U.ACTIVE;e.state=U.CANCELLED,++X.numberOfCancelledRequests,e.deferred.reject(),t&&(--X.numberOfActiveRequests,--Q[e.serverKey],++X.numberOfCancelledActiveRequests),oe(e.cancelFunction)&&e.cancelFunction()}function ue(e){var t;this.name="RuntimeError",this.message=e;try{throw new Error}catch(e){t=e.stack}this.stack=t}te.maximumRequests=5e4,te.maximumRequestsPerServer=6e3,te.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},te.throttleRequests=!0,te.debugShowStatistics=!1,te.requestCompletedEvent=ee,Object.defineProperties(te,{statistics:{get:function(){return X}},priorityHeapLength:{get:function(){return K},set:function(e){if(e<K)for(;Z.length>e;){se(Z.pop())}K=e,Z.maximumLength=e,Z.reserve(e)}}}),te.update=function(){for(var e,t=0,i=J.length,n=0;n<i;++n)(e=J[n]).cancelled&&se(e),e.state===U.ACTIVE?0<t&&(J[n-t]=e):++t;J.length-=t;var r=Z.internalArray,a=Z.length;for(n=0;n<a;++n)ie(r[n]);Z.resort();for(var o=Math.max(te.maximumRequests-J.length,0),s=0;s<o&&0<Z.length;)!(e=Z.pop()).cancelled&&(!e.throttleByServer||ne(e.serverKey))?(ae(e),++s):se(e);!function(){if(!te.debugShowStatistics)return;0===X.numberOfActiveRequests&&0<X.lastNumberOfActiveRequests&&(0<X.numberOfAttemptedRequests&&(console.log("Number of attempted requests: "+X.numberOfAttemptedRequests),X.numberOfAttemptedRequests=0),0<X.numberOfCancelledRequests&&(console.log("Number of cancelled requests: "+X.numberOfCancelledRequests),X.numberOfCancelledRequests=0),0<X.numberOfCancelledActiveRequests&&(console.log("Number of cancelled active requests: "+X.numberOfCancelledActiveRequests),X.numberOfCancelledActiveRequests=0),0<X.numberOfFailedRequests&&(console.log("Number of failed requests: "+X.numberOfFailedRequests),X.numberOfFailedRequests=0));X.lastNumberOfActiveRequests=X.numberOfActiveRequests}()},te.getServerKey=function(e){var t=new o(e).resolve($);t.normalize();var i=t.authority;return/:/.test(i)||(i=i+":"+("https"===t.scheme?"443":"80")),oe(Q[i])||(Q[i]=0),i},te.request=function(e){if(F(e.url)||L(e.url))return ee.raiseEvent(),e.state=U.RECEIVED,e.requestFunction();if(++X.numberOfAttemptedRequests,oe(e.serverKey)||(e.serverKey=te.getServerKey(e.url)),!te.throttleRequests||!e.throttleByServer||ne(e.serverKey)){if(!te.throttleRequests||!e.throttle)return ae(e);if(!(J.length>=te.maximumRequests)){ie(e);var t=Z.insert(e);if(oe(t)){if(t===e)return;se(t)}return re(e)}}},te.clearForSpecs=function(){for(;0<Z.length;){se(Z.pop())}for(var e=J.length,t=0;t<e;++t)se(J[t]);J.length=0,Q={},X.numberOfAttemptedRequests=0,X.numberOfActiveRequests=0,X.numberOfCancelledRequests=0,X.numberOfCancelledActiveRequests=0,X.numberOfFailedRequests=0,X.numberOfActiveRequestsEver=0,X.lastNumberOfActiveRequests=0},te.numberOfActiveRequestsByServer=function(e){return Q[e]},te.requestHeap=Z,oe(Object.create)&&((ue.prototype=Object.create(Error.prototype)).constructor=ue),ue.prototype.toString=function(){var e=this.name+": "+this.message;return oe(this.stack)&&(e+="\n"+this.stack.toString()),e};var le,ce={},me={};ce.add=function(e,t){var i=e.toLowerCase()+":"+t;oe(me[i])||(me[i]=!0)},ce.remove=function(e,t){var i=e.toLowerCase()+":"+t;oe(me[i])&&delete me[i]},ce.contains=function(e){var t=function(e){var t=new o(e);t.normalize();var i=t.getAuthority();if(oe(i)){if(-1!==i.indexOf("@")&&(i=i.split("@")[1]),-1===i.indexOf(":")){var n=t.getScheme();if(oe(n)||(n=(n=window.location.protocol).substring(0,n.length-1)),"http"===n)i+=":80";else{if("https"!==n)return;i+=":443"}}return i}}(e);return!(!oe(t)||!oe(me[t]))},ce.clear=function(){me={}};var de,he,fe,pe,_e,Ce,ge,ve,ye,Te,xe,we,Ae,Ee,Se,be,Me,Re={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},De={};function Pe(e){for(var t=e.split("."),i=0,n=t.length;i<n;++i)t[i]=parseInt(t[i],10);return t}function Ie(){var e;return oe(he)||(he=!1,Be()||null!==(e=/ Chrome\/([\.0-9]+)/.exec(de.userAgent))&&(he=!0,fe=Pe(e[1]))),he}function Oe(){var e;return oe(pe)||(pe=!1,Ie()||Be()||!/ Safari\/[\.0-9]+/.test(de.userAgent)||null!==(e=/ Version\/([\.0-9]+)/.exec(de.userAgent))&&(pe=!0,_e=Pe(e[1]))),pe}function Le(){var e;return oe(Ce)||(Ce=!1,null!==(e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(de.userAgent))&&(Ce=!0,(ge=Pe(e[1])).isNightly=!!e[2])),Ce}function Ne(){var e;return oe(ve)||(ve=!1,"Microsoft Internet Explorer"===de.appName?null!==(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(de.userAgent))&&(ve=!0,ye=Pe(e[1])):"Netscape"===de.appName&&null!==(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(de.userAgent))&&(ve=!0,ye=Pe(e[1]))),ve}function Be(){var e;return oe(Te)||(Te=!1,null!==(e=/ Edge\/([\.0-9]+)/.exec(de.userAgent))&&(Te=!0,xe=Pe(e[1]))),Te}function ze(){var e;return oe(we)||(we=!1,null!==(e=/Firefox\/([\.0-9]+)/.exec(de.userAgent))&&(we=!0,Ae=Pe(e[1]))),we}function Fe(){var e,t;return oe(Me)||((e=document.createElement("canvas")).setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;"),t=e.style.imageRendering,(Me=oe(t)&&""!==t)&&(be=t)),Me}function Ve(){return Ve._result}Object.defineProperties(De,{element:{get:function(){if(De.supportsFullscreen())return document[Re.fullscreenElement]}},changeEventName:{get:function(){if(De.supportsFullscreen())return Re.fullscreenchange}},errorEventName:{get:function(){if(De.supportsFullscreen())return Re.fullscreenerror}},enabled:{get:function(){if(De.supportsFullscreen())return document[Re.fullscreenEnabled]}},fullscreen:{get:function(){if(De.supportsFullscreen())return null!==De.element}}}),De.supportsFullscreen=function(){if(oe(le))return le;le=!1;var e=document.body;if("function"==typeof e.requestFullscreen)return Re.requestFullscreen="requestFullscreen",Re.exitFullscreen="exitFullscreen",Re.fullscreenEnabled="fullscreenEnabled",Re.fullscreenElement="fullscreenElement",Re.fullscreenchange="fullscreenchange",Re.fullscreenerror="fullscreenerror",le=!0;for(var t=["webkit","moz","o","ms","khtml"],i=0,n=t.length;i<n;++i){var r,a=t[i];"function"!=typeof e[r=a+"RequestFullscreen"]&&"function"!=typeof e[r=a+"RequestFullScreen"]||(Re.requestFullscreen=r,le=!0),r=a+"ExitFullscreen","function"==typeof document[r]?Re.exitFullscreen=r:(r=a+"CancelFullScreen","function"==typeof document[r]&&(Re.exitFullscreen=r)),r=a+"FullscreenEnabled",void 0!==document[r]?Re.fullscreenEnabled=r:(r=a+"FullScreenEnabled",void 0!==document[r]&&(Re.fullscreenEnabled=r)),r=a+"FullscreenElement",void 0!==document[r]?Re.fullscreenElement=r:(r=a+"FullScreenElement",void 0!==document[r]&&(Re.fullscreenElement=r)),r=a+"fullscreenchange",void 0!==document["on"+r]&&("ms"===a&&(r="MSFullscreenChange"),Re.fullscreenchange=r),r=a+"fullscreenerror",void 0!==document["on"+r]&&("ms"===a&&(r="MSFullscreenError"),Re.fullscreenerror=r)}return le},De.requestFullscreen=function(e,t){De.supportsFullscreen()&&e[Re.requestFullscreen]({vrDisplay:t})},De.exitFullscreen=function(){De.supportsFullscreen()&&document[Re.exitFullscreen]()},De._names=Re,de="undefined"!=typeof navigator?navigator:{},Ve._promise=void 0,Ve._result=void 0,Ve.initialize=function(){if(oe(Ve._promise))return Ve._promise;var e=C.defer();if(Ve._promise=e.promise,Be())return Ve._result=!1,e.resolve(Ve._result),e.promise;var t=new Image;return t.onload=function(){Ve._result=0<t.width&&0<t.height,e.resolve(Ve._result)},t.onerror=function(){Ve._result=!1,e.resolve(Ve._result)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.promise},Object.defineProperties(Ve,{initialized:{get:function(){return oe(Ve._result)}}});var Ue=[];"undefined"!=typeof ArrayBuffer&&(Ue.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&Ue.push(Uint8ClampedArray),"undefined"!=typeof CanvasPixelArray&&Ue.push(CanvasPixelArray));var Ge,ke,He={isChrome:Ie,chromeVersion:function(){return Ie()&&fe},isSafari:Oe,safariVersion:function(){return Oe()&&_e},isWebkit:Le,webkitVersion:function(){return Le()&&ge},isInternetExplorer:Ne,internetExplorerVersion:function(){return Ne()&&ye},isEdge:Be,edgeVersion:function(){return Be()&&xe},isFirefox:ze,firefoxVersion:function(){return ze()&&Ae},isWindows:function(){return oe(Ee)||(Ee=/Windows/i.test(de.appVersion)),Ee},hardwareConcurrency:z(de.hardwareConcurrency,3),supportsPointerEvents:function(){return oe(Se)||(Se=!ze()&&"undefined"!=typeof PointerEvent&&(!oe(de.pointerEnabled)||de.pointerEnabled)),Se},supportsImageRenderingPixelated:Fe,supportsWebP:Ve,imageRenderingValue:function(){return Fe()?be:void 0},typedArrayTypes:Ue,supportsFullscreen:function(){return De.supportsFullscreen()},supportsTypedArrays:function(){return"undefined"!=typeof ArrayBuffer},supportsWebWorkers:function(){return"undefined"!=typeof Worker},supportsWebAssembly:function(){return"undefined"!=typeof WebAssembly&&!He.isEdge()}},We=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),(e.responseType="blob")===e.responseType}catch(e){return!1}}();function qe(e,t,i,n){var r,a=e.query,o=e.path,s={};if("string"!=typeof(r=o)||-1===r.indexOf("earthview")&&-1===r.indexOf("EV_WebService")||("string"==typeof nt.extraRequestParam&&(s=V(nt.extraRequestParam)),s=Ke(nt._evServerQueryParam,s,!1)),!oe(a)||0===a.length)return t._queryParameters=Ke(t._queryParameters,s,!1);-1===a.indexOf("=")?s[a]=void 0:s=Ke(V(a),s,!1),t._queryParameters=i?Ke(s,t._queryParameters,n):s,e.query=void 0}function je(e,t){var i=t._queryParameters,n=Object.keys(i);1!==n.length||oe(i[n[0]])?Array.isArray(i.layer)?e.query=function(e){var t="";for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=encodeURIComponent(i)+"=";if(Array.isArray(n)){t+=r+encodeURIComponent(n[0]);for(var a=1,o=n.length;a<o;++a)t+=","+encodeURIComponent(n[a]);t+="&"}else t+=r+encodeURIComponent(n)+"&"}return t=t.slice(0,-1)}(i):e.query=function(e){var t="";for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=encodeURIComponent(i)+"=";if(Array.isArray(n))for(var a=0,o=n.length;a<o;++a)t+=r+encodeURIComponent(n[a])+"&";else t+=r+encodeURIComponent(n)+"&"}return t=t.slice(0,-1)}(i):e.query=n[0]}function Ye(e,t){return oe(e)?oe(e.clone)?e.clone():D(e):t}function Xe(e){if(e.state===U.ISSUED||e.state===U.ACTIVE)throw new ue("The Resource is already being fetched.");e.state=U.UNISSUED,e.deferred=void 0}function Ke(e,t,i){if(!i)return P(e,t);var n,r,a=D(e,!0);for(var o in t){t.hasOwnProperty(o)&&(n=a[o],r=t[o],oe(n)?(Array.isArray(n)||(n=a[o]=[n]),a[o]=n.concat(r)):a[o]=Array.isArray(r)?r.slice():r)}return a}function Ze(e){return oe(Ge)||(Ge="object"==typeof define&&oe(define.amd)&&!define.amd.toUrlUndefined&&oe(require.toUrl)?Qe:it),Ge(e)}function Je(e){return"undefined"==typeof document?e:(oe(ke)||(ke=document.createElement("a")),ke.href=e,ke.href=ke.href,ke.href)}function Qe(e){return Je(require.toUrl("../"+e))}var $e,et=/((?:.*\/)|^)cesium[\w-]*\.js(?:\W|$)/i;function tt(){var e="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&oe(define.amd)&&!define.amd.toUrlUndefined&&oe(require.toUrl)?d("..",Ze("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t){var n=e[t].getAttribute("src"),r=et.exec(n);if(null!==r)return r[1]}}();return b(Je(e))}function it(e){return tt()+e}function nt(e){"string"==typeof(e=z(e,z.EMPTY_OBJECT))&&(e={url:e}),this._url=void 0,this._templateValues=Ye(e.templateValues,{}),this._queryParameters=Ye(e.queryParameters,{}),this.headers=Ye(e.headers,{}),this.request=z(e.request,new k),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=z(e.retryAttempts,0),this._retryCount=0;var t=new o(e.url);if(qe(t,this,!0,!0),t.fragment=void 0,this._url=t.toString(),oe(self.window)&&0==nt._ajaxWorkers.length&&nt._sendAjaxFromWebWorker)for(var i=0;i<nt._ajaxMaxRequestConcurrency;i++){var l=i;nt._ajaxWorkers.push(new Worker(Ze("Workers/sendAjaxRequest.js"))),nt._ajaxWorkers[l].onmessage=function(e){var t;0<nt._ajaxExtraRequestArray.length&&(t=nt._ajaxExtraRequestArray.shift(),nt._ajaxWorkers[l].postMessage(t));var i,n,r,a=e.data,o=a.status,s=a.requestParam,u=nt._ajaxMap.get(s.url+s.ajaxRequestCount);0==o?(i=a.xhrStatus,n=a.xhrResponse,r=a.browserResponseType,!(i<200||300<=i)||s.localFile&&0===i||(console.log("url : "+s.url+" failed! status : "+i),u.reject(new H(i,a.xhrResponse,a.xhrResponseHeaders))),"HEAD"!==s.method&&"OPTIONS"!==s.method||u.resolve(a.xhrResponseHeaders),204===i?u.resolve():!oe(n)||oe(s.responseType)&&r!==s.responseType?"json"===s.responseType&&oe(a.jsonStatus)?0==a.jsonStatus?u.resolve(n):u.reject(n):""!==r&&"document"!==r||!oe(a.responseXML)?""!==r&&"text"!==r||!oe(a.responseText)?u.reject(new ue("Invalid XMLHttpRequest response type.")):u.resolve(a.responseText):u.resolve(a.responseXML):u.resolve(n)):u.reject(new H),u=a.xhrResponse=void 0,nt._ajaxMap.delete(s.url+s.ajaxRequestCount)}}}function rt(e){var i=e.resource,n=e.flipY,r=e.preferImageBitmap,a=i.request;a.url=i.url,a.requestFunction=function(){var e=!1;i.isDataUri||i.isBlobUri||(e=i.isCrossOriginUrl);var t=C.defer();return nt._Implementations.createImage(a,e,t,n,r),t.promise};var t=te.request(a);if(oe(t))return t.otherwise(function(t){return a.state!==U.FAILED?C.reject(t):i.retryOnError(t).then(function(e){return e?(a.state=U.UNISSUED,a.deferred=void 0,rt({resource:i,flipY:n,preferImageBitmap:r})):C.reject(t)})})}nt.createIfNeeded=function(e){return e instanceof nt?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new nt({url:e})},nt.supportsImageBitmapOptions=function(){if(oe($e))return $e;if("function"!=typeof createImageBitmap)return $e=C.resolve(!1);return $e=nt.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then(function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none"})}).then(function(e){return!0}).otherwise(function(){return!1})},Object.defineProperties(nt,{isBlobSupported:{get:function(){return We}}}),Object.defineProperties(nt.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){var t=new o(e);qe(t,this,!1),t.fragment=void 0,this._url=t.toString()}},extension:{get:function(){return function(e){var t=new o(e);t.normalize();var i=t.path,n=i.lastIndexOf("/");return-1!==n&&(i=i.substr(n+1)),i=-1===(n=i.lastIndexOf("."))?"":i.substr(n+1)}(this._url)}},isDataUri:{get:function(){return F(this._url)}},isBlobUri:{get:function(){return L(this._url)}},isCrossOriginUrl:{get:function(){return N(this._url)}},hasHeaders:{get:function(){return 0<Object.keys(this.headers).length}}}),nt.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;var i=new o(this._url);e&&je(i,this);var n=i.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),r=this._templateValues,n=n.replace(/{(.*?)}/g,function(e,t){var i=r[t];return oe(i)?encodeURIComponent(i):e});return t&&oe(this.proxy)&&(n=this.proxy.getURL(n)),n},nt.prototype.setQueryParameters=function(e,t){this._queryParameters=t?Ke(this._queryParameters,e,!1):Ke(e,this._queryParameters,!1)},nt.prototype.appendQueryParameters=function(e){this._queryParameters=Ke(e,this._queryParameters,!0)},nt.prototype.setTemplateValues=function(e,t){this._templateValues=t?P(this._templateValues,e):P(e,this._templateValues)},nt.prototype.getDerivedResource=function(e){var t,i=this.clone();return i._retryCount=0,oe(e.url)&&(qe(t=new o(e.url),i,!0,z(e.preserveQueryParameters,!1)),t.fragment=void 0,i._url=t.resolve(new o(d(this._url))).toString()),oe(e.queryParameters)&&(i._queryParameters=P(e.queryParameters,i._queryParameters)),oe(e.templateValues)&&(i._templateValues=P(e.templateValues,i.templateValues)),oe(e.headers)&&(i.headers=P(e.headers,i.headers)),oe(e.proxy)&&(i.proxy=e.proxy),oe(e.request)&&(i.request=e.request),oe(e.retryCallback)&&(i.retryCallback=e.retryCallback),oe(e.retryAttempts)&&(i.retryAttempts=e.retryAttempts),i},nt.prototype.retryOnError=function(e){var t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return C(!1);var i=this;return C(t(this,e)).then(function(e){return++i._retryCount,e})},nt.prototype.clone=function(e){return oe(e)||(e=new nt({url:this._url})),e._url=this._url,e._queryParameters=D(this._queryParameters),e._templateValues=D(this._templateValues),e.headers=D(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e},nt.prototype.getBaseUri=function(e){return t=this.getUrlComponent(e),i=e,n="",-1!==(r=t.lastIndexOf("/"))&&(n=t.substring(0,r+1)),i&&(oe((t=new o(t)).query)&&(n+="?"+t.query),oe(t.fragment)&&(n+="#"+t.fragment)),n;var t,i,n,r},nt.prototype.appendForwardSlash=function(){this._url=b(this._url)},nt.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},nt.fetchArrayBuffer=function(e){return new nt(e).fetchArrayBuffer()},nt.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},nt.fetchBlob=function(e){return new nt(e).fetchBlob()},nt.prototype.fetchImage=function(e){e=z(e,z.EMPTY_OBJECT);var t=z(e.preferImageBitmap,!1),i=z(e.preferBlob,!1),n=z(e.flipY,!1);if(Xe(this.request),!We||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!i)return rt({resource:this,flipY:n,preferImageBitmap:t});var r,a,o,s=this.fetchBlob();return oe(s)?nt.supportsImageBitmapOptions().then(function(e){return r=e&&t,s}).then(function(e){if(oe(e)){if(o=e,r)return nt.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1});var t=window.URL.createObjectURL(e);return rt({resource:a=new nt({url:t}),flipY:n,preferImageBitmap:!1})}}).then(function(e){if(oe(e))return e.blob=o,r||window.URL.revokeObjectURL(a.url),e}).otherwise(function(e){return oe(a)&&window.URL.revokeObjectURL(a.url),e.blob=o,C.reject(e)}):void 0},nt.fetchImage=function(e){return new nt(e).fetchImage({flipY:e.flipY,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},nt.prototype.fetchText=function(){return this.fetch({responseType:"text"})},nt.fetchText=function(e){return new nt(e).fetchText()},nt.prototype.fetchJson=function(){var e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(oe(e))return e.then(function(e){if(oe(e))return JSON.parse(e)})},nt.fetchJson=function(e){return new nt(e).fetchJson()},nt.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},nt.fetchXML=function(e){return new nt(e).fetchXML()},nt.prototype.fetchJsonp=function(e){var t;for(e=z(e,"callback"),Xe(this.request);t="loadJsonp"+Math.random().toString().substring(2,8),oe(window[t]););return function i(n,r,a){var e={};e[r]=a;n.setQueryParameters(e);var o=n.request;o.url=n.url;o.requestFunction=function(){var t=C.defer();return window[a]=function(e){t.resolve(e);try{delete window[a]}catch(e){window[a]=void 0}},nt._Implementations.loadAndExecuteScript(n.url,a,t),t.promise};var t=te.request(o);if(!oe(t))return;return t.otherwise(function(t){return o.state!==U.FAILED?C.reject(t):n.retryOnError(t).then(function(e){return e?(o.state=U.UNISSUED,o.deferred=void 0,i(n,r,a)):C.reject(t)})})}(this,e,t)},nt.fetchJsonp=function(e){return new nt(e).fetchJsonp(e.callbackParameterName)},nt.prototype._makeRequest=function(s){var u=this;Xe(u.request);var l=u.request;l.url=u.url,l.requestFunction=function(){var e,t=s.responseType,i=P(s.headers,u.headers),n=s.overrideMimeType,r=s.method,a=s.data,o=C.defer();return 0!=nt._ajaxWorkers.length&&"document"!=t&&-1!=u.url.indexOf("http")&&nt._sendAjaxFromWebWorker?nt._Implementations.loadWithWebWorkerXhr(u.url,t,r,a,i,o,n):oe(e=nt._Implementations.loadWithXhr(u.url,t,r,a,i,o,n))&&oe(e.abort)&&(l.cancelFunction=function(){e.abort()}),o.promise};var e=te.request(l);if(oe(e))return e.then(function(e){return e}).otherwise(function(t){return l.state!==U.FAILED?C.reject(t):u.retryOnError(t).then(function(e){return e?(l.state=U.UNISSUED,l.deferred=void 0,u.fetch(s)):C.reject(t)})})};var at=/^data:(.*?)(;base64)?,(.*)$/;function ot(e,t){var i=decodeURIComponent(t);return e?atob(i):i}function st(e,t){for(var i=ot(e,t),n=new ArrayBuffer(i.length),r=new Uint8Array(n),a=0;a<i.length;a++)r[a]=i.charCodeAt(a);return n}function ut(e,t){t=z(t,"");var i=e[1],n=!!e[2],r=e[3];switch(t){case"":case"text":return ot(n,r);case"arraybuffer":return st(n,r);case"blob":var a=st(n,r);return new Blob([a],{type:i});case"document":return(new DOMParser).parseFromString(ot(n,r),i);case"json":return JSON.parse(ot(n,r))}}function lt(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}function ct(e,n,t,i,r,a){var o=require("url").parse(e),s="https:"===o.protocol?require("https"):require("http"),u=require("zlib"),l={protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.path,query:o.query,method:t,headers:r};s.request(l).on("response",function(t){var i;t.statusCode<200||300<=t.statusCode?a.reject(new H(t.statusCode,t,t.headers)):(i=[],t.on("data",function(e){i.push(e)}),t.on("end",function(){var e=Buffer.concat(i);"gzip"===t.headers["content-encoding"]?u.gunzip(e,function(e,t){e?a.reject(new ue("Error decompressing response.")):a.resolve(lt(t,n))}):a.resolve(lt(e,n))}))}).on("error",function(e){a.reject(new H)}).end()}nt.prototype.fetch=function(e){return(e=Ye(e,{})).method="GET",this._makeRequest(e)},nt.fetch=function(e){return new nt(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},nt.prototype.delete=function(e){return(e=Ye(e,{})).method="DELETE",this._makeRequest(e)},nt.delete=function(e){return new nt(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},nt.prototype.head=function(e){return(e=Ye(e,{})).method="HEAD",this._makeRequest(e)},nt.head=function(e){return new nt(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},nt.prototype.options=function(e){return(e=Ye(e,{})).method="OPTIONS",this._makeRequest(e)},nt.options=function(e){return new nt(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},nt.prototype.post=function(e,t){return M.defined("data",e),(t=Ye(t,{})).method="POST",t.data=e,this._makeRequest(t)},nt.post=function(e){return new nt(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},nt.prototype.put=function(e,t){return M.defined("data",e),(t=Ye(t,{})).method="PUT",t.data=e,this._makeRequest(t)},nt.put=function(e){return new nt(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},nt.prototype.patch=function(e,t){return M.defined("data",e),(t=Ye(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},nt.patch=function(e){return new nt(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},nt._Implementations={},nt._Implementations.createImage=function(u,l,c,m,d){var h=u.url;nt.supportsImageBitmapOptions().then(function(e){if(!e||!d)return t=h,i=l,n=c,(r=new Image).onload=function(){n.resolve(r)},r.onerror=function(e){n.reject(e)},i&&(ce.contains(t)?r.crossOrigin="use-credentials":r.crossOrigin=""),void(r.src=t);var t,i,n,r,a,o="blob",s=C.defer();return 0!=nt._ajaxWorkers.length&&-1!=h.indexOf("http")&&nt._sendAjaxFromWebWorker?nt._Implementations.loadWithWebWorkerXhr(h,o,"GET",void 0,void 0,s,void 0):oe(a=nt._Implementations.loadWithXhr(h,o,"GET",void 0,void 0,s,void 0,void 0,void 0))&&oe(a.abort)&&(u.cancelFunction=function(){a.abort()}),s.promise.then(function(e){if(oe(e))return nt.createImageBitmapFromBlob(e,{flipY:m,premultiplyAlpha:!1});c.reject(new ue("Successfully retrieved "+h+" but it contained no content."))}).then(c.resolve)}).otherwise(c.reject)},nt.createImageBitmapFromBlob=function(e,t){return M.defined("options",t),M.typeOf.bool("options.flipY",t.flipY),M.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none"})};var mt="undefined"==typeof XMLHttpRequest;nt._Implementations.loadWithXhr=function(e,r,a,t,i,o,n){var s=at.exec(e);if(null===s){if(!mt){var u=new XMLHttpRequest;if(ce.contains(e)&&(u.withCredentials=!0),u.open(a,e,!0),oe(n)&&oe(u.overrideMimeType)&&u.overrideMimeType(n),oe(i))for(var l in i)i.hasOwnProperty(l)&&u.setRequestHeader(l,i[l]);oe(r)&&(u.responseType=r);var c=!1;return"string"==typeof e&&(c=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),u.onload=function(){if(!(u.status<200||300<=u.status)||c&&0===u.status){var e=u.response,t=u.responseType;if("HEAD"===a||"OPTIONS"===a){var i=u.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};return i.forEach(function(e){var t=e.split(": "),i=t.shift();n[i]=t.join(": ")}),void o.resolve(n)}if(204===u.status)o.resolve();else if(!oe(e)||oe(r)&&t!==r)if("json"===r&&"string"==typeof e)try{o.resolve(JSON.parse(e))}catch(e){o.reject(e)}else(""===t||"document"===t)&&oe(u.responseXML)&&u.responseXML.hasChildNodes()?o.resolve(u.responseXML):""!==t&&"text"!==t||!oe(u.responseText)?o.reject(new ue("Invalid XMLHttpRequest response type.")):o.resolve(u.responseText);else o.resolve(e)}else o.reject(new H(u.status,u.response,u.getAllResponseHeaders()))},u.onerror=function(e){o.reject(new H)},u.send(t),u}ct(e,r,a,0,i,o)}else o.resolve(ut(s,r))},nt._Implementations.loadWithWebWorkerXhr=function(e,t,i,n,r,a,o){var s,u,l,c,m=at.exec(e);null===m?mt?ct(e,t,i,0,r,a):(s=!1,"string"==typeof e&&(s=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),u=!1,ce.contains(e)&&(u=!0),nt._ajaxRequestCount++,nt._ajaxMap.set(e+nt._ajaxRequestCount,a),l=0,1<nt._ajaxMaxRequestConcurrency&&(l=nt._ajaxRequestCount%nt._ajaxMaxRequestConcurrency),c={url:e,method:i,overrideMimeType:o,headers:r,responseType:t,localFile:s,withCredentials:u,data:n,ajaxRequestCount:nt._ajaxRequestCount},1e3<nt._ajaxMap.size?nt._ajaxExtraRequestArray.push(c):nt._ajaxWorkers[l].postMessage(c)):a.resolve(ut(m,t))},nt._Implementations.loadAndExecuteScript=function(e,t,i){return function(e){var t=C.defer(),i=document.createElement("script");i.async=!0,i.src=e;var n=document.getElementsByTagName("head")[0];return i.onload=function(){i.onload=void 0,n.removeChild(i),t.resolve()},i.onerror=function(e){t.reject(e)},n.appendChild(i),t.promise}(e).otherwise(i.reject)},nt._DefaultImplementations={},nt._DefaultImplementations.createImage=nt._Implementations.createImage,nt._DefaultImplementations.loadWithXhr=nt._Implementations.loadWithXhr,nt._DefaultImplementations.loadAndExecuteScript=nt._Implementations.loadAndExecuteScript,nt._ajaxWorkers=[],nt._ajaxMap=new Map,nt._ajaxExtraRequestArray=new Array,nt._ajaxRequestCount=0,nt._ajaxMaxRequestConcurrency=Math.max(parseInt(.5*He.hardwareConcurrency),3),nt._sendAjaxFromWebWorker=!0,nt.extraRequestParam=void 0,nt.DEFAULT=Object.freeze(new nt({url:"undefined"==typeof document?"":document.location.href.split("?")[0]})),nt._evServerQueryParam={},nt.addEVServerQueryParam=function(e){for(var t in e)e.hasOwnProperty(t)&&(nt._evServerQueryParam[t]=e[t])},nt.removeEVServerQueryParam=function(e){nt._evServerQueryParam.hasOwnProperty(e)&&delete nt._evServerQueryParam[e]},nt.removeAllEVServerQueryParam=function(){nt._evServerQueryParam={}};var dt,ht,ft,pt=/((?:.*\/)|^)cesium[\w-]*\.js(?:\W|$)/i;function _t(e){return"undefined"==typeof document?e:(oe(dt)||(dt=document.createElement("a")),dt.href=e,dt.href=dt.href,dt.href)}function Ct(){if(oe(ht))return ht;var e="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&oe(define.amd)&&!define.amd.toUrlUndefined&&oe(require.toUrl)?d("..",yt("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t){var n=e[t].getAttribute("src"),r=pt.exec(n);if(null!==r)return r[1]}}();return(ht=new nt({url:_t(e)})).appendForwardSlash(),ht}function gt(e){return _t(require.toUrl("../"+e))}function vt(e){return Ct().getDerivedResource({url:e}).url}function yt(e){return oe(ft)||(ft="object"==typeof define&&oe(define.amd)&&!define.amd.toUrlUndefined&&oe(require.toUrl)?gt:vt),ft(e)}function Tt(e){this.airport=new Cesium.AssociativeArray,this.airspace=[],this.bigAirSpace=[],this.viewer=e.viewer}function xt(e){if(!Cesium.defined(e))throw new Cesium.DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new Cesium.DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.lon)||!Cesium.defined(e.lat)||!Cesium.defined(e.height))throw new Cesium.DeveloperError("位置参数未定义");this.viewer=e.viewer,this.id=e.id,this._scene=this.viewer.scene,this._lon=e.lon,this._lat=e.lat,this._height=e.height,this.show=Cesium.defaultValue(e.show,!0),this._show=void 0,this.startYaw=Cesium.defaultValue(e.startYaw,0),this.endYaw=Cesium.defaultValue(e.endYaw,360),this.innerRadius=Cesium.defaultValue(e.innerRadius,5300),this._innerRadius=void 0,this.outerRadius=Cesium.defaultValue(e.outerRadius,15200),this._outerRadius=void 0,this.fillColor=Cesium.defaultValue(e.fillColor,Cesium.Color.RED),this.lineColor=Cesium.defaultValue(e.lineColor,Cesium.Color.WHITE),this._modelMatrix=Cesium.defaultValue(e.modelMatrix,void 0),this._center=new Cesium.Cartesian3,this.renderStyle=Cesium.defaultValue(e.renderStyle,0),this._attributeLocations=void 0,this._allCommands=[],this.instance=Cesium.defaultValue(e.instance,void 0),this._fillCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._outlineCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({depthTest:!0})}),this._scene.primitives.add(this)}function wt(e,t,i){var n=function(e){var t=new Cesium.Matrix4,i=e._center,n=e._vertexBufferTypedArray;Cesium.defined(n)||(n=new Float32Array(12));e._dynamic&&(e._vertexBufferTypedArray=n);var r=e._modelMatrix,a=Cesium.Matrix4.clone(r,t);return a[12]-=i.x,a[13]-=i.y,a[14]-=i.z,[].push(new Cesium.Cartesian3(a[12],a[13],a[14])),n[0]=a[0],n[1]=a[4],n[2]=a[8],n[3]=a[12],n[4]=a[1],n[5]=a[5],n[6]=a[9],n[7]=a[13],n[8]=a[2],n[9]=a[6],n[10]=a[10],n[11]=a[14],n}(e),r=Cesium.Buffer.createVertexBuffer({context:t,typedArray:n,usage:Cesium.BufferUsage.STATIC_DRAW}),a=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),o={czm_modelMatrixRow0:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*a,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*a,strideInBytes:12*a,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*a,strideInBytes:12*a,instanceDivisor:1}},s=0,u=[];return u.push({index:s++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(i.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),o.czm_modelMatrixRow0.index=s++,u.push(o.czm_modelMatrixRow0),o.czm_modelMatrixRow1.index=s++,u.push(o.czm_modelMatrixRow1),o.czm_modelMatrixRow2.index=s++,u.push(o.czm_modelMatrixRow2),new Cesium.VertexArray({context:t,attributes:u,indexBuffer:Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(i.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})}function At(e,t,i,n){for(var r=new Cesium.Cartesian3(-n,0,0),a=[],o=0;o<=360;o+=10){var s=new Cesium.Cartesian3,u=Cesium.Math.toRadians(o);s.x=i*Math.cos(u)+r.x,s.y=i*Math.sin(u)+r.y,s.z=r.z,a.push(s)}for(var l=new Cesium.Quaternion,l=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,-Cesium.Math.toRadians(e),new Cesium.Quaternion),c=Cesium.Matrix3.fromQuaternion(l,new Cesium.Matrix3),m=0;m<a.length;m++){var d=Cesium.Matrix3.multiplyByVector(c,a[m],new Cesium.Cartesian3);t.push(d)}return{positions:t}}function Et(){return"attribute vec3 position;\nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvoid main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position =czm_viewProjection* czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n"}function St(){return"uniform vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}function bt(e){if(!Cesium.defined(e))throw new Error("需要一个笛卡尔坐标");var t=Cesium.Cartographic.fromCartesian(e);return{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),height:t.height}}yt._cesiumScriptRegex=pt,yt._buildModuleUrlFromBaseUrl=vt,yt._clearBaseResource=function(){ht=void 0},yt.setBaseUrl=function(e){ht=nt.DEFAULT.getDerivedResource({url:e})},yt.getCesiumBaseUrl=Ct,Tt.prototype.addAirSpace=function(e){for(var t=e.name,i=Cesium.defaultValue(new Cesium.Color(e.r,e.g,e.b),new Cesium.Color(1,1,1)),n=e.coor,r=e.id,a=this.viewer.entities.add({id:r,corridor:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(n),outline:!0,width:1,outlineColor:i,material:i,extrudedHeight:100,extrudedHeightReference:Cesium.HeightReference.RELATIVE_TO_GROUND}}),o=[],s=new Cesium.BoundingRectangle,u=0;u<n.length;u+=3){var l=new Cesium.Cartesian2(n[u],n[u+1]);o.push(l)}Cesium.BoundingRectangle.fromPoints(o,s);var c=new Cesium.Cartesian2(s.x+s.width/2,s.y+s.height/2);a.center=c,this.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(c.x,c.y),label:new Cesium.LabelGraphics({text:t,translucencyByDistance:new Cesium.NearFarScalar(1500,1,9e6,0),scaleByDistance:new Cesium.NearFarScalar(1500,3,9e5,0),disableDepthTestDistance:Number.POSITIVE_INFINITY}),id:r+"_001"}),a.labelID=r+"_001",this.airspace.push(a)},Tt.prototype.removeAirSpaceById=function(t){var e,i=this,n=i.viewer.entities.getById(t);null!=n&&(e=i.viewer.entities.getById(n.labelID),n.show=!1,e.show=!1,i.viewer.entities.remove(n),i.viewer.entities.remove(e),i.airspace=i.airspace.filter(function(e){return e.id!=t}))},Tt.prototype.removeAirSpaceByName=function(e){},Tt.prototype.removeAll=function(){var i=this;i.airspace.forEach(function(e){var t=i.viewer.entities.getById(e.labelID);i.viewer.entities.remove(t),i.viewer.entities.remove(e)})},Tt.prototype.updateAirSpace=function(e){var t=this.viewer.entities.getById(e.id);if(null!=t)"label"==e.type&&(this.viewer.entities.getById(t.labelID).label.text=e.name);else if("position"==e.type)t.corridor.positions=e.position;else if(null==e||null==e.type)return"传入参数不正确"},Tt.prototype.getAirSpaceById=function(e){return this.viewer.entities.getById(e)},Tt.prototype.addBigAirSpace=function(e){for(var t=new Cesium.Color(e.color.r,e.color.g,e.color.b),i=0;i<e.coor.length-4;i+=2)e.coor[i]==e.coor[i+2]&&e.coor[i+1]==e.coor[i+3]&&(i+=2),this.viewer.entities.add({corridor:{positions:Cesium.Cartesian3.fromDegreesArray([e.coor[i],e.coor[i+1],e.coor[i+2],e.coor[i+3]]),outline:!0,width:1,outlineColor:t,material:t,extrudedHeight:10,extrudedHeightReference:Cesium.HeightReference.RELATIVE_TO_GROUND},name:e.name,id:"wall"+i});this.bigAirSpace.push({name:e.name,count:e.coor.length/3})},Tt.prototype.removeBigAirSpaceByName=function(e){for(var t=0;t<this.viewer.entities._values.length;t++){var i=this.viewer.entities._values[t];i.name==e&&(this.viewer.entities.remove(i),t--)}this.bigAirSpace=[]},Tt.prototype.addAirport=function(e){var t=parseFloat(e.lon),i=parseFloat(e.lat),n=parseFloat(e.alt),r=e.name,a=e.angle,o=(Cesium.defaultValue(e.icon,"Assets/EMExtensions/PolitTraningApp/images/Airport.png"),e.id);this.airport.set(o,e);var s,m,d,h,u,l,c=this,f=c.viewer.scene;Cesium.defined(c.primitive)||(s=new Cesium.GeometryInstance({geometry:new Cesium.EllipseGeometry({center:Cesium.Cartesian3.fromDegrees(t,i),semiMinorAxis:.1,semiMajorAxis:.1,height:n,stRotation:Cesium.Math.toRadians(a),vertexFormat:Cesium.VertexFormat.POSITION_AND_ST})}),(m=new Cesium.Primitive({geometryInstances:s,appearance:new Cesium.MaterialAppearance({material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:yt("Assets/EMExtensions/PolitTraningApp/images/Airport.png")}}}),flat:!0})})).id=o,f.primitives.add(m),c.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(t,i,n),label:{text:r,pixelOffset:new Cesium.Cartesian2(32,-5),fillColor:Cesium.Color.ORANGE,scale:.75},id:o+"001"}),c.airport.get(o).labelID=o+"001",d=Cesium.Cartesian3.fromDegrees(t,i,n),h=Cesium.Matrix4.clone(m.modelMatrix),u=new Cesium.BoundingSphere,l=1,c.viewer.scene.preRender.addEventListener(function(){var e,t,i=f._frameState,n=i.context,r=Math.max(n.drawingBufferWidth,n.drawingBufferHeight),a=(e=i,t=.1,u.center=d,u.radius=t,e.camera.getPixelSize(u,e.context.drawingBufferWidth,e.context.drawingBufferHeight)),o=1/a;Math.min(.2*o,r)<32&&(l=32*a/.2),function(e){var t=Cesium.Matrix4.fromArray(h),i=Cesium.Matrix4.getMatrix3(t,new Cesium.Matrix3),n=Cesium.Matrix3.inverse(i,new Cesium.Matrix3),r=Cesium.Matrix4.getTranslation(t,new Cesium.Cartesian3),a=Cesium.Transforms.eastNorthUpToFixedFrame(d),o=Cesium.Matrix4.getMatrix3(a,new Cesium.Matrix3),s=Cesium.Matrix4.getTranslation(a,new Cesium.Cartesian3),u=Cesium.Cartesian3.subtract(r,s,new Cesium.Cartesian3),u=Cesium.Matrix4.fromTranslation(u,new Cesium.Matrix4),l=Cesium.Matrix3.multiply(n,o,new Cesium.Matrix3),l=Cesium.Matrix3.inverse(l,new Cesium.Matrix3);l=Cesium.Matrix4.fromRotationTranslation(l);var c=Cesium.Matrix4.fromRotationTranslation(e);Cesium.Matrix4.multiply(a,c,a),Cesium.Matrix4.multiply(a,l,a),Cesium.Matrix4.multiply(a,u,a),m.modelMatrix=a}(Cesium.Matrix3.fromScale(new Cesium.Cartesian3(l,l,l)))}))},Tt.prototype.removeAirport=function(e){for(var t=this,i=0;i<t.viewer.scene.primitives.length;++i){var n=t.viewer.scene.primitives.get(i);if(null!=n.id&&n.id===e){t.viewer.scene.primitives.remove(n);break}}var r=t.viewer.entities.getById(e+"001");t.viewer.entities.remove(r),t.airport.set(e,"")},Tt.prototype.getAirPort=function(e){for(var t=this.viewer.scene.primitives.length,i=0;i<t;++i){var n=this.viewer.scene.primitives.get(i);if(n.id===e)return n}},xt.prototype.update=function(e){this._allCommands.length=0;var t=e.context,i=this;this.outerRadius instanceof Cesium.CallbackProperty?this._outerRadius=this.outerRadius.getValue(e.time):this._outerRadius=this.outerRadius,this.innerRadius instanceof Cesium.CallbackProperty?this._innerRadius=this.innerRadius.getValue(e.time):this._innerRadius=this.innerRadius,this._position=Cesium.Cartesian3.fromDegrees(this._lon,this._lat,this._height),this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this._position),Cesium.Matrix4.multiplyByUniformScale(this._modelMatrix,1,this._modelMatrix);var n=Cesium.Matrix3.fromRotationX(Cesium.Math.PI_OVER_TWO,new Cesium.Matrix3);Cesium.Matrix4.multiplyByMatrix3(this._modelMatrix,n,this._modelMatrix),this._fillCommand.uniformMap={v_colour:function(){return i.fillColor}};var r=this.createFillMesh();this._fillVA=wt(this,t,r),this._outlineCommand.uniformMap={v_colour:function(){return i.lineColor}};var a=this.createOutlineMesh();this._outlineVA=wt(this,t,a),Cesium.defined(this._fillCommand.shaderProgram)||(this._fillCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:Et(),fragmentShaderSource:St()})),Cesium.defined(this._outlineCommand.shaderProgram)||(this._outlineCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:Et(),fragmentShaderSource:St()})),this._fillCommand.vertexArray=this._fillVA,this._outlineCommand.vertexArray=this._outlineVA,2!=this.renderStyle&&this._allCommands.push(this._fillCommand),1!=this.renderStyle&&this._allCommands.push(this._outlineCommand);var o=e.commandList,s=e.passes,u=this._allCommands;if(this.show instanceof Cesium.CallbackProperty?this._show=this.show.getValue():this._show=this.show,s.render&&this._show)for(var l=0,c=u.length;l<c;l++){var m=u[l];o.push(m)}},xt.prototype.remove=function(){var e,t=this._fillCommand,i=this._outlineCommand;t.vertexArray=t.vertexArray&&t.vertexArray.destroy(),t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy(),i.vertexArray=i.vertexArray&&i.vertexArray.destroy(),i.shaderProgram=i.shaderProgram&&i.shaderProgram.destroy(),!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._scene.primitives._guid])},xt.prototype.createFillMesh=function(){for(var e=(this.endYaw-this.startYaw)/10,t=(this.endYaw-this.startYaw)/10,i=new Float64Array((1+t)*(1+e)*3),n=(1+t)*(1+e)*6,r=this._outerRadius,a=this._innerRadius,o=0,s=0,u=Cesium.IndexDatatype.createTypedArray((1+t)*(1+e),n),l=0;l<=t;l+=1)for(var c=At(10*l,[],a,r),m=0;m<c.positions.length;m++)i[o++]=c.positions[m].x,i[o++]=c.positions[m].y,i[o++]=c.positions[m].z;for(var d=0;d<t;d++)for(var h=0;h<e;h++)u[s++]=37*d+h,u[s++]=37*d+h+37,u[s++]=37*d+h+1,u[s++]=37*d+h+1,u[s++]=37*d+h+37,u[s++]=37*d+h+38;return{position:i,indices:u}},xt.prototype.createOutlineMesh=function(){for(var e=(this.endYaw-this.startYaw)/10,t=(this.endYaw-this.startYaw)/10,i=new Float64Array((1+t)*(1+e)*3),n=(1+t)*(1+e)*6,r=this._outerRadius,a=this._innerRadius,o=0,s=0,u=Cesium.IndexDatatype.createTypedArray((1+t)*(1+e),n),l=0;l<=t;l+=1)for(var c=At(10*l,[],a,r),m=0;m<c.positions.length;m++)i[o++]=c.positions[m].x,i[o++]=c.positions[m].y,i[o++]=c.positions[m].z;for(var d=0;d<1+t;d++)for(var h=0;h<e;h++)u[s++]=37*d+h,u[s++]=37*d+h+1,d<(1+t)*(1+e)/(1+t)-1&&(u[s++]=d*(1+t)+h,u[s++]=d*(1+t)+h+37);return{position:i,indices:u}};var Mt={};function Rt(e){if(!Cesium.defined(e))throw new DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.lon)||!Cesium.defined(e.lat)||!Cesium.defined(e.height))throw new DeveloperError("位置参数未定义");this.viewer=e.viewer,this.id=e.id,this._scene=this.viewer.scene,this._lon=e.lon,this._lat=e.lat,this._height=e.height,this.startYaw=Cesium.defaultValue(e.startYaw,-90),this.endYaw=Cesium.defaultValue(e.endYaw,100),this.radius=Cesium.defaultValue(e.radius,530),this._radius=void 0,this._position=Cesium.Cartesian3.fromDegrees(this._lon,this._lat,this._height),this.fillColor=Cesium.defaultValue(e.fillColor,Cesium.Color.RED),this._modelMatrix=Cesium.defaultValue(e.modelMatrix,void 0),this._center=new Cesium.Cartesian3,this._attributeLocations=void 0,this._command=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.TRANSLUCENT,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._scene.primitives.add(this)}function Dt(e){if(!Cesium.defined(e))throw new DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.position))throw new DeveloperError("位置参数options.position不能为空。");this._viewer=e.viewer,this._id=e.id,this._scene=this._viewer.scene,this.show=Cesium.defaultValue(e.show,!0),this._show=void 0,this.renderStyle=Cesium.defaultValue(e.renderStyle,0),this._center=new Cesium.Cartesian3,this.position=e.position,this._position=void 0,this.outRadius=Cesium.defaultValue(e.outRadius,4e4),this.inRadius=Cesium.defaultValue(e.inRadius,1e4),this._colorCommands=[],this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0,.3)),this.lineColor=Cesium.defaultValue(e.lineColor,new Cesium.Color(1,0,0,1)),this.yawRange=Cesium.defaultValue(e.yawRange,new Cesium.Cartesian2(0,360)),this.pitchRange=Cesium.defaultValue(e.pitchRange,new Cesium.Cartesian2(-90,90)),this.circleDensity=Cesium.defaultValue(e.circleDensity,36),this._modelMatrix=Cesium.defaultValue(e.modelMatrix,void 0),this.topRadius=Cesium.defaultValue(e.topRadius,3e3),this.angularRate=Cesium.defaultValue(e.angularRate,50),this.waveDirection=Cesium.defaultValue(e.waveDirection,"WD_Horizontal"),this.wavePath=Cesium.defaultValue(e.wavePath,"WP_Z"),this.ms=Cesium.defaultValue(e.ms,100),this.wavePoints=[],this._fillCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._sectorVA=void 0,this.showScan=Cesium.defaultValue(e.showScan,!1),this._showScan=void 0,this._outlineCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._scene.primitives.add(this)}function Pt(e){var t={iso8601:void 0};if(Cesium.defined(e))return t.iso8601=e,Cesium.TimeInterval.fromIso8601(t)}function It(e){for(var t=[],i=[],n=360/e.circleDensity,r=e.pitchRange.x;r<e.pitchRange.y+n;r+=n){var a=r>e.pitchRange.y?e.pitchRange.y:r,o=e.inRadius*Math.cos(Cesium.Math.toRadians(a))*Math.sin(Cesium.Math.toRadians(0)),s=e.inRadius*Math.sin(Cesium.Math.toRadians(a)),u=e.inRadius*Math.cos(Cesium.Math.toRadians(a))*Math.cos(Cesium.Math.toRadians(0)),l=e.outRadius*Math.cos(Cesium.Math.toRadians(a))*Math.sin(Cesium.Math.toRadians(0)),c=e.outRadius*Math.sin(Cesium.Math.toRadians(a)),m=e.outRadius*Math.cos(Cesium.Math.toRadians(a))*Math.cos(Cesium.Math.toRadians(0));t.push(new Cesium.Cartesian3(o,s,u)),i.push(new Cesium.Cartesian3(l,c,m))}for(r=i.length-1;0<=r;--r)t.push(i[r]);return 0<t.length&&t.push(t[0]),t}function Ot(e,t,i){var n=e*Math.cos(Cesium.Math.toRadians(i))*Math.sin(Cesium.Math.toRadians(t)),r=e*Math.sin(Cesium.Math.toRadians(i)),a=e*Math.cos(Cesium.Math.toRadians(i))*Math.cos(Cesium.Math.toRadians(t));return new Cesium.Cartesian3(n,r,a)}function Lt(e,t,i){var n=function(e){var t=new Cesium.Matrix4,i=e._center,n=e._vertexBufferTypedArray;Cesium.defined(n)||(n=new Float32Array(12));var r=e._modelMatrix,a=Cesium.Matrix4.clone(r,t);return a[12]-=i.x,a[13]-=i.y,a[14]-=i.z,[].push(new Cesium.Cartesian3(a[12],a[13],a[14])),n[0]=a[0],n[1]=a[4],n[2]=a[8],n[3]=a[12],n[4]=a[1],n[5]=a[5],n[6]=a[9],n[7]=a[13],n[8]=a[2],n[9]=a[6],n[10]=a[10],n[11]=a[14],n}(e),r=Cesium.Buffer.createVertexBuffer({context:t,typedArray:n,usage:Cesium.BufferUsage.STATIC_DRAW}),a=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),o={czm_modelMatrixRow0:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*a,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*a,strideInBytes:12*a,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*a,strideInBytes:12*a,instanceDivisor:1}},s=0,u=[];return u.push({index:s++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(i.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),u.push({index:s++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.UNSIGNED_BYTE,new Uint8Array(i.color.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),o.czm_modelMatrixRow0.index=s++,u.push(o.czm_modelMatrixRow0),o.czm_modelMatrixRow1.index=s++,u.push(o.czm_modelMatrixRow1),o.czm_modelMatrixRow2.index=s++,u.push(o.czm_modelMatrixRow2),new Cesium.VertexArray({context:t,attributes:u,indexBuffer:Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(i.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})}function Nt(e,t,i,n,r){r.vertexArray=t,r.modelMatrix=i,r._boundingVolume=n,e._colorCommands.push(r)}function Bt(){return"attribute vec3 position;\nattribute vec4 color; \nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_viewProjection * czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n"}function zt(){return"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}function Ft(e,t){}function Vt(e){var C=C||{};!function(){void 0===C.escapeMode&&(C.escapeMode=!0);C.attributePrefix=C.attributePrefix||"_",C.arrayAccessForm=C.arrayAccessForm||"none",C.emptyNodeForm=C.emptyNodeForm||"text",void 0===C.enableToStringFunc&&(C.enableToStringFunc=!0);C.arrayAccessFormPaths=C.arrayAccessFormPaths||[],void 0===C.skipEmptyTextNodesForObj&&(C.skipEmptyTextNodesForObj=!0);void 0===C.stripWhitespaces&&(C.stripWhitespaces=!0);C.datetimeAccessFormPaths=C.datetimeAccessFormPaths||[],void 0===C.useDoubleQuotes&&(C.useDoubleQuotes=!1);C.xmlElementsFilter=C.xmlElementsFilter||[],C.jsonPropertiesFilter=C.jsonPropertiesFilter||[],void 0===C.keepCData&&(C.keepCData=!1)}();var g={ELEMENT_NODE:1,ATTR_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function v(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function y(e,t,i,n){for(var r=0;r<e.length;r++){var a=e[r];if("string"==typeof a){if(a==n)break}else if(a instanceof RegExp){if(a.test(n))break}else if("function"==typeof a&&a(t,i,n))break}return r!=e.length}function T(e,t,i){switch(C.arrayAccessForm){case"property":e[t]instanceof Array?e[t+"_asArray"]=e[t]:e[t+"_asArray"]=[e[t]]}!(e[t]instanceof Array)&&0<C.arrayAccessFormPaths.length&&y(C.arrayAccessFormPaths,e,t,i)&&(e[t]=[e[t]])}function x(e,t,i){if(0<C.datetimeAccessFormPaths.length){var n=i.split(".#")[0];return y(C.datetimeAccessFormPaths,e,t,n)?(o=(r=e).split(/[-T:+Z]/g),s=new Date(o[0],o[1]-1,o[2]),u=o[5].split("."),s.setHours(o[3],o[4],u[0]),1<u.length&&s.setMilliseconds(u[1]),o[6]&&o[7]?(a=60*o[6]+Number(o[7]),a=0+("-"==(/\d\d-\d\d:\d\d$/.test(r)?"-":"+")?-1*a:a),s.setMinutes(s.getMinutes()-a-s.getTimezoneOffset())):-1!==r.indexOf("Z",r.length-1)&&(s=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()))),s):e}return e;var r,a,o,s,u}return function e(t,i){if(t.nodeType==g.DOCUMENT_NODE){for(var n=new Object,r=t.childNodes,a=0;a<r.length;a++)(o=r.item(a)).nodeType==g.ELEMENT_NODE&&(n[u=v(o)]=e(o,u));return n}if(t.nodeType==g.ELEMENT_NODE){for((n=new Object).__cnt=0,r=t.childNodes,a=0;a<r.length;a++){var o,s,u=v(o=r.item(a));o.nodeType!=g.COMMENT_NODE&&(s=i+"."+u,h=n,f=o.nodeType,p=u,_=s,f==g.ELEMENT_NODE&&0<C.xmlElementsFilter.length&&!y(C.xmlElementsFilter,h,p,_)||(n.__cnt++,null==n[u]?(n[u]=e(o,s),T(n,u,s)):(null!=n[u]&&(n[u]instanceof Array||(n[u]=[n[u]],T(n,u,s))),n[u][n[u].length]=e(o,s))))}for(var l=0;l<t.attributes.length;l++){var c=t.attributes.item(l);n.__cnt++;var m=c.name;"model"===c.name||"name"===c.name||"modelname"===c.name?(n[C.attributePrefix+"path"]="./data/gltf/"+c.value+".gltf",m="modelname",n[C.attributePrefix+m]=c.value):"scale"===c.name?(m="modelscale",n[C.attributePrefix+m]=c.value):"icon"===c.name&&""!==c.value?n[C.attributePrefix+m]="./data/images/"+c.value:n[C.attributePrefix+m]=c.value}var d=t.prefix;return null!=d&&""!=d&&(n.__cnt++,n.__prefix=d),null!=n["#text"]&&(n.__text=n["#text"],n.__text instanceof Array&&(n.__text=n.__text.join("\n")),C.stripWhitespaces&&(n.__text=n.__text.trim()),delete n["#text"],"property"==C.arrayAccessForm&&delete n["#text_asArray"],n.__text=x(n.__text,u,i+"."+u)),null!=n["#cdata-section"]&&(n.__cdata=n["#cdata-section"],delete n["#cdata-section"],"property"==C.arrayAccessForm&&delete n["#cdata-section_asArray"]),0==n.__cnt&&"text"==C.emptyNodeForm?n="":1==n.__cnt&&null!=n.__text?n=n.__text:1!=n.__cnt||null==n.__cdata||C.keepCData?1<n.__cnt&&null!=n.__text&&C.skipEmptyTextNodesForObj&&(C.stripWhitespaces&&""==n.__text||""==n.__text.trim())&&delete n.__text:n=n.__cdata,delete n.__cnt,!C.enableToStringFunc||null==n.__text&&null==n.__cdata||(n.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),n}if(t.nodeType==g.TEXT_NODE||t.nodeType==g.CDATA_SECTION_NODE)return t.nodeValue;var h,f,p,_}(e)}function Ut(e,t,i){for(var n='"'+i[0]+"/"+i[1]+"/gltf/",r=0;r<e.attributes.length;r++)t+='"'+e.attributes[r].nodeName+'":"'+e.attributes[r].nodeValue+'",',"name"===e.attributes[r].nodeName&&(n+=e.attributes[r].nodeValue+'.gltf"');return t+='"path":'+n,t+="},{"}Mt.toInt=function(e){if(e){var t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseInt(255*(t[3]||1));return(parseInt(t[0])<<24|parseInt(t[1])<<16|parseInt(t[2])<<8|i)>>>0}},Mt.fromInt=function(e){if(e){var t=[];return t[0]=(4278190080&e)>>>24,t[1]=(16711680&e)>>>16,t[2]=(65280&e)>>>8,t[3]=255&e,"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]/255+")"}},Rt.prototype.update=function(e){var t=e.context,i=this;this.radius instanceof Cesium.CallbackProperty?this._radius=this.radius.getValue(e.time):this._radius=this.radius,this._boundingSphere=new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,this._radius),this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this._position),Cesium.Matrix4.multiplyByUniformScale(this._modelMatrix,1,this._modelMatrix),Cesium.BoundingSphere.transform(this._boundingSphere,this._modelMatrix,this._boundingSphere),this._command.boundingVolume=this._boundingSphere,this._command.uniformMap={v_colour:function(){return i.fillColor}};var n,r,a,o,s,u,l,c,m,d=this.createMesh();this._VA=(r=t,a=d,o=function(e){var t=new Cesium.Matrix4,i=e._center,n=e._vertexBufferTypedArray;Cesium.defined(n)||(n=new Float32Array(12));e._dynamic&&(e._vertexBufferTypedArray=n);var r=e._modelMatrix,a=Cesium.Matrix4.clone(r,t);return a[12]-=i.x,a[13]-=i.y,a[14]-=i.z,[].push(new Cesium.Cartesian3(a[12],a[13],a[14])),n[0]=a[0],n[1]=a[4],n[2]=a[8],n[3]=a[12],n[4]=a[1],n[5]=a[5],n[6]=a[9],n[7]=a[13],n[8]=a[2],n[9]=a[6],n[10]=a[10],n[11]=a[14],n}(n=this),s=Cesium.Buffer.createVertexBuffer({context:r,typedArray:o,usage:n._dynamic?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW}),u=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),l={czm_modelMatrixRow0:{index:0,vertexBuffer:s,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*u,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:s,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*u,strideInBytes:12*u,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:s,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*u,strideInBytes:12*u,instanceDivisor:1}},c=0,(m=[]).push({index:c++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:r,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(a.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),l.czm_modelMatrixRow0.index=c++,m.push(l.czm_modelMatrixRow0),l.czm_modelMatrixRow1.index=c++,m.push(l.czm_modelMatrixRow1),l.czm_modelMatrixRow2.index=c++,m.push(l.czm_modelMatrixRow2),new Cesium.VertexArray({context:r,attributes:m,indexBuffer:Cesium.Buffer.createIndexBuffer({context:r,typedArray:new Uint16Array(a.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})),Cesium.defined(this._command.shaderProgram)||(this._command.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:"attribute vec3 position;\nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvoid main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position =czm_viewProjection* czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"uniform vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"})),this._command.vertexArray=this._VA;var h=e.commandList;e.passes.render&&h.push(this._command)},Rt.prototype.remove=function(){var e,t=this._command;return t.vertexArray=t.vertexArray&&t.vertexArray.destroy(),t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy(),!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._scene.primitives._guid]),Cesium.destroyObject(this)},Rt.prototype.createMesh=function(){var e=this.endYaw-this.startYaw;e*=2;for(var t=new Float64Array(3*e),i=this._radius,n=0,r=0,a=Cesium.IndexDatatype.createTypedArray(e,e),o=1;o<e-1;o++)t[n++]=i*Math.sin((this.startYaw+o)*Math.PI/180),t[n++]=i*Math.cos((this.startYaw+o)*Math.PI/180),t[n++]=0;for(var s=0;s<e-1;s++)a[r++]=s,a[r++]=s+1;return{position:t,indices:a}},Dt.prototype.addRadarWave=function(){var e=Cesium.Cartographic.fromCartesian(this._position,Cesium.Ellipsoid.WGS84);e.height+=this.outRadius/2;var t=Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,e.height,Cesium.Ellipsoid.WGS84);this.radarWave=this._viewer.entities.add({position:t,show:this._show,cylinder:{length:this.outRadius,topRadius:this.topRadius,bottomRadius:0,showBottom:!1,showTop:!1,changeStCoordinate:!1,material:this.color}})},Dt.prototype.update=function(e){this._colorCommands.length=0;var t=e.mode,i=e.context,n=this._viewer.scene.frameState.time;if(this.show instanceof Array?function(e,t){if(0<e.show.length)for(var i=0;i<e.show.length;i++)if(e.show[i].boolean){var n=Pt(e.show[i].interval);if(Cesium.JulianDate.compare(n.start,t)<=0&&0<=Cesium.JulianDate.compare(n.stop,t))return e._show=!0,Cesium.defined(e.radarWave)&&(e.radarWave.show=e._show)}else e._show=!1,Cesium.defined(e.radarWave)&&(e.radarWave.show=e._show)}(this,n):this._show!=this.show&&(this._show=this.show),this._show&&t===Cesium.SceneMode.SCENE3D){this.position instanceof Cesium.ConstantPositionProperty?this._position=this.position.getValue(e.time):this._position=this.position,this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this._position),Cesium.Matrix4.multiplyByUniformScale(this._modelMatrix,1,this._modelMatrix);var r=Cesium.Matrix3.fromRotationX(Cesium.Math.PI_OVER_TWO,new Cesium.Matrix3);Cesium.Matrix4.multiplyByMatrix3(this._modelMatrix,r,this._modelMatrix),this.showScan&&this._showScan!=this.showScan&&(this._showScan=this.showScan,this.addRadarWave()),function(e,t){var i=t.context;{var n;2==e.renderStyle||Cesium.defined(e._fillVA)||(n=function(e){var t=It(e);if(t.length<=1)return;var i=0,n=e.yawRange.y-e.yawRange.x,r=e.pitchRange.y-e.pitchRange.x,a=360/e.circleDensity,o=(n/a+1)*t.length,s=(n/a+1)*(t.length-1)*6;n<360&&(o+=4*(r/a+1),s+=r/a*12);for(var u=Cesium.IndexDatatype.createTypedArray(o,s),l=new Float64Array(3*o),c=new Uint8Array(4*o),m=e.color,d=0,h=0,f=0,i=0,p=0;p<n+a;p+=a){i++;for(var _=n<p?n:p,C=0;C<t.length;C++){var g=new Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(-_)),v=Cesium.Matrix3.multiplyByVector(g,t[C],new Cesium.Cartesian3);l[d++]=v.x,l[d++]=v.y,l[d++]=v.z,c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha)}}for(p=0;p<i;++p)for(C=0;C<t.length-1;++C)p<i-1&&(u[f++]=p*t.length+C,u[f++]=(p+1)*t.length+C+1,u[f++]=p*t.length+C+1,u[f++]=p*t.length+C,u[f++]=(p+1)*t.length+C,u[f++]=(p+1)*t.length+C+1);if(n<360){for(var y=d/3,T=0,x=e.pitchRange.x;x<e.pitchRange.y+a;x+=a){T++;var w=x>e.pitchRange.y?e.pitchRange.y:x,A=Ot(e.inRadius,0,w),E=Ot(e.inRadius,n,w),S=Ot(e.outRadius,0,w),b=Ot(e.outRadius,n,w),g=new Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(-n));A=Cesium.Matrix3.multiplyByVector(g,A,new Cesium.Cartesian3),E=Cesium.Matrix3.multiplyByVector(g,E,new Cesium.Cartesian3),S=Cesium.Matrix3.multiplyByVector(g,S,new Cesium.Cartesian3),b=Cesium.Matrix3.multiplyByVector(g,b,new Cesium.Cartesian3),l[d++]=A.x,l[d++]=A.y,l[d++]=A.z,l[d++]=E.x,l[d++]=E.y,l[d++]=E.z,l[d++]=S.x,l[d++]=S.y,l[d++]=S.z,l[d++]=b.x,l[d++]=b.y,l[d++]=b.z,c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha),c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha),c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha),c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha)}for(p=0;p<T-1;++p)u[f++]=y+4*p,u[f++]=y+4*(p+1),u[f++]=y+4*p+2,u[f++]=y+4*p+2,u[f++]=y+4*(p+1),u[f++]=y+4*(p+1)+2,u[f++]=y+4*p+1,u[f++]=y+4*p+3,u[f++]=y+4*(p+1)+1,u[f++]=y+4*p+3,u[f++]=y+4*(p+1)+3,u[f++]=y+4*(p+1)+1}return{position:l,color:c,indices:u}}(e),e._fillVA=Lt(e,i,n))}{var r;1==e.renderStyle||Cesium.defined(e._outlineVA)||(r=function(e){var t=It(e);if(t.length<=1)return;var i=0,n=e.yawRange.y-e.yawRange.x,r=e.pitchRange.y-e.pitchRange.x,a=360/e.circleDensity,o=(n/a+1)*t.length,s=(n/a+1)*(t.length-1)*4;n<360&&(o+=r/a*4,s+=4*(r/a-1));for(var u=Cesium.IndexDatatype.createTypedArray(o,s),l=new Float64Array(3*o),c=new Uint8Array(4*o),m=e.lineColor,d=0,h=0,f=0,p=0;p<n+a;p+=a){i++;for(var _=n<p?n:p,C=0;C<t.length;C++){var g=new Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(-_)),v=Cesium.Matrix3.multiplyByVector(g,t[C],new Cesium.Cartesian3);l[d++]=v.x,l[d++]=v.y,l[d++]=v.z,c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha)}}for(p=0;p<i;++p)for(C=0;C<t.length-1;++C)p==i-1&&360==n||(u[f++]=p*t.length+C,u[f++]=p*t.length+C+1),p<i-1&&(u[f++]=p*t.length+C,u[f++]=(p+1)*t.length+C);if(n<360){for(var y=d/3,T=0,x=e.pitchRange.x;x<e.pitchRange.y+a;x+=a){T++;var w=x>e.pitchRange.y?e.pitchRange.y:x,A=Ot(e.inRadius,0,w),E=Ot(e.inRadius,n,w),S=Ot(e.outRadius,0,w),b=Ot(e.outRadius,n,w);A=Cesium.Matrix3.multiplyByVector(g,A,new Cesium.Cartesian3),E=Cesium.Matrix3.multiplyByVector(g,E,new Cesium.Cartesian3),S=Cesium.Matrix3.multiplyByVector(g,S,new Cesium.Cartesian3),b=Cesium.Matrix3.multiplyByVector(g,b,new Cesium.Cartesian3),l[d++]=A.x,l[d++]=A.y,l[d++]=A.z,l[d++]=E.x,l[d++]=E.y,l[d++]=E.z,l[d++]=S.x,l[d++]=S.y,l[d++]=S.z,l[d++]=b.x,l[d++]=b.y,l[d++]=b.z,c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha),c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha),c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha),c[h++]=Cesium.Color.floatToByte(m.red),c[h++]=Cesium.Color.floatToByte(m.green),c[h++]=Cesium.Color.floatToByte(m.blue),c[h++]=Cesium.Color.floatToByte(m.alpha)}for(p=0;p<T-1;++p)u[f++]=y+4*p,u[f++]=y+4*p+2,u[f++]=y+4*p+1,u[f++]=y+4*p+3}return{position:l,color:c,indices:u}}(e),e._outlineVA=Lt(e,i,r))}}(this,e),this._fillCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:i,vertexShaderSource:Bt(),fragmentShaderSource:zt()}),this._outlineCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:i,vertexShaderSource:Bt(),fragmentShaderSource:zt()}),2!=this.renderStyle&&Cesium.defined(this._fillVA)&&Nt(this,this._fillVA,this._modelMatrix,this._boundingSphere,this._fillCommand),1!=this.renderStyle&&Cesium.defined(this._outlineVA)&&Nt(this,this._outlineVA,this._modelMatrix,this._boundingSphere,this._outlineCommand);var a=e.commandList,o=e.passes,s=this._colorCommands;if(o.render)for(var u=0,l=s.length;u<l;u++){var c=s[u];a.push(c)}}},Dt.prototype.remove=function(){var e,t=this._fillCommand,i=this._outlineCommand;return t.vertexArray=t.vertexArray&&t.vertexArray.destroy(),t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy(),i.vertexArray=i.vertexArray&&i.vertexArray.destroy(),i.shaderProgram=i.shaderProgram&&i.shaderProgram.destroy(),!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._viewer.scene.primitives._guid]),this.radarWave&&this._viewer.entities.contains(this.radarWave)&&this._viewer.entities.remove(this.radarWave),Cesium.destroyObject(this)},Ft.GetData=function(e,t,r){var a=[],o=t.split("/");"XML"===e.toUpperCase()&&new Cesium.Resource.fetchXML({url:t}).then(function(e){if(e){for(var t=0;t<e.children.length;t++)if(0===e.children[t].attributes.length&&0!==e.children[t].children.length)for(var i,n=0;n<e.children[t].children.length;n++){0!==e.children[t].children[n].attributes.length&&0===e.children[t].children[n].children.length&&(i={type:e.children[t].children[n].attributes[0].nodeValue,scale:e.children[t].children[n].attributes[1].nodeValue,name:e.children[t].children[n].attributes[2].nodeValue,path:o[0]+"/"+o[1]+"/gltf/"+e.children[t].children[n].attributes[2].nodeValue+".gltf",desc:e.children[t].children[n].attributes[3].nodeValue},a.push(i))}r&&r(a)}})},Ft.GetDataByJson=function(e,t,i){var n="",r=t.split("/");"XML"===e.toUpperCase()&&new Cesium.Resource.fetchXML({url:t}).then(function(e){e&&(n=function e(t,i,n){for(var r=0;r<t.length;r++){var a=t[r];if(0!==a.attributes.length)i=Ut(a,i,n);else if(void 0!==a.children)return i+='"children":[{',e(a.children,i,n)}return i}(e.children,n,r),i&&i(n))})},Ft.GetXMLToObject=function(e,n){var r=[],t=[];for(var i in e)t.push(i),r.push(e[i]);for(var a=[],i=0;i<r.length;i++){var o=r[i],s=t[i];new Cesium.Resource.fetchXML({url:o,queryParameters:{name:s}}).then(function(e){var t=e.URL.indexOf("=")+1,i={name:e.URL.slice(t,e.URL.length),InfoJson:Vt(e)};a.push(i),a.length===r.length&&n&&n(a)}).otherwise(function(){throw new Cesium.DeveloperError("请求数据失败")})}};var Gt=Object.freeze({NET_MSG_MIN:-1,NET_MSG_FIGHTER:0,NET_MSG_COMMAND:1,NET_MSG_TSPI:2,NET_MSG_RDR_STATE:3,NET_MSG_EWS_STA:4,NET_MSG_TARGET:6,NET_MSG_IRST:9,NET_MSG_IRMSL_STATE:12,NET_MSG_GTSPI:20,NET_MSG_RAD_STATE:21,NET_MSG_STATICTARGET:22,NET_MSG_COMBATPOWER:23,NET_MSG_RTSN:30,NET_MSG_RTKN:31,NET_MSG_WPN_TRAJ:32,NET_MSG_LARGE_PLANE:35,NET_MSG_SAFETYALARM:40});function kt(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.mtType=Cesium.defaultValue(e.mtType,Cesium.EV_MsgType.NET_MSG_MIN),this.name=e.name,this.uId=e.uId,this.show=Cesium.defaultValue(e.show,!0),this.modelType=e.modelType,this.nRedOrBlue=e.nRedOrBlue,this.realTime=e.realTime,this.fLon=e.fLon,this.fLat=e.fLat,this.fAlt=e.fAlt,this.position=e.position,this.headingPitchRoll=e.headingPitchRoll,this.scale=Cesium.defaultValue(e.scale,1),this.modelUri=e.modelUri,this.boundingBoxVisible=Cesium.defaultValue(e.boundingBoxVisible,!1),this.specialAttributes=Cesium.defaultValue(e.specialAttributes,{}),this.modelIconUri=e.modelIconUri,this.modelIconColor=Cesium.defaultValue(e.modelIconColor,Cesium.Color.RED),this.modelIconScale=Cesium.defaultValue(e.modelIconScale,1),this.modelIconRotation=Cesium.defaultValue(e.modelIconRotation,0),this.modelIconDisplayDistance=Cesium.defaultValue(e.modelIconDisplayDistance,new Cesium.DistanceDisplayCondition(6e4,9e4)),this.modelLabelType=void 0,this.modelLabelVisible=Cesium.defaultValue(e.modelLabelVisible,!0),this.modelLabelPixelOffset=Cesium.defaultValue(e.modelLabelPixelOffset,new Cesium.Cartesian2(50,25)),this.modelLabelPullWireColor=Cesium.defaultValue(e.modelLabelPullWireColor,Cesium.Color.RED),this.modelLabelTextColor=Cesium.defaultValue(e.modelLabelTextColor,Cesium.Color.RED),this.sectorRadarVisible=Cesium.defaultValue(e.sectorRadarVisible,!1),this.sectorRadarColor=Cesium.defaultValue(e.sectorRadarColor,new Cesium.Color(.38,.64,.64,.6)),this.trace=Cesium.defaultValue(e.trace,void 0)}function Ht(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.wcPosition=e.wcPosition,this.headingPitchRoll=e.headingPitchRoll,this.timeMsec=e.timeMsec}function Wt(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._traceTimeDuration=Cesium.defaultValue(e.traceTimeDuration,0),this._ribbonVisible=Cesium.defaultValue(e.ribbonVisible,!1),this.ribbonColor=Cesium.defaultValue(e.ribbonColor,new Cesium.Color(1,0,0,1)),this._wallVisible=Cesium.defaultValue(e.wallVisible,!1),this.wallColor=Cesium.defaultValue(e.wallColor,new Cesium.Color(1,0,0,1)),this._barVisible=Cesium.defaultValue(e.barVisible,!1),this.barColor=Cesium.defaultValue(e.barColor,new Cesium.Color(1,0,0,1)),this._barTimeInterval=Cesium.defaultValue(e.barTimeInterval,8),this.lineColor=Cesium.defaultValue(e.lineColor,new Cesium.Color(1,0,0,1)),this._lineVisible=Cesium.defaultValue(e.lineVisible,!1),this.ribbonScale=1,this.trackPoints=[],this.barPoints=[],this._forwardOffset=Cesium.defaultValue(e.forwardOffset,0),this._upOffset=Cesium.defaultValue(e.upOffset,0)}function qt(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.realTime=e.realTime,this.fLon=e.fLon,this.fLat=e.fLat,this.fAlt=e.fAlt,this.position=e.position,this.nRedOrBlue=Cesium.defaultValue(e.nRedOrBlue,0),Cesium.defined(e.headingPitchRoll)?this.headingPitchRoll=Cesium.HeadingPitchRoll.clone(e.headingPitchRoll):this.headingPitchRoll=new Cesium.HeadingPitchRoll,this.specialAttributes=Cesium.defaultValue(e.specialAttributes,{})}function jt(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.mtType=Cesium.defaultValue(e.mtType,Cesium.Cartesian2.NET_MSG_MIN),this.name=Cesium.defaultValue(e.name,""),this.uId=Cesium.defaultValue(e.uId,void 0),this.show=Cesium.defaultValue(e.show,!0),this.checked=Cesium.defaultValue(e.checked,!1),this.modelType=Cesium.defaultValue(e.modelType,0),this.timeAttitudeCollection=[],this.specialAttributes=Cesium.defaultValue(e.specialAttributes,{}),this.curTimeAttitude=Cesium.defaultValue(e.curTimeAttitude,new qt),this.disappearedTimeAttitude=Cesium.defaultValue(e.disappearedTimeAttitude,new qt),this.scale=Cesium.defaultValue(e.scale,1),this.modelUri=Cesium.defaultValue(e.modelUri,void 0),this.boundingBoxVisible=Cesium.defaultValue(e.boundingBoxVisible,!1),this.modelIconUri=Cesium.defaultValue(e.modelIconUri,void 0),this.modelIconColor=Cesium.defaultValue(e.modelIconColor,new Cesium.Color(1,0,0,1)),this.modelIconScale=Cesium.defaultValue(e.modelIconScale,1),this.modelIconRotation=Cesium.defaultValue(e.modelIconRotation,0),this.modelIconDisplayDistance=Cesium.defaultValue(e.modelIconDisplayDistance,new Cesium.DistanceDisplayCondition(6e4,9e4)),this.modelLabelType=void 0,this.modelLabelVisible=Cesium.defaultValue(e.modelLabelVisible,!0),this.modelLabelPixelOffset=Cesium.defaultValue(e.modelLabelPixelOffset,new Cesium.Cartesian2(50,25)),this.modelLabelPullWireColor=Cesium.defaultValue(e.modelLabelPullWireColor,new Cesium.Color(1,0,0,1)),this.modelLabelTextColor=Cesium.defaultValue(e.modelLabelTextColor,new Cesium.Color(1,0,0,1)),this.sectorRadarVisible=Cesium.defaultValue(e.sectorRadarVisible,!1),this.sectorRadarColor=Cesium.defaultValue(e.sectorRadarColor,new Cesium.Color(.38,.64,.64,.6)),this.trace=new Wt({ribbonVisible:Cesium.defined(e.trace)?e.trace.ribbonVisible:Cesium.defaultValue(e.ribbonVisible,!1),ribbonColor:Cesium.defined(e.trace)?e.trace.ribbonColor:Cesium.defaultValue(e.ribbonColor,new Cesium.Color(1,0,0,1)),wallVisible:Cesium.defined(e.trace)?e.trace.wallVisible:Cesium.defaultValue(e.wallVisible,!1),wallColor:Cesium.defined(e.trace)?e.trace.wallColor:Cesium.defaultValue(e.wallColor,new Cesium.Color(1,0,0,1)),forwardOffset:Cesium.defined(e.trace)?e.trace.forwardOffset:Cesium.defaultValue(e.forwardOffset,0),upOffset:Cesium.defined(e.trace)?e.trace.upOffset:Cesium.defaultValue(e.upOffset,5),traceTimeDuration:Cesium.defined(e.trace)?e.trace.traceTimeDuration:Cesium.defaultValue(e.traceTimeDuration,0),barVisible:Cesium.defined(e.trace)?e.trace.barVisible:Cesium.defaultValue(e.barVisible,!1),barColor:Cesium.defined(e.trace)?e.trace.barColor:Cesium.defaultValue(e.barColor,new Cesium.Color(1,0,0,1)),lineVisible:Cesium.defined(e.trace)?e.trace.lineVisible:Cesium.defaultValue(e.lineVisible,!1),lineColor:Cesium.defined(e.trace)?e.trace.lineColor:Cesium.defaultValue(e.lineColor,new Cesium.Color(1,0,0,1)),barTimeInterval:Cesium.defined(e.trace)?e.trace.barTimeInterval:Cesium.defaultValue(e.barTimeInterval,0)})}function Yt(e,t,i){if(Cesium.defined(e)&&Cesium.defined(t)){var n=e.realTime,r=t.realTime-n;if(!(r<=0)){var a=i-e.realTime;if(!(a<=0||r<a)){var o=jt.cloneTimeAttitude(e),s=e.position,u=t.position,l=a/r,c=Cesium.Cartesian3.lerp(s,u,l,new Cesium.Cartesian3);o.position=c,o.realTime=i;var m=e.headingPitchRoll.roll,d=e.headingPitchRoll.pitch,h=e.headingPitchRoll.heading,f=t.headingPitchRoll.roll,p=t.headingPitchRoll.pitch,_=t.headingPitchRoll.heading,C=Math.abs(f-m),g=(g=Math.abs(_-h))>Math.PI?2*Math.PI-g:g,C=C>Math.PI?2*Math.PI-C:C,v=Xt(h,_),y=Xt(m,f);return o.headingPitchRoll.heading=h+g*l*v,o.headingPitchRoll.pitch=d+(p-d)*l,o.headingPitchRoll.roll=m+C*l*y,o}}}}function Xt(e,t){var i=new Cesium.Cartesian3(Math.sin(e),Math.cos(e),0),n=new Cesium.Cartesian3(Math.sin(t),Math.cos(t),0);return 0<Cesium.Cartesian3.cross(i,n,new Cesium.Cartesian3).z?-1:1}kt.clone=function(e,t){if(Cesium.defined(e))return Cesium.defined(t)||(t=new kt(e)),t.name=e.name,t.uId=e.uId,t.show=e.show,t.modelType=e.modelType,t.realTime=e.realTime,t.fLon=e.fLon,t.fLat=e.fLat,t.fAlt=e.fAlt,t.position=e.position,t.headingPitchRoll=Cesium.HeadingPitchRoll.clone(e.headingPitchRoll),t.scale=Cesium.defaultValue(t.scale,1),t.modelUri=e.modelUri,t.modelIconUri=e.modelIconUri,t.modelIconColor=Cesium.Color.clone(e.iconColor),t.modelIconDisplayDistance=Cesium.DistanceDisplayCondition.clone(e.modelIconDisplayDistance),t.ribbonVisible=e.ribbonVisible,t.ribbonColor=Cesium.Color.clone(e.ribbonColor),t.modelLabelVisible=e.modelLabelVisible,t.modelLabelPullWireColor=e.modelLabelPullWireColor,t.modelLabelType=e.modelLabelType,t.nRedOrBlue=e.nRedOrBlue,t.modelLabelPixelOffset=e.modelLabelPixelOffset,t.modelColor=e.modelColor,t.modelColorBlendMode=e.modelColorBlendMode,t.modelLabelTextColor=e.modelLabelTextColor,t.sectorRadarVisible=e.sectorRadarVisible,t.sectorRadarColor=e.sectorRadarColor,t},Object.defineProperties(Wt.prototype,{traceTimeDuration:{get:function(){return this._traceTimeDuration},set:function(e){this._traceTimeDuration=e}},barTimeInterval:{get:function(){return this._barTimeInterval},set:function(e){this._barTimeInterval=e}},ribbonVisible:{get:function(){return this._ribbonVisible},set:function(e){this._ribbonVisible=e}},wallVisible:{get:function(){return this._wallVisible},set:function(e){this._wallVisible=e}},barVisible:{get:function(){return this._barVisible},set:function(e){this._barVisible=e}},forwardOffset:{get:function(){return this._forwardOffset},set:function(e){this._forwardOffset=e}},upOffset:{get:function(){return this._upOffset},set:function(e){this._upOffset=e}},lineVisible:{get:function(){return this._lineVisible},set:function(e){this._lineVisible=e}}}),Wt.prototype.add=function(e,t,i,n){if(this.ribbonScale=n,!(0<this.trackPoints.length&&i===this.trackPoints[this.trackPoints.length-1].timeMsec)){for(;0<this.trackPoints.length&&i-this.trackPoints[0].timeMsec>1e3*this._traceTimeDuration;)this.trackPoints.shift();if(this.trackPoints.push(new Ht({wcPosition:e,headingPitchRoll:t,timeMsec:i})),this._barVisible)if(0<this.barPoints.length){for(;0<this.barPoints.length&&i-this.barPoints[0].timeMsec>1e3*this._traceTimeDuration;)this.barPoints.shift();0<=this.barPoints.length-2&&i-this.barPoints[this.barPoints.length-2].timeMsec>1e3*this._barTimeInterval?this.barPoints.push(new Ht({wcPosition:e,headingPitchRoll:t,timeMsec:i})):this.barPoints[this.barPoints.length-1]=new Ht({wcPosition:e,headingPitchRoll:t,timeMsec:i})}else this.barPoints.push(new Ht({wcPosition:e,headingPitchRoll:t,timeMsec:i})),this.barPoints.push(new Ht({wcPosition:e,headingPitchRoll:t,timeMsec:i}))}},Wt.prototype.clearAll=function(){this.trackPoints=[],this.barPoints=[]},jt.prototype.addTimeAttitude=function(e){this.timeAttitudeCollection.push(new qt(e))},jt.prototype.getMovingTargetStateByTime=function(e,t){Cesium.Check.typeOf.number("time",e);var i=!!Cesium.defined(t)&&t,n=void 0;if(0<this.timeAttitudeCollection.length){if(!i&&e>=this.timeAttitudeCollection[this.timeAttitudeCollection.length-1].realTime)return this.disappearedTimeAttitude=this.timeAttitudeCollection[this.timeAttitudeCollection.length-1],this.curTimeAttitude=new qt,void this.timeAttitudeCollection.splice(0,this.timeAttitudeCollection.length);for(var r=this.timeAttitudeCollection[0],a=r,o=1;o<this.timeAttitudeCollection.length;o++){if(a=this.timeAttitudeCollection[o],e>=r.realTime&&e<=a.realTime){var s=Yt(r,a,e);Cesium.defined(s)&&((n=new kt(this)).realTime=s.realTime,n.fLon=s.fLon,n.fLat=s.fLat,n.fAlt=s.fAlt,n.position=s.position,n.headingPitchRoll=s.headingPitchRoll,n.nRedOrBlue=s.nRedOrBlue,n.specialAttributes=s.specialAttributes,this.curTimeAttitude=s,!i&&2<this.timeAttitudeCollection.length&&0<o-2&&this.timeAttitudeCollection.splice(0,o-2));break}r=this.timeAttitudeCollection[o]}}return n},jt.cloneTimeAttitude=function(e){return new qt(e)};var Kt=Object.freeze({ADD:0,REPLACE:1});function Zt(e){if(this._loaderTaskProcessor=e.worker,this._xmlUrl=e.xmlUrl,!Cesium.defined(e.xmlUrl))throw new Cesium.DeveloperError("xmlUrl undefined!");this.trainingClock=e.trainingClock,this.datSource=e.datSource,this._promise=void 0,this.timeId=void 0,this.dataOperated=Kt.ADD,this.trajOperated=Kt.ADD,this.cachePlaneData=[],this.receiveDatas=[],this.receiveMTDatas=[],this.receiveMTFlightDatas=new Cesium.AssociativeArray,this.receiveTrajFlightDatas=new Cesium.AssociativeArray,this.receiveGtspiFlightDatas=new Cesium.AssociativeArray,this.receiveData=new Cesium.Event,this.stopReceiveData=new Cesium.Event,this.idchFlyUser=new Cesium.AssociativeArray,this.idchFlyName=new Cesium.AssociativeArray,this.sendRadarMV=!1,this.redPlane=0,this.bluePlane=0,this.idchUnderName=new Cesium.AssociativeArray,this.idchUnderList=new Cesium.AssociativeArray,this.idchUnderInfo=new Cesium.AssociativeArray,this.idchUnderRaderList=new Cesium.AssociativeArray,this.rtknData=[],this.addEventArr=[],this.addRtkn=new Cesium.Event,this.addAllRtkn=[],this.addIrsm=new Cesium.Event,this.addShowEvent=new Cesium.Event,this.irsmData=[],this.irsmIndex=0,this.redOrBlue=new Cesium.AssociativeArray,this.trajData=new Cesium.AssociativeArray,this.trajSendData=new Cesium.AssociativeArray,this.trajDataSid=new Cesium.AssociativeArray,this.radarTargetMap=new Cesium.AssociativeArray,this.radarTarget=new Cesium.AssociativeArray,this.radarEvent=new Cesium.Event,this.radarmvArr=[],this.ewsIndex=new Cesium.AssociativeArray,this.ewsData=new Cesium.AssociativeArray,this.gtspiData=[],this.gtspiArr=new Cesium.AssociativeArray,this.sdrState=new Cesium.AssociativeArray,this.sdrIndex=new Cesium.AssociativeArray,this.sdrStateEvent=new Cesium.Event,this.missileXml=new Cesium.AssociativeArray,this.sendArr=new Cesium.AssociativeArray,this.planeXml=new Cesium.AssociativeArray,this.statictargetXml=new Cesium.AssociativeArray,this.largePlaneXml=new Cesium.AssociativeArray,this.gtspiXml=new Cesium.AssociativeArray,this.i3wpntypeXml=new Cesium.AssociativeArray,this.randomColor=new Cesium.AssociativeArray;var t=this;this.cacheTime=void 0,this.index=new Cesium.AssociativeArray,this.radarIndex=new Cesium.AssociativeArray,this.gtspiIndex=0,this.trajIndex=new Cesium.AssociativeArray,this.combatpower=new Cesium.AssociativeArray,Ft.GetXMLToObject(this._xmlUrl,function(e){!function(e,t){for(var i=0;i<t.length;i++){var n=t[i].name;if("planemissile"==n){for(var r=t[i].InfoJson.root.missile.model,a=t[i].InfoJson.root.plane.model,o=0;o<r.length;o++)e.missileXml.set(r[o]._type,r[o]);for(var s=0;s<a.length;s++)e.planeXml.set(a[s]._type,a[s])}else if("gtspi"==n)for(var u=t[i].InfoJson.root.gtspi,l=0;l<u.length;l++)e.gtspiXml.set(u[l]._id,u[l]);else if("statictarget"==n)for(var c=t[i].InfoJson.root.statictgt,m=0;m<c.length;m++)e.statictargetXml.set(c[m]._id,c[m]);else if("largeplane"==n)for(var d=t[i].InfoJson.root.model,h=0;h<d.length;h++)e.largePlaneXml.set(d[h]._type,d[h]);else if("i3wpntype"==n)for(var f=t[i].InfoJson.root.missileType.model,p=0;p<f.length;p++)e.i3wpntypeXml.set(f[p]._type,f[p])}}(t,e)}),this.clickNum=0,this.speed=1,this.StartWork(),this.planeResued=new Cesium.AssociativeArray,this.radarTime=new Cesium.AssociativeArray,this.radarWM=new Cesium.Event,this.addReaction=new Cesium.Event,this.flightState=new Cesium.Event,this.addPlane=new Cesium.Event,this.ewsEvent=new Cesium.Event}function Jt(e,t){for(var i=e.get(t.header.sID),n=t.header.realTime,r="",a=0;a<i.length;a++)0==a?r=i[0].nRedOrBlue:a<i.length-1&&i[a].header.datTime<=n&&i[a].header.datTime>n&&(r=i[a].nRedOrBlue);return 0!==r&&1!==r&&(r=2),r}function Qt(e,t){this.viewer=e,this.options=t,this.mtMgr=t.mtMgr}Zt.prototype.addReceiveDataListener=function(e,t){switch(e){case Gt.NET_MSG_TSPI:return this.receiveData.addEventListener(t);case Gt.NET_MSG_FIGHTER:return this.flightState.addEventListener(t);case Gt.NET_MSG_GTSPI:return this.receiveData.addEventListener(t);case Gt.NET_MSG_RTKN:return this.addRtkn.addEventListener(t);case Gt.NET_MSG_TARGET:return this.radarEvent.addEventListener(t);case Gt.NET_MSG_RDR_STATE:return this.radarWM.addEventListener(t);case Gt.NET_MSG_EWS_STA:return this.ewsEvent.addEventListener(t);case Gt.NET_MSG_IRMSL_STATE:return this.addIrsm.addEventListener(t);case Gt.NET_MSG_RAD_STATE:return this.sdrStateEvent.addEventListener(t);case"addShowEvent":return this.addShowEvent.addEventListener(t);case Gt.NET_MSG_COMBATPOWER:return this.combatpower.addEventListener(t)}},Zt.prototype.removeReceiveDataListener=function(e){return this.receiveData.removeEventListener(e)},Zt.prototype.StartWork=function(){this._promise=this._loaderTaskProcessor.scheduleTask({datSource:this.datSource}),this.onMessage()},Zt.prototype.onMessage=function(){var y=this;if(!Cesium.defined(y._promise))return!1;y._loaderTaskProcessor._worker.onmessage=function(e){var t,i,n,r=e.data;if(!Cesium.defined(r.id)&&0!=r.length&&"string"!=typeof r[0])switch(y.cacheTime=r[r.length-1].header.datTime,r[0].header.msgType){case Gt.NET_MSG_TSPI:for(var a=0;a<r.length;a++){var o=y.sendArr.get(r[a].header.sID),s=y.index.get(r[a].header.sID);o?o.push(r[a]):((g=[]).push(r[a]),y.sendArr.set(r[a].header.sID,g)),s||y.index.set(r[a].header.sID,0),y.randomColor.contains(r[a].header.sID)||(y.randomColor.set(r[a].header.sID,(0,t=Math.floor(256*Math.random()),i=Math.floor(256*Math.random()),n=Math.floor(256*Math.random()),"rgb("+t+","+i+","+n+")")),r[a].chFlyUser?(y.idchFlyUser.set(r[a].header.sID,r[a].chFlyUser),y.idchFlyName.set(r[a].header.sID,r[a].chFlyUser+""+r[a].chFighterName)):(y.idchFlyUser.set(r[a].header.sID,r[a].header.sID),y.idchFlyName.set(r[a].header.sID,r[a].header.sID))),y.redOrBlue.contains(r[a].header.sID)?(_=y.redOrBlue.get(r[a].header.sID))[(C=_.length)-1].nRedOrBlue!=r[a].nRedOrBlue&&_.push({time:r[a].header.datTime,nRedOrBlue:r[a].nRedOrBlue,type:"fly"}):((g=[]).push({time:r[a].header.datTime,nRedOrBlue:r[a].nRedOrBlue,type:"fly"}),y.redOrBlue.set(r[a].header.sID,g))}break;case Gt.NET_MSG_FIGHTER:y.flightState.raiseEvent(r);break;case Gt.NET_MSG_RTKN:for(var u,l=0;l<r.length;l++){y.idchFlyUser.contains(r[l].nTgtID)&&(y.planeResued.contains(r[l].nTgtID)?y.planeResued.get(r[l].nTgtID).push(r[l]):((u=[]).push(r[l]),y.planeResued.set(r[l].nTgtID,u)))}y.rtknData=y.rtknData.concat(r),y.addAllRtkn=y.addAllRtkn.concat(r),y.addEventArr=y.addEventArr.concat(r);break;case Gt.NET_MSG_RTSN:y.addAllRtkn=y.addAllRtkn.concat(r),y.addEventArr=y.addEventArr.concat(r);break;case Gt.NET_MSG_WPN_TRAJ:r.forEach(function(e){var t,i;y.trajData.contains(e.header.sID)?y.trajData.get(e.header.sID).push(e):((t=[]).push(e),y.trajData.set(e.header.sID,t)),y.trajSendData.contains(e.weaponID)?(0!=e.captureState&&2!=y.trajSendData.get(e.weaponID).length&&0==y.trajSendData.get(e.weaponID)[0].captureState&&y.trajSendData.get(e.weaponID).push(e),y.trajDataSid.get(e.header.sID+"_"+e.weaponID).push(e)):((i=[]).push(e),y.trajSendData.set(e.weaponID,i),y.trajDataSid.set(e.header.sID+"_"+e.weaponID,i)),y.trajIndex.contains(e.header.sID)||y.trajIndex.set(e.header.sID,0)});break;case Gt.NET_MSG_GTSPI:y.gtspiData=y.gtspiData.concat(r);for(l=0;l<r.length;l++)y.idchUnderName.set(r[l].header.sID+"_"+r[l].equipmentID+"_"+r[l].equipmentType,r[l].header.sID+"_"+r[l].equipmentID+"_"+r[l].equipmentType),y.idchUnderList.set(r[l].header.sID,r[l].header.sID),y.idchUnderInfo.set(r[l].header.sID,r[l].header.sID+"_"+r[l].equipmentID+"_"+r[l].equipmentType),2==r[l].equipmentType&&y.idchUnderRaderList.set(r[l].header.sID,r[l].header.sID+"_"+r[l].equipmentID+"_"+r[l].equipmentType);for(a=0;a<r.length;a++){(o=y.gtspiArr.get(r[a].header.sID))?o.push(r[a]):((g=[]).push(r[a]),y.gtspiArr.set(r[a].header.sID,g))}break;case Gt.NET_MSG_IRMSL_STATE:r.forEach(function(e){y.irsmData.push(e)});break;case Gt.NET_MSG_TARGET:for(var c in r.forEach(function(e,t,i){var n;y.radarTargetMap.contains(e.header.sID)?y.radarTargetMap.get(e.header.sID).push(e):((n=[]).push(e),y.radarTargetMap.set(e.header.sID,n)),y.radarIndex.contains(e.header.sID)||y.radarIndex.set(e.header.sID,0),y.radarTarget.contains(e.header.sID)?y.radarTarget.get(e.header.sID).push(e):((n=[]).push(e),y.radarTarget.set(e.header.sID,n))}),y.radarTargetMap._hash){var m=y.radarTargetMap.get(c);if(Cesium.defined(m[0])){for(var d=m[0].header.datTime,h=0;h<m.length;h++){var f=m[h].header.datTime,p=y.radarTime.get(m[h].header.sID);if((0==m[h].tgtInfo[0].tgtSensor||2==m[h].tgtInfo[0].tgtSensor)&&0!=m[h].tgtInfo[0].tgtAzimuth&&m[h].tgtInfo[0].tgtAzimuth<70&&-70<m[h].tgtInfo[0].tgtAzimuth){if(y.radarTime.contains(m[h].header.sID)){if(0==h)continue;Cesium.defined(p[p.length-1].endTime)?p.push({startTime:new Date(m[h].header.datTime)}):2e3<f-d&&(p[p.length-1].endTime=new Date(m[h-1].header.datTime))}else{(g=[])[0]={},g[0].startTime=m[h].header.datTime,y.radarTime.set(m[h].header.sID,g)}d=f}else Cesium.defined(p)&&!Cesium.defined(p[p.length-1].endTime)&&(p[p.length-1].endTime=new Date(m[h-1].header.datTime))}m.splice(0,m.length-1)}}break;case Gt.NET_MSG_RDR_STATE:y.radarmvArr=y.radarmvArr.concat(r),y.radarWM.raiseEvent(y.radarmvArr);break;case Gt.NET_MSG_EWS_STA:r.forEach(function(e){var t;y.ewsData.contains(e.header.sID)?y.ewsData.get(e.header.sID).push(e):((t=[]).push(e),y.ewsData.set(e.header.sID,t)),y.ewsIndex.contains(e.header.sID)||y.ewsIndex.set(e.header.sID,0)});break;case Gt.NET_MSG_RAD_STATE:r.forEach(function(e){var t;y.sdrState.contains(e.header.sID)?y.sdrState.get(e.header.sID).push(e):((t=[]).push(e),y.sdrState.set(e.header.sID,t)),y.sdrIndex.contains(e.header.sID)||y.sdrIndex.set(e.header.sID,0)});case Gt.NET_MSG_COMBATPOWER:r.forEach(function(e){var t;y.combatpower.contains(e.header.sID)?y.combatpower.get(e.header.sID).push(e):((t=[]).push(e),y.combatpower.set(e.header.sID,t))});for(var _,C,g,v,a=0;a<r.length;a++){y.redOrBlue.contains(r[a].header.sID)?(C=(_=y.redOrBlue.get(r[a].header.sID)).length,0!==(v=r[a].nRedOrBlue)&&1!=v&&(v=2),_[C-1].nRedOrBlue!=v&&_.push({time:r[a].header.datTime,nRedOrBlue:r[a].nRedOrBlue,type:"car"})):(g=[],0!==(v=r[a].nRedOrBlue)&&1!==v&&(v=2),g.push({time:r[a].header.datTime,nRedOrBlue:v,type:"car"}),y.redOrBlue.set(r[a].header.sID,g))}}}},Zt.prototype.startSend=function(){var h=this;this.timeId=setInterval(function(){h.trainingClock.tick();Cesium.JulianDate.toDate(h.trainingClock.currentTime).getTime();h.speed=Number(h.speed);var e,t,i=[];for(var n in h.sendArr._hash){var r=h.index.get(n);r<h.sendArr._hash[n].length&&(i=r+parseInt(50*h.speed)>=h.sendArr._hash[n].length?i.concat(h.sendArr._hash[n].slice(r,h.sendArr._hash[n].length)):i.concat(h.sendArr._hash[n].slice(r,r+parseInt(50*h.speed))),h.trainingClock.shouldAnimate?h.index.set(n,r+parseInt(50*h.speed)):i=i.concat(h.sendArr._hash[n].slice(r-400,r+parseInt(400*h.speed))))}if(h.sendTspi(i,h.dataOperated),0!=h.trajData._array.length){var a=[];for(var n in h.trajData._hash){var o=h.trajIndex.get(n);o<h.trajData._hash[n].length&&(a=o+parseInt(100*h.speed)>h.trajData._hash[n].length?a.concat(h.trajData._hash[n].slice(o,h.trajData._hash[n].length)):a.concat(h.trajData._hash[n].slice(o,o+parseInt(100*h.speed))),h.trainingClock.shouldAnimate?h.trajIndex.set(n,o+parseInt(100*h.speed)):a=a.concat(h.trajData._hash[n].slice(o-200,o+parseInt(200*h.speed))))}h.sendTraj(a,h.trajOperated)}if(0!=h.gtspiData.length&&(h.gtspiIndex+parseInt(50*h.speed)>=h.gtspiData.length?(e=h.gtspiData.slice(h.gtspiIndex,h.gtspiData.length),h.trainingClock.shouldAnimate&&(h.gtspiIndex=parseInt(h.gtspiData.length))):(e=h.gtspiData.slice(h.gtspiIndex,h.gtspiIndex+parseInt(50*h.speed)),h.trainingClock.shouldAnimate&&(h.gtspiIndex+=parseInt(50*h.speed))),0!=e.length&&h.sendGtspi(e)),0!=h.irsmData.length&&(t=h.irsmData.slice(h.irsmIndex,h.irsmIndex+parseInt(500*h.speed)),h.trainingClock.shouldAnimate&&(h.irsmIndex+=parseInt(500*h.speed)),0!=t.length&&h.addIrsm.raiseEvent(t)),0!=h.rtknData.length&&h.addRtkn.raiseEvent(h.rtknData.splice(0,h.rtknData.length)),0!=h.addEventArr.length&&h.addShowEvent.raiseEvent(h.addEventArr.splice(0,h.addEventArr.length)),0!=h.radarTarget._array.length){var s=[];for(var n in h.radarTarget._hash){var u=h.radarIndex.get(n);u<h.radarTarget._hash[n].length&&(s=u+parseInt(50*h.speed)>h.radarTarget._hash[n].length?s.concat(h.radarTarget._hash[n].slice(u,h.radarTarget._hash[n].length)):s.concat(h.radarTarget._hash[n].slice(u,u+parseInt(50*h.speed))),h.trainingClock.shouldAnimate?h.radarIndex.set(n,u+parseInt(50*h.speed)):s=s.concat(h.radarTarget._hash[n].slice(u-200,u+parseInt(200*h.speed))))}0!=s.length&&(s=s.sort(function(e,t){return e.header.datTime-t.header.datTime}),h.radarEvent.raiseEvent(s))}if(0!=h.ewsData._array.length){var l=[];for(var n in h.ewsData._hash){var c=h.ewsIndex.get(n);c<h.ewsData._hash[n].length&&(l=c+parseInt(50*h.speed)>h.ewsData._hash[n].length?l.concat(h.ewsData._hash[n].slice(c,h.ewsData._hash[n].length)):l.concat(h.ewsData._hash[n].slice(c,c+parseInt(50*h.speed))),h.trainingClock.shouldAnimate?h.ewsIndex.set(n,c+parseInt(50*h.speed)):l=l.concat(h.ewsData._hash[n].slice(c-100,c+parseInt(100*h.speed))))}0!=l.length&&(l=l.sort(function(e,t){return e.header.datTime-t.header.datTime}),h.ewsEvent.raiseEvent(l))}if(0!=h.sdrState._array.length){var m=[];for(var n in h.sdrState._hash){var d=h.sdrIndex.get(n);d<h.sdrState._hash[n].length&&(m=d+parseInt(20*h.speed)>h.sdrState._hash[n].length?m.concat(h.sdrState._hash[n].slice(d,h.sdrState._hash[n].length)):m.concat(h.sdrState._hash[n].slice(d,d+parseInt(20*h.speed))),h.trainingClock.shouldAnimate?h.sdrIndex.set(n,d+parseInt(20*h.speed)):m=m.concat(h.sdrState._hash[n].slice(d,u+parseInt(10*h.speed))))}0!=m.length&&(m=m.sort(function(e,t){return e.header.datTime-t.header.datTime}),h.sdrStateEvent.raiseEvent(m))}h.sendRadarMV&&(h.radarWM.raiseEvent(h.radarmvArr),h.sendRadarMV=!1)},1e3)},Zt.prototype.sendTspi=function(e,t){for(var i=this,n=(n=e).sort(function(e,t){return e.header.datTime-t.header.datTime}),r=0;r<n.length;r+=1){var a=n[r].header.sID,o=i.receiveMTFlightDatas.get(a);if(Cesium.defined(o))o.addTimeAttitude({realTime:n[r].header.datTime,fLon:n[r].fLon,fLat:n[r].fLat,fAlt:n[r].fAlt,position:n[r].position,nRedOrBlue:n[r].nRedOrBlue,headingPitchRoll:Cesium.HeadingPitchRoll.fromDegrees(n[r].fHeading,n[r].fPitch,n[r].fRoll),specialAttributes:{decoyDrop:n[r].decoyDrop,enginePower:n[r].enginePower,trainPro:n[r].trainPro,height:n[r].height,vel_east:n[r].vel_east,vel_north:n[r].vel_north,vel_up:n[r].vel_up,fHeading:n[r].fHeading,fPitch:n[r].fPitch,fRoll:n[r].fRoll}});else{if(!Cesium.defined(i.planeXml.get(n[r].header.planeType)))continue;var s=i.planeXml.get(n[r].header.planeType)._path,u=new jt({uId:n[r].header.sID,mtType:Gt.NET_MSG_TSPI,name:n[r].chFlyUser,modelType:n[r].header.planeType,modelUri:s,modelIconUri:void 0,iconColor:void 0,modelIconDisplayDistance:void 0,scale:Number(i.planeXml.get(n[r].header.planeType)._modelscale),forwardOffset:-15,upOffset:2,traceTimeDuration:20});u.addTimeAttitude({realTime:n[r].header.datTime,fLon:n[r].fLon,fLat:n[r].fLat,fAlt:n[r].fAlt,position:n[r].position,nRedOrBlue:n[r].nRedOrBlue,headingPitchRoll:Cesium.HeadingPitchRoll.fromDegrees(n[r].fHeading,n[r].fPitch,n[r].fRoll),specialAttributes:{decoyDrop:n[r].decoyDrop,enginePower:n[r].enginePower,trainPro:n[r].trainPro,height:n[r].height,vel_east:n[r].vel_east,vel_north:n[r].vel_north,vel_up:n[r].vel_up,fHeading:n[r].fHeading,fPitch:n[r].fPitch,fRoll:n[r].fRoll}}),i.receiveMTFlightDatas.set(u.uId,u),i.addAllRtkn.push(n[r])}}i.receiveData.raiseEvent(i.receiveMTFlightDatas,t),i.dataOperated=Kt.ADD,i.receiveMTFlightDatas._array.forEach(function(e){e.timeAttitudeCollection=[]})},Zt.prototype.sendTraj=function(e,t){for(var i=this,n=e.sort(function(e,t){return e.header.datTime-t.header.datTime}),r=0;r<n.length;r++){var a=n[r].header.sID+"_"+n[r].weaponID,o=i.redOrBlue.get(n[r].header.sID);if(Cesium.defined(o)){if(1==o.length)n[r].nRedOrBlue=o[0].nRedOrBlue;else for(var s=1;s<o.length;s++)n[r].header.datTime>=o[s].time&&(n[r].nRedOrBlue=o[s].nRedOrBlue);var u=i.receiveTrajFlightDatas.get(a);if(Cesium.defined(u))u.addTimeAttitude({realTime:n[r].header.datTime,fLon:n[r].mslLongitude,fLat:n[r].mslLatitude,fAlt:n[r].mslAltitude,position:n[r].position,nRedOrBlue:n[r].nRedOrBlue,headingPitchRoll:Cesium.HeadingPitchRoll.fromDegrees(n[r].mslCourse,n[r].mslPitch,0),specialAttributes:{weaponID:n[r].weaponID,vel:n[r].vel,mslDistance:n[r].mslDistance,targetID:n[r].targetID,weaponType:n[r].weaponType,mslAltitude:n[r].mslAltitude}});else{if(!Cesium.defined(i.missileXml.get(n[r].weaponType)))continue;var l=i.missileXml.get(n[r].weaponType)._path,c=new jt({uId:a,mtType:Gt.NET_MSG_WPN_TRAJ,name:i.missileXml.get(n[r].weaponType)._modelName,modelType:n[r].weaponType,modelUri:l,modelIconUri:void 0,iconColor:void 0,modelIconDisplayDistance:void 0,scale:Number(i.missileXml.get(n[r].weaponType)._modelscale),forwardOffset:-15,upOffset:2,traceTimeDuration:20,specialAttributes:{targetID:n[r].targetID}});c.addTimeAttitude({realTime:n[r].header.datTime,fLon:n[r].mslLongitude,fLat:n[r].mslLatitude,fAlt:n[r].mslAltitude,position:n[r].position,nRedOrBlue:n[r].nRedOrBlue,headingPitchRoll:Cesium.HeadingPitchRoll.fromDegrees(n[r].mslCourse,n[r].mslPitch,0),specialAttributes:{weaponID:n[r].weaponID,vel:n[r].vel,mslDistance:n[r].mslDistance,targetID:n[r].targetID,weaponType:n[r].weaponType,mslAltitude:n[r].mslAltitude}}),i.receiveTrajFlightDatas.set(c.uId,c)}}}i.receiveData.raiseEvent(i.receiveTrajFlightDatas,t),i.trajOperated=Kt.ADD,i.receiveTrajFlightDatas._array.forEach(function(e){e.timeAttitudeCollection=[]})},Zt.prototype.sendGtspi=function(e){for(var t=this,i=e,n=0;n<i.length;n++){var r=i[n].header.sID+"_"+i[n].equipmentID+"_"+i[n].equipmentType,a=Jt(t.combatpower,i[n]),o=t.receiveGtspiFlightDatas.get(r);if(Cesium.defined(o))o.addTimeAttitude({realTime:i[n].header.datTime,fLon:i[n].gTspiLon,fLat:i[n].gTspiLat,fAlt:i[n].gTspiAlt,position:i[n].position,nRedOrBlue:a,headingPitchRoll:Cesium.HeadingPitchRoll.fromDegrees(i[n].northAngle,0,0),specialAttributes:{fakeCampID:i[n].fakeCampID,campType:i[n].campType,equipmentType:i[n].equipmentType,equipmentID:i[n].equipmentID,gTspiState:i[n].gTspiState}});else{if(!Cesium.defined(t.gtspiXml.get(i[n].campType)))continue;var s=t.gtspiXml.get(i[n].campType).srdtype.find(function(e){return e._id==i[n].equipmentType}),u=s._path,l=new jt({uId:r,mtType:Gt.NET_MSG_GTSPI,name:s._desc,modelType:i[n].equipmentType,modelUri:u,modelIconUri:void 0,iconColor:void 0,modelIconDisplayDistance:void 0,scale:Number(s._modelscale)});l.addTimeAttitude({realTime:i[n].header.datTime,fLon:i[n].gTspiLon,fLat:i[n].gTspiLat,fAlt:i[n].gTspiAlt,position:i[n].position,nRedOrBlue:a,headingPitchRoll:Cesium.HeadingPitchRoll.fromDegrees(i[n].northAngle,0,0),specialAttributes:{}}),t.receiveGtspiFlightDatas.set(l.uId,l)}}t.receiveData.raiseEvent(t.receiveGtspiFlightDatas),t.receiveGtspiFlightDatas._array.forEach(function(e){e.timeAttitudeCollection=[]})},Zt.prototype.splitTwo=function(e,t){for(var i=0,n=t.length-1;i<=n;){var r=Math.ceil((n+i)/2);if(1==n)return t[0];if(null==t[r+1])return t[r];if(t[r].header.datTime<=e&&t[r+1].header.datTime>e)return t[r+1];if(t[r].header.datTime<e)i=r;else{if(!(t[r].header.datTime>e))return-1;n=r}}},Qt.prototype.Point_Connection=function(e,t,i,n){this.viewer.entities.add({polyline:{positions:e,width:1,material:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.YELLOW,outlineWidth:1,outlineColor:Cesium.Color.YELLOW})},id:t}),this.viewer.entities.add({position:i,label:{text:n,font:"15px sans-serif",name:t},id:t+"pop"})},Qt.prototype.RemoveLine=function(e){for(var i=this,t=0;t<e.length;t++)n(e[t]),n(e[t]+"pop");function n(e){var t=i.viewer.entities.getById(e);i.viewer.entities.remove(t)}};var $t="attribute vec4 position;\nattribute vec3 normal;\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\ngl_Position = czm_modelViewProjection * position;\nv_position = vec3(position);\nv_positionWC = (czm_model * position).xyz;\nv_positionEC = (czm_modelView * position).xyz;\nv_normalEC = czm_normal * normal;\n}\n",ei="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\nuniform float u_radius;\nuniform float u_xHalfAngle;\nuniform float u_yHalfAngle;\nuniform float u_normalDirection;\nuniform float u_type;\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\nczm_materialInput materialInput;\nvec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\nmaterialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\nmaterialInput.str = pointMC / sensorRadius;\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nvec3 normalEC = normalize(v_normalEC);\nmaterialInput.normalEC = u_normalDirection * normalEC;\nczm_material material = czm_getMaterial(materialInput);\nreturn mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\n}\nbool isOnBoundary(float value, float epsilon)\n{\nfloat width = getIntersectionWidth();\nfloat tolerance = width * epsilon;\n#ifdef GL_OES_standard_derivatives\nfloat delta = max(abs(dFdx(value)), abs(dFdy(value)));\nfloat pixels = width * delta;\nfloat temp = abs(value);\nreturn temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\n#else\nreturn abs(value) < tolerance;\n#endif\n}\nvec4 shade(bool isOnBoundary)\n{\nif (u_showIntersection && isOnBoundary)\n{\nreturn getIntersectionColor();\n}\nif(u_type == 1.0){\nreturn getLineColor();\n}\nreturn getColor(u_radius, v_positionEC);\n}\nvoid main()\n{\nvec3 sensorVertexWC = czm_model[3].xyz;\nvec3 sensorVertexEC = czm_modelView[3].xyz;\nfloat positionX = v_position.x;\nfloat positionY = v_position.y;\nfloat positionZ = v_position.z;\nvec3 zDir = vec3(0.0, 0.0, 1.0);\nvec3 lineX = vec3(positionX, 0 ,positionZ);\nvec3 lineY = vec3(0, positionY, positionZ);\nfloat resX = dot(normalize(lineX), zDir);\nif(resX < cos(u_xHalfAngle)-0.00001){\ndiscard;\n}\nfloat resY = dot(normalize(lineY), zDir);\nif(resY < cos(u_yHalfAngle)-0.00001){\ndiscard;\n}\nbool isOnEllipsoid = false;\ngl_FragColor = shade(isOnEllipsoid);\n}\n",ti="uniform vec4 u_intersectionColor;\nuniform float u_intersectionWidth;\nuniform vec4 u_lineColor;\nbool inSensorShadow(vec3 coneVertexWC, vec3 pointWC)\n{\nvec3 D = czm_ellipsoidInverseRadii;\nvec3 q = D * coneVertexWC;\nfloat qMagnitudeSquared = dot(q, q);\nfloat test = qMagnitudeSquared - 1.0;\nvec3 temp = D * pointWC - q;\nfloat d = dot(temp, q);\nreturn (d < -test) && (d / length(temp) < -sqrt(test));\n}\nvec4 getLineColor()\n{\nreturn u_lineColor;\n}\nvec4 getIntersectionColor()\n{\nreturn u_intersectionColor;\n}\nfloat getIntersectionWidth()\n{\nreturn u_intersectionWidth;\n}\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\nfloat t = pointMC.z / sensorRadius;\nfloat s = 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\ns = s - floor(s);\nreturn vec2(s, t);\n}\n",ii="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\nuniform float u_radius;\nuniform float u_xHalfAngle;\nuniform float u_yHalfAngle;\nuniform float u_normalDirection;\nuniform vec4 u_color;\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\nczm_materialInput materialInput;\nvec3 pointMC = (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\nmaterialInput.st = sensor2dTextureCoordinates(sensorRadius, pointMC);\nmaterialInput.str = pointMC / sensorRadius;\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nvec3 normalEC = normalize(v_normalEC);\nmaterialInput.normalEC = u_normalDirection * normalEC;\nczm_material material = czm_getMaterial(materialInput);\nmaterial.diffuse = u_color.rgb;\nmaterial.alpha = u_color.a;\nreturn mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\n}\nbool isOnBoundary(float value, float epsilon)\n{\nfloat width = getIntersectionWidth();\nfloat tolerance = width * epsilon;\n#ifdef GL_OES_standard_derivatives\nfloat delta = max(abs(dFdx(value)), abs(dFdy(value)));\nfloat pixels = width * delta;\nfloat temp = abs(value);\nreturn temp < tolerance && temp < pixels || (delta < 10.0 * tolerance && temp - delta < tolerance && temp < pixels);\n#else\nreturn abs(value) < tolerance;\n#endif\n}\nvec4 shade(bool isOnBoundary)\n{\nif (u_showIntersection && isOnBoundary)\n{\nreturn getIntersectionColor();\n}\nreturn getColor(u_radius, v_positionEC);\n}\nvoid main()\n{\nvec3 sensorVertexWC = czm_model[3].xyz;\nvec3 sensorVertexEC = czm_modelView[3].xyz;\nfloat positionX = v_position.x;\nfloat positionY = v_position.y;\nfloat positionZ = v_position.z;\nvec3 zDir = vec3(0.0, 0.0, 1.0);\nvec3 lineX = vec3(positionX, 0 ,positionZ);\nvec3 lineY = vec3(0, positionY, positionZ);\nbool isOnEllipsoid =true;\ngl_FragColor = shade(isOnEllipsoid);\n}\n";function ni(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(e)}ni.prototype.init_genrand=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},ni.prototype.genrand_int32=function(){var e,t,i=new Array(0,this.MATRIX_A);if(this.mti>=this.N){for(this.mti==this.N+1&&this.init_genrand(5489),t=0;t<this.N-this.M;t++)e=this.mt[t]&this.UPPER_MASK|this.mt[t+1]&this.LOWER_MASK,this.mt[t]=this.mt[t+this.M]^e>>>1^i[1&e];for(;t<this.N-1;t++)e=this.mt[t]&this.UPPER_MASK|this.mt[t+1]&this.LOWER_MASK,this.mt[t]=this.mt[t+(this.M-this.N)]^e>>>1^i[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^i[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},ni.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};var ri={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296};ri.sign=z(Math.sign,function(e){return 0===(e=+e)||e!=e?e:0<e?1:-1}),ri.signNotZero=function(e){return e<0?-1:1},ri.toSNorm=function(e,t){return t=z(t,255),Math.round((.5*ri.clamp(e,-1,1)+.5)*t)},ri.fromSNorm=function(e,t){return t=z(t,255),ri.clamp(e,0,t)/t*2-1},ri.normalize=function(e,t,i){return 0===(i=Math.max(i-t,0))?0:ri.clamp((e-t)/i,0,1)},ri.sinh=z(Math.sinh,function(e){return(Math.exp(e)-Math.exp(-e))/2}),ri.cosh=z(Math.cosh,function(e){return(Math.exp(e)+Math.exp(-e))/2}),ri.lerp=function(e,t,i){return(1-i)*e+i*t},ri.PI=Math.PI,ri.ONE_OVER_PI=1/Math.PI,ri.PI_OVER_TWO=Math.PI/2,ri.PI_OVER_THREE=Math.PI/3,ri.PI_OVER_FOUR=Math.PI/4,ri.PI_OVER_SIX=Math.PI/6,ri.THREE_PI_OVER_TWO=3*Math.PI/2,ri.TWO_PI=2*Math.PI,ri.ONE_OVER_TWO_PI=1/(2*Math.PI),ri.RADIANS_PER_DEGREE=Math.PI/180,ri.DEGREES_PER_RADIAN=180/Math.PI,ri.RADIANS_PER_ARCSECOND=ri.RADIANS_PER_DEGREE/3600,ri.toRadians=function(e){return e*ri.RADIANS_PER_DEGREE},ri.toDegrees=function(e){return e*ri.DEGREES_PER_RADIAN},ri.convertLongitudeRange=function(e){var t=ri.TWO_PI,i=e-Math.floor(e/t)*t;return i<-Math.PI?i+t:i>=Math.PI?i-t:i},ri.clampToLatitudeRange=function(e){return ri.clamp(e,-1*ri.PI_OVER_TWO,ri.PI_OVER_TWO)},ri.negativePiToPi=function(e){return ri.zeroToTwoPi(e+ri.PI)-ri.PI},ri.zeroToTwoPi=function(e){var t=ri.mod(e,ri.TWO_PI);return Math.abs(t)<ri.EPSILON14&&Math.abs(e)>ri.EPSILON14?ri.TWO_PI:t},ri.mod=function(e,t){return(e%t+t)%t},ri.equalsEpsilon=function(e,t,i,n){n=z(n,i);var r=Math.abs(e-t);return r<=n||r<=i*Math.max(Math.abs(e),Math.abs(t))},ri.lessThan=function(e,t,i){return e-t<-i},ri.lessThanOrEquals=function(e,t,i){return e-t<i},ri.greaterThan=function(e,t,i){return i<e-t},ri.greaterThanOrEquals=function(e,t,i){return-i<e-t};var ai=[1];ri.factorial=function(e){var t=ai.length;if(t<=e)for(var i=ai[t-1],n=t;n<=e;n++){var r=i*n;ai.push(r),i=r}return ai[e]},ri.incrementWrap=function(e,t,i){return i=z(i,0),t<++e&&(e=i),e},ri.isPowerOfTwo=function(e){return 0!==e&&0==(e&e-1)},ri.nextPowerOfTwo=function(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},ri.clamp=function(e,t,i){return e<t?t:i<e?i:e};var oi=new ni;function si(e,t,i){this.x=z(e,0),this.y=z(t,0),this.z=z(i,0)}ri.setRandomNumberSeed=function(e){oi=new ni(e)},ri.nextRandomNumber=function(){return oi.random()},ri.randomBetween=function(e,t){return ri.nextRandomNumber()*(t-e)+e},ri.acosClamped=function(e){return Math.acos(ri.clamp(e,-1,1))},ri.asinClamped=function(e){return Math.asin(ri.clamp(e,-1,1))},ri.chordLength=function(e,t){return 2*t*Math.sin(.5*e)},ri.logBase=function(e,t){return Math.log(e)/Math.log(t)},ri.cbrt=z(Math.cbrt,function(e){var t=Math.pow(Math.abs(e),1/3);return e<0?-t:t}),ri.log2=z(Math.log2,function(e){return Math.log(e)*Math.LOG2E}),ri.fog=function(e,t){var i=e*t;return 1-Math.exp(-i*i)},ri.fastApproximateAtan=function(e){return e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)},ri.fastApproximateAtan2=function(e,t){var i=Math.abs(e),n=Math.abs(t),r=Math.max(i,n),a=(n=Math.min(i,n))/r,i=ri.fastApproximateAtan(a);return i=Math.abs(t)>Math.abs(e)?ri.PI_OVER_TWO-i:i,i=e<0?ri.PI-i:i,i=t<0?-i:i},si.fromSpherical=function(e,t){oe(t)||(t=new si);var i=e.clock,n=e.cone,r=z(e.magnitude,1),a=r*Math.sin(n);return t.x=a*Math.cos(i),t.y=a*Math.sin(i),t.z=r*Math.cos(n),t},si.fromElements=function(e,t,i,n){return oe(n)?(n.x=e,n.y=t,n.z=i,n):new si(e,t,i)},si.fromCartesian4=si.clone=function(e,t){if(oe(e))return oe(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t):new si(e.x,e.y,e.z)},si.packedLength=3,si.pack=function(e,t,i){return i=z(i,0),t[i++]=e.x,t[i++]=e.y,t[i]=e.z,t},si.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new si),i.x=e[t++],i.y=e[t++],i.z=e[t],i},si.packArray=function(e,t){var i=e.length,n=3*i;if(oe(t)){if(!Array.isArray(t)&&t.length!==n)throw new x("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==n&&(t.length=n)}else t=new Array(n);for(var r=0;r<i;++r)si.pack(e[r],t,3*r);return t},si.unpackArray=function(e,t){var i=e.length;oe(t)?t.length=i/3:t=new Array(i/3);for(var n=0;n<i;n+=3){var r=n/3;t[r]=si.unpack(e,n,t[r])}return t},si.fromArray=si.unpack,si.maximumComponent=function(e){return Math.max(e.x,e.y,e.z)},si.minimumComponent=function(e){return Math.min(e.x,e.y,e.z)},si.minimumByComponent=function(e,t,i){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i},si.maximumByComponent=function(e,t,i){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i},si.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},si.magnitude=function(e){return Math.sqrt(si.magnitudeSquared(e))};var ui=new si;si.distance=function(e,t){return si.subtract(e,t,ui),si.magnitude(ui)},si.distanceSquared=function(e,t){return si.subtract(e,t,ui),si.magnitudeSquared(ui)},si.normalize=function(e,t){var i=si.magnitude(e);return oe(t)||(t=new si),t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t},si.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},si.multiplyComponents=function(e,t,i){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i},si.divideComponents=function(e,t,i){return i.x=e.x/t.x,i.y=e.y/t.y,i.z=e.z/t.z,i},si.add=function(e,t,i){return oe(i)||(i=new si),i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i},si.subtract=function(e,t,i){return oe(i)||(i=new si),i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i},si.multiplyByScalar=function(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i},si.divideByScalar=function(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i},si.negate=function(e,t){return oe(t)||(t=new si),t.x=-e.x,t.y=-e.y,t.z=-e.z,t},si.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t};var li=new si;si.lerp=function(e,t,i,n){return si.multiplyByScalar(t,i,li),n=si.multiplyByScalar(e,1-i,n),si.add(li,n,n)};var ci=new si,mi=new si;si.angleBetween=function(e,t){si.normalize(e,ci),si.normalize(t,mi);var i=si.dot(ci,mi),n=si.magnitude(si.cross(ci,mi,ci));return Math.atan2(n,i)};var di=new si;si.mostOrthogonalAxis=function(e,t){var i=si.normalize(e,di);return si.abs(i,i),t=i.x<=i.y?i.x<=i.z?si.clone(si.UNIT_X,t):si.clone(si.UNIT_Z,t):i.y<=i.z?si.clone(si.UNIT_Y,t):si.clone(si.UNIT_Z,t)},si.projectVector=function(e,t,i){var n=si.dot(e,t)/si.dot(t,t);return si.multiplyByScalar(t,n,i)},si.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z},si.equalsArray=function(e,t,i){return e.x===t[i]&&e.y===t[i+1]&&e.z===t[i+2]},si.equalsEpsilon=function(e,t,i,n){return e===t||oe(e)&&oe(t)&&ri.equalsEpsilon(e.x,t.x,i,n)&&ri.equalsEpsilon(e.y,t.y,i,n)&&ri.equalsEpsilon(e.z,t.z,i,n)},si.cross=function(e,t,i){var n=e.x,r=e.y,a=e.z,o=t.x,s=t.y,u=t.z,l=r*u-a*s,c=a*o-n*u,m=n*s-r*o;return i.x=l,i.y=c,i.z=m,i},si.midpoint=function(e,t,i){return i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y),i.z=.5*(e.z+t.z),i},si.fromDegrees=function(e,t,i,n,r){return e=ri.toRadians(e),t=ri.toRadians(t),si.fromRadians(e,t,i,n,r)};var hi=new si,fi=new si;function pi(e,t,i,n,r,a,o,s,u){this[0]=z(e,0),this[1]=z(n,0),this[2]=z(o,0),this[3]=z(t,0),this[4]=z(r,0),this[5]=z(s,0),this[6]=z(i,0),this[7]=z(a,0),this[8]=z(u,0)}si.wgs84RadiiSquared=new si(40680631590769,40680631590769,40408299984661.445),si.fromRadians=function(e,t,i,n,r){i=z(i,0);var a=oe(n)?n.radiiSquared:this.wgs84RadiiSquared,o=Math.cos(t);hi.x=o*Math.cos(e),hi.y=o*Math.sin(e),hi.z=Math.sin(t),hi=si.normalize(hi,hi),si.multiplyComponents(a,hi,fi);var s=Math.sqrt(si.dot(hi,fi));return fi=si.divideByScalar(fi,s,fi),hi=si.multiplyByScalar(hi,i,hi),oe(r)||(r=new si),si.add(fi,hi,r)},si.fromDegreesArray=function(e,t,i){var n=e.length;oe(i)?i.length=n/2:i=new Array(n/2);for(var r=0;r<n;r+=2){var a=e[r],o=e[r+1],s=r/2;i[s]=si.fromDegrees(a,o,0,t,i[s])}return i},si.fromRadiansArray=function(e,t,i){var n=e.length;oe(i)?i.length=n/2:i=new Array(n/2);for(var r=0;r<n;r+=2){var a=e[r],o=e[r+1],s=r/2;i[s]=si.fromRadians(a,o,0,t,i[s])}return i},si.fromDegreesArrayHeights=function(e,t,i){var n=e.length;oe(i)?i.length=n/3:i=new Array(n/3);for(var r=0;r<n;r+=3){var a=e[r],o=e[r+1],s=e[r+2],u=r/3;i[u]=si.fromDegrees(a,o,s,t,i[u])}return i},si.fromRadiansArrayHeights=function(e,t,i){var n=e.length;oe(i)?i.length=n/3:i=new Array(n/3);for(var r=0;r<n;r+=3){var a=e[r],o=e[r+1],s=e[r+2],u=r/3;i[u]=si.fromRadians(a,o,s,t,i[u])}return i},si.ZERO=Object.freeze(new si(0,0,0)),si.UNIT_X=Object.freeze(new si(1,0,0)),si.UNIT_Y=Object.freeze(new si(0,1,0)),si.UNIT_Z=Object.freeze(new si(0,0,1)),si.prototype.clone=function(e){return si.clone(this,e)},si.prototype.equals=function(e){return si.equals(this,e)},si.prototype.equalsEpsilon=function(e,t,i){return si.equalsEpsilon(this,e,t,i)},si.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},pi.packedLength=9,pi.pack=function(e,t,i){return i=z(i,0),t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t[i++]=e[4],t[i++]=e[5],t[i++]=e[6],t[i++]=e[7],t[i++]=e[8],t},pi.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new pi),i[0]=e[t++],i[1]=e[t++],i[2]=e[t++],i[3]=e[t++],i[4]=e[t++],i[5]=e[t++],i[6]=e[t++],i[7]=e[t++],i[8]=e[t++],i},pi.clone=function(e,t){if(oe(e))return oe(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):new pi(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},pi.fromArray=function(e,t,i){return t=z(t,0),oe(i)||(i=new pi),i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],i[4]=e[t+4],i[5]=e[t+5],i[6]=e[t+6],i[7]=e[t+7],i[8]=e[t+8],i},pi.fromColumnMajorArray=function(e,t){return pi.clone(e,t)},pi.fromRowMajorArray=function(e,t){return oe(t)?(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t):new pi(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},pi.fromQuaternion=function(e,t){var i=e.x*e.x,n=e.x*e.y,r=e.x*e.z,a=e.x*e.w,o=e.y*e.y,s=e.y*e.z,u=e.y*e.w,l=e.z*e.z,c=e.z*e.w,m=e.w*e.w,d=i-o-l+m,h=2*(n-c),f=2*(r+u),p=2*(n+c),_=o-i-l+m,C=2*(s-a),g=2*(r-u),v=2*(s+a),y=-i-o+l+m;return oe(t)?(t[0]=d,t[1]=p,t[2]=g,t[3]=h,t[4]=_,t[5]=v,t[6]=f,t[7]=C,t[8]=y,t):new pi(d,h,f,p,_,C,g,v,y)},pi.fromHeadingPitchRoll=function(e,t){var i=Math.cos(-e.pitch),n=Math.cos(-e.heading),r=Math.cos(e.roll),a=Math.sin(-e.pitch),o=Math.sin(-e.heading),s=Math.sin(e.roll),u=i*n,l=-r*o+s*a*n,c=s*o+r*a*n,m=i*o,d=r*n+s*a*o,h=-s*n+r*a*o,f=-a,p=s*i,_=r*i;return oe(t)?(t[0]=u,t[1]=m,t[2]=f,t[3]=l,t[4]=d,t[5]=p,t[6]=c,t[7]=h,t[8]=_,t):new pi(u,l,c,m,d,h,f,p,_)},pi.fromScale=function(e,t){return oe(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t):new pi(e.x,0,0,0,e.y,0,0,0,e.z)},pi.fromUniformScale=function(e,t){return oe(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=e,t):new pi(e,0,0,0,e,0,0,0,e)},pi.fromCrossProduct=function(e,t){return oe(t)?(t[0]=0,t[1]=e.z,t[2]=-e.y,t[3]=-e.z,t[4]=0,t[5]=e.x,t[6]=e.y,t[7]=-e.x,t[8]=0,t):new pi(0,-e.z,e.y,e.z,0,-e.x,-e.y,e.x,0)},pi.fromRotationX=function(e,t){var i=Math.cos(e),n=Math.sin(e);return oe(t)?(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=i,t[5]=n,t[6]=0,t[7]=-n,t[8]=i,t):new pi(1,0,0,0,i,-n,0,n,i)},pi.fromRotationY=function(e,t){var i=Math.cos(e),n=Math.sin(e);return oe(t)?(t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=1,t[5]=0,t[6]=n,t[7]=0,t[8]=i,t):new pi(i,0,n,0,1,0,-n,0,i)},pi.fromRotationZ=function(e,t){var i=Math.cos(e),n=Math.sin(e);return oe(t)?(t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new pi(i,-n,0,n,i,0,0,0,1)},pi.toArray=function(e,t){return oe(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},pi.getElementIndex=function(e,t){return 3*e+t},pi.getColumn=function(e,t,i){var n=3*t,r=e[n],a=e[1+n],o=e[2+n];return i.x=r,i.y=a,i.z=o,i},pi.setColumn=function(e,t,i,n){var r=3*t;return(n=pi.clone(e,n))[r]=i.x,n[1+r]=i.y,n[2+r]=i.z,n},pi.getRow=function(e,t,i){var n=e[t],r=e[t+3],a=e[t+6];return i.x=n,i.y=r,i.z=a,i},pi.setRow=function(e,t,i,n){return(n=pi.clone(e,n))[t]=i.x,n[t+3]=i.y,n[t+6]=i.z,n};var _i=new si;pi.getScale=function(e,t){return t.x=si.magnitude(si.fromElements(e[0],e[1],e[2],_i)),t.y=si.magnitude(si.fromElements(e[3],e[4],e[5],_i)),t.z=si.magnitude(si.fromElements(e[6],e[7],e[8],_i)),t};var Ci=new si;pi.getMaximumScale=function(e){return pi.getScale(e,Ci),si.maximumComponent(Ci)},pi.multiply=function(e,t,i){var n=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],r=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],a=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],o=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],s=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],u=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],l=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],c=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],m=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return i[0]=n,i[1]=r,i[2]=a,i[3]=o,i[4]=s,i[5]=u,i[6]=l,i[7]=c,i[8]=m,i},pi.add=function(e,t,i){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i[4]=e[4]+t[4],i[5]=e[5]+t[5],i[6]=e[6]+t[6],i[7]=e[7]+t[7],i[8]=e[8]+t[8],i},pi.subtract=function(e,t,i){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i[4]=e[4]-t[4],i[5]=e[5]-t[5],i[6]=e[6]-t[6],i[7]=e[7]-t[7],i[8]=e[8]-t[8],i},pi.multiplyByVector=function(e,t,i){var n=t.x,r=t.y,a=t.z,o=e[0]*n+e[3]*r+e[6]*a,s=e[1]*n+e[4]*r+e[7]*a,u=e[2]*n+e[5]*r+e[8]*a;return i.x=o,i.y=s,i.z=u,i},pi.multiplyByScalar=function(e,t,i){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i},pi.multiplyByScale=function(e,t,i){return i[0]=e[0]*t.x,i[1]=e[1]*t.x,i[2]=e[2]*t.x,i[3]=e[3]*t.y,i[4]=e[4]*t.y,i[5]=e[5]*t.y,i[6]=e[6]*t.z,i[7]=e[7]*t.z,i[8]=e[8]*t.z,i},pi.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t},pi.transpose=function(e,t){var i=e[0],n=e[3],r=e[6],a=e[1],o=e[4],s=e[7],u=e[2],l=e[5],c=e[8];return t[0]=i,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=s,t[6]=u,t[7]=l,t[8]=c,t};var gi=new si(1,1,1);pi.getRotation=function(e,t){var i=si.divideComponents(gi,pi.getScale(e,Ci),Ci);return t=pi.multiplyByScale(e,i,t)};var vi=[1,0,0],yi=[2,2,1];function Ti(e){for(var t=0,i=0;i<3;++i){var n=e[pi.getElementIndex(yi[i],vi[i])];t+=2*n*n}return Math.sqrt(t)}function xi(e,t){for(var i=ri.EPSILON15,n=0,r=1,a=0;a<3;++a){var o=Math.abs(e[pi.getElementIndex(yi[a],vi[a])]);n<o&&(r=a,n=o)}var s,u,l=1,c=0,m=vi[r],d=yi[r];return Math.abs(e[pi.getElementIndex(d,m)])>i&&(c=(u=(s=(e[pi.getElementIndex(d,d)]-e[pi.getElementIndex(m,m)])/2/e[pi.getElementIndex(d,m)])<0?-1/(-s+Math.sqrt(1+s*s)):1/(s+Math.sqrt(1+s*s)))*(l=1/Math.sqrt(1+u*u))),(t=pi.clone(pi.IDENTITY,t))[pi.getElementIndex(m,m)]=t[pi.getElementIndex(d,d)]=l,t[pi.getElementIndex(d,m)]=c,t[pi.getElementIndex(m,d)]=-c,t}var wi=new pi,Ai=new pi;pi.computeEigenDecomposition=function(e,t){var i=ri.EPSILON20,n=0,r=0;oe(t)||(t={});for(var a=t.unitary=pi.clone(pi.IDENTITY,t.unitary),o=t.diagonal=pi.clone(e,t.diagonal),s=i*function(e){for(var t=0,i=0;i<9;++i){var n=e[i];t+=n*n}return Math.sqrt(t)}(o);r<10&&Ti(o)>s;)xi(o,wi),pi.transpose(wi,Ai),pi.multiply(o,wi,o),pi.multiply(Ai,o,o),pi.multiply(a,wi,a),2<++n&&(++r,n=0);return t},pi.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t},pi.determinant=function(e){var t=e[0],i=e[3],n=e[6],r=e[1],a=e[4],o=e[7],s=e[2],u=e[5],l=e[8];return t*(a*l-u*o)+r*(u*n-i*l)+s*(i*o-a*n)},pi.inverse=function(e,t){var i=e[0],n=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],m=pi.determinant(e);return t[0]=o*c-l*s,t[1]=l*r-n*c,t[2]=n*s-o*r,t[3]=u*s-a*c,t[4]=i*c-u*r,t[5]=a*r-i*s,t[6]=a*l-u*o,t[7]=u*n-i*l,t[8]=i*o-a*n,pi.multiplyByScalar(t,1/m,t)},pi.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},pi.equalsEpsilon=function(e,t,i){return e===t||oe(e)&&oe(t)&&Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i&&Math.abs(e[4]-t[4])<=i&&Math.abs(e[5]-t[5])<=i&&Math.abs(e[6]-t[6])<=i&&Math.abs(e[7]-t[7])<=i&&Math.abs(e[8]-t[8])<=i},pi.IDENTITY=Object.freeze(new pi(1,0,0,0,1,0,0,0,1)),pi.ZERO=Object.freeze(new pi(0,0,0,0,0,0,0,0,0)),pi.COLUMN0ROW0=0,pi.COLUMN0ROW1=1,pi.COLUMN0ROW2=2,pi.COLUMN1ROW0=3,pi.COLUMN1ROW1=4,pi.COLUMN1ROW2=5,pi.COLUMN2ROW0=6,pi.COLUMN2ROW1=7,pi.COLUMN2ROW2=8,Object.defineProperties(pi.prototype,{length:{get:function(){return pi.packedLength}}}),pi.prototype.clone=function(e){return pi.clone(this,e)},pi.prototype.equals=function(e){return pi.equals(this,e)},pi.equalsArray=function(e,t,i){return e[0]===t[i]&&e[1]===t[i+1]&&e[2]===t[i+2]&&e[3]===t[i+3]&&e[4]===t[i+4]&&e[5]===t[i+5]&&e[6]===t[i+6]&&e[7]===t[i+7]&&e[8]===t[i+8]},pi.prototype.equalsEpsilon=function(e,t){return pi.equalsEpsilon(this,e,t)},pi.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"};var Ei={position:0,normal:1};function Si(e){var t=this;if(!Cesium.defined(e))throw new Cesium.DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new Cesium.DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.position))throw new Cesium.DeveloperError("位置参数options.position不能为空。");this.viewer=e.viewer,this.id=e.id,this._scene=this.viewer.scene,this._position=e.position,this.show=Cesium.defaultValue(e.show,!0),this._show=void 0,this.showDomeSurfaces=Cesium.defaultValue(e.showDomeSurfaces,!0),this.slice=Cesium.defaultValue(e.slice,32),this.modelMatrix=Cesium.defaultValue(e.modelMatrix,void 0),this._modelMatrix=new Cesium.Matrix4,this._computedModelMatrix=new Cesium.Matrix4,this._computedScanPlaneModelMatrix=new Cesium.Matrix4,this.radius=Cesium.defaultValue(e.radius,Number.POSITIVE_INFINITY),this._radius=void 0,this.xHalfAngle=Cesium.Math.toRadians(90),this._xHalfAngle=void 0,this.yHalfAngle=Cesium.Math.toRadians(90),this._yHalfAngle=void 0,this.lineColor=Cesium.defaultValue(e.color,new Cesium.Color(0,1,0,.5)),this.showLateralSurfaces=Cesium.defaultValue(e.showLateralSurfaces,!1),this.material=Cesium.defaultValue(e.material,new Cesium.Material({fabric:{type:"Color",uniforms:{color:this.lineColor}}})),this._material=void 0,this._translucent=void 0,this.showIntersection=Cesium.defaultValue(e.showIntersection,!1),this.intersectionColor=Cesium.defaultValue(e.intersectionColor,Cesium.Color.WHITE),this.intersectionWidth=Cesium.defaultValue(e.intersectionWidth,5),this.showThroughEllipsoid=Cesium.defaultValue(e.showThroughEllipsoid,!0),this._showThroughEllipsoid=void 0,this.showScanPlane=Cesium.defaultValue(e.showScanPlane,!0),this.scanPlaneColor=Cesium.defaultValue(e.scanPlaneColor,Cesium.Color.WHITE),this.scanPlaneRate=Cesium.defaultValue(e.scanPlaneRate,100),this._scanePlaneXHalfAngle=0,this._scanePlaneYHalfAngle=0,this._timeDiff=0,this._boundingSphere=new Cesium.BoundingSphere,this._boundingSphereWC=new Cesium.BoundingSphere,this._sectorFrontCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorBackCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._sectorVA=void 0,this._sectorLineCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.LINES,boundingVolume:this._boundingSphereWC}),this._sectorLineVA=void 0,this._sectorSegmentLineCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.LINES,boundingVolume:this._boundingSphereWC}),this._sectorSegmentLineVA=void 0,this._domeFrontCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeBackCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._domeVA=void 0,this._domeLineCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.LINES,boundingVolume:this._boundingSphereWC}),this._domeLineVA=void 0,this._scanPlaneFrontCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanPlaneBackCommand=new Cesium.DrawCommand({owner:this,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingVolume:this._boundingSphereWC}),this._scanRadialCommand=void 0,this._colorCommands=[],this._frontFaceRS=void 0,this._backFaceRS=void 0,this._sp=void 0,this._uniforms={u_type:function(){return 0},u_xHalfAngle:function(){return t.xHalfAngle},u_yHalfAngle:function(){return t.yHalfAngle},u_radius:function(){return t._radius},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}},this._scanUniforms={u_xHalfAngle:function(){return t._scanePlaneXHalfAngle},u_yHalfAngle:function(){return t._scanePlaneYHalfAngle},u_radius:function(){return t._radius},u_color:function(){return t.scanPlaneColor},u_showThroughEllipsoid:function(){return t.showThroughEllipsoid},u_showIntersection:function(){return t.showIntersection},u_intersectionColor:function(){return t.intersectionColor},u_intersectionWidth:function(){return t.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return t.lineColor}},this._scene.primitives.add(this)}function bi(e){var t={iso8601:void 0};if(Cesium.defined(e))return t.iso8601=e,Cesium.TimeInterval.fromIso8601(t)}Si.prototype.update=function(e){var t=e.mode,i=this.viewer.scene.frameState.time;if(this.show instanceof Array?function(e,t){if(0<e.show.length)for(var i=0;i<e.show.length;i++)if(e.show[i].boolean){var n=bi(e.show[i].interval);if(Cesium.JulianDate.compare(n.start,t)<=0&&0<=Cesium.JulianDate.compare(n.stop,t))return e._show=!0}else e._show=!1}(this,i):this._show!=this.show&&(this._show=this.show),this._show&&t===Cesium.SceneMode.SCENE3D){var n=!1,r=!1,a=!1,o=this.xHalfAngle,s=this.yHalfAngle;if(o<0||s<0)throw new Cesium.DeveloperError("halfAngle must be greater than or equal to zero.");if(0!=o&&0!=s){if(this._xHalfAngle===o&&this._yHalfAngle===s||(this._xHalfAngle=o,this._yHalfAngle=s,n=!0),this.radius instanceof Cesium.CallbackProperty?this._radius=this.radius.getValue(e.time):this._radius=this.radius,this._radius<0)throw new Cesium.DeveloperError("this.radius must be greater than or equal to zero.");this._boundingSphere=new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,this._radius),Cesium.defined(this.modelMatrix)||(this.modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this._position));Cesium.Matrix4.equals(this.modelMatrix,this._modelMatrix);Cesium.Matrix4.clone(this.modelMatrix,this._modelMatrix),Cesium.Matrix4.multiplyByUniformScale(this.modelMatrix,this._radius,this._computedModelMatrix),Cesium.BoundingSphere.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC);var u=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=u,r=!0);var l=this.material;this._material!==l&&(this._material=l,a=r=!0);var c,m,d,h,f,p,_,C,g;!0!==this._translucent&&(r=this._translucent=!0),this.showScanPlane&&(1<this._timeDiff&&(this._timeDiff=0),this._timeDiff+=1/(10*this.scanPlaneRate),c=4*o*this._timeDiff-o,m=Math.tan(s),d=Math.cos(c),h=Math.atan(d*m),this._scanePlaneXHalfAngle=c,this._scanePlaneYHalfAngle=h,Cesium.Matrix3.fromRotationZ(this._scanePlaneXHalfAngle,Mi),Cesium.Matrix4.multiplyByMatrix3(this.modelMatrix,Mi,this._computedScanPlaneModelMatrix),Cesium.Matrix4.multiplyByUniformScale(this._computedScanPlaneModelMatrix,this._radius,this._computedScanPlaneModelMatrix)),n&&function(e,t){var i=t.context,n=function(e,t,i){for(var n=e.slice,r=Math.cos(i),a=Math.tan(i),o=Math.cos(t),s=Math.tan(t),u=Math.atan(o*a),l=Math.atan(r*s),c=[],m=0;m<n;m++){var d=2*u*m/(n-1)-u;c.push(new Cesium.Cartesian3(0,Math.sin(d),Math.cos(d)))}for(var h=[],m=0;m<n;m++){d=2*l*m/(n-1)-l;h.push(new Cesium.Cartesian3(Math.sin(d),0,Math.cos(d)))}return{zoy:c,zox:h}}(e,e.xHalfAngle,e.yHalfAngle),r=function(e,t){var i=e.xHalfAngle,n=e.yHalfAngle,r=t.zoy,a=(t.zox,[]),o=Cesium.Matrix3.fromRotationY(i,Mi);a.push(r.map(function(e){return Cesium.Matrix3.multiplyByVector(o,e,new Cesium.Cartesian3)}));o=Cesium.Matrix3.fromRotationX(-n,Mi),o=Cesium.Matrix3.fromRotationY(-i,Mi);return a.push(r.map(function(e){return Cesium.Matrix3.multiplyByVector(o,e,new Cesium.Cartesian3)}).reverse()),a}(e,n);e.showLateralSurfaces&&(e._sectorVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,n=new Float32Array(18*i),r=0,a=0,o=t.length;a<o;a++)for(var s=t[a],u=Cesium.Cartesian3.normalize(Cesium.Cartesian3.cross(s[0],s[s.length-1],Ri),Ri),l=0,i=s.length-1;l<i;l++)n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=-u.x,n[r++]=-u.y,n[r++]=-u.z,n[r++]=s[l].x,n[r++]=s[l].y,n[r++]=s[l].z,n[r++]=-u.x,n[r++]=-u.y,n[r++]=-u.z,n[r++]=s[l+1].x,n[r++]=s[l+1].y,n[r++]=s[l+1].z,n[r++]=-u.x,n[r++]=-u.y,n[r++]=-u.z;var c=Cesium.Buffer.createVertexBuffer({context:e,typedArray:n,usage:Cesium.BufferUsage.STATIC_DRAW}),m=6*Float32Array.BYTES_PER_ELEMENT,d=[{index:Ei.position,vertexBuffer:c,componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:m},{index:Ei.normal,vertexBuffer:c,componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:m}];return new Cesium.VertexArray({context:e,attributes:d})}(i,r));e.showSectorLines&&(e._sectorLineVA=function(e,t){for(var i=t.length,n=new Float32Array(9*i),r=0,a=0,o=t.length;a<o;a++){var s=t[a];n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=s[0].x,n[r++]=s[0].y,n[r++]=s[0].z}var u=Cesium.Buffer.createVertexBuffer({context:e,typedArray:n,usage:Cesium.BufferUsage.STATIC_DRAW}),l=3*Float32Array.BYTES_PER_ELEMENT,c=[{index:Ei.position,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:l}];return new Cesium.VertexArray({context:e,attributes:c})}(i,r));e.showSectorSegmentLines&&(e._sectorSegmentLineVA=function(e,t){for(var i=Array.prototype.concat.apply([],t).length-t.length,n=new Float32Array(9*i),r=0,a=0,o=t.length;a<o;a++)for(var s=t[a],u=0,i=s.length-1;u<i;u++)n[r++]=s[u].x,n[r++]=s[u].y,n[r++]=s[u].z,n[r++]=s[u+1].x,n[r++]=s[u+1].y,n[r++]=s[u+1].z;var l=Cesium.Buffer.createVertexBuffer({context:e,typedArray:n,usage:Cesium.BufferUsage.STATIC_DRAW}),c=3*Float32Array.BYTES_PER_ELEMENT,m=[{index:Ei.position,vertexBuffer:l,componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:c}];return new Cesium.VertexArray({context:e,attributes:m})}(i,r));{var a;e._domeVA=function(e){var t=Cesium.EllipsoidGeometry.createGeometry(new Cesium.EllipsoidGeometry({vertexFormat:Cesium.VertexFormat.POSITION_ONLY,stackPartitions:32,slicePartitions:32}));return Cesium.VertexArray.fromGeometry({context:e,geometry:t,attributeLocations:Ei,bufferUsage:Cesium.BufferUsage.STATIC_DRAW,interleave:!1})}(i),e._domeLineVA=function(e){var t=Cesium.EllipsoidOutlineGeometry.createGeometry(new Cesium.EllipsoidOutlineGeometry({vertexFormat:Cesium.VertexFormat.POSITION_ONLY,stackPartitions:64,slicePartitions:64}));return Cesium.VertexArray.fromGeometry({context:e,geometry:t,attributeLocations:Ei,bufferUsage:Cesium.BufferUsage.STATIC_DRAW,interleave:!1})}(i),e.showScanPlane&&(a=function(e,t,i){for(var n=e.slice,r=[],a=Math.cos(t),o=Math.tan(i),s=Math.atan(a*o),u=0;u<n/2;u++){var l=2*s*u/(n-1)-s;r.push(new Cesium.Cartesian3(Math.sin(l),0,Math.cos(l)))}return r}(e,0,Cesium.Math.PI_OVER_TWO),e._scanPlaneVA=function(e,t){for(var i=t.length-1,n=new Float32Array(9*i),r=0,a=0;a<i;a++)n[r++]=t[a].x,n[r++]=t[a].y,n[r++]=t[a].z,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=t[a+1].x,n[r++]=t[a+1].y,n[r++]=t[a+1].z;var o=Cesium.Buffer.createVertexBuffer({context:e,typedArray:n,usage:Cesium.BufferUsage.STATIC_DRAW}),s=3*Float32Array.BYTES_PER_ELEMENT,u=[{index:Ei.position,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:s}];return new Cesium.VertexArray({context:e,attributes:u})}(i,a))}}(this,e),r&&(f=this,p=u,!0?(f._frontFaceRS=Cesium.RenderState.fromCache({depthTest:{enabled:!p},depthMask:!1,blending:Cesium.BlendingState.ALPHA_BLEND,cull:{enabled:!0,face:Cesium.CullFace.BACK}}),f._backFaceRS=Cesium.RenderState.fromCache({depthTest:{enabled:!p},depthMask:!1,blending:Cesium.BlendingState.ALPHA_BLEND,cull:{enabled:!0,face:Cesium.CullFace.FRONT}}),f._pickRS=Cesium.RenderState.fromCache({depthTest:{enabled:!p},depthMask:!1,blending:Cesium.BlendingState.ALPHA_BLEND})):(f._frontFaceRS=Cesium.RenderState.fromCache({depthTest:{enabled:!p},depthMask:!0}),f._pickRS=Cesium.RenderState.fromCache({depthTest:{enabled:!0},depthMask:!0}))),a&&(function(e,t,i){var n=t.context,r=$t,a=new Cesium.ShaderSource({sources:[ti,i.shaderSource,ei]});e._sp=Cesium.ShaderProgram.replaceCache({context:n,shaderProgram:e._sp,vertexShaderSource:r,fragmentShaderSource:a,attributeLocations:Ei});var o=new Cesium.ShaderSource({sources:[ti,i.shaderSource,ei],pickColorQualifier:"uniform"});e._pickSP=Cesium.ShaderProgram.replaceCache({context:n,shaderProgram:e._pickSP,vertexShaderSource:r,fragmentShaderSource:o,attributeLocations:Ei})}(_=this,C=e,g=l),_.showScanPlane&&function(e,t,i){var n=t.context,r=$t,a=new Cesium.ShaderSource({sources:[ti,i.shaderSource,ii]});e._scanePlaneSP=Cesium.ShaderProgram.replaceCache({context:n,shaderProgram:e._scanePlaneSP,vertexShaderSource:r,fragmentShaderSource:a,attributeLocations:Ei})}(_,C,g)),(r||a)&&function(e,t){e._colorCommands.length=0;var i=Cesium.Pass.TRANSLUCENT;e.showLateralSurfaces&&Di(e,e._sectorFrontCommand,e._sectorBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorVA,e._uniforms,e._computedModelMatrix,t,i);e.showSectorLines&&Di(e,e._sectorLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showSectorSegmentLines&&Di(e,e._sectorSegmentLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._sectorSegmentLineVA,e._uniforms,e._computedModelMatrix,t,i,!0);e.showDomeSurfaces&&Di(e,e._domeFrontCommand,e._domeBackCommand,e._frontFaceRS,e._backFaceRS,e._sp,e._domeVA,e._uniforms,e._computedModelMatrix,t,i);Di(e,e._domeLineCommand,void 0,e._frontFaceRS,e._backFaceRS,e._sp,e._domeLineVA,e._uniforms,e._computedModelMatrix,t,i,!0),e.showScanPlane&&Di(e,e._scanPlaneFrontCommand,e._scanPlaneBackCommand,e._frontFaceRS,e._backFaceRS,e._scanePlaneSP,e._scanPlaneVA,e._scanUniforms,e._computedScanPlaneModelMatrix,t,i)}(this,!0);var v=e.commandList,y=e.passes,T=this._colorCommands;if(y.render)for(var x=0,w=T.length;x<w;x++){var A=T[x];v.push(A)}}}},Si.prototype.remove=function(){var e;return!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._scene.primitives._guid]),Cesium.destroyObject(this)};var Mi=new pi,Ri=new si;function Di(e,t,i,n,r,a,o,s,u,l,c,m){l&&i&&(i.vertexArray=o,i.renderState=r,i.shaderProgram=a,i.uniformMap=Cesium.combine(s,e._material._uniforms),i.uniformMap.u_normalDirection=function(){return-1},i.pass=c,i.modelMatrix=u,e._colorCommands.push(i)),t.vertexArray=o,t.renderState=n,t.shaderProgram=a,t.uniformMap=Cesium.combine(s,e._material._uniforms),m&&(t.uniformMap.u_type=function(){return 1}),t.pass=c,t.modelMatrix=u,e._colorCommands.push(t)}function Pi(e){if(!Cesium.defined(e))throw new DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.position))throw new DeveloperError("位置参数options.position不能为空。");this._viewer=e.viewer,this.id=e.id,this._scene=this._viewer.scene,this.show=Cesium.defaultValue(e.show,!0),this._show=void 0,this.showSurfaces=Cesium.defaultValue(e.showSurfaces,!0),this.showLines=Cesium.defaultValue(e.showLines,!0),this._colorCommands=[],this._startYaw=Cesium.defaultValue(e.startYaw,0),this._yawSpan=Cesium.defaultValue(e.yawSpan,120),this._yawCount=Cesium.defaultValue(e.yawCount,10),this._startPitch=Cesium.defaultValue(e.startPitch,0),this._pitchSpan=Cesium.defaultValue(e.pitchSpan,50),this._pitchCount=Cesium.defaultValue(e.pitchCount,10),this.m_bClosed=Cesium.defaultValue(e.m_bClosed,!0),this.direction=Cesium.defaultValue(e.direction,0),this._center=new Cesium.Cartesian3,this.radius=Cesium.defaultValue(e.radius,30),this._radius=void 0,this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0,1)),this.lineColor=Cesium.defaultValue(e.lineColor,new Cesium.Color(1,1,0,1)),this._position=void 0,this.position=e.position,this.endPos=Cesium.defaultValue(e.endPos,new Cesium.Cartesian3(0,0,0)),this.modelMatrix=Cesium.defaultValue(e.modelMatrix,void 0),this.bottomRadius=Cesium.defaultValue(e.bottomRadius,2e3),this.orientation=e.orientation,this._orientation=void 0,this.waveDirection=Cesium.defaultValue(e.waveDirection,"WD_Horizontal"),this.wavePath=Cesium.defaultValue(e.wavePath,"right_Bottom"),this.angularRate=Cesium.defaultValue(e.angularRate,30),this.u_isTexture=Cesium.defaultValue(e.u_isTexture,0),this._texture=void 0,this._imageFilePath=Cesium.defaultValue(e.imageFilePath,Cesium.buildModuleUrl("Assets/EMExtensions/geometry3d.jpg")),this.imageFilePath=void 0,this.ms=Cesium.defaultValue(e.ms,.1),this.wavePoints=[],this.time=(new Date).getTime(),this.index=0,this._fillCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1,cull:{enabled:!1,face:Cesium.CullFace.BACK}})}),this._sectorVA=void 0,this.showScan=Cesium.defaultValue(e.showScan,!1),this._showScan=void 0,this._outlineCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._scene.primitives.add(this)}function Ii(e){var t={iso8601:void 0};if(Cesium.defined(e))return t.iso8601=e,Cesium.TimeInterval.fromIso8601(t)}function Oi(e,t,i,n){var r=function(e){var t=new Cesium.Matrix4,i=e._center,n=e._vertexBufferTypedArray;Cesium.defined(n)||(n=new Float32Array(12));var r=e.modelMatrix,a=Cesium.Matrix4.clone(r,t);return a[12]-=i.x,a[13]-=i.y,a[14]-=i.z,[].push(new Cesium.Cartesian3(a[12],a[13],a[14])),n[0]=a[0],n[1]=a[4],n[2]=a[8],n[3]=a[12],n[4]=a[1],n[5]=a[5],n[6]=a[9],n[7]=a[13],n[8]=a[2],n[9]=a[6],n[10]=a[10],n[11]=a[14],n}(e),a=Cesium.Buffer.createVertexBuffer({context:t,typedArray:r,usage:Cesium.BufferUsage.STATIC_DRAW}),o=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),s={czm_modelMatrixRow0:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*o,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*o,strideInBytes:12*o,instanceDivisor:1}},u=0,l=[];return l.push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(i.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),l.push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.UNSIGNED_BYTE,new Uint8Array(i.color.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),n&&l.push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float32Array(i.stPosition.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),s.czm_modelMatrixRow0.index=u++,l.push(s.czm_modelMatrixRow0),s.czm_modelMatrixRow1.index=u++,l.push(s.czm_modelMatrixRow1),s.czm_modelMatrixRow2.index=u++,l.push(s.czm_modelMatrixRow2),new Cesium.VertexArray({context:t,attributes:l,indexBuffer:Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(i.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})}function Li(e,t,i,n){n.vertexArray=e,n.modelMatrix=t,n._boundingVolume=i}function Ni(e){if(!Cesium.defined(e))throw new Cesium.DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new Cesium.DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.lon)||!Cesium.defined(e.lat)||!Cesium.defined(e.height))throw new Cesium.DeveloperError("位置参数未定义");this.viewer=e.viewer,this.id=e.id,this._scene=this.viewer.scene,this._lon=e.lon,this._lat=e.lat,this._height=e.height,this.show=Cesium.defaultValue(e.show,!0),this._show=void 0,this.startYaw=Cesium.defaultValue(e.startYaw,0),this.endYaw=Cesium.defaultValue(e.endYaw,360),this.minorRadius=Cesium.defaultValue(e.minorRadius,5300),this._minorRadius=void 0,this.longRadius=Cesium.defaultValue(e.longRadius,15200),this._longRadius=void 0,this.fillColor=Cesium.defaultValue(e.fillColor,Cesium.Color.RED),this.lineColor=Cesium.defaultValue(e.lineColor,Cesium.Color.WHITE),this._boundingSphere=new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,this.longRadius),this._modelMatrix=Cesium.defaultValue(e.modelMatrix,void 0),this._center=new Cesium.Cartesian3,this.renderStyle=Cesium.defaultValue(e.renderStyle,0),this._attributeLocations=void 0,this._allCommands=[],this.instance=Cesium.defaultValue(e.instance,void 0),this._fillCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._outlineCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({depthTest:!0})}),this._scene.primitives.add(this)}function Bi(e,t,i){var n=function(e){var t=new Cesium.Matrix4,i=e._center,n=e._vertexBufferTypedArray;Cesium.defined(n)||(n=new Float32Array(12));e._dynamic&&(e._vertexBufferTypedArray=n);var r=e._modelMatrix,a=Cesium.Matrix4.clone(r,t);return a[12]-=i.x,a[13]-=i.y,a[14]-=i.z,[].push(new Cesium.Cartesian3(a[12],a[13],a[14])),n[0]=a[0],n[1]=a[4],n[2]=a[8],n[3]=a[12],n[4]=a[1],n[5]=a[5],n[6]=a[9],n[7]=a[13],n[8]=a[2],n[9]=a[6],n[10]=a[10],n[11]=a[14],n}(e),r=Cesium.Buffer.createVertexBuffer({context:t,typedArray:n,usage:Cesium.BufferUsage.STATIC_DRAW}),a=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),o={czm_modelMatrixRow0:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*a,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*a,strideInBytes:12*a,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*a,strideInBytes:12*a,instanceDivisor:1}},s=0,u=[];return u.push({index:s++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(i.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),o.czm_modelMatrixRow0.index=s++,u.push(o.czm_modelMatrixRow0),o.czm_modelMatrixRow1.index=s++,u.push(o.czm_modelMatrixRow1),o.czm_modelMatrixRow2.index=s++,u.push(o.czm_modelMatrixRow2),new Cesium.VertexArray({context:t,attributes:u,indexBuffer:Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(i.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})}function zi(){return"attribute vec3 position;\nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvoid main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position =czm_viewProjection* czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n"}function Fi(){return"uniform vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}function Vi(e){if(!Cesium.defined(e))throw new Cesium.DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new Cesium.DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.instances))throw new Cesium.DeveloperError("参数options.instance不能为空。");this.instances=e.instances,this.show=Cesium.defaultValue(e.show,!0),this._show=void 0,this.viewer=e.viewer,this._scene=this.viewer.scene,this._radius=Cesium.defaultValue(e.radius,10),this.lineColor=Cesium.defaultValue(e.lineColor,Cesium.Color.WHITE),this._center=new Cesium.Cartesian3,this._command=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.TRANSLUCENT,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._scene.primitives.add(this)}function Ui(e){if(!Cesium.defined(e.viewer))throw new DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.position))throw new DeveloperError("位置参数options.position不能为空。");this._viewer=e.viewer,this.id=e.id,this.ringArr=[],this.entityArr=[],this.circleCenter=e.position,console.log(this.circleCenter),this._position=this.circleCenter,this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this.circleCenter),Cesium.Matrix4.multiplyByUniformScale(this._modelMatrix,1,this._modelMatrix),this.show=Cesium.defaultValue(e.show,!0),this._showLines=Cesium.defaultValue(e._showLines,!0),this._rowNumber=Cesium.defaultValue(e.rowNumber,3),this._columnNumber=Cesium.defaultValue(e.columnNumber,6),this.lineShow=Cesium.defaultValue(e.lineShow,!0),this._innerRadius=Cesium.defaultValue(e.innerRadius,4e3),this._innerColor=Cesium.defaultValue(e.innerColor,new Cesium.Color(1,1,0,1)),this.ringRadius=Cesium.defaultValue(e.ringRadius,[4e3,7500,1e4]),this.ringColor=Cesium.defaultValue(e.ringColor,[new Cesium.Color(1,1,0,.5),new Cesium.Color(1,0,0,.5),new Cesium.Color(0,0,1,.5)]),this._labels=this._viewer.scene.primitives.add(new Cesium.LabelCollection),this.distanceDisplayCondition=Cesium.defaultValue(e.distanceDisplayCondition,new Cesium.DistanceDisplayCondition(0,5e5));var t=this;this.createRing(),this.createLabels();var i=this.setInstance();this.line=new Vi({viewer:this._viewer,radius:this.ringRadius[this.ringRadius.length-1],instances:i,show:new Cesium.CallbackProperty(function(){return t.show},!1)})}function Gi(e){return 1e3<=e?(e/=1e3).toFixed(0)+"km":e.toFixed(0)+"m"}function ki(e){var t=new Cesium.Cartographic.fromCartesian(e,Cesium.Ellipsoid.WGS84);return{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),height:t.height}}function Hi(){return!0}function Wi(e){function t(){}for(var i in e)"function"==typeof e[i]&&(e[i]=t);e.isDestroyed=Hi}function qi(){if(!oe(Ji._canTransferArrayBuffer)){var n=new Worker(Ki("Workers/transferTypedArrayTest.js"));n.postMessage=z(n.webkitPostMessage,n.postMessage);var e=new Int8Array([99]);try{n.postMessage({array:e},[e.buffer])}catch(e){return Ji._canTransferArrayBuffer=!1}var r=C.defer();n.onmessage=function(e){var t=e.data.array,i=oe(t)&&99===t[0];r.resolve(i),n.terminate(),Ji._canTransferArrayBuffer=i},Ji._canTransferArrayBuffer=r.promise}return Ji._canTransferArrayBuffer}Pi.prototype.addRadarWave=function(){var i=this;this.radarWave=this._viewer.entities.add({orientation:new Cesium.CallbackProperty(function(){var e=function(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),r=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(i,new Cesium.Matrix4),n,new Cesium.Cartesian3),a=Cesium.Cartesian3.normalize(r,new Cesium.Cartesian3),o=Math.atan2(a.y,a.x)-Cesium.Math.PI_OVER_TWO,s=Cesium.Math.TWO_PI-Cesium.Math.zeroToTwoPi(o),u=Cesium.Transforms.eastNorthUpToFixedFrame(e),r=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),l=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(u,u),r,r);Cesium.Cartesian3.normalize(l,l);var c=Cesium.Math.PI_OVER_TWO-Cesium.Math.acosClamped(l.z);return new Cesium.HeadingPitchRoll(s,c,0)}(i._position,i.endPos);return e.pitch+=Cesium.Math.PI_OVER_TWO,e.heading-=Cesium.Math.PI_OVER_TWO,Cesium.Transforms.headingPitchRollQuaternion(i._position,e)},!1),position:new Cesium.CallbackProperty(function(){var e=Cesium.Cartesian3.subtract(i._position,i.endPos,new Cesium.Cartesian3),t=Cesium.Cartesian3.divideByScalar(e,2,new Cesium.Cartesian3);return Cesium.Cartesian3.add(t,i.endPos,new Cesium.Cartesian3)},!1),cylinder:{length:new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.distance(i._position,i.endPos)},!1),topRadius:0,bottomRadius:this.bottomRadius,showBottom:!1,showTop:!1,changeStCoordinate:!1,material:Cesium.Color.RED}}),i.wavePoints=function(e){var t=[],i=e._startYaw,n=e._startPitch,r=(e._yawSpan-i)/e._yawCount,a=(e._pitchSpan-n)/e._pitchCount,o=Cesium.Transforms.eastNorthUpToFixedFrame(e._position);if("WD_Horizontal"==e.waveDirection)switch(e.wavePath){case"right_Top":for(var s=e._pitchSpan;n<=s;s-=a)for(var u=i;u<=e._yawSpan;u+=r){var l=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(e.radius*Math.cos(s*Math.PI/180)*Math.sin(Cesium.Math.toRadians(u)),e.radius*Math.cos(s*Math.PI/180)*Math.cos(Cesium.Math.toRadians(u)),e.radius*Math.sin(Cesium.Math.toRadians(s))),new Cesium.Cartesian3);t.push(l)}break;case"right_Bottom":for(s=n;s<=e._pitchSpan;s+=a)for(u=i;u<=e._yawSpan;u+=r){l=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(e.radius*Math.cos(s*Math.PI/180)*Math.sin(Cesium.Math.toRadians(u)),e.radius*Math.cos(s*Math.PI/180)*Math.cos(Cesium.Math.toRadians(u)),e.radius*Math.sin(Cesium.Math.toRadians(s))),new Cesium.Cartesian3);t.push(l)}break;case"left_Top":for(s=e._pitchSpan;n<=s;s-=a)for(u=e._yawSpan;i<=u;u-=r){l=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(e.radius*Math.cos(s*Math.PI/180)*Math.sin(Cesium.Math.toRadians(u)),e.radius*Math.cos(s*Math.PI/180)*Math.cos(Cesium.Math.toRadians(u)),e.radius*Math.sin(Cesium.Math.toRadians(s))),new Cesium.Cartesian3);t.push(l)}break;case"left_Bottom":for(s=n;s<=e._pitchSpan;s+=a)for(u=e._yawSpan;i<=u;u-=r){l=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(e.radius*Math.cos(s*Math.PI/180)*Math.sin(Cesium.Math.toRadians(u)),e.radius*Math.cos(s*Math.PI/180)*Math.cos(Cesium.Math.toRadians(u)),e.radius*Math.sin(Cesium.Math.toRadians(s))),new Cesium.Cartesian3);t.push(l)}}else if("WD_Vertical"==e.waveDirection)for(s=i;s<=e._yawSpan;s+=r)for(u=e._pitchSpan;n<=u;u-=a){l=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(e.radius*Math.cos(u*Math.PI/180)*Math.sin(Cesium.Math.toRadians(s)),e.radius*Math.cos(u*Math.PI/180)*Math.cos(Cesium.Math.toRadians(s)),e.radius*Math.sin(Cesium.Math.toRadians(u))),new Cesium.Cartesian3);t.push(l)}else if("WD_Random"==e.waveDirection)for(s=i;s<e._yawSpan;s+=r)for(var c=Math.floor(Math.random()*(e._yawSpan-i+1))+i,u=e._pitchSpan;n<u;u-=a){var m=Math.floor(Math.random()*(e._pitchSpan-n+1))+n,l=Cesium.Matrix4.multiplyByPoint(o,new Cesium.Cartesian3(e.radius*Math.cos(m*Math.PI/180)*Math.sin(Cesium.Math.toRadians(c)),e.radius*Math.cos(u*Math.PI/180)*Math.cos(Cesium.Math.toRadians(c)),e.radius*Math.sin(Cesium.Math.toRadians(m))),new Cesium.Cartesian3);t.push(l)}return t}(this)},Pi.prototype.update=function(e){var t=this;this._colorCommands.length=0;var i,n=e.mode,r=e.context,a=this._viewer.scene.frameState.time;if(this.show instanceof Array?function(e,t){if(0<e.show.length)for(var i=0;i<e.show.length;i++)if(e.show[i].boolean){var n=Ii(e.show[i].interval);if(Cesium.JulianDate.compare(n.start,t)<=0&&0<=Cesium.JulianDate.compare(n.stop,t))return e._show=!0,Cesium.defined(e.orientation)&&(e._orientation=e.orientation.getValue(t))}else e._show=!1,e._orientation=void 0}(this,a):this._show!=this.show&&(this._show=this.show),this._show&&n===Cesium.SceneMode.SCENE3D){this.position instanceof Cesium.SampledPositionProperty?this._position=this.position.getValue(a):this._position!=this.position&&(this._position=this.position),this.showScan&&this._showScan!=this.showScan&&(this._showScan=this.showScan,this.addRadarWave()),this.radius instanceof Cesium.CallbackProperty?this._radius=this.radius.getValue(e.time):this._radius=this.radius,this._boundingSphere=new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,this._radius),this.modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this._position),Cesium.Matrix4.multiplyByUniformScale(this.modelMatrix,this._radius,this.modelMatrix),Cesium.defined(this._orientation),this.imageFilePath!=this._imageFilePath&&(this.imageFilePath=this._imageFilePath,i=this.imageFilePath,Cesium.Resource.createIfNeeded(i).fetchImage({flipY:!0,preferImageBitmap:!0}).then(function(e){t._texture=new Cesium.Texture({context:r,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE,source:e,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.LINEAR,magnificationFilter:Cesium.TextureMagnificationFilter.LINEAR})}),t._fillCommand.uniformMap={u_isTexture:function(){return t.u_isTexture},u_texture:function(){return t._texture}}}).otherwise(function(e){console.error(e.message)})),Cesium.BoundingSphere.transform(this._boundingSphere,this.modelMatrix,this._boundingSphere),function(e,t){var i=t.context;{var n;e.showSurfaces&&(n=function(e){var t=e._yawCount,i=e._pitchCount,n=e.color,r=e._startYaw,a=e._yawSpan,o=(e._yawSpan-r)/t,s=e._startPitch,u=e._pitchSpan,l=(e._pitchSpan-s)/i,c=0,m=0,d=(t+1)*(i+1);d++;var h=i*t*6;e.m_bClosed&&(-90==s&&90==u||(h+=6*(t-1)),0==r&&360==a||(h+=6*(i+1)));for(var f=Cesium.IndexDatatype.createTypedArray(d,h),p=new Float64Array(3*d),_=new Uint8Array(4*d),C=new Float32Array(2*d),g=0,v=0,y=0,T=s;T<u+l;T+=l){var x=u<T?u:T;m++,c=0;for(var w=r;w<a+o;w+=o){c++;var A=a<w?a:w,E=Math.cos(Cesium.Math.toRadians(x))*Math.sin(Cesium.Math.toRadians(A)),S=Math.cos(Cesium.Math.toRadians(A))*Math.cos(Cesium.Math.toRadians(x)),b=Math.sin(Cesium.Math.toRadians(x));p[g++]=0+E,p[g++]=S,p[g++]=b;var M=1-(w-r)/(a-r),R=1-(T-s)/(u-s);C[y++]=M,C[y++]=R,_[v++]=Cesium.Color.floatToByte(n.red),_[v++]=Cesium.Color.floatToByte(n.green),_[v++]=Cesium.Color.floatToByte(n.blue),_[v++]=Cesium.Color.floatToByte(n.alpha)}}p[g++]=0,p[g++]=0,p[g++]=0,_[v++]=Cesium.Color.floatToByte(n.red),_[v++]=Cesium.Color.floatToByte(n.green),_[v++]=Cesium.Color.floatToByte(n.blue),_[v++]=Cesium.Color.floatToByte(n.alpha);for(var D=0,T=0;T<m;T++)for(w=0;w<c;w++)T+1<m&&w+1<c&&(f[D++]=T*c+w,f[D++]=(T+1)*c+w,f[D++]=(T+1)*c+w+1,f[D++]=T*c+w,f[D++]=(T+1)*c+w+1,f[D++]=T*c+w+1);if(e.m_bClosed){var P=m*c;if(-90!=s||90!=u)for(T=0;T<c-1;T++)f[D++]=P,f[D++]=T,f[D++]=T+1,f[D++]=P,f[D++]=(m-1)*c+T+1,f[D++]=(m-1)*c+T;if(0!=r||360!=a)for(w=0;w<m+1;w++)f[D++]=P,f[D++]=w*c,f[D++]=(w+1)*c,f[D++]=P,f[D++]=(w+1)*c+c-1,f[D++]=w*c+c-1}return{position:p,color:_,stPosition:C,indices:f}}(e),e._fillVA=Oi(e,i,n,!0))}{var r;e.showLines&&(r=function(e){var t=e._yawCount,i=e._pitchCount,n=e.lineColor,r=e._startYaw,a=e._yawSpan,o=(e._yawSpan-r)/t,s=e._startPitch,u=e._pitchSpan,l=(e._pitchSpan-s)/i,c=0,m=0,d=(t+1)*(i+1);d++;for(var h=new Float64Array(3*d),f=new Uint8Array(4*d),p=0,_=0,C=s;C<u+l;C+=l){var g=u<C?u:C;m++,c=0;for(var v=r;v<a+o;v+=o){c++;var y=a<v?a:v,T=Math.cos(Cesium.Math.toRadians(g))*Math.sin(Cesium.Math.toRadians(y)),x=Math.cos(Cesium.Math.toRadians(y))*Math.cos(Cesium.Math.toRadians(g)),w=Math.sin(Cesium.Math.toRadians(g));h[p++]=0+T,h[p++]=x,h[p++]=w,f[_++]=Cesium.Color.floatToByte(n.red),f[_++]=Cesium.Color.floatToByte(n.green),f[_++]=Cesium.Color.floatToByte(n.blue),f[_++]=Cesium.Color.floatToByte(n.alpha)}}h[p++]=0,h[p++]=0,h[p++]=0,f[_++]=Cesium.Color.floatToByte(n.red),f[_++]=Cesium.Color.floatToByte(n.green),f[_++]=Cesium.Color.floatToByte(n.blue),f[_++]=Cesium.Color.floatToByte(n.alpha);var A=0,E=(m-1)*c*2+m*(c-1)*2;!e.m_bClosed||0==r&&360==a||-90==s&&90==u||(E+=9);for(var S=Cesium.IndexDatatype.createTypedArray(d,E),C=0;C<m;C++)for(v=0;v<c;v++)C+1<m&&(S[A++]=C*c+v,S[A++]=(C+1)*c+v),v+1<c&&(S[A++]=C*c+v,S[A++]=C*c+v+1);{var b;!e.m_bClosed||0==r&&360==a||-90==s&&90==u||(b=m*c,S[A++]=b,S[A++]=0,S[A++]=b,S[A++]=c-1,S[A++]=b,S[A++]=(m-1)*c,S[A++]=b,S[A++]=b-1)}return{position:h,color:f,indices:S}}(e),e._outlineVA=Oi(e,i,r,!1))}}(this,e);var o=(new Date).getTime();if(500<=o-this.time&&(this.time=o,Cesium.defined(this.radarWave)&&(this.index>=this.wavePoints.length&&(this.index=0),this.endPos=this.wavePoints[this.index++])),Cesium.defined(this._fillCommand.shaderProgram)||(this._fillCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:r,vertexShaderSource:"attribute vec3 position;\nattribute vec4 color; \nattribute vec2 st;\nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvarying vec4  v_colour;\n varying vec2 v_texCoord;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    v_texCoord = st;\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_viewProjection * czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"uniform sampler2D u_texture;\nuniform float u_isTexture;\nvarying vec4  v_colour;\nvarying vec2 v_texCoord;\nvoid main()\n{\nif(u_isTexture<0.5){  gl_FragColor = v_colour;\n}else{\n   gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n}\n"})),Cesium.defined(this._outlineCommand.shaderProgram)||(this._outlineCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:r,vertexShaderSource:"attribute vec3 position;\nattribute vec4 color; \nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_viewProjection * czm_instanced_model*  vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"})),this.showSurfaces&&Cesium.defined(this._texture)&&(Li(this._fillVA,this.modelMatrix,this._boundingSphere,this._fillCommand),this._colorCommands.push(this._fillCommand)),this.showLines&&Cesium.defined(this._outlineVA)&&(Li(this._outlineVA,this.modelMatrix,this._boundingSphere,this._outlineCommand),this._colorCommands.push(this._outlineCommand)),Cesium.defined(this._texture)){var s=e.commandList,u=e.passes,l=this._colorCommands;if(u.render)for(var c=0,m=l.length;c<m;c++){var d=l[c];s.push(d)}}}},Pi.prototype.remove=function(){var e,t=this._fillCommand,i=this._outlineCommand;return t.vertexArray=t.vertexArray&&t.vertexArray.destroy(),t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy(),i.vertexArray=i.vertexArray&&i.vertexArray.destroy(),i.shaderProgram=i.shaderProgram&&i.shaderProgram.destroy(),!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._viewer.scene.primitives._guid]),this.radarWave&&this._viewer.entities.contains(this.radarWave)&&this._viewer.entities.remove(this.radarWave),Cesium.destroyObject(this)},Ni.prototype.update=function(e){this._allCommands.length=0;var t=e.context,i=this;this.longRadius instanceof Cesium.CallbackProperty?this._longRadius=this.longRadius.getValue(e.time):this._longRadius=this.longRadius,this.minorRadius instanceof Cesium.CallbackProperty?this._minorRadius=this.minorRadius.getValue(e.time):this._minorRadius=this.minorRadius,this._position=Cesium.Cartesian3.fromDegrees(this._lon,this._lat,this._height),this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this._position),Cesium.Matrix4.multiplyByUniformScale(this._modelMatrix,1,this._modelMatrix),Cesium.BoundingSphere.transform(this._boundingSphere,this._modelMatrix,this._boundingSphere),this._fillCommand.uniformMap={v_colour:function(){return i.fillColor}};var n=this.createFillMesh();this._fillVA=Bi(this,t,n),this._outlineCommand.uniformMap={v_colour:function(){return i.lineColor}};var r=this.createOutlineMesh();this._outlineVA=Bi(this,t,r),Cesium.defined(this._fillCommand.shaderProgram)||(this._fillCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:zi(),fragmentShaderSource:Fi()})),Cesium.defined(this._outlineCommand.shaderProgram)||(this._outlineCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:zi(),fragmentShaderSource:Fi()})),this._fillCommand.vertexArray=this._fillVA,this._outlineCommand.vertexArray=this._outlineVA,2!=this.renderStyle&&this._allCommands.push(this._fillCommand),1!=this.renderStyle&&this._allCommands.push(this._outlineCommand);var a=e.commandList,o=e.passes,s=this._allCommands;if(this.show instanceof Cesium.CallbackProperty?this._show=this.show.getValue():this._show=this.show,o.render&&this._show)for(var u=0,l=s.length;u<l;u++){var c=s[u];a.push(c)}},Ni.prototype.remove=function(){var e,t=this._fillCommand,i=this._outlineCommand;return t.vertexArray=t.vertexArray&&t.vertexArray.destroy(),t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy(),i.vertexArray=i.vertexArray&&i.vertexArray.destroy(),i.shaderProgram=i.shaderProgram&&i.shaderProgram.destroy(),!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._scene.primitives._guid]),Cesium.destroyObject(this)},Ni.prototype.createFillMesh=function(){var e,t=1;e=1==this.renderStyle?this.endYaw-this.startYaw:(t=15,this.endYaw-this.startYaw<=15&&(t=1),(this.endYaw-this.startYaw)/t+1),e*=3;for(var i=new Float64Array(3*e),n=2*e,r=this._longRadius,a=this._minorRadius,o=0,s=0,u=Cesium.IndexDatatype.createTypedArray(e,n),l=this.startYaw;l<=this.endYaw;l+=t)i[o++]=a*Math.sin(l*Math.PI/180),i[o++]=a*Math.cos(l*Math.PI/180),i[o++]=0,i[o++]=r*Math.sin(l*Math.PI/180),i[o++]=r*Math.cos(l*Math.PI/180),i[o++]=0;for(var c=0;c<e-1;c++)u[s++]=c,u[s++]=c+1,u[s++]=c+2;return{position:i,indices:u}},Ni.prototype.createOutlineMesh=function(){var e,t=1;e=1==this.renderStyle?this.endYaw-this.startYaw:(t=15,this.endYaw-this.startYaw<=15&&(t=1),(this.endYaw-this.startYaw)/t+1),e*=2;for(var i=new Float64Array(3*e),n=4*e,r=this._longRadius,a=this._minorRadius,o=0,s=0,u=Cesium.IndexDatatype.createTypedArray(e,n),l=this.startYaw;l<this.endYaw+t;l+=t)i[o++]=a*Math.sin(l*Math.PI/180),i[o++]=a*Math.cos(l*Math.PI/180),i[o++]=0,i[o++]=r*Math.sin(l*Math.PI/180),i[o++]=r*Math.cos(l*Math.PI/180),i[o++]=0;for(var c=0;c<e;c+=2)u[s++]=c,u[s++]=c+1,(u[s++]=c)!=e-2&&(u[s++]=c+2,u[s++]=c+1,u[s++]=c+2,u[s++]=c+1,u[s++]=c+3);return{position:i,indices:u}},Vi.prototype.update=function(e){var t=e.context,i=this,n=this._command;this._command.uniformMap={v_colour:function(){return i.lineColor}},Cesium.defined(n.shaderProgram)||(n.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:"attribute vec3 position;\nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvoid main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position =czm_viewProjection* czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"uniform vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}));var r,a,o,s,u,l,c,m,d,h=this.createLineMesh();0<this.instances.length&&(n.vertexArray=(a=t,o=h,s=function(e){var t=e.instances,i=t.length,n=e._center,r=e._vertexBufferTypedArray;Cesium.defined(r)||(r=new Float32Array(12*i));e._dynamic&&(e._vertexBufferTypedArray=r);for(var a=[],o=0;o<i;++o){var s=t[o].modelMatrix,u=Cesium.Matrix4.clone(s,new Cesium.Matrix4);u[12]-=n.x,u[13]-=n.y,u[14]-=n.z,a.push(new Cesium.Cartesian3(u[12],u[13],u[14]));var l=12*o;r[0+l]=u[0],r[1+l]=u[4],r[2+l]=u[8],r[3+l]=u[12],r[4+l]=u[1],r[5+l]=u[5],r[6+l]=u[9],r[7+l]=u[13],r[8+l]=u[2],r[9+l]=u[6],r[10+l]=u[10],r[11+l]=u[14]}return e.boundingSphere=Cesium.BoundingSphere.fromPoints(a),r}(r=this),u=Cesium.Buffer.createVertexBuffer({context:a,typedArray:s,usage:r._dynamic?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW}),l=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),c={czm_modelMatrixRow0:{index:0,vertexBuffer:u,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*l,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:u,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*l,strideInBytes:12*l,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:u,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*l,strideInBytes:12*l,instanceDivisor:1}},m=0,(d=[]).push({index:m++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:a,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(o.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),c.czm_modelMatrixRow0.index=m++,d.push(c.czm_modelMatrixRow0),c.czm_modelMatrixRow1.index=m++,d.push(c.czm_modelMatrixRow1),c.czm_modelMatrixRow2.index=m++,d.push(c.czm_modelMatrixRow2),new Cesium.VertexArray({context:a,attributes:d,indexBuffer:Cesium.Buffer.createIndexBuffer({context:a,typedArray:new Uint16Array(o.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})),n.instanceCount=this.instances.length,n.cull=!0,n._boundingVolume=this.boundingSphere),this.show instanceof Cesium.CallbackProperty?this._show=this.show.getValue():this._show=this.show,Cesium.defined(n.vertexArray)&&this._show&&e.commandList.push(n)},Vi.prototype.destroy=function(){var e,t=this._command;return t.vertexArray=t.vertexArray&&t.vertexArray.destroy(),t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy(),!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._scene.primitives._guid]),Cesium.destroyObject(this)},Vi.prototype.createLineMesh=function(){var e=new Float64Array(6),t=(this.radius,0),i=Cesium.IndexDatatype.createTypedArray(2,2);return e[t++]=0,e[t++]=this._radius,e[t++]=0,e[t++]=0,e[t++]=-this._radius,i[e[t++]=0]=0,i[1]=1,{position:e,indices:i}},Ui.prototype.setInstance=function(){for(var e=[],t=180/this._columnNumber,i=0,n=0;n<this._columnNumber;n++){var r=i*Cesium.Math.PI/180,a=Cesium.Matrix3.fromRotationZ(r,new Cesium.Matrix3),o=Cesium.Matrix4.multiplyByMatrix3(this._modelMatrix,a,new Cesium.Matrix4);e.push({modelMatrix:o}),i+=t}return e},Ui.prototype.createRing=function(){var e=this._rowNumber,t=this,i=ki(this.circleCenter).height<=0?2:ki(this.circleCenter).height;if(console.log(i),0<e){var n=this._viewer.entities.add({position:this.circleCenter,ellipse:{semiMinorAxis:this._innerRadius,semiMajorAxis:this._innerRadius,material:this._innerColor,height:i}});if(this.entityArr.push(n),this._rowNumber!=this.ringRadius.length||this._rowNumber!=this.ringColor.length)throw new DeveloperError("圆环数量与参数不匹配。");for(var r=0;r<this._rowNumber-1;r++){var a=new Ni({viewer:this._viewer,show:new Cesium.CallbackProperty(function(){return t.show},!1),minorRadius:this.ringRadius[r],longRadius:this.ringRadius[r+1],fillColor:this.ringColor[r+1],lineColor:this.ringColor[r+1],lon:ki(this.circleCenter).lon,lat:ki(this.circleCenter).lat,height:ki(this.circleCenter).height,renderStyle:1});this.ringArr.push(a)}}},Ui.prototype.createLabels=function(){for(var e=this,t=360/(2*this._columnNumber),i=0,n=0;n<2*this._columnNumber;n++){var r=i*Cesium.Math.PI/180,a=new Cesium.Cartesian3((this.ringRadius[this.ringRadius.length-1]+1e3)*Math.sin(r),(this.ringRadius[this.ringRadius.length-1]+1e3)*Math.cos(r),0),o=Cesium.Matrix4.multiplyByPoint(this._modelMatrix,a,new Cesium.Cartesian3),s=this._viewer.entities.add({position:o,label:{text:i+"°",font:"20px 宋体",horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,10),disableDepthTestDistance:Number.POSITIVE_INFINITY,outlineColor:Cesium.Color.RED,style:Cesium.LabelStyle.FILL_AND_OUTLINE,distanceDisplayCondition:e.distanceDisplayCondition,fillColor:Cesium.Color.RED,show:new Cesium.CallbackProperty(function(){return e.show},!1)}});this.entityArr.push(s),i+=t}for(n=0;n<this._rowNumber;n++){var u=new Cesium.Cartesian3(0,this.ringRadius[n],0),l=Cesium.Matrix4.multiplyByPoint(this._modelMatrix,u,new Cesium.Cartesian3),c=this._viewer.entities.add({position:l,label:{text:Gi(this.ringRadius[n]),font:"20px 宋体",horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,10),disableDepthTestDistance:Number.POSITIVE_INFINITY,outlineColor:Cesium.Color.RED,style:Cesium.LabelStyle.FILL_AND_OUTLINE,distanceDisplayCondition:e.distanceDisplayCondition,fillColor:Cesium.Color.RED,show:new Cesium.CallbackProperty(function(){return e.show},!1)}});this.entityArr.push(c)}},Ui.prototype.remove=function(){if(this.line&&this.line.destroy(),0!=this.ringArr.length)for(var e=0;e<this.ringArr.length;e++)this.ringArr[e].remove();if(0!=this.entityArr.length)for(e=0;e<this.entityArr.length;e++)this._viewer.entities.remove(this.entityArr[e])};var ji,Yi=new W;function Xi(e,t){--e._activeTasks;var i,n,r,a=t.id;oe(a)&&(n=(i=e._deferreds)[a],oe(t.error)?("RuntimeError"===(r=t.error).name?(r=new ue(t.error.message)).stack=t.error.stack:"DeveloperError"===r.name&&((r=new x(t.error.message)).stack=t.error.stack),Yi.raiseEvent(r),n.reject(r)):(Yi.raiseEvent(),n.resolve(t.result)),delete i[a])}function Ki(e){if(N(r=yt(e))){var t,i='importScripts("'+r+'");';try{t=new Blob([i],{type:"application/javascript"})}catch(e){var n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);n.append(i),t=n.getBlob("application/javascript")}var r=(window.URL||window.webkitURL).createObjectURL(t)}return r}function Zi(t){var e=new Worker((oe(ji)||(ji=Ki("Workers/cesiumWorkerBootstrapper.js")),ji));e.postMessage=z(e.webkitPostMessage,e.postMessage);var i={loaderConfig:{paths:{Workers:yt("Workers")},baseUrl:yt.getCesiumBaseUrl().url},workerModule:Ji._workerModulePrefix+t._workerName};return e.postMessage(i),e.onmessage=function(e){Xi(t,e.data)},e}function Ji(e,t){this._workerName=e,this._maximumActiveTasks=z(t,5),this._activeTasks=0,this._deferreds={},this._nextID=0}var Qi=[];function $i(e){this.geometry=void 0,this.blUpdateVAO=!1,this.allInvisible=!0,this.backColor=new Cesium.Color(30/255,100/255,50/255,.5);var t=this;this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1}),uniformMap:{u_backColor:function(){return t.backColor}}})}Ji.prototype.scheduleTask=function(n,r){if(oe(this._worker)||(this._worker=Zi(this)),!(this._activeTasks>=this._maximumActiveTasks)){++this._activeTasks;var a=this;return C(qi(),function(e){oe(r)?e||(r.length=0):r=Qi;var t=a._nextID++,i=C.defer();return a._deferreds[t]=i,a._worker.postMessage({id:t,parameters:n,canTransferArrayBuffer:e},r),i.promise})}},Ji.prototype.initWebAssemblyModule=function(e){oe(this._worker)||(this._worker=Zi(this));var r=C.defer(),a=this,o=this._worker;return function(e,t){var i={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(He.supportsWebAssembly())return i.modulePath=yt(t.modulePath),i.wasmBinaryFile=yt(t.wasmBinaryFile),nt.fetchArrayBuffer({url:i.wasmBinaryFile}).then(function(e){return i.wasmBinary=e,i});if(!oe(t.fallbackModulePath))throw new ue("This browser does not support Web Assembly, and no backup module was provided for "+e._workerName);return i.modulePath=yt(t.fallbackModulePath),C.resolve(i)}(this,e).then(function(n){return C(qi(),function(e){var t,i=n.wasmBinary;oe(i)&&e&&(t=[i]),o.onmessage=function(e){o.onmessage=function(e){Xi(a,e.data)},r.resolve(e.data)},o.postMessage({webAssemblyConfig:n},t)})}),r},Ji.prototype.isDestroyed=function(){return!1},Ji.prototype.destroy=function(){return oe(this._worker)&&this._worker.terminate(),Wi(this)},Ji.taskCompletedEvent=Yi,Ji._workerModulePrefix=Ji._defaultWorkerModulePrefix="Workers/",Ji._canTransferArrayBuffer=void 0,Object.defineProperties($i.prototype,{});var en,tn,nn=new Ji("createRibbonVertices",1);function rn(e){this.viewer=e.viewer,this.mHorizontalnum=e.mHorizontalnum,this.sectionPoints=e.sectionPoints,this.mpVerticalVector=[],this.mpSplitLineVector=[],this.mpScaleVectorList=[],this.maxAngle=0,this.mOnlyTerrain=!0,this.modelMatrix=e.modelMatrix,this.radarPosition=e.radarPosition}function an(e,t,i,n){e.mpSplitLineVector=[];e.maxAngle=-90;var r=Cesium.Cartographic.fromCartesian(t),a=Cesium.Cartographic.fromCartesian(i),o=Cesium.Math.toDegrees(r.longitude),s=Cesium.Math.toDegrees(r.latitude),u=(r.height,Cesium.Math.toDegrees(a.longitude)),l=Cesium.Math.toDegrees(a.latitude),c=(a.height,e.viewer.scene.globe.getHeight(r)),m=new Cesium.Cartesian3.fromDegrees(o,s,c),d=function(e,t,i,n,r,a,o){var s=[];if(r-i==0)for(var u=0;u<=t;u++){var l=i,c=u/t*(a-n)+n,m=0;o&&(m=e.viewer.scene.globe.getHeight(new Cesium.Cartographic(Cesium.Math.toRadians(l),Cesium.Math.toRadians(c)))),s.push(new Cesium.Cartesian3.fromDegrees(l,c,m))}else for(var d=(a-n)/(r-i),u=0;u<=t;u++){c=d*((l=u/t*(r-i)+i)-i)+n,m=0;o&&(m=e.viewer.scene.globe.getHeight(new Cesium.Cartographic(Cesium.Math.toRadians(l),Cesium.Math.toRadians(c)))),s.push(new Cesium.Cartesian3.fromDegrees(l,c,m))}return s}(e,n,o,s,u,l,!0);e.mpSplitLineVector=[{mPitchAngle:-90,mPitchPoint:d[0]}];for(var h=Cesium.Cartesian3.normalize(new Cesium.Cartesian3(-m.x,-m.y,-m.z)),f=0;f<n;f++){var p,_,C,g=Cesium.Cartesian3.subtract(d[n-f],m);0!=g.x&&0!=g.y&&0!=g.z&&(p=Cesium.Cartesian3.normalize(g),_=Cesium.Cartesian3.dot(h,p),(C=Cesium.Math.toDegrees(Math.acos(_)))>e.maxAngle&&(e.mpSplitLineVector.push({mPitchAngle:C,mPitchPoint:d[n-f]}),e.maxAngle=C))}}function on(e,t,i,n,r){for(var a=n.length,o=0;o<a-1;o++){var s=Cesium.Cartesian3.normalize(new Cesium.Cartesian3(-r.x,-r.y,-r.z)),u=Cesium.Cartesian3.subtract(n[o+1].mPitchPoint,r);if(0!=u.x&&0!=u.y&&0!=u.z){var l=Cesium.Cartesian3.normalize(u),c=Cesium.Math.toDegrees(Math.acos(Cesium.Cartesian3.dot(s,l))),m=n[o+1].mPitchPoint;if(e.mOnlyTerrain&&!(c>=e.maxAngle))for(var d=i.length,h=0;h<d-1;h++){var f,p,_,C,g,v,y,T=i[h].mPitchAngle,x=i[h].mPitchPoint,w=i[h+1].mPitchAngle,A=i[h+1].mPitchPoint;T<c&&c<w&&(f=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(r,x)),p=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(A,x)),_=Cesium.Cartesian3.subtract(x,r),C=Cesium.Cartesian3.subtract(m,r),g=c-T,v=Math.acos(Cesium.Cartesian3.dot(f,p)),1<(y=Math.tan(v)*Cesium.Cartesian3.magnitude(_)/(Math.tan(v)+Math.tan(g))/Cesium.Cartesian3.magnitude(C))&&(y=1),y<0&&(y=1e-5),e.mpScaleVectorList[t+a-o-2].powerScale=y)}}}}function sn(e,t,i){e.mpVerticalVector=[];for(var n=i.length/e.mHorizontalnum,r=t*n,a=0;a<n;a++){e.sectionPoints[a];var o=i[r+n-1-a],o=Cesium.Matrix4.multiplyByVector(e.modelMatrix,new Cesium.Cartesian4(o.x,o.y,o.z,1),new Cesium.Cartesian3);e.sectionPoints[a].mPitchPoint=Cesium.Cartesian3.fromCartesian4(o),e.mpVerticalVector.push(e.sectionPoints[a])}}function un(e){if(!Cesium.defined(e))throw new DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.position))throw new DeveloperError("位置参数options.position不能为空。");this._viewer=e.viewer,this._id=e.id,this._scene=this._viewer.scene,this.show=Cesium.defaultValue(e.show,!0),this._show=void 0,this.showScan=Cesium.defaultValue(e.showScan,!0),this._position=Cesium.defaultValue(e.position,new Cesium.Cartesian3(100,20,1e3)),this._colorCommands=[],this._startYaw=Cesium.defaultValue(e.startYaw,0),this._endYaw=Cesium.defaultValue(e.endYaw,360),this._angularRate=Cesium.defaultValue(e.angularRate,50),this.curAngle=Cesium.defaultValue(e.curAngle,0),this.deltaAngle=Cesium.defaultValue(e.deltaAngle,15),this._center=new Cesium.Cartesian3,this.radius=Cesium.defaultValue(e.radius,300),this._radius=void 0,this.envelopeColor=Cesium.defaultValue(e.envelopeColor,new Cesium.Color(1,.5,.1,.5)),this.scanColor=Cesium.defaultValue(e.sectorColor,new Cesium.Color(1,1,1,.28)),this._geoCenter=e.geoCenter,this.powerData=Cesium.defaultValue(e.powerData,[]),this.scanInArr=[0,143,142,0,1,143,142,285,284,142,143,285,1,144,143,1,2,144,143,286,285,143,144,286,2,145,144,2,3,145,144,287,286,144,145,287,3,146,145,3,4,146,145,288,287,145,146,288,4,147,146,4,5,147,146,289,288,146,147,289,5,148,147,5,6,148,147,290,289,147,148,290,6,149,148,6,7,149,148,291,290,148,149,291,7,150,149,7,8,150,149,292,291,149,150,292,8,151,150,8,9,151,150,293,292,150,151,293,9,152,151,9,10,152,151,294,293,151,152,294,10,153,152,10,11,153,152,295,294,152,153,295,11,154,153,11,12,154,153,296,295,153,154,296,12,155,154,12,13,155,154,297,296,154,155,297,13,156,155,13,14,156,155,298,297,155,156,298,14,157,156,14,15,157,156,299,298,156,157,299,15,158,157,15,16,158,157,300,299,157,158,300,16,159,158,16,17,159,158,301,300,158,159,301,17,160,159,17,18,160,159,302,301,159,160,302,18,161,160,18,19,161,160,303,302,160,161,303,19,162,161,19,20,162,161,304,303,161,162,304,20,163,162,20,21,163,162,305,304,162,163,305,21,164,163,21,22,164,163,306,305,163,164,306,22,165,164,22,23,165,164,307,306,164,165,307,23,166,165,23,24,166,165,308,307,165,166,308,24,167,166,24,25,167,166,309,308,166,167,309,25,168,167,25,26,168,167,310,309,167,168,310,26,169,168,26,27,169,168,311,310,168,169,311,27,170,169,27,28,170,169,312,311,169,170,312,28,171,170,28,29,171,170,313,312,170,171,313,29,172,171,29,30,172,171,314,313,171,172,314,30,173,172,30,31,173,172,315,314,172,173,315,31,174,173,31,32,174,173,316,315,173,174,316,32,175,174,32,33,175,174,317,316,174,175,317,33,176,175,33,34,176,175,318,317,175,176,318,34,177,176,34,35,177,176,319,318,176,177,319,35,178,177,35,36,178,177,320,319,177,178,320,36,179,178,36,37,179,178,321,320,178,179,321,37,180,179,37,38,180,179,322,321,179,180,322,38,181,180,38,39,181,180,323,322,180,181,323,39,182,181,39,40,182,181,324,323,181,182,324,40,183,182,40,41,183,182,325,324,182,183,325,41,184,183,41,42,184,183,326,325,183,184,326,42,185,184,42,43,185,184,327,326,184,185,327,43,186,185,43,44,186,185,328,327,185,186,328,44,187,186,44,45,187,186,329,328,186,187,329,45,188,187,45,46,188,187,330,329,187,188,330,46,189,188,46,47,189,188,331,330,188,189,331,47,190,189,47,48,190,189,332,331,189,190,332,48,191,190,48,49,191,190,333,332,190,191,333,49,192,191,49,50,192,191,334,333,191,192,334,50,193,192,50,51,193,192,335,334,192,193,335,51,194,193,51,52,194,193,336,335,193,194,336,52,195,194,52,53,195,194,337,336,194,195,337,53,196,195,53,54,196,195,338,337,195,196,338,54,197,196,54,55,197,196,339,338,196,197,339,55,198,197,55,56,198,197,340,339,197,198,340,56,199,198,56,57,199,198,341,340,198,199,341,57,200,199,57,58,200,199,342,341,199,200,342,58,201,200,58,59,201,200,343,342,200,201,343,59,202,201,59,60,202,201,344,343,201,202,344,60,203,202,60,61,203,202,345,344,202,203,345,61,204,203,61,62,204,203,346,345,203,204,346,62,205,204,62,63,205,204,347,346,204,205,347,63,206,205,63,64,206,205,348,347,205,206,348,64,207,206,64,65,207,206,349,348,206,207,349,65,208,207,65,66,208,207,350,349,207,208,350,66,209,208,66,67,209,208,351,350,208,209,351,67,210,209,67,68,210,209,352,351,209,210,352,68,211,210,68,69,211,210,353,352,210,211,353,69,212,211,69,70,212,211,354,353,211,212,354,70,213,212,70,71,213,212,355,354,212,213,355,71,214,213,71,72,214,213,356,355,213,214,356,72,215,214,72,73,215,214,357,356,214,215,357,73,216,215,73,74,216,215,358,357,215,216,358,74,217,216,74,75,217,216,359,358,216,217,359,75,218,217,75,76,218,217,360,359,217,218,360,76,219,218,76,77,219,218,361,360,218,219,361,77,220,219,77,78,220,219,362,361,219,220,362,78,221,220,78,79,221,220,363,362,220,221,363,79,222,221,79,80,222,221,364,363,221,222,364,80,223,222,80,81,223,222,365,364,222,223,365,81,224,223,81,82,224,223,366,365,223,224,366,82,225,224,82,83,225,224,367,366,224,225,367,83,226,225,83,84,226,225,368,367,225,226,368,84,227,226,84,85,227,226,369,368,226,227,369,85,228,227,85,86,228,227,370,369,227,228,370,86,229,228,86,87,229,228,371,370,228,229,371,87,230,229,87,88,230,229,372,371,229,230,372,88,231,230,88,89,231,230,373,372,230,231,373,89,232,231,89,90,232,231,374,373,231,232,374,90,233,232,90,91,233,232,375,374,232,233,375,91,234,233,91,92,234,233,376,375,233,234,376,92,235,234,92,93,235,234,377,376,234,235,377,93,236,235,93,94,236,235,378,377,235,236,378,94,237,236,94,95,237,236,379,378,236,237,379,95,238,237,95,96,238,237,380,379,237,238,380,96,239,238,96,97,239,238,381,380,238,239,381,97,240,239,97,98,240,239,382,381,239,240,382,98,241,240,98,99,241,240,383,382,240,241,383,99,242,241,99,100,242,241,384,383,241,242,384,100,243,242,100,101,243,242,385,384,242,243,385,101,244,243,101,102,244,243,386,385,243,244,386,102,245,244,102,103,245,244,387,386,244,245,387,103,246,245,103,104,246,245,388,387,245,246,388,104,247,246,104,105,247,246,389,388,246,247,389,105,248,247,105,106,248,247,390,389,247,248,390,106,249,248,106,107,249,248,391,390,248,249,391,107,250,249,107,108,250,249,392,391,249,250,392,108,251,250,108,109,251,250,393,392,250,251,393,109,252,251,109,110,252,251,394,393,251,252,394,110,253,252,110,111,253,252,395,394,252,253,395,111,254,253,111,112,254,253,396,395,253,254,396,112,255,254,112,113,255,254,397,396,254,255,397,113,256,255,113,114,256,255,398,397,255,256,398,114,257,256,114,115,257,256,399,398,256,257,399,115,258,257,115,116,258,257,400,399,257,258,400,116,259,258,116,117,259,258,401,400,258,259,401,117,260,259,117,118,260,259,402,401,259,260,402,118,261,260,118,119,261,260,403,402,260,261,403,119,262,261,119,120,262,261,404,403,261,262,404,120,263,262,120,121,263,262,405,404,262,263,405,121,264,263,121,122,264,263,406,405,263,264,406,122,265,264,122,123,265,264,407,406,264,265,407,123,266,265,123,124,266,265,408,407,265,266,408,124,267,266,124,125,267,266,409,408,266,267,409,125,268,267,125,126,268,267,410,409,267,268,410,126,269,268,126,127,269,268,411,410,268,269,411,127,270,269,127,128,270,269,412,411,269,270,412,128,271,270,128,129,271,270,413,412,270,271,413,129,272,271,129,130,272,271,414,413,271,272,414,130,273,272,130,131,273,272,415,414,272,273,415,131,274,273,131,132,274,273,416,415,273,274,416,132,275,274,132,133,275,274,417,416,274,275,417,133,276,275,133,134,276,275,418,417,275,276,418,134,277,276,134,135,277,276,419,418,276,277,419,135,278,277,135,136,278,277,420,419,277,278,420,136,279,278,136,137,279,278,421,420,278,279,421,137,280,279,137,138,280,279,422,421,279,280,422,138,281,280,138,139,281,280,423,422,280,281,423,139,282,281,139,140,282,281,424,423,281,282,424,140,283,282,140,141,283,282,425,424,282,283,425,0,2,1,0,3,2,0,4,3,0,5,4,0,6,5,0,7,6,0,8,7,0,9,8,0,10,9,0,11,10,0,12,11,0,13,12,0,14,13,0,15,14,0,16,15,0,17,16,0,18,17,0,19,18,0,20,19,0,21,20,0,22,21,0,23,22,0,24,23,0,25,24,0,26,25,0,27,26,0,28,27,0,29,28,0,30,29,0,31,30,0,32,31,0,33,32,0,34,33,0,35,34,0,36,35,0,37,36,0,38,37,0,39,38,0,40,39,0,41,40,0,42,41,0,43,42,0,44,43,0,45,44,0,46,45,0,47,46,0,48,47,0,49,48,0,50,49,0,51,50,0,52,51,0,53,52,0,54,53,0,55,54,0,56,55,0,57,56,0,58,57,0,59,58,0,60,59,0,61,60,0,62,61,0,63,62,0,64,63,0,65,64,0,66,65,0,67,66,0,68,67,0,69,68,0,70,69,0,71,70,0,72,71,0,73,72,0,74,73,0,75,74,0,76,75,0,77,76,0,78,77,0,79,78,0,80,79,0,81,80,0,82,81,0,83,82,0,84,83,0,85,84,0,86,85,0,87,86,0,88,87,0,89,88,0,90,89,0,91,90,0,92,91,0,93,92,0,94,93,0,95,94,0,96,95,0,97,96,0,98,97,0,99,98,0,100,99,0,101,100,0,102,101,0,103,102,0,104,103,0,105,104,0,106,105,0,107,106,0,108,107,0,109,108,0,110,109,0,111,110,0,112,111,0,113,112,0,114,113,0,115,114,0,116,115,0,117,116,0,118,117,0,119,118,0,120,119,0,121,120,0,122,121,0,123,122,0,124,123,0,125,124,0,126,125,0,127,126,0,128,127,0,129,128,0,130,129,0,131,130,0,132,131,0,133,132,0,134,133,0,135,134,0,136,135,0,137,136,0,138,137,0,139,138,0,140,139,0,141,140,284,285,286,284,286,287,284,287,288,284,288,289,284,289,290,284,290,291,284,291,292,284,292,293,284,293,294,284,294,295,284,295,296,284,296,297,284,297,298,284,298,299,284,299,300,284,300,301,284,301,302,284,302,303,284,303,304,284,304,305,284,305,306,284,306,307,284,307,308,284,308,309,284,309,310,284,310,311,284,311,312,284,312,313,284,313,314,284,314,315,284,315,316,284,316,317,284,317,318,284,318,319,284,319,320,284,320,321,284,321,322,284,322,323,284,323,324,284,324,325,284,325,326,284,326,327,284,327,328,284,328,329,284,329,330,284,330,331,284,331,332,284,332,333,284,333,334,284,334,335,284,335,336,284,336,337,284,337,338,284,338,339,284,339,340,284,340,341,284,341,342,284,342,343,284,343,344,284,344,345,284,345,346,284,346,347,284,347,348,284,348,349,284,349,350,284,350,351,284,351,352,284,352,353,284,353,354,284,354,355,284,355,356,284,356,357,284,357,358,284,358,359,284,359,360,284,360,361,284,361,362,284,362,363,284,363,364,284,364,365,284,365,366,284,366,367,284,367,368,284,368,369,284,369,370,284,370,371,284,371,372,284,372,373,284,373,374,284,374,375,284,375,376,284,376,377,284,377,378,284,378,379,284,379,380,284,380,381,284,381,382,284,382,383,284,383,384,284,384,385,284,385,386,284,386,387,284,387,388,284,388,389,284,389,390,284,390,391,284,391,392,284,392,393,284,393,394,284,394,395,284,395,396,284,396,397,284,397,398,284,398,399,284,399,400,284,400,401,284,401,402,284,402,403,284,403,404,284,404,405,284,405,406,284,406,407,284,407,408,284,408,409,284,409,410,284,410,411,284,411,412,284,412,413,284,413,414,284,414,415,284,415,416,284,416,417,284,417,418,284,418,419,284,419,420,284,420,421,284,421,422,284,422,423,284,423,424,284,424,425],this.sectionPoints=[],this.vertexPositions=[],this.points=[],this.mpTerrainShade=void 0,this.scanSpeed=Cesium.defaultValue(e.scanSpeed,1500),this._modelMatrix=Cesium.defaultValue(e.modelMatrix,void 0),this._scanModelMatrix=Cesium.defaultValue(e.scanModelMatrix,new Cesium.Matrix4),this.updateRotator=!1,this.changeScan=!1,this._time=(new Date).getTime(),this.shadeType=Cesium.defaultValue(e.shadeType,0),this.tsSectionPoint=[{mPitchAngle:0,mPitchPoint:new Cesium.Cartesian3(0,0,0)}],this.mHorizontalnum=parseInt(360/this.deltaAngle)+1,this.scanIndex=0,this.startTerrainShade=Cesium.defaultValue(e.startTerrainShade,!0),this.updateShade=Cesium.defaultValue(e.updateShade,!1),this._fillCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._outlineCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._scanCommand=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})}),this._fillVA=void 0,this._outlineVA=void 0,this._scanVA=void 0;var t=new Cesium.Resource({url:Cesium.buildModuleUrl("Assets/EMExtensions/powerData.txt")}),r=this;t.fetchText().then(function(e){for(var t=e.split("\r\n"),i=0;i<t.length-1;i++){var n=t[i].indexOf("=");r.powerData.push({x:t[i].substring(0,n),y:t[i].substring(n+1)})}!function(e){e.points=function(e){var t=[];t.push(new Cesium.Cartesian2(0,0));for(var i=e.powerData.length-1;0<=i;--i){var n,r=e.powerData[i].y,a=Cesium.Math.toRadians(e.powerData[i].x);t.push(new Cesium.Cartesian2(r*Math.cos(a),r*Math.sin(a))),e.startTerrainShade&&((n={}).mPitchAngle=Number(e.powerData[i].x),n.mPitchPoint=new Cesium.Cartesian3(r*Math.cos(a)*1e3,r*Math.sin(a)*1e3,0),e.tsSectionPoint.push(n))}return t.push(new Cesium.Cartesian2(0,0)),e.tsSectionPoint.push({mPitchAngle:0,mPitchPoint:new Cesium.Cartesian3(0,0,0)}),t}(e);for(var t=0;t<e.points.length;++t)e.sectionPoints.push(new Cesium.Cartesian3(0,e.points[t].y,e.points[t].x));e.updateRotator=!0}(r)}),this._scene.primitives.add(this)}function ln(e){var t={iso8601:void 0};if(Cesium.defined(e))return t.iso8601=e,Cesium.TimeInterval.fromIso8601(t)}function cn(e,t,i,n){var r=function(e,t){var i=new Cesium.Matrix4,n=e._center,r=e._vertexBufferTypedArray;Cesium.defined(r)||(r=new Float32Array(12));var a=Cesium.Matrix4.clone(t,i);return a[12]-=n.x,a[13]-=n.y,a[14]-=n.z,[].push(new Cesium.Cartesian3(a[12],a[13],a[14])),r[0]=a[0],r[1]=a[4],r[2]=a[8],r[3]=a[12],r[4]=a[1],r[5]=a[5],r[6]=a[9],r[7]=a[13],r[8]=a[2],r[9]=a[6],r[10]=a[10],r[11]=a[14],r}(e,i),a=Cesium.Buffer.createVertexBuffer({context:t,typedArray:r,usage:Cesium.BufferUsage.STATIC_DRAW}),o=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),s={czm_modelMatrixRow0:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*o,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*o,strideInBytes:12*o,instanceDivisor:1}},u=0,l=[];return l.push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(n.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),l.push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.UNSIGNED_BYTE,new Uint8Array(n.color.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),s.czm_modelMatrixRow0.index=u++,l.push(s.czm_modelMatrixRow0),s.czm_modelMatrixRow1.index=u++,l.push(s.czm_modelMatrixRow1),s.czm_modelMatrixRow2.index=u++,l.push(s.czm_modelMatrixRow2),new Cesium.VertexArray({context:t,attributes:l,indexBuffer:Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(n.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})}function mn(e,t,i,n){n.vertexArray=t,n.modelMatrix=i,e._colorCommands.push(n)}function dn(){return"attribute vec3 position;\nattribute vec4 color; \nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_viewProjection * czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n"}function hn(){return"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}function fn(e,t){this.viewer=e,this.GeometryArr=[],this.callback=t}function pn(e){this._viewer=e.viewer,this.callback=e.callback,this._draw=new fn(this._viewer,this.callback),this.index=0,this._points=this._viewer.scene.primitives.add(new Cesium.PointPrimitiveCollection),this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.canvas)}function _n(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),r=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(i,new Cesium.Matrix4),n,new Cesium.Cartesian3),a=Cesium.Cartesian3.normalize(r,new Cesium.Cartesian3),o=Math.atan2(a.y,a.x)-Cesium.Math.PI_OVER_TWO,s=Cesium.Math.TWO_PI-Cesium.Math.zeroToTwoPi(o),u=Cesium.Transforms.eastNorthUpToFixedFrame(e),r=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),l=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(u,u),r,r);Cesium.Cartesian3.normalize(l,l);var c=Cesium.Math.PI_OVER_TWO-Cesium.Math.acosClamped(l.z);return new Cesium.HeadingPitchRoll(s,c,0)}$i.prototype.recreateVertexArrays=function(e){this.allInvisible=!0;var t=e.length;if(e instanceof Array&&0<t){for(var i=[],n=0;n<t;n++)Cesium.defined(e[n])&&e[n].ribbonVisible&&1<e[n].trackPoints.length&&(i.push({color:e[n].ribbonColor,scale:e[n].ribbonScale,trackPoints:e[n].trackPoints,forwardOffset:e[n].forwardOffset,upOffset:e[n].upOffset}),this.allInvisible=!1);if(0<i.length){var r=nn.scheduleTask({ribbons:i});if(!Cesium.defined(r))return void(i=[]);var a=this;Cesium.when(r).then(function(e){var t=new Cesium.GeometryAttributes;t.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float64Array(e.positionBuffer)}),t.normal=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float64Array(e.normalBuffer)}),t.pickColor=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:new Uint8Array(e.colorBuffer),normalize:!0}),a.geometry=new Cesium.Geometry({attributes:t,indices:Cesium.IndexDatatype.createTypedArray(e.positionBuffer/3,e.indices),boundingSphere:new Cesium.BoundingSphere(e.boundingSphere.center,e.boundingSphere.radius)}),a.blUpdateVAO=!0})}}},$i.prototype.update=function(e){var t=e.context,i=this._command;Cesium.defined(this.geometry)&&(this.allInvisible&&Cesium.defined(i.vertexArray)&&!i.vertexArray.isDestroyed()&&i.vertexArray.destroy(),this.blUpdateVAO&&(Cesium.defined(i.vertexArray)&&!i.vertexArray.isDestroyed()&&i.vertexArray.destroy(),i.vertexArray=Cesium.VertexArray.fromGeometry({context:t,geometry:this.geometry,attributeLocations:Cesium.GeometryPipeline.createAttributeLocations(this.geometry),bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),i._boundingVolume=this.geometry.boundingSphere,Cesium.defined(i.shaderProgram)||(i.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:"attribute vec3 position;\nattribute vec4 color; \nattribute vec3 normal; \nvarying vec4  v_colour;\nuniform vec4 u_backColor; \nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    if(dot(normalize(normal), normalize(czm_viewerPositionWC-position)) < 0.0){\n     v_colour = u_backColor; \n    }\n    gl_Position = czm_viewProjection * vec4(position, 1.0);\n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}))),Cesium.defined(i.vertexArray)&&e.commandList.push(i),this.blUpdateVAO=!1)},$i.prototype.isDestroyed=function(){return!1},$i.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.destroyObject(this)},rn.prototype.shadeAnalysistCalculateOnlyTerrain=function(e,t){for(var i=this.radarPosition,n=(new Cesium.Cartesian3,this.mHorizontalnum),r=e.length/n,a=0;a<n;a++){sn(this,a,e);for(var o=this.mpVerticalVector.length,s=0;s<o;s++){var u=this.mpVerticalVector[s].mPitchAngle,l={};l.verticalAngle=u,l.powerScale=1,this.mpScaleVectorList.push(l)}for(var c=1;c<r-1;c++)an(this,i,this.mpVerticalVector[c].mPitchPoint,t),on(this,a*r,this.mpSplitLineVector,this.mpVerticalVector,i)}},un.prototype.update=function(e){this._colorCommands.length=0;var t,i=e.mode,n=e.context,r=this._viewer.scene.frameState.time;if(this.show instanceof Array?function(e,t){if(0<e.show.length)for(var i=0;i<e.show.length;i++)if(e.show[i].boolean){var n=ln(e.show[i].interval);if(Cesium.JulianDate.compare(n.start,t)<=0&&0<=Cesium.JulianDate.compare(n.stop,t))return e._show=!0,Cesium.defined(e.radarWave)&&(e.radarWave.show=e._show)}else e._show=!1,Cesium.defined(e.radarWave)&&(e.radarWave.show=e._show)}(this,r):this._show!=this.show&&(this._show=this.show),this._show&&i===Cesium.SceneMode.SCENE3D){if(this.radius instanceof Cesium.CallbackProperty?this._radius=this.radius.getValue(e.time):this._radius=this.radius,Cesium.defined(this._modelMatrix)||(this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this._position),Cesium.Matrix4.multiplyByUniformScale(this._modelMatrix,this._radius,this._modelMatrix),t=Cesium.Matrix3.fromRotationX(Cesium.Math.PI_OVER_TWO,new Cesium.Matrix3),Cesium.Matrix4.multiplyByMatrix3(this._modelMatrix,t,this._modelMatrix),this._scanModelMatrix=this._modelMatrix),this.mpTerrainShade&&this.mpTerrainShade.mpScaleVectorList.length,this.showScan){var a=(new Date).getTime();if(a-this._time>this.scanSpeed){if(this.changeScan){this.points=[];var o=this.vertexPositions.length/this.mHorizontalnum;this.curAngle+=this.deltaAngle,this.curAngle>=this._endYaw&&(this.curAngle=0,this.scanIndex=0),this.scanIndex=this.mHorizontalnum-1-parseInt(this.curAngle/this.deltaAngle),console.log(this.curAngle,this.scanIndex,this.scanIndex*o);for(var s=this.vertexPositions.slice(this.scanIndex*o,(this.scanIndex+1)*o),u=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,Cesium.Math.toRadians(this.curAngle)),l=Cesium.Matrix3.fromQuaternion(u,new Cesium.Matrix3),c=0;c<s.length;c++){var m=Cesium.Matrix3.multiplyByVector(Cesium.Matrix3.inverse(l,new Cesium.Matrix3),s[c],new Cesium.Cartesian3);this.points.push(m)}}else this.curAngle+=this.deltaAngle,this.curAngle=360<this.curAngle?this.curAngle-360:this.curAngle,this.updateScan=!0;!function(e,t,i){e._scanModelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(e._position),Cesium.Matrix4.multiplyByUniformScale(e._scanModelMatrix,e._radius,e._scanModelMatrix);var n=Cesium.Matrix3.fromRotationX(Cesium.Math.PI_OVER_TWO,new Cesium.Matrix3);Cesium.Matrix4.multiplyByMatrix3(e._scanModelMatrix,n,e._scanModelMatrix);var r=Cesium.Matrix3.fromRotationY(t.heading,new Cesium.Matrix3);Cesium.Matrix4.multiplyByMatrix3(e._scanModelMatrix,r,e._scanModelMatrix);var a=Cesium.Matrix4.fromScale(i);e._scanModelMatrix=Cesium.Matrix4.multiply(e._scanModelMatrix,a,e._scanModelMatrix)}(this,new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(this.curAngle),0,0),new Cesium.Cartesian3(10,1,1)),this._time=a}}!function(e,t){var i=t.context;{var n,r;e.show&&(e.updateRotator||e.updateShade)&&(e.updateRotator=!1,n=function(e,t){if(t.length<=1)return;var i=new Cesium.Color(e.envelopeColor.red,e.envelopeColor.green,e.envelopeColor.blue,.2),n=e._startYaw,r=e._endYaw,a=e.deltaAngle,o=(r-n)/a+1,s=o*t.length,u=(o-1)*t.length*6,l=Cesium.IndexDatatype.createTypedArray(s,u),c=new Float64Array(3*s),m=new Uint8Array(4*s),d=0,h=0,f=0,p=0;if(e.updateShade){if(0==e.vertexPositions.length)return;p=e.vertexPositions.length/t.length}else for(var _=n;_<r+a;_+=a){p++;for(var C=r<_?r:_,g=0;g<t.length;g++){var v=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,Cesium.Math.toRadians(-C)),y=Cesium.Matrix3.fromQuaternion(v,new Cesium.Matrix3),T=Cesium.Matrix3.multiplyByVector(y,t[g],new Cesium.Cartesian3);Cesium.Matrix3.multiplyByVector(Cesium.Matrix3.inverse(y,new Cesium.Matrix3),T,new Cesium.Cartesian3);e.vertexPositions.push(T)}}for(var x=0;x<e.vertexPositions.length;x++){var w=e.vertexPositions[x];c[d++]=w.x,c[d++]=w.y,c[d++]=w.z,m[h++]=Cesium.Color.floatToByte(i.red),m[h++]=Cesium.Color.floatToByte(i.green),m[h++]=Cesium.Color.floatToByte(i.blue),m[h++]=Cesium.Color.floatToByte(i.alpha)}for(var A=0;A<p;++A)for(var E=0;E<t.length-1;++E)A<p-1&&(l[f++]=A*t.length+E,l[f++]=(A+1)*t.length+E+1,l[f++]=A*t.length+E+1,l[f++]=A*t.length+E,l[f++]=(A+1)*t.length+E,l[f++]=(A+1)*t.length+E+1);return{position:c,color:m,indices:l}}(e,e.sectionPoints),e._fillVA=cn(e,i,e._modelMatrix,n),r=function(e,t){if(t.length<=1)return;var i=e.envelopeColor,n=e._startYaw,r=e._endYaw,a=e.deltaAngle,o=((r-n)/a+1)*t.length,s=4*o,u=Cesium.IndexDatatype.createTypedArray(o,s),l=new Float64Array(3*o),c=new Uint8Array(4*o),m=0,d=0,h=0,f=0;if(e.updateShade){if(0==e.vertexPositions.length)return;f=e.vertexPositions.length/t.length}else for(var p=n;p<r+a;p+=a){f++;for(var _=r<p?r:p,C=0;C<t.length;C++){var g=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,Cesium.Math.toRadians(-_)),v=Cesium.Matrix3.fromQuaternion(g,new Cesium.Matrix3);Cesium.Matrix3.multiplyByVector(v,t[C],new Cesium.Cartesian3)}}for(var y=0;y<e.vertexPositions.length;y++){var T=e.vertexPositions[y];l[m++]=T.x,l[m++]=T.y,l[m++]=T.z,c[d++]=Cesium.Color.floatToByte(i.red),c[d++]=Cesium.Color.floatToByte(i.green),c[d++]=Cesium.Color.floatToByte(i.blue),c[d++]=Cesium.Color.floatToByte(i.alpha)}for(var x=0;x<f;++x)for(var w=0;w<t.length-1;++w)x==f-1&&r-n==360||(u[h++]=x*t.length+w,u[h++]=x*t.length+w+1),x<f-1&&(u[h++]=x*t.length+w,u[h++]=(x+1)*t.length+w);return{position:l,color:c,indices:u}}(e,e.sectionPoints),e._outlineVA=cn(e,i,e._modelMatrix,r))}{var a;e.showScan&&e.updateScan&&(0!=e.points.length||e.updateShade)&&(a=function(e,t){for(var i=e.scanColor,n=t.length,r=new Float64Array(3*n),a=new Uint8Array(4*n),o=new Uint32Array(e.scanInArr),s=0,u=0,l=0;l<t.length;++l)e.changeScan?(r[s++]=0,r[s++]=t[l].y,r[s++]=t[l].z):(r[s++]=0,r[s++]=t[l].y,r[s++]=t[l].x),a[u++]=Cesium.Color.floatToByte(i.red),a[u++]=Cesium.Color.floatToByte(i.green),a[u++]=Cesium.Color.floatToByte(i.blue),a[u++]=Cesium.Color.floatToByte(i.alpha);return{position:r,color:a,indices:o}}(e,e.points),e._scanVA=cn(e,i,e._scanModelMatrix,a))}e.updateShade&&(e.updateShade=!1)}(this,e),this._fillCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:dn(),fragmentShaderSource:hn()}),this._outlineCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:dn(),fragmentShaderSource:hn()}),this._scanCommand.shaderProgram=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:dn(),fragmentShaderSource:hn()}),this.show&&Cesium.defined(this._fillVA)&&mn(this,this._fillVA,this._modelMatrix,this._fillCommand),this.show&&Cesium.defined(this._outlineVA)&&mn(this,this._outlineVA,this._modelMatrix,this._outlineCommand),this.updateScan&&Cesium.defined(this._scanVA)&&mn(this,this._scanVA,this._scanModelMatrix,this._scanCommand);var d=e.commandList,h=e.passes,f=this._colorCommands;if(h.render)for(var c=0,p=f.length;c<p;c++){var _=f[c];d.push(_)}}},un.prototype.remove=function(){var e;return!this._scene.primitives.contains(this)||-1!==(e=this._scene.primitives._primitives.indexOf(this))&&(this._scene.primitives._primitives.splice(e,1),delete this._external._composites[this._viewer.scene.primitives._guid]),Cesium.destroyObject(this)},un.prototype.calTerrainShade=function(e){if(Cesium.defined(this.mpTerrainShade))throw new Error("地形遮蔽已开启");switch(this.mpTerrainShade=new rn({viewer:this._viewer,sectionPoints:this.tsSectionPoint,mHorizontalnum:this.mHorizontalnum,radarPosition:this._position,modelMatrix:this._modelMatrix}),this.shadeType){case 0:this.mpTerrainShade.shadeAnalysistCalculateOnlyTerrain(this.vertexPositions,e);break;case 1:this.mpTerrainShade.shadeAnalysistCalculateOnlyNearAngle(this.vertexPositions,e,shadeDataList);break;case 2:this.mpTerrainShade.shadeAnalysistCalculateWithTerrainNearAngle(this.vertexPositions,e,shadeDataList)}for(var t=0;t<this.vertexPositions.length;t++){var i=this.mpTerrainShade.mpScaleVectorList[t].powerScale;1!=i&&(this.vertexPositions[t]=Cesium.Cartesian3.multiplyByScalar(this.vertexPositions[t],i,new Cesium.Cartesian3))}this.updateShade=!0,this.changeScan=!0},fn.prototype={constructor:fn,drawClampToGroundLine:function(e){var t=this.viewer.entities.add({id:e.id,position:e.position,polyline:{positions:e.positions,width:e.lineWidth,material:e.material,clampToGround:!0}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawPolygon:function(e){var t=this.viewer.entities.add({id:e.id,position:e.position,polygon:{hierarchy:e.hierarchy,material:Cesium.Color.RED,outline:!0,outlineColor:e.outlineColor}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawEllipse:function(e){var t=this.viewer.entities.add({id:e.id,position:e.position,ellipse:{semiMinorAxis:e.semiMinorAxis,semiMajorAxis:e.semiMajorAxis,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,material:e.material,height:1e3,isCompareAxis:e.isCompareAxis}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawCurve:function(e){var t=new Rt({viewer:this.viewer,id:e.id,lon:e.lon,lat:e.lat,height:e.height,radius:e.radius});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawCuboid:function(e){var t=this.viewer.entities.add({id:e.id,position:e.position,rectangle:{coordinates:e.coordinates,extrudedHeight:e.extrudedHeight,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,stRotation:e.stRotation,material:e.material}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawCylinder:function(e){var t=this.viewer.entities.add({id:e.id,orientation:e.orientation,position:e.position,startPosition:e.startPosition,endPosition:e.endPosition,cylinder:{length:e.length,topRadius:e.topRadius,bottomRadius:e.bottomRadius,material:Cesium.Color.RED.withAlpha(.4),outline:e.outline,outlineColor:e.outlineColor,color:e.color,slices:e.slices,showBottom:e.showBottom}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawEllipsoid:function(e){var t=this.viewer.entities.add({id:e.id,position:e.position,ellipsoid:{radii:e.radii,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,slicePartitions:e.slicePartitions,stackPartitions:e.stackPartitions,material:e.material}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawCommonBox:function(e){var t=this.viewer.entities.add({id:e.id,position:e.position,box:{dimensions:e.dimensions,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,height:1,material:e.material}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawVehicleRadar:function(e){var t=new Si({viewer:this.viewer,id:e.id,position:e.position,radius:e.radius,color:e.color,showScanPlane:e.showScanPlane,scanPlaneColor:e.scanPlaneColor,scanPlaneRate:e.scanPlaneRate});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawFlightBillboard:function(e){var t=new Date,i=new Date(t.getTime()+1e5),n=new Cesium.Clock({startTime:Cesium.JulianDate.fromDate(t),currentTime:Cesium.JulianDate.fromDate(t),stopTime:Cesium.JulianDate.fromDate(i),clockStep:Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER,clockRange:Cesium.ClockRange.CLAMPED});new CesiumEMExtensions.EV_MovingTargetManager({viewer:viewer,ev_dataMgr:ev_dataMgr,trainingClock:n});setTimeout(function(){n.shouldAnimate=!0,console.log(n.currentTime),n.tick(),ev_dataMgr.receiveData.raiseEvent(ev_dataMgr.receiveMTFlightDatas,CesiumEMExtensions.EV_DataOperated.ADD)},1e3)},drawFlightRibbon:function(e){},drawParseArrayRadar:function(e){var t=new Pi({viewer:this.viewer,id:e.id,position:e.position,radius:e.radius});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawMechanicalRadar:function(e){var t=new un({viewer:viewer,id:e.id,position:e.position,showScan:e.showScan});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawCustomizedPARadar:function(e){var t=new Dt({viewer:viewer,position:e.position,pitchRange:new Cesium.Cartesian2(0,40),lineColor:e.lineColor,color:e.color});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawFanRing:function(e){var t=new Ni({viewer:this.viewer,id:e.id,lon:e.lon,lat:e.lat,height:e.height,longRadius:e.longRadius,minorRadius:e.minorRadius,fillColor:e.fillColor,lineColor:e.lineColor,renderStyle:e.renderStyle});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawAnnulus:function(e){var t=new xt({viewer:this.viewer,id:e.id,lon:e.lon,lat:e.lat,height:e.height,outerRadius:e.outerRadius,innerRadius:e.innerRadius,fillColor:e.fillColor,lineColor:e.lineColor,renderStyle:e.renderStyle});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawTargetRing:function(e){var t=new Ui({viewer:this.viewer,id:e.id,position:e.position});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawCommunicationLink:function(e){var t=this.viewer.entities.add({id:e.id,orientation:e.orientation,position:e.position,cylinder:{length:e.length,topRadius:e.topRadius,bottomRadius:e.bottomRadius,slices:e.slices,showBottom:e.showBottom,showTop:e.showTop,changeStCoordinate:e.changeStCoordinate,material:e.material}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},computeCircle:function(e){for(var t=[],i=0;i<360;i++){var n=Cesium.Math.toRadians(i);t.push(new Cesium.Cartesian2(e*Math.cos(n),e*Math.sin(n)))}return t},drawPolylineVolume:function(e){var t=this.viewer.entities.add({id:e.id,position:e.position,polylineVolume:{positions:e.positions,shape:e.shape,material:e.material,outline:e.outline,outlineColor:e.outlineColor}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawBoxVolume:function(e){var t=this.viewer.entities.add({id:e.id,polylineVolume:{positions:e.positions,shape:e.shape,cornerType:e.cornerType,outline:e.outline,outlineColor:e.outlineColor,outlineWidth:e.outlineWidth,material:e.material}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawCorridor:function(e){var t=this.viewer.entities.add({id:e.id,corridor:{positions:e.positions,width:e.width,height:e.height,extrudedHeight:e.extrudedHeight,cornerType:e.cornerType,material:e.material}});e.id&&(this.GeometryArr.push(t),this.callback&&this.callback(e.id))},drawLine:function(e){var t=this.viewer.entities.add({id:e.in_id,polyline:{positions:e.in_positions,width:e.in_width,material:e.in_color}});this.windageLine.push(t)},getOneEntity:function(e){return this.viewer.entities.getById(e)},removeOneEntity:function(t){var e,i=this.GeometryArr.find(function(e){return e.id==t});-1<t.indexOf("飘带")?this.removeRibbon():(i instanceof Cesium.Entity?this.viewer.entities.remove(i):i.remove(),-1<(e=this.GeometryArr.indexOf(t))&&(this.GeometryArr.splice(e,1),console.log("json",this.GeometryArr)))},removeAllEntity:function(){for(var e=0;e<this.GeometryArr.length;e++)this.GeometryArr[e]instanceof Cesium.Entity?this.viewer.entities.remove(this.GeometryArr[e]):this.GeometryArr[e]instanceof $i?this.viewer.scene.primitives.remove(this.GeometryArr[e]):this.GeometryArr[e].remove();this.GeometryArr=[]}},pn.prototype.exportLayerData=function(t){if(0<t.length)for(var i=0;i<t.length;i++)this._draw.GeometryArr.find(function(e){return e.id==t[i].label})},pn.prototype.drawLine=function(e){var t=this,i=(Cesium.defaultValue(e.pointColor,new Cesium.Color(1,1,0,1)),Cesium.defaultValue(e.lineColor,new Cesium.Color(1,0,0,1))),n=Cesium.defaultValue(e.lineWidth,3),r=!0,a=(this._points,[]);Cn=function(e){r&&(a.push(e),1==a.length&&(a.push(new Cesium.Cartesian3(e.x+1,e.y+1,e.z)),t._draw.drawClampToGroundLine({id:"折线_"+t.index++,position:e,positions:new Cesium.CallbackProperty(function(){return a},!1),lineWidth:n,material:i,clampToGround:!0})))},vn=function(e){r&&(a[a.length-1]=e)},gn=function(e){a.push(e),r=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawPolygon=function(e){var t=this,i=Cesium.defaultValue(e.fillColor,new Cesium.Color(0,1,0,1)),n=Cesium.defaultValue(e.outlineColor,new Cesium.Color(1,1,1,1)),r=Cesium.defaultValue(e.outline,2),a=!0,o=!1,s=!1,u=(this._points,[]);Cn=function(e){s||u.push(e),a&&(t._draw.drawPolygon({id:"多边形_"+t.index++,position:e,hierarchy:new Cesium.CallbackProperty(function(){return{positions:u}},!1),material:i,outline:r,outlineColor:n}),o=!(a=!1))},vn=function(e){o&&(1==u.length?u.push(e):u[u.length-1]=e)},gn=function(e){o=!(s=!0)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawRectangle=function(e){var t=this,i=Cesium.defaultValue(e.color,new Cesium.Color(0,1,0,1)),n=Cesium.defaultValue(e.outlineColor,new Cesium.Color(1,1,1,1)),r=Cesium.defaultValue(e.outline,!0),a=Cesium.defaultValue(e.outlineWidth,2),o=!0,s=100,u=[];Cn=function(e){o&&(u.push(e),t._draw.drawCommonBox({id:"矩形_"+t.index++,position:e,dimensions:new Cesium.CallbackProperty(function(){return new Cesium.Cartesian3(2*s,s,0)},!1),outline:r,outlineColor:n,outlineWidth:a,material:i}),o=!1)},vn=function(e){s=Cesium.Cartesian3.distance(u[0],e)},gn=function(e){u[1]=e,s=Cesium.Cartesian3.distance(u[0],e)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawCircle=function(e){var t=this,i=Cesium.defaultValue(e.color,new Cesium.Color(0,1,0,1)),n=Cesium.defaultValue(e.outlineColor,new Cesium.Color(1,1,0,1)),r=!0,a=!1,o=(this._points,1),s=[];Cn=function(e){r&&(s.push(e),t._draw.drawEllipse({id:"圆_"+t.index++,position:e,semiMinorAxis:new Cesium.CallbackProperty(function(){return o},!1),semiMajorAxis:new Cesium.CallbackProperty(function(){return o},!1),material:i,isCompareAxis:!1,material:i,outline:!0,outlineColor:n,outlineWidth:1}),a=!(r=!1))},vn=function(e){a&&(o=Cesium.Cartesian3.distance(s[0],e))},gn=function(e){o=Cesium.Cartesian3.distance(s[0],e),a=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawEllipse=function(e){var t=this,i=Cesium.defaultValue(e.color,new Cesium.Color(0,1,0,1)),n=Cesium.defaultValue(e.outlineColor,new Cesium.Color(1,1,0,1)),r=!0,a=!1,o=!1,s=100,u=100,l=[];Cn=function(e){r&&(0==l.length?(l.push(e),t._draw.drawEllipse({id:"椭圆_"+t.index++,position:e,semiMinorAxis:new Cesium.CallbackProperty(function(){return u},!1),semiMajorAxis:new Cesium.CallbackProperty(function(){return s},!1),isCompareAxis:!1,material:i,outline:!0,outlineColor:n,outlineWidth:1}),a=!0):(s=Cesium.Cartesian3.distance(l[0],e),r=a=!1))},vn=function(e){a?(s=Cesium.Cartesian3.distance(l[0],e),u=Cesium.Cartesian3.distance(l[0],e)):o||(u=Cesium.Cartesian3.distance(l[0],e))},gn=function(e){a?s=u=Cesium.Cartesian3.distance(l[0],e):u=Cesium.Cartesian3.distance(l[0],e),o=!0},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawCurve=function(e){var i=this,n=!0,r=!1,a=[],o=10;Cn=function(e){var t;n&&(a.push(e),t=wn(e),i._draw.drawCurve({id:"弧_"+i.index++,lon:t.lon,lat:t.lat,height:t.height,radius:new Cesium.CallbackProperty(function(){return o},!1)}),r=!(n=!1))},vn=function(e){r&&(o=Cesium.Cartesian3.distance(a[0],e))},gn=function(e){o=Cesium.Cartesian3.distance(a[0],e),r=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawCylinder=function(e){var t=this,i=!0,n=!1,r=[],a=Cesium.defaultValue(e.topRadius,5e3),o=Cesium.defaultValue(e.bottomRadius,5e3),s=Cesium.defaultValue(e.outline,!0),u=Cesium.defaultValue(e.outlineColor,Cesium.Color.fromRandom({alpha:1})),l=Cesium.defaultValue(e.color,Cesium.Color.fromRandom({alpha:1})),c=Cesium.defaultValue(e.slice,void 0),m=Cesium.defaultValue(e.id,"圆锥_");Cn=function(e){i&&(r.push(e),r.push(new Cesium.Cartesian3(e.x+100,e.y+100,e.z)),t._draw.drawCylinder({id:m+t.index++,orientation:new Cesium.CallbackProperty(function(){var e=_n(r[0],r[1]);return e.pitch+=Cesium.Math.PI_OVER_TWO,e.heading-=Cesium.Math.PI_OVER_TWO,Cesium.Transforms.headingPitchRollQuaternion(r[1],e)},!1),startPosition:r[0],endPosition:new Cesium.CallbackProperty(function(){return r[1]},!1),position:new Cesium.CallbackProperty(function(){var e=Cesium.Cartesian3.subtract(r[0],r[1],new Cesium.Cartesian3),t=Cesium.Cartesian3.divideByScalar(e,2,new Cesium.Cartesian3);return Cesium.Cartesian3.add(t,r[1],new Cesium.Cartesian3)},!1),length:new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.distance(r[0],r[1])},!1),topRadius:a,bottomRadius:o,outline:s,outlineColor:u,slices:c,color:l,showBottom:!1}),n=!(i=!1))},vn=function(e){n&&(r[1]=e)},gn=function(e){var t=Cesium.Cartographic.fromCartesian(e,Cesium.Ellipsoid.WGS84);t.height+=o,e=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height,Cesium.Ellipsoid.WGS84),r[1]=e,n=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawHalfsphere=function(e){this.drawVehicleRadar({showScanPlane:!1,id:"球面_"})},pn.prototype.drawEllipsoid=function(e){var i,n=this,r=!0,a=!1,o=[],s=10,u=Cesium.defaultValue(e.isBall,!0),l=Cesium.defaultValue(e.outline,!0),c=Cesium.defaultValue(e.outlineWidth,5),m=Cesium.defaultValue(e.color,Cesium.Color.fromRandom({alpha:.5})),d=Cesium.defaultValue(e.outlineColor,Cesium.Color.fromRandom({alpha:1})),h=Cesium.defaultValue(e.radii,new Cesium.Cartesian3(4500,4500,4500)),f=Cesium.defaultValue(e.slicePartitions,24),p=Cesium.defaultValue(e.stackPartitions,24),_=u?"球体_":"椭球体_";Cn=function(e){var t;console.log(e),r&&((t=Cesium.Cartographic.fromCartesian(e,Cesium.Ellipsoid.WGS84)).height+=h.z,i=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height,Cesium.Ellipsoid.WGS84),o.push(e),n._draw.drawEllipsoid({id:_+n.index++,position:new Cesium.CallbackProperty(function(){return i},!1),radii:new Cesium.CallbackProperty(function(){return h},!1),outline:l,outlineColor:d,outlineWidth:c,slicePartitions:f,stackPartitions:p,material:m}),a=!(r=!1))},vn=function(e){var t;a&&(s=Cesium.Cartesian3.distance(o[0],e),h.x=s,h.y=s,h.z=u?s:s/1.25,(t=Cesium.Cartographic.fromCartesian(o[0],Cesium.Ellipsoid.WGS84)).height=h.z,i=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height,Cesium.Ellipsoid.WGS84))},gn=function(e){s=Cesium.Cartesian3.distance(o[0],e),h.x=s,h.y=s,h.z=u?s:s/1.25;var t=Cesium.Cartographic.fromCartesian(o[0],Cesium.Ellipsoid.WGS84);t.height=h.z,i=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height,Cesium.Ellipsoid.WGS84),a=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawCuboid=function(e){var t=this,i=Cesium.defaultValue(e.color,new Cesium.Color(0,1,0,1)),n=Cesium.defaultValue(e.outlineColor,new Cesium.Color(0,1,0,1)),r=Cesium.defaultValue(e.outline,!0),a=Cesium.defaultValue(e.outlineWidth,2),o=!0,s=100,u=[];Cn=function(e){o&&(u.push(e),t._draw.drawCommonBox({id:"长方体_"+t.index++,position:e,dimensions:new Cesium.CallbackProperty(function(){return new Cesium.Cartesian3(s,s/2,s/2)},!1),outline:r,outlineColor:n,outlineWidth:a,material:i}),o=!1)},vn=function(e){s=Cesium.Cartesian3.distance(u[0],e)},gn=function(e){u[1]=e,s=Cesium.Cartesian3.distance(u[0],e)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawVehicleRadar=function(e){var t=this,i=!0,n=!1,r=[],a=Cesium.defaultValue(e.color,new Cesium.Color(0,1,0,.8)),o=Cesium.defaultValue(e.scanColor,new Cesium.Color(1,1,1,.5)),s=Cesium.defaultValue(e.scanRate,100),u=Cesium.defaultValue(e.showScanPlane,!0),l=Cesium.defaultValue(e.id,"车载雷达_"),c=1e3;Cn=function(e){i&&(r.push(e),t._draw.drawVehicleRadar({id:l+t.index++,position:e,radius:new Cesium.CallbackProperty(function(){return c},!1),color:a,showScanPlane:u,scanPlaneColor:o,scanPlaneRate:s}),n=!(i=!1))},vn=function(e){n&&(c=Cesium.Cartesian3.distance(r[0],e))},gn=function(e){c=Cesium.Cartesian3.distance(r[0],e),n=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawParseArrayRadar=function(e){var t=this,i=!0,n=!1,r=[],a=30;Cn=function(e){i&&(r.push(e),t._draw.drawParseArrayRadar({id:"相控状雷达_"+t.index++,position:e,radius:new Cesium.CallbackProperty(function(){return a},!1)}),n=!(i=!1))},vn=function(e){n&&(a=Cesium.Cartesian3.distance(r[0],e))},gn=function(e){a=Cesium.Cartesian3.distance(r[0],e),n=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawCustomizedPARadar=function(e){var t=this,i=!0;Cn=function(e){i&&(t._draw.drawCustomizedPARadar({id:"定制相控状雷达_"+t.index++,position:e,lineColor:new Cesium.Color(.5,1,1,.6),color:new Cesium.Color(.5,1,1,.1)}),i=!1)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK)},pn.prototype.drawMechanicalRadar=function(e){var t=this,i=!0;Cn=function(e){i&&(t._draw.drawMechanicalRadar({id:"机械雷达_"+t.index++,position:e,showScan:!0}),i=!1)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK)},pn.prototype.drawFlightBillboard=function(e){var t=this,i=!0;Cn=function(e){i&&(t._draw.drawFlightBillboard({id:"飞机标牌_"+t.index++,position:e}),i=!1)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK)},pn.prototype.drawFlightRibbon=function(e){var t=this,i=!0;Cn=function(e){i&&(t._draw.drawFlightRibbon({id:"飞机飘带_"+t.index++,position:e}),i=!1)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK)},pn.prototype.drawFanRing=function(e){var i=this,n=!0,r=!1,a=[],o=Cesium.defaultValue(e.fillColor,new Cesium.Color(0,1,0,.5)),s=Cesium.defaultValue(e.lineColor,new Cesium.Color(1,1,1,.5)),u=Cesium.defaultValue(e.renderStyle,0),l=1e3;Cn=function(e){var t;n&&(a.push(e),t=wn(e),console.log(t),i._draw.drawFanRing({id:"扇环形_"+i.index++,lon:t.lon,lat:t.lat,height:t.height,longRadius:new Cesium.CallbackProperty(function(){return l},!1),minorRadius:new Cesium.CallbackProperty(function(){return 2*l/3},!1),fillColor:o,lineColor:s,renderStyle:u}),r=!(n=!1))},vn=function(e){r&&(l=Cesium.Cartesian3.distance(a[0],e))},gn=function(e){l=Cesium.Cartesian3.distance(a[0],e),r=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawAnnulus=function(e){var i=this,n=!0,r=!1,a=[],o=Cesium.defaultValue(e.fillColor,new Cesium.Color(0,1,1,.5)),s=Cesium.defaultValue(e.lineColor,new Cesium.Color(1,1,1,.5)),u=Cesium.defaultValue(e.renderStyle,0),l=1e3;Cn=function(e){var t;n&&(a.push(e),t=wn(e),i._draw.drawAnnulus({id:"环面体_"+i.index++,lon:t.lon,lat:t.lat,height:t.height,outerRadius:new Cesium.CallbackProperty(function(){return l},!1),innerRadius:new Cesium.CallbackProperty(function(){return 3*l/5},!1),fillColor:o,lineColor:s,renderStyle:u}),r=!(n=!1))},vn=function(e){r&&(l=Cesium.Cartesian3.distance(a[0],e))},gn=function(e){l=Cesium.Cartesian3.distance(a[0],e),r=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},pn.prototype.drawTargetRing=function(e){var t=this,i=!0;Cn=function(e){i&&(t._draw.drawTargetRing({id:"靶心_"+t.index++,position:e}),i=!1)},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK)},pn.prototype.drawCommunicationLink=function(e){var t=this,i=!0,n=!1,r=[];Cn=function(e){i&&(r.push(e),r.push(new Cesium.Cartesian3(e.x+1e3,e.y+1e3,e.z)),t._draw.drawCommunicationLink({id:"通信链路_"+t.index++,orientation:new Cesium.CallbackProperty(function(){var e=_n(r[0],r[1]);return e.pitch+=Cesium.Math.PI_OVER_TWO,e.heading-=Cesium.Math.PI_OVER_TWO,Cesium.Transforms.headingPitchRollQuaternion(r[1],e)},!1),position:new Cesium.CallbackProperty(function(){var e=Cesium.Cartesian3.subtract(r[0],r[1],new Cesium.Cartesian3),t=Cesium.Cartesian3.divideByScalar(e,2,new Cesium.Cartesian3);return Cesium.Cartesian3.add(t,r[1],new Cesium.Cartesian3)},!1),length:new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.distance(r[0],r[1])},!1),topRadius:0,bottomRadius:3e3,showBottom:!1,material:new Cesium.Color(1,0,0,1),changeStCoordinate:!0,material:new Cesium.PolylineTrailLinkMaterialProperty({color:Cesium.Color.WHITE,duration:1e4,trailImage:Cesium.buildModuleUrl("Assets/EMExtensions/downwavetexture.png")})}),n=!(i=!1))},vn=function(e){n&&(r[1]=e)},gn=function(e){r[1]=e,n=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)};var Cn,gn,vn,yn=!(pn.prototype.drawPolylineVolume=function(e){var t=this,i=!0,n=!1,r=[],a=Cesium.defaultValue(e.outline,!0),o=Cesium.defaultValue(e.radius,300),s=Cesium.defaultValue(e.outlineColor,Cesium.Color.fromRandom({alpha:1})),u=Cesium.defaultValue(e.color,Cesium.Color.fromRandom({alpha:0}));Cn=function(e){i&&(r.push(e),t._draw.drawPolylineVolume({id:"管道"+t.index++,position:e,positions:new Cesium.CallbackProperty(function(){return r},!1),shape:function(e){for(var t=[],i=0;i<360;i+=10){var n=Cesium.Math.toRadians(i);t.push(new Cesium.Cartesian2(e*Math.cos(n),e*Math.sin(n)))}return t}(o),material:u,outline:a,outlineColor:s}),n=!(i=!1))},vn=function(e){n&&(1==r.length?r.push(e):r[r.length-1]=e)},gn=function(e){n=!1},Tn(this,this._handler,Cesium.ScreenSpaceEventType.LEFT_CLICK,Cesium.ScreenSpaceEventType.RIGHT_CLICK)});function Tn(t,e,i,n){t.stopDraw=!1,yn=!1,en=i,tn=n,e.setInputAction(function(e){xn(t,e,Cesium.ScreenSpaceEventType.LEFT_CLICK)},Cesium.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(e){!function(e,t){{var i;yn&&(i=Cesium.EV_ScreenMethod.globePick(e._viewer.scene,t.endPosition),Cesium.defined(i)&&Cesium.defined(vn)&&vn(i))}}(t,e)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(e){xn(t,e,Cesium.ScreenSpaceEventType.RIGHT_CLICK)},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}function xn(e,t,i){var n,r;e.stopDraw||(i===tn&&yn?(n=e._viewer.camera.getPickRay(t.position),r=e._viewer.scene.globe.pick(n,e._viewer.scene),Cesium.defined(r)&&(Cesium.defined(gn)&&gn(r),yn=!1)):i===en&&(n=e._viewer.camera.getPickRay(t.position),r=e._viewer.scene.globe.pick(n,e._viewer.scene),Cesium.defined(r)&&(yn=!0,Cesium.defined(tn)||(yn=!1),Cesium.defined(Cn)&&Cn(r))))}function wn(e){var t=new Cesium.Cartographic.fromCartesian(e,Cesium.Ellipsoid.WGS84);return{lon:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),height:t.height}}function An(e,t,i,n){this.x=z(e,0),this.y=z(t,0),this.z=z(i,0),this.w=z(n,0)}An.fromElements=function(e,t,i,n,r){return oe(r)?(r.x=e,r.y=t,r.z=i,r.w=n,r):new An(e,t,i,n)},An.fromColor=function(e,t){return oe(t)?(t.x=e.red,t.y=e.green,t.z=e.blue,t.w=e.alpha,t):new An(e.red,e.green,e.blue,e.alpha)},An.clone=function(e,t){if(oe(e))return oe(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new An(e.x,e.y,e.z,e.w)},An.packedLength=4,An.pack=function(e,t,i){return i=z(i,0),t[i++]=e.x,t[i++]=e.y,t[i++]=e.z,t[i]=e.w,t},An.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new An),i.x=e[t++],i.y=e[t++],i.z=e[t++],i.w=e[t],i},An.packArray=function(e,t){var i=e.length,n=4*i;if(oe(t)){if(!Array.isArray(t)&&t.length!==n)throw new x("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==n&&(t.length=n)}else t=new Array(n);for(var r=0;r<i;++r)An.pack(e[r],t,4*r);return t},An.unpackArray=function(e,t){var i=e.length;oe(t)?t.length=i/4:t=new Array(i/4);for(var n=0;n<i;n+=4){var r=n/4;t[r]=An.unpack(e,n,t[r])}return t},An.fromArray=An.unpack,An.maximumComponent=function(e){return Math.max(e.x,e.y,e.z,e.w)},An.minimumComponent=function(e){return Math.min(e.x,e.y,e.z,e.w)},An.minimumByComponent=function(e,t,i){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i.w=Math.min(e.w,t.w),i},An.maximumByComponent=function(e,t,i){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i.w=Math.max(e.w,t.w),i},An.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},An.magnitude=function(e){return Math.sqrt(An.magnitudeSquared(e))};var En=new An;An.distance=function(e,t){return An.subtract(e,t,En),An.magnitude(En)},An.distanceSquared=function(e,t){return An.subtract(e,t,En),An.magnitudeSquared(En)},An.normalize=function(e,t){var i=An.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t.w=e.w/i,t},An.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},An.multiplyComponents=function(e,t,i){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i.w=e.w*t.w,i},An.divideComponents=function(e,t,i){return i.x=e.x/t.x,i.y=e.y/t.y,i.z=e.z/t.z,i.w=e.w/t.w,i},An.add=function(e,t,i){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i.w=e.w+t.w,i},An.subtract=function(e,t,i){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i.w=e.w-t.w,i},An.multiplyByScalar=function(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i.w=e.w*t,i},An.divideByScalar=function(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i.w=e.w/t,i},An.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},An.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t};var Sn=new An;An.lerp=function(e,t,i,n){return An.multiplyByScalar(t,i,Sn),n=An.multiplyByScalar(e,1-i,n),An.add(Sn,n,n)};var bn=new An;An.mostOrthogonalAxis=function(e,t){var i=An.normalize(e,bn);return An.abs(i,i),t=i.x<=i.y?i.x<=i.z?i.x<=i.w?An.clone(An.UNIT_X,t):An.clone(An.UNIT_W,t):i.z<=i.w?An.clone(An.UNIT_Z,t):An.clone(An.UNIT_W,t):i.y<=i.z?i.y<=i.w?An.clone(An.UNIT_Y,t):An.clone(An.UNIT_W,t):i.z<=i.w?An.clone(An.UNIT_Z,t):An.clone(An.UNIT_W,t)},An.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},An.equalsArray=function(e,t,i){return e.x===t[i]&&e.y===t[i+1]&&e.z===t[i+2]&&e.w===t[i+3]},An.equalsEpsilon=function(e,t,i,n){return e===t||oe(e)&&oe(t)&&ri.equalsEpsilon(e.x,t.x,i,n)&&ri.equalsEpsilon(e.y,t.y,i,n)&&ri.equalsEpsilon(e.z,t.z,i,n)&&ri.equalsEpsilon(e.w,t.w,i,n)},An.ZERO=Object.freeze(new An(0,0,0,0)),An.UNIT_X=Object.freeze(new An(1,0,0,0)),An.UNIT_Y=Object.freeze(new An(0,1,0,0)),An.UNIT_Z=Object.freeze(new An(0,0,1,0)),An.UNIT_W=Object.freeze(new An(0,0,0,1)),An.prototype.clone=function(e){return An.clone(this,e)},An.prototype.equals=function(e){return An.equals(this,e)},An.prototype.equalsEpsilon=function(e,t,i){return An.equalsEpsilon(this,e,t,i)},An.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var Mn=new Float32Array(1);function Rn(e,t,i,n,r,a,o,s,u,l,c,m,d,h,f,p){this[0]=z(e,0),this[1]=z(r,0),this[2]=z(u,0),this[3]=z(d,0),this[4]=z(t,0),this[5]=z(a,0),this[6]=z(l,0),this[7]=z(h,0),this[8]=z(i,0),this[9]=z(o,0),this[10]=z(c,0),this[11]=z(f,0),this[12]=z(n,0),this[13]=z(s,0),this[14]=z(m,0),this[15]=z(p,0)}function Dn(e){return 0<e?1:e<0?-1:0}An.packFloat=function(e,t){if(oe(t)||(t=new An),Mn[0]=e,0===(e=Mn[0]))return An.clone(An.ZERO,t);var i,n=e<0?1:0;isFinite(e)?(e=Math.abs(e),i=Math.floor(ri.logBase(e,10))+1,e/=Math.pow(10,i)):(e=.1,i=38);var r=256*e;return t.x=Math.floor(r),r=256*(r-t.x),t.y=Math.floor(r),r=256*(r-t.y),t.z=Math.floor(r),t.w=2*(i+38)+n,t},An.unpackFloat=function(e){var t=e.w/2,i=Math.floor(t),n=-(n=2*(n=2*(t-i))-1);if(38<=(i-=38))return n<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;var r=n*e.x*(1/256);return r+=n*e.y*(1/65536),(r+=n*e.z*(1/16777216))*Math.pow(10,i)},Rn.packedLength=16,Rn.computeReflection=function(e,t,i,n,r){return oe(r)||(r=new Rn),r[0]=1-2*e*e,r[1]=-2*e*t,r[2]=-2*e*i,r[3]=0,r[4]=-2*t*e,r[5]=1-2*t*t,r[6]=-2*t*i,r[7]=0,r[8]=-2*i*e,r[9]=-2*i*t,r[10]=1-2*i*i,r[11]=0,r[12]=-2*n*e,r[13]=-2*n*t,r[14]=-2*n*i,r[15]=1,r},Rn.computeObliquePerspective=function(e,t,i){var n=Rn.inverse(i,new Rn),r=Rn.inverseTranspose(t,new Rn),a=Rn.multiplyByVector(r,e,new An),o=new An(Dn(a.x),Dn(a.y),1,1),s=Rn.multiplyByVector(n,o,new An),u=2/An.dot(a,s),l=[a.x*u,a.y*u,a.z*u+1,a.w*u];return new Rn(i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],l[0],l[1],l[2],l[3],i[3],i[7],i[11],i[15])},Rn.inverseTranspose=function(e,t){return Rn.inverse(Rn.transpose(e,new Rn),t)},Rn.pack=function(e,t,i){return i=z(i,0),t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t[i++]=e[4],t[i++]=e[5],t[i++]=e[6],t[i++]=e[7],t[i++]=e[8],t[i++]=e[9],t[i++]=e[10],t[i++]=e[11],t[i++]=e[12],t[i++]=e[13],t[i++]=e[14],t[i]=e[15],t},Rn.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new Rn),i[0]=e[t++],i[1]=e[t++],i[2]=e[t++],i[3]=e[t++],i[4]=e[t++],i[5]=e[t++],i[6]=e[t++],i[7]=e[t++],i[8]=e[t++],i[9]=e[t++],i[10]=e[t++],i[11]=e[t++],i[12]=e[t++],i[13]=e[t++],i[14]=e[t++],i[15]=e[t],i},Rn.clone=function(e,t){if(oe(e))return oe(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):new Rn(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},Rn.fromArray=Rn.unpack,Rn.fromColumnMajorArray=function(e,t){return Rn.clone(e,t)},Rn.fromRowMajorArray=function(e,t){return oe(t)?(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t):new Rn(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Rn.fromRotationTranslation=function(e,t,i){return t=z(t,si.ZERO),oe(i)?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=0,i[4]=e[3],i[5]=e[4],i[6]=e[5],i[7]=0,i[8]=e[6],i[9]=e[7],i[10]=e[8],i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,i):new Rn(e[0],e[3],e[6],t.x,e[1],e[4],e[7],t.y,e[2],e[5],e[8],t.z,0,0,0,1)},Rn.fromTranslationQuaternionRotationScale=function(e,t,i,n){oe(n)||(n=new Rn);var r=i.x,a=i.y,o=i.z,s=t.x*t.x,u=t.x*t.y,l=t.x*t.z,c=t.x*t.w,m=t.y*t.y,d=t.y*t.z,h=t.y*t.w,f=t.z*t.z,p=t.z*t.w,_=t.w*t.w,C=s-m-f+_,g=2*(u-p),v=2*(l+h),y=2*(u+p),T=m-s-f+_,x=2*(d-c),w=2*(l-h),A=2*(d+c),E=-s-m+f+_;return n[0]=C*r,n[1]=y*r,n[2]=w*r,n[3]=0,n[4]=g*a,n[5]=T*a,n[6]=A*a,n[7]=0,n[8]=v*o,n[9]=x*o,n[10]=E*o,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n},Rn.fromTranslationRotationScale=function(e,t){return Rn.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t)},Rn.fromTranslation=function(e,t){return Rn.fromRotationTranslation(pi.IDENTITY,e,t)},Rn.fromScale=function(e,t){return oe(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Rn(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)},Rn.fromUniformScale=function(e,t){return oe(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Rn(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1)};var Pn=new si,In=new si,On=new si;Rn.fromCamera=function(e,t){var i=e.position,n=e.direction,r=e.up;si.normalize(n,Pn),si.normalize(si.cross(Pn,r,In),In),si.normalize(si.cross(In,Pn,On),On);var a=In.x,o=In.y,s=In.z,u=Pn.x,l=Pn.y,c=Pn.z,m=On.x,d=On.y,h=On.z,f=i.x,p=i.y,_=i.z,C=a*-f+o*-p+s*-_,g=m*-f+d*-p+h*-_,v=u*f+l*p+c*_;return oe(t)?(t[0]=a,t[1]=m,t[2]=-u,t[3]=0,t[4]=o,t[5]=d,t[6]=-l,t[7]=0,t[8]=s,t[9]=h,t[10]=-c,t[11]=0,t[12]=C,t[13]=g,t[14]=v,t[15]=1,t):new Rn(a,o,s,C,m,d,h,g,-u,-l,-c,v,0,0,0,1)},Rn.computePerspectiveFieldOfView=function(e,t,i,n,r){var a=1/Math.tan(.5*e),o=a/t,s=(n+i)/(i-n),u=2*n*i/(i-n);return r[0]=o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=s,r[11]=-1,r[12]=0,r[13]=0,r[14]=u,r[15]=0,r},Rn.computeOrthographicOffCenter=function(e,t,i,n,r,a,o){var s=1/(t-e),u=1/(n-i),l=1/(a-r),c=-(t+e)*s,m=-(n+i)*u,d=-(a+r)*l;return s*=2,u*=2,l*=-2,o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=l,o[11]=0,o[12]=c,o[13]=m,o[14]=d,o[15]=1,o},Rn.computePerspectiveOffCenter=function(e,t,i,n,r,a,o){var s=2*r/(t-e),u=2*r/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),m=-(a+r)/(a-r),d=-2*a*r/(a-r);return o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=0,o[7]=0,o[8]=l,o[9]=c,o[10]=m,o[11]=-1,o[12]=0,o[13]=0,o[14]=d,o[15]=0,o},Rn.computeInfinitePerspectiveOffCenter=function(e,t,i,n,r,a){var o=2*r/(t-e),s=2*r/(n-i),u=(t+e)/(t-e),l=(n+i)/(n-i),c=-2*r;return a[0]=o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s,a[6]=0,a[7]=0,a[8]=u,a[9]=l,a[10]=-1,a[11]=-1,a[12]=0,a[13]=0,a[14]=c,a[15]=0,a},Rn.computeViewportTransformation=function(e,t,i,n){e=z(e,z.EMPTY_OBJECT);var r=z(e.x,0),a=z(e.y,0),o=z(e.width,0),s=z(e.height,0);t=z(t,0);var u=.5*o,l=.5*s,c=.5*((i=z(i,1))-t),m=l,d=c,h=r+u,f=a+l,p=t+c;return n[0]=u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=d,n[11]=0,n[12]=h,n[13]=f,n[14]=p,n[15]=1,n},Rn.computeView=function(e,t,i,n,r){return r[0]=n.x,r[1]=i.x,r[2]=-t.x,r[3]=0,r[4]=n.y,r[5]=i.y,r[6]=-t.y,r[7]=0,r[8]=n.z,r[9]=i.z,r[10]=-t.z,r[11]=0,r[12]=-si.dot(n,e),r[13]=-si.dot(i,e),r[14]=si.dot(t,e),r[15]=1,r},Rn.toArray=function(e,t){return oe(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},Rn.getElementIndex=function(e,t){return 4*e+t},Rn.getColumn=function(e,t,i){var n=4*t,r=e[n],a=e[1+n],o=e[2+n],s=e[3+n];return i.x=r,i.y=a,i.z=o,i.w=s,i},Rn.setColumn=function(e,t,i,n){var r=4*t;return(n=Rn.clone(e,n))[r]=i.x,n[1+r]=i.y,n[2+r]=i.z,n[3+r]=i.w,n},Rn.setTranslation=function(e,t,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=e[15],i};var Ln=new si;Rn.setScale=function(e,t,i){var n=Rn.getScale(e,Ln),r=si.divideComponents(t,n,Ln);return Rn.multiplyByScale(e,r,i)},Rn.getRow=function(e,t,i){var n=e[t],r=e[t+4],a=e[t+8],o=e[t+12];return i.x=n,i.y=r,i.z=a,i.w=o,i},Rn.setRow=function(e,t,i,n){return(n=Rn.clone(e,n))[t]=i.x,n[t+4]=i.y,n[t+8]=i.z,n[t+12]=i.w,n};var Nn=new si;Rn.getScale=function(e,t){return t.x=si.magnitude(si.fromElements(e[0],e[1],e[2],Nn)),t.y=si.magnitude(si.fromElements(e[4],e[5],e[6],Nn)),t.z=si.magnitude(si.fromElements(e[8],e[9],e[10],Nn)),t};var Bn=new si;Rn.getMaximumScale=function(e){return Rn.getScale(e,Bn),si.maximumComponent(Bn)},Rn.multiply=function(e,t,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],m=e[8],d=e[9],h=e[10],f=e[11],p=e[12],_=e[13],C=e[14],g=e[15],v=t[0],y=t[1],T=t[2],x=t[3],w=t[4],A=t[5],E=t[6],S=t[7],b=t[8],M=t[9],R=t[10],D=t[11],P=t[12],I=t[13],O=t[14],L=t[15],N=n*v+s*y+m*T+p*x,B=r*v+u*y+d*T+_*x,z=a*v+l*y+h*T+C*x,F=o*v+c*y+f*T+g*x,V=n*w+s*A+m*E+p*S,U=r*w+u*A+d*E+_*S,G=a*w+l*A+h*E+C*S,k=o*w+c*A+f*E+g*S,H=n*b+s*M+m*R+p*D,W=r*b+u*M+d*R+_*D,q=a*b+l*M+h*R+C*D,j=o*b+c*M+f*R+g*D,Y=n*P+s*I+m*O+p*L,X=r*P+u*I+d*O+_*L,K=a*P+l*I+h*O+C*L,Z=o*P+c*I+f*O+g*L;return i[0]=N,i[1]=B,i[2]=z,i[3]=F,i[4]=V,i[5]=U,i[6]=G,i[7]=k,i[8]=H,i[9]=W,i[10]=q,i[11]=j,i[12]=Y,i[13]=X,i[14]=K,i[15]=Z,i},Rn.add=function(e,t,i){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i[4]=e[4]+t[4],i[5]=e[5]+t[5],i[6]=e[6]+t[6],i[7]=e[7]+t[7],i[8]=e[8]+t[8],i[9]=e[9]+t[9],i[10]=e[10]+t[10],i[11]=e[11]+t[11],i[12]=e[12]+t[12],i[13]=e[13]+t[13],i[14]=e[14]+t[14],i[15]=e[15]+t[15],i},Rn.subtract=function(e,t,i){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i[4]=e[4]-t[4],i[5]=e[5]-t[5],i[6]=e[6]-t[6],i[7]=e[7]-t[7],i[8]=e[8]-t[8],i[9]=e[9]-t[9],i[10]=e[10]-t[10],i[11]=e[11]-t[11],i[12]=e[12]-t[12],i[13]=e[13]-t[13],i[14]=e[14]-t[14],i[15]=e[15]-t[15],i},Rn.multiplyTransformation=function(e,t,i){var n=e[0],r=e[1],a=e[2],o=e[4],s=e[5],u=e[6],l=e[8],c=e[9],m=e[10],d=e[12],h=e[13],f=e[14],p=t[0],_=t[1],C=t[2],g=t[4],v=t[5],y=t[6],T=t[8],x=t[9],w=t[10],A=t[12],E=t[13],S=t[14],b=n*p+o*_+l*C,M=r*p+s*_+c*C,R=a*p+u*_+m*C,D=n*g+o*v+l*y,P=r*g+s*v+c*y,I=a*g+u*v+m*y,O=n*T+o*x+l*w,L=r*T+s*x+c*w,N=a*T+u*x+m*w,B=n*A+o*E+l*S+d,z=r*A+s*E+c*S+h,F=a*A+u*E+m*S+f;return i[0]=b,i[1]=M,i[2]=R,i[3]=0,i[4]=D,i[5]=P,i[6]=I,i[7]=0,i[8]=O,i[9]=L,i[10]=N,i[11]=0,i[12]=B,i[13]=z,i[14]=F,i[15]=1,i},Rn.multiplyByMatrix3=function(e,t,i){var n=e[0],r=e[1],a=e[2],o=e[4],s=e[5],u=e[6],l=e[8],c=e[9],m=e[10],d=t[0],h=t[1],f=t[2],p=t[3],_=t[4],C=t[5],g=t[6],v=t[7],y=t[8],T=n*d+o*h+l*f,x=r*d+s*h+c*f,w=a*d+u*h+m*f,A=n*p+o*_+l*C,E=r*p+s*_+c*C,S=a*p+u*_+m*C,b=n*g+o*v+l*y,M=r*g+s*v+c*y,R=a*g+u*v+m*y;return i[0]=T,i[1]=x,i[2]=w,i[3]=0,i[4]=A,i[5]=E,i[6]=S,i[7]=0,i[8]=b,i[9]=M,i[10]=R,i[11]=0,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},Rn.multiplyByTranslation=function(e,t,i){var n=t.x,r=t.y,a=t.z,o=n*e[0]+r*e[4]+a*e[8]+e[12],s=n*e[1]+r*e[5]+a*e[9]+e[13],u=n*e[2]+r*e[6]+a*e[10]+e[14];return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=o,i[13]=s,i[14]=u,i[15]=e[15],i};var zn=new si;Rn.multiplyByUniformScale=function(e,t,i){return zn.x=t,zn.y=t,zn.z=t,Rn.multiplyByScale(e,zn,i)},Rn.multiplyByScale=function(e,t,i){var n=t.x,r=t.y,a=t.z;return 1===n&&1===r&&1===a?Rn.clone(e,i):(i[0]=n*e[0],i[1]=n*e[1],i[2]=n*e[2],i[3]=0,i[4]=r*e[4],i[5]=r*e[5],i[6]=r*e[6],i[7]=0,i[8]=a*e[8],i[9]=a*e[9],i[10]=a*e[10],i[11]=0,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=1,i)},Rn.multiplyByVector=function(e,t,i){var n=t.x,r=t.y,a=t.z,o=t.w,s=e[0]*n+e[4]*r+e[8]*a+e[12]*o,u=e[1]*n+e[5]*r+e[9]*a+e[13]*o,l=e[2]*n+e[6]*r+e[10]*a+e[14]*o,c=e[3]*n+e[7]*r+e[11]*a+e[15]*o;return i.x=s,i.y=u,i.z=l,i.w=c,i},Rn.multiplyByPointAsVector=function(e,t,i){var n=t.x,r=t.y,a=t.z,o=e[0]*n+e[4]*r+e[8]*a,s=e[1]*n+e[5]*r+e[9]*a,u=e[2]*n+e[6]*r+e[10]*a;return i.x=o,i.y=s,i.z=u,i},Rn.multiplyByPoint=function(e,t,i){var n=t.x,r=t.y,a=t.z,o=e[0]*n+e[4]*r+e[8]*a+e[12],s=e[1]*n+e[5]*r+e[9]*a+e[13],u=e[2]*n+e[6]*r+e[10]*a+e[14];return i.x=o,i.y=s,i.z=u,i},Rn.multiplyByScalar=function(e,t,i){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12]*t,i[13]=e[13]*t,i[14]=e[14]*t,i[15]=e[15]*t,i},Rn.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},Rn.transpose=function(e,t){var i=e[1],n=e[2],r=e[3],a=e[6],o=e[7],s=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[10]=e[10],t[11]=e[14],t[12]=r,t[13]=o,t[14]=s,t[15]=e[15],t},Rn.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t[4]=Math.abs(e[4]),t[5]=Math.abs(e[5]),t[6]=Math.abs(e[6]),t[7]=Math.abs(e[7]),t[8]=Math.abs(e[8]),t[9]=Math.abs(e[9]),t[10]=Math.abs(e[10]),t[11]=Math.abs(e[11]),t[12]=Math.abs(e[12]),t[13]=Math.abs(e[13]),t[14]=Math.abs(e[14]),t[15]=Math.abs(e[15]),t},Rn.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]},Rn.equalsEpsilon=function(e,t,i){return e===t||oe(e)&&oe(t)&&Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i&&Math.abs(e[4]-t[4])<=i&&Math.abs(e[5]-t[5])<=i&&Math.abs(e[6]-t[6])<=i&&Math.abs(e[7]-t[7])<=i&&Math.abs(e[8]-t[8])<=i&&Math.abs(e[9]-t[9])<=i&&Math.abs(e[10]-t[10])<=i&&Math.abs(e[11]-t[11])<=i&&Math.abs(e[12]-t[12])<=i&&Math.abs(e[13]-t[13])<=i&&Math.abs(e[14]-t[14])<=i&&Math.abs(e[15]-t[15])<=i},Rn.getTranslation=function(e,t){return t.x=e[12],t.y=e[13],t.z=e[14],t},Rn.getMatrix3=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t};var Fn=new pi,Vn=new pi,Un=new An,Gn=new An(0,0,0,1);function kn(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._dynamic=Cesium.defaultValue(e.dynamic,!1),this._cylinderLength=Cesium.defaultValue(e.cylinderLength,1e3),this._topRadius=Cesium.defaultValue(e.topRadius,34),this._bottomRadius=Cesium.defaultValue(e.bottomRadius,.001),this._updateGeometryMesh=!0,this.instances=[],this.boundingSphere=new Cesium.BoundingSphere(new Cesium.Cartesian3,1e4),this.cylinderGeometry=void 0,this.geometryBuffer=void 0,this._renderState={blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:Cesium.defaultValue(e.depthTestState,!0),func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1},this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache(this._renderState)})}Rn.inverse=function(e,t){var i=e[0],n=e[4],r=e[8],a=e[12],o=e[1],s=e[5],u=e[9],l=e[13],c=e[2],m=e[6],d=e[10],h=e[14],f=e[3],p=e[7],_=e[11],C=e[15],g=d*C,v=h*_,y=m*C,T=h*p,x=m*_,w=d*p,A=c*C,E=h*f,S=c*_,b=d*f,M=c*p,R=m*f,D=g*s+T*u+x*l-(v*s+y*u+w*l),P=v*o+A*u+b*l-(g*o+E*u+S*l),I=y*o+E*s+M*l-(T*o+A*s+R*l),O=w*o+S*s+R*u-(x*o+b*s+M*u),L=v*n+y*r+w*a-(g*n+T*r+x*a),N=g*i+E*r+S*a-(v*i+A*r+b*a),B=T*i+A*n+R*a-(y*i+E*n+M*a),z=x*i+b*n+M*r-(w*i+S*n+R*r),F=(g=r*l)*p+(T=a*s)*_+(x=n*u)*C-((v=a*u)*p+(y=n*l)*_+(w=r*s)*C),V=v*f+(A=i*l)*_+(b=r*o)*C-(g*f+(E=a*o)*_+(S=i*u)*C),U=y*f+E*p+(M=i*s)*C-(T*f+A*p+(R=n*o)*C),G=w*f+S*p+R*_-(x*f+b*p+M*_),k=y*d+w*h+v*m-(x*h+g*m+T*d),H=S*h+g*c+E*d-(A*d+b*h+v*c),W=A*m+R*h+T*c-(M*h+y*c+E*m),q=M*d+x*c+b*m-(S*m+R*d+w*c),j=i*D+n*P+r*I+a*O;if(Math.abs(j)<ri.EPSILON21){if(pi.equalsEpsilon(Rn.getMatrix3(e,Fn),Vn,ri.EPSILON7)&&An.equals(Rn.getRow(e,3,Un),Gn))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new ue("matrix is not invertible because its determinate is zero.")}return j=1/j,t[0]=D*j,t[1]=P*j,t[2]=I*j,t[3]=O*j,t[4]=L*j,t[5]=N*j,t[6]=B*j,t[7]=z*j,t[8]=F*j,t[9]=V*j,t[10]=U*j,t[11]=G*j,t[12]=k*j,t[13]=H*j,t[14]=W*j,t[15]=q*j,t},Rn.inverseTransformation=function(e,t){var i=e[0],n=e[1],r=e[2],a=e[4],o=e[5],s=e[6],u=e[8],l=e[9],c=e[10],m=e[12],d=e[13],h=e[14],f=-i*m-n*d-r*h,p=-a*m-o*d-s*h,_=-u*m-l*d-c*h;return t[0]=i,t[1]=a,t[2]=u,t[3]=0,t[4]=n,t[5]=o,t[6]=l,t[7]=0,t[8]=r,t[9]=s,t[10]=c,t[11]=0,t[12]=f,t[13]=p,t[14]=_,t[15]=1,t},Rn.IDENTITY=Object.freeze(new Rn(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),Rn.ZERO=Object.freeze(new Rn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),Rn.COLUMN0ROW0=0,Rn.COLUMN0ROW1=1,Rn.COLUMN0ROW2=2,Rn.COLUMN0ROW3=3,Rn.COLUMN1ROW0=4,Rn.COLUMN1ROW1=5,Rn.COLUMN1ROW2=6,Rn.COLUMN1ROW3=7,Rn.COLUMN2ROW0=8,Rn.COLUMN2ROW1=9,Rn.COLUMN2ROW2=10,Rn.COLUMN2ROW3=11,Rn.COLUMN3ROW0=12,Rn.COLUMN3ROW1=13,Rn.COLUMN3ROW2=14,Rn.COLUMN3ROW3=15,Object.defineProperties(Rn.prototype,{length:{get:function(){return Rn.packedLength}}}),Rn.prototype.clone=function(e){return Rn.clone(this,e)},Rn.prototype.equals=function(e){return Rn.equals(this,e)},Rn.equalsArray=function(e,t,i){return e[0]===t[i]&&e[1]===t[i+1]&&e[2]===t[i+2]&&e[3]===t[i+3]&&e[4]===t[i+4]&&e[5]===t[i+5]&&e[6]===t[i+6]&&e[7]===t[i+7]&&e[8]===t[i+8]&&e[9]===t[i+9]&&e[10]===t[i+10]&&e[11]===t[i+11]&&e[12]===t[i+12]&&e[13]===t[i+13]&&e[14]===t[i+14]&&e[15]===t[i+15]},Rn.prototype.equalsEpsilon=function(e,t){return Rn.equalsEpsilon(this,e,t)},Rn.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"},Object.defineProperties(kn.prototype,{cylinderLength:{get:function(){return this._cylinderLength},set:function(e){this._updateGeometryMesh=this._cylinderLength!=e,this._cylinderLength=e}},topRadius:{get:function(){return this._topRadius},set:function(e){this._updateGeometryMesh=this._topRadius!=e,this._topRadius=e}},bottomRadius:{get:function(){return this._bottomRadius},set:function(e){this._updateGeometryMesh=this._bottomRadius!=e,this._bottomRadius=e}}}),kn.prototype.recreateVertexArrays=function(e,t){this.instances=e||[],this.instances.length<1||(this.blUpdateVAO=!0)},kn.prototype.update=function(e){var t,i,n,r,a,o,s,u,l,c,m=e.context,d=this._command;this.blUpdateVAO&&(Cesium.defined(d.shaderProgram)||(d.shaderProgram=Cesium.ShaderProgram.fromCache({context:m,vertexShaderSource:"precision highp float;\nattribute vec3 position;\nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nattribute vec4 color; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = color; \n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_modelViewProjection * czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"})),Cesium.defined(d.vertexArray)&&!d.vertexArray.isDestroyed()&&d.vertexArray.destroy(),this._updateGeometryMesh&&(this.cylinderGeometry=new Cesium.CylinderGeometry({length:this._cylinderLength,topRadius:this._topRadius,bottomRadius:this._bottomRadius,showTop:!1}),function(e){Cesium.defined(e.geometryBuffer)&&(delete e.geometryBuffer.indices,delete e.geometryBuffer.attributes.normal.values,delete e.geometryBuffer.attributes.position.values,delete e.geometryBuffer.attributes.st.values);e.geometryBuffer=void 0,e.geometryBuffer=Cesium.CylinderGeometry.createGeometry(e.cylinderGeometry)}(this),this._updateGeometryMesh=!1),this.blUpdateVAO&&0<this.instances.length&&(d.vertexArray=(t=m,n=function(e){var t=e.instances,i=t.length,n=e._vertexBufferTypedArray;Cesium.defined(n)||(n=new Float32Array(16*i));e._dynamic&&(e._vertexBufferTypedArray=n);for(var r=[],a=0;a<i;++a){var o=t[a].modelMatrix;r.push(new Cesium.Cartesian3(o[12],o[13],o[14]))}e.boundingSphere=Cesium.BoundingSphere.fromPoints(r);for(a=0;a<i;++a){var o=t[a].modelMatrix,s=t[a].color,u=Cesium.Matrix4.clone(o,Hn);u[12]=u[12]-e.boundingSphere.center.x,u[13]=u[13]-e.boundingSphere.center.y,u[14]=u[14]-e.boundingSphere.center.z;var l=16*a;n[0+l]=u[0],n[1+l]=u[4],n[2+l]=u[8],n[3+l]=u[12],n[4+l]=u[1],n[5+l]=u[5],n[6+l]=u[9],n[7+l]=u[13],n[8+l]=u[2],n[9+l]=u[6],n[10+l]=u[10],n[11+l]=u[14],n[12+l]=s.red,n[13+l]=s.green,n[14+l]=s.blue,n[15+l]=s.alpha}return n}(i=this),r=Cesium.Buffer.createVertexBuffer({context:t,typedArray:n,usage:i._dynamic?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW}),a=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),o={czm_modelMatrixRow0:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:16*a,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*a,strideInBytes:16*a,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*a,strideInBytes:16*a,instanceDivisor:1},czm_modelColor:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*a,strideInBytes:16*a,instanceDivisor:1}},s=0,u=[],l=i.geometryBuffer.attributes.position,c=i.geometryBuffer.indices,u.push({index:s++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(l.values.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),o.czm_modelMatrixRow0.index=s++,u.push(o.czm_modelMatrixRow0),o.czm_modelMatrixRow1.index=s++,u.push(o.czm_modelMatrixRow1),o.czm_modelMatrixRow2.index=s++,u.push(o.czm_modelMatrixRow2),o.czm_modelColor.index=s++,u.push(o.czm_modelColor),new Cesium.VertexArray({context:t,attributes:u,indexBuffer:Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(c.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})),d.instanceCount=this.instances.length,d.cull=!0,this.boundingSphere.radius=this.boundingSphere.radius<1e4?6378137:this.boundingSphere.radius,d.boundingVolume=this.boundingSphere,d.modelMatrix=Cesium.Matrix4.fromTranslation(d.boundingVolume.center)),Cesium.defined(d.vertexArray)&&e.commandList.push(d),this.blUpdateVAO=!1)},kn.prototype.isDestroyed=function(){return!1},kn.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.defined(this.geometryBuffer)&&(delete this.geometryBuffer.indices,delete this.geometryBuffer.attributes.normal.values,delete this.geometryBuffer.attributes.position.values,delete this.geometryBuffer.attributes.st.values),Cesium.destroyObject(this)};var Hn=new Rn;function Wn(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.blUpdateVAO=!1,this.transformFunc=Cesium.Transforms.localFrameToFixedFrameGenerator("north","west"),this._startYaw=Cesium.defaultValue(e.startYaw,-30),this._yawSpan=Cesium.defaultValue(e.yawSpan,60),this._startPitch=Cesium.defaultValue(e.startPitch,-20),this._pitchSpan=Cesium.defaultValue(e.pitchSpan,40),this._radius=Cesium.defaultValue(e.radius,30),this.color=Cesium.defaultValue(e.color,new Cesium.Color(99/255,164/255,164/255,.6)),this._center=new Cesium.Cartesian3,this.instances=[],this._dynamic=Cesium.defaultValue(e.dynamic,!1),this._updateGeometryMesh=!1,this.geometryMesh=Yn(this),this.boundingSphere=new Cesium.BoundingSphere(new Cesium.Cartesian3,1e4),this._renderState={blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:Cesium.defaultValue(e.depthTestState,!0),func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1},this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache(this._renderState)})}Object.defineProperties(Wn.prototype,{startYaw:{get:function(){return this._startYaw},set:function(e){this._updateGeometryMesh=this._startYaw!=e,this._startYaw=e}},yawSpan:{get:function(){return this._yawSpan},set:function(e){this._updateGeometryMesh=this._yawSpan!=e,this._yawSpan=e}},startPitch:{get:function(){return this._startPitch},set:function(e){this._updateGeometryMesh=this._startPitch!=e,this._startPitch=e}},pitchSpan:{get:function(){return this._pitchSpan},set:function(e){this._updateGeometryMesh=this._pitchSpan!=e,this._pitchSpan=e}},radius:{get:function(){return this._radius},set:function(e){this._updateGeometryMesh=this._radius!=e,this._radius=e}}}),Wn.prototype.resetRadarInstances=function(e){this.instances=e,this.blUpdateVAO=!0};var qn=new Rn;Wn.prototype.resetRadarByPositionProperty=function(e){this.instances=[];for(var t=0;t<e.length;t++){var i=e[t].position,n=this.transformFunc(i,void 0,qn),r=Cesium.Quaternion.fromHeadingPitchRoll(e[t].headingPitchRoll,new Cesium.Quaternion),a=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),r,e[t].scale),n=Cesium.Matrix4.multiply(n,a,new Cesium.Matrix4);Cesium.defined(n)&&this.instances.push({modelMatrix:n,color:e[t].color})}this.blUpdateVAO=!0},Wn.prototype.update=function(e){var t,i,n,r,a,o,s,u,l,c=e.context,m=this._command;Cesium.defined(this.geometryMesh)&&(Cesium.defined(m.shaderProgram)||(m.shaderProgram=Cesium.ShaderProgram.fromCache({context:c,vertexShaderSource:"precision highp float;\nattribute vec3 position;\nattribute float surfaceTag; \nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nattribute vec4 color; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = color; \n    if(surfaceTag<0.5){ \n    v_colour.a = 0.0; \n     } \n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_modelViewProjection * czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"})),Cesium.defined(m.vertexArray)&&!m.vertexArray.isDestroyed()&&m.vertexArray.destroy(),this._updateGeometryMesh&&(Cesium.defined(this.geometryMesh)&&(Cesium.defined(this.geometryMesh.position)&&delete this.geometryMesh.position,Cesium.defined(this.geometryMesh.surfaceTag)&&delete this.geometryMesh.surfaceTag,Cesium.defined(this.geometryMesh.indices)&&delete this.geometryMesh.indices),this.geometryMesh=Yn(this),this._updateGeometryMesh=!1),this.blUpdateVAO&&0<this.instances.length&&(m.vertexArray=(t=c,n=function(e){var t=e.instances,i=t.length,n=e._center,r=e._vertexBufferTypedArray;Cesium.defined(r)||(r=new Float32Array(16*i));e._dynamic&&(e._vertexBufferTypedArray=r);for(var a=[],o=0;o<i;++o){var s=t[o].modelMatrix;a.push(new Cesium.Cartesian3(s[12],s[13],s[14]))}e.boundingSphere=Cesium.BoundingSphere.fromPoints(a);for(o=0;o<i;++o){var s=t[o].modelMatrix,u=t[o].color,l=Cesium.Matrix4.clone(s,jn);l[12]=l[12]-e.boundingSphere.center.x-n.x,l[13]=l[13]-e.boundingSphere.center.y-n.y,l[14]=l[14]-e.boundingSphere.center.z-n.z;var c=16*o;r[0+c]=l[0],r[1+c]=l[4],r[2+c]=l[8],r[3+c]=l[12],r[4+c]=l[1],r[5+c]=l[5],r[6+c]=l[9],r[7+c]=l[13],r[8+c]=l[2],r[9+c]=l[6],r[10+c]=l[10],r[11+c]=l[14],r[12+c]=u.red,r[13+c]=u.green,r[14+c]=u.blue,r[15+c]=u.alpha}return r}(i=this),r=Cesium.Buffer.createVertexBuffer({context:t,typedArray:n,usage:i._dynamic?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW}),a=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),o={czm_modelMatrixRow0:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:16*a,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*a,strideInBytes:16*a,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*a,strideInBytes:16*a,instanceDivisor:1},czm_modelColor:{index:0,vertexBuffer:r,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*a,strideInBytes:16*a,instanceDivisor:1}},s=i.geometryMesh,u=0,(l=[]).push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(s.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),l.push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(s.surfaceTag.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:1,normalize:!1}),o.czm_modelMatrixRow0.index=u++,l.push(o.czm_modelMatrixRow0),o.czm_modelMatrixRow1.index=u++,l.push(o.czm_modelMatrixRow1),o.czm_modelMatrixRow2.index=u++,l.push(o.czm_modelMatrixRow2),o.czm_modelColor.index=u++,l.push(o.czm_modelColor),new Cesium.VertexArray({context:t,attributes:l,indexBuffer:Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(s.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})),m.instanceCount=this.instances.length,m.cull=!0,this.boundingSphere.radius=this.boundingSphere.radius<1e4?6378137:this.boundingSphere.radius,m.boundingVolume=this.boundingSphere,m.modelMatrix=Cesium.Matrix4.fromTranslation(m.boundingVolume.center)),Cesium.defined(m.vertexArray)&&e.commandList.push(m),this.blUpdateVAO=!1)};var jn=new Rn;function Yn(e){e.color;var t=e.radius,i=e.startYaw,n=e.yawSpan/5+1,r=e.startPitch,a=e.pitchSpan/5+1,o=n*a;o++;var s=2*(n-1)+2*(a-1)+(n-1)*(a-1)*2;s*=3;for(var u=Cesium.IndexDatatype.createTypedArray(o,s),l=new Float64Array(3*o),c=new Float64Array(o),m=0,d=0,h=0;h<n;h++)for(var f=-(f=i+5*h),p=0;p<a;p++){var _=-(_=r+5*p),C=t*Math.sin(_*Math.PI/180),g=t*Math.cos(_*Math.PI/180),v=g*Math.cos(f*Math.PI/180),y=g*Math.sin(f*Math.PI/180);l[m++]=15+v,l[m++]=y,l[m++]=C,c[d++]=1}l[m++]=15,l[m++]=0,l[m++]=0;for(var T=c[d++]=0,h=0;h<n-1;h++)for(p=0;p<a-1;p++)u[T++]=h*a+p,u[T++]=(h+1)*a+p,u[T++]=(h+1)*a+p+1,u[T++]=h*a+p,u[T++]=(h+1)*a+p+1,u[T++]=h*a+p+1;for(h=0;h<n-1;h++)u[T++]=h*a,u[T++]=o-1,u[T++]=(h+1)*a,u[T++]=(h+1)*a+(a-1),u[T++]=h*a+(a-1),u[T++]=o-1;for(p=0;p<a-1;p++)u[T++]=p,u[T++]=p+1,u[T++]=o-1,u[T++]=(n-1)*a+p,u[T++]=o-1,u[T++]=(n-1)*a+p+1;return{position:l,surfaceTag:c,indices:u}}Wn.prototype.isDestroyed=function(){return!1},Wn.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.defined(this.geometryMesh)&&(Cesium.defined(this.geometryMesh.position)&&delete this.geometryMesh.position,Cesium.defined(this.geometryMesh.surfaceTag)&&delete this.geometryMesh.surfaceTag,Cesium.defined(this.geometryMesh.indices)&&delete this.geometryMesh.indices),Cesium.destroyObject(this)};function Xn(){this.high=si.clone(si.ZERO),this.low=si.clone(si.ZERO)}Xn.encode=function(e,t){var i;return oe(t)||(t={high:0,low:0}),0<=e?(i=65536*Math.floor(e/65536),t.high=i,t.low=e-i):(i=65536*Math.floor(-e/65536),t.high=-i,t.low=e+i),t};var Kn={high:0,low:0};Xn.fromCartesian=function(e,t){oe(t)||(t=new Xn);var i=t.high,n=t.low;return Xn.encode(e.x,Kn),i.x=Kn.high,n.x=Kn.low,Xn.encode(e.y,Kn),i.y=Kn.high,n.y=Kn.low,Xn.encode(e.z,Kn),i.z=Kn.high,n.z=Kn.low,t};var Zn=new Xn;function Jn(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.scene=e.scene,this.geometry=void 0,this.blUpdateVAO=!1,this.boundingSphere=void 0,this.pullWireMesh=void 0,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDistanceDisplayCondition=!1,this._renderState={blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:Cesium.defaultValue(e.depthTestState,!1),func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1},this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache(this._renderState)})}Xn.writeElements=function(e,t,i){Xn.fromCartesian(e,Zn);var n=Zn.high,r=Zn.low;t[i]=n.x,t[i+1]=n.y,t[i+2]=n.z,t[i+3]=r.x,t[i+4]=r.y,t[i+5]=r.z},Object.defineProperties(Jn.prototype,{depthTestState:{get:function(){return this._renderState.depthTest.enabled},set:function(e){this._renderState.depthTest.enabled=e,this._command&&(this._command.renderState=Cesium.RenderState.fromCache(this._renderState))}}});var Qn=new Xn;function $n(e,t){return oe(e.extensionsUsed)&&0<=e.extensionsUsed.indexOf(t)}function er(){}function tr(e){return er.shader(e,function(e){ir(e)}),er.buffer(e,function(e){ir(e)}),er.image(e,function(e){ir(e),er.compressedImage(e,function(e){ir(e)})}),ir(e),e}function ir(e){e.extras=oe(e.extras)?e.extras:{},e.extras._pipeline=oe(e.extras._pipeline)?e.extras._pipeline:{}}function nr(e,t){var i,n,r,a,o,s=e.extensionsUsed;oe(s)&&(0<=(i=s.indexOf(t))&&s.splice(i,1),r=t,oe(o=(n=e).extensionsRequired)&&(0<=(a=o.indexOf(r))&&o.splice(a,1),0===o.length&&delete n.extensionsRequired),0===s.length&&delete e.extensionsUsed)}function rr(e,t,i){return t=z(t,0),i=z(i,e.byteLength-t),e=e.subarray(t,t+i),rr.decode(e)}function ar(e,t,i){return t<=e&&e<=i}Jn.prototype.resizeLabelInfos=function(e){var t=e.length,i=0,n=Number.MAX_VALUE;if(this.pullWireMesh=void 0,e instanceof Array&&0<t){for(var r=2*t,a=2*t,o=Cesium.IndexDatatype.createTypedArray(r,a),s=0;s<a;s++)o[s]=s;for(var u=new Cesium.BoundingSphere(e[0].position,200),l=new Float64Array(3*r),c=new Float64Array(3*r),m=new Float64Array(2*r),d=new Float32Array(2*r),h=new Float32Array(3*r),f=new Float32Array(3*r),p=new Uint8Array(4*r),_=0;_<e.length;_++){var C=e[_].distanceDisplayCondition;Cesium.defined(C)&&(i=C.near,n=C.far,i*=i,n*=n,this._shaderDistanceDisplayCondition=!0);var g=e[_].position,v=e[_].imageSize,y=e[_].pixelOffset,T=e[_].origin,x=e[_].scale,u=Cesium.BoundingSphere.expand(u,g);Cesium.EncodedCartesian3.fromCartesian(g,Qn);var w=Qn.high,A=Qn.low;l[6*_]=w.x,l[6*_+1]=w.y,l[6*_+2]=w.z,l[6*_+3]=w.x,l[6*_+4]=w.y,l[6*_+5]=w.z,c[6*_]=A.x,c[6*_+1]=A.y,c[6*_+2]=A.z,c[6*_+3]=A.x,c[6*_+4]=A.y,c[6*_+5]=A.z,m[4*_]=i,m[4*_+1]=n,m[4*_+2]=i,m[4*_+3]=n,d[4*_]=0,d[4*_+1]=0,d[4*_+2]=1,d[4*_+3]=x,h[6*_]=0,h[6*_+1]=0,h[6*_+2]=0,h[6*_+3]=y.x,h[6*_+4]=y.y,h[6*_+5]=v.x,f[6*_]=0,f[6*_+1]=0,f[6*_+2]=0,f[6*_+3]=T.x,f[6*_+4]=T.y,f[6*_+5]=v.y,p[8*_]=Cesium.Color.floatToByte(e[_].color.red),p[8*_+1]=Cesium.Color.floatToByte(e[_].color.green),p[8*_+2]=Cesium.Color.floatToByte(e[_].color.blue),p[8*_+3]=Cesium.Color.floatToByte(e[_].color.alpha),p[8*_+4]=Cesium.Color.floatToByte(e[_].color.red),p[8*_+5]=Cesium.Color.floatToByte(e[_].color.green),p[8*_+6]=Cesium.Color.floatToByte(e[_].color.blue),p[8*_+7]=Cesium.Color.floatToByte(e[_].color.alpha)}this.pullWireMesh={position3DHigh:l,position3DLow:c,disCondition:m,st:d,tangent:h,bitangent:f,color:p,indices:o},this.boundingSphere=u.clone(),this.blUpdateVAO=!0}},Jn.prototype.update=function(e){var t,i,n=e.context,r=this._command;Cesium.defined(r.vertexArray)&&!r.vertexArray.isDestroyed()&&r.vertexArray.destroy(),this.blUpdateVAO&&this.pullWireMesh&&(t=0,(i=[]).push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.pullWireMesh.position3DHigh),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.pullWireMesh.position3DLow),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.pullWireMesh.st),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.pullWireMesh.tangent),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.pullWireMesh.bitangent),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.UNSIGNED_BYTE,this.pullWireMesh.color),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.pullWireMesh.disCondition),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1}),r.vertexArray=new Cesium.VertexArray({context:n,attributes:i,indexBuffer:Cesium.Buffer.createIndexBuffer({context:n,typedArray:this.pullWireMesh.indices,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})}),r._boundingVolume=this.boundingSphere,Cesium.defined(r.shaderProgram)||(r.shaderProgram=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 uv;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec4 color;\nattribute vec2 disCondition;\nvarying vec4  v_colour;\nvec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)\n{\nvec2 halfSize = imageSize * scale * 0.5;\nhalfSize *= ((direction * 2.0) - 1.0);\nvec2 originTranslate = origin * abs(halfSize);\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nif (validAlignedAxis || rotation != 0.0)\n{\nfloat angle = rotation;\nif (validAlignedAxis)\n{\nvec4 projectedAlignedAxis = czm_modelViewProjection * vec4(alignedAxis, 0.0);\nangle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /\n(projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));\n}\nfloat cosTheta = cos(angle);\nfloat sinTheta = sin(angle);\nrotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);\nhalfSize = rotationMatrix * halfSize;\n}\nelse\n{\nrotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n}\n#endif\nmpp = czm_metersPerPixel(positionEC);\npositionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);\npositionEC.xy += (translate + pixelOffset) * mpp;\nreturn positionEC;\n}\nvoid main(){\nvec4 p = czm_translateRelativeToEye(position3DHigh, position3DLow);\nvec4 positionEC = czm_modelViewRelativeToEye * p;\nif(uv.x > 0.5){\nfloat scale = uv.y;\nvec2 pixelOffset = vec2(tangent.x, -tangent.y);\nvec2 imageSize = vec2(tangent.z, bitangent.z);\nvec2 origin = vec2(bitangent.x, bitangent.y);\nvec2 direction = vec2(0.0, 1.0);\nif((pixelOffset.x+ 0.5*imageSize.x) >=0.0 && (pixelOffset.y- 0.5*imageSize.y)>0.0){\npixelOffset = vec2(pixelOffset.x, pixelOffset.y-imageSize.y);\n}else if((pixelOffset.x+ 0.5*imageSize.x) <0.0 && (pixelOffset.y- 0.5*imageSize.y)<0.0){\npixelOffset = vec2(pixelOffset.x+imageSize.x , pixelOffset.y);\n}else if((pixelOffset.x+ 0.5*imageSize.x) <0.0 && (pixelOffset.y- 0.5*imageSize.y)>0.0){\npixelOffset = vec2(pixelOffset.x+imageSize.x , pixelOffset.y-imageSize.y);\n}\nvec2 translate = vec2(0.0, 0.0);\nvec3 alignedAxis = vec3(0.0);\nbool validAlignedAxis = false;\nfloat rotation = 0.0;\nbool sizeInMeters = false;\nmat2 rotationMatrix;\nfloat mpp;\npositionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\n}\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq = dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq = disCondition.x;\nfloat farSq = disCondition.y;\nif (lengthSq < nearSq || lengthSq > farSq)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nv_colour = vec4(color.r, color.g, color.b, color.a);\ngl_Position = czm_projection * positionEC;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth();\n#endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main(){\ngl_FragColor = v_colour;\n}\n"})),this._shaderDistanceDisplayCondition!=this._compiledShaderDistanceDisplayCondition&&(r.shaderProgram.vertexShaderSource.defines.push("DISTANCE_DISPLAY_CONDITION"),this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition)),Cesium.defined(r.vertexArray)&&e.commandList.push(r),this.blUpdateVAO=!1},Jn.prototype.isDestroyed=function(){return!1},Jn.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.destroyObject(this)},er.objectLegacy=function(e,t){if(oe(e))for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=t(e[i],i);if(oe(n))return n}},er.object=function(e,t){if(oe(e))for(var i=e.length,n=0;n<i;n++){var r=t(e[n],n);if(oe(r))return r}},er.topLevel=function(e,t,i){var n=e[t];return oe(n)&&!Array.isArray(n)?er.objectLegacy(n,i):er.object(n,i)},er.accessor=function(e,t){return er.topLevel(e,"accessors",t)},er.accessorWithSemantic=function(e,n,r){var a={};return er.mesh(e,function(e){return er.meshPrimitive(e,function(e){var t=er.meshPrimitiveAttribute(e,function(e,t){if(0===t.indexOf(n)&&!oe(a[e])){a[e]=!0;var i=r(e);if(oe(i))return i}});return oe(t)?t:er.meshPrimitiveTarget(e,function(e){return er.meshPrimitiveTargetAttribute(e,function(e,t){if(0===t.indexOf(n)&&!oe(a[e])){a[e]=!0;var i=r(e);if(oe(i))return i}})})})})},er.accessorContainingVertexAttributeData=function(e,i){var n={};return er.mesh(e,function(e){return er.meshPrimitive(e,function(e){var t=er.meshPrimitiveAttribute(e,function(e){if(!oe(n[e])){n[e]=!0;var t=i(e);if(oe(t))return t}});return oe(t)?t:er.meshPrimitiveTarget(e,function(e){return er.meshPrimitiveTargetAttribute(e,function(e){if(!oe(n[e])){n[e]=!0;var t=i(e);if(oe(t))return t}})})})})},er.accessorContainingIndexData=function(e,n){var r={};return er.mesh(e,function(e){return er.meshPrimitive(e,function(e){var t=e.indices;if(oe(t)&&!oe(r[t])){r[t]=!0;var i=n(t);if(oe(i))return i}})})},er.animation=function(e,t){return er.topLevel(e,"animations",t)},er.animationChannel=function(e,t){var i=e.channels;return er.object(i,t)},er.animationSampler=function(e,t){var i=e.samplers;return er.object(i,t)},er.buffer=function(e,t){return er.topLevel(e,"buffers",t)},er.bufferView=function(e,t){return er.topLevel(e,"bufferViews",t)},er.camera=function(e,t){return er.topLevel(e,"cameras",t)},er.image=function(e,t){return er.topLevel(e,"images",t)},er.compressedImage=function(e,t){if(oe(e.extras)){var i=e.extras.compressedImage3DTiles;for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=t(i[n],n);if(oe(r))return r}}},er.material=function(e,t){return er.topLevel(e,"materials",t)},er.materialValue=function(e,t){var i=e.values;for(var n in oe(e.extensions)&&oe(e.extensions.KHR_techniques_webgl)&&(i=e.extensions.KHR_techniques_webgl.values),i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=t(i[n],n);if(oe(r))return r}},er.mesh=function(e,t){return er.topLevel(e,"meshes",t)},er.meshPrimitive=function(e,t){var i=e.primitives;if(oe(i))for(var n=i.length,r=0;r<n;r++){var a=t(i[r],r);if(oe(a))return a}},er.meshPrimitiveAttribute=function(e,t){var i=e.attributes;for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=t(i[n],n);if(oe(r))return r}},er.meshPrimitiveTarget=function(e,t){var i=e.targets;if(oe(i))for(var n=i.length,r=0;r<n;++r){var a=t(i[r],r);if(oe(a))return a}},er.meshPrimitiveTargetAttribute=function(e,t){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=t(e[i],i);if(oe(n))return n}},er.node=function(e,t){return er.topLevel(e,"nodes",t)},er.nodeInTree=function(e,t,i){var n=e.nodes;if(oe(n))for(var r=t.length,a=0;a<r;a++){var o=t[a],s=n[o];if(oe(s)){var u=i(s,o);if(oe(u))return u;var l=s.children;if(oe(l)&&oe(u=er.nodeInTree(e,l,i)))return u}}},er.nodeInScene=function(e,t,i){var n=t.nodes;if(oe(n))return er.nodeInTree(e,n,i)},er.program=function(e,t){return $n(e,"KHR_techniques_webgl")?er.object(e.extensions.KHR_techniques_webgl.programs,t):er.topLevel(e,"programs",t)},er.sampler=function(e,t){return er.topLevel(e,"samplers",t)},er.scene=function(e,t){return er.topLevel(e,"scenes",t)},er.shader=function(e,t){return $n(e,"KHR_techniques_webgl")?er.object(e.extensions.KHR_techniques_webgl.shaders,t):er.topLevel(e,"shaders",t)},er.skin=function(e,t){return er.topLevel(e,"skins",t)},er.skinJoint=function(e,t){var i=e.joints;if(oe(i))for(var n=i.length,r=0;r<n;r++){var a=t(i[r]);if(oe(a))return a}},er.techniqueAttribute=function(e,t){var i=e.attributes;for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=t(i[n],n);if(oe(r))return r}},er.techniqueUniform=function(e,t){var i=e.uniforms;for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=t(i[n],n);if(oe(r))return r}},er.techniqueParameter=function(e,t){var i=e.parameters;for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=t(i[n],n);if(oe(r))return r}},er.technique=function(e,t){return $n(e,"KHR_techniques_webgl")?er.object(e.extensions.KHR_techniques_webgl.techniques,t):er.topLevel(e,"techniques",t)},er.texture=function(e,t){return er.topLevel(e,"textures",t)},rr.decodeWithTextDecoder=function(e){return new TextDecoder("utf-8").decode(e)},rr.decodeWithFromCharCode=function(e){for(var t="",i=function(e){for(var t=0,i=0,n=0,r=128,a=191,o=[],s=e.length,u=0;u<s;++u){var l=e[u];if(0===n){if(ar(l,0,127)){o.push(l);continue}if(ar(l,194,223)){n=1,t=31&l;continue}if(ar(l,224,239)){224===l&&(r=160),237===l&&(a=159),n=2,t=15&l;continue}if(ar(l,240,244)){240===l&&(r=144),244===l&&(a=143),n=3,t=7&l;continue}throw new ue("String decoding failed.")}ar(l,r,a)?(r=128,a=191,t=t<<6|63&l,++i===n&&(o.push(t),t=n=i=0)):(t=n=i=0,r=128,a=191,--u)}return o}(e),n=i.length,r=0;r<n;++r){var a=i[r];a<=65535?t+=String.fromCharCode(a):(a-=65536,t+=String.fromCharCode(55296+(a>>10),56320+(1023&a)))}return t},"undefined"!=typeof TextDecoder?rr.decode=rr.decodeWithTextDecoder:rr.decode=rr.decodeWithFromCharCode;var or=4;function sr(e){var t,i;if("glTF"!==rr(t=e,i=z(i,0),Math.min(4,t.length)))throw new ue("File is not valid binary glTF");var n=ur(e,0,5),r=n[1];if(1!==r&&2!==r)throw new ue("Binary glTF version is not 1 or 2");return(1===r?function(e,t){var i=t[2],n=t[3];if(0!==t[4])throw new ue("Binary glTF scene format is not JSON");var r=20+n,a=rr(e,20,n),o=JSON.parse(a);tr(o);var s=e.subarray(r,i),u=o.buffers;{var l;oe(u)&&0<Object.keys(u).length&&(oe(l=z(u.binary_glTF,u.KHR_binary_glTF))&&(l.extras._pipeline.source=s))}return nr(o,"KHR_binary_glTF"),o}:function(e,t){var i,n,r=t[2],a=12;for(;a<r;){var o=ur(e,a,2),s=o[0],u=o[1];a+=8;var l,c=e.subarray(a,a+s);a+=s,1313821514===u?(l=rr(c),tr(i=JSON.parse(l))):5130562===u&&(n=c)}{var m;oe(i)&&oe(n)&&(oe(m=i.buffers)&&0<m.length&&(m[0].extras._pipeline.source=n))}return i})(e,n)}function ur(e,t,i){for(var n=new DataView(e.buffer),r=new Array(i),a=0;a<i;++a)r[a]=n.getUint32(e.byteOffset+t+a*or,!0);return r}var lr=new si,cr=new si;function mr(e,t,i,n,r){var a=e.x,o=e.y,s=e.z,u=t.x,l=t.y,c=t.z,m=a*a*u*u,d=o*o*l*l,h=s*s*c*c,f=m+d+h,p=Math.sqrt(1/f),_=si.multiplyByScalar(e,p,lr);if(f<n)return isFinite(p)?si.clone(_,r):void 0;var C=i.x,g=i.y,v=i.z,y=cr;y.x=_.x*C*2,y.y=_.y*g*2,y.z=_.z*v*2;var T,x,w,A,E,S,b,M=(1-p)*si.magnitude(e)/(.5*si.magnitude(y)),R=0;do{R=(T=m*(E=(x=1/(1+(M-=R)*C))*x)+d*(S=(w=1/(1+M*g))*w)+h*(b=(A=1/(1+M*v))*A)-1)/(-2*(m*(E*x)*C+d*(S*w)*g+h*(b*A)*v))}while(Math.abs(T)>ri.EPSILON12);return oe(r)?(r.x=a*x,r.y=o*w,r.z=s*A,r):new si(a*x,o*w,s*A)}function dr(e,t,i){this.longitude=z(e,0),this.latitude=z(t,0),this.height=z(i,0)}dr.fromRadians=function(e,t,i,n){return i=z(i,0),oe(n)?(n.longitude=e,n.latitude=t,n.height=i,n):new dr(e,t,i)},dr.fromDegrees=function(e,t,i,n){return e=ri.toRadians(e),t=ri.toRadians(t),dr.fromRadians(e,t,i,n)};var hr=new si,fr=new si,pr=new si;dr.wgs84OneOverRadii=new si(1/6378137,1/6378137,1/6356752.314245179),dr.wgs84OneOverRadiiSquared=new si(1/40680631590769,1/40680631590769,1/40408299984661.445);var _r=ri.EPSILON1;function Cr(e,t,i,n){t=z(t,0),i=z(i,0),n=z(n,0),e._radii=new si(t,i,n),e._radiiSquared=new si(t*t,i*i,n*n),e._radiiToTheFourth=new si(t*t*t*t,i*i*i*i,n*n*n*n),e._oneOverRadii=new si(0===t?0:1/t,0===i?0:1/i,0===n?0:1/n),e._oneOverRadiiSquared=new si(0===t?0:1/(t*t),0===i?0:1/(i*i),0===n?0:1/(n*n)),e._minimumRadius=Math.min(t,i,n),e._maximumRadius=Math.max(t,i,n),e._centerToleranceSquared=ri.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function gr(e,t,i){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,Cr(this,e,t,i)}dr.fromCartesian=function(e,t,i){var n=oe(t)?t.oneOverRadii:this.wgs84OneOverRadii,r=oe(t)?t.oneOverRadiiSquared:this.wgs84OneOverRadiiSquared,a=mr(e,n,r,oe(t)?t._centerToleranceSquared:_r,fr);if(oe(a)){var o=si.multiplyComponents(a,r,hr),o=si.normalize(o,o),s=si.subtract(e,a,pr),u=Math.atan2(o.y,o.x),l=Math.asin(o.z),c=ri.sign(si.dot(s,e))*si.magnitude(s);return oe(i)?(i.longitude=u,i.latitude=l,i.height=c,i):new dr(u,l,c)}},dr.toCartesian=function(e,t,i){return si.fromRadians(e.longitude,e.latitude,e.height,t,i)},dr.clone=function(e,t){if(oe(e))return oe(t)?(t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t):new dr(e.longitude,e.latitude,e.height)},dr.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height},dr.equalsEpsilon=function(e,t,i){return e===t||oe(e)&&oe(t)&&Math.abs(e.longitude-t.longitude)<=i&&Math.abs(e.latitude-t.latitude)<=i&&Math.abs(e.height-t.height)<=i},dr.ZERO=Object.freeze(new dr(0,0,0)),dr.prototype.clone=function(e){return dr.clone(this,e)},dr.prototype.equals=function(e){return dr.equals(this,e)},dr.prototype.equalsEpsilon=function(e,t){return dr.equalsEpsilon(this,e,t)},dr.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"},Object.defineProperties(gr.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),gr.clone=function(e,t){if(oe(e)){var i=e._radii;return oe(t)?(si.clone(i,t._radii),si.clone(e._radiiSquared,t._radiiSquared),si.clone(e._radiiToTheFourth,t._radiiToTheFourth),si.clone(e._oneOverRadii,t._oneOverRadii),si.clone(e._oneOverRadiiSquared,t._oneOverRadiiSquared),t._minimumRadius=e._minimumRadius,t._maximumRadius=e._maximumRadius,t._centerToleranceSquared=e._centerToleranceSquared,t):new gr(i.x,i.y,i.z)}},gr.fromCartesian3=function(e,t){return oe(t)||(t=new gr),oe(e)&&Cr(t,e.x,e.y,e.z),t},gr.WGS84=Object.freeze(new gr(6378137,6378137,6356752.314245179)),gr.CGCS2000=Object.freeze(new gr(6378137,6378137,6356752.314140356)),gr.UNIT_SPHERE=Object.freeze(new gr(1,1,1)),gr.MOON=Object.freeze(new gr(ri.LUNAR_RADIUS,ri.LUNAR_RADIUS,ri.LUNAR_RADIUS)),gr.prototype.clone=function(e){return gr.clone(this,e)},gr.packedLength=si.packedLength,gr.pack=function(e,t,i){return i=z(i,0),si.pack(e._radii,t,i),t},gr.unpack=function(e,t,i){t=z(t,0);var n=si.unpack(e,t);return gr.fromCartesian3(n,i)},gr.prototype.geocentricSurfaceNormal=si.normalize,gr.prototype.geodeticSurfaceNormalCartographic=function(e,t){var i=e.longitude,n=e.latitude,r=Math.cos(n),a=r*Math.cos(i),o=r*Math.sin(i),s=Math.sin(n);return oe(t)||(t=new si),t.x=a,t.y=o,t.z=s,si.normalize(t,t)},gr.prototype.geodeticSurfaceNormal=function(e,t){return oe(t)||(t=new si),t=si.multiplyComponents(e,this._oneOverRadiiSquared,t),si.normalize(t,t)};var vr=new si,yr=new si;gr.prototype.cartographicToCartesian=function(e,t){var i=vr,n=yr;this.geodeticSurfaceNormalCartographic(e,i),si.multiplyComponents(this._radiiSquared,i,n);var r=Math.sqrt(si.dot(i,n));return si.divideByScalar(n,r,n),si.multiplyByScalar(i,e.height,i),oe(t)||(t=new si),si.add(n,i,t)},gr.prototype.cartographicArrayToCartesianArray=function(e,t){var i=e.length;oe(t)?t.length=i:t=new Array(i);for(var n=0;n<i;n++)t[n]=this.cartographicToCartesian(e[n],t[n]);return t};var Tr=new si,xr=new si,wr=new si;function Ar(e){this._ellipsoid=z(e,gr.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}gr.prototype.cartesianToCartographic=function(e,t){var i=this.scaleToGeodeticSurface(e,xr);if(oe(i)){var n=this.geodeticSurfaceNormal(i,Tr),r=si.subtract(e,i,wr),a=Math.atan2(n.y,n.x),o=Math.asin(n.z),s=ri.sign(si.dot(r,e))*si.magnitude(r);return oe(t)?(t.longitude=a,t.latitude=o,t.height=s,t):new dr(a,o,s)}},gr.prototype.cartesianArrayToCartographicArray=function(e,t){var i=e.length;oe(t)?t.length=i:t=new Array(i);for(var n=0;n<i;++n)t[n]=this.cartesianToCartographic(e[n],t[n]);return t},gr.prototype.scaleToGeodeticSurface=function(e,t){return mr(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},gr.prototype.scaleToGeocentricSurface=function(e,t){oe(t)||(t=new si);var i=e.x,n=e.y,r=e.z,a=this._oneOverRadiiSquared,o=1/Math.sqrt(i*i*a.x+n*n*a.y+r*r*a.z);return si.multiplyByScalar(e,o,t)},gr.prototype.transformPositionToScaledSpace=function(e,t){return oe(t)||(t=new si),si.multiplyComponents(e,this._oneOverRadii,t)},gr.prototype.transformPositionFromScaledSpace=function(e,t){return oe(t)||(t=new si),si.multiplyComponents(e,this._radii,t)},gr.prototype.equals=function(e){return this===e||oe(e)&&si.equals(this._radii,e._radii)},gr.prototype.toString=function(){return this._radii.toString()},gr.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,t,i){t=z(t,0);var n=this._squaredXOverSquaredZ;if(oe(i)||(i=new si),i.x=0,i.y=0,i.z=e.z*(1-n),!(Math.abs(i.z)>=this._radii.z-t))return i},Object.defineProperties(Ar.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),Ar.prototype.project=function(e,t){var i=this._semimajorAxis,n=e.longitude*i,r=e.latitude*i,a=e.height;return oe(t)?(t.x=n,t.y=r,t.z=a,t):new si(n,r,a)},Ar.prototype.unproject=function(e,t){var i=this._oneOverSemimajorAxis,n=e.x*i,r=e.y*i,a=e.z;return oe(t)?(t.longitude=n,t.latitude=r,t.height=a,t):new dr(n,r,a)};var Er=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function Sr(e,t){this.start=z(e,0),this.stop=z(t,0)}function br(e,t,i,n){this.west=z(e,0),this.south=z(t,0),this.east=z(i,0),this.north=z(n,0)}Object.defineProperties(br.prototype,{width:{get:function(){return br.computeWidth(this)}},height:{get:function(){return br.computeHeight(this)}}}),br.packedLength=4,br.pack=function(e,t,i){return i=z(i,0),t[i++]=e.west,t[i++]=e.south,t[i++]=e.east,t[i]=e.north,t},br.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new br),i.west=e[t++],i.south=e[t++],i.east=e[t++],i.north=e[t],i},br.computeWidth=function(e){var t=e.east,i=e.west;return t<i&&(t+=ri.TWO_PI),t-i},br.computeHeight=function(e){return e.north-e.south},br.fromDegrees=function(e,t,i,n,r){return e=ri.toRadians(z(e,0)),t=ri.toRadians(z(t,0)),i=ri.toRadians(z(i,0)),n=ri.toRadians(z(n,0)),oe(r)?(r.west=e,r.south=t,r.east=i,r.north=n,r):new br(e,t,i,n)},br.fromRadians=function(e,t,i,n,r){return oe(r)?(r.west=z(e,0),r.south=z(t,0),r.east=z(i,0),r.north=z(n,0),r):new br(e,t,i,n)},br.fromCartographicArray=function(e,t){for(var i=Number.MAX_VALUE,n=-Number.MAX_VALUE,r=Number.MAX_VALUE,a=-Number.MAX_VALUE,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,u=0,l=e.length;u<l;u++)var c=e[u],i=Math.min(i,c.longitude),n=Math.max(n,c.longitude),o=Math.min(o,c.latitude),s=Math.max(s,c.latitude),m=0<=c.longitude?c.longitude:c.longitude+ri.TWO_PI,r=Math.min(r,m),a=Math.max(a,m);return a-r<n-i&&(i=r,(n=a)>ri.PI&&(n-=ri.TWO_PI),i>ri.PI&&(i-=ri.TWO_PI)),oe(t)?(t.west=i,t.south=o,t.east=n,t.north=s,t):new br(i,o,n,s)},br.fromCartesianArray=function(e,t,i){t=z(t,gr.WGS84);for(var n=Number.MAX_VALUE,r=-Number.MAX_VALUE,a=Number.MAX_VALUE,o=-Number.MAX_VALUE,s=Number.MAX_VALUE,u=-Number.MAX_VALUE,l=0,c=e.length;l<c;l++)var m=t.cartesianToCartographic(e[l]),n=Math.min(n,m.longitude),r=Math.max(r,m.longitude),s=Math.min(s,m.latitude),u=Math.max(u,m.latitude),d=0<=m.longitude?m.longitude:m.longitude+ri.TWO_PI,a=Math.min(a,d),o=Math.max(o,d);return o-a<r-n&&(n=a,(r=o)>ri.PI&&(r-=ri.TWO_PI),n>ri.PI&&(n-=ri.TWO_PI)),oe(i)?(i.west=n,i.south=s,i.east=r,i.north=u,i):new br(n,s,r,u)},br.clone=function(e,t){if(oe(e))return oe(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new br(e.west,e.south,e.east,e.north)},br.equalsEpsilon=function(e,t,i){return e===t||oe(e)&&oe(t)&&Math.abs(e.west-t.west)<=i&&Math.abs(e.south-t.south)<=i&&Math.abs(e.east-t.east)<=i&&Math.abs(e.north-t.north)<=i},br.prototype.clone=function(e){return br.clone(this,e)},br.prototype.equals=function(e){return br.equals(this,e)},br.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north},br.prototype.equalsEpsilon=function(e,t){return br.equalsEpsilon(this,e,t)},br.validate=function(e){},br.southwest=function(e,t){return oe(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new dr(e.west,e.south)},br.northwest=function(e,t){return oe(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new dr(e.west,e.north)},br.northeast=function(e,t){return oe(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new dr(e.east,e.north)},br.southeast=function(e,t){return oe(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new dr(e.east,e.south)},br.center=function(e,t){var i=e.east,n=e.west;i<n&&(i+=ri.TWO_PI);var r=ri.negativePiToPi(.5*(n+i)),a=.5*(e.south+e.north);return oe(t)?(t.longitude=r,t.latitude=a,t.height=0,t):new dr(r,a)},br.intersection=function(e,t,i){var n=e.east,r=e.west,a=t.east,o=t.west;n<r&&0<a?n+=ri.TWO_PI:a<o&&0<n&&(a+=ri.TWO_PI),n<r&&o<0?o+=ri.TWO_PI:a<o&&r<0&&(r+=ri.TWO_PI);var s=ri.negativePiToPi(Math.max(r,o)),u=ri.negativePiToPi(Math.min(n,a));if(!((e.west<e.east||t.west<t.east)&&u<=s)){var l=Math.max(e.south,t.south),c=Math.min(e.north,t.north);if(!(c<=l))return oe(i)?(i.west=s,i.south=l,i.east=u,i.north=c,i):new br(s,l,u,c)}},br.simpleIntersection=function(e,t,i){var n=Math.max(e.west,t.west),r=Math.max(e.south,t.south),a=Math.min(e.east,t.east),o=Math.min(e.north,t.north);if(!(o<=r||a<=n))return oe(i)?(i.west=n,i.south=r,i.east=a,i.north=o,i):new br(n,r,a,o)},br.union=function(e,t,i){oe(i)||(i=new br);var n=e.east,r=e.west,a=t.east,o=t.west;n<r&&0<a?n+=ri.TWO_PI:a<o&&0<n&&(a+=ri.TWO_PI),n<r&&o<0?o+=ri.TWO_PI:a<o&&r<0&&(r+=ri.TWO_PI);var s=ri.convertLongitudeRange(Math.min(r,o)),u=ri.convertLongitudeRange(Math.max(n,a));return i.west=s,i.south=Math.min(e.south,t.south),i.east=u,i.north=Math.max(e.north,t.north),i},br.expand=function(e,t,i){return oe(i)||(i=new br),i.west=Math.min(e.west,t.longitude),i.south=Math.min(e.south,t.latitude),i.east=Math.max(e.east,t.longitude),i.north=Math.max(e.north,t.latitude),i},br.contains=function(e,t){var i=t.longitude,n=t.latitude,r=e.west,a=e.east;return a<r&&(a+=ri.TWO_PI,i<0&&(i+=ri.TWO_PI)),(r<i||ri.equalsEpsilon(i,r,ri.EPSILON14))&&(i<a||ri.equalsEpsilon(i,a,ri.EPSILON14))&&n>=e.south&&n<=e.north};var Mr=new dr;function Rr(e,t){this.center=si.clone(z(e,si.ZERO)),this.radius=z(t,0)}br.subsample=function(e,t,i,n){t=z(t,gr.WGS84),i=z(i,0),oe(n)||(n=[]);var r=0,a=e.north,o=e.south,s=e.east,u=e.west,l=Mr;l.height=i,l.longitude=u,l.latitude=a,n[r]=t.cartographicToCartesian(l,n[r]),r++,l.longitude=s,n[r]=t.cartographicToCartesian(l,n[r]),r++,l.latitude=o,n[r]=t.cartographicToCartesian(l,n[r]),r++,l.longitude=u,n[r]=t.cartographicToCartesian(l,n[r]),r++,l.latitude=a<0?a:0<o?o:0;for(var c=1;c<8;++c)l.longitude=-Math.PI+c*ri.PI_OVER_TWO,br.contains(e,l)&&(n[r]=t.cartographicToCartesian(l,n[r]),r++);return 0===l.latitude&&(l.longitude=u,n[r]=t.cartographicToCartesian(l,n[r]),r++,l.longitude=s,n[r]=t.cartographicToCartesian(l,n[r]),r++),n.length=r,n},br.MAX_VALUE=Object.freeze(new br(-Math.PI,-ri.PI_OVER_TWO,Math.PI,ri.PI_OVER_TWO)),br.MERCATOR_MAX_VALUE=Object.freeze(new br(-Math.PI,ri.toRadians(-85),Math.PI,ri.toRadians(85)));var Dr=new si,Pr=new si,Ir=new si,Or=new si,Lr=new si,Nr=new si,Br=new si,zr=new si,Fr=new si,Vr=new si,Ur=new si,Gr=new si,kr=4/3*ri.PI;Rr.fromPoints=function(e,t){if(oe(t)||(t=new Rr),!oe(e)||0===e.length)return t.center=si.clone(si.ZERO,t.center),t.radius=0,t;for(var i=si.clone(e[0],Br),n=si.clone(i,Dr),r=si.clone(i,Pr),a=si.clone(i,Ir),o=si.clone(i,Or),s=si.clone(i,Lr),u=si.clone(i,Nr),l=e.length,c=1;c<l;c++){si.clone(e[c],i);var m=i.x,d=i.y,h=i.z;m<n.x&&si.clone(i,n),m>o.x&&si.clone(i,o),d<r.y&&si.clone(i,r),d>s.y&&si.clone(i,s),h<a.z&&si.clone(i,a),h>u.z&&si.clone(i,u)}var f=si.magnitudeSquared(si.subtract(o,n,zr)),p=si.magnitudeSquared(si.subtract(s,r,zr)),_=si.magnitudeSquared(si.subtract(u,a,zr)),C=n,g=o,v=f;v<p&&(v=p,C=r,g=s),v<_&&(v=_,C=a,g=u);var y=Fr;y.x=.5*(C.x+g.x),y.y=.5*(C.y+g.y),y.z=.5*(C.z+g.z);var T=si.magnitudeSquared(si.subtract(g,y,zr)),x=Math.sqrt(T),w=Vr;w.x=n.x,w.y=r.y,w.z=a.z;var A=Ur;A.x=o.x,A.y=s.y,A.z=u.z;var E=si.midpoint(w,A,Gr),S=0;for(c=0;c<l;c++){si.clone(e[c],i);var b=si.magnitude(si.subtract(i,E,zr));S<b&&(S=b);var M,R,D=si.magnitudeSquared(si.subtract(i,y,zr));T<D&&(T=(x=.5*(x+(M=Math.sqrt(D))))*x,R=M-x,y.x=(x*y.x+R*i.x)/M,y.y=(x*y.y+R*i.y)/M,y.z=(x*y.z+R*i.z)/M)}return x<S?(si.clone(y,t.center),t.radius=x):(si.clone(E,t.center),t.radius=S),t};var Hr=new Ar,Wr=new si,qr=new si,jr=new dr,Yr=new dr;Rr.fromRectangle2D=function(e,t,i){return Rr.fromRectangleWithHeights2D(e,t,0,0,i)},Rr.fromRectangleWithHeights2D=function(e,t,i,n,r){if(oe(r)||(r=new Rr),!oe(e))return r.center=si.clone(si.ZERO,r.center),r.radius=0,r;t=z(t,Hr),br.southwest(e,jr),jr.height=i,br.northeast(e,Yr),Yr.height=n;var a=t.project(jr,Wr),o=t.project(Yr,qr),s=o.x-a.x,u=o.y-a.y,l=o.z-a.z;r.radius=.5*Math.sqrt(s*s+u*u+l*l);var c=r.center;return c.x=a.x+.5*s,c.y=a.y+.5*u,c.z=a.z+.5*l,r};var Xr=[];Rr.fromRectangle3D=function(e,t,i,n){if(t=z(t,gr.WGS84),i=z(i,0),oe(n)||(n=new Rr),!oe(e))return n.center=si.clone(si.ZERO,n.center),n.radius=0,n;var r=br.subsample(e,t,i,Xr);return Rr.fromPoints(r,n)},Rr.fromVertices=function(e,t,i,n){if(oe(n)||(n=new Rr),!oe(e)||0===e.length)return n.center=si.clone(si.ZERO,n.center),n.radius=0,n;t=z(t,si.ZERO),i=z(i,3);var r=Br;r.x=e[0]+t.x,r.y=e[1]+t.y,r.z=e[2]+t.z;for(var a=si.clone(r,Dr),o=si.clone(r,Pr),s=si.clone(r,Ir),u=si.clone(r,Or),l=si.clone(r,Lr),c=si.clone(r,Nr),m=e.length,d=0;d<m;d+=i){var h=e[d]+t.x,f=e[d+1]+t.y,p=e[d+2]+t.z;r.x=h,r.y=f,r.z=p,h<a.x&&si.clone(r,a),h>u.x&&si.clone(r,u),f<o.y&&si.clone(r,o),f>l.y&&si.clone(r,l),p<s.z&&si.clone(r,s),p>c.z&&si.clone(r,c)}var _=si.magnitudeSquared(si.subtract(u,a,zr)),C=si.magnitudeSquared(si.subtract(l,o,zr)),g=si.magnitudeSquared(si.subtract(c,s,zr)),v=a,y=u,T=_;T<C&&(T=C,v=o,y=l),T<g&&(T=g,v=s,y=c);var x=Fr;x.x=.5*(v.x+y.x),x.y=.5*(v.y+y.y),x.z=.5*(v.z+y.z);var w=si.magnitudeSquared(si.subtract(y,x,zr)),A=Math.sqrt(w),E=Vr;E.x=a.x,E.y=o.y,E.z=s.z;var S=Ur;S.x=u.x,S.y=l.y,S.z=c.z;var b=si.midpoint(E,S,Gr),M=0;for(d=0;d<m;d+=i){r.x=e[d]+t.x,r.y=e[d+1]+t.y,r.z=e[d+2]+t.z;var R=si.magnitude(si.subtract(r,b,zr));M<R&&(M=R);var D,P,I=si.magnitudeSquared(si.subtract(r,x,zr));w<I&&(w=(A=.5*(A+(D=Math.sqrt(I))))*A,P=D-A,x.x=(A*x.x+P*r.x)/D,x.y=(A*x.y+P*r.y)/D,x.z=(A*x.z+P*r.z)/D)}return A<M?(si.clone(x,n.center),n.radius=A):(si.clone(b,n.center),n.radius=M),n},Rr.fromEncodedCartesianVertices=function(e,t,i){if(oe(i)||(i=new Rr),!oe(e)||!oe(t)||e.length!==t.length||0===e.length)return i.center=si.clone(si.ZERO,i.center),i.radius=0,i;var n=Br;n.x=e[0]+t[0],n.y=e[1]+t[1],n.z=e[2]+t[2];for(var r=si.clone(n,Dr),a=si.clone(n,Pr),o=si.clone(n,Ir),s=si.clone(n,Or),u=si.clone(n,Lr),l=si.clone(n,Nr),c=e.length,m=0;m<c;m+=3){var d=e[m]+t[m],h=e[m+1]+t[m+1],f=e[m+2]+t[m+2];n.x=d,n.y=h,n.z=f,d<r.x&&si.clone(n,r),d>s.x&&si.clone(n,s),h<a.y&&si.clone(n,a),h>u.y&&si.clone(n,u),f<o.z&&si.clone(n,o),f>l.z&&si.clone(n,l)}var p=si.magnitudeSquared(si.subtract(s,r,zr)),_=si.magnitudeSquared(si.subtract(u,a,zr)),C=si.magnitudeSquared(si.subtract(l,o,zr)),g=r,v=s,y=p;y<_&&(y=_,g=a,v=u),y<C&&(y=C,g=o,v=l);var T=Fr;T.x=.5*(g.x+v.x),T.y=.5*(g.y+v.y),T.z=.5*(g.z+v.z);var x=si.magnitudeSquared(si.subtract(v,T,zr)),w=Math.sqrt(x),A=Vr;A.x=r.x,A.y=a.y,A.z=o.z;var E=Ur;E.x=s.x,E.y=u.y,E.z=l.z;var S=si.midpoint(A,E,Gr),b=0;for(m=0;m<c;m+=3){n.x=e[m]+t[m],n.y=e[m+1]+t[m+1],n.z=e[m+2]+t[m+2];var M=si.magnitude(si.subtract(n,S,zr));b<M&&(b=M);var R,D,P=si.magnitudeSquared(si.subtract(n,T,zr));x<P&&(x=(w=.5*(w+(R=Math.sqrt(P))))*w,D=R-w,T.x=(w*T.x+D*n.x)/R,T.y=(w*T.y+D*n.y)/R,T.z=(w*T.z+D*n.z)/R)}return w<b?(si.clone(T,i.center),i.radius=w):(si.clone(S,i.center),i.radius=b),i},Rr.fromCornerPoints=function(e,t,i){oe(i)||(i=new Rr);var n=si.midpoint(e,t,i.center);return i.radius=si.distance(n,t),i},Rr.fromEllipsoid=function(e,t){return oe(t)||(t=new Rr),si.clone(si.ZERO,t.center),t.radius=e.maximumRadius,t};var Kr=new si;Rr.fromBoundingSpheres=function(e,t){if(oe(t)||(t=new Rr),!oe(e)||0===e.length)return t.center=si.clone(si.ZERO,t.center),t.radius=0,t;var i=e.length;if(1===i)return Rr.clone(e[0],t);if(2===i)return Rr.union(e[0],e[1],t);for(var n=[],r=0;r<i;r++)n.push(e[r].center);var a=(t=Rr.fromPoints(n,t)).center,o=t.radius;for(r=0;r<i;r++)var s=e[r],o=Math.max(o,si.distance(a,s.center,Kr)+s.radius);return t.radius=o,t};var Zr=new si,Jr=new si,Qr=new si;Rr.fromOrientedBoundingBox=function(e,t){oe(t)||(t=new Rr);var i=e.halfAxes,n=pi.getColumn(i,0,Zr),r=pi.getColumn(i,1,Jr),a=pi.getColumn(i,2,Qr);return si.add(n,r,n),si.add(n,a,n),t.center=si.clone(e.center,t.center),t.radius=si.magnitude(n),t},Rr.clone=function(e,t){if(oe(e))return oe(t)?(t.center=si.clone(e.center,t.center),t.radius=e.radius,t):new Rr(e.center,e.radius)},Rr.packedLength=4,Rr.pack=function(e,t,i){i=z(i,0);var n=e.center;return t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i]=e.radius,t},Rr.unpack=function(e,t,i){t=z(t,0),oe(i)||(i=new Rr);var n=i.center;return n.x=e[t++],n.y=e[t++],n.z=e[t++],i.radius=e[t],i};var $r=new si,ea=new si;Rr.union=function(e,t,i){oe(i)||(i=new Rr);var n=e.center,r=e.radius,a=t.center,o=t.radius,s=si.subtract(a,n,$r),u=si.magnitude(s);if(u+o<=r)return e.clone(i),i;if(u+r<=o)return t.clone(i),i;var l=.5*(r+u+o),c=si.multiplyByScalar(s,(l-r)/u,ea);return si.add(c,n,c),si.clone(c,i.center),i.radius=l,i};var ta=new si;Rr.expand=function(e,t,i){i=Rr.clone(e,i);var n=si.magnitude(si.subtract(t,i.center,ta));return n>i.radius&&(i.radius=n),i},Rr.intersectPlane=function(e,t){var i=e.center,n=e.radius,r=t.normal,a=si.dot(r,i)+t.distance;return a<-n?Er.OUTSIDE:a<n?Er.INTERSECTING:Er.INSIDE},Rr.transform=function(e,t,i){return oe(i)||(i=new Rr),i.center=Rn.multiplyByPoint(t,e.center,i.center),i.radius=Rn.getMaximumScale(t)*e.radius,i};var ia=new si;Rr.distanceSquaredTo=function(e,t){var i=si.subtract(e.center,t,ia);return si.magnitudeSquared(i)-e.radius*e.radius},Rr.transformWithoutScale=function(e,t,i){return oe(i)||(i=new Rr),i.center=Rn.multiplyByPoint(t,e.center,i.center),i.radius=e.radius,i};var na=new si;Rr.computePlaneDistances=function(e,t,i,n){oe(n)||(n=new Sr);var r=si.subtract(e.center,t,na),a=si.dot(i,r);return n.start=a-e.radius,n.stop=a+e.radius,n};for(var ra=new si,aa=new si,oa=new si,sa=new si,ua=new si,la=new dr,ca=new Array(8),ma=0;ma<8;++ma)ca[ma]=new si;var da=new Ar;function ha(e,t){this.x=z(e,0),this.y=z(t,0)}Rr.projectTo2D=function(e,t,i){var n=(t=z(t,da)).ellipsoid,r=e.center,a=e.radius,o=si.equals(r,si.ZERO)?si.clone(si.UNIT_X,ra):n.geodeticSurfaceNormal(r,ra),s=si.cross(si.UNIT_Z,o,aa);si.normalize(s,s);var u=si.cross(o,s,oa);si.normalize(u,u),si.multiplyByScalar(o,a,o),si.multiplyByScalar(u,a,u),si.multiplyByScalar(s,a,s);var l=si.negate(u,ua),c=si.negate(s,sa),m=ca,d=m[0];si.add(o,u,d),si.add(d,s,d),d=m[1],si.add(o,u,d),si.add(d,c,d),d=m[2],si.add(o,l,d),si.add(d,c,d),d=m[3],si.add(o,l,d),si.add(d,s,d),si.negate(o,o),d=m[4],si.add(o,u,d),si.add(d,s,d),d=m[5],si.add(o,u,d),si.add(d,c,d),d=m[6],si.add(o,l,d),si.add(d,c,d),d=m[7],si.add(o,l,d),si.add(d,s,d);for(var h=m.length,f=0;f<h;++f){var p=m[f];si.add(r,p,p);var _=n.cartesianToCartographic(p,la);t.project(_,p)}var C=(r=(i=Rr.fromPoints(m,i)).center).x,g=r.y,v=r.z;return r.x=v,r.y=C,r.z=g,i},Rr.isOccluded=function(e,t){return!t.isBoundingSphereVisible(e)},Rr.equals=function(e,t){return e===t||oe(e)&&oe(t)&&si.equals(e.center,t.center)&&e.radius===t.radius},Rr.prototype.intersectPlane=function(e){return Rr.intersectPlane(this,e)},Rr.prototype.distanceSquaredTo=function(e){return Rr.distanceSquaredTo(this,e)},Rr.prototype.computePlaneDistances=function(e,t,i){return Rr.computePlaneDistances(this,e,t,i)},Rr.prototype.isOccluded=function(e){return Rr.isOccluded(this,e)},Rr.prototype.equals=function(e){return Rr.equals(this,e)},Rr.prototype.clone=function(e){return Rr.clone(this,e)},Rr.prototype.volume=function(){var e=this.radius;return kr*e*e*e},ha.fromElements=function(e,t,i){return oe(i)?(i.x=e,i.y=t,i):new ha(e,t)},ha.fromCartesian3=ha.clone=function(e,t){if(oe(e))return oe(t)?(t.x=e.x,t.y=e.y,t):new ha(e.x,e.y)},ha.fromCartesian4=ha.clone,ha.packedLength=2,ha.pack=function(e,t,i){return i=z(i,0),t[i++]=e.x,t[i]=e.y,t},ha.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new ha),i.x=e[t++],i.y=e[t],i},ha.packArray=function(e,t){var i=e.length,n=2*i;if(oe(t)){if(!Array.isArray(t)&&t.length!==n)throw new x("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==n&&(t.length=n)}else t=new Array(n);for(var r=0;r<i;++r)ha.pack(e[r],t,2*r);return t},ha.unpackArray=function(e,t){var i=e.length;oe(t)?t.length=i/2:t=new Array(i/2);for(var n=0;n<i;n+=2){var r=n/2;t[r]=ha.unpack(e,n,t[r])}return t},ha.fromArray=ha.unpack,ha.maximumComponent=function(e){return Math.max(e.x,e.y)},ha.minimumComponent=function(e){return Math.min(e.x,e.y)},ha.minimumByComponent=function(e,t,i){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i},ha.maximumByComponent=function(e,t,i){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i},ha.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},ha.magnitude=function(e){return Math.sqrt(ha.magnitudeSquared(e))};var fa=new ha;ha.distance=function(e,t){return ha.subtract(e,t,fa),ha.magnitude(fa)},ha.distanceSquared=function(e,t){return ha.subtract(e,t,fa),ha.magnitudeSquared(fa)},ha.normalize=function(e,t){var i=ha.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t},ha.dot=function(e,t){return e.x*t.x+e.y*t.y},ha.multiplyComponents=function(e,t,i){return i.x=e.x*t.x,i.y=e.y*t.y,i},ha.divideComponents=function(e,t,i){return i.x=e.x/t.x,i.y=e.y/t.y,i},ha.add=function(e,t,i){return i.x=e.x+t.x,i.y=e.y+t.y,i},ha.subtract=function(e,t,i){return i.x=e.x-t.x,i.y=e.y-t.y,i},ha.multiplyByScalar=function(e,t,i){return i.x=e.x*t,i.y=e.y*t,i},ha.divideByScalar=function(e,t,i){return i.x=e.x/t,i.y=e.y/t,i},ha.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t},ha.abs=function(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t};var pa=new ha;ha.lerp=function(e,t,i,n){return ha.multiplyByScalar(t,i,pa),n=ha.multiplyByScalar(e,1-i,n),ha.add(pa,n,n)};var _a=new ha,Ca=new ha;ha.angleBetween=function(e,t){return ha.normalize(e,_a),ha.normalize(t,Ca),ri.acosClamped(ha.dot(_a,Ca))};var ga=new ha;function va(e,t,i,n){this[0]=z(e,0),this[1]=z(i,0),this[2]=z(t,0),this[3]=z(n,0)}ha.mostOrthogonalAxis=function(e,t){var i=ha.normalize(e,ga);return ha.abs(i,i),t=i.x<=i.y?ha.clone(ha.UNIT_X,t):ha.clone(ha.UNIT_Y,t)},ha.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.x===t.x&&e.y===t.y},ha.equalsArray=function(e,t,i){return e.x===t[i]&&e.y===t[i+1]},ha.equalsEpsilon=function(e,t,i,n){return e===t||oe(e)&&oe(t)&&ri.equalsEpsilon(e.x,t.x,i,n)&&ri.equalsEpsilon(e.y,t.y,i,n)},ha.ZERO=Object.freeze(new ha(0,0)),ha.UNIT_X=Object.freeze(new ha(1,0)),ha.UNIT_Y=Object.freeze(new ha(0,1)),ha.prototype.clone=function(e){return ha.clone(this,e)},ha.prototype.equals=function(e){return ha.equals(this,e)},ha.prototype.equalsEpsilon=function(e,t,i){return ha.equalsEpsilon(this,e,t,i)},ha.prototype.toString=function(){return"("+this.x+", "+this.y+")"},va.packedLength=4,va.pack=function(e,t,i){return i=z(i,0),t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t},va.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new va),i[0]=e[t++],i[1]=e[t++],i[2]=e[t++],i[3]=e[t++],i},va.clone=function(e,t){if(oe(e))return oe(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):new va(e[0],e[2],e[1],e[3])},va.fromArray=function(e,t,i){return t=z(t,0),oe(i)||(i=new va),i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],i},va.fromColumnMajorArray=function(e,t){return va.clone(e,t)},va.fromRowMajorArray=function(e,t){return oe(t)?(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t):new va(e[0],e[1],e[2],e[3])},va.fromScale=function(e,t){return oe(t)?(t[0]=e.x,t[1]=0,t[2]=0,t[3]=e.y,t):new va(e.x,0,0,e.y)},va.fromUniformScale=function(e,t){return oe(t)?(t[0]=e,t[1]=0,t[2]=0,t[3]=e,t):new va(e,0,0,e)},va.fromRotation=function(e,t){var i=Math.cos(e),n=Math.sin(e);return oe(t)?(t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t):new va(i,-n,n,i)},va.toArray=function(e,t){return oe(t)?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):[e[0],e[1],e[2],e[3]]},va.getElementIndex=function(e,t){return 2*e+t},va.getColumn=function(e,t,i){var n=2*t,r=e[n],a=e[1+n];return i.x=r,i.y=a,i},va.setColumn=function(e,t,i,n){var r=2*t;return(n=va.clone(e,n))[r]=i.x,n[1+r]=i.y,n},va.getRow=function(e,t,i){var n=e[t],r=e[t+2];return i.x=n,i.y=r,i},va.setRow=function(e,t,i,n){return(n=va.clone(e,n))[t]=i.x,n[t+2]=i.y,n};var ya=new ha;va.getScale=function(e,t){return t.x=ha.magnitude(ha.fromElements(e[0],e[1],ya)),t.y=ha.magnitude(ha.fromElements(e[2],e[3],ya)),t};var Ta=new ha;function xa(e,t,i,n){this.x=z(e,0),this.y=z(t,0),this.z=z(i,0),this.w=z(n,0)}va.getMaximumScale=function(e){return va.getScale(e,Ta),ha.maximumComponent(Ta)},va.multiply=function(e,t,i){var n=e[0]*t[0]+e[2]*t[1],r=e[0]*t[2]+e[2]*t[3],a=e[1]*t[0]+e[3]*t[1],o=e[1]*t[2]+e[3]*t[3];return i[0]=n,i[1]=a,i[2]=r,i[3]=o,i},va.add=function(e,t,i){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i},va.subtract=function(e,t,i){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i},va.multiplyByVector=function(e,t,i){var n=e[0]*t.x+e[2]*t.y,r=e[1]*t.x+e[3]*t.y;return i.x=n,i.y=r,i},va.multiplyByScalar=function(e,t,i){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i},va.multiplyByScale=function(e,t,i){return i[0]=e[0]*t.x,i[1]=e[1]*t.x,i[2]=e[2]*t.y,i[3]=e[3]*t.y,i},va.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},va.transpose=function(e,t){var i=e[0],n=e[2],r=e[1],a=e[3];return t[0]=i,t[1]=n,t[2]=r,t[3]=a,t},va.abs=function(e,t){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t},va.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},va.equalsArray=function(e,t,i){return e[0]===t[i]&&e[1]===t[i+1]&&e[2]===t[i+2]&&e[3]===t[i+3]},va.equalsEpsilon=function(e,t,i){return e===t||oe(e)&&oe(t)&&Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i},va.IDENTITY=Object.freeze(new va(1,0,0,1)),va.ZERO=Object.freeze(new va(0,0,0,0)),va.COLUMN0ROW0=0,va.COLUMN0ROW1=1,va.COLUMN1ROW0=2,va.COLUMN1ROW1=3,Object.defineProperties(va.prototype,{length:{get:function(){return va.packedLength}}}),va.prototype.clone=function(e){return va.clone(this,e)},va.prototype.equals=function(e){return va.equals(this,e)},va.prototype.equalsEpsilon=function(e,t){return va.equalsEpsilon(this,e,t)},va.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n("+this[1]+", "+this[3]+")"};var wa=new si;xa.fromAxisAngle=function(e,t,i){var n=t/2,r=Math.sin(n),a=(wa=si.normalize(e,wa)).x*r,o=wa.y*r,s=wa.z*r,u=Math.cos(n);return oe(i)?(i.x=a,i.y=o,i.z=s,i.w=u,i):new xa(a,o,s,u)};var Aa=[1,2,0],Ea=new Array(3);xa.fromRotationMatrix=function(e,t){var i,n,r,a,o,s,u,l,c=e[pi.COLUMN0ROW0],m=e[pi.COLUMN1ROW1],d=e[pi.COLUMN2ROW2],h=c+m+d,f=0<h?(r=.5*(u=Math.sqrt(h+1)),u=.5/u,i=(e[pi.COLUMN1ROW2]-e[pi.COLUMN2ROW1])*u,n=(e[pi.COLUMN2ROW0]-e[pi.COLUMN0ROW2])*u,(e[pi.COLUMN0ROW1]-e[pi.COLUMN1ROW0])*u):(s=Aa[o=Aa[a=c<d&&m<d?2:c<m?1:0]],u=Math.sqrt(e[pi.getElementIndex(a,a)]-e[pi.getElementIndex(o,o)]-e[pi.getElementIndex(s,s)]+1),(l=Ea)[a]=.5*u,u=.5/u,r=(e[pi.getElementIndex(s,o)]-e[pi.getElementIndex(o,s)])*u,l[o]=(e[pi.getElementIndex(o,a)]+e[pi.getElementIndex(a,o)])*u,l[s]=(e[pi.getElementIndex(s,a)]+e[pi.getElementIndex(a,s)])*u,i=-l[0],n=-l[1],-l[2]);return oe(t)?(t.x=i,t.y=n,t.z=f,t.w=r,t):new xa(i,n,f,r)};var Sa=new xa,ba=new xa,Ma=new xa,Ra=new xa;xa.fromHeadingPitchRoll=function(e,t){return Ra=xa.fromAxisAngle(si.UNIT_X,e.roll,Sa),Ma=xa.fromAxisAngle(si.UNIT_Y,-e.pitch,t),t=xa.multiply(Ma,Ra,Ma),ba=xa.fromAxisAngle(si.UNIT_Z,-e.heading,Sa),xa.multiply(ba,t,t)};var Da=new si,Pa=new si,Ia=new xa,Oa=new xa,La=new xa;xa.packedLength=4,xa.pack=function(e,t,i){return i=z(i,0),t[i++]=e.x,t[i++]=e.y,t[i++]=e.z,t[i]=e.w,t},xa.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new xa),i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3],i},xa.packedInterpolationLength=3,xa.convertPackedArrayForInterpolation=function(e,t,i,n){xa.unpack(e,4*i,La),xa.conjugate(La,La);for(var r=0,a=i-t+1;r<a;r++){var o=3*r;xa.unpack(e,4*(t+r),Ia),xa.multiply(Ia,La,Ia),Ia.w<0&&xa.negate(Ia,Ia),xa.computeAxis(Ia,Da);var s=xa.computeAngle(Ia);n[o]=Da.x*s,n[1+o]=Da.y*s,n[2+o]=Da.z*s}},xa.unpackInterpolationResult=function(e,t,i,n,r){oe(r)||(r=new xa),si.fromArray(e,0,Pa);var a=si.magnitude(Pa);return xa.unpack(t,4*n,Oa),0===a?xa.clone(xa.IDENTITY,Ia):xa.fromAxisAngle(Pa,a,Ia),xa.multiply(Ia,Oa,r)},xa.clone=function(e,t){if(oe(e))return oe(t)?(t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t):new xa(e.x,e.y,e.z,e.w)},xa.conjugate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},xa.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},xa.magnitude=function(e){return Math.sqrt(xa.magnitudeSquared(e))},xa.normalize=function(e,t){var i=1/xa.magnitude(e),n=e.x*i,r=e.y*i,a=e.z*i,o=e.w*i;return t.x=n,t.y=r,t.z=a,t.w=o,t},xa.inverse=function(e,t){var i=xa.magnitudeSquared(e);return t=xa.conjugate(e,t),xa.multiplyByScalar(t,1/i,t)},xa.add=function(e,t,i){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i.w=e.w+t.w,i},xa.subtract=function(e,t,i){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i.w=e.w-t.w,i},xa.negate=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},xa.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},xa.multiply=function(e,t,i){var n=e.x,r=e.y,a=e.z,o=e.w,s=t.x,u=t.y,l=t.z,c=t.w,m=o*s+n*c+r*l-a*u,d=o*u-n*l+r*c+a*s,h=o*l+n*u-r*s+a*c,f=o*c-n*s-r*u-a*l;return i.x=m,i.y=d,i.z=h,i.w=f,i},xa.multiplyByScalar=function(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i.w=e.w*t,i},xa.divideByScalar=function(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i.w=e.w/t,i},xa.computeAxis=function(e,t){var i=e.w;if(Math.abs(i-1)<ri.EPSILON6)return t.x=t.y=t.z=0,t;var n=1/Math.sqrt(1-i*i);return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t},xa.computeAngle=function(e){return Math.abs(e.w-1)<ri.EPSILON6?0:2*Math.acos(e.w)};var Na=new xa;xa.lerp=function(e,t,i,n){return Na=xa.multiplyByScalar(t,i,Na),n=xa.multiplyByScalar(e,1-i,n),xa.add(Na,n,n)};var Ba=new xa,za=new xa,Fa=new xa;xa.slerp=function(e,t,i,n){var r=xa.dot(e,t),a=t;if(r<0&&(r=-r,a=Ba=xa.negate(t,Ba)),1-r<ri.EPSILON6)return xa.lerp(e,a,i,n);var o=Math.acos(r);return za=xa.multiplyByScalar(e,Math.sin((1-i)*o),za),Fa=xa.multiplyByScalar(a,Math.sin(i*o),Fa),n=xa.add(za,Fa,n),xa.multiplyByScalar(n,1/Math.sin(o),n)},xa.log=function(e,t){var i=ri.acosClamped(e.w),n=0;return 0!==i&&(n=i/Math.sin(i)),si.multiplyByScalar(e,n,t)},xa.exp=function(e,t){var i=si.magnitude(e),n=0;return 0!==i&&(n=Math.sin(i)/i),t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=Math.cos(i),t};var Va=new si,Ua=new si,Ga=new xa,ka=new xa;xa.computeInnerQuadrangle=function(e,t,i,n){var r=xa.conjugate(t,Ga);xa.multiply(r,i,ka);var a=xa.log(ka,Va);xa.multiply(r,e,ka);var o=xa.log(ka,Ua);return si.add(a,o,a),si.multiplyByScalar(a,.25,a),si.negate(a,a),xa.exp(a,Ga),xa.multiply(t,Ga,n)},xa.squad=function(e,t,i,n,r,a){var o=xa.slerp(e,t,r,Ga),s=xa.slerp(i,n,r,ka);return xa.slerp(o,s,2*r*(1-r),a)};for(var Ha=new xa,Wa=1.9011074535173003,qa=He.supportsTypedArrays()?new Float32Array(8):[],ja=He.supportsTypedArrays()?new Float32Array(8):[],Ya=He.supportsTypedArrays()?new Float32Array(8):[],Xa=He.supportsTypedArrays()?new Float32Array(8):[],Ka=0;Ka<7;++Ka){var Za=Ka+1,Ja=2*Za+1;qa[Ka]=1/(Za*Ja),ja[Ka]=Za/Ja}qa[7]=Wa/136,ja[7]=8*Wa/17,xa.fastSlerp=function(e,t,i,n){var r,a=xa.dot(e,t);0<=a?r=1:(r=-1,a=-a);for(var o=a-1,s=1-i,u=i*i,l=s*s,c=7;0<=c;--c)Ya[c]=(qa[c]*u-ja[c])*o,Xa[c]=(qa[c]*l-ja[c])*o;var m=r*i*(1+Ya[0]*(1+Ya[1]*(1+Ya[2]*(1+Ya[3]*(1+Ya[4]*(1+Ya[5]*(1+Ya[6]*(1+Ya[7])))))))),d=s*(1+Xa[0]*(1+Xa[1]*(1+Xa[2]*(1+Xa[3]*(1+Xa[4]*(1+Xa[5]*(1+Xa[6]*(1+Xa[7])))))))),h=xa.multiplyByScalar(e,d,Ha);return xa.multiplyByScalar(t,m,n),xa.add(h,n,n)},xa.fastSquad=function(e,t,i,n,r,a){var o=xa.fastSlerp(e,t,r,Ga),s=xa.fastSlerp(i,n,r,ka);return xa.fastSlerp(o,s,2*r*(1-r),a)},xa.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},xa.equalsEpsilon=function(e,t,i){return e===t||oe(e)&&oe(t)&&Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i&&Math.abs(e.z-t.z)<=i&&Math.abs(e.w-t.w)<=i},xa.ZERO=Object.freeze(new xa(0,0,0,0)),xa.IDENTITY=Object.freeze(new xa(0,0,0,1)),xa.prototype.clone=function(e){return xa.clone(this,e)},xa.prototype.equals=function(e){return xa.equals(this,e)},xa.prototype.equalsEpsilon=function(e,t){return xa.equalsEpsilon(this,e,t)},xa.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var Qa=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047});function $a(e,t){var i=/#define OUTPUT_DECLARATION/,n=e.split("\n");if(/#version 300 es/g.test(e))return e;for(var r,a=-1,o=0;o<n.length;++o)if(r=n[o],i.test(r)){a=o;break}if(-1===a)throw new x("Could not find a #define OUTPUT_DECLARATION!");var s=[];for(o=0;o<10;o++){var u="gl_FragData\\["+o+"\\]",l="czm_out"+o;new RegExp(u,"g").test(e)&&(to(l,s),eo(u,l,n),n.splice(a,0,"layout(location = "+o+") out vec4 "+l+";"),a+=1)}var c="czm_fragColor";!function(e,t){for(var i=new RegExp("(^|[^\\w])("+e+")($|[^\\w])","g"),n=t.length,r=0;r<n;++r){var a=t[r];if(i.test(a))return 1}return}("gl_FragColor",n)||(to(c,s),eo("gl_FragColor",c,n),n.splice(a,0,"layout(location = 0) out vec4 czm_fragColor;"),a+=1);var m=function(e,t){for(var i={},n=e.length,r=[],a=0;a<t.length;++a){var o=t[a],s=/(#ifdef|#if)/g.test(o),u=/#else/g.test(o),l=/#endif/g.test(o);if(s)r.push(o);else if(u){var c=r[r.length-1].replace("ifdef","ifndef");/if/g.test(c)&&(c=c.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),r.pop(),r.push(c)}else if(l)r.pop();else if(!/layout/g.test(o))for(var m=0;m<n;++m){var d=e[m];-1!==o.indexOf(d)&&(oe(i[d])?i[d]=i[d].filter(function(e){return 0<=r.indexOf(e)}):i[d]=r.slice())}}return i}(s,n),d={};for(o=0;o<n.length;o++)for(var h in r=n[o],m){m.hasOwnProperty(h)&&new RegExp("(layout)[^]+(out)[^]+("+h+")[^]+","g").test(r)&&(d[r]=h)}for(var f in d)if(d.hasOwnProperty(f)){for(var p=d[f],_=n.indexOf(f),C=m[p],g=C.length,v=0;v<g;v++)n.splice(_,0,C[v]);for(_+=g+1,v=g-1;0<=v;v--)n.splice(_,0,"#endif //"+C[v])}var y="#version 300 es",T=!1;for(o=0;o<n.length;o++)/#version/.test(n[o])&&(n[o]=y,T=!0);return T||n.splice(0,0,y),io("EXT_draw_buffers",n),io("EXT_frag_depth",n),io("OES_standard_derivatives",n),io("EXT_shader_texture_lod",n),eo("texture2DLodEXT","textureLod",n),eo("texture2D","texture",n),eo("texture3D","texture",n),eo("textureCube","texture",n),eo("gl_FragDepthEXT","gl_FragDepth",n),t?eo("varying","in",n):(eo("attribute","in",n),eo("varying","out",n)),function(e){for(var t="",i=e.length,n=0;n<i;++n)t+=e[n]+"\n";return t}(n)}function eo(e,t,i){for(var n=new RegExp("(^|[^\\w])("+e+")($|[^\\w])","g"),r=i.length,a=0;a<r;++a){var o=i[a];i[a]=o.replace(n,"$1"+t+"$3")}}function to(e,t){-1===t.indexOf(e)&&t.push(e)}function io(e,t){!function(e,t,i){for(var n=i.length,r=0;r<n;++r){var a=i[r];i[r]=a.replace(e,t)}}(new RegExp("#extension\\s+GL_"+e+"\\s+:\\s+[a-zA-Z0-9]+\\s*$","g"),"",t)}var no={czm_degreesPerRadian:"const float czm_degreesPerRadian = 57.29577951308232;\n",czm_depthRange:"const czm_depthRangeStruct czm_depthRange = czm_depthRangeStruct(0.0, 1.0);\n",czm_epsilon1:"const float czm_epsilon1 = 0.1;\n",czm_epsilon2:"const float czm_epsilon2 = 0.01;\n",czm_epsilon3:"const float czm_epsilon3 = 0.001;\n",czm_epsilon4:"const float czm_epsilon4 = 0.0001;\n",czm_epsilon5:"const float czm_epsilon5 = 0.00001;\n",czm_epsilon6:"const float czm_epsilon6 = 0.000001;\n",czm_epsilon7:"const float czm_epsilon7 = 0.0000001;\n",czm_infinity:"const float czm_infinity = 5906376272000.0;\n",czm_oneOverPi:"const float czm_oneOverPi = 0.3183098861837907;\n",czm_oneOverTwoPi:"const float czm_oneOverTwoPi = 0.15915494309189535;\n",czm_passCesium3DTile:"const float czm_passCesium3DTile = 4.0;\n",czm_passCesium3DTileClassification:"const float czm_passCesium3DTileClassification = 5.0;\n",czm_passCesium3DTileClassificationIgnoreShow:"const float czm_passCesium3DTileClassificationIgnoreShow = 6.0;\n",czm_passClassification:"const float czm_passClassification = 7.0;\n",czm_passCompute:"const float czm_passCompute = 1.0;\n",czm_passEnvironment:"const float czm_passEnvironment = 0.0;\n",czm_passGlobe:"const float czm_passGlobe = 2.0;\n",czm_passOpaque:"const float czm_passOpaque = 7.0;\n",czm_passOverlay:"const float czm_passOverlay = 9.0;\n",czm_passTerrainClassification:"const float czm_passTerrainClassification = 3.0;\n",czm_passTranslucent:"const float czm_passTranslucent = 8.0;\n",czm_pi:"const float czm_pi = 3.141592653589793;\n",czm_piOverFour:"const float czm_piOverFour = 0.7853981633974483;\n",czm_piOverSix:"const float czm_piOverSix = 0.5235987755982988;\n",czm_piOverThree:"const float czm_piOverThree = 1.0471975511965976;\n",czm_piOverTwo:"const float czm_piOverTwo = 1.5707963267948966;\n",czm_radiansPerDegree:"const float czm_radiansPerDegree = 0.017453292519943295;\n",czm_sceneMode2D:"const float czm_sceneMode2D = 2.0;\n",czm_sceneMode3D:"const float czm_sceneMode3D = 3.0;\n",czm_sceneModeColumbusView:"const float czm_sceneModeColumbusView = 1.0;\n",czm_sceneModeMorphing:"const float czm_sceneModeMorphing = 0.0;\n",czm_solarRadius:"const float czm_solarRadius = 695500000.0;\n",czm_threePiOver2:"const float czm_threePiOver2 = 4.71238898038469;\n",czm_twoPi:"const float czm_twoPi = 6.283185307179586;\n",czm_webMercatorMaxLatitude:"const float czm_webMercatorMaxLatitude = 1.4844222297453324;\n",czm_depthRangeStruct:"struct czm_depthRangeStruct\n{\nfloat near;\nfloat far;\n};\n",czm_material:"struct czm_material\n{\nvec3 diffuse;\nfloat specular;\nfloat shininess;\nvec3 normal;\nvec3 emission;\nfloat alpha;\n};\n",czm_materialInput:"struct czm_materialInput\n{\nfloat s;\nvec2 st;\nvec3 str;\nvec3 normalEC;\nmat3 tangentToEyeMatrix;\nvec3 positionToEyeEC;\nfloat height;\nfloat slope;\nfloat aspect;\n};\n",czm_ray:"struct czm_ray\n{\nvec3 origin;\nvec3 direction;\n};\n",czm_raySegment:"struct czm_raySegment\n{\nfloat start;\nfloat stop;\n};\nconst czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);\nconst czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);\n",czm_shadowParameters:"struct czm_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\nvec3 texCoords;\n#else\nvec2 texCoords;\n#endif\nfloat depthBias;\nfloat depth;\nfloat nDotL;\nvec2 texelStepSize;\nfloat normalShadingSmooth;\nfloat darkness;\n};\n",czm_acesTonemapping:"vec3 czm_acesTonemapping(vec3 color) {\nfloat g = 0.985;\nfloat a = 0.065;\nfloat b = 0.0001;\nfloat c = 0.433;\nfloat d = 0.238;\ncolor = (color * (color + a) - b) / (color * (g * color + c) + d);\ncolor = clamp(color, 0.0, 1.0);\nreturn color;\n}\n",czm_alphaWeight:"float czm_alphaWeight(float a)\n{\nfloat z = (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nreturn pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));\n}\n",czm_antialias:"vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)\n{\nfloat val1 = clamp(dist / fuzzFactor, 0.0, 1.0);\nfloat val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);\nval1 = val1 * (1.0 - val2);\nval1 = val1 * val1 * (3.0 - (2.0 * val1));\nval1 = pow(val1, 0.5);\nvec4 midColor = (color1 + color2) * 0.5;\nreturn mix(midColor, currentColor, val1);\n}\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)\n{\nreturn czm_antialias(color1, color2, currentColor, dist, 0.1);\n}\n",czm_approximateSphericalCoordinates:"vec2 czm_approximateSphericalCoordinates(vec3 normal) {\nfloat latitudeApproximation = czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);\nfloat longitudeApproximation = czm_fastApproximateAtan(normal.x, normal.y);\nreturn vec2(latitudeApproximation, longitudeApproximation);\n}\n",czm_backFacing:"bool czm_backFacing()\n{\nreturn gl_FrontFacing == false;\n}\n",czm_branchFreeTernary:"float czm_branchFreeTernary(bool comparison, float a, float b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\n",czm_cascadeColor:"vec4 czm_cascadeColor(vec4 weights)\n{\nreturn vec4(1.0, 0.0, 0.0, 1.0) * weights.x +\nvec4(0.0, 1.0, 0.0, 1.0) * weights.y +\nvec4(0.0, 0.0, 1.0, 1.0) * weights.z +\nvec4(1.0, 0.0, 1.0, 1.0) * weights.w;\n}\n",czm_cascadeDistance:"uniform vec4 shadowMap_cascadeDistances;\nfloat czm_cascadeDistance(vec4 weights)\n{\nreturn dot(shadowMap_cascadeDistances, weights);\n}\n",czm_cascadeMatrix:"uniform mat4 shadowMap_cascadeMatrices[4];\nmat4 czm_cascadeMatrix(vec4 weights)\n{\nreturn shadowMap_cascadeMatrices[0] * weights.x +\nshadowMap_cascadeMatrices[1] * weights.y +\nshadowMap_cascadeMatrices[2] * weights.z +\nshadowMap_cascadeMatrices[3] * weights.w;\n}\n",czm_cascadeWeights:"uniform vec4 shadowMap_cascadeSplits[2];\nvec4 czm_cascadeWeights(float depthEye)\n{\nvec4 near = step(shadowMap_cascadeSplits[0], vec4(depthEye));\nvec4 far = step(depthEye, shadowMap_cascadeSplits[1]);\nreturn near * far;\n}\n",czm_columbusViewMorph:"vec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)\n{\nvec3 p = mix(position2D.xyz, position3D.xyz, time);\nreturn vec4(p, 1.0);\n}\n",czm_computePosition:"vec4 czm_computePosition();\n",czm_cosineAndSine:"vec2 cordic(float angle)\n{\nvec2 vector = vec2(6.0725293500888267e-1, 0.0);\nfloat sense = (angle < 0.0) ? -1.0 : 1.0;\nmat2 rotation = mat2(1.0, sense, -sense, 1.0);\nvector = rotation * vector;\nangle -= sense * 7.8539816339744828e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfloat factor = sense * 5.0e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.6364760900080609e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.5e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4497866312686414e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.25e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2435499454676144e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.25e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.2418809995957350e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.125e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.1239833430268277e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.5625e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5623728620476831e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.8125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.8123410601011111e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.90625e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.9062301319669718e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.953125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9531225164788188e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.765625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.7656218955931946e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.8828125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.8828121119489829e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.44140625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4414062014936177e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.220703125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2207031189367021e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.103515625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.1035156174208773e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.0517578125e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.0517578115526096e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.52587890625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5258789061315762e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.62939453125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.6293945311019700e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.814697265625e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.8146972656064961e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.9073486328125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9073486328101870e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.5367431640625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.5367431640596084e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.76837158203125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.7683715820308884e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.384185791015625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.3841857910155797e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.1920928955078125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nreturn vector;\n}\nvec2 czm_cosineAndSine(float angle)\n{\nif (angle < -czm_piOverTwo || angle > czm_piOverTwo)\n{\nif (angle < 0.0)\n{\nreturn -cordic(angle + czm_pi);\n}\nelse\n{\nreturn -cordic(angle - czm_pi);\n}\n}\nelse\n{\nreturn cordic(angle);\n}\n}\n",czm_decompressTextureCoordinates:"vec2 czm_decompressTextureCoordinates(float encoded)\n{\nfloat temp = encoded / 4096.0;\nfloat xZeroTo4095 = floor(temp);\nfloat stx = xZeroTo4095 / 4095.0;\nfloat sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;\nreturn vec2(stx, sty);\n}\n",czm_depthClampFarPlane:"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvec4 czm_depthClampFarPlane(vec4 coords)\n{\n#ifndef LOG_DEPTH\nv_WindowZ = (0.5 * (coords.z / coords.w) + 0.5) * coords.w;\ncoords.z = min(coords.z, coords.w);\n#endif\nreturn coords;\n}\n",czm_eastNorthUpToEyeCoordinates:"mat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\nvec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));\nvec3 tangentEC = normalize(czm_normal3D * tangentMC);\nvec3 bitangentEC = normalize(cross(normalEC, tangentEC));\nreturn mat3(\ntangentEC.x,   tangentEC.y,   tangentEC.z,\nbitangentEC.x, bitangentEC.y, bitangentEC.z,\nnormalEC.x,    normalEC.y,    normalEC.z);\n}\n",czm_ellipsoidContainsPoint:"bool czm_ellipsoidContainsPoint(vec3 ellipsoid_inverseRadii, vec3 point)\n{\nvec3 scaled = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\nreturn (dot(scaled, scaled) <= 1.0);\n}\n",czm_ellipsoidWgs84TextureCoordinates:"vec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\nreturn vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\n",czm_equalsEpsilon:"bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec4(epsilon)));\n}\nbool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\nbool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\nreturn (abs(left - right) <= epsilon);\n}\n",czm_eyeOffset:"vec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\nvec4 p = positionEC;\nvec4 zEyeOffset = normalize(p) * eyeOffset.z;\np.xy += eyeOffset.xy + zEyeOffset.xy;\np.z += zEyeOffset.z;\nreturn p;\n}\n",czm_eyeToWindowCoordinates:"vec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\nvec4 q = czm_projection * positionEC;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n",czm_fastApproximateAtan:"float czm_fastApproximateAtan(float x) {\nreturn x * (-0.1784 * x - 0.0663 * x * x + 1.0301);\n}\nfloat czm_fastApproximateAtan(float x, float y) {\nfloat t = abs(x);\nfloat opposite = abs(y);\nfloat adjacent = max(t, opposite);\nopposite = min(t, opposite);\nt = czm_fastApproximateAtan(opposite / adjacent);\nt = czm_branchFreeTernary(abs(y) > abs(x), czm_piOverTwo - t, t);\nt = czm_branchFreeTernary(x < 0.0, czm_pi - t, t);\nt = czm_branchFreeTernary(y < 0.0, -t, t);\nreturn t;\n}\n",czm_fog:"vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)\n{\nfloat scalar = distanceToCamera * czm_fogDensity;\nfloat fog = 1.0 - exp(-(scalar * scalar));\nreturn mix(color, fogColor, fog);\n}\nvec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor, float fogModifierConstant)\n{\nfloat scalar = distanceToCamera * czm_fogDensity;\nfloat fog = 1.0 - exp(-((fogModifierConstant * scalar + fogModifierConstant) * (scalar * (1.0 + fogModifierConstant))));\nreturn mix(color, fogColor, fog);\n}\n",czm_gammaCorrect:"vec3 czm_gammaCorrect(vec3 color) {\n#ifdef HDR\ncolor = pow(color, vec3(czm_gamma));\n#endif\nreturn color;\n}\nvec4 czm_gammaCorrect(vec4 color) {\n#ifdef HDR\ncolor.rgb = pow(color.rgb, vec3(czm_gamma));\n#endif\nreturn color;\n}\n",czm_geodeticSurfaceNormal:"vec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\nreturn normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\n",czm_getDefaultMaterial:"czm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\nczm_material material;\nmaterial.diffuse = vec3(0.0);\nmaterial.specular = 0.0;\nmaterial.shininess = 1.0;\nmaterial.normal = materialInput.normalEC;\nmaterial.emission = vec3(0.0);\nmaterial.alpha = 1.0;\nreturn material;\n}\n",czm_getLambertDiffuse:"float czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)\n{\nreturn max(dot(lightDirectionEC, normalEC), 0.0);\n}\n",czm_getSpecular:"float czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)\n{\nvec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);\nfloat specular = max(dot(toReflectedLight, toEyeEC), 0.0);\nreturn pow(specular, max(shininess, czm_epsilon2));\n}\n",czm_getWaterNoise:"vec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)\n{\nfloat cosAngle = cos(angleInRadians);\nfloat sinAngle = sin(angleInRadians);\nvec2 s0 = vec2(1.0/17.0, 0.0);\nvec2 s1 = vec2(-1.0/29.0, 0.0);\nvec2 s2 = vec2(1.0/101.0, 1.0/59.0);\nvec2 s3 = vec2(-1.0/109.0, -1.0/57.0);\ns0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\ns1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\ns2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\ns3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\nvec2 uv0 = (uv/103.0) + (time * s0);\nvec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);\nvec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\nvec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\nuv0 = fract(uv0);\nuv1 = fract(uv1);\nuv2 = fract(uv2);\nuv3 = fract(uv3);\nvec4 noise = (texture2D(normalMap, uv0)) +\n(texture2D(normalMap, uv1)) +\n(texture2D(normalMap, uv2)) +\n(texture2D(normalMap, uv3));\nreturn ((noise / 4.0) - 0.5) * 2.0;\n}\n",czm_HSBToRGB:"const vec4 K_HSB2RGB = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 czm_HSBToRGB(vec3 hsb)\n{\nvec3 p = abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);\nreturn hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);\n}\n",czm_HSLToRGB:"vec3 hueToRGB(float hue)\n{\nfloat r = abs(hue * 6.0 - 3.0) - 1.0;\nfloat g = 2.0 - abs(hue * 6.0 - 2.0);\nfloat b = 2.0 - abs(hue * 6.0 - 4.0);\nreturn clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 czm_HSLToRGB(vec3 hsl)\n{\nvec3 rgb = hueToRGB(hsl.x);\nfloat c = (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;\nreturn (rgb - 0.5) * c + hsl.z;\n}\n",czm_hue:"vec3 czm_hue(vec3 rgb, float adjustment)\n{\nconst mat3 toYIQ = mat3(0.299,     0.587,     0.114,\n0.595716, -0.274453, -0.321263,\n0.211456, -0.522591,  0.311135);\nconst mat3 toRGB = mat3(1.0,  0.9563,  0.6210,\n1.0, -0.2721, -0.6474,\n1.0, -1.107,   1.7046);\nvec3 yiq = toYIQ * rgb;\nfloat hue = atan(yiq.z, yiq.y) + adjustment;\nfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\nvec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\nreturn toRGB * color;\n}\n",czm_inverseGamma:"vec3 czm_inverseGamma(vec3 color) {\nreturn pow(color, vec3(1.0 / czm_gamma));\n}\n",czm_isEmpty:"bool czm_isEmpty(czm_raySegment interval)\n{\nreturn (interval.stop < 0.0);\n}\n",czm_isFull:"bool czm_isFull(czm_raySegment interval)\n{\nreturn (interval.start == 0.0 && interval.stop == czm_infinity);\n}\n",czm_latitudeToWebMercatorFraction:"float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)\n{\nfloat sinLatitude = sin(latitude);\nfloat mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\nreturn (mercatorY - southMercatorY) * oneOverMercatorHeight;\n}\n",czm_lineDistance:"float czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {\nreturn abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);\n}\n",czm_luminance:"float czm_luminance(vec3 rgb)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nreturn dot(rgb, W);\n}\n",czm_metersPerPixel:"float czm_metersPerPixel(vec4 positionEC, float pixelRatio)\n{\nfloat width = czm_viewport.z;\nfloat height = czm_viewport.w;\nfloat pixelWidth;\nfloat pixelHeight;\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nif (czm_sceneMode == czm_sceneMode2D || czm_orthographicIn3D == 1.0)\n{\nfloat frustumWidth = right - left;\nfloat frustumHeight = top - bottom;\npixelWidth = frustumWidth / width;\npixelHeight = frustumHeight / height;\n}\nelse\n{\nfloat distanceToPixel = -positionEC.z;\nfloat inverseNear = 1.0 / czm_currentFrustum.x;\nfloat tanTheta = top * inverseNear;\npixelHeight = 2.0 * distanceToPixel * tanTheta / height;\ntanTheta = right * inverseNear;\npixelWidth = 2.0 * distanceToPixel * tanTheta / width;\n}\nreturn max(pixelWidth, pixelHeight) * pixelRatio;\n}\nfloat czm_metersPerPixel(vec4 positionEC)\n{\nreturn czm_metersPerPixel(positionEC, czm_pixelRatio);\n}\n",czm_modelToWindowCoordinates:"vec4 czm_modelToWindowCoordinates(vec4 position)\n{\nvec4 q = czm_modelViewProjection * position;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n",czm_multiplyWithColorBalance:"vec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 target = left * right;\nfloat leftLuminance = dot(left, W);\nfloat rightLuminance = dot(right, W);\nfloat targetLuminance = dot(target, W);\nreturn ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\n",czm_nearFarScalar:"float czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)\n{\nfloat valueAtMin = nearFarScalar.y;\nfloat valueAtMax = nearFarScalar.w;\nfloat nearDistanceSq = nearFarScalar.x * nearFarScalar.x;\nfloat farDistanceSq = nearFarScalar.z * nearFarScalar.z;\nfloat t = (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);\nt = pow(clamp(t, 0.0, 1.0), 0.2);\nreturn mix(valueAtMin, valueAtMax, t);\n}\n",czm_octDecode:"vec3 czm_octDecode(vec2 encoded, float range)\n{\nif (encoded.x == 0.0 && encoded.y == 0.0) {\nreturn vec3(0.0, 0.0, 0.0);\n}\nencoded = encoded / range * 2.0 - 1.0;\nvec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\nif (v.z < 0.0)\n{\nv.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n}\nreturn normalize(v);\n}\nvec3 czm_octDecode(vec2 encoded)\n{\nreturn czm_octDecode(encoded, 255.0);\n}\nvec3 czm_octDecode(float encoded)\n{\nfloat temp = encoded / 256.0;\nfloat x = floor(temp);\nfloat y = (temp - x) * 256.0;\nreturn czm_octDecode(vec2(x, y));\n}\nvoid czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)\n{\nfloat temp = encoded.x / 65536.0;\nfloat x = floor(temp);\nfloat encodedFloat1 = (temp - x) * 65536.0;\ntemp = encoded.y / 65536.0;\nfloat y = floor(temp);\nfloat encodedFloat2 = (temp - y) * 65536.0;\nvector1 = czm_octDecode(encodedFloat1);\nvector2 = czm_octDecode(encodedFloat2);\nvector3 = czm_octDecode(vec2(x, y));\n}\n",czm_packDepth:"vec4 czm_packDepth(float depth)\n{\nvec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nenc = fract(enc);\nenc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn enc;\n}\n",czm_phong:"float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\nreturn czm_getLambertDiffuse(lightDirectionEC, material.normal);\n}\nfloat czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\nreturn czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\nvec4 czm_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n}\nfloat specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse * 0.5;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\nvec4 czm_phong(vec3 toEye, czm_material material)\n{\nreturn czm_phong(toEye, material,czm_lightDirectionEC);\n}\nvec4 czm_private_phong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(lightDirectionEC, material);\nfloat specular = czm_private_getSpecularOfMaterial(lightDirectionEC, toEye, material);\nvec3 ambient = vec3(0.0);\nvec3 color = ambient + material.emission;\ncolor += material.diffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\n",czm_planeDistance:"float czm_planeDistance(vec4 plane, vec3 point) {\nreturn (dot(plane.xyz, point) + plane.w);\n}\nfloat czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {\nreturn (dot(planeNormal, point) + planeDistance);\n}\n",czm_pointAlongRay:"vec3 czm_pointAlongRay(czm_ray ray, float time)\n{\nreturn ray.origin + (time * ray.direction);\n}\n",czm_rayEllipsoidIntersectionInterval:"czm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, vec3 ellipsoid_center, vec3 ellipsoid_inverseRadii)\n{\nvec3 q = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\nvec3 w = ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\nq = q - ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ellipsoid_center, 1.0)).xyz;\nfloat q2 = dot(q, q);\nfloat qw = dot(q, w);\nif (q2 > 1.0)\n{\nif (qw >= 0.0)\n{\nreturn czm_emptyRaySegment;\n}\nelse\n{\nfloat qw2 = qw * qw;\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nif (qw2 < product)\n{\nreturn czm_emptyRaySegment;\n}\nelse if (qw2 > product)\n{\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nfloat root0 = temp / w2;\nfloat root1 = difference / temp;\nif (root0 < root1)\n{\nczm_raySegment i = czm_raySegment(root0, root1);\nreturn i;\n}\nelse\n{\nczm_raySegment i = czm_raySegment(root1, root0);\nreturn i;\n}\n}\nelse\n{\nfloat root = sqrt(difference / w2);\nczm_raySegment i = czm_raySegment(root, root);\nreturn i;\n}\n}\n}\nelse if (q2 < 1.0)\n{\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nczm_raySegment i = czm_raySegment(0.0, temp / w2);\nreturn i;\n}\nelse\n{\nif (qw < 0.0)\n{\nfloat w2 = dot(w, w);\nczm_raySegment i = czm_raySegment(0.0, -qw / w2);\nreturn i;\n}\nelse\n{\nreturn czm_emptyRaySegment;\n}\n}\n}\n",czm_readDepth:"float czm_readDepth(sampler2D depthTexture, vec2 texCoords)\n{\nreturn czm_reverseLogDepth(texture2D(depthTexture, texCoords).r);\n}\n",czm_readNonPerspective:"float czm_readNonPerspective(float value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec2 czm_readNonPerspective(vec2 value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec3 czm_readNonPerspective(vec3 value, float oneOverW) {\nreturn value * oneOverW;\n}\nvec4 czm_readNonPerspective(vec4 value, float oneOverW) {\nreturn value * oneOverW;\n}\n",czm_reverseLogDepth:"float czm_reverseLogDepth(float logZ)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nfloat log2Depth = logZ * czm_log2FarDepthFromNearPlusOne;\nfloat depthFromNear = pow(2.0, log2Depth) - 1.0;\nreturn far * (1.0 - near / (depthFromNear + near)) / (far - near);\n#endif\nreturn logZ;\n}\n",czm_RGBToHSB:"const vec4 K_RGB2HSB = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec3 czm_RGBToHSB(vec3 rgb)\n{\nvec4 p = mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));\nvec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));\nfloat d = q.x - min(q.w, q.y);\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);\n}\n",czm_RGBToHSL:"vec3 RGBtoHCV(vec3 rgb)\n{\nvec4 p = (rgb.g < rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);\nvec4 q = (rgb.r < p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);\nfloat c = q.x - min(q.w, q.y);\nfloat h = abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);\nreturn vec3(h, c, q.x);\n}\nvec3 czm_RGBToHSL(vec3 rgb)\n{\nvec3 hcv = RGBtoHCV(rgb);\nfloat l = hcv.z - hcv.y * 0.5;\nfloat s = hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);\nreturn vec3(hcv.x, s, l);\n}\n",czm_RGBToXYZ:"vec3 czm_RGBToXYZ(vec3 rgb)\n{\nconst mat3 RGB2XYZ = mat3(0.4124, 0.2126, 0.0193,\n0.3576, 0.7152, 0.1192,\n0.1805, 0.0722, 0.9505);\nvec3 xyz = RGB2XYZ * rgb;\nvec3 Yxy;\nYxy.r = xyz.g;\nfloat temp = dot(vec3(1.0), xyz);\nYxy.gb = xyz.rg / temp;\nreturn Yxy;\n}\n",czm_rollerShutter:"void czm_rollerShutter(vec2 coord,vec4 region)\n{\nvec2 st = coord / czm_viewport.zw;\nif(st.x < region.x || st.x > region.z){\ndiscard;\n}\nif(st.y < region.y || st.y > region.w){\ndiscard;\n}\n}\n",czm_sampleOctahedralProjection:"vec3 czm_sampleOctahedralProjectionWithFiltering(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod)\n{\ndirection /= dot(vec3(1.0), abs(direction));\nvec2 rev = abs(direction.zx) - vec2(1.0);\nvec2 neg = vec2(direction.x < 0.0 ? rev.x : -rev.x,\ndirection.z < 0.0 ? rev.y : -rev.y);\nvec2 uv = direction.y < 0.0 ? neg : direction.xz;\nvec2 coord = 0.5 * uv + vec2(0.5);\nvec2 pixel = 1.0 / textureSize;\nif (lod > 0.0)\n{\nfloat scale = 1.0 / pow(2.0, lod);\nfloat offset = ((textureSize.y + 1.0) / textureSize.x);\ncoord.x *= offset;\ncoord *= scale;\ncoord.x += offset + pixel.x;\ncoord.y += (1.0 - (1.0 / pow(2.0, lod - 1.0))) + pixel.y * (lod - 1.0) * 2.0;\n}\nelse\n{\ncoord.x *= (textureSize.y / textureSize.x);\n}\n#ifndef OES_texture_float_linear\nvec3 color1 = texture2D(projectedMap, coord + vec2(0.0, pixel.y)).rgb;\nvec3 color2 = texture2D(projectedMap, coord + vec2(pixel.x, 0.0)).rgb;\nvec3 color3 = texture2D(projectedMap, coord + pixel).rgb;\nvec3 color4 = texture2D(projectedMap, coord).rgb;\nvec2 texturePosition = coord * textureSize;\nfloat fu = fract(texturePosition.x);\nfloat fv = fract(texturePosition.y);\nvec3 average1 = mix(color4, color2, fu);\nvec3 average2 = mix(color1, color3, fu);\nvec3 color = mix(average1, average2, fv);\n#else\nvec3 color = texture2D(projectedMap, coord).rgb;\n#endif\nreturn color;\n}\nvec3 czm_sampleOctahedralProjection(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod, float maxLod) {\nfloat currentLod = floor(lod + 0.5);\nfloat nextLod = min(currentLod + 1.0, maxLod);\nvec3 colorCurrentLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, currentLod);\nvec3 colorNextLod = czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, nextLod);\nreturn mix(colorNextLod, colorCurrentLod, nextLod - lod);\n}\n",czm_saturation:"vec3 czm_saturation(vec3 rgb, float adjustment)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 intensity = vec3(dot(rgb, W));\nreturn mix(intensity, rgb, adjustment);\n}\n",czm_shadowDepthCompare:"float czm_sampleShadowMap(samplerCube shadowMap, vec3 d)\n{\nreturn czm_unpackDepth(textureCube(shadowMap, d));\n}\nfloat czm_sampleShadowMap(sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\nreturn texture2D(shadowMap, uv).r;\n#else\nreturn czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\nfloat czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\nfloat czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\n",czm_shadowVisibility:"float czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)\n{\n#ifdef USE_NORMAL_SHADING\n#ifdef USE_NORMAL_SHADING_SMOOTH\nfloat strength = clamp(nDotL / normalShadingSmooth, 0.0, 1.0);\n#else\nfloat strength = step(0.0, nDotL);\n#endif\nvisibility *= strength;\n#endif\nvisibility = max(visibility, darkness);\nreturn visibility;\n}\n#ifdef USE_CUBE_MAP_SHADOW\nfloat czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec3 uvw = shadowParameters.texCoords;\ndepth -= depthBias;\nfloat visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#else\nfloat czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec2 uv = shadowParameters.texCoords;\ndepth -= depthBias;\n#ifdef USE_SOFT_SHADOWS\nvec2 texelStepSize = shadowParameters.texelStepSize;\nfloat radius = 1.0;\nfloat dx0 = -texelStepSize.x * radius;\nfloat dy0 = -texelStepSize.y * radius;\nfloat dx1 = texelStepSize.x * radius;\nfloat dy1 = texelStepSize.y * radius;\nfloat visibility = (\nczm_shadowDepthCompare(shadowMap, uv, depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n) * (1.0 / 9.0);\n#else\nfloat visibility = czm_shadowDepthCompare(shadowMap, uv, depth);\n#endif\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#endif\n",czm_signNotZero:"float czm_signNotZero(float value)\n{\nreturn value >= 0.0 ? 1.0 : -1.0;\n}\nvec2 czm_signNotZero(vec2 value)\n{\nreturn vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n}\nvec3 czm_signNotZero(vec3 value)\n{\nreturn vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));\n}\nvec4 czm_signNotZero(vec4 value)\n{\nreturn vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));\n}\n",czm_sphericalHarmonics:"vec3 czm_sphericalHarmonics(vec3 normal, vec3 coefficients[9])\n{\nconst float c1 = 0.429043;\nconst float c2 = 0.511664;\nconst float c3 = 0.743125;\nconst float c4 = 0.886227;\nconst float c5 = 0.247708;\nvec3 L00 = coefficients[0];\nvec3 L1_1 = coefficients[1];\nvec3 L10 = coefficients[2];\nvec3 L11 = coefficients[3];\nvec3 L2_2 = coefficients[4];\nvec3 L2_1 = coefficients[5];\nvec3 L20 = coefficients[6];\nvec3 L21 = coefficients[7];\nvec3 L22 = coefficients[8];\nfloat x = normal.x;\nfloat y = normal.y;\nfloat z = normal.z;\nreturn c1 * L22 * (x * x - y * y) + c3 * L20 * z * z + c4 * L00 - c5 * L20 +\n2.0 * c1 * (L2_2 * x * y + L21 * x * z + L2_1 * y * z) +\n2.0 * c2 * (L11 * x + L1_1 * y + L10 * z);\n}\n",czm_tangentToEyeSpaceMatrix:"mat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)\n{\nvec3 normal = normalize(normalEC);\nvec3 tangent = normalize(tangentEC);\nvec3 bitangent = normalize(bitangentEC);\nreturn mat3(tangent.x  , tangent.y  , tangent.z,\nbitangent.x, bitangent.y, bitangent.z,\nnormal.x   , normal.y   , normal.z);\n}\n",czm_transformPlane:"vec4 czm_transformPlane(vec4 clippingPlane, mat4 transform) {\nvec3 transformedDirection = normalize((transform * vec4(clippingPlane.xyz, 0.0)).xyz);\nvec3 transformedPosition = (transform * vec4(clippingPlane.xyz * -clippingPlane.w, 1.0)).xyz;\nvec4 transformedPlane;\ntransformedPlane.xyz = transformedDirection;\ntransformedPlane.w = -dot(transformedDirection, transformedPosition);\nreturn transformedPlane;\n}\n",czm_translateRelativeToEye:"vec4 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\nvec3 highDifference = high - czm_encodedCameraPositionMCHigh;\nvec3 lowDifference = low - czm_encodedCameraPositionMCLow;\nreturn vec4(highDifference + lowDifference, 1.0);\n}\n",czm_translucentPhong:"vec4 czm_translucentPhong(vec3 toEye, czm_material material, vec3 lightDirectionEC)\n{\nfloat diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n}\ndiffuse = clamp(diffuse, 0.0, 1.0);\nfloat specular = czm_getSpecular(lightDirectionEC, toEye, material.normal, material.shininess);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse * czm_lightColor;\ncolor += material.specular * specular * czm_lightColor;\nreturn vec4(color, material.alpha);\n}\nvec4 czm_translucentPhong(vec3 toEye, czm_material material)\n{\nreturn czm_translucentPhong(toEye, material, czm_lightDirectionEC);\n}\n",czm_transpose:"mat2 czm_transpose(mat2 matrix)\n{\nreturn mat2(\nmatrix[0][0], matrix[1][0],\nmatrix[0][1], matrix[1][1]);\n}\nmat3 czm_transpose(mat3 matrix)\n{\nreturn mat3(\nmatrix[0][0], matrix[1][0], matrix[2][0],\nmatrix[0][1], matrix[1][1], matrix[2][1],\nmatrix[0][2], matrix[1][2], matrix[2][2]);\n}\nmat4 czm_transpose(mat4 matrix)\n{\nreturn mat4(\nmatrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\nmatrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\nmatrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\nmatrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\n",czm_unpackDepth:"float czm_unpackDepth(vec4 packedDepth)\n{\nreturn dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n}\n",czm_unpackFloat:"#define SHIFT_RIGHT_8 0.00390625 //1.0 / 256.0\n#define SHIFT_RIGHT_16 0.00001525878 //1.0 / 65536.0\n#define SHIFT_RIGHT_24 5.960464477539063e-8//1.0 / 16777216.0\n#define BIAS 38.0\nfloat czm_unpackFloat(vec4 packedFloat)\n{\npackedFloat *= 255.0;\nfloat temp = packedFloat.w / 2.0;\nfloat exponent = floor(temp);\nfloat sign = (temp - exponent) * 2.0;\nexponent = exponent - float(BIAS);\nsign = sign * 2.0 - 1.0;\nsign = -sign;\nfloat unpacked = sign * packedFloat.x * float(SHIFT_RIGHT_8);\nunpacked += sign * packedFloat.y * float(SHIFT_RIGHT_16);\nunpacked += sign * packedFloat.z * float(SHIFT_RIGHT_24);\nreturn unpacked * pow(10.0, exponent);\n}\n",czm_vertexLogDepth:"#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#ifdef SHADOW_MAP\nvarying vec3 v_logPositionEC;\n#endif\n#endif\nvec4 czm_updatePositionDepth(vec4 coords) {\n#if defined(LOG_DEPTH)\n#ifdef SHADOW_MAP\nvec3 logPositionEC = (czm_inverseProjection * coords).xyz;\nv_logPositionEC = logPositionEC;\n#endif\ncoords.z = clamp(coords.z / coords.w, -1.0, 1.0) * coords.w;\n#endif\nreturn coords;\n}\nvoid czm_vertexLogDepth()\n{\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = (gl_Position.w - czm_currentFrustum.x) + 1.0;\ngl_Position = czm_updatePositionDepth(gl_Position);\n#endif\n}\nvoid czm_vertexLogDepth(vec4 clipCoords)\n{\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = (clipCoords.w - czm_currentFrustum.x) + 1.0;\nczm_updatePositionDepth(clipCoords);\n#endif\n}\n",czm_windowToEyeCoordinates:"vec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\nfloat x = 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\nfloat y = 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\nfloat z = (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nvec4 q = vec4(x, y, z, 1.0);\nq /= fragmentCoordinate.w;\nif (!(czm_inverseProjection == mat4(0.0)))\n{\nq = czm_inverseProjection * q;\n}\nelse\n{\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nq.x = (q.x * (right - left) + left + right) * 0.5;\nq.y = (q.y * (top - bottom) + bottom + top) * 0.5;\nq.z = (q.z * (near - far) - near - far) * 0.5;\nq.w = 1.0;\n}\nreturn q;\n}\nvec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nfloat log2Depth = depthOrLogDepth * czm_log2FarDepthFromNearPlusOne;\nfloat depthFromNear = pow(2.0, log2Depth) - 1.0;\nfloat depthFromCamera = depthFromNear + near;\nvec4 windowCoord = vec4(fragmentCoordinateXY, far * (1.0 - near / depthFromCamera) / (far - near), 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\neyeCoordinate.w = 1.0 / depthFromCamera;\nreturn eyeCoordinate;\n#else\nvec4 windowCoord = vec4(fragmentCoordinateXY, depthOrLogDepth, 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\n#endif\nreturn eyeCoordinate;\n}\n",czm_writeDepthClampedToFarPlane:"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvoid czm_writeDepthClampedToFarPlane()\n{\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\ngl_FragDepthEXT = min(v_WindowZ * gl_FragCoord.w, 1.0);\n#endif\n}\n",czm_writeLogDepth:"#ifdef LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#ifdef POLYGON_OFFSET\nuniform vec2 u_polygonOffset;\n#endif\n#endif\nvoid czm_writeLogDepth(float depth)\n{\n#if defined(GL_EXT_frag_depth) && defined(LOG_DEPTH)\nif (depth <= 0.9999999 || depth > czm_farDepthFromNearPlusOne) {\ndiscard;\n}\n#ifdef POLYGON_OFFSET\nfloat factor = u_polygonOffset[0];\nfloat units = u_polygonOffset[1];\n#ifdef GL_OES_standard_derivatives\nfloat x = dFdx(depth);\nfloat y = dFdy(depth);\nfloat m = sqrt(x * x + y * y);\ndepth += m * factor;\n#endif\n#endif\ngl_FragDepthEXT = log2(depth) * czm_oneOverLog2FarDepthFromNearPlusOne;\n#ifdef POLYGON_OFFSET\ngl_FragDepthEXT += czm_epsilon7 * units;\n#endif\n#endif\n}\nvoid czm_writeLogDepth() {\n#ifdef LOG_DEPTH\nczm_writeLogDepth(v_depthFromNearPlusOne);\n#endif\n}\n",czm_writeNonPerspective:"float czm_writeNonPerspective(float value, float w) {\nreturn value * w;\n}\nvec2 czm_writeNonPerspective(vec2 value, float w) {\nreturn value * w;\n}\nvec3 czm_writeNonPerspective(vec3 value, float w) {\nreturn value * w;\n}\nvec4 czm_writeNonPerspective(vec4 value, float w) {\nreturn value * w;\n}\n",czm_XYZToRGB:"vec3 czm_XYZToRGB(vec3 Yxy)\n{\nconst mat3 XYZ2RGB = mat3( 3.2405, -0.9693,  0.0556,\n-1.5371,  1.8760, -0.2040,\n-0.4985,  0.0416,  1.0572);\nvec3 xyz;\nxyz.r = Yxy.r * Yxy.g / Yxy.b;\nxyz.g = Yxy.r;\nxyz.b = Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;\nreturn XYZ2RGB * xyz;\n}\n"},ro=new si;function ao(e){this._size=e.size,this._datatype=e.datatype,this.getValue=e.getValue}var oo={};oo[Qa.FLOAT]="float",oo[Qa.FLOAT_VEC2]="vec2",oo[Qa.FLOAT_VEC3]="vec3",oo[Qa.FLOAT_VEC4]="vec4",oo[Qa.INT]="int",oo[Qa.INT_VEC2]="ivec2",oo[Qa.INT_VEC3]="ivec3",oo[Qa.INT_VEC4]="ivec4",oo[Qa.BOOL]="bool",oo[Qa.BOOL_VEC2]="bvec2",oo[Qa.BOOL_VEC3]="bvec3",oo[Qa.BOOL_VEC4]="bvec4",oo[Qa.FLOAT_MAT2]="mat2",oo[Qa.FLOAT_MAT3]="mat3",oo[Qa.FLOAT_MAT4]="mat4",oo[Qa.SAMPLER_2D]="sampler2D",oo[Qa.SAMPLER_CUBE]="samplerCube",ao.prototype.getDeclaration=function(e){var t="uniform "+oo[this._datatype]+" "+e,i=this._size;return t+=1===i?";":"["+i.toString()+"];"};var so,uo={czm_viewport:new ao({size:1,datatype:Qa.FLOAT_VEC4,getValue:function(e){return e.viewportCartesian4}}),czm_viewportOrthographic:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.viewportOrthographic}}),czm_viewportTransformation:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.viewportTransformation}}),czm_globeDepthTexture:new ao({size:1,datatype:Qa.SAMPLER_2D,getValue:function(e){return e.globeDepthTexture}}),czm_model:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.model}}),czm_inverseModel:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseModel}}),czm_view:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.view}}),czm_view3D:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.view3D}}),czm_viewRotation:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.viewRotation}}),czm_viewRotation3D:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.viewRotation3D}}),czm_inverseView:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseView}}),czm_inverseView3D:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseView3D}}),czm_inverseViewRotation:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation}}),czm_inverseViewRotation3D:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.inverseViewRotation3D}}),czm_projection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.projection}}),czm_inverseProjection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseProjection}}),czm_infiniteProjection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.infiniteProjection}}),czm_modelView:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.modelView}}),czm_modelView3D:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.modelView3D}}),czm_modelViewRelativeToEye:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.modelViewRelativeToEye}}),czm_inverseModelView:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseModelView}}),czm_inverseModelView3D:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseModelView3D}}),czm_viewProjection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.viewProjection}}),czm_inverseViewProjection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseViewProjection}}),czm_modelViewProjection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.modelViewProjection}}),czm_inverseModelViewProjection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new ao({size:1,datatype:Qa.FLOAT_MAT4,getValue:function(e){return e.modelViewInfiniteProjection}}),czm_orthographicIn3D:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.orthographicIn3D?1:0}}),czm_normal:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.normal}}),czm_normal3D:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.normal3D}}),czm_inverseNormal:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.inverseNormal}}),czm_inverseNormal3D:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.inverseNormal3D}}),czm_eyeHeight:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.eyeHeight}}),czm_eyeHeight2D:new ao({size:1,datatype:Qa.FLOAT_VEC2,getValue:function(e){return e.eyeHeight2D}}),czm_entireFrustum:new ao({size:1,datatype:Qa.FLOAT_VEC2,getValue:function(e){return e.entireFrustum}}),czm_currentFrustum:new ao({size:1,datatype:Qa.FLOAT_VEC2,getValue:function(e){return e.currentFrustum}}),czm_frustumPlanes:new ao({size:1,datatype:Qa.FLOAT_VEC4,getValue:function(e){return e.frustumPlanes}}),czm_farDepthFromNearPlusOne:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.farDepthFromNearPlusOne}}),czm_log2FarDepthFromNearPlusOne:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.log2FarDepthFromNearPlusOne}}),czm_oneOverLog2FarDepthFromNearPlusOne:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.oneOverLog2FarDepthFromNearPlusOne}}),czm_sunPositionWC:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.sunPositionWC}}),czm_sunPositionColumbusView:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.sunPositionColumbusView}}),czm_sunDirectionEC:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.sunDirectionEC}}),czm_sunDirectionWC:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.sunDirectionWC}}),czm_moonDirectionEC:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.moonDirectionEC}}),czm_lightDirectionEC:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.lightDirectionEC}}),czm_lightDirectionWC:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.lightDirectionWC}}),czm_lightColor:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.lightColor}}),czm_lightColorHdr:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.lightColorHdr}}),czm_encodedCameraPositionMCHigh:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return Rn.getTranslation(e.inverseView,ro)}}),czm_frameNumber:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.frameState.frameNumber}}),czm_morphTime:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.frameState.morphTime}}),czm_sceneMode:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.frameState.mode}}),czm_pass:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.pass}}),czm_backgroundColor:new ao({size:1,datatype:Qa.FLOAT_VEC4,getValue:function(e){return e.backgroundColor}}),czm_brdfLut:new ao({size:1,datatype:Qa.SAMPLER_2D,getValue:function(e){return e.brdfLut}}),czm_environmentMap:new ao({size:1,datatype:Qa.SAMPLER_CUBE,getValue:function(e){return e.environmentMap}}),czm_specularEnvironmentMaps:new ao({size:1,datatype:Qa.SAMPLER_2D,getValue:function(e){return e.specularEnvironmentMaps}}),czm_specularEnvironmentMapSize:new ao({size:1,datatype:Qa.FLOAT_VEC2,getValue:function(e){return e.specularEnvironmentMapsDimensions}}),czm_specularEnvironmentMapsMaximumLOD:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.specularEnvironmentMapsMaximumLOD}}),czm_sphericalHarmonicCoefficients:new ao({size:9,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.sphericalHarmonicCoefficients}}),czm_temeToPseudoFixed:new ao({size:1,datatype:Qa.FLOAT_MAT3,getValue:function(e){return e.temeToPseudoFixedMatrix}}),czm_pixelRatio:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.pixelRatio}}),czm_fogDensity:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.fogDensity}}),czm_imagerySplitPosition:new ao({size:1,datatype:Qa.FLOAT_VEC2,getValue:function(e){return e.imagerySplitPosition}}),czm_geometricToleranceOverMeter:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new ao({size:1,datatype:Qa.FLOAT_VEC4,getValue:function(e){return e.invertClassificationColor}}),czm_gamma:new ao({size:1,datatype:Qa.FLOAT,getValue:function(e){return e.gamma}}),czm_ellipsoidRadii:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.radii}}),czm_ellipsoidInverseRadii:new ao({size:1,datatype:Qa.FLOAT_VEC3,getValue:function(e){return e.ellipsoid.oneOverRadii}})};function lo(e){return(e=e.replace(/\/\/.*/g,"")).replace(/\/\*\*[\s\S]*?\*\//gm,function(e){for(var t=e.match(/\n/gm).length,i="",n=0;n<t;++n)i+="\n";return i})}function co(e,t,i){for(var n,r=0;r<i.length;++r)i[r].name===e&&(n=i[r]);return oe(n)||(n={name:e,glslSource:t=lo(t),dependsOn:[],requiredBy:[],evaluated:!1},i.push(n)),n}function mo(e){var t=[],i=co("main",e,t);!function i(n,r){var a;n.evaluated||(n.evaluated=!0,oe(a=n.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g))&&null!==a&&(a=a.filter(function(e,t){return a.indexOf(e)===t})).forEach(function(e){var t;e!==n.name&&fo._czmBuiltinsAndUniforms.hasOwnProperty(e)&&(t=co(e,fo._czmBuiltinsAndUniforms[e],r),n.dependsOn.push(t),t.requiredBy.push(n),i(t,r))}))}(i,t),function(e){for(var t=[],i=[];0<e.length;){var n=e.pop();i.push(n),0===n.requiredBy.length&&t.push(n)}for(;0<t.length;){var r=t.shift();e.push(r);for(var a=0;a<r.dependsOn.length;++a){var o=r.dependsOn[a],s=o.requiredBy.indexOf(r);o.requiredBy.splice(s,1),0===o.requiredBy.length&&t.push(o)}}for(var u=0;u<i.length;++u)i[u].requiredBy.length}(t);for(var n="",r=t.length-1;0<=r;--r)n=n+t[r].glslSource+"\n";return n.replace(i.glslSource,"")}function ho(e,t,i){var n,r,a="",o=e.sources;if(oe(o))for(m=0,n=o.length;m<n;++m)a+="\n#line 0\n"+o[m];a=(a=lo(a)).replace(/#version\s+(.*?)\n/gm,function(e,t){return r=t,"\n"});var s=[];a=(a=a.replace(/#extension.*\n/gm,function(e){return s.push(e),"\n"})).replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");var u=e.pickColorQualifier;oe(u)&&(a=fo.createPickFragmentShaderSource(a,u));var l="";oe(r)&&(l="#version "+r+"\n");for(var c=s.length,m=0;m<c;m++)l+=s[m];t&&(l+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n#else\n    precision mediump float;\n#endif\n\n");var d=e.defines;if(oe(d))for(m=0,n=d.length;m<n;++m){var h=d[m];0!==h.length&&(l+="#define "+h+"\n")}return i.webgl2&&(l+="#define OUTPUT_DECLARATION\n\n"),i.textureFloatLinear&&(l+="#define OES_texture_float_linear\n\n"),e.includeBuiltIns&&(l+=mo(a)),l+="\n#line 0\n",l+=a,i.webgl2&&(l=$a(l,t)),l}function fo(e){var t=(e=z(e,z.EMPTY_OBJECT)).pickColorQualifier;this.defines=oe(e.defines)?e.defines.slice(0):[],this.sources=oe(e.sources)?e.sources.slice(0):[],this.pickColorQualifier=t,this.includeBuiltIns=z(e.includeBuiltIns,!0)}for(var po in fo.prototype.clone=function(){return new fo({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})},fo.replaceMain=function(e,t){return t="void "+t+"()",e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)},fo.prototype.createCombinedVertexShader=function(e){return ho(this,!1,e)},fo.prototype.createCombinedFragmentShader=function(e){return ho(this,!0,e)},fo._czmBuiltinsAndUniforms={},no)no.hasOwnProperty(po)&&(fo._czmBuiltinsAndUniforms[po]=no[po]);for(var _o in uo){!uo.hasOwnProperty(_o)||"function"==typeof(so=uo[_o]).getDeclaration&&(fo._czmBuiltinsAndUniforms[_o]=so.getDeclaration(_o))}fo.createPickVertexShaderSource=function(e){return fo.replaceMain(e,"czm_old_main")+"\nattribute vec4 pickColor; \nvarying vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    czm_pickColor = pickColor; \n}"},fo.createPickFragmentShaderSource=function(e,t){return fo.replaceMain(e,"czm_old_main")+"\n"+(t+" vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    if (gl_FragColor.a == 0.0) { \n       discard; \n    } \n    gl_FragColor = czm_pickColor; \n}")},fo.findVarying=function(e,t){for(var i=e.sources,n=t.length,r=0;r<n;++r)for(var a=t[r],o=i.length,s=0;s<o;++s)if(-1!==i[s].indexOf(a))return a};var Co=["v_normalEC","v_normal"];fo.findNormalVarying=function(e){return fo.findVarying(e,Co)};var go=["v_positionEC"];fo.findPositionVarying=function(e){return fo.findVarying(e,go)};var vo=Object.freeze({SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"}),yo={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:Rn.fromRotationTranslation(pi.fromRotationX(ri.PI_OVER_TWO)),Z_UP_TO_Y_UP:Rn.fromRotationTranslation(pi.fromRotationX(-ri.PI_OVER_TWO)),X_UP_TO_Z_UP:Rn.fromRotationTranslation(pi.fromRotationY(-ri.PI_OVER_TWO)),Z_UP_TO_X_UP:Rn.fromRotationTranslation(pi.fromRotationY(ri.PI_OVER_TWO)),X_UP_TO_Y_UP:Rn.fromRotationTranslation(pi.fromRotationZ(ri.PI_OVER_TWO)),Y_UP_TO_X_UP:Rn.fromRotationTranslation(pi.fromRotationZ(-ri.PI_OVER_TWO)),fromName:function(e){return yo[e]}},To=Object.freeze(yo),xo={updateForwardAxis:function(e){var t=e.gltf.extras.sourceVersion;(oe(t)&&"2.0"!==t||"2.0"!==xo.getAssetVersion(e.gltf))&&(e._gltfForwardAxis=To.X)},getAssetVersion:function(e){return oe(e.asset)&&oe(e.asset.version)?e.asset.version:"1.0"}};xo.splitIncompatibleMaterials=function(e){var _=e.accessors,C=e.materials,g={};return er.mesh(e,function(e){er.meshPrimitive(e,function(e){var t,i,n,r=e.material,a=C[r],o=e.attributes.JOINTS_0;oe(o)&&(i=(t=_[o]).componentType,n=t.type);var s,u=oe(o),l=oe(e.attributes.COLOR_0),c=oe(e.targets),m=oe(e.attributes.NORMAL),d=oe(e.attributes.TANGENT),h=oe(e.attributes.TEXCOORD_0),f=oe(e.extensions)&&oe(e.extensions.CESIUM_primitive_outline),p=g[r];oe(p)?p.skinning.skinned===u&&p.skinning.type===n&&p.hasVertexColors===l&&p.hasMorphTargets===c&&p.hasNormals===m&&p.hasTangents===d&&p.hasTexCoords===h&&p.hasOutline===f||(s=D(a,!0),r=function(e,t,i){if(i=z(i,!1)){var n=e.indexOf(t);if(-1<n)return n}return e.push(t),e.length-1}(C,s),e.material=r,g[r]={skinning:{skinned:u,componentType:i,type:n},hasVertexColors:l,hasMorphTargets:c,hasNormals:m,hasTangents:d,hasTexCoords:h,hasOutline:f}):g[r]={skinning:{skinned:u,componentType:i,type:n},hasVertexColors:l,hasMorphTargets:c,hasNormals:m,hasTangents:d,hasTexCoords:h,hasOutline:f}})}),g},xo.getShaderVariable=function(e){return"SCALAR"===e?"float":e.toLowerCase()},xo.ModelState={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},xo.getFailedLoadFunction=function(i,n,r){return function(e){i._state=xo.ModelState.FAILED;var t="Failed to load "+n+": "+r;oe(e)&&(t+="\n"+e.message),i._readyPromise.reject(new ue(t))}},xo.parseBuffers=function(n,r){var a=n._loadResources;er.buffer(n.gltf,function(e,t){var i;oe(e.extras._pipeline.source)?a.buffers[t]=e.extras._pipeline.source:oe(r)&&(i=n._resource.getDerivedResource({url:e.uri}),++a.pendingBufferLoads,i.fetchArrayBuffer().then(r(n,t)).otherwise(xo.getFailedLoadFunction(n,"buffer",i.url)))})};var wo=new si,Ao=new si;function Eo(e,i){return er.techniqueAttribute(e,function(e,t){if(e.semantic===i)return t})}function So(e,n,r,a){return $n(e,"KHR_techniques_webgl")?function(e,t){if(!(e.semantic!==r||a&&oe(e.node)))return t}:function(e,t){var i=n.parameters[e];if(!(i.semantic!==r||a&&oe(i.node)))return t}}xo.computeBoundingSphere=function(e){for(var t=e.gltf,i=t.nodes,n=t.meshes,r=t.scenes[t.scene].nodes,a=r.length,o=[],s=new si(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new si(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=0;l<a;++l){var c=i[r[l]];for(c._transformToRoot=xo.getTransform(c),o.push(c);0<o.length;){var m=(c=o.pop())._transformToRoot,d=c.mesh;if(oe(d))for(var h=n[d].primitives,f=h.length,p=0;p<f;++p){var _,C,g,v=h[p].attributes.POSITION;!oe(v)||oe((_=xo.getAccessorMinMax(t,v)).min)&&oe(_.max)&&(C=si.fromArray(_.min,0,wo),g=si.fromArray(_.max,0,Ao),oe(s)&&oe(u)&&(Rn.multiplyByPoint(m,C,C),Rn.multiplyByPoint(m,g,g),si.minimumByComponent(s,C,s),si.maximumByComponent(u,g,u)))}var y=c.children;if(oe(y))for(var T=y.length,x=0;x<T;++x){var w=i[y[x]];w._transformToRoot=xo.getTransform(w),Rn.multiplyTransformation(m,w._transformToRoot,w._transformToRoot),o.push(w)}delete c._transformToRoot}}var A=Rr.fromCornerPoints(s,u);return e._forwardAxis===To.Z&&Rr.transformWithoutScale(A,To.Z_UP_TO_X_UP,A),e._upAxis===To.Y?Rr.transformWithoutScale(A,To.Y_UP_TO_Z_UP,A):e._upAxis===To.X&&Rr.transformWithoutScale(A,To.X_UP_TO_Z_UP,A),A},xo.ensureSemanticExistence=function(t){return er.mesh(t,function(e){er.meshPrimitive(e,function(e){!function(e,t){var i=e.accessors,n=e.materials,r=e.extensions.KHR_techniques_webgl,a=r.techniques,o=r.programs,s=r.shaders,u=t.targets,l=t.attributes;for(var c in u)if(u.hasOwnProperty(c)){var m=u[c];for(var d in m)"extras"!==d&&(l[d+"_"+c]=m[d])}var h,f,p,_,C,g=a[n[t.material].extensions.KHR_techniques_webgl.technique],v=s[o[g.program].vertexShader];for(var y in l){l.hasOwnProperty(y)&&(oe(Eo(g,y))||(h=i[l[y]],"_"===(f=y.toLowerCase()).charAt(0)&&(f=f.slice(1)),p="a_"+f,g.attributes[p]={semantic:y,type:h.componentType},C=(_=v.extras._pipeline).source,C="attribute "+xo.getShaderVariable(h.type)+" "+p+";\n"+C,_.source=C))}}(t,e)})}),t},xo.createAttributeLocations=function(e,t){var i={},n=!1,r=1;if(er.techniqueAttribute(e,function(e,t){/pos/i.test(t)&&!n?(i[t]=0,n=!0):i[t]=r++}),oe(t))for(var a in t)t.hasOwnProperty(a)&&(i[a]=r++);return i},xo.getAccessorMinMax=function(e,t){var i,n=e.accessors[t],r=n.extensions,a=n.min,o=n.max;return!oe(r)||oe(i=r.WEB3D_quantized_attributes)&&(a=i.decodedMin,o=i.decodedMax),{min:a,max:o}},xo.getAttributeOrUniformBySemantic=function(i,n,r,a){return er.technique(i,function(e){if(!oe(r)||e.program===r){var t=er.techniqueAttribute(e,So(i,e,n,a));return oe(t)?t:er.techniqueUniform(e,So(i,e,n,a))}})},xo.getDiffuseAttributeOrUniform=function(e,t){var i=xo.getAttributeOrUniformBySemantic(e,"COLOR_0",t);return oe(i)||(i=xo.getAttributeOrUniformBySemantic(e,"_3DTILESDIFFUSE",t)),i};var bo=new si,Mo=new xa,Ro=new si;function Do(e,t,i){t+="(?!\\w)",t=new RegExp(t,"g");var n=e.search(t);return e.replace(t,function(e,t){return n===t?e:i})}function Po(e,t){var i=e.accessors[t].extensions;if(oe(i))return i.WEB3D_quantized_attributes}function Io(e,t,i){var n=t.material,r=e.materials[n];if($n(e,"KHR_techniques_webgl")&&oe(r.extensions)&&oe(r.extensions.KHR_techniques_webgl)){var a=r.extensions.KHR_techniques_webgl.technique,o=e.extensions.KHR_techniques_webgl.techniques[a];return er.techniqueAttribute(o,function(e,t){if(e.semantic===i)return t})}}function Oo(e){var t={value:e,clone:function(e,t){return e},func:function(){return t.value}};return t}function Lo(e){var t={value:ha.fromArray(e),clone:ha.clone,func:function(){return t.value}};return t}function No(e){var t={value:si.fromArray(e),clone:si.clone,func:function(){return t.value}};return t}function Bo(e){var t={value:An.fromArray(e),clone:An.clone,func:function(){return t.value}};return t}function zo(e){var t={value:va.fromColumnMajorArray(e),clone:va.clone,func:function(){return t.value}};return t}function Fo(e){var t={value:pi.fromColumnMajorArray(e),clone:pi.clone,func:function(){return t.value}};return t}function Vo(e){var t={value:Rn.fromColumnMajorArray(e),clone:Rn.clone,func:function(){return t.value}};return t}function Uo(e,t,i){this._value=void 0,this._textureId=e.index,this._textures=t,this._defaultTexture=i}xo.getTransform=function(e,t){return oe(e.matrix)?Rn.fromColumnMajorArray(e.matrix,t):Rn.fromTranslationQuaternionRotationScale(si.fromArray(e.translation,0,bo),xa.unpack(e.rotation,0,Mo),si.fromArray(e.scale,0,Ro),t)},xo.getUsedExtensions=function(e){var t=e.extensionsUsed,i={};if(oe(t))for(var n=t.length,r=0;r<n;r++){i[t[r]]=!0}return i},xo.getRequiredExtensions=function(e){var t=e.extensionsRequired,i={};if(oe(t))for(var n=t.length,r=0;r<n;r++){i[t[r]]=!0}return i},xo.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0},xo.checkSupportedExtensions=function(e,t){for(var i in e)if(e.hasOwnProperty(i)){if(!xo.supportedExtensions[i])throw new ue("Unsupported glTF Extension: "+i);if("EXT_texture_webp"===i&&!1===t)throw new ue("Loaded model requires WebP but browser does not support it.")}},xo.checkSupportedGlExtensions=function(e,t){if(oe(e))for(var i=e.length,n=0;n<i;n++){var r=e[n];if("OES_element_index_uint"!==r)throw new ue("Unsupported WebGL Extension: "+r);if(!t.elementIndexUint)throw new ue("OES_element_index_uint WebGL extension is not enabled.")}},xo.modifyShaderForDracoQuantizedAttributes=function(e,t,i,n){var r={};for(var a in n)if(n.hasOwnProperty(a)){var o=n[a],s=o.quantization;if(!oe(s))continue;var u=Io(e,t,a);if(!oe(u))continue;"_"===a.charAt(0)&&(a=a.substring(1));var l,c,m,d,h,f,p,_,C,g="gltf_u_dec_"+a.toLowerCase();oe(r[g])||(l="gltf_decoded_"+a,c=u.replace("a_","gltf_a_dec_"),m=o.componentsPerAttribute,i=Do(i,u,c),i=(d=s.octEncoded?"vec3":1<m?"vec"+m:"float")+" "+c+";\n"+i,(h=3===m&&"COLOR_0"===a)&&(i=Do(i,c,"vec4("+c+", 1.0)")),C="",C=s.octEncoded?(i="uniform float "+(f=g+"_rangeConstant")+";\n"+i,"\nvoid main() {\n    "+c+" = czm_octDecode("+u+".xy, "+f+").zxy;\n    "+l+"();\n}\n"):(i="uniform float "+(p=g+"_normConstant")+";\nuniform "+d+" "+(_=g+"_min")+";\n"+i,"\nvoid main() {\n    "+c+" = "+_+" + "+u+(h?".xyz":"")+" * "+p+";\n    "+l+"();\n}\n"),i=fo.replaceMain(i,l),i+=C)}return{shader:i}},xo.modifyShaderForQuantizedAttributes=function(e,t,i){var n,r,a,o,s,u,l,c,m,d,h,f,p={},_=t.attributes;for(var C in _){_.hasOwnProperty(C)&&(n=Io(e,t,C),r=t.attributes[C],"_"===C.charAt(0)&&(C=C.substring(1)),o=(a="gltf_u_dec_"+C.toLowerCase())+"_scale",s=a+"_translate",oe(p[a])||oe(p[o])||oe(u=Po(e,r))&&(l=u.decodeMatrix,c="gltf_decoded_"+C,m=n.replace("a_","gltf_a_dec_"),i=(h=2<(d=Math.floor(Math.sqrt(l.length)))?"vec"+(d-1):"float")+" "+m+";\n"+(i=Do(i,n,m)),f="",5===d?(i="uniform vec4 "+s+";\n"+(i="uniform mat4 "+o+";\n"+i),f="\nvoid main() {\n    "+m+" = "+o+" * "+n+" + "+s+";\n    "+c+"();\n}\n",p[o]={mat:4},p[s]={vec:4}):(i="uniform mat"+d+" "+a+";\n"+i,f="\nvoid main() {\n    "+m+" = "+h+"("+a+" * vec"+d+"("+n+",1.0));\n    "+c+"();\n}\n",p[a]={mat:d}),i=fo.replaceMain(i,c),i+=f))}return{shader:i,uniforms:p}},xo.toClipCoordinatesGLSL=function(e,t){var i=xo.getAttributeOrUniformBySemantic(e,"POSITION"),n=i.replace("a_","gltf_a_dec_");-1!==t.indexOf(n)&&(i=n);var r,a,o=xo.getAttributeOrUniformBySemantic(e,"MODELVIEWPROJECTION",void 0,!0);return oe(o)&&-1!==t.indexOf(o)||(r=xo.getAttributeOrUniformBySemantic(e,"PROJECTION",void 0,!0),a=xo.getAttributeOrUniformBySemantic(e,"MODELVIEW",void 0,!0),-1!==t.indexOf("czm_instanced_modelView ")?a="czm_instanced_modelView":oe(a)||(a=xo.getAttributeOrUniformBySemantic(e,"CESIUM_RTC_MODELVIEW",void 0,!0)),o=r+" * "+a),o+" * vec4("+i+".xyz, 1.0)"},xo.modifyFragmentShaderForLogDepth=function(e){return e=fo.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"},xo.modifyFragmentShaderForLogDepthAddRoller=function(e){return e=fo.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_rollerShutter(gl_FragCoord.xy,u_rollerRegion); \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"},xo.modifyVertexShaderForLogDepth=function(e,t){return e=fo.replaceMain(e,"czm_depth_main"),e+="\nvoid main() \n{ \n    czm_depth_main(); \n    czm_vertexLogDepth("+t+"); \n} \n"},Object.defineProperties(Uo.prototype,{value:{get:function(){if(!oe(this._value)){var e=this._textures[this._textureId];if(!oe(e))return this._defaultTexture;this._value=e}return this._value},set:function(e){this._value=e}}}),Uo.prototype.clone=function(e){return e},Uo.prototype.func=void 0;var Go={};Go[Qa.FLOAT]=Oo,Go[Qa.FLOAT_VEC2]=Lo,Go[Qa.FLOAT_VEC3]=No,Go[Qa.FLOAT_VEC4]=Bo,Go[Qa.INT]=Oo,Go[Qa.INT_VEC2]=Lo,Go[Qa.INT_VEC3]=No,Go[Qa.INT_VEC4]=Bo,Go[Qa.BOOL]=Oo,Go[Qa.BOOL_VEC2]=Lo,Go[Qa.BOOL_VEC3]=No,Go[Qa.BOOL_VEC4]=Bo,Go[Qa.FLOAT_MAT2]=zo,Go[Qa.FLOAT_MAT3]=Fo,Go[Qa.FLOAT_MAT4]=Vo,Go[Qa.SAMPLER_2D]=function(e,t,i){var n=new Uo(e,t,i);return n.func=function(){return n.value},n},xo.createUniformFunction=function(e,t,i,n){return Go[e](t,i,n)},xo.createUniformsForDracoQuantizedAttributes=function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=n.quantization;if(!oe(r))continue;"_"===i.charAt(0)&&(i=i.substring(1));var a="gltf_u_dec_"+i.toLowerCase();if(r.octEncoded){var o=a+"_rangeConstant",s=(1<<r.quantizationBits)-1;t[o]=Oo(s).func;continue}var u=a+"_normConstant",l=r.range/(1<<r.quantizationBits);t[u]=Oo(l).func;var c=a+"_min";switch(n.componentsPerAttribute){case 1:t[c]=Oo(r.minValues).func;break;case 2:t[c]=Lo(r.minValues).func;break;case 3:t[c]=No(r.minValues).func;break;case 4:t[c]=Bo(r.minValues).func}}return t},xo.createUniformsForQuantizedAttributes=function(e,t,i){var n,r,a,o=e.accessors,s={},u={},l=t.attributes;for(var c in l)if(l.hasOwnProperty(c)){var m=o[l[c]],d=m.extensions;if("_"===c.charAt(0)&&(c=c.substring(1)),oe(d)){var h=d.WEB3D_quantized_attributes;if(oe(h)){var f=h.decodeMatrix,p="gltf_u_dec_"+c.toLowerCase();switch(m.type){case vo.SCALAR:u[p]=zo(f).func,s[p]=!0;break;case vo.VEC2:u[p]=Fo(f).func,s[p]=!0;break;case vo.VEC3:u[p]=Vo(f).func,s[p]=!0;break;case vo.VEC4:var _=p+"_scale",C=p+"_translate";u[_]=Vo([(r=f)[0],r[1],r[2],r[3],r[5],r[6],r[7],r[8],r[10],r[11],r[12],r[13],r[15],r[16],r[17],r[18]]).func,u[C]=Bo([(n=f)[20],n[21],n[22],n[23]]).func,s[_]=!0,s[C]=!0}}}}for(var g in i){i.hasOwnProperty(g)&&(s[g]||(oe((a=i[g]).mat)&&(2===a.mat?u[g]=zo(va.IDENTITY).func:3===a.mat?u[g]=Fo(pi.IDENTITY).func:4===a.mat&&(u[g]=Vo(Rn.IDENTITY).func)),oe(a.vec)&&4===a.vec&&(u[g]=Bo([0,0,0,0]).func)))}return u};var ko=new si,Ho={MODEL:function(e,t){return function(){return e.model}},VIEW:function(e,t){return function(){return e.view}},PROJECTION:function(e,t){return function(){return e.projection}},MODELVIEW:function(e,t){return function(){return e.modelView}},CESIUM_RTC_MODELVIEW:function(e,t){var i=new Rn;return function(){return oe(t._rtcCenter)?(Rn.getTranslation(e.model,ko),si.add(ko,t._rtcCenter,ko),Rn.multiplyByPoint(e.view,ko,ko),Rn.setTranslation(e.modelView,ko,i)):e.modelView}},MODELVIEWPROJECTION:function(e,t){return function(){return e.modelViewProjection}},MODELINVERSE:function(e,t){return function(){return e.inverseModel}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t){return function(){return e.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(e,t){return function(){return e.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(e,t){return function(){return e.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(e,t){return function(){return e.normal}},VIEWPORT:function(e,t){return function(){return e.viewportCartesian4}}};function Wo(){this._array=[],this._hash={}}function qo(e){this._maxTaskConcurrency=z(e.maxTaskConcurrency,Math.max(He.hardwareConcurrency-1,1)),this._cesium3DTiles=new Wo,this._loaderTaskProcessor=this.getLoaderTaskProcessor()}function jo(e,t){var i;--e._activeTasks,!oe(t)||oe((i=e._deferreds)[t])&&delete i[t]}function Yo(){}xo.getGltfSemanticUniforms=function(){return Ho},Object.defineProperties(Wo.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}}),Wo.prototype.contains=function(e){return oe(this._hash[e])},Wo.prototype.set=function(e,t){t!==this._hash[e]&&(this.remove(e),this._hash[e]=t,this._array.push(t))},Wo.prototype.get=function(e){return this._hash[e]},Wo.prototype.remove=function(e){var t,i=this._hash[e],n=oe(i);return n&&((t=this._array).splice(t.indexOf(i),1),delete this._hash[e]),n},Wo.prototype.removeAll=function(){var e=this._array;0<e.length&&(this._hash={},e.length=0)},Object.defineProperties(qo.prototype,{maxTaskConcurrency:{get:function(){return this._maxTaskConcurrency},set:function(e){M.typeOf.number("value",e),this._maxTaskConcurrency=e}}}),qo.prototype.getLoaderTaskProcessor=function(){var e;return oe(this._loaderTaskProcessor)||(this._loaderTaskProcessor=new Ji("load3DTileBufferFromIDB",this._maxTaskConcurrency),e={keyName:"EV_Cesium3DTileLoader.openIndexedDB",resource:void 0,c3DTile:void 0,data:void 0,contentState:void 0,downloadSuccessFun:void 0,downloadErrorFun:void 0},this.loadCesium3DTile(e)),this._loaderTaskProcessor},qo.prototype.loadCesium3DTile=function(e){if(!oe(this._loaderTaskProcessor))return this._getLoaderTaskProcessor(),!1;if(this._cesium3DTiles.contains(e.keyName))return!1;if(!oe(this._loaderTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:void 0}})))return!1;this._cesium3DTiles.set(e.keyName,e);var n=this;return n._loaderTaskProcessor._worker.onmessage=function(e){var t,i=e.data;oe(i.workerType)&&i.workerType===G.TILES3D&&(t=n._cesium3DTiles.get(i.dataName),oe(i.data)?(t.meshPrimitives=oe(i.meshPrimitives)?i.meshPrimitives:[],oe(t.downloadSuccessFun)&&(t.data=i.data,t.downloadSuccessFun(t,i.data))):oe(t.downloadErrorFun)&&t.downloadErrorFun(t),n._cesium3DTiles.remove(i.dataName),jo(n._loaderTaskProcessor,i.workerTaskID))},!0},qo.prototype.loadCesium3DTileTexture=function(e){if(!oe(this._loaderTaskProcessor))return this._getLoaderTaskProcessor(),!1;if(this._cesium3DTiles.contains(e.keyName))return this._cesium3DTiles.get(e.keyName).push(e),!1;if(!oe(this._loaderTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:void 0}})))return!1;var t=[];t.push(e),this._cesium3DTiles.set(e.keyName,t);var r=this;return r._loaderTaskProcessor._worker.onmessage=function(e){var t=e.data;if(oe(t.workerType)&&t.workerType===G.TILES3D){for(var i=r._cesium3DTiles.get(t.dataName),n=0;n<i.length;n++)oe(t.data)?(i[n].meshPrimitives=oe(t.meshPrimitives)?t.meshPrimitives:[],oe(i[n].downloadSuccessFun)&&(i[n].data=t.data,i[n].downloadSuccessFun(i[n],t.data))):oe(i[n].downloadErrorFun)&&i[n].downloadErrorFun(i[n]);r._cesium3DTiles.remove(t.dataName),jo(r._loaderTaskProcessor,t.workerTaskID)}},!0},Yo._maxTaskConcurrency=500,Yo._saverTaskProcessor=void 0,Yo._getSaverTaskProcessor=function(){var e;return oe(Yo._saverTaskProcessor)||(e=new Ji("save3DTileBufferToIDB",Yo._maxTaskConcurrency),Yo._saverTaskProcessor=e,Yo.saveCesium3DTile({keyName:"EV_Cesium3DTileSaver.openIndexedDB",data:void 0,meshPrimitives:void 0})),Yo._saverTaskProcessor},Yo.saveCesium3DTile=function(e){if(!oe(Yo._saverTaskProcessor))return Yo._getSaverTaskProcessor(),!1;var t=Yo._saverTaskProcessor.scheduleTask({taskData:{keyName:e.keyName,data:e.data,meshPrimitives:oe(e.meshPrimitives)?e.meshPrimitives:[]}});return!!oe(t)&&(Yo._saverTaskProcessor._worker.onmessage=function(e){var t=e.data;oe(t.workerType)&&t.workerType===G.TILES3D&&function(e,t){if(--e._activeTasks,!oe(t))return;var i=e._deferreds;oe(i[t])&&delete i[t]}(Yo._saverTaskProcessor,t.workerTaskID)},!0)};var Xo={octEncodeInRange:function(e,t,i){var n,r;return i.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),i.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0&&(n=i.x,r=i.y,i.x=(1-Math.abs(r))*ri.signNotZero(n),i.y=(1-Math.abs(n))*ri.signNotZero(r)),i.x=ri.toSNorm(i.x,t),i.y=ri.toSNorm(i.y,t),i},octEncode:function(e,t){return Xo.octEncodeInRange(e,255,t)}},Ko=new ha,Zo=new Uint8Array(1);function Jo(e){return Zo[0]=e,Zo[0]}Xo.octEncodeToCartesian4=function(e,t){return Xo.octEncodeInRange(e,65535,Ko),t.x=Jo(Ko.x*(1/256)),t.y=Jo(Ko.x),t.z=Jo(Ko.y*(1/256)),t.w=Jo(Ko.y),t},Xo.octDecodeInRange=function(e,t,i,n){var r;return n.x=ri.fromSNorm(e,i),n.y=ri.fromSNorm(t,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0&&(r=n.x,n.x=(1-Math.abs(n.y))*ri.signNotZero(r),n.y=(1-Math.abs(r))*ri.signNotZero(n.y)),si.normalize(n,n)},Xo.octDecode=function(e,t,i){return Xo.octDecodeInRange(e,t,255,i)},Xo.octDecodeFromCartesian4=function(e,t){var i=256*e.x+e.y,n=256*e.z+e.w;return Xo.octDecodeInRange(i,n,65535,t)},Xo.octPackFloat=function(e){return 256*e.x+e.y};var Qo,$o,es,ts=new ha;function is(e){return e>>>1^-(1&e)}function ns(e){return e>>1^-(1&e)}function rs(e,t,i){return i<0&&(i+=1),1<i&&--i,6*i<1?e+6*(t-e)*i:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function as(e,t,i,n){this.red=z(e,1),this.green=z(t,1),this.blue=z(i,1),this.alpha=z(n,1)}Xo.octEncodeFloat=function(e){return Xo.octEncode(e,ts),Xo.octPackFloat(ts)},Xo.octDecodeFloat=function(e,t){var i=e/256,n=Math.floor(i),r=256*(i-n);return Xo.octDecode(n,r,t)},Xo.octPack=function(e,t,i,n){var r=Xo.octEncodeFloat(e),a=Xo.octEncodeFloat(t),o=Xo.octEncode(i,ts);return n.x=65536*o.x+r,n.y=65536*o.y+a,n},Xo.octUnpack=function(e,t,i,n){var r=e.x/65536,a=Math.floor(r),o=65536*(r-a),r=e.y/65536,s=Math.floor(r),u=65536*(r-s);Xo.octDecodeFloat(o,t),Xo.octDecodeFloat(u,i),Xo.octDecode(a,s,n)},Xo.compressTextureCoordinates=function(e){return 4096*(4095*e.x|0)+(4095*e.y|0)},Xo.decompressTextureCoordinates=function(e,t){var i=e/4096,n=Math.floor(i);return t.x=n/4095,t.y=(e-4096*n)/4095,t},Xo.zigZagDeltaDecode=function(e,t,i){var n=e.length,r=0,a=0,o=0;if(2===e.BYTES_PER_ELEMENT)for(var s=0;s<n;++s)r+=ns(e[s]),a+=ns(t[s]),e[s]=r,t[s]=a,oe(i)&&(o+=ns(i[s]),i[s]=o);else if(4===e.BYTES_PER_ELEMENT)for(s=0;s<n;++s)r+=is(e[s]),a+=is(t[s]),e[s]=r,t[s]=a,oe(i)&&(o+=is(i[s]),i[s]=o)},as.fromCartesian4=function(e,t){return oe(t)?(t.red=e.x,t.green=e.y,t.blue=e.z,t.alpha=e.w,t):new as(e.x,e.y,e.z,e.w)},as.fromBytes=function(e,t,i,n,r){return e=as.byteToFloat(z(e,255)),t=as.byteToFloat(z(t,255)),i=as.byteToFloat(z(i,255)),n=as.byteToFloat(z(n,255)),oe(r)?(r.red=e,r.green=t,r.blue=i,r.alpha=n,r):new as(e,t,i,n)},as.fromAlpha=function(e,t,i){return oe(i)?(i.red=e.red,i.green=e.green,i.blue=e.blue,i.alpha=t,i):new as(e.red,e.green,e.blue,t)},He.supportsTypedArrays()&&(Qo=new ArrayBuffer(4),$o=new Uint32Array(Qo),es=new Uint8Array(Qo)),as.fromRgba=function(e,t){return $o[0]=e,as.fromBytes(es[0],es[1],es[2],es[3],t)},as.fromHsl=function(e,t,i,n,r){e=z(e,0)%1,t=z(t,0),i=z(i,0),n=z(n,1);var a,o,s=i,u=i,l=i;return 0!==t&&(s=rs(o=2*i-(a=i<.5?i*(1+t):i+t-i*t),a,e+1/3),u=rs(o,a,e),l=rs(o,a,e-1/3)),oe(r)?(r.red=s,r.green=u,r.blue=l,r.alpha=n,r):new as(s,u,l,n)},as.fromRandom=function(e,t){var i,n,r=(e=z(e,z.EMPTY_OBJECT)).red;oe(r)||(i=z(e.minimumRed,0),n=z(e.maximumRed,1),r=i+ri.nextRandomNumber()*(n-i));var a,o,s=e.green;oe(s)||(a=z(e.minimumGreen,0),o=z(e.maximumGreen,1),s=a+ri.nextRandomNumber()*(o-a));var u,l,c=e.blue;oe(c)||(u=z(e.minimumBlue,0),l=z(e.maximumBlue,1),c=u+ri.nextRandomNumber()*(l-u));var m,d,h=e.alpha;return oe(h)||(m=z(e.minimumAlpha,0),d=z(e.maximumAlpha,1),h=m+ri.nextRandomNumber()*(d-m)),oe(t)?(t.red=r,t.green=s,t.blue=c,t.alpha=h,t):new as(r,s,c,h)};var os=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,ss=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,us=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,ls=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;as.fromCssColorString=function(e,t){oe(t)||(t=new as);var i=as[e.toUpperCase()];if(oe(i))return as.clone(i,t),t;var n=os.exec(e);return null!==n?(t.red=parseInt(n[1],16)/15,t.green=parseInt(n[2],16)/15,t.blue=parseInt(n[3],16)/15,t.alpha=1,t):null!==(n=ss.exec(e))?(t.red=parseInt(n[1],16)/255,t.green=parseInt(n[2],16)/255,t.blue=parseInt(n[3],16)/255,t.alpha=1,t):null!==(n=us.exec(e))?(t.red=parseFloat(n[1])/("%"===n[1].substr(-1)?100:255),t.green=parseFloat(n[2])/("%"===n[2].substr(-1)?100:255),t.blue=parseFloat(n[3])/("%"===n[3].substr(-1)?100:255),t.alpha=parseFloat(z(n[4],"1.0")),t):null!==(n=ls.exec(e))?as.fromHsl(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,parseFloat(z(n[4],"1.0")),t):t=void 0},as.packedLength=4,as.pack=function(e,t,i){return i=z(i,0),t[i++]=e.red,t[i++]=e.green,t[i++]=e.blue,t[i]=e.alpha,t},as.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new as),i.red=e[t++],i.green=e[t++],i.blue=e[t++],i.alpha=e[t],i},as.byteToFloat=function(e){return e/255},as.floatToByte=function(e){return 1===e?255:256*e|0},as.clone=function(e,t){if(oe(e))return oe(t)?(t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha,t):new as(e.red,e.green,e.blue,e.alpha)},as.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha},as.equalsArray=function(e,t,i){return e.red===t[i]&&e.green===t[i+1]&&e.blue===t[i+2]&&e.alpha===t[i+3]},as.prototype.clone=function(e){return as.clone(this,e)},as.prototype.equals=function(e){return as.equals(this,e)},as.prototype.equalsEpsilon=function(e,t){return this===e||oe(e)&&Math.abs(this.red-e.red)<=t&&Math.abs(this.green-e.green)<=t&&Math.abs(this.blue-e.blue)<=t&&Math.abs(this.alpha-e.alpha)<=t},as.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},as.prototype.toCssColorString=function(){var e=as.floatToByte(this.red),t=as.floatToByte(this.green),i=as.floatToByte(this.blue);return 1===this.alpha?"rgb("+e+","+t+","+i+")":"rgba("+e+","+t+","+i+","+this.alpha+")"},as.prototype.toBytes=function(e){var t=as.floatToByte(this.red),i=as.floatToByte(this.green),n=as.floatToByte(this.blue),r=as.floatToByte(this.alpha);return oe(e)?(e[0]=t,e[1]=i,e[2]=n,e[3]=r,e):[t,i,n,r]},as.prototype.toRgba=function(){return es[0]=as.floatToByte(this.red),es[1]=as.floatToByte(this.green),es[2]=as.floatToByte(this.blue),es[3]=as.floatToByte(this.alpha),$o[0]},as.prototype.brighten=function(e,t){return e=1-e,t.red=1-(1-this.red)*e,t.green=1-(1-this.green)*e,t.blue=1-(1-this.blue)*e,t.alpha=this.alpha,t},as.prototype.darken=function(e,t){return e=1-e,t.red=this.red*e,t.green=this.green*e,t.blue=this.blue*e,t.alpha=this.alpha,t},as.prototype.withAlpha=function(e,t){return as.fromAlpha(this,e,t)},as.add=function(e,t,i){return i.red=e.red+t.red,i.green=e.green+t.green,i.blue=e.blue+t.blue,i.alpha=e.alpha+t.alpha,i},as.subtract=function(e,t,i){return i.red=e.red-t.red,i.green=e.green-t.green,i.blue=e.blue-t.blue,i.alpha=e.alpha-t.alpha,i},as.multiply=function(e,t,i){return i.red=e.red*t.red,i.green=e.green*t.green,i.blue=e.blue*t.blue,i.alpha=e.alpha*t.alpha,i},as.divide=function(e,t,i){return i.red=e.red/t.red,i.green=e.green/t.green,i.blue=e.blue/t.blue,i.alpha=e.alpha/t.alpha,i},as.mod=function(e,t,i){return i.red=e.red%t.red,i.green=e.green%t.green,i.blue=e.blue%t.blue,i.alpha=e.alpha%t.alpha,i},as.lerp=function(e,t,i,n){return n.red=ri.lerp(e.red,t.red,i),n.green=ri.lerp(e.green,t.green,i),n.blue=ri.lerp(e.blue,t.blue,i),n.alpha=ri.lerp(e.alpha,t.alpha,i),n},as.multiplyByScalar=function(e,t,i){return i.red=e.red*t,i.green=e.green*t,i.blue=e.blue*t,i.alpha=e.alpha*t,i},as.divideByScalar=function(e,t,i){return i.red=e.red/t,i.green=e.green/t,i.blue=e.blue/t,i.alpha=e.alpha/t,i},as.ALICEBLUE=Object.freeze(as.fromCssColorString("#F0F8FF")),as.ANTIQUEWHITE=Object.freeze(as.fromCssColorString("#FAEBD7")),as.AQUA=Object.freeze(as.fromCssColorString("#00FFFF")),as.AQUAMARINE=Object.freeze(as.fromCssColorString("#7FFFD4")),as.AZURE=Object.freeze(as.fromCssColorString("#F0FFFF")),as.BEIGE=Object.freeze(as.fromCssColorString("#F5F5DC")),as.BISQUE=Object.freeze(as.fromCssColorString("#FFE4C4")),as.BLACK=Object.freeze(as.fromCssColorString("#000000")),as.BLANCHEDALMOND=Object.freeze(as.fromCssColorString("#FFEBCD")),as.BLUE=Object.freeze(as.fromCssColorString("#0000FF")),as.BLUEVIOLET=Object.freeze(as.fromCssColorString("#8A2BE2")),as.BROWN=Object.freeze(as.fromCssColorString("#A52A2A")),as.BURLYWOOD=Object.freeze(as.fromCssColorString("#DEB887")),as.CADETBLUE=Object.freeze(as.fromCssColorString("#5F9EA0")),as.CHARTREUSE=Object.freeze(as.fromCssColorString("#7FFF00")),as.CHOCOLATE=Object.freeze(as.fromCssColorString("#D2691E")),as.CORAL=Object.freeze(as.fromCssColorString("#FF7F50")),as.CORNFLOWERBLUE=Object.freeze(as.fromCssColorString("#6495ED")),as.CORNSILK=Object.freeze(as.fromCssColorString("#FFF8DC")),as.CRIMSON=Object.freeze(as.fromCssColorString("#DC143C")),as.CYAN=Object.freeze(as.fromCssColorString("#00FFFF")),as.DARKBLUE=Object.freeze(as.fromCssColorString("#00008B")),as.DARKCYAN=Object.freeze(as.fromCssColorString("#008B8B")),as.DARKGOLDENROD=Object.freeze(as.fromCssColorString("#B8860B")),as.DARKGRAY=Object.freeze(as.fromCssColorString("#A9A9A9")),as.DARKGREEN=Object.freeze(as.fromCssColorString("#006400")),as.DARKGREY=as.DARKGRAY,as.DARKKHAKI=Object.freeze(as.fromCssColorString("#BDB76B")),as.DARKMAGENTA=Object.freeze(as.fromCssColorString("#8B008B")),as.DARKOLIVEGREEN=Object.freeze(as.fromCssColorString("#556B2F")),as.DARKORANGE=Object.freeze(as.fromCssColorString("#FF8C00")),as.DARKORCHID=Object.freeze(as.fromCssColorString("#9932CC")),as.DARKRED=Object.freeze(as.fromCssColorString("#8B0000")),as.DARKSALMON=Object.freeze(as.fromCssColorString("#E9967A")),as.DARKSEAGREEN=Object.freeze(as.fromCssColorString("#8FBC8F")),as.DARKSLATEBLUE=Object.freeze(as.fromCssColorString("#483D8B")),as.DARKSLATEGRAY=Object.freeze(as.fromCssColorString("#2F4F4F")),as.DARKSLATEGREY=as.DARKSLATEGRAY,as.DARKTURQUOISE=Object.freeze(as.fromCssColorString("#00CED1")),as.DARKVIOLET=Object.freeze(as.fromCssColorString("#9400D3")),as.DEEPPINK=Object.freeze(as.fromCssColorString("#FF1493")),as.DEEPSKYBLUE=Object.freeze(as.fromCssColorString("#00BFFF")),as.DIMGRAY=Object.freeze(as.fromCssColorString("#696969")),as.DIMGREY=as.DIMGRAY,as.DODGERBLUE=Object.freeze(as.fromCssColorString("#1E90FF")),as.FIREBRICK=Object.freeze(as.fromCssColorString("#B22222")),as.FLORALWHITE=Object.freeze(as.fromCssColorString("#FFFAF0")),as.FORESTGREEN=Object.freeze(as.fromCssColorString("#228B22")),as.FUCHSIA=Object.freeze(as.fromCssColorString("#FF00FF")),as.GAINSBORO=Object.freeze(as.fromCssColorString("#DCDCDC")),as.GHOSTWHITE=Object.freeze(as.fromCssColorString("#F8F8FF")),as.GOLD=Object.freeze(as.fromCssColorString("#FFD700")),as.GOLDENROD=Object.freeze(as.fromCssColorString("#DAA520")),as.GRAY=Object.freeze(as.fromCssColorString("#808080")),as.GREEN=Object.freeze(as.fromCssColorString("#008000")),as.GREENYELLOW=Object.freeze(as.fromCssColorString("#ADFF2F")),as.GREY=as.GRAY,as.HONEYDEW=Object.freeze(as.fromCssColorString("#F0FFF0")),as.HOTPINK=Object.freeze(as.fromCssColorString("#FF69B4")),as.INDIANRED=Object.freeze(as.fromCssColorString("#CD5C5C")),as.INDIGO=Object.freeze(as.fromCssColorString("#4B0082")),as.IVORY=Object.freeze(as.fromCssColorString("#FFFFF0")),as.KHAKI=Object.freeze(as.fromCssColorString("#F0E68C")),as.LAVENDER=Object.freeze(as.fromCssColorString("#E6E6FA")),as.LAVENDAR_BLUSH=Object.freeze(as.fromCssColorString("#FFF0F5")),as.LAWNGREEN=Object.freeze(as.fromCssColorString("#7CFC00")),as.LEMONCHIFFON=Object.freeze(as.fromCssColorString("#FFFACD")),as.LIGHTBLUE=Object.freeze(as.fromCssColorString("#ADD8E6")),as.LIGHTCORAL=Object.freeze(as.fromCssColorString("#F08080")),as.LIGHTCYAN=Object.freeze(as.fromCssColorString("#E0FFFF")),as.LIGHTGOLDENRODYELLOW=Object.freeze(as.fromCssColorString("#FAFAD2")),as.LIGHTGRAY=Object.freeze(as.fromCssColorString("#D3D3D3")),as.LIGHTGREEN=Object.freeze(as.fromCssColorString("#90EE90")),as.LIGHTGREY=as.LIGHTGRAY,as.LIGHTPINK=Object.freeze(as.fromCssColorString("#FFB6C1")),as.LIGHTSEAGREEN=Object.freeze(as.fromCssColorString("#20B2AA")),as.LIGHTSKYBLUE=Object.freeze(as.fromCssColorString("#87CEFA")),as.LIGHTSLATEGRAY=Object.freeze(as.fromCssColorString("#778899")),as.LIGHTSLATEGREY=as.LIGHTSLATEGRAY,as.LIGHTSTEELBLUE=Object.freeze(as.fromCssColorString("#B0C4DE")),as.LIGHTYELLOW=Object.freeze(as.fromCssColorString("#FFFFE0")),as.LIME=Object.freeze(as.fromCssColorString("#00FF00")),as.LIMEGREEN=Object.freeze(as.fromCssColorString("#32CD32")),as.LINEN=Object.freeze(as.fromCssColorString("#FAF0E6")),as.MAGENTA=Object.freeze(as.fromCssColorString("#FF00FF")),as.MAROON=Object.freeze(as.fromCssColorString("#800000")),as.MEDIUMAQUAMARINE=Object.freeze(as.fromCssColorString("#66CDAA")),as.MEDIUMBLUE=Object.freeze(as.fromCssColorString("#0000CD")),as.MEDIUMORCHID=Object.freeze(as.fromCssColorString("#BA55D3")),as.MEDIUMPURPLE=Object.freeze(as.fromCssColorString("#9370DB")),as.MEDIUMSEAGREEN=Object.freeze(as.fromCssColorString("#3CB371")),as.MEDIUMSLATEBLUE=Object.freeze(as.fromCssColorString("#7B68EE")),as.MEDIUMSPRINGGREEN=Object.freeze(as.fromCssColorString("#00FA9A")),as.MEDIUMTURQUOISE=Object.freeze(as.fromCssColorString("#48D1CC")),as.MEDIUMVIOLETRED=Object.freeze(as.fromCssColorString("#C71585")),as.MIDNIGHTBLUE=Object.freeze(as.fromCssColorString("#191970")),as.MINTCREAM=Object.freeze(as.fromCssColorString("#F5FFFA")),as.MISTYROSE=Object.freeze(as.fromCssColorString("#FFE4E1")),as.MOCCASIN=Object.freeze(as.fromCssColorString("#FFE4B5")),as.NAVAJOWHITE=Object.freeze(as.fromCssColorString("#FFDEAD")),as.NAVY=Object.freeze(as.fromCssColorString("#000080")),as.OLDLACE=Object.freeze(as.fromCssColorString("#FDF5E6")),as.OLIVE=Object.freeze(as.fromCssColorString("#808000")),as.OLIVEDRAB=Object.freeze(as.fromCssColorString("#6B8E23")),as.ORANGE=Object.freeze(as.fromCssColorString("#FFA500")),as.ORANGERED=Object.freeze(as.fromCssColorString("#FF4500")),as.ORCHID=Object.freeze(as.fromCssColorString("#DA70D6")),as.PALEGOLDENROD=Object.freeze(as.fromCssColorString("#EEE8AA")),as.PALEGREEN=Object.freeze(as.fromCssColorString("#98FB98")),as.PALETURQUOISE=Object.freeze(as.fromCssColorString("#AFEEEE")),as.PALEVIOLETRED=Object.freeze(as.fromCssColorString("#DB7093")),as.PAPAYAWHIP=Object.freeze(as.fromCssColorString("#FFEFD5")),as.PEACHPUFF=Object.freeze(as.fromCssColorString("#FFDAB9")),as.PERU=Object.freeze(as.fromCssColorString("#CD853F")),as.PINK=Object.freeze(as.fromCssColorString("#FFC0CB")),as.PLUM=Object.freeze(as.fromCssColorString("#DDA0DD")),as.POWDERBLUE=Object.freeze(as.fromCssColorString("#B0E0E6")),as.PURPLE=Object.freeze(as.fromCssColorString("#800080")),as.RED=Object.freeze(as.fromCssColorString("#FF0000")),as.ROSYBROWN=Object.freeze(as.fromCssColorString("#BC8F8F")),as.ROYALBLUE=Object.freeze(as.fromCssColorString("#4169E1")),as.SADDLEBROWN=Object.freeze(as.fromCssColorString("#8B4513")),as.SALMON=Object.freeze(as.fromCssColorString("#FA8072")),as.SANDYBROWN=Object.freeze(as.fromCssColorString("#F4A460")),as.SEAGREEN=Object.freeze(as.fromCssColorString("#2E8B57")),as.SEASHELL=Object.freeze(as.fromCssColorString("#FFF5EE")),as.SIENNA=Object.freeze(as.fromCssColorString("#A0522D")),as.SILVER=Object.freeze(as.fromCssColorString("#C0C0C0")),as.SKYBLUE=Object.freeze(as.fromCssColorString("#87CEEB")),as.SLATEBLUE=Object.freeze(as.fromCssColorString("#6A5ACD")),as.SLATEGRAY=Object.freeze(as.fromCssColorString("#708090")),as.SLATEGREY=as.SLATEGRAY,as.SNOW=Object.freeze(as.fromCssColorString("#FFFAFA")),as.SPRINGGREEN=Object.freeze(as.fromCssColorString("#00FF7F")),as.STEELBLUE=Object.freeze(as.fromCssColorString("#4682B4")),as.TAN=Object.freeze(as.fromCssColorString("#D2B48C")),as.TEAL=Object.freeze(as.fromCssColorString("#008080")),as.THISTLE=Object.freeze(as.fromCssColorString("#D8BFD8")),as.TOMATO=Object.freeze(as.fromCssColorString("#FF6347")),as.TURQUOISE=Object.freeze(as.fromCssColorString("#40E0D0")),as.VIOLET=Object.freeze(as.fromCssColorString("#EE82EE")),as.WHEAT=Object.freeze(as.fromCssColorString("#F5DEB3")),as.WHITE=Object.freeze(as.fromCssColorString("#FFFFFF")),as.WHITESMOKE=Object.freeze(as.fromCssColorString("#F5F5F5")),as.YELLOW=Object.freeze(as.fromCssColorString("#FFFF00")),as.YELLOWGREEN=Object.freeze(as.fromCssColorString("#9ACD32")),as.TRANSPARENT=Object.freeze(new as(0,0,0,0));var cs={UNSIGNED_BYTE:Qa.UNSIGNED_BYTE,UNSIGNED_SHORT:Qa.UNSIGNED_SHORT,UNSIGNED_INT:Qa.UNSIGNED_INT,FLOAT:Qa.FLOAT,HALF_FLOAT:Qa.HALF_FLOAT_OES,UNSIGNED_INT_24_8:Qa.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:Qa.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:Qa.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:Qa.UNSIGNED_SHORT_5_6_5,isPacked:function(e){return e===cs.UNSIGNED_INT_24_8||e===cs.UNSIGNED_SHORT_4_4_4_4||e===cs.UNSIGNED_SHORT_5_5_5_1||e===cs.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(e){switch(e){case cs.UNSIGNED_BYTE:return 1;case cs.UNSIGNED_SHORT:case cs.UNSIGNED_SHORT_4_4_4_4:case cs.UNSIGNED_SHORT_5_5_5_1:case cs.UNSIGNED_SHORT_5_6_5:case cs.HALF_FLOAT:return 2;case cs.UNSIGNED_INT:case cs.FLOAT:case cs.UNSIGNED_INT_24_8:return 4}},validate:function(e){return e===cs.UNSIGNED_BYTE||e===cs.UNSIGNED_SHORT||e===cs.UNSIGNED_INT||e===cs.FLOAT||e===cs.HALF_FLOAT||e===cs.UNSIGNED_INT_24_8||e===cs.UNSIGNED_SHORT_4_4_4_4||e===cs.UNSIGNED_SHORT_5_5_5_1||e===cs.UNSIGNED_SHORT_5_6_5}},ms=Object.freeze(cs),ds={DEPTH_COMPONENT:Qa.DEPTH_COMPONENT,DEPTH_STENCIL:Qa.DEPTH_STENCIL,ALPHA:Qa.ALPHA,RGB:Qa.RGB,RGBA:Qa.RGBA,LUMINANCE:Qa.LUMINANCE,LUMINANCE_ALPHA:Qa.LUMINANCE_ALPHA,RGB_DXT1:Qa.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:Qa.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:Qa.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:Qa.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:Qa.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:Qa.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:Qa.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:Qa.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:Qa.COMPRESSED_RGB_ETC1_WEBGL,RGB_ETC2:Qa.COMPRESSED_RGB8_ETC2,RGBA_ETC2:Qa.COMPRESSED_RGBA8_ETC2_EAC,componentsLength:function(e){switch(e){case ds.RGB:return 3;case ds.RGBA:return 4;case ds.LUMINANCE_ALPHA:return 2;case ds.ALPHA:case ds.LUMINANCE:default:return 1}},validate:function(e){return e===ds.DEPTH_COMPONENT||e===ds.DEPTH_STENCIL||e===ds.ALPHA||e===ds.RGB||e===ds.RGBA||e===ds.LUMINANCE||e===ds.LUMINANCE_ALPHA||e===ds.RGB_DXT1||e===ds.RGBA_DXT1||e===ds.RGBA_DXT3||e===ds.RGBA_DXT5||e===ds.RGB_PVRTC_4BPPV1||e===ds.RGB_PVRTC_2BPPV1||e===ds.RGBA_PVRTC_4BPPV1||e===ds.RGBA_PVRTC_2BPPV1||e===ds.RGB_ETC1||e===ds.RGB_ETC2||e===ds.RGBA_ETC2},isColorFormat:function(e){return e===ds.ALPHA||e===ds.RGB||e===ds.RGBA||e===ds.LUMINANCE||e===ds.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===ds.DEPTH_COMPONENT||e===ds.DEPTH_STENCIL},isCompressedFormat:function(e){return e===ds.RGB_DXT1||e===ds.RGBA_DXT1||e===ds.RGBA_DXT3||e===ds.RGBA_DXT5||e===ds.RGB_PVRTC_4BPPV1||e===ds.RGB_PVRTC_2BPPV1||e===ds.RGBA_PVRTC_4BPPV1||e===ds.RGBA_PVRTC_2BPPV1||e===ds.RGB_ETC1||e===ds.RGB_ETC2||e===ds.RGBA_ETC2},isDXTFormat:function(e){return e===ds.RGB_DXT1||e===ds.RGBA_DXT1||e===ds.RGBA_DXT3||e===ds.RGBA_DXT5},isPVRTCFormat:function(e){return e===ds.RGB_PVRTC_4BPPV1||e===ds.RGB_PVRTC_2BPPV1||e===ds.RGBA_PVRTC_4BPPV1||e===ds.RGBA_PVRTC_2BPPV1},isETC1Format:function(e){return e===ds.RGB_ETC1},compressedTextureSizeInBytes:function(e,t,i,n){var r=void 0!==n?n:1;switch(e){case ds.RGB_DXT1:case ds.RGBA_DXT1:case ds.RGB_ETC1:case ds.RGB_ETC2:for(var a=0;0<r;){a+=Math.floor((t+3)/4)*Math.floor((i+3)/4)*8,1!=t&&(t/=2),1!=i&&(i/=2),r--}return a;case ds.RGBA_DXT3:case ds.RGBA_DXT5:for(a=0;0<r;){a+=Math.floor((t+3)/4)*Math.floor((i+3)/4)*16,1!=t&&(t/=2),1!=i&&(i/=2),r--}return a;case ds.RGB_PVRTC_4BPPV1:case ds.RGBA_PVRTC_4BPPV1:for(a=0;0<r;){a+=Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8),1!=t&&(t/=2),1!=i&&(i/=2),r--}return a;case ds.RGB_PVRTC_2BPPV1:case ds.RGBA_PVRTC_2BPPV1:for(a=0;0<r;){a+=Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8),1!=t&&(t/=2),1!=i&&(i/=2),r--}return a;case ds.RGBA_ETC2:for(a=0;0<r;){a+=Math.floor((t+3)/4)*Math.floor((i+3)/4)*16,1!=t&&(t/=2),1!=i&&(i/=2),r--}return a;default:return 0}},textureSizeInBytes:function(e,t,i,n){var r=ds.componentsLength(e);return ms.isPacked(t)&&(r=1),r*ms.sizeInBytes(t)*i*n},alignmentInBytes:function(e,t,i){var n=ds.textureSizeInBytes(e,t,i,1)%4;return 0==n?4:2==n?2:1},createTypedArray:function(e,t,i,n){var r=ms.sizeInBytes(t),a=r===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:r===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:r===Float32Array.BYTES_PER_ELEMENT&&t===ms.FLOAT?Float32Array:Uint32Array;return new a(ds.componentsLength(e)*i*n)},flipY:function(e,t,i,n,r){if(1===r)return e;for(var a=ds.createTypedArray(t,i,n,r),o=ds.componentsLength(t),s=n*o,u=0;u<r;++u)for(var l=u*r*o,c=(r-u-1)*r*o,m=0;m<s;++m)a[c+m]=e[l+m];return a}},hs=Object.freeze(ds);function fs(e,t){this.normal=si.clone(e),this.distance=t}fs.fromPointNormal=function(e,t,i){var n=-si.dot(t,e);return oe(i)?(si.clone(t,i.normal),i.distance=n,i):new fs(t,n)};var ps=new si;fs.fromCartesian4=function(e,t){var i=si.fromCartesian4(e,ps),n=e.w;return oe(t)?(si.clone(i,t.normal),t.distance=n,t):new fs(i,n)},fs.getPointDistance=function(e,t){return si.dot(e.normal,t)+e.distance};var _s=new si;fs.projectPointOntoPlane=function(e,t,i){oe(i)||(i=new si);var n=fs.getPointDistance(e,t),r=si.multiplyByScalar(e.normal,n,_s);return si.subtract(t,r,i)};var Cs=new si;fs.transform=function(e,t,i){return Rn.multiplyByPointAsVector(t,e.normal,ps),si.normalize(ps,ps),si.multiplyByScalar(e.normal,-e.distance,Cs),Rn.multiplyByPoint(t,Cs,Cs),fs.fromPointNormal(Cs,ps,i)},fs.clone=function(e,t){return oe(t)?(si.clone(e.normal,t.normal),t.distance=e.distance,t):new fs(e.normal,e.distance)},fs.equals=function(e,t){return e.distance===t.distance&&si.equals(e.normal,t.normal)},fs.ORIGIN_XY_PLANE=Object.freeze(new fs(si.UNIT_Z,0)),fs.ORIGIN_YZ_PLANE=Object.freeze(new fs(si.UNIT_X,0)),fs.ORIGIN_ZX_PLANE=Object.freeze(new fs(si.UNIT_Y,0));var gs={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(gs,{maximumCombinedTextureImageUnits:{get:function(){return gs._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return gs._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return gs._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return gs._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return gs._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return gs._maximumTextureSize}},maximumVaryingVectors:{get:function(){return gs._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return gs._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return gs._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return gs._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return gs._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return gs._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return gs._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return gs._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return gs._maximumViewportWidth}},maximumViewportHeight:{get:function(){return gs._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return gs._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return gs._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return gs._maximumColorAttachments}},highpFloatSupported:{get:function(){return gs._highpFloatSupported}},highpIntSupported:{get:function(){return gs._highpIntSupported}}});var vs={NEAREST:Qa.NEAREST,LINEAR:Qa.LINEAR,validate:function(e){return e===vs.NEAREST||e===vs.LINEAR}},ys=Object.freeze(vs),Ts={NEAREST:Qa.NEAREST,LINEAR:Qa.LINEAR,NEAREST_MIPMAP_NEAREST:Qa.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:Qa.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:Qa.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:Qa.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===Ts.NEAREST||e===Ts.LINEAR||e===Ts.NEAREST_MIPMAP_NEAREST||e===Ts.LINEAR_MIPMAP_NEAREST||e===Ts.NEAREST_MIPMAP_LINEAR||e===Ts.LINEAR_MIPMAP_LINEAR}},xs=Object.freeze(Ts),ws={CLAMP_TO_EDGE:Qa.CLAMP_TO_EDGE,REPEAT:Qa.REPEAT,MIRRORED_REPEAT:Qa.MIRRORED_REPEAT,validate:function(e){return e===ws.CLAMP_TO_EDGE||e===ws.REPEAT||e===ws.MIRRORED_REPEAT}},As=Object.freeze(ws);function Es(e){e=z(e,z.EMPTY_OBJECT);var t=z(e.wrapS,As.CLAMP_TO_EDGE),i=z(e.wrapT,As.CLAMP_TO_EDGE),n=z(e.minificationFilter,xs.LINEAR),r=z(e.magnificationFilter,ys.LINEAR),a=oe(e.maximumAnisotropy)?e.maximumAnisotropy:1;this._wrapS=t,this._wrapT=i,this._minificationFilter=n,this._magnificationFilter=r,this._maximumAnisotropy=a}function Ss(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}Object.defineProperties(Es.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}}),Es.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy},Es.NEAREST=Object.freeze(new Es({wrapS:As.CLAMP_TO_EDGE,wrapT:As.CLAMP_TO_EDGE,minificationFilter:xs.NEAREST,magnificationFilter:ys.NEAREST}));var bs={DONT_CARE:Qa.DONT_CARE,FASTEST:Qa.FASTEST,NICEST:Qa.NICEST,validate:function(e){return e===bs.DONT_CARE||e===bs.FASTEST||e===bs.NICEST}},Ms=Object.freeze(bs);function Rs(e){var t=(e=z(e,z.EMPTY_OBJECT)).context,i=e.width,n=e.height,r=e.source,a=1;oe(r)&&oe(r.length)&&0<r.length&&!oe(r.arrayBufferView)&&(r.arrayBufferView={},r.arrayBufferView.byteLength=r[0].bufferView.byteLength,a=r.length),oe(r)&&(oe(i)||(i=z(r.videoWidth,r.width)),oe(n)||(n=z(r.videoHeight,r.height)));var o=z(e.pixelFormat,hs.RGBA),s=z(e.pixelDatatype,ms.UNSIGNED_BYTE),u=o,l=hs.isCompressedFormat(u);if(t.webgl2)if(o===hs.DEPTH_STENCIL?u=Qa.DEPTH24_STENCIL8:o===hs.DEPTH_COMPONENT&&(s===ms.UNSIGNED_SHORT?u=Qa.DEPTH_COMPONENT16:s===ms.UNSIGNED_INT&&(u=Qa.DEPTH_COMPONENT24)),s===ms.FLOAT)switch(o){case hs.RGBA:u=Qa.RGBA32F;break;case hs.RGB:u=Qa.RGB32F;break;case hs.RG:u=Qa.RG32F;break;case hs.R:u=Qa.R32F}else if(s===ms.HALF_FLOAT)switch(o){case hs.RGBA:u=Qa.RGBA16F;break;case hs.RGB:u=Qa.RGB16F;break;case hs.RG:u=Qa.RG16F;break;case hs.R:u=Qa.R16F}var c=e.preMultiplyAlpha||o===hs.RGB||o===hs.LUMINANCE,m=z(e.flipY,!0),d=!0,h=t._gl,f=h.TEXTURE_2D,p=h.createTexture();h.activeTexture(h.TEXTURE0),h.bindTexture(f,p),t.webgl2&&s===ms.HALF_FLOAT&&(s=Qa.HALF_FLOAT);var _,C=4;if(oe(r)&&oe(r.arrayBufferView)&&!l&&(C=hs.alignmentInBytes(o,s,i)),h.pixelStorei(h.UNPACK_ALIGNMENT,C),oe(r))if(oe(r.arrayBufferView)){h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1);var g=r.arrayBufferView;if(l)if(oe(r.length)&&0<r.length){var v=i,y=n,T=0;if(t.webgl2){for(var x=0,w=0,A=[],E=v,S=y;1===a||1<=E||1<=S;){var b=hs.compressedTextureSizeInBytes(u,E,S);if(T<a?(O=r[T].bufferView,A.push({level:T,width:E,height:S,offset:x,imageSize:O.length}),T<a-1&&(x+=O.byteLength),w+=O.byteLength):A.push({level:T,width:E,height:S,offset:x,imageSize:b}),1==E&&1==S||1===a)break;1!=E&&(E/=2),1!=S&&(S/=2),T++}for(var M=0,R=new Uint8Array(w),D=0;D<r.length&&A.length>=r.length;D++)R.set(r[D].bufferView,M),M+=r[D].bufferView.length;var P=h.createBuffer();h.bindBuffer(h.PIXEL_UNPACK_BUFFER,P),h.bufferData(h.PIXEL_UNPACK_BUFFER,R,h.STATIC_DRAW);for(var I=0;I<A.length;I++)h.compressedTexImage2D(f,A[I].level,u,A[I].width,A[I].height,0,A[I].imageSize,A[I].offset);h.bindBuffer(h.PIXEL_UNPACK_BUFFER,null)}else for(;1===a||1<=v||1<=y;){var O,b=hs.compressedTextureSizeInBytes(u,v,y);if(O=T<a?r[T].bufferView:r[a-1].bufferView.subarray(0,b),h.compressedTexImage2D(f,T,u,v,y,0,O),1==v&&1==y||1===a)break;1!=v&&(v/=2),1!=y&&(y/=2),T++}a=T}else{t.webgl2?(P=h.createBuffer(),h.bindBuffer(h.PIXEL_UNPACK_BUFFER,P),h.bufferData(h.PIXEL_UNPACK_BUFFER,g,h.STATIC_DRAW),h.compressedTexImage2D(f,0,u,i,n,0,g.length,0),h.bindBuffer(h.PIXEL_UNPACK_BUFFER,null)):h.compressedTexImage2D(f,0,u,i,n,0,g)}else if(m&&(g=hs.flipY(g,o,s,i,n)),h.texImage2D(f,0,u,i,n,0,o,s,g),oe(r.mipLevels))for(var L=i,N=n,B=0;B<r.mipLevels.length;++B)(L=0|Math.floor(L/2))<1&&(L=1),(N=0|Math.floor(N/2))<1&&(N=1),h.texImage2D(f,B+1,u,L,N,0,o,s,r.mipLevels[B])}else oe(r.framebuffer)?(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),r.framebuffer!==t.defaultFramebuffer&&r.framebuffer._bind(),h.copyTexImage2D(f,0,u,r.xOffset,r.yOffset,i,n,0),r.framebuffer!==t.defaultFramebuffer&&r.framebuffer._unBind()):(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,m),h.texImage2D(f,0,u,o,s,r));else h.texImage2D(f,0,u,i,n,0,o,s,null),d=!1;h.bindTexture(f,null),_=l?hs.compressedTextureSizeInBytes(o,i,n,a):hs.textureSizeInBytes(o,s,i,n),this._id=Ss(),this._context=t,this._textureFilterAnisotropic=t._textureFilterAnisotropic,this._textureTarget=f,this._texture=p,this._pixelFormat=o,this._pixelDatatype=s,this._width=i,this._height=n,this._dimensions=new ha(i,n),this._hasMipmap=!1,this._sizeInBytes=_,this._preMultiplyAlpha=c,this._flipY=m,this._initialized=d,this._sampler=void 0,this.sampler=oe(e.sampler)?e.sampler:new Es}function Ds(e,t){this._distance=t,this._normal=new Ps(e,this),this.onChangeCallback=void 0,this.index=-1}function Ps(e,t){this._clippingPlane=t,this._cartesian3=si.clone(e)}function Is(e){e=z(e,z.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=z(e.enabled,!0),this.modelMatrix=Rn.clone(z(e.modelMatrix,Rn.IDENTITY)),this.edgeColor=as.clone(z(e.edgeColor,as.WHITE)),this.edgeWidth=z(e.edgeWidth,0),this.planeAdded=new W,this.planeRemoved=new W,this._owner=void 0;var t=z(e.unionClippingRegions,!1);this._unionClippingRegions=t,this._testIntersection=t?Os:Ls,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0;var i=e.planes;if(oe(i))for(var n=i.length,r=0;r<n;++r)this.add(i[r])}function Os(e){return e===Er.OUTSIDE}function Ls(e){return e===Er.INSIDE}function Ns(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||-1!==e._dirtyIndex&&e._dirtyIndex!==t,e._dirtyIndex=t}function Bs(e,t){for(var i=e.length,n=0;n<i;++n)if(fs.equals(e[n],t))return n;return-1}Rs.create=function(e){return new Rs(e)},Rs.fromFramebuffer=function(e){var t=(e=z(e,z.EMPTY_OBJECT)).context,i=t._gl,n=z(e.pixelFormat,hs.RGB),r=z(e.framebufferXOffset,0),a=z(e.framebufferYOffset,0),o=z(e.width,i.drawingBufferWidth),s=z(e.height,i.drawingBufferHeight),u=e.framebuffer;return new Rs({context:t,width:o,height:s,pixelFormat:n,source:{framebuffer:oe(u)?u:t.defaultFramebuffer,xOffset:r,yOffset:a,width:o,height:s}})},Object.defineProperties(Rs.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(e){var t=e.minificationFilter,i=e.magnificationFilter,n=t===xs.NEAREST_MIPMAP_NEAREST||t===xs.NEAREST_MIPMAP_LINEAR||t===xs.LINEAR_MIPMAP_NEAREST||t===xs.LINEAR_MIPMAP_LINEAR,r=this._context,a=this._pixelDatatype;(a===ms.FLOAT&&!r.textureFloatLinear||a===ms.HALF_FLOAT&&!r.textureHalfFloatLinear)&&(t=n?xs.NEAREST_MIPMAP_NEAREST:xs.NEAREST,i=ys.NEAREST);var o=r._gl,s=this._textureTarget;o.activeTexture(o.TEXTURE0),o.bindTexture(s,this._texture),o.texParameteri(s,o.TEXTURE_MIN_FILTER,t),o.texParameteri(s,o.TEXTURE_MAG_FILTER,i),o.texParameteri(s,o.TEXTURE_WRAP_S,e.wrapS),o.texParameteri(s,o.TEXTURE_WRAP_T,e.wrapT),oe(this._textureFilterAnisotropic)&&o.texParameteri(s,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.maximumAnisotropy),o.bindTexture(s,null),this._sampler=e}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}}),Rs.prototype.copyFrom=function(e,t,i){t=z(t,0),i=z(i,0);var n=this._context._gl,r=this._textureTarget;n.activeTexture(n.TEXTURE0),n.bindTexture(r,this._texture);var a=e.width,o=e.height,s=e.arrayBufferView,u=this._width,l=this._height,c=this._pixelFormat,m=this._pixelDatatype,d=this._preMultiplyAlpha,h=this._flipY,f=4;oe(s)&&(f=hs.alignmentInBytes(c,m,a)),n.pixelStorei(n.UNPACK_ALIGNMENT,f);var p,_=!1;this._initialized||(0===t&&0===i&&a===u&&o===l?(oe(s)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),h&&(s=hs.flipY(s,c,m,u,l)),n.texImage2D(r,0,c,u,l,0,c,m,s)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,h),n.texImage2D(r,0,c,c,m,e)),_=!0):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),p=hs.createTypedArray(c,m,u,l),n.texImage2D(r,0,c,u,l,0,c,m,p)),this._initialized=!0),_||(oe(s)?(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),h&&(s=hs.flipY(s,c,m,a,o)),n.texSubImage2D(r,0,t,i,a,o,c,m,s)):(n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,h),0==t&&0==i?n.texImage2D(r,0,c,c,m,e):n.texSubImage2D(r,0,t,i,c,m,e)))},Rs.prototype.copyFromFramebuffer=function(e,t,i,n,r,a){e=z(e,0),t=z(t,0),i=z(i,0),n=z(n,0),r=z(r,this._width),a=z(a,this._height);var o=this._context._gl,s=this._textureTarget;o.activeTexture(o.TEXTURE0),o.bindTexture(s,this._texture),o.copyTexSubImage2D(s,0,e,t,i,n,r,a),o.bindTexture(s,null),this._initialized=!0},Rs.prototype.generateMipmap=function(e){e=z(e,Ms.DONT_CARE),this._hasMipmap=!0;var t=this._context._gl,i=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,e),t.activeTexture(t.TEXTURE0),t.bindTexture(i,this._texture),t.generateMipmap(i),t.bindTexture(i,null)},Rs.prototype.isDestroyed=function(){return!1},Rs.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),Wi(this)},Object.defineProperties(Ds.prototype,{distance:{get:function(){return this._distance},set:function(e){oe(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._distance=e}},normal:{get:function(){return this._normal},set:function(e){oe(this.onChangeCallback)&&!si.equals(this._normal._cartesian3,e)&&this.onChangeCallback(this.index),si.clone(e,this._normal._cartesian3)}}}),Ds.fromPlane=function(e,t){return oe(t)?(t.normal=e.normal,t.distance=e.distance):t=new Ds(e.normal,e.distance),t},Ds.clone=function(e,t){return oe(t)?(t.normal=e.normal,t.distance=e.distance,t):new Ds(e.normal,e.distance)},Object.defineProperties(Ps.prototype,{x:{get:function(){return this._cartesian3.x},set:function(e){oe(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.x&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.x=e}},y:{get:function(){return this._cartesian3.y},set:function(e){oe(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.y&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.y=e}},z:{get:function(){return this._cartesian3.z},set:function(e){oe(this._clippingPlane.onChangeCallback)&&e!==this._cartesian3.z&&this._clippingPlane.onChangeCallback(this._clippingPlane.index),this._cartesian3.z=e}}}),Object.defineProperties(Is.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?Os:Ls)}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}}),Is.prototype.add=function(e){var t=this._planes.length,i=this;e.onChangeCallback=function(e){Ns(i,e)},Ns(this,e.index=t),this._planes.push(e),this.planeAdded.raiseEvent(e,t)},Is.prototype.get=function(e){return this._planes[e]},Is.prototype.contains=function(e){return-1!==Bs(this._planes,e)},Is.prototype.remove=function(e){var t=this._planes,i=Bs(t,e);if(-1===i)return!1;e instanceof Ds&&(e.onChangeCallback=void 0,e.index=-1);for(var n=t.length-1,r=i;r<n;++r){var a=t[r+1];(t[r]=a)instanceof Ds&&(a.index=r)}return this._multipleDirtyPlanes=!0,t.length=n,this.planeRemoved.raiseEvent(e,i),!0},Is.prototype.removeAll=function(){for(var e=this._planes,t=e.length,i=0;i<t;++i){var n=e[i];n instanceof Ds&&(n.onChangeCallback=void 0,n.index=-1),this.planeRemoved.raiseEvent(n,i)}this._multipleDirtyPlanes=!0,this._planes=[]};var zs=new An,Fs=new An;function Vs(e,t,i){for(var n=e._uint8View,r=e._planes,a=0,o=t;o<i;++o){var s=r[o],u=Xo.octEncodeToCartesian4(s.normal,Fs);n[a]=u.x,n[a+1]=u.y,n[a+2]=u.z,n[a+3]=u.w;var l=An.packFloat(s.distance,zs);n[a+4]=l.x,n[a+5]=l.y,n[a+6]=l.z,n[a+7]=l.w,a+=8}}function Us(e,t,i){for(var n=e._float32View,r=e._planes,a=0,o=t;o<i;++o){var s=r[o],u=s.normal;n[a]=u.x,n[a+1]=u.y,n[a+2]=u.z,n[a+3]=s.distance,a+=4}}function Gs(e,t){var i=gs.maximumTextureSize;return t.x=Math.min(e,i),t.y=Math.ceil(e/t.x),t}var ks=new ha;Is.prototype.update=function(e){var t,i,n,r,a,o=this._clippingPlanesTexture,s=e.context,u=Is.useFloatTexture(s),l=u?this.length:2*this.length;!oe(o)||((t=o.width*o.height)<l||l<.25*t)&&(o.destroy(),o=void 0,this._clippingPlanesTexture=void 0),0!==this.length&&(oe(o)||((i=Gs(l,ks)).y*=2,u?(o=new Rs({context:s,width:i.x,height:i.y,pixelFormat:hs.RGBA,pixelDatatype:ms.FLOAT,sampler:Es.NEAREST,flipY:!1}),this._float32View=new Float32Array(i.x*i.y*4)):(o=new Rs({context:s,width:i.x,height:i.y,pixelFormat:hs.RGBA,pixelDatatype:ms.UNSIGNED_BYTE,sampler:Es.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(i.x*i.y*4)),this._clippingPlanesTexture=o,this._multipleDirtyPlanes=!0),n=this._dirtyIndex,!this._multipleDirtyPlanes&&-1===n||(this._multipleDirtyPlanes?u?(Us(this,0,this._planes.length),o.copyFrom({width:o.width,height:o.height,arrayBufferView:this._float32View})):(Vs(this,0,this._planes.length),o.copyFrom({width:o.width,height:o.height,arrayBufferView:this._uint8View})):(a=r=0,u?(a=Math.floor(n/o.width),r=Math.floor(n-a*o.width),Us(this,n,n+1),o.copyFrom({width:1,height:1,arrayBufferView:this._float32View},r,a)):(a=Math.floor(2*n/o.width),r=Math.floor(2*n-a*o.width),Vs(this,n,n+1),o.copyFrom({width:2,height:1,arrayBufferView:this._uint8View},r,a))),this._multipleDirtyPlanes=!1,this._dirtyIndex=-1))};var Hs=new Rn,Ws=new fs(si.UNIT_X,0);Is.prototype.computeIntersectionWithBoundingVolume=function(e,t){var i=this._planes,n=i.length,r=this.modelMatrix;oe(t)&&(r=Rn.multiply(t,r,Hs));var a=Er.INSIDE;!this.unionClippingRegions&&0<n&&(a=Er.OUTSIDE);for(var o=0;o<n;++o){var s=i[o];fs.transform(s,r,Ws);var u=e.intersectPlane(Ws);if(u===Er.INTERSECTING)a=u;else if(this._testIntersection(u))return u}return a},Is.setOwner=function(e,t,i){e!==t[i]&&(t[i]=t[i]&&t[i].destroy(),oe(e)&&((e._owner=t)[i]=e))},Is.useFloatTexture=function(e){return e.floatingPointTexture},Is.getTextureResolution=function(e,t,i){var n=e.texture;if(oe(n))return i.x=n.width,i.y=n.height,i;var r=Gs(Is.useFloatTexture(t)?e.length:2*e.length,i);return r.y*=2,r},Is.prototype.isDestroyed=function(){return!1},Is.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),Wi(this)};var qs=new ha;var js=new si,Ys=xo.ModelState,Xs=ri.EPSILON16,Ks=new si,Zs=new pi,Js=new Rn,Qs=new qo({maxTaskConcurrency:500}),$s=(Yo._getSaverTaskProcessor(),new Rn),eu=new An(0,0,1,1),tu=new Rn,iu=new An,nu=new Rn,ru=new Rn,au=new Rr,ou=new si,su=new dr;fu._getClippingFunction=function(e,t){var i=e.unionClippingRegions,n=e.length,r=Is.useFloatTexture(t),a=Is.getTextureResolution(e,t,qs),o=a.x,s=a.y,u=(r?function(e,t){var i=1/t,n=1/e+"";-1===n.indexOf(".")&&(n+=".0");var r=i+"";-1===r.indexOf(".")&&(r+=".0");return"vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int pixY = clippingPlaneNumber / "+e+";\n    int pixX = clippingPlaneNumber - (pixY * "+e+");\n    float u = (float(pixX) + 0.5) * "+n+";\n    float v = (float(pixY) + 0.5) * "+r+";\n    vec4 plane = texture2D(packedClippingPlanes, vec2(u, v));\n    return czm_transformPlane(plane, transform);\n}\n"}:function(e,t){var i=1/t,n=1/e+"";-1===n.indexOf(".")&&(n+=".0");var r=i+"";-1===r.indexOf(".")&&(r+=".0");return"vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int clippingPlaneStartIndex = clippingPlaneNumber * 2;\n    int pixY = clippingPlaneStartIndex / "+e+";\n    int pixX = clippingPlaneStartIndex - (pixY * "+e+");\n    float u = (float(pixX) + 0.5) * "+n+";\n    float v = (float(pixY) + 0.5) * "+r+";\n    vec4 oct32 = texture2D(packedClippingPlanes, vec2(u, v)) * 255.0;\n    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);\n    vec4 plane;\n    plane.xyz = czm_octDecode(oct, 65535.0);\n    plane.w = czm_unpackFloat(texture2D(packedClippingPlanes, vec2(u + "+n+", v)));\n    return czm_transformPlane(plane, transform);\n}\n"})(o,s);return u+="\n",u+=i?"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount;\n    float pixelWidth = czm_metersPerPixel(position);\n    bool breakAndDiscard = false;\n    for (int i = 0; i < "+n+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));\n        if (amount <= 0.0)\n        {\n           breakAndDiscard = true;\n           break;\n        }\n    }\n    if (breakAndDiscard) {\n        discard;\n    }\n    return clipAmount;\n}\n":"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    bool clipped = true;\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount = 0.0;\n    float pixelWidth = czm_metersPerPixel(position);\n    for (int i = 0; i < "+n+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = max(amount, clipAmount);\n        clipped = clipped && (amount <= 0.0);\n    }\n    if (clipped)\n    {\n        discard;\n    }\n    return clipAmount;\n}\n"};var uu=new si,lu=new dr;function cu(e,t){e._cachedGltf=t}function mu(e){this._gltf=e.gltf,this.ready=e.ready,this.modelsToLoad=[],this.count=0}Object.defineProperties(mu.prototype,{gltf:{set:function(e){this._gltf=e},get:function(){return this._gltf}}}),mu.prototype.makeReady=function(e){this.gltf=e;for(var t=this.modelsToLoad,i=t.length,n=0;n<i;++n){var r=t[n];r.isDestroyed()||cu(r,this)}this.modelsToLoad=void 0,this.ready=!0};var du={},hu={};function fu(e){var t,i,n=(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT)).cacheKey;this._cacheKey=n,this._cachedGltf=void 0,this._releaseGltfJson=Cesium.defaultValue(e.releaseGltfJson,!1),Cesium.defined(n)&&Cesium.defined(du[n])&&du[n].ready?++(i=du[n]).count:(t=e.gltf,Cesium.defined(t)&&(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(i=t instanceof Uint8Array?new mu({gltf:Cesium.parseGlb(t),ready:!0}):new mu({gltf:e.gltf,ready:!0})).count=1,Cesium.defined(n)&&(du[n]=i))),cu(this,i);var r=Cesium.defaultValue(e.basePath,"");this._resource=Cesium.Resource.createIfNeeded(r);var a=e.credit;"string"==typeof a&&(a=new Cesium.Credit(a)),this._credit=a,this._resourceCredits=[],this.show=Cesium.defaultValue(e.show,!0),this.silhouetteColor=Cesium.defaultValue(e.silhouetteColor,Cesium.Color.RED),this._silhouetteColor=new Cesium.Color,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=Cesium.defaultValue(e.silhouetteSize,0),this.modelMatrix=Cesium.Matrix4.clone(Cesium.defaultValue(e.modelMatrix,Cesium.Matrix4.IDENTITY)),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=Cesium.defaultValue(e.scale,1),this._scale=this.scale,this.minimumPixelSize=Cesium.defaultValue(e.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=e.maximumScale,this._maximumScale=this.maximumScale,this.id=e.id,this._id=e.id,this.heightReference=Cesium.defaultValue(e.heightReference,Cesium.HeightReference.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;var o=e.scene;this._scene=o,Cesium.defined(o)&&Cesium.defined(o.terrainProviderChanged)&&(this._terrainProviderChangedCallback=o.terrainProviderChanged.addEventListener(function(){this._heightChanged=!0},this)),this._pickObject=e.pickObject,this._allowPicking=Cesium.defaultValue(e.allowPicking,!0),this._ready=!1,this._readyPromise=Cesium.when.defer(),this.activeAnimations=new Cesium.ModelAnimationCollection(this),this.clampAnimations=Cesium.defaultValue(e.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=Cesium.defaultValue(e.incrementallyLoadTextures,!0),this._asynchronous=Cesium.defaultValue(e.asynchronous,!0),this.shadows=Cesium.defaultValue(e.shadows,Cesium.ShadowMode.ENABLED),this._shadows=this.shadows,this.color=Cesium.Color.clone(Cesium.defaultValue(e.color,Cesium.Color.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=Cesium.defaultValue(e.colorBlendMode,Cesium.ColorBlendMode.HIGHLIGHT),this.colorBlendAmount=Cesium.defaultValue(e.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._clippingPlanesState=0,this.clippingPlanesOriginMatrix=void 0,this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Cesium.defaultValue(e.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=e.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=e.addBatchIdToGeneratedShaders,this._precreatedAttributes=e.precreatedAttributes,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=Cesium.defaultValue(e.ignoreCommands,!1),this._requestType=e.requestType,this._upAxis=Cesium.defaultValue(e.upAxis,Cesium.Axis.Y),this._gltfForwardAxis=Cesium.Axis.Z,this._forwardAxis=e.forwardAxis,this.cull=Cesium.defaultValue(e.cull,!0),this.opaquePass=Cesium.defaultValue(e.opaquePass,Cesium.Pass.OPAQUE),this._computedModelMatrix=new Cesium.Matrix4,this._clippingPlaneModelViewMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new Cesium.BoundingSphere,this._state=Ys.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=Cesium.defaultValue(e.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this._lightColor=Cesium.Cartesian3.clone(e.lightColor),this._luminanceAtZenith=void 0,this.luminanceAtZenith=Cesium.defaultValue(e.luminanceAtZenith,.2),this._sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._shouldUpdateSpecularMapAtlas=!0,this._specularEnvironmentMapAtlas=void 0,this._useDefaultSphericalHarmonics=!1,this._useDefaultSpecularMaps=!1,this._shouldRegenerateShaders=!1,this._enableFog=!1,this.meshPrimitives=[],Cesium.defined(e.sharedResources)&&Cesium.defined(e.sharedResources.ktxs)&&Cesium.defined(e.sharedResources.instancedPrograms)?(this.childrenTilesetUri=e.sharedResources.ktxs.name,this.ktxs=e.sharedResources.ktxs,this.instancedPrograms=e.sharedResources.instancedPrograms.shadredData):(this.childrenTilesetUri="",this.ktxs={},this.instancedPrograms={}),this.content=Cesium.defaultValue(e.content,void 0),this.ev_E3MInternalInstance=Cesium.defined(this.content)?new Cesium.EV_E3MInternalInstance({model:this}):void 0,this.modelSpecular=Cesium.defaultValue(e.specular,.5),this.rollerRegion=Cesium.defaultValue(e.rollerRegion,new Cesium.Cartesian4(0,0,1,1)),this.recreateVertexArraysOnce=!1,this._boundingBox=void 0}function pu(e){return e.stencilBuffer}function _u(e){return!Cesium.Color.equals(e.color,Cesium.Color.WHITE)||e.colorBlendMode!==Cesium.ColorBlendMode.HIGHLIGHT}function Cu(e){var t=e._clippingPlanes;return Cesium.defined(t)&&t.enabled&&0!==t.length}function gu(e,t,i){return e._runtime[t][i]}function vu(e,t){var i,n=e.currentValue,r=Ks;switch(e.type){case"xRotate":i=Cesium.Matrix3.fromRotationX(Cesium.Math.toRadians(n),Zs),Cesium.Matrix4.multiplyByMatrix3(t,i,t);break;case"yRotate":i=Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(n),Zs),Cesium.Matrix4.multiplyByMatrix3(t,i,t);break;case"zRotate":i=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(n),Zs),Cesium.Matrix4.multiplyByMatrix3(t,i,t);break;case"xTranslate":r.x=n,r.y=0,r.z=0,Cesium.Matrix4.multiplyByTranslation(t,r,t);break;case"yTranslate":r.x=0,r.y=n,r.z=0,Cesium.Matrix4.multiplyByTranslation(t,r,t);break;case"zTranslate":r.x=0,r.y=0,r.z=n,Cesium.Matrix4.multiplyByTranslation(t,r,t);break;case"xScale":r.x=n,r.y=1,r.z=1,Cesium.Matrix4.multiplyByScale(t,r,t);break;case"yScale":r.x=1,r.y=n,r.z=1,Cesium.Matrix4.multiplyByScale(t,r,t);break;case"zScale":r.x=1,r.y=1,r.z=n,Cesium.Matrix4.multiplyByScale(t,r,t);break;case"uniformScale":Cesium.Matrix4.multiplyByUniformScale(t,n,t)}return t}function yu(n,r){return function(e){var t=n._loadResources,i=new Uint8Array(e);--t.pendingBufferLoads,n.gltf.buffers[r].extras._pipeline.source=i}}function Tu(n,r,a,o){return function(e){var t=n.gltfShader,i=n._loadResources;i.shaders[a]={source:e,type:r,bufferView:void 0},--i.pendingShaderLoads,n._rendererResources.sourceShaders[a]=e,Cesium.defined(t)&&(!Cesium.defined(t[o])||Cesium.defined(t[o])&&"function"==typeof t[o].then)&&(t[o]=e)}}function xu(_){var e=_.gltf,C=e.buffers,g=e.bufferViews,v=_._rendererResources.sourceShaders;Cesium.ForEach.shader(e,function(e,t){var i,n,r,a,o,s,u,l,c,m,d,h,f,p;Cesium.defined(e.bufferView)?(i=e.bufferView,r=(n=g[i]).buffer,a=C[r],u=Cesium.getStringFromTypedArray(a.extras._pipeline.source,n.byteOffset,n.byteLength),v[t]=u):Cesium.defined(e.extras._pipeline.source)?v[t]=e.extras._pipeline.source:(++_._loadResources.pendingShaderLoads,o=_._resource._url.substring(0,_._resource._url.lastIndexOf("/")+1)+e.uri,s=_.gltfShader,Cesium.defined(s)&&Cesium.defined(s[o])?"function"==typeof(u=s[o]).then?u.then(Tu(_,e.type,t,o)).otherwise(Cesium.ModelUtility.getFailedLoadFunction(_,"shader",o)):(m=_,d=e.type,h=t,f=u,p=m._loadResources,f=f.replace("material.shininess = 1.0;","material.shininess = 2.0;"),p.shaders[h]={source:f,type:d,bufferView:void 0},--p.pendingShaderLoads,m._rendererResources.sourceShaders[h]=f):(c=(l=_._resource.getDerivedResource({url:e.uri})).fetchText(),Cesium.defined(_.gltfShader)&&(_.gltfShader[o]=c),c.then(Tu(_,e.type,t,l._url)).otherwise(Cesium.ModelUtility.getFailedLoadFunction(_,"shader",l.url))))})}function wu(i,n,r){return function(e){Cesium.defined(r)&&Cesium.defined(i.ktxs)&&(Cesium.defined(i.ktxs[r])&&"function"==typeof i.ktxs[r].then||!Cesium.defined(i.ktxs[r]))&&(i.ktxs[r]=e);var t=i._loadResources;--t.pendingTextureLoads,t.texturesToCreate.enqueue({id:n,image:e,bufferView:e.bufferView,width:e.width,height:e.height,internalFormat:e.internalFormat})}}function Au(e,t,i){var n=e._loadResources;--n.pendingTextureLoads,n.texturesToCreate.enqueue({id:t,image:i,bufferView:i.bufferView,width:i.width,height:i.height,internalFormat:i.internalFormat})}Object.defineProperties(fu.prototype,{gltf:{get:function(){return Cesium.defined(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var e=this.modelMatrix;this.heightReference!==Cesium.HeightReference.NONE&&this._clampedModelMatrix&&(e=this._clampedModelMatrix);var t=Cesium.Matrix4.getScale(e,js),i=Cesium.defined(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;Cesium.Cartesian3.multiplyByScalar(t,i,t);var n=this._scaledBoundingSphere;return n.center=Cesium.Cartesian3.multiplyComponents(this._boundingSphere.center,t,n.center),n.radius=Cesium.Cartesian3.maximumComponent(t)*this._initialRadius,Cesium.defined(this._rtcCenter)&&Cesium.Cartesian3.add(this._rtcCenter,n.center,n.center),n}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return Cesium.defined(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){this._distanceDisplayCondition=Cesium.DistanceDisplayCondition.clone(e,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return Cesium.defined(this._extensionsUsed)||(this._extensionsUsed=Cesium.ModelUtility.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return Cesium.defined(this._extensionsRequired)||(this._extensionsRequired=Cesium.ModelUtility.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return Cesium.defined(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&Cesium.ClippingPlaneCollection.setOwner(e,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){var t=this._imageBasedLightingFactor;e===t||Cesium.Cartesian2.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||0<this._imageBasedLightingFactor.x&&0===e.x||0===this._imageBasedLightingFactor.x&&0<e.x,this._shouldRegenerateShaders=this._shouldRegenerateShaders||0<this._imageBasedLightingFactor.y&&0===e.y||0===this._imageBasedLightingFactor.y&&0<e.y,Cesium.Cartesian2.clone(e,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(e){var t=this._lightColor;e===t||Cesium.Cartesian3.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Cesium.defined(t)&&!Cesium.defined(e)||Cesium.defined(e)&&!Cesium.defined(t),this._lightColor=Cesium.Cartesian3.clone(e,t))}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){var t=this._luminanceAtZenith;e!==t&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||Cesium.defined(t)&&!Cesium.defined(e)||Cesium.defined(e)&&!Cesium.defined(t),this._luminanceAtZenith=e)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){e!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=e,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||e!==this._specularEnvironmentMaps,this._specularEnvironmentMaps=e}},credit:{get:function(){return this._credit}}}),fu.silhouetteSupported=function(e){return pu(e.context)},fu.fromGltf=function(e){var t=e.url;e=Cesium.clone(e);var l=Cesium.Resource.createIfNeeded(t),i=Cesium.defaultValue(e.basePath,l.clone()),n=Cesium.Resource.createIfNeeded(i),r=Cesium.defaultValue(e.cacheKey,hu[Cesium.getAbsoluteUri(l.url)]);Cesium.defined(r)||(r=Cesium.createGuid(),hu[Cesium.getAbsoluteUri(l.url)]=r),Cesium.defined(e.basePath)&&!Cesium.defined(e.cacheKey)&&(r+=n.url),e.cacheKey=r,e.basePath=n;var c=new fu(e),m=du[r];return Cesium.defined(m)?m.ready||(++m.count,m.modelsToLoad.push(c)):((m=new mu({ready:!1})).count=1,m.modelsToLoad.push(c),cu(c,m),du[r]=m,Cesium.defined(l.headers.Accept)||(l.headers.Accept="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01"),l.fetchArrayBuffer().then(function(e){var t,i,n,r=new Uint8Array(e);n=r,"glTF"===Cesium.getMagic(n)?(t=Cesium.parseGlb(r),m.makeReady(t)):(i=Cesium.getStringFromTypedArray(r),m.makeReady(JSON.parse(i)));var a=c._resourceCredits,o=l.credits;if(Cesium.defined(o))for(var s=o.length,u=0;u<s;u++)a.push(o[u])}).otherwise(Cesium.ModelUtility.getFailedLoadFunction(c,"model",l.url))),c},fu._gltfCache=du,fu.prototype.getNode=function(e){var t=gu(this,"nodesByName",e);return Cesium.defined(t)?t.publicNode:void 0},fu.prototype.getMesh=function(e){return gu(this,"meshesByName",e)},fu.prototype.getMaterial=function(e){return gu(this,"materialsByName",e)},fu.prototype.setArticulationStage=function(e,t){var i=gu(this,"stagesByKey",e),n=gu(this,"articulationsByStageKey",e);Cesium.defined(i)&&Cesium.defined(n)&&(t=Cesium.Math.clamp(t,i.minimumValue,i.maximumValue),Cesium.Math.equalsEpsilon(i.currentValue,t,Xs)||(i.currentValue=t,n.isDirty=!0))},fu.prototype.applyArticulations=function(){var e=this._runtime.articulationsByName;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];if(i.isDirty){i.isDirty=!1;for(var n=i.nodes.length,r=0;r<n;++r){for(var a=i.nodes[r],o=Cesium.Matrix4.clone(a.originalMatrix,Js),s=i.stages.length,u=0;u<s;++u)o=vu(i.stages[u],o);a.matrix=o}}}};var Eu=/(^data:image\/ktx)|(data:image\/ktx)|(\.ktx$)|(\.ktx.gz$)/i,Su=/(^data:image\/crn)|(\.crn$)/i,bu=/(^data:image\/pkm)|(\.pkm$)|(\.pkm.gz$)/i;function Mu(e,t,i){!function(p,_,C){var g,e=p.gltf,v=e.images;p.childrenTilesetUri;Cesium.ForEach.texture(e,function(e,t){var i=e.source;Cesium.defined(e.extensions)&&Cesium.defined(e.extensions.EXT_texture_webp)&&C&&(i=e.extensions.EXT_texture_webp.source);var n,r,a,o,s,u,l,c,m,d,h,f=v[i];Cesium.defined(f)&&(n=f.extras,r=f.bufferView,a=f.mimeType,g=f.uri,Cesium.defined(n)&&Cesium.defined(n.compressedImage3DTiles)&&(o=n.compressedImage3DTiles.crunch,s=n.compressedImage3DTiles.s3tc,u=n.compressedImage3DTiles.pvrtc1,l=n.compressedImage3DTiles.etc1,_.s3tc&&Cesium.defined(o)?(a=o.mimeType,Cesium.defined(o.bufferView)?r=o.bufferView:g=o.uri):_.s3tc&&Cesium.defined(s)?(a=s.mimeType,Cesium.defined(s.bufferView)?r=s.bufferView:g=s.uri):_.pvrtc&&Cesium.defined(u)?(a=u.mimeType,Cesium.defined(u.bufferView)?r=u.bufferView:g=u.uri):_.etc1&&Cesium.defined(l)&&(a=l.mimeType,Cesium.defined(l.bufferView)?r=l.bufferView:g=l.uri)),Cesium.defined(r)?p._loadResources.texturesToCreateFromBufferView.enqueue({id:t,image:void 0,bufferView:r,mimeType:a}):(++p._loadResources.pendingTextureLoads,c=p._resource.getDerivedResource({url:g}),m=p.ktxs,Cesium.defined(m)&&-1===g.indexOf("data:image/")?(d=m[c._url],Cesium.defined(d)?"function"==typeof d.then?d.then(wu(p,t,c._url)).otherwise(Cesium.ModelUtility.getFailedLoadFunction(p,"image",c.url)):(Cesium.defined(d.arrayBufferView)&&delete d.arrayBufferView,Au(p,t,d)):(h={keyName:c._url,model:p,imageResource:c,uri:g,id:t,data:void 0,downloadSuccessFun:Du,downloadErrorFun:Ru},Qs.loadCesium3DTileTexture(h))):(Eu.test(g)?Cesium.loadKTX(c):Su.test(g)?Cesium.loadCRN(c):bu.test(g)?Cesium.EV_LoadETC(c):c.fetchImage()).then(wu(p,t)).otherwise(Cesium.ModelUtility.getFailedLoadFunction(p,"image",c.url))))})}(e,t,i)}function Ru(e){var t,i,n,r,a,o,s,u,l,c;Cesium.defined(e)&&(t=e.model,i=e.imageResource,n=e.keyName,r=e.id,a=t.ktxs,o=Eu.test(n)?Cesium.loadKTX(i):Su.test(n)?Cesium.loadCRN(i):bu.test(n)?Cesium.EV_LoadETC(i):i.fetchImage(),(a[n]=o).then((s=t,u=r,l=n,c=e,function(e){"HTMLImageElement"!=(c.data=e).constructor.name&&Cesium.EV_Cesium3DTileSaver.saveCesium3DTile(c),Cesium.defined(l)&&Cesium.defined(s.ktxs)&&(Cesium.defined(s.ktxs[l])&&"function"==typeof s.ktxs[l].then||!Cesium.defined(s.ktxs[l]))&&(s.ktxs[l]=e);var t=s._loadResources;--t.pendingTextureLoads,t.texturesToCreate.enqueue({id:u,image:e,bufferView:e.bufferView,width:e.width,height:e.height,internalFormat:e.internalFormat})})).otherwise(Cesium.ModelUtility.getFailedLoadFunction(t,"image",i.url)))}function Du(e,t){if(Cesium.defined(e)){var i,n=e.model,r=e.keyName,a=e.id;if(0<t.length){for(var o=new Array(t.length),s=0;s<t.length;s++)o[s]=new Cesium.CompressedTextureBuffer(t[s]._format,t[s]._width,t[s]._height,t[s]._buffer);n.ktxs[r]=o}Cesium.defined(t._buffer)&&(i=new Cesium.CompressedTextureBuffer(t._format,t._width,t._height,t._buffer),n.ktxs[r]=i),Cesium.defined(n.ktxs[r])&&Au(n,a,n.ktxs[r])}}function Pu(){this.id=void 0,this.model=void 0,this.context=void 0}function Iu(e,t,i){var n=t._loadResources,r=t.gltf.bufferViews[e];Cesium.defined(r)||(r=n.createdBufferViews[e]);var a=Cesium.Buffer.createVertexBuffer({context:i,typedArray:n.getBuffer(r),usage:Cesium.BufferUsage.STATIC_DRAW});a.vertexArrayDestroyable=!1,t._rendererResources.buffers[e]=a,t._geometryByteLength+=a.sizeInBytes}Pu.prototype.set=function(e,t,i){this.id=e,this.model=t,this.context=i},Pu.prototype.execute=function(){Iu(this.id,this.model,this.context)};function Ou(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0}function Lu(e,t,i,n){var r=i._loadResources,a=i.gltf.bufferViews[e];Cesium.defined(a)||(a=r.createdBufferViews[e]);var o=Cesium.Buffer.createIndexBuffer({context:n,typedArray:r.getBuffer(a),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:t});o.vertexArrayDestroyable=!1,i._rendererResources.buffers[e]=o,i._geometryByteLength+=o.sizeInBytes}Ou.prototype.set=function(e,t,i,n){this.id=e,this.componentType=t,this.model=i,this.context=n},Ou.prototype.execute=function(){Lu(this.id,this.componentType,this.model,this.context)};var Nu=new Pu,Bu=new Ou;function zu(e,t){var i=e._runtime.materialsById[t.material];if(Cesium.defined(i))return i._program}function Fu(e,t,i){var n,r,a,o=i._programPrimitives[t];if(!Cesium.defined(o))return e;for(r in o)if(o.hasOwnProperty(r)&&zu(i,n=o[r])===t)break;if(i._programPrimitives[t]=void 0,i.extensionsUsed.WEB3D_quantized_attributes)a=Cesium.ModelUtility.modifyShaderForQuantizedAttributes(i.gltf,n,e),i._quantizedUniforms[t]=a.uniforms;else{var s=i._decodedData[r];if(!Cesium.defined(s))return e;a=Cesium.ModelUtility.modifyShaderForDracoQuantizedAttributes(i.gltf,n,e,s.attributes)}return a.shader}function Vu(e,t,i){return Cesium.defined(i)&&(e=i(e,t)),e}function Uu(){this.programToCreate=void 0,this.model=void 0,this.context=void 0}function Gu(e,t,i){var n=e.programId,r=e.techniqueId,a=t._sourcePrograms[n],o=t._rendererResources.sourceShaders,s=o[a.vertexShader],u=o[a.fragmentShader];u+="uniform vec4 u_rollerRegion;";var l,c=t._quantizedVertexShaders,m=t._toClipCoordinatesGLSL[n];(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(l=c[n],Cesium.defined(l)||(l=Fu(s,n,t),c[n]=l),s=l);var d,h=Vu(s,n,t._vertexShaderLoaded),f=Vu(u,n,t._fragmentShaderLoaded);Cesium.FeatureDetection.isInternetExplorer()||(h=Cesium.ModelUtility.modifyVertexShaderForLogDepth(h,m),f=t.rollerRegion.equals(eu)?Cesium.ModelUtility.modifyFragmentShaderForLogDepth(f):Cesium.ModelUtility.modifyFragmentShaderForLogDepthAddRoller(f)),Cesium.defined(t._uniformMapLoaded)||(f="uniform vec4 czm_pickColor;\n"+f),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((d=(h="\n varying vec4 v_worldPosition; \n"+h).lastIndexOf("}"))&&(h=h.slice(0,d)+"vec4 eyePostion = czm_inverseProjection * gl_Position; \n v_worldPosition = czm_inverseView3D * eyePostion; \n"+h.slice(d)),f="\nvarying vec4 v_worldPosition; \n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) \nuniform float u_minimumBrightness ;\n#endif \nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n} \n"+Cesium.GroundAtmosphere+"\n"+f,t._scene.fog.enabled&&(f="#define FOG \n\n"+f));var p,_,C,g=0<t._imageBasedLightingFactor.x||0<t._imageBasedLightingFactor.y;g&&(f="#define USE_IBL_LIGHTING \n\n"+f),Cesium.defined(t._lightColor)&&(f="#define USE_CUSTOM_LIGHT_COLOR \n\n"+f),"2.0"===t._sourceVersion&&!t._sourceKHRTechniquesWebGL||(f=Cesium.ShaderSource.replaceMain(f,"non_gamma_corrected_main"),f+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((p=f.lastIndexOf("}"))&&(f=f.slice(0,p)+"\n#if defined(FOG)\n  vec4 finalColor =  gl_FragColor; \n  float vDistance =  length((czm_view3D * v_worldPosition).xyz); \n  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(v_worldPosition.x, v_worldPosition.y, v_worldPosition.z), false, vec3(0.0));\n  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);\n #ifndef HDR\n  const float fExposure = 4.0;\n  fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n #endif\n #ifdef FOG\n   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\n      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\n      fogColor *= darken;\n   #endif\n   #ifdef HDR\n       const float modifier = 0.15;\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);\n    #else\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);\n    #endif\n #endif\n gl_FragColor = finalColor;\n#endif\n"+f.slice(p))),Cesium.OctahedralProjectedCubeMap.isSupported(i)&&(_=Cesium.defined(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,C=Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,(_||C||g)&&(f="uniform mat4 gltf_clippingPlanesMatrix; \n"+f),Cesium.defined(t._sphericalHarmonicCoefficients)?f="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+f:t._useDefaultSphericalHarmonics&&(f="#define DIFFUSE_IBL \n"+f),Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?f="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+f:t._useDefaultSpecularMaps&&(f="#define SPECULAR_IBL \n"+f)),Cesium.defined(t._luminanceAtZenith)&&(f="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+f),Hu(n,r,f,h,t,i)}function ku(e,t,i){var n=e.programId,r=e.techniqueId,a=t._sourcePrograms[n],o=t._rendererResources.sourceShaders,s=t._quantizedVertexShaders,u=t._toClipCoordinatesGLSL[n],l=t.clippingPlanes,c=Cu(t),m=o[a.vertexShader],d=o[a.fragmentShader];d+="uniform vec4 u_rollerRegion;",(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(m=s[n]);var h,f,p,_=d;_u(t)&&(_=fu._modifyShaderForColor(_)),c&&(h=_,f=l,p=i,h=Cesium.ShaderSource.replaceMain(h,"gltf_clip_main"),h+=fu._getClippingFunction(f,p)+"\n",_=h+="uniform sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+Cesium.getClipAndStyleCode("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n");var C,g=Vu(m,n,t._vertexShaderLoaded),v=Vu(_,n,t._fragmentShaderLoaded);Cesium.FeatureDetection.isInternetExplorer()||(g=Cesium.ModelUtility.modifyVertexShaderForLogDepth(g,u),v=t.rollerRegion.equals(eu)?Cesium.ModelUtility.modifyFragmentShaderForLogDepth(v):Cesium.ModelUtility.modifyFragmentShaderForLogDepthAddRoller(v)),Cesium.defined(t._uniformMapLoaded)||(v="uniform vec4 czm_pickColor;\n"+v),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((C=(g="\n varying vec4 v_worldPosition; \n"+g).lastIndexOf("}"))&&(g=g.slice(0,C)+"vec4 eyePostion = czm_inverseProjection * gl_Position; \nv_worldPosition = czm_inverseView3D * eyePostion; \n"+g.slice(C)),v="\nvarying vec4 v_worldPosition; \n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE) \nuniform float u_minimumBrightness ;\n#endif \nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n} \n"+Cesium.GroundAtmosphere+"\n"+v,t._scene.fog.enabled&&(v="#define FOG \n\n"+v));var y,T,x,w=0<t._imageBasedLightingFactor.x||0<t._imageBasedLightingFactor.y;w&&(v="#define USE_IBL_LIGHTING \n\n"+v),Cesium.defined(t._lightColor)&&(v="#define USE_CUSTOM_LIGHT_COLOR \n\n"+v),"2.0"===t._sourceVersion&&!t._sourceKHRTechniquesWebGL||(v=Cesium.ShaderSource.replaceMain(v,"non_gamma_corrected_main"),v+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),Cesium.defined(t._scene)&&Cesium.defined(t._scene.ev_Fog)&&t._scene.ev_Fog.enabled&&((y=v.lastIndexOf("}"))&&(v=v.slice(0,y)+"\n#if defined(FOG)\n  vec4 finalColor =  gl_FragColor; \n  float vDistance =  length((czm_view3D * v_worldPosition).xyz); \n  AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(vec3(v_worldPosition.x, v_worldPosition.y, v_worldPosition.z), false, vec3(0.0));\n  vec3 fogColor = colorCorrect(atmosFogColor.mie) + finalColor.rgb * colorCorrect(atmosFogColor.rayleigh);\n #ifndef HDR\n  const float fExposure = 4.0;\n  fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n #endif\n #ifdef FOG\n   #if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\n      float darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\n      fogColor *= darken;\n   #endif\n   #ifdef HDR\n       const float modifier = 0.15;\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor, modifier), finalColor.a);\n    #else\n      finalColor = vec4(czm_fog(vDistance, finalColor.rgb, fogColor), finalColor.a);\n    #endif\n #endif\n gl_FragColor = finalColor;\n#endif\n"+v.slice(y))),Cesium.OctahedralProjectedCubeMap.isSupported(i)&&(T=Cesium.defined(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,x=Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps,!c&&(T||x||w)&&(v="uniform mat4 gltf_clippingPlanesMatrix; \n"+v),Cesium.defined(t._sphericalHarmonicCoefficients)?v="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+v:t._useDefaultSphericalHarmonics&&(v="#define DIFFUSE_IBL \n"+v),Cesium.defined(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?v="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+v:t._useDefaultSpecularMaps&&(v="#define SPECULAR_IBL \n"+v)),Cesium.defined(t._luminanceAtZenith)&&(v="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+v),Hu(n,r,v,g,t,i)}function Hu(e,t,i,n,r,a){var o=r._sourceTechniques[t],s=Cesium.ModelUtility.createAttributeLocations(o,r._precreatedAttributes);r._rendererResources.programs[e]=Cesium.ShaderProgram.fromCache({context:a,vertexShaderSource:n,fragmentShaderSource:i,attributeLocations:s})}Uu.prototype.set=function(e,t,i){this.programToCreate=e,this.model=t,this.context=i},Uu.prototype.execute=function(){Gu(this.programToCreate,this.model,this.context)};var Wu=new Uu;function qu(t,i){return function(e){t.texturesToCreate.enqueue({id:i.id,image:e,bufferView:void 0}),--t.pendingBufferViewToImage}}function ju(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0}function Yu(e,t,i){var n=t.gltf.textures[e.id],r=t._rendererResources.samplers[n.sampler];Cesium.defined(r)||(r=new Cesium.Sampler({wrapS:Cesium.TextureWrap.REPEAT,wrapT:Cesium.TextureWrap.REPEAT}));for(var a=!1,o=t.gltf.materials,s=o.length,u=0;u<s;++u){var l=o[u];if(Cesium.defined(l.extensions)&&Cesium.defined(l.extensions.KHR_techniques_webgl)){var c=l.extensions.KHR_techniques_webgl.values;for(var m in c)if(c.hasOwnProperty(m)&&-1!==m.indexOf("Texture")){var d=c[m];if(d.index===e.id&&Cesium.defined(d.extensions)&&Cesium.defined(d.extensions.KHR_texture_transform)){a=!0;break}}}if(a)break}var h=r.wrapS,f=r.wrapT,p=r.minificationFilter;a&&p!==Cesium.TextureMinificationFilter.LINEAR&&p!==Cesium.TextureMinificationFilter.NEAREST&&(p=p===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST||p===Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR?Cesium.TextureMinificationFilter.NEAREST:Cesium.TextureMinificationFilter.LINEAR,r=new Cesium.Sampler({wrapS:r.wrapS,wrapT:r.wrapT,textureMinificationFilter:p,textureMagnificationFilter:r.magnificationFilter}));var _,C,g,v,y=e.internalFormat,T=!(Cesium.defined(y)&&Cesium.PixelFormat.isCompressedFormat(y)||p!==Cesium.TextureMinificationFilter.NEAREST_MIPMAP_NEAREST&&p!==Cesium.TextureMinificationFilter.NEAREST_MIPMAP_LINEAR&&p!==Cesium.TextureMinificationFilter.LINEAR_MIPMAP_NEAREST&&p!==Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR),x=T||h===Cesium.TextureWrap.REPEAT||h===Cesium.TextureWrap.MIRRORED_REPEAT||f===Cesium.TextureWrap.REPEAT||f===Cesium.TextureWrap.MIRRORED_REPEAT,w=Cesium.defined(e.image.length)?Cesium.clone(e.image,!1):e.image;Cesium.defined(y)?v=new Cesium.Texture({context:i,source:{arrayBufferView:e.bufferView},width:e.width,height:e.height,pixelFormat:y,sampler:r}):Cesium.defined(w)&&(Cesium.defined(w.width)&&Cesium.defined(w.height)?(_=!Cesium.Math.isPowerOfTwo(w.width)||!Cesium.Math.isPowerOfTwo(w.height),x&&_&&((C=document.createElement("canvas")).width=Cesium.Math.nextPowerOfTwo(w.width),C.height=Cesium.Math.nextPowerOfTwo(w.height),C.getContext("2d").drawImage(w,0,0,w.width,w.height,0,0,C.width,C.height),w=C),v=new Cesium.Texture({context:i,source:w,pixelFormat:n.internalFormat,sampler:r,flipY:!1}),T&&v.generateMipmap()):Cesium.defined(w.length)&&0<w.length&&(g=w[0],v=new Cesium.Texture({context:i,source:w,width:g.width,height:g.height,pixelFormat:g.internalFormat,sampler:r}))),Cesium.defined(v)&&(t._rendererResources.textures[e.id]=v,t._texturesByteLength+=v.sizeInBytes)}ju.prototype.set=function(e,t,i){this.gltfTexture=e,this.model=t,this.context=i},ju.prototype.execute=function(){Yu(this.gltfTexture,this.model,this.context)};var Xu=new ju;function Ku(e,t){var i,n,r=e._sourceTechniques,a={},o=e._runtime.materialsById[t.material];if(!Cesium.defined(o))return a;var s=r[o._technique];if(!Cesium.defined(s))return a;var u,l=s.attributes,c=e._rendererResources.programs[s.program],m=c.vertexAttributes,d=c._attributeLocations;for(i in m){m.hasOwnProperty(i)&&(u=l[i],Cesium.defined(u)&&(n=d[i],a[u.semantic]=n))}var h=e._precreatedAttributes;if(Cesium.defined(h))for(i in h)h.hasOwnProperty(i)&&(n=d[i],a[i]=n);return a}function Zu(r){var e,a,o,t=r._loadResources;0===t.pendingBufferLoads&&t.createSkins&&(t.createSkins=!1,e=r.gltf,a=e.accessors,o={},Cesium.ForEach.skin(e,function(e,t){var i,n=a[e.inverseBindMatrices];Cesium.Matrix4.equals(e.bindShapeMatrix,Cesium.Matrix4.IDENTITY)||(i=Cesium.Matrix4.clone(e.bindShapeMatrix)),o[t]={inverseBindMatrices:Cesium.ModelAnimationCache.getSkinInverseBindMatrices(r,n),bindShapeMatrix:i}}),function(e,t){for(var i=e.gltf,n=i.skins,r=i.nodes,a=e._runtime.nodes,o=e._loadResources.skinnedNodesIds,s=o.length,u=0;u<s;++u){var l=o[u],c=a[l],m=r[l],d=t[m.skin];c.inverseBindMatrices=d.inverseBindMatrices,c.bindShapeMatrix=d.bindShapeMatrix;for(var h=n[m.skin].joints,f=h.length,p=0;p<f;++p){var _=a[h[p]];c.joints.push(_)}}}(r,o))}function Ju(t,i,n,r){return function(e){Cesium.defined(r)&&(e=t.clampAnimations?r.clampTime(e):r.wrapTime(e),i[n]=r.evaluate(e,i[n]),i.dirtyNumber=t._maxDirtyNumber)}}function Qu(d,h){var f,p,_,C,e=d._loadResources;e.finishedBuffersCreation()&&e.finishedProgramCreation()&&e.createVertexArrays&&(e.createVertexArrays=!1,f=d._rendererResources.buffers,p=d._rendererResources.vertexArrays,_=d.gltf,C=_.accessors,Cesium.ForEach.mesh(_,function(e,m){Cesium.ForEach.meshPrimitive(e,function(e,t){var o,i,n,s=[],u=Ku(d,e),l=d._decodedData[m+".primitive."+t];Cesium.ForEach.meshPrimitiveAttribute(e,function(e,t){if(o=u[t],Cesium.defined(o)){if(Cesium.defined(l)){var i=l.attributes;if(i.hasOwnProperty(t)){var n=i[t];return void s.push({index:o,vertexBuffer:f[n.bufferView],componentsPerAttribute:n.componentsPerAttribute,componentDatatype:n.componentDatatype,normalize:n.normalized,offsetInBytes:n.byteOffset,strideInBytes:n.byteStride})}}var r=C[e],a=Cesium.defined(r.normalized)&&r.normalized;s.push({index:o,vertexBuffer:f[r.bufferView],componentsPerAttribute:Cesium.numberOfComponentsForType(r.type),componentDatatype:r.componentType,normalize:a,offsetInBytes:r.byteOffset,strideInBytes:Cesium.getAccessorByteStride(_,r)})}});var r,a,c=d._precreatedAttributes;if(Cesium.defined(c))for(n in c)c.hasOwnProperty(n)&&(o=u[n],Cesium.defined(o)&&((i=c[n]).index=o,s.push(i)));Cesium.defined(e.indices)&&(a=C[e.indices].bufferView,Cesium.defined(l)&&(a=l.bufferView),r=f[a]),p[m+".primitive."+t]=new Cesium.VertexArray({context:h,attributes:s,indexBuffer:r})})}))}function $u(i){var e=i._loadResources;e.createRenderStates&&(e.createRenderStates=!1,Cesium.ForEach.material(i.gltf,function(e,t){!function(e,t,i){var n=e._rendererResources.renderStates,r=[Cesium.WebGLConstants.FUNC_ADD,Cesium.WebGLConstants.FUNC_ADD],a=[Cesium.WebGLConstants.ONE,Cesium.WebGLConstants.ONE_MINUS_SRC_ALPHA,Cesium.WebGLConstants.ONE,Cesium.WebGLConstants.ONE_MINUS_SRC_ALPHA];Cesium.defined(t.extensions)&&Cesium.defined(t.extensions.KHR_blend)&&(r=t.extensions.KHR_blend.blendEquation,a=t.extensions.KHR_blend.blendFactors);var o=!t.doubleSided,s="BLEND"===t.alphaMode;n[i]=Cesium.RenderState.fromCache({cull:{enabled:o},depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!s,blending:{enabled:s,equationRgb:r[0],equationAlpha:r[1],functionSourceRgb:a[0],functionDestinationRgb:a[1],functionSourceAlpha:a[2],functionDestinationAlpha:a[3]}})}(i,e,t)}))}var el={MODEL:function(e,t,i){return function(){return i.computedMatrix}},VIEW:function(e,t,i){return function(){return e.view}},PROJECTION:function(e,t,i){return function(){return e.projection}},MODELVIEW:function(e,t,i){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,i.computedMatrix,n)}},CESIUM_RTC_MODELVIEW:function(e,t,i){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,i.computedMatrix,n),Cesium.Matrix4.setTranslation(n,t._rtcCenterEye,n)}},MODELVIEWPROJECTION:function(e,t,i){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,i.computedMatrix,n),Cesium.Matrix4.multiply(e._projection,n,n)}},MODELINVERSE:function(e,t,i){var n=new Cesium.Matrix4;return function(){return Cesium.Matrix4.inverse(i.computedMatrix,n)}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t,i){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t,i){var n=new Cesium.Matrix4,r=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,i.computedMatrix,n),Cesium.Matrix4.inverse(n,r)}},MODELVIEWPROJECTIONINVERSE:function(e,t,i){var n=new Cesium.Matrix4,r=new Cesium.Matrix4;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,i.computedMatrix,n),Cesium.Matrix4.multiply(e._projection,n,n),Cesium.Matrix4.inverse(n,r)}},MODELINVERSETRANSPOSE:function(e,t,i){var n=new Cesium.Matrix4,r=new Cesium.Matrix3;return function(){return Cesium.Matrix4.inverse(i.computedMatrix,n),Cesium.Matrix4.getMatrix3(n,r),Cesium.Matrix3.transpose(r,r)}},MODELVIEWINVERSETRANSPOSE:function(e,t,i){var n=new Cesium.Matrix4,r=new Cesium.Matrix4,a=new Cesium.Matrix3;return function(){return Cesium.Matrix4.multiplyTransformation(e.view,i.computedMatrix,n),Cesium.Matrix4.inverse(n,r),Cesium.Matrix4.getMatrix3(r,a),Cesium.Matrix3.transpose(a,a)}},VIEWPORT:function(e,t,i){return function(){return e.viewportCartesian4}}};function tl(m,d,e,h,f,p,_){var C,g,v={},y={};return Cesium.ForEach.techniqueUniform(e,function(e,t){var i,n,r,a,o,s,u,l,c;Cesium.defined(h)&&Cesium.defined(h[t])?(r=Cesium.ModelUtility.createUniformFunction(e.type,h[t],p,_),v[t]=r.func,y[t]=r):Cesium.defined(e.node)?v[t]=(o=e.node,s=m,u=e.semantic,l=f.uniformState,c=s._runtime.nodes[o],el[u](l,s,c)):Cesium.defined(e.semantic)?"JOINTMATRIX"===e.semantic?C=t:"MORPHWEIGHTS"===e.semantic?g=t:"ALPHACUTOFF"===e.semantic?(i=d.alphaMode,Cesium.defined(i)&&"MASK"===i&&(n=Cesium.defaultValue(d.alphaCutoff,.5),r=Cesium.ModelUtility.createUniformFunction(e.type,n,p,_),v[t]=r.func,y[t]=r)):v[t]=Cesium.ModelUtility.getGltfSemanticUniforms()[e.semantic](f.uniformState,m):Cesium.defined(e.value)&&(a=Cesium.ModelUtility.createUniformFunction(e.type,e.value,p,_),v[t]=a.func,y[t]=a)}),{map:v,values:y,jointMatrixUniformName:C,morphWeightsUniformName:g}}function il(e){return function(){return e}}function nl(e){return function(){return e.computedJointMatrices}}function rl(e){return function(){return e.weights}}function al(e){return function(){return e.silhouetteColor}}function ol(e){return function(){return e.silhouetteSize}}function sl(e){return function(){return e.color}}function ul(i){return function(){var e=i.clippingPlanes;if(!Cesium.defined(e)&&!Cesium.defined(i._sphericalHarmonicCoefficients)&&!Cesium.defined(i._specularEnvironmentMaps))return Cesium.Matrix4.IDENTITY;var t=Cesium.defined(e)?e.modelMatrix:Cesium.Matrix4.IDENTITY;return Cesium.Matrix4.multiply(i._clippingPlaneModelViewMatrix,t,tu)}}function ll(t){return function(){var e=t.clippingPlanes;return Cesium.defined(e)&&e.enabled?e.texture:t._defaultTexture}}function cl(i){return function(){var e=i.clippingPlanes;if(!Cesium.defined(e))return Cesium.Color.WHITE.withAlpha(0);var t=Cesium.Color.clone(e.edgeColor);return t.alpha=e.edgeWidth,t}}function ml(e){return function(){return Cesium.ColorBlendMode.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function dl(e){return function(){return e._imageBasedLightingFactor}}function hl(e){return function(){return e._lightColor}}function fl(e){return function(){return e.luminanceAtZenith}}function pl(e){return function(){return e._sphericalHarmonicCoefficients}}function _l(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function Cl(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function gl(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function vl(e,t){switch(e.mode){case Cesium.PrimitiveType.TRIANGLES:return t/3;case Cesium.PrimitiveType.TRIANGLE_STRIP:case Cesium.PrimitiveType.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function yl(e,t,i,n,r){for(var a,o,s,u,l,c=e._nodeCommands,m=e._pickIds,d=e.allowPicking,h=e._runtime.meshesByName,f=e._rendererResources,p=f.vertexArrays,_=f.programs,C=f.renderStates,g=e._uniformMaps,v=e.gltf,y=v.accessors,T=v.meshes,x=t.mesh,w=T[x],A=w.primitives,E=A.length,S=0;S<E;++S){var b,M,R=A[S],D=y[R.indices],P=e._runtime.materialsById[R.material]._program,I=e._decodedData[x+".primitive."+S],O=R.attributes.POSITION;Cesium.defined(O)&&(b=Cesium.ModelUtility.getAccessorMinMax(v,O),M=Cesium.BoundingSphere.fromCornerPoints(Cesium.Cartesian3.fromArray(b.min),Cesium.Cartesian3.fromArray(b.max)));var L,N,B=p[x+".primitive."+S];N=Cesium.defined(I)?(L=I.numberOfIndices,0):Cesium.defined(D)?(L=D.count,D.byteOffset/Cesium.IndexDatatype.getSizeInBytes(D.componentType)):(L=y[R.attributes.POSITION].count,0),e._trianglesLength+=vl(R,L);var z,F,V=g[R.material],U=V.uniformMap;Cesium.defined(V.jointMatrixUniformName)&&((z={})[V.jointMatrixUniformName]=nl(i),U=Cesium.combine(U,z)),Cesium.defined(V.morphWeightsUniformName)&&((F={})[V.morphWeightsUniformName]=rl(i),U=Cesium.combine(U,F)),U=Cesium.combine(U,{gltf_color:sl(e),gltf_colorBlend:ml(e),gltf_clippingPlanes:ll(e),gltf_clippingPlanesEdgeStyle:cl(e),gltf_clippingPlanesMatrix:ul(e),gltf_iblFactor:dl(e),gltf_lightColor:hl(e),gltf_sphericalHarmonicCoefficients:pl(e),gltf_specularMap:_l(e),gltf_specularMapSize:Cl(e),gltf_maxSpecularLOD:gl(e),gltf_luminanceAtZenith:fl(e)}),Cesium.defined(e._uniformMapLoaded)&&(U=e._uniformMapLoaded(U,P,i));var G={};e.extensionsUsed.WEB3D_quantized_attributes?(0,u=zu(o=e,s=R),l=o._quantizedUniforms[u],G=Cesium.ModelUtility.createUniformsForQuantizedAttributes(o.gltf,s,l)):e._dequantizeInShader&&Cesium.defined(I)&&(a=I,G=Cesium.ModelUtility.createUniformsForDracoQuantizedAttributes(a.attributes)),U=Cesium.combine(U,G);var k=C[R.material],H=k.blending.enabled,W=e._pickObject;Cesium.defined(W)||(W={primitive:e,id:e.id,node:i.publicNode,mesh:h[w.name]});var q,j,Y=Cesium.ShadowMode.castShadows(e._shadows),X=Cesium.ShadowMode.receiveShadows(e._shadows);d&&!Cesium.defined(e._uniformMapLoaded)&&(q=n.createPickId(W),m.push(q),j={czm_pickColor:il(q.color)},U=Cesium.combine(U,j)),d&&(q=Cesium.defined(e._pickIdLoaded)&&Cesium.defined(e._uniformMapLoaded)?e._pickIdLoaded():"czm_pickColor");var K,Z=new Cesium.DrawCommand({boundingVolume:new Cesium.BoundingSphere,cull:e.cull,modelMatrix:new Cesium.Matrix4,primitiveType:R.mode,vertexArray:B,count:L,offset:N,shaderProgram:_[P],castShadows:Y,receiveShadows:X,uniformMap:U,renderState:k,owner:W,pass:H?Cesium.Pass.TRANSLUCENT:e.opaquePass,pickId:q});r||((K=Cesium.DrawCommand.shallowClone(Z)).boundingVolume=new Cesium.BoundingSphere,K.modelMatrix=new Cesium.Matrix4);var J={show:!0,boundingSphere:M,command:Z,command2D:K,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:P};i.commands.push(J),c.push(J)}}function Tl(e,t){var i,n,r,a,o,s,u,l,_,C,g,c,m,d,h,f,p,v,y,T,x=t.context,w=(t.scene3DOnly,e._quantizedVertexShaders),A=e._toClipCoordinatesGLSL={},E=e._sourceTechniques,S=e._sourcePrograms,b=e._rendererResources,M=b.sourceShaders;for(var R in e._loadRendererResourcesFromCache&&(M=b.sourceShaders=e._cachedRendererResources.sourceShaders),E){E.hasOwnProperty(R)&&(r=M[(n=S[i=E[R].program]).vertexShader],Cesium.ModelUtility.checkSupportedGlExtensions(n.glExtensions,x),(e.extensionsUsed.WEB3D_quantized_attributes||e._dequantizeInShader)&&(a=w[i],Cesium.defined(a)||(a=Fu(r,i,e),w[i]=a),r=a),r=Vu(r,i,e._vertexShaderLoaded),A[i]=Cesium.ModelUtility.toClipCoordinatesGLSL(e.gltf,r))}e._loadRendererResourcesFromCache?(o=e._cachedRendererResources,b.buffers=o.buffers,b.vertexArrays=o.vertexArrays,b.programs=o.programs,b.silhouettePrograms=o.silhouettePrograms,b.textures=o.textures,b.samplers=o.samplers,b.renderStates=o.renderStates,Cesium.defined(e._precreatedAttributes)&&Qu(e,x),e._cachedGeometryByteLength+=function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&(t+=e[i].sizeInBytes);return t}(o.buffers),e._cachedTexturesByteLength+=function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&(t+=e[i].sizeInBytes);return t}(o.textures)):(function(e,t){var i=e._loadResources;if(0===i.pendingBufferLoads){var n,r=t.context,a=i.vertexBuffersToCreate,o=i.indexBuffersToCreate;if(e.asynchronous){for(;0<a.length&&(Nu.set(a.peek(),e,r),t.jobScheduler.execute(Nu,Cesium.JobType.BUFFER));)a.dequeue();for(;0<o.length&&(n=o.peek(),Bu.set(n.id,n.componentType,e,r),t.jobScheduler.execute(Bu,Cesium.JobType.BUFFER));)o.dequeue()}else{for(;0<a.length;)Iu(a.dequeue(),e,r);for(;0<o.length;)Lu((n=o.dequeue()).id,n.componentType,e,r)}}}(e,t),function(e,t){var i=e._loadResources,n=i.programsToCreate;if(0===i.pendingShaderLoads&&0===i.pendingBufferLoads){var r=t.context;if(e.asynchronous)for(;0<n.length&&(Wu.set(n.peek(),e,r),t.jobScheduler.execute(Wu,Cesium.JobType.PROGRAM));)n.dequeue();else for(;0<n.length;)Gu(n.dequeue(),e,r)}}(e,t),(l=(s=e)._loadResources).createSamplers&&(l.createSamplers=!1,u=s._rendererResources.samplers,Cesium.ForEach.sampler(s.gltf,function(e,t){u[t]=new Cesium.Sampler({wrapS:e.wrapS,wrapT:e.wrapT,minificationFilter:e.minFilter,magnificationFilter:e.magFilter})})),function(e){var t=e._loadResources;if(0===t.pendingBufferLoads)for(;0<t.texturesToCreateFromBufferView.length;){var i,n=t.texturesToCreateFromBufferView.dequeue(),r=e.gltf,a=r.bufferViews[n.bufferView],o=r.textures[n.id].source,s=Cesium.ModelUtility.getFailedLoadFunction(e,"image","id: "+n.id+", bufferView: "+n.bufferView);"image/ktx"===n.mimeType?(Cesium.loadKTX(t.getBuffer(a)).then(wu(e,n.id,o)).otherwise(s),++e._loadResources.pendingTextureLoads):"image/crn"===n.mimeType?(Cesium.loadCRN(t.getBuffer(a)).then(wu(e,n.id,o)).otherwise(s),++e._loadResources.pendingTextureLoads):"image/pkm"===n.mimeType?(Cesium.EV_LoadETC(t.getBuffer(a)).then(wu(e,n.id,o)).otherwise(s),++e._loadResources.pendingTextureLoads):(i=qu(t,n),Cesium.loadImageFromTypedArray({uint8Array:t.getBuffer(a),format:n.mimeType,flipY:!1}).then(i).otherwise(s),++t.pendingBufferViewToImage)}}(e),function(e,t){var i=t.context,n=e._loadResources.texturesToCreate;if(e.asynchronous)for(;0<n.length&&(Xu.set(n.peek(),e,i),t.jobScheduler.execute(Xu,Cesium.JobType.TEXTURE));)n.dequeue();else for(;0<n.length;)Yu(n.dequeue(),e,i)}(e,t)),Zu(e),(c=(_=e)._loadResources).finishedPendingBufferLoads()&&c.createRuntimeAnimations&&(c.createRuntimeAnimations=!1,_._runtime.animations=[],C=_._runtime.nodes,g=_.gltf.accessors,Cesium.ForEach.animation(_.gltf,function(e,t){for(var i=e.channels,n=e.samplers,r=Number.MAX_VALUE,a=-Number.MAX_VALUE,o=i.length,s=new Array(o),u=0;u<o;++u){var l=i[u],c=l.target,m=c.path,d=n[l.sampler],h=Cesium.ModelAnimationCache.getAnimationParameterValues(_,g[d.input]),f=Cesium.ModelAnimationCache.getAnimationParameterValues(_,g[d.output]),r=Math.min(r,h[0]),a=Math.max(a,h[h.length-1]),p=Cesium.ModelAnimationCache.getAnimationSpline(_,t,e,l.sampler,d,h,m,f);s[u]=Ju(_,C[c.node],c.path,p)}_._runtime.animations[t]={name:e.name,startTime:r,stopTime:a,channelEvaluators:s}})),e._loadRendererResourcesFromCache||(Qu(e,x),$u(e)),d=x,(T=(m=e)._loadResources).finishedProgramCreation()&&T.createUniformMaps&&(T.createUniformMaps=!1,h=m.gltf,f=m._sourceTechniques,p=m._uniformMaps,v=m._rendererResources.textures,y=m._defaultTexture,Cesium.ForEach.material(h,function(e,t){var i=m._runtime.materialsById[t],n=f[i._technique],r=i._values,a=tl(m,e,n,r,d,v,y);a.map.u_rollerRegion=function(){return m.rollerRegion};var o,s=p[t];s.uniformMap=a.map,s.values=a.values,s.jointMatrixUniformName=a.jointMatrixUniformName,s.morphWeightsUniformName=a.morphWeightsUniformName,Cesium.defined(n.attributes.a_outlineCoordinates)&&(o=Cesium.ModelOutlineLoader.createTexture(m,d),s.uniformMap.u_outlineTexture=function(){return o})})),function(e,t,i){var n=e._loadResources;if(n.finishedEverythingButTextureCreation()&&n.createRuntimeNodes){n.createRuntimeNodes=!1;for(var r=[],a=e._runtime.nodes,o=e.gltf,s=o.nodes,u=o.scenes[o.scene].nodes,l=u.length,c=[],m={},d=new Cesium.AssociativeArray,h=!1,f=o.asset.version,p=0;p<l;++p)for(c.push({parentRuntimeNode:void 0,gltfNode:s[u[p]],id:u[p]});0<c.length;){var _=c.pop();m[_.id]=!0;var C,g,v,y=_.parentRuntimeNode,T=_.gltfNode,x=a[_.id];0===x.parents.length&&(Cesium.defined(T.matrix)?x.matrix=Cesium.Matrix4.fromColumnMajorArray(T.matrix):(C=T.rotation,x.translation=Cesium.Cartesian3.fromArray(T.translation),x.rotation=Cesium.Quaternion.unpack(C),x.scale=Cesium.Cartesian3.fromArray(T.scale))),Cesium.defined(y)?(y.children.push(x),x.parents.push(y)):r.push(x),Cesium.defined(T.instanceIndex)&&Cesium.defined(e.content)&&"2.0"==f?(g=T.mesh,"Batched3DModel3DTileContent"===e.content.constructor.name&&(Cesium.defined(T.matrix)?((v=Cesium.Matrix4.clone(T.matrix,new Cesium.Matrix4))[1]=-T.matrix[2],v[2]=T.matrix[1],v[4]=-T.matrix[8],v[5]=T.matrix[10],v[6]=-T.matrix[9],v[8]=T.matrix[4],v[9]=-T.matrix[6],v[10]=T.matrix[5],v[13]=-T.matrix[14],v[14]=T.matrix[13],d.contains(g)?d.get(g).push({_modelMatrix:v,_nodeId:_.id,_instanceId:T.instanceIndex}):d.set(g,[{_modelMatrix:v,_nodeId:_.id,_instanceId:T.instanceIndex}])):console.log("node.matrix is empty")),h=!0):Cesium.defined(T.mesh)&&yl(e,T,x,t,i.scene3DOnly);var w=T.children;if(Cesium.defined(w))for(var A=w.length,E=0;E<A;E++){var S=w[E];m[S]||c.push({parentRuntimeNode:x,gltfNode:s[S],id:w[E]})}}e.ev_E3MInternalInstance&&(h&&0<d.length&&"Batched3DModel3DTileContent"===e.content.constructor.name?(e._releaseGltfJson=!1,e.ev_E3MInternalInstance.generateInstanceCommandByGltf(e,t,d,i)):h&&"Instanced3DModel3DTileContent"===e.content.constructor.name&&(s[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),a[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),yl(e,s[0],a[0],t,i.scene3DOnly))),e._runtime.rootNodes=r,e._runtime.nodes=a}}(e,x,t)}function xl(e,t){var i=e.publicNode,n=i.matrix;i.useMatrix&&Cesium.defined(n)?Cesium.Matrix4.clone(n,t):Cesium.defined(e.matrix)?Cesium.Matrix4.clone(e.matrix,t):(Cesium.Matrix4.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t),i.setMatrix(t))}var wl=[];function Al(e){var t,i,n=Cesium.DrawCommand.shallowClone(e);return n.pass=Cesium.Pass.TRANSLUCENT,n.renderState=(t=e.renderState,(i=Cesium.clone(t,!0)).cull.enabled=!1,i.depthTest.enabled=!0,i.depthMask=!1,i.blending=Cesium.BlendingState.ALPHA_BLEND,Cesium.RenderState.fromCache(i)),n}function El(e,t,i){var n=t.scene3DOnly,r=e.color.alpha;if(0<r&&r<1){var a=e._nodeCommands,o=a.length;if(!Cesium.defined(a[0].translucentCommand)||i)for(var s=0;s<o;++s){var u,l=a[s],c=l.command;l.translucentCommand=Al(c),n||(u=l.command2D,l.translucentCommand2D=Al(u))}}}function Sl(e,t){var i=e._rendererResources.programs;for(var n in i)if(i.hasOwnProperty(n)&&i[n]===t)return n}function bl(e,t,i){var n=t.vertexShaderSource.sources[0],r=t._attributeLocations,a=e._normalAttributeName,n=Cesium.ShaderSource.replaceMain(n,"gltf_silhouette_main");n+="uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n = normalize(czm_normal3D * "+a+"); \n    n.x *= czm_projection[0][0]; \n    n.y *= czm_projection[1][1]; \n    vec4 clip = gl_Position; \n    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; \n    gl_Position = clip; \n}";return Cesium.ShaderProgram.fromCache({context:i.context,vertexShaderSource:n,fragmentShaderSource:"uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); \n}",attributeLocations:r})}function Ml(e,t){return pu(t.context)&&0<e.silhouetteSize&&0<e.silhouetteColor.alpha&&Cesium.defined(e._normalAttributeName)}function Rl(e){return 0<e.color.alpha&&e.color.alpha<1}function Dl(e){return 0===e.color.alpha}function Pl(e,t){return Math.floor(e)!==Math.floor(t)||Math.ceil(e)!==Math.ceil(t)}var Il=0;function Ol(e,t){for(var i=++Il%255,n=function(e){for(var t=e._nodeCommands,i=t.length,n=0;n<i;++n){if(t[n].command.pass===Cesium.Pass.TRANSLUCENT)return!0}return!1}(e)||Rl(e)||e.silhouetteColor.alpha<1,r=e._rendererResources.silhouettePrograms,a=t.scene3DOnly,o=e._nodeCommands,s=o.length,u=0;u<s;++u){var l=o[u],c=l.command,m=Rl(e)?l.translucentCommand:c,d=Cesium.DrawCommand.shallowClone(m),h=Cesium.clone(m.renderState);h.stencilTest={enabled:!0,frontFunction:Cesium.WebGLConstants.ALWAYS,backFunction:Cesium.WebGLConstants.ALWAYS,reference:i,mask:-1,frontOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.REPLACE},backOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.REPLACE}},Dl(e)&&(h.colorMask={red:!1,green:!1,blue:!1,alpha:!1},h.depthMask=!1),h=Cesium.RenderState.fromCache(h),d.renderState=h,l.silhouetteModelCommand=d;var f=Cesium.DrawCommand.shallowClone(c);(h=Cesium.clone(c.renderState,!0)).depthTest.enabled=!0,h.cull.enabled=!1,n&&(f.pass=Cesium.Pass.TRANSLUCENT,h.depthMask=!1,h.blending=Cesium.BlendingState.ALPHA_BLEND),h.stencilTest={enabled:!0,frontFunction:Cesium.WebGLConstants.NOTEQUAL,backFunction:Cesium.WebGLConstants.NOTEQUAL,reference:i,mask:-1,frontOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.KEEP},backOperation:{fail:Cesium.WebGLConstants.KEEP,zFail:Cesium.WebGLConstants.KEEP,zPass:Cesium.WebGLConstants.KEEP}},h=Cesium.RenderState.fromCache(h);var p=c.shaderProgram,_=Sl(e,p),C=r[_];Cesium.defined(C)||(C=bl(e,p,t),r[_]=C);var g,v,y,T=Cesium.combine(c.uniformMap,{gltf_silhouetteColor:al(e),gltf_silhouetteSize:ol(e)});f.renderState=h,f.shaderProgram=C,f.uniformMap=T,f.castShadows=!1,f.receiveShadows=!1,l.silhouetteColorCommand=f,a||(g=l.command2D,(v=Cesium.DrawCommand.shallowClone(d)).boundingVolume=g.boundingVolume,v.modelMatrix=g.modelMatrix,l.silhouetteModelCommand2D=v,y=Cesium.DrawCommand.shallowClone(f),v.boundingVolume=g.boundingVolume,v.modelMatrix=g.modelMatrix,l.silhouetteColorCommand2D=y)}}function Ll(e,t,i){var n,r;Ml(e,t)&&(n=e._nodeCommands,r=Pl(e.color.alpha,e._colorPreviousAlpha)||Pl(e.silhouetteColor.alpha,e._silhouetteColorPreviousAlpha)||!Cesium.defined(n[0].silhouetteModelCommand),e._colorPreviousAlpha=e.color.alpha,e._silhouetteColorPreviousAlpha=e.silhouetteColor.alpha,(r||i)&&Ol(e,t))}function Nl(e,t){var i,n,r,a,o,s,u,l,c,m,d,h=e.scale;return 0!==e.minimumPixelSize&&(i=t.context,n=Math.max(i.drawingBufferWidth,i.drawingBufferHeight),r=Cesium.defined(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix,ou.x=r[12],ou.y=r[13],ou.z=r[14],Cesium.defined(e._rtcCenter)&&Cesium.Cartesian3.add(e._rtcCenter,ou,ou),e._mode!==Cesium.SceneMode.SCENE3D&&(o=(a=t.mapProjection).ellipsoid.cartesianToCartographic(ou,su),a.project(o,ou),Cesium.Cartesian3.fromElements(ou.z,ou.x,ou.y,ou)),s=e.boundingSphere.radius,c=ou,m=s,d=t,au.center=c,au.radius=m,l=1/(u=d.camera.getPixelSize(au,d.context.drawingBufferWidth,d.context.drawingBufferHeight)),Math.min(2*s*l,n)<e.minimumPixelSize&&(h=e.minimumPixelSize*u/(2*e._initialRadius))),Cesium.defined(e.maximumScale)?Math.min(e.maximumScale,h):h}function Bl(e){Cesium.defined(e._cacheKey)&&Cesium.defined(e._cachedGltf)&&0==--e._cachedGltf.count&&delete du[e._cacheKey],e._cachedGltf=void 0}function zl(e,t){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=e,this.cacheKey=t,this.count=0}function Fl(e){for(var t in e)e.hasOwnProperty(t)&&(e[t].isDestroyed()||e[t].destroy())}function Vl(n,r,a){return function(e){var t;n.heightReference===Cesium.HeightReference.RELATIVE_TO_GROUND&&((t=r.cartesianToCartographic(e,su)).height+=a.height,r.cartographicToCartesian(t,e));var i=n._clampedModelMatrix;Cesium.Matrix4.clone(n.modelMatrix,i),i[12]=e.x,i[13]=e.y,i[14]=e.z,n._heightChanged=!0}}function Ul(e,t){e.programs!==t.programs&&Fl(e.programs),e.silhouettePrograms!==t.silhouettePrograms&&Fl(e.silhouettePrograms)}zl.prototype.release=function(){if(0==--this.count)return Cesium.defined(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],Fl((e=this).buffers),Fl(e.vertexArrays),Fl(e.programs),Fl(e.silhouettePrograms),Fl(e.textures),Cesium.destroyObject(this);var e},fu.prototype.update=function(e){if(Cesium.defined(this._scene)||(this._scene=e.camera._scene),e.mode!==Cesium.SceneMode.MORPHING)if(Cesium.FeatureDetection.supportsWebP.initialized){var t=Cesium.FeatureDetection.supportsWebP(),i=e.context;this._defaultTexture=i.defaultTexture;var n,r,a=this._scene,o=a.globe;if(Cesium.defined(o)&&o.enableLighting){r=Cesium.defined(o._surfaceNormal)?o._surfaceNormal:(_=a.camera.positionCartographic,p=o._surface._tileProvider.tilingScheme.ellipsoid,n=Cesium.Cartesian3.fromRadians(_.longitude,_.latitude,0,p),p.geodeticSurfaceNormal(n));var s=a.context._us.lightDirectionWC,u=Cesium.Cartesian3.dot(r,s);if((!this.hasDiffuse||!!Math.ceil(this.hasDiffuse)!=!!Math.ceil(u))&&this._runtime&&this._runtime.materialsById){var l=0<u?this.modelSpecular:0,c=this._runtime.materialsById;for(var m in c)Cesium.defined(c[m]._values.u_specular)&&(c[m]._values.u_specular[0]=l),Cesium.defined(c[m]._uniformMap.values)&&Cesium.defined(c[m]._uniformMap.values.u_specular)&&(c[m]._uniformMap.values.u_specular.value.x=l);this.hasDiffuse=u}}if(this._state===Ys.NEEDS_LOAD&&Cesium.defined(this.gltf)){var d,h,f,p,_,C,g=this.cacheKey;if(Cesium.defined(g)){i.cache.modelRendererResourceCache=Cesium.defaultValue(i.cache.modelRendererResourceCache,{});var v=i.cache.modelRendererResourceCache,y=v[this.cacheKey];if(Cesium.defined(y)){if(!y.ready)return;++y.count,this._loadRendererResourcesFromCache=!0}else(y=new zl(i,g)).count=1,v[this.cacheKey]=y;this._cachedRendererResources=y}else(y=new zl(i)).count=1,this._cachedRendererResources=y;this._state=Ys.LOADING,this._state!==Ys.FAILED&&(d=this.gltf.extensions,Cesium.defined(d)&&Cesium.defined(d.CESIUM_RTC)&&(h=Cesium.Cartesian3.fromArray(d.CESIUM_RTC.center),Cesium.Cartesian3.equals(h,Cesium.Cartesian3.ZERO)||(this._rtcCenter3D=h,_=(p=(f=e.mapProjection).ellipsoid).cartesianToCartographic(this._rtcCenter3D),C=f.project(_),Cesium.Cartesian3.fromElements(C.z,C.x,C.y,C),this._rtcCenter2D=C,this._rtcCenterEye=new Cesium.Cartesian3,this._rtcCenter=this._rtcCenter3D)),Cesium.addPipelineExtras(this.gltf),this._loadResources=new Cesium.ModelLoadResources,this._loadRendererResourcesFromCache||Cesium.ModelUtility.parseBuffers(this,yu))}var T,x,w,A,E,S,b,M,R,D,P,I,O,L,N,B,z,F,V,U,G,k,H,W,q,j,Y,X=this._loadResources,K=this._incrementallyLoadTextures,Z=!1;if(this._state===Ys.LOADING){if(0===X.pendingBufferLoads){if(!X.initialized){e.brdfLutGenerator.update(e),Cesium.ModelUtility.checkSupportedExtensions(this.extensionsRequired,t),Cesium.ModelUtility.updateForwardAxis(this),Cesium.defined(this.gltf.extras.sourceVersion)||((T=this.gltf).extras.sourceVersion=Cesium.ModelUtility.getAssetVersion(T),T.extras.sourceKHRTechniquesWebGL=Cesium.defined(Cesium.ModelUtility.getUsedExtensions(T).KHR_techniques_webgl),this._sourceVersion=T.extras.sourceVersion,this._sourceKHRTechniquesWebGL=T.extras.sourceKHRTechniquesWebGL,Cesium.updateVersion(T),Cesium.addDefaults(T),x={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders},Cesium.processModelMaterialsCommon(T,x),Cesium.processPbrMaterials(T,x)),this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&Cesium.DracoLoader.hasExtension(this),W=(H=this).gltf,q=H._loadResources,Cesium.ForEach.buffer(W,function(e,t){q.buffers[t]=e.extras._pipeline.source}),function(e){var t={},i={},n={};e._runtime.articulationsByName=t,e._runtime.articulationsByStageKey=i,e._runtime.stagesByKey=n;var r=e.gltf;if(Cesium.hasExtension(r,"AGI_articulations")&&Cesium.defined(r.extensions)&&Cesium.defined(r.extensions.AGI_articulations)){var a=r.extensions.AGI_articulations.articulations;if(Cesium.defined(a))for(var o=a.length,s=0;s<o;++s){var u=Cesium.clone(a[s]);u.nodes=[],u.isDirty=!0;for(var l=(t[u.name]=u).stages.length,c=0;c<l;++c){var m=u.stages[c];m.currentValue=m.initialValue;var d=u.name+" "+m.name;i[d]=u,n[d]=m}}}}(this),k=(F=this).gltf,Cesium.hasExtension(k,"KHR_techniques_webgl")&&(V=F._sourcePrograms,U=F._sourceTechniques,G=k.extensions.KHR_techniques_webgl.programs,Cesium.ForEach.technique(k,function(e,t){U[t]=Cesium.clone(e);var i=e.program;Cesium.defined(V[i])||(V[i]=Cesium.clone(G[i]))})),this._loadRendererResourcesFromCache||(function(e){var i=e.gltf.bufferViews,n=e._loadResources.vertexBuffersToCreate;Cesium.ForEach.bufferView(e.gltf,function(e,t){e.target===Cesium.WebGLConstants.ARRAY_BUFFER&&n.enqueue(t)});var r=e._loadResources.indexBuffersToCreate,a={};Cesium.ForEach.accessor(e.gltf,function(e){var t=e.bufferView;Cesium.defined(t)&&(i[t].target!==Cesium.WebGLConstants.ELEMENT_ARRAY_BUFFER||Cesium.defined(a[t])||(a[t]=!0,r.enqueue({id:t,componentType:e.componentType})))})}(this),xu(this),function(e){var t,i=e._sourceTechniques;for(var n in i){i.hasOwnProperty(n)&&(t=i[n],e._loadResources.programsToCreate.enqueue({programId:t.program,techniqueId:n}))}}(this),Mu(this,i,t)),O=(I=this).gltf,L=I._sourceTechniques,N={},B={},z=I._uniformMaps,Cesium.ForEach.material(O,function(e,t){z[t]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var i,n=new Cesium.ModelMaterial(I,e,t);Cesium.defined(e.extensions)&&Cesium.defined(e.extensions.KHR_techniques_webgl)&&(i=e.extensions.KHR_techniques_webgl.technique,n._technique=i,n._program=L[i].program,Cesium.ForEach.materialValue(e,function(e,t){Cesium.defined(n._values)||(n._values={}),n._values[t]=Cesium.clone(e),"u_specular"==t&&(n._values[t][0]=I.modelSpecular)})),N[e.name]=n,B[t]=n}),I._runtime.materialsByName=N,I._runtime.materialsById=B,D={},P=(R=this)._runtime.materialsById,Cesium.ForEach.mesh(R.gltf,function(e,r){D[e.name]=new Cesium.ModelMesh(e,P,r),(Cesium.defined(R.extensionsUsed.WEB3D_quantized_attributes)||R._dequantizeInShader)&&Cesium.ForEach.meshPrimitive(e,function(e,t){var i=zu(R,e),n=R._programPrimitives[i];Cesium.defined(n)||(n={},R._programPrimitives[i]=n),n[r+".primitive."+t]=e})}),R._runtime.meshesByName=D,A={},E={},S=[],b=(w=this)._loadResources.skinnedNodesIds,M=w._runtime.articulationsByName,Cesium.ForEach.node(w.gltf,function(e,t){var i={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new Cesium.Matrix4,computedMatrix:new Cesium.Matrix4,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:e.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(i.publicNode=new Cesium.ModelNode(w,e,i,t,Cesium.ModelUtility.getTransform(e)),A[t]=i,E[e.name]=i,Cesium.defined(e.skin)&&(b.push(t),S.push(i)),Cesium.defined(e.extensions)&&Cesium.defined(e.extensions.AGI_articulations)){var n=e.extensions.AGI_articulations.articulationName;if(Cesium.defined(n)){var r=Cesium.Matrix4.clone(i.publicNode.originalMatrix,$s),a=M[n];a.nodes.push(i.publicNode);for(var o=a.stages.length,s=0;s<o;++s)r=vu(a.stages[s],r);i.publicNode.matrix=r}}}),w._runtime.nodes=A,w._runtime.nodesByName=E,w._runtime.skinnedNodes=S;var J=this.gltf;if(Cesium.defined(J)&&0<J.meshes.length&&0<this.meshPrimitives.length){for(var Q=0;Q<this.meshPrimitives.length;Q++)Cesium.DracoLoader.parseDecodedData(this.meshPrimitives[Q],this,i);this.meshPrimitives.length=0}else Cesium.DracoLoader.parse(this,i);X.initialized=!0}X.finishedDecoding()||Cesium.DracoLoader.decodeModel(this,i).otherwise(Cesium.ModelUtility.getFailedLoadFunction(this,"model",this.basePath)),X.finishedDecoding()&&!X.resourcesParsed&&(function(e){for(var t=e.gltf,i=t.nodes,n=t.meshes,r=t.scenes[t.scene].nodes,a=r.length,o=[],s=new Cesium.Cartesian3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new Cesium.Cartesian3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=0;l<a;++l){var c=i[r[l]];for(c._transformToRoot=Cesium.ModelUtility.getTransform(c),o.push(c);0<o.length;){var m=(c=o.pop())._transformToRoot,d=c.mesh;if(Cesium.defined(d))for(var h=n[d].primitives,f=h.length,p=0;p<f;++p){var _,C,g,v=h[p].attributes.POSITION;Cesium.defined(v)&&(_=Cesium.ModelUtility.getAccessorMinMax(t,v),Cesium.defined(_.min)&&Cesium.defined(_.max)&&(C=Cesium.Cartesian3.fromArray(_.min,0,Gl),g=Cesium.Cartesian3.fromArray(_.max,0,kl),Cesium.defined(s)&&Cesium.defined(u)&&(Cesium.Matrix4.multiplyByPoint(m,C,C),Cesium.Matrix4.multiplyByPoint(m,g,g),Cesium.Cartesian3.minimumByComponent(s,C,s),Cesium.Cartesian3.maximumByComponent(u,g,u))))}var y=c.children;if(Cesium.defined(y))for(var T=y.length,x=0;x<T;++x){var w=i[y[x]];w._transformToRoot=Cesium.ModelUtility.getTransform(w),Cesium.Matrix4.multiplyTransformation(m,w._transformToRoot,w._transformToRoot),o.push(w)}delete c._transformToRoot}}var A=Cesium.Cartesian3.clone(s),E=Cesium.Cartesian3.clone(u),S=Cesium.BoundingSphere.fromCornerPoints(s,u);e._forwardAxis===Cesium.Axis.Z&&(Cesium.BoundingSphere.transformWithoutScale(S,Cesium.Axis.Z_UP_TO_X_UP,S),Cesium.Matrix4.multiplyByPoint(Cesium.Axis.Z_UP_TO_X_UP,A,A),Cesium.Matrix4.multiplyByPoint(Cesium.Axis.Z_UP_TO_X_UP,E,E));e._upAxis===Cesium.Axis.Y?(Cesium.BoundingSphere.transformWithoutScale(S,Cesium.Axis.Y_UP_TO_Z_UP,S),Cesium.Matrix4.multiplyByPoint(Cesium.Axis.Y_UP_TO_Z_UP,A,A),Cesium.Matrix4.multiplyByPoint(Cesium.Axis.Y_UP_TO_Z_UP,E,E)):e._upAxis===Cesium.Axis.X&&(Cesium.BoundingSphere.transformWithoutScale(S,Cesium.Axis.X_UP_TO_Z_UP,S),Cesium.Matrix4.multiplyByPoint(Cesium.Axis.X_UP_TO_Z_UP,A,A),Cesium.Matrix4.multiplyByPoint(Cesium.Axis.X_UP_TO_Z_UP,E,E));e._boundingBox=new Cesium.BoxGeometry({vertexFormat:Cesium.VertexFormat.POSITION_ONLY,maximum:E,minimum:A}),e._boundingSphere=S}(this),this._initialRadius=this._boundingSphere.radius,Cesium.DracoLoader.cacheDataForModel(this),X.resourcesParsed=!0),X.resourcesParsed&&0===X.pendingShaderLoads&&(Cesium.ModelOutlineLoader.outlinePrimitives(this),Tl(this,e))}(X.finished()||K&&X.finishedEverythingButTextureCreation())&&(this._state=Ys.LOADED,Z=!0)}Cesium.defined(this._cachedRendererResources)&&this._cachedRendererResources.ready&&this._state===Ys.LOADED&&this.recreateVertexArraysOnce&&(function(d,e){for(var t in Fl(d._rendererResources.vertexArrays),d._rendererResources.vertexArrays=void 0,d._nodeCommands.length=0,d._runtime.rootNodes=void 0,d._runtime.nodes)Cesium.defined(d._runtime.nodes[t].commands)&&(d._runtime.nodes[t].commands=[],d._runtime.nodes[t].children=[],d._runtime.nodes[t].parents=[]);var h=e.context,f=d._rendererResources.buffers,p={},_=d.gltf,C=_.accessors;Cesium.ForEach.mesh(_,function(e,m){Cesium.ForEach.meshPrimitive(e,function(e,t){var o,i,n,s=[],u=Ku(d,e),l=d._decodedData[m+".primitive."+t];Cesium.ForEach.meshPrimitiveAttribute(e,function(e,t){if(o=u[t],Cesium.defined(o)){if(Cesium.defined(l)){var i=l.attributes;if(i.hasOwnProperty(t)){var n=i[t];return void s.push({index:o,vertexBuffer:f[n.bufferView],componentsPerAttribute:n.componentsPerAttribute,componentDatatype:n.componentDatatype,normalize:n.normalized,offsetInBytes:n.byteOffset,strideInBytes:n.byteStride})}}var r=C[e],a=Cesium.defined(r.normalized)&&r.normalized;s.push({index:o,vertexBuffer:f[r.bufferView],componentsPerAttribute:Cesium.numberOfComponentsForType(r.type),componentDatatype:r.componentType,normalize:a,offsetInBytes:r.byteOffset,strideInBytes:Cesium.getAccessorByteStride(_,r)})}});var r,a,c=d._precreatedAttributes;if(Cesium.defined(c))for(n in c)c.hasOwnProperty(n)&&(o=u[n],Cesium.defined(o)&&((i=c[n]).index=o,s.push(i)));Cesium.defined(e.indices)&&(a=C[e.indices].bufferView,Cesium.defined(l)&&(a=l.bufferView),r=f[a]),p[m+".primitive."+t]=new Cesium.VertexArray({context:h,attributes:s,indexBuffer:r})})}),d._rendererResources.vertexArrays=p;for(var i=[],n=d._runtime.nodes,r=(_=d.gltf).nodes,a=_.scenes[_.scene].nodes,o=a.length,s=[],u={},l=new Cesium.AssociativeArray,c=!1,m=_.asset.version,g=0;g<o;++g)for(s.push({parentRuntimeNode:void 0,gltfNode:r[a[g]],id:a[g]});0<s.length;){var v=s.pop();u[v.id]=!0;var y,T,x,w=v.parentRuntimeNode,A=v.gltfNode,E=n[v.id];0===E.parents.length&&(Cesium.defined(A.matrix)?E.matrix=Cesium.Matrix4.fromColumnMajorArray(A.matrix):(y=A.rotation,E.translation=Cesium.Cartesian3.fromArray(A.translation),E.rotation=Cesium.Quaternion.unpack(y),E.scale=Cesium.Cartesian3.fromArray(A.scale))),Cesium.defined(w)?(w.children.push(E),E.parents.push(w)):i.push(E),Cesium.defined(A.instanceIndex)&&Cesium.defined(d.content)&&"2.0"==m?(T=A.mesh,"Batched3DModel3DTileContent"===d.content.constructor.name&&(Cesium.defined(A.matrix)?((x=Cesium.Matrix4.clone(A.matrix,new Cesium.Matrix4))[1]=-A.matrix[2],x[2]=A.matrix[1],x[4]=-A.matrix[8],x[5]=A.matrix[10],x[6]=-A.matrix[9],x[8]=A.matrix[4],x[9]=-A.matrix[6],x[10]=A.matrix[5],x[13]=-A.matrix[14],x[14]=A.matrix[13],l.contains(T)?l.get(T).push({_modelMatrix:x,_nodeId:v.id,_instanceId:A.instanceIndex}):l.set(T,[{_modelMatrix:x,_nodeId:v.id,_instanceId:A.instanceIndex}])):console.log("node.matrix is empty")),c=!0):Cesium.defined(A.mesh)&&yl(d,A,E,h,e.scene3DOnly);var S=A.children;if(Cesium.defined(S))for(var b=S.length,M=0;M<b;M++){var R=S[M];u[R]||s.push({parentRuntimeNode:E,gltfNode:r[R],id:S[M]})}}d.ev_E3MInternalInstance&&(c&&0<l.length&&"Batched3DModel3DTileContent"===d.content.constructor.name?(d._releaseGltfJson=!1,d.ev_E3MInternalInstance.generateInstanceCommandByGltf(d,h,l,e)):c&&"Instanced3DModel3DTileContent"===d.content.constructor.name&&(r[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),n[0].matrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),yl(d,r[0],n[0],h,e.scene3DOnly))),d._runtime.rootNodes=i,d._runtime.nodes=n}(this,e),this.recreateVertexArraysOnce=!1),Cesium.defined(X)&&this._state===Ys.LOADED&&(K&&!Z&&Tl(this,e),X.finished()&&(this._loadResources=void 0,j=this._rendererResources,(Y=this._cachedRendererResources).buffers=j.buffers,Y.vertexArrays=j.vertexArrays,Y.programs=j.programs,Y.sourceShaders=j.sourceShaders,Y.silhouettePrograms=j.silhouettePrograms,Y.textures=j.textures,Y.samplers=j.samplers,Y.renderStates=j.renderStates,Y.ready=!0,this._normalAttributeName=Cesium.ModelUtility.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),Cesium.defined(this._precreatedAttributes)&&(Y.vertexArrays={}),this.releaseGltfJson&&Bl(this)));var $,ee=Cesium.OctahedralProjectedCubeMap.isSupported(i);this._shouldUpdateSpecularMapAtlas&&ee&&(this._shouldUpdateSpecularMapAtlas=!1,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._specularEnvironmentMapAtlas=void 0,Cesium.defined(this._specularEnvironmentMaps)&&(this._specularEnvironmentMapAtlas=new Cesium.OctahedralProjectedCubeMap(this._specularEnvironmentMaps),($=this)._specularEnvironmentMapAtlas.readyPromise.then(function(){$._shouldRegenerateShaders=!0}).otherwise(function(e){console.error("Error loading specularEnvironmentMaps: "+e)})),this._shouldRegenerateShaders=!0),Cesium.defined(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e);var te=!Cesium.defined(this._specularEnvironmentMapAtlas)&&Cesium.defined(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,ie=!Cesium.defined(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,ne=!Cesium.defined(this._sphericalHarmonicCoefficients)&&Cesium.defined(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,re=!Cesium.defined(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||te||ie||ne||re,this._useDefaultSpecularMaps=!Cesium.defined(this._specularEnvironmentMapAtlas)&&Cesium.defined(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!Cesium.defined(this._sphericalHarmonicCoefficients)&&Cesium.defined(e.sphericalHarmonicCoefficients);var ae,oe,se,ue,le,ce,me,de,he,fe,pe,_e,Ce,ge,ve,ye,Te,xe,we,Ae,Ee,Se,be,Me,Re,De,Pe=Ml(this,e),Ie=Rl(this),Oe=Dl(this),Le=!Cesium.defined(this.distanceDisplayCondition)||(oe=e,me=(ae=this).distanceDisplayCondition,de=me.near*me.near,he=me.far*me.far,oe.mode===Cesium.SceneMode.SCENE2D?(se=.5*(oe.camera.frustum.right-oe.camera.frustum.left),se*=se):(ce=Cesium.Matrix4.getTranslation(ae.modelMatrix,uu),oe.mode===Cesium.SceneMode.COLUMBUS_VIEW&&(le=(ue=oe.mapProjection).ellipsoid.cartesianToCartographic(ce,lu),ce=ue.project(le,ce),Cesium.Cartesian3.fromElements(ce.z,ce.x,ce.y,ce)),se=Cesium.Cartesian3.distanceSquared(ce,oe.camera.positionWC)),de<=se&&se<=he),Ne=this.show&&Le&&0!==this.scale&&(!Oe||Pe);if((Ne&&this._state===Ys.LOADED||Z)&&(fe=this.activeAnimations.update(e)||this._cesiumAnimationsDirty,this._cesiumAnimationsDirty=!1,this._dirty=!1,pe=this.modelMatrix,_e=e.mode!==this._mode,this._mode=e.mode,((Ce=!Cesium.Matrix4.equals(this._modelMatrix,pe)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||0!==this.minimumPixelSize||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||_e)||Z)&&(Cesium.Matrix4.clone(pe,this._modelMatrix),function(e){Cesium.defined(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);var t,i,n,r,a,o,s,u=e._scene;Cesium.defined(u)&&Cesium.defined(u.globe)&&e.heightReference!==Cesium.HeightReference.NONE?(i=(t=u.globe).ellipsoid,n=e.modelMatrix,ou.x=n[12],ou.y=n[13],ou.z=n[14],r=i.cartesianToCartographic(ou),Cesium.defined(e._clampedModelMatrix)||(e._clampedModelMatrix=Cesium.Matrix4.clone(n,new Cesium.Matrix4)),a=t._surface,e._removeUpdateHeightCallback=a.updateHeight(r,Vl(e,i,r)),o=t.getHeight(r),Cesium.defined(o)&&(s=Vl(e,i,r),Cesium.Cartographic.clone(r,su),su.height=o,i.cartographicToCartesian(su,ou),s(ou))):e._clampedModelMatrix=void 0}(this),Cesium.defined(this._clampedModelMatrix)&&(pe=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1,ge=Nl(this,e),ve=this._computedModelMatrix,Cesium.Matrix4.multiplyByUniformScale(pe,ge,ve),this._upAxis===Cesium.Axis.Y?Cesium.Matrix4.multiplyTransformation(ve,Cesium.Axis.Y_UP_TO_Z_UP,ve):this._upAxis===Cesium.Axis.X&&Cesium.Matrix4.multiplyTransformation(ve,Cesium.Axis.X_UP_TO_Z_UP,ve),this.forwardAxis===Cesium.Axis.Z&&Cesium.Matrix4.multiplyTransformation(ve,Cesium.Axis.Z_UP_TO_X_UP,ve)),(fe||Ce||Z)&&(function(e,t,i,n){var r,a,o,s=e._maxDirtyNumber,u=e._runtime.rootNodes,l=u.length,c=wl,m=e._computedModelMatrix;e._mode===Cesium.SceneMode.SCENE3D||e._ignoreCommands||(r=Cesium.Matrix4.getColumn(m,3,iu),Cesium.Cartesian4.equals(r,Cesium.Cartesian4.UNIT_W)?(a=e.boundingSphere.center,o=Cesium.Transforms.wgs84To2DModelMatrix(n,a,nu),m=Cesium.Matrix4.multiply(o,m,nu),Cesium.defined(e._rtcCenter)&&(Cesium.Matrix4.setTranslation(m,Cesium.Cartesian4.UNIT_W,m),e._rtcCenter=e._rtcCenter2D)):(m=Cesium.ransforms.basisTo2D(n,m,nu),e._rtcCenter=e._rtcCenter3D));var d=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY);e._upAxis===Cesium.Axis.Y?Cesium.Matrix4.multiplyTransformation(d,Cesium.Axis.Y_UP_TO_Z_UP,d):e._upAxis===Cesium.Axis.X&&Cesium.Matrix4.multiplyTransformation(d,Cesium.Axis.X_UP_TO_Z_UP,d),e.forwardAxis===Cesium.Axis.Z&&Cesium.Matrix4.multiplyTransformation(d,Cesium.Axis.Z_UP_TO_X_UP,d);for(var h=0;h<l;++h){var f=u[h];for(xl(f,f.transformToRoot),c.push(f);0<c.length;){var p=(f=c.pop()).transformToRoot,_=f.commands;if(f.dirtyNumber===s||t||i){var C=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),C=Cesium.defined(f.gltfInstaced)&&f.gltfInstaced?Cesium.Matrix4.multiplyTransformation(d,p,f.computedMatrix):Cesium.Matrix4.multiplyTransformation(m,p,f.computedMatrix),g=_.length;if(0<g)for(var v=0;v<g;++v){var y=_[v],T=y.command;Cesium.Matrix4.clone(C,T.modelMatrix),Cesium.defined(f.gltfInstaced)&&f.gltfInstaced||Cesium.BoundingSphere.transform(y.boundingSphere,T.modelMatrix,T.boundingVolume),Cesium.defined(e._rtcCenter)&&Cesium.Cartesian3.add(e._rtcCenter,T.boundingVolume.center,T.boundingVolume.center),T=y.command2D,Cesium.defined(T)&&e._mode===Cesium.SceneMode.SCENE2D&&(Cesium.Matrix4.clone(C,T.modelMatrix),T.modelMatrix[13]-=2*Cesium.Math.sign(T.modelMatrix[13])*Cesium.Math.PI*n.ellipsoid.maximumRadius,Cesium.BoundingSphere.transform(y.boundingSphere,T.modelMatrix,T.boundingVolume))}}var x=f.children;if(Cesium.defined(x))for(var w=x.length,A=0;A<w;++A){var E=x[A];E.dirtyNumber=Math.max(E.dirtyNumber,f.dirtyNumber),E.dirtyNumber!==s&&!i||(xl(E,E.transformToRoot),Cesium.Matrix4.multiplyTransformation(p,E.transformToRoot,E.transformToRoot)),c.push(E)}}}++e._maxDirtyNumber}(this,Ce,Z,e.mapProjection),this._dirty=!0,(fe||Z)&&function(e){for(var t=e._runtime.skinnedNodes,i=t.length,n=0;n<i;++n){var r=t[n];ru=Cesium.Matrix4.inverseTransformation(r.transformToRoot,ru);for(var a=r.computedJointMatrices,o=r.joints,s=r.bindShapeMatrix,u=r.inverseBindMatrices,l=u.length,c=0;c<l;++c)Cesium.defined(a[c])||(a[c]=new Cesium.Matrix4),a[c]=Cesium.Matrix4.multiplyTransformation(ru,o[c].transformToRoot,a[c]),a[c]=Cesium.Matrix4.multiplyTransformation(a[c],u[c],a[c]),Cesium.defined(s)&&(a[c]=Cesium.Matrix4.multiplyTransformation(a[c],s,a[c]))}}(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,function(e){for(var t=e._runtime.rootNodes,i=t.length,n=wl,r=0;r<i;++r){var a=t[r];for(a.computedShow=a.publicNode.show,n.push(a);0<n.length;){for(var o=(a=n.pop()).computedShow,s=a.commands,u=s.length,l=0;l<u;++l)s[l].show=o;var c=a.children;if(Cesium.defined(c))for(var m=c.length,d=0;d<m;++d){var h=c[d];h.computedShow=o&&h.publicNode.show,n.push(h)}}}}(this)),function(e){var t=e.id;if(e._id!==t){e._id=t;for(var i=e._pickIds,n=i.length,r=0;r<n;++r)i[r].object.id=t}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,i=e._nodeCommands,n=i.length,r=0;r<n;++r)i[r].command.primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e.debugShowBoundingVolume,i=e._nodeCommands,n=i.length,r=0;r<n;++r)i[r].command.debugShowBoundingVolume=t}}(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Cesium.ShadowMode.castShadows(e.shadows),i=Cesium.ShadowMode.receiveShadows(e.shadows),n=e._nodeCommands,r=n.length,a=0;a<r;a++){var o=n[a];o.command.castShadows=t,o.command.receiveShadows=i}}}(this),Re=e,De=(Me=this)._clippingPlanes,Cesium.defined(De)&&De.owner===Me&&De.enabled&&De.update(Re),ye=this._clippingPlanes,Te=0,xe=Cesium.defined(ye)&&ye.enabled&&0<ye.length,we=Cesium.defined(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,Ae=Cesium.defined(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps,(xe||we||Ae)&&(Ee=Cesium.defaultValue(this.clippingPlanesOriginMatrix,pe),Cesium.Matrix4.multiply(i.uniformState.view3D,Ee,this._clippingPlaneModelViewMatrix)),xe&&(Te=ye.clippingPlanesState),Se=(Se=this._shouldRegenerateShaders)||this._clippingPlanesState!==Te,this._clippingPlanesState=Te,(be=_u(this))!==this._colorShadingEnabled&&(this._colorShadingEnabled=be,Se=!0),this._enableFog!==this._scene.ev_Fog.enabled&&(Se=!0,this._shouldRegenerateShaders=!0,this._enableFog=this._scene.ev_Fog.enabled),Cesium.defined(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.postUpdate(e,this),Se?function(e,t){var i,n,r=e._rendererResources,a=e._cachedRendererResources;if(Ul(r,a),Cu(e)||_u(e)||e._shouldRegenerateShaders){e._shouldRegenerateShaders=!1,r.programs={},r.silhouettePrograms={},Cesium.defined(e.ev_E3MInternalInstance)&&(e.ev_E3MInternalInstance._instancedUniformsByProgram=void 0);var o,s={},u=e._sourceTechniques;for(var l in u){u.hasOwnProperty(l)&&(n=u[l],i=n.program,s[i]||(s[i]=!0,o=e._sourcePrograms[i].name,Cesium.defined(e.ev_E3MInternalInstance)&&Cesium.defined(e.ev_E3MInternalInstance._tileset)&&Cesium.defined(o)&&e.instancedPrograms[o]?(e.instancedPrograms[o]=void 0,e.ev_E3MInternalInstance.regenerateShaders({programId:i,techniqueId:l},e,t.context)):ku({programId:i,techniqueId:l},e,t.context)))}}else r.programs=a.programs,r.silhouettePrograms=a.silhouettePrograms;for(var c=r.programs,m=e._nodeCommands,d=m.length,h=0;h<d;++h){var f=m[h];i=f.programId;var p=c[i];f.command.shaderProgram=p,Cesium.defined(f.command2D)&&(f.command2D.shaderProgram=p)}El(e,t,!0),Ll(e,t,!0)}(this,e):(El(this,e,!1),Ll(this,e,!1))),Z){var Be=this;e.afterRender.push(function(){Be._ready=!0,Be._readyPromise.resolve(Be)})}else{if(Ne&&!this._ignoreCommands){var ze,Fe,Ve,Ue,Ge,ke=e.commandList,He=e.passes,We=this._nodeCommands,qe=We.length,je=e.mapProjection.ellipsoid.maximumRadius*Cesium.Math.PI;if(He.render||He.pick&&this.allowPicking){for(ze=0;ze<qe;++ze){(Ge=We[ze]).show&&(Ue=Ie?Ge.translucentCommand:Ge.command,Ue=Pe?Ge.silhouetteModelCommand:Ue,ke.push(Ue),Fe=Ge.command.boundingVolume,e.mode===Cesium.SceneMode.SCENE2D&&(Fe.center.y+Fe.radius>je||Fe.center.y-Fe.radius<je)&&(Ve=Ie?Ge.translucentCommand2D:Ge.command2D,Ve=Pe?Ge.silhouetteModelCommand2D:Ve,ke.push(Ve)))}if(Pe&&!He.pick)for(ze=0;ze<qe;++ze)(Ge=We[ze]).show&&(ke.push(Ge.silhouetteColorCommand),Fe=Ge.command.boundingVolume,e.mode===Cesium.SceneMode.SCENE2D&&(Fe.center.y+Fe.radius>je||Fe.center.y-Fe.radius<je)&&ke.push(Ge.silhouetteColorCommand2D))}}var Ye=this._credit;Cesium.defined(Ye)&&e.creditDisplay.addCredit(Ye);for(var Xe=this._resourceCredits,Ke=Xe.length,Ze=0;Ze<Ke;Ze++)e.creditDisplay.addCredit(Xe[Ze])}}else Cesium.FeatureDetection.supportsWebP.initialize()};var Gl=new si,kl=new si;fu.prototype.isDestroyed=function(){return!1},fu.prototype.destroy=function(){Cesium.defined(this.ev_E3MInternalInstance)&&this.ev_E3MInternalInstance.destroy(),Cesium.defined(this._precreatedAttributes)&&Fl(this._rendererResources.vertexArrays),Cesium.defined(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),Cesium.defined(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),Cesium.defined(this._cachedRendererResources)&&Ul(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),Cesium.DracoLoader.destroyCachedDataForModel(this);for(var e=this._pickIds,t=e.length,i=0;i<t;++i)e[i].destroy();Bl(this),this._quantizedVertexShaders=void 0;var n=this._clippingPlanes;return Cesium.defined(n)&&!n.isDestroyed()&&n.owner===this&&n.destroy(),this._clippingPlanes=void 0,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._nodeCommands.length=0,this.meshPrimitives.length=0,this.ktxs=void 0,this.instancedPrograms=void 0,this.gltfShader=void 0,Cesium.destroyObject(this)};var Hl={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},Wl=new si,ql=new Rn;function jl(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.show=Cesium.defaultValue(e.show,!0),this._instancingSupported=!1,this._dynamic=Cesium.defaultValue(e.dynamic,!1),this._allowPicking=Cesium.defaultValue(e.allowPicking,!0),this._ready=!1,this._readyPromise=Cesium.when.defer(),this._state=Hl.NEEDS_LOAD,this._dirty=!1,this._cull=Cesium.defaultValue(e.cull,!0),this._opaquePass=Cesium.defaultValue(e.opaquePass,Cesium.Pass.OPAQUE),this._instances=Yl(this,e.instances),this._batchTable=e.batchTable,this._model=void 0,this._vertexBufferTypedArray=void 0,this._vertexBuffer=void 0,this._batchIdBuffer=void 0,this._instancedColorTypedArray=void 0,this._instancedColorBuffer=void 0,this._instancedUniformsByProgram=void 0,this._drawCommands=[],this._modelCommands=void 0,this._boundingSphere=Xl(this),this._center=Cesium.Cartesian3.clone(this._boundingSphere.center),this._rtcTransform=new Cesium.Matrix4,this._rtcModelView=new Cesium.Matrix4,this._mode=void 0,this.modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._modelMatrix=Cesium.Matrix4.clone(this.modelMatrix),this._url=Cesium.Resource.createIfNeeded(e.url),this._requestType=e.requestType,this._gltf=e.gltf,this._basePath=Cesium.Resource.createIfNeeded(e.basePath),this._asynchronous=e.asynchronous,this._incrementallyLoadTextures=e.incrementallyLoadTextures,this._upAxis=e.upAxis,this._forwardAxis=e.forwardAxis,this.shadows=Cesium.defaultValue(e.shadows,Cesium.ShadowMode.ENABLED),this._shadows=this.shadows,this._pickIdLoaded=e.pickIdLoaded,this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=Cesium.defaultValue(e.debugWireframe,!1),this._debugWireframe=!1,this._imageBasedLightingFactor=new Cesium.Cartesian2(1,1),Cesium.Cartesian2.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this.lightColor=e.lightColor,this.luminanceAtZenith=e.luminanceAtZenith,this.sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this.specularEnvironmentMaps=e.specularEnvironmentMaps,this.modelMeshPrimitives=[],this.content=Cesium.defaultValue(e.content,void 0),this.specular=e.specular,this.rollerRegion=e.rollerRegion,this._cacheKey=Cesium.defaultValue(e.cacheKey,void 0),this.precreatedAttributes=void 0,this._useInstancedColor=Cesium.defaultValue(e.useInstancedColor,!1),this._instancingRegenertedOnce=!1}function Yl(e,t){for(var i=(t=Cesium.defaultValue(t,[])).length,n=new Array(i),r=0;r<i;++r){var a=t[r],o=a.modelMatrix,s=Cesium.defaultValue(a.batchId,r),u=a.modelColor;n[r]=new Cesium.ModelInstance(e,o,s,u)}return n}function Xl(e){for(var t=e.length,i=new Array(t),n=0;n<t;++n)i[n]=Cesium.Matrix4.getTranslation(e._instances[n]._modelMatrix,new Cesium.Cartesian3);return Cesium.BoundingSphere.fromPoints(i)}function Kl(n,r,a,o){return function(e,t){var i=e.semantic;if(Cesium.defined(i)&&-1<n.indexOf(i)){if(!(-1<r.indexOf(i)))throw new Cesium.RuntimeError('Shader program cannot be optimized for instancing. Uniform "'+t+'" in program "'+a+'" uses unsupported semantic "'+i+'"');o[t]=i}}}function Zl(e,t){if(Cesium.defined(e._instancedUniformsByProgram))return e._instancedUniformsByProgram[t];var i={};e._instancedUniformsByProgram=i;var n,r,a,o=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],s=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],u=e._model._sourceTechniques;for(var l in u){u.hasOwnProperty(l)&&(r=(n=u[l]).program,Cesium.defined(i[r])||(a={},i[r]=a,Cesium.ForEach.techniqueUniform(n,Kl(o,s,t,a))))}return i[t]}function Jl(u,l){return function(e,t,i){var n,r,a;(e=Cesium.clone(e)).czm_instanced_modifiedModelView=(n=u,r=l,function(){return Cesium.Matrix4.multiply(r.uniformState.view,n._rtcTransform,n._rtcModelView)}),e.czm_instanced_nodeTransform=(a=i,function(){return a.computedMatrix});var o=Zl(u,t);for(var s in o)o.hasOwnProperty(s)&&delete e[s];return Cesium.defined(u._batchTable)&&(e=u._batchTable.getUniformMapCallback()(e)),e}}function Ql(e){var t=e._instances,i=e.length,n=e._center,r=e._vertexBufferTypedArray;Cesium.defined(r)||(r=new Float32Array(12*i)),e._dynamic&&(e._vertexBufferTypedArray=r);for(var a=0;a<i;++a){var o=t[a]._modelMatrix,s=Cesium.Matrix4.clone(o,ql);s[12]-=n.x,s[13]-=n.y,s[14]-=n.z;var u=12*a;r[0+u]=s[0],r[1+u]=s[4],r[2+u]=s[8],r[3+u]=s[12],r[4+u]=s[1],r[5+u]=s[5],r[6+u]=s[9],r[7+u]=s[13],r[8+u]=s[2],r[9+u]=s[6],r[10+u]=s[10],r[11+u]=s[14]}return r}function $l(e){var t=e._instances,i=e.length,n=e._instancedColorTypedArray;Cesium.defined(n)||(n=new Float32Array(4*i)),e._dynamic&&(e._instancedColorTypedArray=n);for(var r=0;r<i;++r){var a=t[r]._modelColor,o=4*r;n[0+o]=a.red,n[1+o]=a.green,n[2+o]=a.blue,n[3+o]=e._useInstancedColor?a.alpha:-1}return n}function ec(e,t){var i,n=e._instances,r=e.length,a=e._dynamic,o=Cesium.defined(e._batchTable);if(o){for(var s=new Uint16Array(r),u=0;u<r;++u)s[u]=n[u]._instanceId;e._batchIdBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:s,usage:Cesium.BufferUsage.STATIC_DRAW})}if(!o){var l=new Uint8Array(4*r);for(u=0;u<r;++u){var c=e._pickIds[u].color,m=4*u;l[m]=Cesium.Color.floatToByte(c.red),l[1+m]=Cesium.Color.floatToByte(c.green),l[2+m]=Cesium.Color.floatToByte(c.blue),l[3+m]=Cesium.Color.floatToByte(c.alpha)}e._pickIdBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:l,usage:Cesium.BufferUsage.STATIC_DRAW})}e._useInstancedColor&&(i=$l(e),e._instancedColorBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:i,usage:a?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW}));var d=Ql(e);e._vertexBuffer=Cesium.Buffer.createVertexBuffer({context:t,typedArray:d,usage:a?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW})}function tc(e,t){for(var i=e._instances,n=i.length,r=new Array(n),a=0;a<n;++a)r[a]=t.createPickId(i[a]);return r}function ic(e,t){var i,n,r,a,o,s,v,u=e._instancingSupported,l=Cesium.defined(e._batchTable),c=e._allowPicking,m={url:e._url,requestType:e._requestType,gltf:e._gltf,basePath:e._basePath,shadows:e._shadows,cacheKey:e._cacheKey,asynchronous:e._asynchronous,allowPicking:c,incrementallyLoadTextures:e._incrementallyLoadTextures,upAxis:e._upAxis,forwardAxis:e._forwardAxis,precreatedAttributes:void 0,vertexShaderLoaded:void 0,fragmentShaderLoaded:void 0,uniformMapLoaded:void 0,pickIdLoaded:e._pickIdLoaded,ignoreCommands:!0,opaquePass:e._opaquePass,imageBasedLightingFactor:e.imageBasedLightingFactor,lightColor:e.lightColor,luminanceAtZenith:e.luminanceAtZenith,sphericalHarmonicCoefficients:e.sphericalHarmonicCoefficients,specularEnvironmentMaps:e.specularEnvironmentMaps,content:e.content,sharedResources:{instancedPrograms:{name:Cesium.defined(e.sharedResources)?e.sharedResources.instancedPrograms.name:void 0,shadredData:Cesium.defined(e.sharedResources)?e.sharedResources.instancedPrograms.shadredData:void 0},ktxs:Cesium.defined(e.sharedResources)?e.sharedResources.ktxs:void 0},specular:e.specular,rollerRegion:e.rollerRegion};l||(e._pickIds=tc(e,t)),u?(ec(e,t),i=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),n={czm_modelMatrixRow0:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*i,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*i,strideInBytes:12*i,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:e._vertexBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*i,strideInBytes:12*i,instanceDivisor:1}},l&&(n.a_batchId={index:0,vertexBuffer:e._batchIdBuffer,componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),l||(n.pickColor={index:0,vertexBuffer:e._pickIdBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),e._useInstancedColor&&(n.instancedColor={index:0,vertexBuffer:e._instancedColorBuffer,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1}),e.precreatedAttributes=n,m.precreatedAttributes=n,m.vertexShaderLoaded=(v=e,function(e,t){var i,n,r,a=Zl(v,t),o=Cesium.defined(v._batchTable),s=v._useInstancedColor,u=Cesium.ShaderSource.replaceMain(e,"czm_instancing_main"),l="",c="";for(var m in a)a.hasOwnProperty(m)&&("MODELVIEW"===(i=a[m])||"CESIUM_RTC_MODELVIEW"===i?n="czm_instanced_modelView":"MODELVIEWPROJECTION"===i?(n="czm_instanced_modelViewProjection",l+="mat4 czm_instanced_modelViewProjection;\n",c+="czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;\n"):"MODELVIEWINVERSETRANSPOSE"===i&&(n="czm_instanced_modelViewInverseTranspose",l+="mat3 czm_instanced_modelViewInverseTranspose;\n",c+="czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);\n"),r=new RegExp("uniform.*"+m+".*"),u=u.replace(r,""),r=new RegExp(m+"\\b","g"),u=u.replace(r,n));var d,h,f=o?(d="attribute float a_batchId;\n",h=""):(d="",h="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n","    v_pickColor = pickColor;\n"),p="";s&&(p="attribute vec4 instancedColor;\nvarying vec4 v_instancedColor;\n",f+=" v_instancedColor = instancedColor;\n");var _,C,g="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n"+l+"mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n"+d+h+p+u+"void main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;\n"+c+"    czm_instancing_main();\n"+f+"}\n";return o&&(_=v._model.gltf,C=Cesium.ModelUtility.getDiffuseAttributeOrUniform(_,t),g=v._batchTable.getVertexShaderCallback(!0,"a_batchId",C)(g)),g}),m.fragmentShaderLoaded=(s=e,function(e,t){var i,n,r=s._batchTable;return e=Cesium.defined(r)?(i=s._model.gltf,n=Cesium.ModelUtility.getDiffuseAttributeOrUniform(i,t),r.getFragmentShaderCallback(!0,n)(e)):"varying vec4 v_pickColor;\n"+e}),m.uniformMapLoaded=Jl(e,t),Cesium.defined(e._url)&&(m.cacheKey=e._url.getUrlComponent()+"#instanced")):(m.vertexShaderLoaded=(o=e,function(e,t){var i,n;return Cesium.defined(o._batchTable)&&(i=o._model.gltf,n=Cesium.ModelUtility.getDiffuseAttributeOrUniform(i,t),e="uniform float a_batchId\n;"+o._batchTable.getVertexShaderCallback(!0,"a_batchId",n)(e)),e}),m.fragmentShaderLoaded=(a=e,function(e,t){var i,n,r=a._batchTable;return e=Cesium.defined(r)?(i=a._model.gltf,n=Cesium.ModelUtility.getDiffuseAttributeOrUniform(i,t),r.getFragmentShaderCallback(!0,n)(e)):"uniform vec4 czm_pickColor;\n"+e}),m.uniformMapLoaded=(r=e,function(e){return Cesium.defined(r._batchTable)&&(e=r._batchTable.getUniformMapCallback()(e)),e})),Cesium.defined(e._url)?e._model=fu.fromGltf(m):e._model=new fu(m)}function nc(e){return function(){return e}}function rc(e){return function(){return e}}function ac(e){for(var t=e._modelCommands,i=t.length,n=e.length,r=e._rtcTransform,a=e._center,o=0;o<i;++o)for(var s=t[o],u=0;u<n;++u){var l=o*n+u,c=e._drawCommands[l],m=Cesium.Matrix4.clone(e._instances[u]._modelMatrix,ql);m[12]-=a.x,m[13]-=a.y,m[14]-=a.z,m=Cesium.Matrix4.multiply(r,m,ql);var d=s.modelMatrix,h=c.modelMatrix;Cesium.Matrix4.multiply(m,d,h);var f=s.boundingVolume,p=c.boundingVolume;Cesium.BoundingSphere.transform(f,m,p)}}function oc(e){for(var t=e._nodeCommands,i=t.length,n=[],r=0;r<i;++r){var a=t[r];a.show&&n.push(a.command)}return n}function sc(e,t){e._drawCommands=[];var i=oc(e._model);t?function(e,t){for(var i=t.length,n=e.length,r=e._boundingSphere,a=e._cull,o=0;o<i;++o){var s=Cesium.DrawCommand.shallowClone(t[o]);s.instanceCount=n,s.boundingVolume=r,s.cull=a,Cesium.defined(e._batchTable)?s.pickId=e._batchTable.getPickId():s.pickId="v_pickColor",e._drawCommands.push(s)}}(e,i):(function(e,t){for(var i=e._instances,n=t.length,r=e.length,a=e._batchTable,o=Cesium.defined(a),s=e._cull,u=0;u<n;++u)for(var l=0;l<r;++l){var c,m=Cesium.DrawCommand.shallowClone(t[u]);m.modelMatrix=new Cesium.Matrix4,m.boundingVolume=new Cesium.BoundingSphere,m.cull=s,m.uniformMap=Cesium.clone(m.uniformMap),o?m.uniformMap.a_batchId=nc(i[l]._instanceId):(c=e._pickIds[l],m.uniformMap.czm_pickColor=rc(c.color)),e._drawCommands.push(m)}}(e,i),ac(e))}Object.defineProperties(jl.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){Cesium.Cartesian2.clone(e,this._imageBasedLightingFactor)}},instancingRegenertedOnce:{get:function(){return this._instancingRegenertedOnce},set:function(e){this._instancingRegenertedOnce=e}},dirty:{get:function(){return this._dirty},set:function(e){this._dirty=e}}}),jl.prototype.expandBoundingSphere=function(e){var t=Cesium.Matrix4.getTranslation(e,Wl);Cesium.BoundingSphere.expand(this._boundingSphere,t,this._boundingSphere)},jl.prototype.regenerteInstanced=function(e){this._instances=[],this._instances=Yl(this,e)},jl.prototype.update=function(e){if(e.mode!==Cesium.SceneMode.MORPHING&&this.show&&0!==this.length){var t,i=e.context;this._state===Hl.NEEDS_LOAD&&(this._state=Hl.LOADING,this._instancingSupported=i.instancedArrays,ic(this,i),this._model._meshPrimitives=this.modelMeshPrimitives,(t=this)._model.readyPromise.otherwise(function(e){t._state=Hl.FAILED,t._readyPromise.reject(e)}));var n=this._instancingSupported,r=this._model;r.imageBasedLightingFactor=this.imageBasedLightingFactor,r.lightColor=this.lightColor,r.luminanceAtZenith=this.luminanceAtZenith,r.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,r.specularEnvironmentMaps=this.specularEnvironmentMaps,r.ktxs=this.ktxs,r.gltfShader=this.gltfShader;var a=Cesium.Cartesian3.clone(this._center);if(n&&r.ready&&(this._boundingSphere=Xl(this),o=r.boundingSphere.radius+Cesium.Cartesian3.magnitude(r.boundingSphere.center),this._boundingSphere.radius+=o,this._center=Cesium.Cartesian3.clone(this._boundingSphere.center)),n&&this._instancingRegenertedOnce&&(function(e,t){e._vertexBufferTypedArray=void 0,e._instancedColorTypedArray=void 0;var i=Cesium.defined(e._batchTable);if(!i){var n=e._pickIds;if(Cesium.defined(n))for(var r=n.length,a=0;a<r;++a)n[a].destroy();e._pickIds=tc(e,t)}e._instancingSupported&&(e._batchIdBuffer=void 0,e._pickIdBuffer=void 0,e._vertexBuffer=void 0,e._instancedColorBuffer=void 0,ec(e,t),Cesium.defined(e.precreatedAttributes.czm_modelMatrixRow0)&&(e.precreatedAttributes.czm_modelMatrixRow0.vertexBuffer=e._vertexBuffer),Cesium.defined(e.precreatedAttributes.czm_modelMatrixRow1)&&(e.precreatedAttributes.czm_modelMatrixRow1.vertexBuffer=e._vertexBuffer),Cesium.defined(e.precreatedAttributes.czm_modelMatrixRow2)&&(e.precreatedAttributes.czm_modelMatrixRow2.vertexBuffer=e._vertexBuffer),i&&Cesium.defined(e.precreatedAttributes.a_batchId)&&(e.precreatedAttributes.a_batchId.vertexBuffer=e._batchIdBuffer),!i&&Cesium.defined(e.precreatedAttributes.pickColor)&&(e.precreatedAttributes.pickColor.vertexBuffer=e._pickIdBuffer),e._useInstancedColor&&Cesium.defined(e.precreatedAttributes.instancedColor)&&(e.precreatedAttributes.instancedColor.vertexBuffer=e._instancedColorBuffer))}(this,i),this._instancingRegenertedOnce=!1,r.recreateVertexArraysOnce=!0),r.update(e),r.ready&&this._state===Hl.LOADING){this._state=Hl.LOADED,this._ready=!0;var o=r.boundingSphere.radius+Cesium.Cartesian3.magnitude(r.boundingSphere.center);return this._boundingSphere.radius+=o,this._modelCommands=oc(r),sc(this,n),void this._readyPromise.resolve(this)}if(this._state===Hl.LOADED){var s,u=e.mode!==this._mode,l=this.modelMatrix,c=!Cesium.Matrix4.equals(this._modelMatrix,l),m=!Cesium.Cartesian3.equals(a,this._center);(u||c||m)&&(this._mode=e.mode,Cesium.Matrix4.clone(l,this._modelMatrix),s=Cesium.Matrix4.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform),this._mode!==Cesium.SceneMode.SCENE3D&&(s=Cesium.Transforms.basisTo2D(e.mapProjection,s,s)),Cesium.Matrix4.getTranslation(s,this._boundingSphere.center)),n&&this._dirty&&(this._dynamic=!0,this._dirty=!1,function(e){e._vertexBufferTypedArray=void 0;var t,i=Ql(e);e._vertexBuffer.copyFromArrayView(i),e._useInstancedColor&&(e._instancedColorTypedArray=void 0,t=$l(e),e._instancedColorBuffer.copyFromArrayView(t))}(this)),function(e){for(var t=e._nodeCommands,i=t.length,n=0;n<i;n++){if(t[n].command.dirty)return 1}}(r)&&sc(this,n),!n&&(r.dirty||this._dirty||u||c)&&ac(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Cesium.ShadowMode.castShadows(e.shadows),i=Cesium.ShadowMode.receiveShadows(e.shadows),n=e._drawCommands,r=n.length,a=0;a<r;++a){var o=n[a];o.castShadows=t,o.receiveShadows=i}}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?Cesium.PrimitiveType.LINES:Cesium.PrimitiveType.TRIANGLES,i=e._drawCommands,n=i.length,r=0;r<n;++r)i[r].primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e._drawCommands,i=t.length,n=0;n<i;++n)t[n].debugShowBoundingVolume=e.debugShowBoundingVolume}}(this);var d=e.passes;if(d.render||d.pick)for(var h=e.commandList,f=this._drawCommands,p=f.length,_=0;_<p;++_)h.push(f[_])}}},jl.prototype.isDestroyed=function(){return!1},jl.prototype.destroy=function(){this._model=this._model&&this._model.destroy(),Cesium.defined(this.sharedResources)&&(this.sharedResources.instancedPrograms=void 0),Cesium.defined(this.sharedResources)&&(this.sharedResources.ktxs=void 0),this.gltfShader=void 0,this._gltf=void 0,this._instances.length=0;var e=this._pickIds;if(Cesium.defined(e))for(var t=e.length,i=0;i<t;++i)e[i].destroy();return Cesium.destroyObject(this)};var uc={};function lc(e,t){oe(uc[e])||(uc[e]=!0,console.warn(z(t,e)))}lc.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",lc.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",lc.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",lc.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var cc=as.WHITE;dc._deprecationWarning=function(e,t){lc(e,t)};var mc=new as;function dc(e,t,i,n,r){var a;this.featuresLength=t,this._translucentFeaturesLength=0,Cesium.defined(i)&&(a=i.extensions),this._extensions=Cesium.defaultValue(a,{});var o,s,u,l,c,m,d,h,f=function(e){var t={};if(!Cesium.defined(e))return t;for(var i in e)e.hasOwnProperty(i)&&"HIERARCHY"!==i&&"extensions"!==i&&"extras"!==i&&(t[i]=Cesium.clone(e[i],!0));return t}(i);this._properties=f,function(e,t){if(!Cesium.defined(e)||!Cesium.defined(e.extensions))return;var i=e.extensions["3DTILES_batch_table_EVFORMAT"];{var n,r,a;Cesium.defined(i)&&(n=t._tileset,r=t._tile,a=i.children,n.addNode_ev(r,a))}}(i,e),this._batchTableHierarchy=function(e,t,i){if(!Cesium.defined(t))return;var n=e._extensions["3DTILES_batch_table_hierarchy"],r=t.HIERARCHY;Cesium.defined(r)&&(dc._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),e._extensions["3DTILES_batch_table_hierarchy"]=r,n=r);return Cesium.defined(n)?function(e,t){var i,n,r,a,o=e.instancesLength,s=e.classes,u=e.classIds,l=e.parentCounts,c=e.parentIds,m=o;Cesium.defined(u.byteOffset)&&(u.componentType=Cesium.defaultValue(u.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),u.type=Cesium.AttributeType.SCALAR,r=Cesium.getBinaryAccessor(u),u=r.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,o));if(Cesium.defined(l))for(Cesium.defined(l.byteOffset)&&(l.componentType=Cesium.defaultValue(l.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),l.type=Cesium.AttributeType.SCALAR,r=Cesium.getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,o)),a=new Uint16Array(o),i=m=0;i<o;++i)a[i]=m,m+=l[i];Cesium.defined(c)&&Cesium.defined(c.byteOffset)&&(c.componentType=Cesium.defaultValue(c.componentType,Cesium.ComponentDatatype.UNSIGNED_SHORT),c.type=Cesium.AttributeType.SCALAR,r=Cesium.getBinaryAccessor(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,m));var d=s.length;for(i=0;i<d;++i){var h=s[i].length,f=s[i].instances,p=hc(h,f,t);s[i].instances=Cesium.combine(p,f)}var _=Cesium.arrayFill(new Array(d),0),C=new Uint16Array(o);for(i=0;i<o;++i)n=u[i],C[i]=_[n],++_[n];return{classes:s,classIds:u,classIndexes:C,parentCounts:l,parentIndexes:a,parentIds:c}}(n,i):void 0}(this,i,n),this._batchTableBinaryProperties=hc(t,f,n),this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[],this._content=e,this._colorChangedCallback=r,0<t&&(l=.5*(u=1/(o=Math.min(t,Cesium.ContextLimits.maximumTextureSize))),m=.5*(c=1/(s=Math.ceil(t/Cesium.ContextLimits.maximumTextureSize))),d=new Cesium.Cartesian2(o,s),h=new Cesium.Cartesian4(u,l,c,m)),this._textureDimensions=d,this._textureStep=h}function hc(e,t,i){var n;for(var r in t)if(t.hasOwnProperty(r)){var a=t[r],o=a.byteOffset;if(Cesium.defined(o)){var s=a.componentType,u=a.type;if(!Cesium.defined(s))throw new Cesium.RuntimeError("componentType is required.");if(!Cesium.defined(u))throw new Cesium.RuntimeError("type is required.");if(!Cesium.defined(i))throw new Cesium.RuntimeError("Property "+r+" requires a batch table binary.");var l=Cesium.getBinaryAccessor(a),c=l.componentsPerAttribute,m=l.classType,d=l.createArrayBufferView(i.buffer,i.byteOffset+o,e);Cesium.defined(n)||(n={}),n[r]={typedArray:d,componentCount:c,type:m}}}return n}function fc(e){var t=e._textureDimensions;return t.x*t.y*4}function pc(e){var t,i;return Cesium.defined(e._batchValues)||(t=fc(e),i=new Uint8Array(t),Cesium.arrayFill(i,255),e._batchValues=i),e._batchValues}function _c(e){var t,i;return Cesium.defined(e._showAlphaProperties)||(t=2*e.featuresLength,i=new Uint8Array(t),Cesium.arrayFill(i,255),e._showAlphaProperties=i),e._showAlphaProperties}Object.defineProperties(dc.prototype,{memorySizeInBytes:{get:function(){var e=0;return Cesium.defined(this._pickTexture)&&(e+=this._pickTexture.sizeInBytes),Cesium.defined(this._batchTexture)&&(e+=this._batchTexture.sizeInBytes),e}}}),dc.getBinaryProperties=hc,dc.prototype.setShow=function(e,t){var i,n,r;t&&!Cesium.defined(this._showAlphaProperties)||(r=t?255:0,(i=_c(this))[n=2*e]!==r&&(i[n]=r,pc(this)[4*e+3]=t?i[1+n]:0,this._batchValuesDirty=!0))},dc.prototype.setAllShow=function(e){for(var t=this.featuresLength,i=0;i<t;++i)this.setShow(i,e)},dc.prototype.getShow=function(e){if(!Cesium.defined(this._showAlphaProperties))return!0;var t=2*e;return 255===this._showAlphaProperties[t]};var Cc=new Array(4);function gc(e,t){var i=e.typedArray,n=e.componentCount;return 1===n?i[t]:e.type.unpack(i,t*n)}function vc(e,t,i){var n=e.typedArray,r=e.componentCount;1===r?n[t]=i:e.type.pack(i,n,t*r)}dc.prototype.setColor=function(e,t){var i,n,r,a,o,s,u,l,c;Cesium.Color.equals(t,cc)&&!Cesium.defined(this._batchValues)||(n=(i=t.toBytes(Cc))[3],r=pc(this),a=4*e,o=_c(this),s=2*e,r[a]===i[0]&&r[1+a]===i[1]&&r[2+a]===i[2]&&o[1+s]===n||(r[a]=i[0],r[1+a]=i[1],r[2+a]=i[2],u=255!==o[1+s],l=0!==o[s],r[3+a]=l?n:0,(c=255!==(o[1+s]=n))&&!u?++this._translucentFeaturesLength:!c&&u&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,Cesium.defined(this._colorChangedCallback)&&this._colorChangedCallback(e,t)))},dc.prototype.setAllColor=function(e){for(var t=this.featuresLength,i=0;i<t;++i)this.setColor(i,e)},dc.prototype.getColor=function(e,t){if(!Cesium.defined(this._batchValues))return Cesium.Color.clone(cc,t);var i=this._batchValues,n=4*e,r=this._showAlphaProperties,a=2*e;return Cesium.Color.fromBytes(i[n],i[1+n],i[2+n],r[1+a],t)},dc.prototype.getPickColor=function(e){return this._pickIds[e]},dc.prototype.applyStyle=function(e){if(!Cesium.defined(e))return this.setAllColor(cc),void this.setAllShow(!0);for(var t=this._content,i=this.featuresLength,n=0;n<i;++n){var r=t.getFeature(n),a=Cesium.defined(e.color)?e.color.evaluateColor(r,mc):cc,o=!Cesium.defined(e.show)||e.show.evaluate(r);this.setColor(n,a),this.setShow(n,o)}};var yc=[],Tc=[],xc=0;function wc(e,t,i){var n=e.parentCounts,r=e.parentIds;return Cesium.defined(r)?(Cesium.defined(n)?function(e,t,i){var n=e.classIds,r=e.parentCounts,a=e.parentIds,o=e.parentIndexes,s=n.length,u=yc;u.length=Math.max(u.length,s);var l=++xc,c=Tc;for(c.length=0,c.push(t);0<c.length;)if(u[t=c.pop()]!==l){u[t]=l;var m=i(e,t);if(Cesium.defined(m))return m;for(var d=r[t],h=o[t],f=0;f<d;++f){var p=a[h+f];p!==t&&c.push(p)}}}:function(e,t,i){for(var n=!0;n;){var r=i(e,t);if(Cesium.defined(r))return r;var a=e.parentIds[t],n=a!==t;t=a}})(e,t,i):i(e,t)}function Ac(e,t){return e=Cesium.ShaderSource.replaceMain(e,"tile_main"),t?e+"uniform float tile_colorBlend; \nvoid tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n     if(highlight== 1.0 && !all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ \n       gl_FragColor.rgb = tile_featureColor.rgb; \n      } \n} \n":e+"void tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n} \n"}function Ec(e,t,i){if(!Cesium.defined(t))return Ac(e,i);var n=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+t+";"),r=e.match(n);if(!Cesium.defined(r))return Ac(e,i);var a=r[0],o=r[2];e=(e=Cesium.ShaderSource.replaceMain(e,"tile_main")).replace(a,"");var s,u,l;return"vec3"===o||"vec4"===o?(u="vec3"===o?"vec4("+t+", 1.0)":t,l="vec3"===o?"tile_diffuse.xyz":"tile_diffuse",n=new RegExp(t,"g"),e=e.replace(n,l),s="    vec4 source = "+u+"; \n    tile_diffuse = tile_diffuse_final(source, tile_featureColor); \n    tile_main(); \n"):"sampler2D"===o&&(e=function(e,t){for(var i,n="texture2D("+t,r=0,a=e.indexOf(n,r);-1<a;){for(var o=0,s=a;s<e.length;++s){var u=e.charAt(s);if("("===u)++o;else if(")"===u&&0===--o){i=s+1;break}}var l="tile_diffuse_final("+e.slice(a,i)+", tile_diffuse)";e=e.slice(0,a)+l+e.slice(i),r=a+l.length,a=e.indexOf(n,r)}return e}(e,t),s="    tile_diffuse = tile_featureColor; \n    tile_main(); \n"),e="uniform float tile_colorBlend; \nvec4 tile_diffuse = vec4(1.0); \nbool isWhite(vec3 color) \n{ \n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); \n} \nvec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) \n{ \n    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); \n    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; \n    return vec4(diffuse.rgb, sourceDiffuse.a); \n} \n"+a+"\n"+e+"\nvoid tile_color(vec4 tile_featureColor) \n{ \n"+s,i&&(e+="    tile_featureColor = czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n     if(highlight==1.0 && !all(greaterThan(tile_featureColor.rgb, vec3(1.0 - czm_epsilon3)))){ \n       gl_FragColor.rgb = tile_featureColor.rgb; \n      } \n"),e+="} \n"}dc.prototype.isClass=function(e,n){var t=this._batchTableHierarchy;if(!Cesium.defined(t))return!1;var i=wc(t,e,function(e,t){var i=e.classIds[t];if(e.classes[i].name===n)return!0});return Cesium.defined(i)},dc.prototype.isExactClass=function(e,t){return this.getExactClassName(e)===t},dc.prototype.getExactClassName=function(e){var t=this._batchTableHierarchy;if(Cesium.defined(t)){var i=t.classIds[e];return t.classes[i].name}},dc.prototype.hasProperty=function(e,t){return Cesium.defined(this._properties[t])||Cesium.defined(this._batchTableHierarchy)&&(i=e,r=t,n=wc(this._batchTableHierarchy,i,function(e,t){var i=e.classIds[t],n=e.classes[i].instances;if(Cesium.defined(n[r]))return!0}),Cesium.defined(n));var i,r,n},dc.prototype.getPropertyNames=function(e,t){(t=Cesium.defined(t)?t:[]).length=0;var i,a,n=Object.keys(this._properties);return t.push.apply(t,n),Cesium.defined(this._batchTableHierarchy)&&(i=e,a=t,wc(this._batchTableHierarchy,i,function(e,t){var i=e.classIds[t],n=e.classes[i].instances;for(var r in n)n.hasOwnProperty(r)&&-1===a.indexOf(r)&&a.push(r)})),t},dc.prototype.getProperty=function(e,t){if(Cesium.defined(this._batchTableBinaryProperties)){var i=this._batchTableBinaryProperties[t];if(Cesium.defined(i))return gc(i,e)}var n,o,r=this._properties[t];if(Cesium.defined(r))return Cesium.clone(r[e],!0);if(Cesium.defined(this._batchTableHierarchy)){var a=(n=e,o=t,wc(this._batchTableHierarchy,n,function(e,t){var i=e.classIds[t],n=e.classes[i],r=e.classIndexes[t],a=n.instances[o];if(Cesium.defined(a))return Cesium.defined(a.typedArray)?gc(a,r):Cesium.clone(a[r],!0)}));if(Cesium.defined(a))return a}},dc.prototype.setProperty=function(e,t,i){var n,o,s,r,a,u=this.featuresLength;if(Cesium.defined(this._batchTableBinaryProperties)){var l=this._batchTableBinaryProperties[t];if(Cesium.defined(l))return void vc(l,e,i)}Cesium.defined(this._batchTableHierarchy)&&(n=e,o=t,s=i,r=wc(this._batchTableHierarchy,n,function(e,t){var i=e.classIds[t],n=e.classes[i],r=e.classIndexes[t],a=n.instances[o];if(Cesium.defined(a))return Cesium.defined(a.typedArray)?vc(a,r,s):a[r]=Cesium.clone(s,!0),!0}),Cesium.defined(r))||(a=this._properties[t],Cesium.defined(a)||(this._properties[t]=new Array(u),a=this._properties[t]),a[e]=Cesium.clone(i,!0))},dc.prototype.getVertexShaderCallback=function(n,r,a){if(0!==this.featuresLength){var o=this;return function(e){var t,i=Ec(e,a,!1);return 0<Cesium.ContextLimits.maximumVertexTextureImageUnits?(t="",n&&(t+="uniform bool tile_translucentCommand; \n"),t+="uniform sampler2D tile_batchTexture; \nvarying vec4 tile_featureColor; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec2 st = computeSt("+r+"); \n    vec4 featureProperties = texture2D(tile_batchTexture, st); \n    tile_color(featureProperties); \n    float show = ceil(featureProperties.a); \n    gl_Position *= show; \n",n&&(t+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n"),t+="    tile_featureColor = featureProperties; \n    tile_featureSt = st; \n}"):t="varying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_color(vec4(1.0)); \n    tile_featureSt = computeSt("+r+"); \n}",i+"\n"+(1===o._textureDimensions.y?"uniform vec4 tile_textureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    return vec2(centerX + (batchId * stepX), 0.5); \n} \n":"uniform vec4 tile_textureStep; \nuniform vec2 tile_textureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    float stepY = tile_textureStep.z; \n    float centerY = tile_textureStep.w; \n    float xId = mod(batchId, tile_textureDimensions.x); \n    float yId = floor(batchId / tile_textureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n")+t}}},dc.prototype.getFragmentShaderCallback=function(i,n){if(0!==this.featuresLength){var r=!1;return Cesium.defined(this._content)&&Cesium.defined(this._content._useInstancedColor)&&this._content._useInstancedColor&&(r=!0),function(e){var t=(e=Ec(e,n,!0)).lastIndexOf("tile_main();");return r&&-1<t&&(e=(e="varying vec4 v_instancedColor; \n"+e).replace("tile_main();","tile_main(); \nif(v_instancedColor.a>0.0){  \n  gl_FragColor.rgb = v_instancedColor.rgb; \n  czm_material material; material.diffuse = gl_FragColor.rgb; material.specular = 1.0; material.shininess = 256.0;  \n  material.normal = normalize(v_normal); material.emission = vec3(0.0);  material.alpha = 1.0; \n  vec4 phoneColor = czm_phong(normalize(v_positionEC), material);  \n  gl_FragColor.rgb = phoneColor.rgb; \n} \n")),0<Cesium.ContextLimits.maximumVertexTextureImageUnits?e+="uniform sampler2D tile_pickTexture; \nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_color(tile_featureColor); \n}":(i&&(e+="uniform bool tile_translucentCommand; \n"),e+="uniform sampler2D tile_pickTexture; \nuniform sampler2D tile_batchTexture; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n",i&&(e+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            discard; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            discard; \n        } \n    } \n"),e+="    tile_color(featureProperties); \n} \n"),e}}},dc.prototype.getClassificationFragmentShaderCallback=function(){if(0!==this.featuresLength)return function(e){return e=Cesium.ShaderSource.replaceMain(e,"tile_main"),0<Cesium.ContextLimits.maximumVertexTextureImageUnits?e+="uniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_main(); \n    gl_FragColor = tile_featureColor; \n}":e+="uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_main(); \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = featureProperties; \n} \n",e}},dc.prototype.getUniformMapCallback=function(){if(0!==this.featuresLength){var n=this;return function(e){var t={tile_batchTexture:function(){return Cesium.defaultValue(n._batchTexture,n._defaultTexture)},tile_textureDimensions:function(){return n._textureDimensions},tile_textureStep:function(){return n._textureStep},tile_colorBlend:function(){return e=n._content.tileset,t=Cesium.defined(e)&&Cesium.defined(e.colorBlendMode)?e.colorBlendMode:Cesium.Cesium3DTileColorBlendMode.REPLACE,i=Cesium.defined(e)&&Cesium.defined(e.colorBlendAmount)?e.colorBlendAmount:.5,t===Cesium.Cesium3DTileColorBlendMode.HIGHLIGHT?0:t===Cesium.Cesium3DTileColorBlendMode.REPLACE?1:t===Cesium.Cesium3DTileColorBlendMode.MIX?Cesium.Math.clamp(i,Cesium.Math.EPSILON4,1):void 0;var e,t,i},tile_pickTexture:function(){return Cesium.defaultValue(n._pickTexture,n._defaultTexture)}};return Cesium.combine(e,t)}}},dc.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"};var Sc=0,bc=1,Mc=2;function Rc(e){var t=e._translucentFeaturesLength;return 0===t?Sc:t===e.featuresLength?bc:Mc}function Dc(e){var t=Cesium.DrawCommand.shallowClone(e),i=t.pass===Cesium.Pass.TRANSLUCENT;return t.uniformMap=Cesium.defined(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return i},t}function Pc(e){var t,i,n=Cesium.DrawCommand.shallowClone(e);return n.pass=Cesium.Pass.TRANSLUCENT,n.renderState=(t=e.renderState,(i=Cesium.clone(t,!0)).cull.enabled=!1,i.depthTest.enabled=!0,i.depthMask=!1,i.blending=Cesium.BlendingState.ALPHA_BLEND,Cesium.RenderState.fromCache(i)),n}function Ic(e){var t,i,n=Cesium.DrawCommand.shallowClone(e);return n.renderState=(t=e.renderState,(i=Cesium.clone(t,!0)).stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),i.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK,Cesium.RenderState.fromCache(i)),n}function Oc(e,t){var i=Cesium.DrawCommand.shallowClone(t),n=Cesium.clone(i.renderState,!0);n.cull.enabled=!0,n.cull.face=Cesium.CullFace.FRONT,n.colorMask={red:!1,green:!1,blue:!1,alpha:!1},n.polygonOffset={enabled:!0,factor:5,units:5},n.stencilTest=Cesium.StencilConstants.setCesium3DTileBit(),n.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK,i.renderState=Cesium.RenderState.fromCache(n),i.castShadows=!1,i.receiveShadows=!1,i.uniformMap=Cesium.clone(t.uniformMap);var r,a,o,s,u=new Cesium.Cartesian2(5,5);return i.uniformMap.u_polygonOffset=function(){return u},i.shaderProgram=(r=e,a=t.shaderProgram,s=r.shaderCache.getDerivedShaderProgram(a,"zBackfaceLogDepth"),Cesium.defined(s)||((o=a.fragmentShaderSource.clone()).defines=Cesium.defined(o.defines)?o.defines.slice(0):[],o.defines.push("POLYGON_OFFSET"),o.sources.unshift("#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"),s=r.shaderCache.createDerivedShaderProgram(a,"zBackfaceLogDepth",{vertexShaderSource:a.vertexShaderSource,fragmentShaderSource:o,attributeLocations:a._attributeLocations})),s),i}function Lc(e,t){var i=Cesium.DrawCommand.shallowClone(e),n=Cesium.clone(i.renderState,!0);return n.stencilTest.enabled=!0,n.stencilTest.mask=Cesium.StencilConstants.SKIP_LOD_MASK,n.stencilTest.reference=Cesium.StencilConstants.CESIUM_3D_TILE_MASK|t<<Cesium.StencilConstants.SKIP_LOD_BIT_SHIFT,n.stencilTest.frontFunction=Cesium.StencilFunction.GREATER_OR_EQUAL,n.stencilTest.frontOperation.zPass=Cesium.StencilOperation.REPLACE,n.stencilTest.backFunction=Cesium.StencilFunction.GREATER_OR_EQUAL,n.stencilTest.backOperation.zPass=Cesium.StencilOperation.REPLACE,n.stencilMask=Cesium.StencilConstants.CESIUM_3D_TILE_MASK|Cesium.StencilConstants.SKIP_LOD_MASK,i.renderState=Cesium.RenderState.fromCache(n),i}function Nc(e,t,i){var n=e._textureDimensions;return new Cesium.Texture({context:t,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE,source:{width:n.x,height:n.y,arrayBufferView:i},flipY:!1,sampler:Cesium.Sampler.NEAREST})}function Bc(e,t){var i=e.featuresLength;if(!Cesium.defined(e._pickTexture)&&0<i){for(var n=e._pickIds,r=fc(e),a=new Uint8Array(r),o=e._content,s=0;s<i;++s){var u=t.createPickId(o.getFeature(s));n.push(u);var l=u.color,c=4*s;a[c]=Cesium.Color.floatToByte(l.red),a[1+c]=Cesium.Color.floatToByte(l.green),a[2+c]=Cesium.Color.floatToByte(l.blue),a[3+c]=Cesium.Color.floatToByte(l.alpha)}e._pickTexture=Nc(e,t,a),o.tileset._statistics.batchTableByteLength+=e._pickTexture.sizeInBytes}}function zc(e){var t=e._textureDimensions;e._batchTexture.copyFrom({width:t.x,height:t.y,arrayBufferView:e._batchValues})}function Fc(e,t){t=Cesium.defaultValue(t,Cesium.defaultValue.EMPTY_OBJECT),this._tileset=e,this._modelInstanceCollection=void 0,this._batchTable=void 0,this._features=void 0,this._blUpdate=!0,this._useInstancedColor=Cesium.defaultValue(t.useInstancedColor,!1),this._cacheInstances=Cesium.defaultValue(t.instances,[]);for(var i=[],n=0;n<this._cacheInstances.length;n++)i.push(this._cacheInstances[n].name);this._batchTable=new dc(this,this._cacheInstances.length,{name:i});var r={batchTable:this._batchTable,instances:this._cacheInstances,cacheKey:t.cacheKey,dynamic:!0,cull:!1,url:void 0,requestType:Cesium.RequestType.TILES3D,gltf:t.gltf,basePath:t.uri,incrementallyLoadTextures:!1,upAxis:Cesium.Axis.Y,forwardAxis:Cesium.Axis.Z,opaquePass:Cesium.Pass.CESIUM_3D_TILE,debugShowBoundingVolume:!1,useInstancedColor:this._useInstancedColor};this._modelInstanceCollection=new jl(r)}function Vc(e){this.geometry=void 0,this.blUpdateVAO=!1,this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1})})}dc.prototype.addDerivedCommands=function(e,t){for(var i,n=e.commandList,r=n.length,a=this._content._tile,o=a._finalResolution,s=a.tileset,u=s._skipLevelOfDetail&&s._hasMixedContent&&e.context.stencilBuffer,l=Rc(this),c=t;c<r;++c){var m=n[c],d=m.derivedCommands.tileset;Cesium.defined(d)&&!m.dirty||(d={},(m.derivedCommands.tileset=d).originalCommand=Dc(m),m.dirty=!1);var h=d.originalCommand;l!==Sc&&m.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(d.translucent)||(d.translucent=Pc(h))),l!==bc&&m.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(d.opaque)||(d.opaque=Ic(h)),u&&(o||(Cesium.defined(d.zback)||(d.zback=Oc(e.context,h)),s._backfaceCommands.push(d.zback)),Cesium.defined(d.stencil)&&a._selectionDepth===(i=d.stencil,(i.renderState.stencilTest.reference&Cesium.StencilConstants.SKIP_LOD_MASK)>>>Cesium.StencilConstants.SKIP_LOD_BIT_SHIFT)||(m.renderState.depthMask?d.stencil=Lc(h,a._selectionDepth):d.stencil=d.opaque)));var f=u?d.stencil:d.opaque,p=d.translucent;m.pass!==Cesium.Pass.TRANSLUCENT?(l===Sc&&(n[c]=f),l===bc&&(n[c]=p),l===Mc&&(n[c]=f,n.push(p))):n[c]=h}},dc.prototype.addDerivedCommandsNoTileset=function(e,t){for(var i=e.commandList,n=i.length,r=Rc(this),a=t;a<n;++a){var o=i[a],s=o.derivedCommands.tileset;Cesium.defined(s)&&!o.dirty||(s={},(o.derivedCommands.tileset=s).originalCommand=Dc(o),o.dirty=!1);var u=s.originalCommand;r!==Sc&&o.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(s.translucent)||(s.translucent=Pc(u))),r!==bc&&o.pass!==Cesium.Pass.TRANSLUCENT&&(Cesium.defined(s.opaque)||(s.opaque=Ic(u)));var l=s.opaque,c=s.translucent;o.pass!==Cesium.Pass.TRANSLUCENT?(r===Sc&&(i[a]=l),r===bc&&(i[a]=c),r===Mc&&(i[a]=l,i.push(c))):i[a]=u}},dc.prototype.update=function(e,t){var i=t.context;this._defaultTexture=i.defaultTexture;var n=t.passes;(n.pick||n.postProcess)&&Bc(this,i),this._batchValuesDirty&&(this._batchValuesDirty=!1,Cesium.defined(this._batchTexture)||(this._batchTexture=Nc(this,i,this._batchValues),Cesium.defined(e._statistics)&&(e._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes)),zc(this))},dc.prototype.updateNoStatistics=function(e,t){var i=t.context;this._defaultTexture=i.defaultTexture;var n=t.passes;(n.pick||n.postProcess)&&Bc(this,i),this._batchValuesDirty&&(this._batchValuesDirty=!1,Cesium.defined(this._batchTexture)||(this._batchTexture=Nc(this,i,this._batchValues)),zc(this))},dc.prototype.isDestroyed=function(){return!1},dc.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();for(var e=this._pickIds,t=e.length,i=0;i<t;++i)e[i].destroy();return Cesium.destroyObject(this)},dc._DEFAULT_COLOR_VALUE=cc,dc._DEFAULT_SHOW_VALUE=!0,Object.defineProperties(Fc.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},ready:{get:function(){return this._modelInstanceCollection.ready}},batchTable:{get:function(){return this._batchTable}},model:{get:function(){return Cesium.defined(this._modelInstanceCollection)?this._modelInstanceCollection._model:void 0}},tileset:{get:function(){return this._tileset}},useInstancedColor:{get:function(){return this._useInstancedColor},set:function(e){this._useInstancedColor=e,Cesium.defined(this._modelInstanceCollection)&&(this._modelInstanceCollection._useInstancedColor=e)}}}),Fc.prototype.hasProperty=function(e,t){return this._batchTable.hasProperty(e,t)},Fc.prototype.getFeature=function(e){this.featuresLength;return function(e){var t=e.featuresLength;if(!Cesium.defined(e._features)&&0<t){for(var i=new Array(t),n=0;n<t;++n)i[n]=new Cesium.Cesium3DTileFeature(e,n);e._features=i}}(this),this._features[e]},Fc.prototype.applyDebugSettings=function(e,t){t=e?t:Cesium.Color.WHITE,this._batchTable.setAllColor(t)},Fc.prototype.applyStyle=function(e){this._batchTable.applyStyle(e)},Fc.prototype.regenerteInstanced=function(e){var t=!1,i=[];this._cacheInstances.length<e.length&&(t=!0);for(var n=!1,r=0;r<e.length;r++)this._cacheInstances.length>=e.length&&(this._cacheInstances[r].name!=e[r].name||!Cesium.Color.equals(this._cacheInstances[r].modelColor,e[r].modelColor))&&(t=!0),e[r].visible&&(n=!0),i.push(e[r].name);this._blUpdate=n,t?(this._cacheInstances=e,this._features=void 0,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._batchTable=new dc(this,e.length,{name:i}),this._modelInstanceCollection._batchTable=this._batchTable,this._modelInstanceCollection.instancingRegenertedOnce=!0):this._modelInstanceCollection.dirty=!0,this._modelInstanceCollection.regenerteInstanced(e)},Fc.prototype.update=function(e){var t;this._blUpdate&&(t=e.commandList.length,this._batchTable.update(this,e),this._modelInstanceCollection.update(e),t<e.commandList.length&&(e.passes.render||e.passes.pick)&&this._modelInstanceCollection._batchTable.addDerivedCommandsNoTileset(e,t,!1))},Fc.prototype.isDestroyed=function(){return!1},Fc.prototype.destroy=function(){return this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),Cesium.destroyObject(this)},Object.defineProperties(Vc.prototype,{});var Uc=new Ji("createTraceWallVertices",1);function Gc(e){this.blUpdateVAO=!1,this.barMesh=void 0,this.boundingSphere=new Cesium.BoundingSphere,this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1})})}function kc(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.scene=e.scene,this.geometry=void 0,this.blUpdateVAO=!1,this.extentBox=Cesium.defaultValue(e.extentBox,new Cesium.Cartesian3(2,2,2)),this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:!0,depthMask:!1})})}Vc.prototype.recreateVertexArrays=function(e){var t=e.length;if(e instanceof Array&&0<t){for(var i=[],n=0;n<t;n++)Cesium.defined(e[n])&&e[n].wallVisible&&1<e[n].trackPoints.length&&i.push({color:e[n].wallColor,trackPoints:e[n].trackPoints});if(0<i.length){var r=Uc.scheduleTask({traceWalls:i});if(!Cesium.defined(r))return void(i=[]);var a=this;Cesium.when(r).then(function(e){var t=new Cesium.GeometryAttributes;t.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float64Array(e.positionBuffer)}),t.pickColor=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:new Uint8Array(e.colorBuffer),normalize:!0}),a.geometry=new Cesium.Geometry({attributes:t,indices:Cesium.IndexDatatype.createTypedArray(e.positionBuffer/3,e.indices),boundingSphere:new Cesium.BoundingSphere(e.boundingSphere.center,e.boundingSphere.radius)}),a.blUpdateVAO=!0})}}},Vc.prototype.update=function(e){var t=e.context,i=this._command;Cesium.defined(this.geometry)&&(Cesium.defined(i.vertexArray)&&!i.vertexArray.isDestroyed()&&i.vertexArray.destroy(),this.blUpdateVAO&&(i.vertexArray=Cesium.VertexArray.fromGeometry({context:t,geometry:this.geometry,attributeLocations:Cesium.GeometryPipeline.createAttributeLocations(this.geometry),bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),i._boundingVolume=this.geometry.boundingSphere,Cesium.defined(i.shaderProgram)||(i.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:"attribute vec3 position;\nattribute vec4 color; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    gl_Position = czm_viewProjection * vec4(position, 1.0);\n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}))),Cesium.defined(i.vertexArray)&&e.commandList.push(i),this.blUpdateVAO=!1)},Vc.prototype.isDestroyed=function(){return!1},Vc.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.destroyObject(this)},Object.defineProperties(Gc.prototype,{}),Gc.prototype.recreateVertexArrays=function(e){var t=e.length;if(e instanceof Array&&0<t){for(var i=[],n=0;n<t;n++)if(Cesium.defined(e[n])&&e[n].barVisible&&1<e[n].barPoints.length)for(var r=0;r<e[n].barPoints.length;r++)i.push({pos:e[n].barPoints[r].wcPosition,color:e[n].barColor});if(0<i.length){this.boundingSphere=new Cesium.BoundingSphere;for(var a=2*i.length,o=a,s=Cesium.IndexDatatype.createTypedArray(a,o),u=new Float64Array(3*a),l=new Uint8Array(4*a),c=0;c<i.length;c++){u[6*c+0]=i[c].pos.x,u[6*c+1]=i[c].pos.y,u[6*c+2]=i[c].pos.z;var m=Cesium.Cartographic.fromCartesian(i[c].pos),d=Cesium.Cartesian3.fromRadians(m.longitude,m.latitude);u[6*c+3]=d.x,u[6*c+4]=d.y,u[6*c+5]=d.z,l[8*c+0]=Cesium.Color.floatToByte(i[c].color.red),l[8*c+1]=Cesium.Color.floatToByte(i[c].color.green),l[8*c+2]=Cesium.Color.floatToByte(i[c].color.blue),l[8*c+3]=Cesium.Color.floatToByte(i[c].color.alpha),l[8*c+4]=Cesium.Color.floatToByte(i[c].color.red),l[8*c+5]=Cesium.Color.floatToByte(i[c].color.green),l[8*c+6]=Cesium.Color.floatToByte(i[c].color.blue),l[8*c+7]=Cesium.Color.floatToByte(i[c].color.alpha),this.boundingSphere=Cesium.BoundingSphere.expand(this.boundingSphere,i[c].pos),this.boundingSphere=Cesium.BoundingSphere.expand(this.boundingSphere,d)}for(r=0;r<o;r++)s[r]=r;this.barMesh={position:u,color:l,indices:s},this.blUpdateVAO=!0}}},Gc.prototype.update=function(e){var t,i,n=e.context,r=this._command;Cesium.defined(this.barMesh)&&(Cesium.defined(r.vertexArray)&&!r.vertexArray.isDestroyed()&&r.vertexArray.destroy(),this.blUpdateVAO&&(t=0,(i=[]).push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.barMesh.position),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.UNSIGNED_BYTE,this.barMesh.color),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),r.vertexArray=new Cesium.VertexArray({context:n,attributes:i,indexBuffer:Cesium.Buffer.createIndexBuffer({context:n,typedArray:this.barMesh.indices,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})}),r._boundingVolume=this.boundingSphere,Cesium.defined(r.shaderProgram)||(r.shaderProgram=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:"attribute vec3 position;\nattribute vec4 color; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    gl_Position = czm_viewProjection * vec4(position, 1.0);\n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}))),Cesium.defined(r.vertexArray)&&e.commandList.push(r),this.blUpdateVAO=!1)},Gc.prototype.isDestroyed=function(){return!1},Gc.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.destroyObject(this)},kc.prototype.recreateVertexArrays=function(e){var t=e.length;if(e instanceof Array&&0<t){for(var i=8*t,n=36*t,r=Cesium.IndexDatatype.createTypedArray(i,n),a=new Cesium.BoundingSphere(new Cesium.Cartesian3(0,0,0),6378137),o=new Float32Array(3*i),s=new Uint8Array(4*i),u=0,l=0,c=0;c<t;c++){for(var m=Wc(e[c].modelMatrix,e[c].boxGeometry,this.extentBox),d=0;d<m.length;d++)o[u++]=m[d].x,o[u++]=m[d].y,o[u++]=m[d].z,s[l++]=Cesium.Color.floatToByte(e[c].color.red),s[l++]=Cesium.Color.floatToByte(e[c].color.green),s[l++]=Cesium.Color.floatToByte(e[c].color.blue),s[l++]=Cesium.Color.floatToByte(e[c].color.alpha);r[36*c+0]=8*c+0,r[36*c+1]=8*c+1,r[36*c+2]=8*c+3,r[36*c+3]=8*c+1,r[36*c+4]=8*c+2,r[36*c+5]=8*c+3,r[36*c+6]=8*c+7,r[36*c+7]=8*c+6,r[36*c+8]=8*c+4,r[36*c+9]=8*c+6,r[36*c+10]=8*c+5,r[36*c+11]=8*c+4,r[36*c+12]=8*c+3,r[36*c+13]=8*c+2,r[36*c+14]=8*c+6,r[36*c+15]=8*c+3,r[36*c+16]=8*c+6,r[36*c+17]=8*c+7,r[36*c+18]=8*c+0,r[36*c+19]=8*c+4,r[36*c+20]=8*c+5,r[36*c+21]=8*c+0,r[36*c+22]=8*c+5,r[36*c+23]=8*c+1,r[36*c+24]=8*c+3,r[36*c+25]=8*c+7,r[36*c+26]=8*c+4,r[36*c+27]=8*c+3,r[36*c+28]=8*c+4,r[36*c+29]=8*c+0,r[36*c+30]=8*c+2,r[36*c+31]=8*c+1,r[36*c+32]=8*c+5,r[36*c+33]=8*c+2,r[36*c+34]=8*c+5,r[36*c+35]=8*c+6}var h=new Cesium.GeometryAttributes;h.position=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:o}),h.pickColor=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:s,normalize:!0}),this.geometry=new Cesium.Geometry({attributes:h,indices:r,boundingSphere:a}),this.blUpdateVAO=!0}};var Hc=new si;function Wc(e,t,i){var n=[],r=Cesium.Cartesian3.subtract(t._minimum,i,new Cesium.Cartesian3),a=Cesium.Cartesian3.add(t._maximum,i,new Cesium.Cartesian3);return Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(a.x,a.y,r.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(a.x,r.y,r.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(a.x,r.y,a.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(a.x,a.y,a.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(r.x,a.y,r.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(r.x,r.y,r.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(r.x,r.y,a.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),Hc=Cesium.Matrix4.multiplyByPoint(e,new Cesium.Cartesian3(r.x,a.y,a.z),Hc),n.push({x:Hc.x,y:Hc.y,z:Hc.z}),n}function qc(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.geometry=void 0,this.blUpdateVAO=!1,this.boundingSphere=void 0,this._mode=void 0,this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL}}),uniformMap:{}})}kc.prototype.update=function(e){var t=e.context,i=this._command;Cesium.defined(i.vertexArray)&&!i.vertexArray.isDestroyed()&&i.vertexArray.destroy(),this.blUpdateVAO&&(i.vertexArray=Cesium.VertexArray.fromGeometry({context:t,geometry:this.geometry,attributeLocations:Cesium.GeometryPipeline.createAttributeLocations(this.geometry),bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),i._boundingVolume=this.geometry.boundingSphere,Cesium.defined(i.shaderProgram)||(i.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:"attribute vec3 position;\nattribute vec4 color; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    gl_Position = czm_viewProjection * vec4(position, 1.0);\n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}))),Cesium.defined(i.vertexArray)&&e.commandList.push(i),this.blUpdateVAO=!1},kc.prototype.isDestroyed=function(){return!1},kc.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.destroyObject(this)},Object.defineProperties(qc.prototype,{});var jc=new dr,Yc=new Xn;function Xc(){this.modelCollection=void 0,this.iconCollection=void 0,this.cacheIconUri=void 0,this.cacheIcon=void 0,this.instancesPerFrame=[],this.modelIconsPerFrame=[],this.modelLabelPerFrame=[],this.modelLabelPullWirePerFrame=[],this.modelTracePerFrame=[],this.modelBoundingboxPerFrame=[],this.modelSectorsPerFrame=[]}function Kc(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),!Cesium.defined(e.viewer))throw new Cesium.DeveloperError("new EV_MovingTargetVisualizer object  viewer of options is empty!");this._viewer=e.viewer,this._scene=this._viewer.scene,this._useInstancedColor=Cesium.defaultValue(e.useInstancedColor,!1),this._statistics=new Cesium.Cesium3DTilesetStatistics,this.mtVisualDatas=new Cesium.AssociativeArray,this.modelRibbonCollection=new $i,this.modelTraceWallCollection=new Vc,this.modelTraceBarCollection=new Gc,this.modelLabelCollection=new Cesium.LabelCollection({scene:this._scene}),this._modelLabelPullWireCollection=new Jn({scene:this._scene}),this.modelBoundingBoxCollection=new kc({scene:this._scene}),this.modelTraceLineCollection=new qc({viewer:this._viewer}),this.modelSectorRadarCollection=void 0}function Zc(e,t){var a=e,o=t.modelUri,s=(t.modelType,t.keyName),u=Cesium.defaultValue(t.instances,[]),l=void 0;a.mtVisualDatas.contains(s)?l=a.mtVisualDatas.get(s):(l=new Xc,a.mtVisualDatas.set(s,l));var i=Cesium.Resource.createIfNeeded(o),n=Cesium.defaultValue(t.basePath,i.clone());Cesium.Resource.createIfNeeded(n);i.fetchArrayBuffer().then(function(e){var t,i,n=new Uint8Array(e),r=void 0;i=n,r="glTF"===Cesium.getMagic(i)?sr(n):(t=Cesium.getStringFromTypedArray(n),JSON.parse(t)),l.modelCollection=new Fc(a,{instances:u,cacheKey:s,gltf:r,uri:o,useInstancedColor:a._useInstancedColor})}).otherwise()}qc.prototype.recreateVertexArrays=function(e,t){this._mode=t.mode;var i=t.mapProjection,n=e.length,r=0,a=0,o=[];if(e instanceof Array&&0<n){for(var s=0;s<n;s++)Cesium.defined(e[s])&&e[s].lineVisible&&1<e[s].trackPoints.length&&(r+=2*(e[s].trackPoints.length-1),a+=e[s].trackPoints.length,o.push(e[s]));if(0==o.length)return;for(var u=Cesium.IndexDatatype.createTypedArray(a,r),l=new Float32Array(3*a),c=new Float32Array(3*a),m=new Uint8Array(4*a),d=void 0,h=0,f=0,p=0;p<o.length;p++){for(var _=o[p].lineColor,C=0;C<o[p].trackPoints.length;C++){var g=o[p].trackPoints[C],d=Cesium.defined(d)?Cesium.BoundingSphere.expand(d,g.wcPosition):new Cesium.BoundingSphere(g.wcPosition,200),v=void 0;C<o[p].trackPoints.length-1&&(u[h++]=f+C,u[h++]=f+C+1,v=o[p].trackPoints[C+1]);var y,T=g.wcPosition;this._mode==Cesium.SceneMode.SCENE2D&&((T=i.project(i.ellipsoid.cartesianToCartographic(g.wcPosition,jc))).z=0,Cesium.defined(v)&&(y=i.project(i.ellipsoid.cartesianToCartographic(v.wcPosition,jc)),(0<T.x&&y.x<0||T.x<0&&0<y.x)&&(u[h-1]=f+C))),Cesium.EncodedCartesian3.fromCartesian(T,Yc);var x=Yc.high,w=Yc.low;l[3*(f+C)]=x.x,l[3*(f+C)+1]=x.y,l[3*(f+C)+2]=x.z,c[3*(f+C)]=w.x,c[3*(f+C)+1]=w.y,c[3*(f+C)+2]=w.z,m[4*(f+C)]=Cesium.Color.floatToByte(_.red),m[4*(f+C)+1]=Cesium.Color.floatToByte(_.green),m[4*(f+C)+2]=Cesium.Color.floatToByte(_.blue),m[4*(f+C)+3]=Cesium.Color.floatToByte(_.alpha)}f+=o[p].trackPoints.length}this.traceMesh={position3DHigh:l,position3DLow:c,color:m,indices:u},Cesium.defined(d)&&(this.boundingSphere=d.clone()),this.blUpdateVAO=!0}},qc.prototype.update=function(e){var t,i,n=e.context,r=this._command;Cesium.defined(r.vertexArray)&&!r.vertexArray.isDestroyed()&&r.vertexArray.destroy(),this.blUpdateVAO&&Cesium.defined(this.traceMesh)&&(t=0,(i=[]).push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.traceMesh.position3DHigh),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.traceMesh.position3DLow),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.UNSIGNED_BYTE,this.traceMesh.color),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),r.vertexArray=new Cesium.VertexArray({context:n,attributes:i,indexBuffer:Cesium.Buffer.createIndexBuffer({context:n,typedArray:this.traceMesh.indices,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})}),r._boundingVolume=this.boundingSphere,Cesium.defined(r.shaderProgram)||(r.shaderProgram=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:"attribute vec3 positionHigh;\nattribute vec3 positionLow;\nattribute vec4 color;\nvarying vec4  v_colour;\nvoid main()\n{\n   v_colour = color; \n   vec4 p;\n   if(czm_morphTime == 1.0){\n    p = czm_translateRelativeToEye(positionHigh.xyz, positionLow.xyz);\n   }else if(czm_morphTime == 0.0){\n    p = czm_translateRelativeToEye(positionHigh.zxy, positionLow.zxy);\n   }else{\n    p = czm_columbusViewMorph(\n    czm_translateRelativeToEye(positionHigh.zxy, positionLow.zxy),\n    czm_translateRelativeToEye(positionHigh.xyz, positionLow.xyz),\n    czm_morphTime);\n   }\n   vec4 positionEC = czm_modelViewRelativeToEye * p;\n   vec4 positionWindow = czm_eyeToWindowCoordinates(positionEC); \n   vec4 positionWC = vec4(positionWindow.xy, -positionWindow.z, 1.0) * (czm_projection * positionEC).w;;\n   gl_Position = czm_viewportOrthographic * positionWC;\n   #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n   #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}))),Cesium.defined(r.vertexArray)&&!r.vertexArray.isDestroyed()&&e.commandList.push(r),this.blUpdateVAO=!1},qc.prototype.isDestroyed=function(){return!1},qc.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.destroyObject(this)},Object.defineProperties(Kc.prototype,{modelLabelPullWireCollection:{get:function(){return this._modelLabelPullWireCollection}}}),Kc.prototype.add=function(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),!Cesium.defined(e.keyName)||""==e.keyName)throw new Cesium.DeveloperError("options of keyName  is empty!");if(!Cesium.defined(e.modelType)||""==e.modelType)throw new Cesium.DeveloperError("options of modelType  is empty!.");if(!Cesium.defined(e.modelUri)||""==e.modelUri)throw new Cesium.DeveloperError("options of modelUri  is empty!.");Zc(this,e),Cesium.defined(e.modelIconUri)&&function(e,t){var i=e,n=(t.modelType,t.modelIconUri),r=t.keyName,a=Cesium.defaultValue(t.iconInstances,[]),o=void 0;if(i.mtVisualDatas.contains(r)?o=i.mtVisualDatas.get(r):((o=new Xc).cacheIconUri=n,i.mtVisualDatas.set(r,o)),!Cesium.defined(o))throw new Cesium.DeveloperError("creat Moving Target Icon  Data is empty!.");Cesium.defined(o.cacheIcon)?o.iconCollection=new Cesium.BillboardCollection({scene:i._scene}):Cesium.Resource.fetchImage(n).then(function(e){o.iconCollection=new Cesium.BillboardCollection({scene:i._scene}),o.cacheIcon=e;for(var t=0;t<a;t++)o.iconCollection.add(a[t])})}(this,e);var t=e.keyName,i=void 0;this.mtVisualDatas.contains(t)?i=this.mtVisualDatas.get(t):(i=new Xc,this.mtVisualDatas.set(t,i))},Kc.prototype.getMTVisualData=function(e){return this.mtVisualDatas.get(e)},Kc.prototype.contains=function(e){return!!this.mtVisualDatas.get(e)},Kc.prototype.prePassesUpdate=function(e){for(var t=0;t<this.mtVisualDatas.length;t++){var i=this.mtVisualDatas.values[t];Cesium.defined(i.modelCollection)}},Kc.prototype.postPassesUpdate=function(e){for(var t=0;t<this.mtVisualDatas.length;t++){var i=this.mtVisualDatas.values[t];Cesium.defined(i.modelCollection)}};var Jc=new ha;Kc.prototype.update=function(e){this._statistics.clear();for(var t=[],i=[],n=[],r=[],a=0;a<this.mtVisualDatas.length;a++){var o=this.mtVisualDatas.values[a];if(Cesium.defined(o.modelCollection)&&(o.modelCollection.ready&&o.modelCollection.regenerteInstanced(o.instancesPerFrame),o.modelCollection.update(e)),Cesium.defined(o.iconCollection)){for(var s=[],u=0;u<o.modelIconsPerFrame.length;u++)o.modelIconsPerFrame[u].image=Cesium.defined(o.cacheIcon)?o.cacheIcon:o.cacheIconUri,s[u]=new Cesium.Billboard(o.modelIconsPerFrame[u],o.iconCollection),s[u].movingTargetIcon=!0,s[u].id=o.modelIconsPerFrame[u].name;o.iconCollection.resize(s),o.iconCollection.update(e)}t=t.concat(o.modelLabelPerFrame),i=i.concat(o.modelTracePerFrame),n=n.concat(o.modelBoundingboxPerFrame),r=r.concat(o.modelSectorsPerFrame)}if(0<t.length){for(var l=[],u=0;u<t.length;u++)l[u]=new Cesium.Label(t[u],this.modelLabelCollection),l[u].modelLabelPullWireColor=t[u].modelLabelPullWireColor,l[u].id=t[u].id;this.modelLabelCollection.resize(l),this.modelLabelCollection.update(e);for(var c=[],m=0;m<this.modelLabelCollection.length;m++){var d=this.modelLabelCollection.get(m);Jc.x=0,Jc.y=0,Jc=Cesium.Label.getScreenSpaceBoundingBox(d,Jc);var h=Cesium.Cartesian3.clone(d.position),h=Cesium.SceneTransforms.computeActualWgs84Position(e,h);c.push({position:h,scale:d.totalScale,imageSize:new Cesium.Cartesian2(Jc.width,Jc.height),pixelOffset:d.pixelOffset,origin:new Cesium.Cartesian2(d.horizontalOrigin,d.verticalOrigin),color:d.modelLabelPullWireColor,distanceDisplayCondition:d.distanceDisplayCondition})}this._modelLabelPullWireCollection.resizeLabelInfos(c),this._modelLabelPullWireCollection.update(e)}0<i.length&&(this.modelRibbonCollection.recreateVertexArrays(i),this.modelRibbonCollection.update(e),this.modelTraceWallCollection.recreateVertexArrays(i),this.modelTraceBarCollection.recreateVertexArrays(i),this.modelTraceLineCollection.recreateVertexArrays(i,e)),this.modelTraceWallCollection.update(e),this.modelTraceBarCollection.update(e),this.modelTraceLineCollection.update(e),0<n.length&&(this.modelBoundingBoxCollection.recreateVertexArrays(n),this.modelBoundingBoxCollection.update(e)),0<r.length&&(Cesium.defined(this.modelSectorRadarCollection)||(this.modelSectorRadarCollection=new Wn),this.modelSectorRadarCollection.resetRadarByPositionProperty(r)),Cesium.defined(this.modelSectorRadarCollection)&&this.modelSectorRadarCollection.update(e)},Kc.prototype.isDestroyed=function(){return!1},Kc.prototype.destroy=function(){for(var e=0;e<this.mtVisualDatas.length;e++){var t=this.mtVisualDatas.values[e];Cesium.defined(t.modelCollection)&&t.modelCollection.destroy(),Cesium.defined(t.iconCollection)&&t.iconCollection.destroy()}return this.mtVisualDatas.removeAll(),Cesium.defined(this.modelRibbonCollection)&&this.modelRibbonCollection.destroy(),Cesium.defined(this.modelTraceWallCollection)&&this.modelTraceWallCollection.destroy(),Cesium.defined(this.modelTraceBarCollection)&&this.modelTraceBarCollection.destroy(),Cesium.defined(this.modelTraceLineCollection)&&this.modelTraceLineCollection.destroy(),Cesium.defined(this.modelLabelCollection)&&this.modelLabelCollection.destroy(),Cesium.defined(this._modelLabelPullWireCollection)&&this._modelLabelPullWireCollection.destroy(),Cesium.defined(this.modelBoundingBoxCollection)&&this.modelBoundingBoxCollection.destroy(),Cesium.defined(this.modelSectorRadarCollection)&&this.modelSectorRadarCollection.destroy(),Cesium.destroyObject(this)};var Qc=Object.freeze({Ribbon:0,Wall:1,Bar:2,Line:3});function $c(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),!Cesium.defined(e.viewer))throw new Cesium.DeveloperError("new EV_MovingTargetManager object  viewer of options is empty!");if(!Cesium.defined(e.ev_dataMgr))throw new Cesium.DeveloperError("ev_dataMgr is empty!.");this._viewer=e.viewer,this._scene=this._viewer.scene,this._camera=this._viewer.camera,this._ev_MTVisualizer=new Kc({viewer:this._viewer,useInstancedColor:Cesium.defaultValue(e.useInstancedColor,!1)}),this.transformFunc=Cesium.Transforms.localFrameToFixedFrameGenerator("north","west"),this.ev_dataMgr=e.ev_dataMgr,this.trainingClock=Cesium.defaultValue(e.trainingClock,void 0),this._retainOutdatedData=Cesium.defaultValue(e.retainOutdatedData,!1),this.lastTrainingTimeMsec=0,this._mtVisibleCountInFrustum=0,this.dataOperated=Kt.ADD,this.curFrameTime=(new Date).getTime(),this.curTimeMovingTargets=[],this._mode=Cesium.SceneMode.SCENE3D,this.preUpdateRenderMovingTargetFunc=Cesium.defaultValue(e.preUpdateRenderMovingTargetFunc,void 0),this.ev_MTZoomFactors=new Cesium.AssociativeArray,this.ev_MTLabelConfigurationTables=new Cesium.AssociativeArray,this.graduatedColors=new Cesium.AssociativeArray,this.ev_MTFlightDatas=new Cesium.AssociativeArray,this.onMouseLeftDownEvent=new Cesium.Event,this.onMouseRightDownEvent=new Cesium.Event,this._scene.primitives.add(this);var r,a,o,s,u,l,c=this;c.dataSource=new Cesium.CustomDataSource("MTManagerDataSource"),c.dataSource.update=function(e){var t;return c.curFrameTime=Cesium.JulianDate.toDate(e).getTime(),c.dataOperated==Kt.ADD?(Cesium.defined(c.trainingClock)&&(t=c.trainingClock.tick(),c.curFrameTime=Cesium.JulianDate.toDate(t).getTime()),c.lastTrainingTimeMsec=c.curFrameTime):c.dataOperated==Kt.REPLACE&&(Cesium.defined(c.trainingClock)?c.curFrameTime=c.trainingClock.shouldAnimate?c.lastTrainingTimeMsec+=40:c.lastTrainingTimeMsec:c.curFrameTime=c._viewer.clock.shouldAnimate?c.lastTrainingTimeMsec+=40:c.lastTrainingTimeMsec),c.curTimeMovingTargets=function(e,t,i){var n=[];for(var r in e.ev_MTFlightDatas._hash){var a=e.ev_MTFlightDatas.get(r).getMovingTargetStateByTime(t,i);Cesium.defined(a)&&n.push(a)}return n}(c,c.curFrameTime,c._retainOutdatedData),!0},c._viewer.dataSourceDisplay.dataSources.add(c.dataSource),c.receiveDataListenerFunc=function(e,t){var i=Cesium.defined(t)?t:Kt.ADD;if(e instanceof Cesium.AssociativeArray)if(i==Kt.ADD)for(var n=0;n<e.length;n++){var r=c.ev_MTFlightDatas.get(e._array[n].uId);Cesium.defined(r)||(r=new jt(e._array[n]),c.ev_MTFlightDatas.set(e._array[n].uId,r)),r.timeAttitudeCollection=r.timeAttitudeCollection.concat(e._array[n].timeAttitudeCollection)}else if(i==Kt.REPLACE){for(n=0;n<e.length;n++){r=c.ev_MTFlightDatas.get(e._array[n].uId);Cesium.defined(r)||(r=new jt(e._array[n]),c.ev_MTFlightDatas.set(e._array[n].uId,r)),r.timeAttitudeCollection=[],r.timeAttitudeCollection=e._array[n].timeAttitudeCollection,Cesium.defined(r.trace)&&r.trace.clearAll()}c.dataOperated=Kt.ADD}},c.ev_dataMgr.addReceiveDataListener(Gt.NET_MSG_TSPI,c.receiveDataListenerFunc),s=!1,l=u=o=a=void 0,(r=c).eventHandler=new Cesium.ScreenSpaceEventHandler(r._scene.canvas),r.eventHandler.setInputAction(function(e){o=e.position;var t,i,n=r._scene.pick(e.position);Cesium.defined(n)?n instanceof Cesium.Cesium3DTileFeature&&n.content instanceof Fc?(t=n.content._batchTable._properties.name[n._batchId],r.onMouseLeftDownEvent&&r.onMouseLeftDownEvent.raiseEvent(r.ev_MTFlightDatas.get(t))):(i=n.primitive)instanceof Cesium.Label&&Cesium.defined(i.id)?Cesium.defined(r._scene._screenSpaceCameraController)&&(a=r._scene._screenSpaceCameraController._aggregator._eventHandler.getInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),!Cesium.defined(a)||"string"!=typeof i.id&&"number"!=typeof i.id||(r._scene._screenSpaceCameraController._aggregator._eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),s=!0,u=r.ev_MTFlightDatas.get(i.id),Cesium.defined(u)&&(l=u.modelLabelPixelOffset))):i instanceof Cesium.Billboard&&Cesium.defined(i.movingTargetIcon)&&i.movingTargetIcon&&Cesium.defined(i.id)&&r.onMouseLeftDownEvent&&r.onMouseLeftDownEvent.raiseEvent(r.ev_MTFlightDatas.get(i.id)):r.onMouseLeftDownEvent&&r.onMouseLeftDownEvent.raiseEvent(void 0)},Cesium.ScreenSpaceEventType.LEFT_DOWN),r.eventHandler.setInputAction(function(e){o=e.position;var t,i=r._scene.pick(e.position);Cesium.defined(i)?i instanceof Cesium.Cesium3DTileFeature&&i.content instanceof Fc?(t=i.content._batchTable._properties.name[i._batchId],r.onMouseRightDownEvent&&r.onMouseRightDownEvent.raiseEvent(r.ev_MTFlightDatas.get(t))):i.primitive instanceof Cesium.Billboard&&Cesium.defined(i.primitive.movingTargetIcon)&&i.primitive.movingTargetIcon&&Cesium.defined(i.id)?r.onMouseRightDownEvent&&r.onMouseRightDownEvent.raiseEvent(r.ev_MTFlightDatas.get(i.id)):r.onMouseRightDownEvent&&r.onMouseRightDownEvent.raiseEvent(void 0):r.onMouseRightDownEvent&&r.onMouseRightDownEvent.raiseEvent(void 0)},Cesium.ScreenSpaceEventType.RIGHT_DOWN),r.eventHandler.setInputAction(function(e){Cesium.defined(r._scene._screenSpaceCameraController&&Cesium.defined(a))&&!Cesium.defined(r._scene._screenSpaceCameraController._aggregator._eventHandler.getInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE))&&(r._scene._screenSpaceCameraController._aggregator._eventHandler.setInputAction(a,Cesium.ScreenSpaceEventType.MOUSE_MOVE),s=!1,u=void 0)},Cesium.ScreenSpaceEventType.LEFT_UP),r.eventHandler.setInputAction(function(e){var t,i;s&&Cesium.defined(u)&&(t=e.endPosition,i=Cesium.Cartesian2.subtract(t,o,new Cesium.Cartesian2),u.modelLabelPixelOffset=Cesium.Cartesian2.add(l,i,new Cesium.Cartesian2))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}function em(e,t,i,n){var r="",a=n.ev_MTLabelConfigurationTables.get(e.mtType);if(Cesium.defined(a)&&0<a.labelFieldParas.length){for(var o=0;o<a.labelFieldParas.length;o++){var s=a.labelFieldParas[o];0==o?""==s.chineseName&&e.hasOwnProperty(s.propertyName)?r+=-1<s.decimalPrec?e[s.propertyName].toFixed(s.decimalPrec):e[s.propertyName]:e.hasOwnProperty(s.propertyName)?r=s.chineseName+(-1<s.decimalPrec?e[s.propertyName].toFixed(s.decimalPrec):e[s.propertyName]):e.specialAttributes.hasOwnProperty(s.propertyName)&&(r=s.chineseName+(-1<s.decimalPrec?e.specialAttributes[s.propertyName].toFixed(s.decimalPrec):e.specialAttributes[s.propertyName])):""==s.chineseName&&e.hasOwnProperty(s.propertyName)?r=r+"\n"+(-1<s.decimalPrec?e[s.propertyName].toFixed(s.decimalPrec):e[s.propertyName]):e.hasOwnProperty(s.propertyName)?r=r+"\n"+s.chineseName+(-1<s.decimalPrec?e[s.propertyName].toFixed(s.decimalPrec):e[s.propertyName]):e.specialAttributes.hasOwnProperty(s.propertyName)&&(r=r+"\n"+s.chineseName+(-1<s.decimalPrec?e.specialAttributes[s.propertyName].toFixed(s.decimalPrec):e.specialAttributes[s.propertyName]))}return{id:e.uId.toString(),text:r,position:e.position,fillColor:t,pixelOffset:e.modelLabelPixelOffset,font:a.font,horizontalOrigin:a.horizontalOrigin,verticalOrigin:a.verticalOrigin,style:a.style,disableDepthTestDistance:a.disableDepthTestDistance,showBackground:a.showBackground,backgroundColor:a.backgroundColor,distanceDisplayCondition:a.distanceDisplayCondition,modelLabelPullWireColor:i}}}Object.defineProperties($c.prototype,{scene:{get:function(){return this._scene}},mtVisibleCountInFrustum:{get:function(){return this._mtVisibleCountInFrustum}},ev_MTVisualizer:{get:function(){return this._ev_MTVisualizer}},ev_MTRadarSectorCollection:{get:function(){return this._ev_MTVisualizer.modelSectorRadarCollection}},retainOutdatedData:{get:function(){return this._retainOutdatedData},set:function(e){"boolean"==typeof e&&(this._retainOutdatedData=e)}}}),$c.prototype.registerMouseLeftDownListener=function(e){return Cesium.defined(this.onMouseLeftDownEvent)?this.onMouseLeftDownEvent.addEventListener(e):void 0},$c.prototype.removeMouseLeftDownListener=function(e){return Cesium.defined(this.onMouseLeftDownEvent)?this.onMouseLeftDownEvent.removeEventListener(e):void 0},$c.prototype.registerMouseRightDownListener=function(e){return Cesium.defined(this.onMouseRightDownEvent)?this.onMouseRightDownEvent.addEventListener(e):void 0},$c.prototype.removeMouseRightDownListener=function(e){return Cesium.defined(this.onMouseRightDownEvent)?this.onMouseRightDownEvent.removeEventListener(e):void 0};var tm=new Rn;$c.prototype.prePassesUpdate=function(e){this._mtVisibleCountInFrustum=0;var t=this.curFrameTime,i=this.curTimeMovingTargets;Cesium.defined(this.preUpdateRenderMovingTargetFunc)&&this.preUpdateRenderMovingTargetFunc(i);for(var n=0;n<this._ev_MTVisualizer.mtVisualDatas.length;n++){var r=this._ev_MTVisualizer.mtVisualDatas.values[n];Cesium.defined(r)&&(r.instancesPerFrame=[],r.modelLabelPerFrame=[],r.modelIconsPerFrame=[],r.modelTracePerFrame=[],r.modelBoundingboxPerFrame=[],r.modelSectorsPerFrame=[])}var a=new Cesium.Cartesian3;e.mode!=Cesium.SceneMode.SCENE3D&&(a=e.mapProjection.ellipsoid.cartographicToCartesian(this._camera.positionCartographic,a));for(var o=0;o<i.length;o++){var s,u,l,c,m,d,h,f,p,_,C,g,v,y,T,x,w,A,E,S=i[o].mtType,b=i[o].modelType,M=i[o].nRedOrBlue,R=this.graduatedColors.get(M),D=i[o].uId,P=i[o].show,I=S.toString()+"_"+b.toString(),O=i[o].position,r=this._ev_MTVisualizer.getMTVisualData(I);Cesium.defined(r)?Cesium.defined(r.modelCollection)&&r.modelCollection.ready&&(w=this.transformFunc(O,void 0,tm),(s=r.modelCollection.model.boundingSphere).center=Cesium.Matrix4.multiplyByPoint(w,s.center,new Cesium.Cartesian3),u=1,Cesium.defined(i[o].scale)&&(u=i[o].scale),u=Cesium.defined(i[o].scale)?i[o].scale:1,l=this.ev_MTZoomFactors.get(S),c=Cesium.defined(l)?l.minimumPixelSize:0,m=Cesium.defined(l)?l.maximumScale:0,u=nm(u,O,s.radius,c,m,e),P||(u=0),y=Cesium.Quaternion.fromHeadingPitchRoll(i[o].headingPitchRoll,new Cesium.Quaternion),T=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),y,new Cesium.Cartesian3(u,u,u)),w=Cesium.Matrix4.multiply(w,T,new Cesium.Matrix4),i[o].boundingBoxVisible&&r.modelBoundingboxPerFrame.push({modelMatrix:w,boxGeometry:r.modelCollection.model._boundingBox,color:new Cesium.Color(.3,.3,.3,.5)}),d={modelMatrix:w,batchId:r.instancesPerFrame.length,name:D,modelColor:Cesium.defined(R)&&Cesium.defined(R.modelColor)?R.modelColor:new Cesium.Color(1,0,0,1),visible:!1},e.cullingVolume.computeVisibility(s)==Cesium.Visibility.NONE&&e.mode==this._mode&&e.mode==Cesium.SceneMode.SCENE3D||!P?r.instancesPerFrame.push(d):(this._mtVisibleCountInFrustum++,h=Cesium.Cartesian3.distance(this._camera.positionWC,s.center),Cesium.defined(i[o].modelIconUri)?e.mode!=Cesium.SceneMode.SCENE3D?(h=Cesium.Cartesian3.distance(a,s.center))<=i[o].modelIconDisplayDistance.far&&(f=i[o].modelIconColor,Cesium.defined(R)&&Cesium.defined(R.modelIconColor)?f=R.modelIconColor:Cesium.defined(f)||(f=Cesium.Color.RED),r.modelIconsPerFrame.push({position:O,rotation:-i[o].headingPitchRoll.heading,scale:i[o].modelIconScale,color:f,name:D}),d.visible=!1):(h<=i[o].modelIconDisplayDistance.far&&h>i[o].modelIconDisplayDistance.near?(f=i[o].modelIconColor,Cesium.defined(R)&&Cesium.defined(R.modelIconColor)?f=R.modelIconColor:Cesium.defined(f)||(f=Cesium.Color.RED),r.modelIconsPerFrame.push({position:O,rotation:-i[o].headingPitchRoll.heading,scale:i[o].modelIconScale,color:f,name:D}),d.visible=!1):h<=i[o].modelIconDisplayDistance.near&&(d.visible=!0,r.instancesPerFrame.push(d)),i[o].sectorRadarVisible&&r.modelSectorsPerFrame.push({position:O,scale:new Cesium.Cartesian3(u,u,u),headingPitchRoll:new Cesium.HeadingPitchRoll(i[o].headingPitchRoll.heading,i[o].headingPitchRoll.pitch,i[o].headingPitchRoll.roll),color:i[o].sectorRadarColor})):(d.visible=!0,r.instancesPerFrame.push(d),i[o].sectorRadarVisible&&r.modelSectorsPerFrame.push({position:O,scale:new Cesium.Cartesian3(u,u,u),headingPitchRoll:new Cesium.HeadingPitchRoll(i[o].headingPitchRoll.heading,i[o].headingPitchRoll.pitch,i[o].headingPitchRoll.roll),color:i[o].sectorRadarColor})),p=i[o].trace,Cesium.defined(p)&&(p.ribbonVisible||p.wallVisible||p.barVisible||p.lineVisible)&&(Cesium.defined(R)&&Cesium.defined(R.traceRibbonColor)?(p.ribbonColor.red=R.traceRibbonColor.red,p.ribbonColor.green=R.traceRibbonColor.green,p.ribbonColor.blue=R.traceRibbonColor.blue):Cesium.defined(p.ribbonColor)||(p.ribbonColor=Cesium.Color.RED),Cesium.defined(R)&&Cesium.defined(R.traceWallColor)?(p.wallColor.red=R.traceWallColor.red,p.wallColor.green=R.traceWallColor.green,p.wallColor.blue=R.traceWallColor.blue):Cesium.defined(p.wallColor)||(p.wallColor=Cesium.Color.RED),Cesium.defined(R)&&Cesium.defined(R.traceBarColor)?(p.barColor.red=R.traceBarColor.red,p.barColor.green=R.traceBarColor.green,p.barColor.blue=R.traceBarColor.blue):Cesium.defined(p.barColor)||(p.barColor=Cesium.Color.RED),Cesium.defined(R)&&Cesium.defined(R.traceLineColor)?(p.lineColor.red=R.traceLineColor.red,p.lineColor.green=R.traceLineColor.green,p.lineColor.blue=R.traceLineColor.blue):Cesium.defined(p.lineColor)||(p.lineColor=Cesium.Color.RED),p.add(O,i[o].headingPitchRoll,t,u),r.modelTracePerFrame.push(p)),i[o].modelLabelVisible&&(_=i[o].modelLabelTextColor,Cesium.defined(R)&&Cesium.defined(R.modelLabelTextColor)?_=R.modelLabelTextColor:Cesium.defined(_)||(_=Cesium.Color.RED),C=i[o].modelLabelPullWireColor,Cesium.defined(R)&&Cesium.defined(R.modelLabelPullWireColor)?C=R.modelLabelPullWireColor:Cesium.defined(C)||(C=Cesium.Color.RED),g=em(i[o],_,C,this),Cesium.defined(g)&&r.modelLabelPerFrame.push(g))),v=this.ev_MTFlightDatas.get(D),Cesium.defined(v)&&(v.curTimeAttitude.scale=u,v.curTimeAttitude.visible=d.visible)):(y=Cesium.Quaternion.fromHeadingPitchRoll(i[o].headingPitchRoll,new Cesium.Quaternion),T=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),y,new Cesium.Cartesian3(1,1,1)),x=this.transformFunc(O,void 0,tm),w=Cesium.Matrix4.multiply(x,T,new Cesium.Matrix4),(A=[]).push({modelMatrix:w,batchId:0,name:D,modelColor:Cesium.defined(R)?R.modelColor:Cesium.Color.RED}),(E=[]).push({position:O,scale:.1}),this._ev_MTVisualizer.add({keyName:I,modelType:b,modelUri:i[o].modelUri,modelIconUri:i[o].modelIconUri,instances:A,iconInstances:E}))}this._ev_MTVisualizer.prePassesUpdate(e),this._mode=e.mode},$c.prototype.update=function(e){this._ev_MTVisualizer.update(e)},$c.prototype.postPassesUpdate=function(e){this._ev_MTVisualizer.postPassesUpdate(e)},$c.prototype.removeAllMovingTargets=function(){this.ev_MTFlightDatas.removeAll()},$c.prototype.removeMovingTargetById=function(e){this.ev_MTFlightDatas.contains(e)&&this.ev_MTFlightDatas.remove(e)},$c.prototype.getMovingTargetById=function(e){return this.ev_MTFlightDatas.get(e)},$c.prototype.addMovingTargetTimeAttitude=function(e,t){var i=this.ev_MTFlightDatas.get(e);Cesium.defined(i)||(i=new jt(t),this.ev_MTFlightDatas.set(e,i)),i.timeAttitudeCollection=i.timeAttitudeCollection.concat(t.timeAttitudeCollection)},$c.prototype.setTraceVisible=function(e,t,i){var n=Cesium.defaultValue(i,!1);for(var r in this.ev_MTFlightDatas._hash){var a=this.ev_MTFlightDatas.get(r);(-1==t||a.mtType==t)&&(e==Qc.Ribbon?a.trace.ribbonVisible=n:e==Qc.Wall?a.trace.wallVisible=n:e==Qc.Bar?a.trace.barVisible=n:e==Qc.Line&&(a.trace.lineVisible=n))}},$c.prototype.setTraceAlpha=function(e,t,i){for(var n in i=Cesium.defaultValue(i,1),this.ev_MTFlightDatas._hash){var r=this.ev_MTFlightDatas.get(n);(-1==t||r.mtType==t)&&(e==Qc.Ribbon?r.trace.ribbonColor=r.trace.ribbonColor.withAlpha(i):e==Qc.Wall?r.trace.wallColor=r.trace.wallColor.withAlpha(i):e==Qc.Bar?r.trace.barColor=r.trace.barColor.withAlpha(i):e==Qc.Line&&(r.trace.lineColor=r.trace.lineColor.withAlpha(i)))}},$c.prototype.setTraceTimeDuration=function(e,t){var i=Cesium.defaultValue(t,1e3);for(var n in this.ev_MTFlightDatas._hash){var r=this.ev_MTFlightDatas.get(n);r.mtType==e&&(r.trace.traceTimeDuration=i)}},$c.prototype.setTraceBarTimeInterval=function(e){e=Cesium.defaultValue(e,1);for(var t in this.ev_MTFlightDatas._hash){this.ev_MTFlightDatas.get(t).trace.barTimeInterval=e}};var im=new dr;function nm(e,t,i,n,r,a){var o,s,u,l,c,m,d,h;return 0!==n&&(o=a.context,s=Math.max(o.drawingBufferWidth,o.drawingBufferHeight),u=Cesium.Cartesian3.clone(t),a.mode!==Cesium.SceneMode.SCENE3D&&(c=(l=a.mapProjection).ellipsoid.cartesianToCartographic(u,im),l.project(c,u),Cesium.Cartesian3.fromElements(u.z,u.x,u.y,u)),m=i*e,h=1/(d=a.camera.getPixelSize(new Cesium.BoundingSphere(u,m),a.context.drawingBufferWidth,a.context.drawingBufferHeight)),Math.min(2*m*h,s)<n&&(e=n*d/(2*i))),Cesium.defined(r)&&0!==r?Math.min(r,e):e}function rm(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.labelFieldParas=[],this.showBackground=Cesium.defaultValue(e.showBackground,!0),this.backgroundColor=Cesium.defaultValue(e.backgroundColor,new Cesium.Color(1,1,1,.2)),this.font=Cesium.defaultValue(e.font,"12px Helvetica"),this.style=Cesium.defaultValue(e.style,Cesium.LabelStyle.FILL),this.disableDepthTestDistance=Cesium.defaultValue(e.disableDepthTestDistance,Number.POSITIVE_INFINITY),this.distanceDisplayCondition=Cesium.defaultValue(e.distanceDisplayCondition,new Cesium.DistanceDisplayCondition),this.horizontalOrigin=Cesium.defaultValue(e.horizontalOrigin,Cesium.HorizontalOrigin.LEFT),this.verticalOrigin=Cesium.defaultValue(e.verticalOrigin,Cesium.VerticalOrigin.TOP)}function am(e,t,i){this.clock=z(e,0),this.cone=z(t,0),this.magnitude=z(i,1)}function om(){function v(e,t,i,n){i=i||" ";var r=e.length>=t?"":Array(1+t-e.length>>>0).join(i);return n?e+r:r+e}function y(e,t,i,n,r,a){var o=n-e.length;return 0<o&&(e=i||!r?v(e,n,a,i):e.slice(0,t.length)+v("",o,"0",!0)+e.slice(t.length)),e}function T(e,t,i,n,r,a,o){var s=e>>>0;return e=(i=i&&s&&{2:"0b",8:"0",16:"0x"}[t]||"")+v(s.toString(t),a||0,"0",!1),y(e,i,n,r,o)}function x(e,t,i,n,r,a){return null!=n&&(e=e.slice(0,n)),y(e,"",t,i,r,a)}var w=arguments,A=0,e=w[A++];return e.replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,function(e,t,i,n,r,a,o){var s,u,l,c,m;if("%%"==e)return"%";for(var d=!1,h="",f=!1,p=!1,_=" ",C=i.length,g=0;i&&g<C;g++)switch(i.charAt(g)){case" ":h=" ";break;case"+":h="+";break;case"-":d=!0;break;case"'":_=i.charAt(g+1);break;case"0":f=!0;break;case"#":p=!0}if((n=n?"*"==n?+w[A++]:"*"==n.charAt(0)?+w[n.slice(1,-1)]:+n:0)<0&&(n=-n,d=!0),!isFinite(n))throw new Error("sprintf: (minimum-)width must be finite");switch(a=a?"*"==a?+w[A++]:"*"==a.charAt(0)?+w[a.slice(1,-1)]:+a:-1<"fFeE".indexOf(o)?6:"d"==o?0:void 0,m=t?w[t.slice(0,-1)]:w[A++],o){case"s":return x(String(m),d,n,a,f,_);case"c":return x(String.fromCharCode(+m),d,n,a,f);case"b":return T(m,2,p,d,n,a,f);case"o":return T(m,8,p,d,n,a,f);case"x":return T(m,16,p,d,n,a,f);case"X":return T(m,16,p,d,n,a,f).toUpperCase();case"u":return T(m,10,p,d,n,a,f);case"i":case"d":return s=+m||0,m=(u=(s=Math.round(s-s%1))<0?"-":h)+v(String(Math.abs(s)),a,"0",!1),y(m,u,d,n,f);case"e":case"E":case"f":case"F":case"g":case"G":return u=(s=+m)<0?"-":h,l=["toExponential","toFixed","toPrecision"]["efg".indexOf(o.toLowerCase())],c=["toString","toUpperCase"]["eEfFgG".indexOf(o)%2],m=u+Math.abs(s)[l](a),y(m,u,d,n,f)[c]();default:return e}})}function sm(e,t,i){for(var n,r,a=0,o=e.length-1;a<=o;)if((r=i(e[n=~~((a+o)/2)],t))<0)a=1+n;else{if(!(0<r))return n;o=n-1}return~(o+1)}function um(e,t,i,n,r,a,o,s){this.year=e,this.month=t,this.day=i,this.hour=n,this.minute=r,this.second=a,this.millisecond=o,this.isLeapSecond=s}function lm(e){return e%4==0&&e%100!=0||e%400==0}function cm(e,t){this.julianDate=e,this.offset=t}$c.prototype.isDestroyed=function(){return!1},$c.prototype.destroy=function(){this.onMouseLeftDownEvent=void 0,this.onMouseRightDownEvent=void 0,Cesium.defined(this.ev_dataMgr)&&Cesium.defined(this.ev_dataMgr.removeReceiveDataListener)&&this.ev_dataMgr.removeReceiveDataListener(this.receiveDataListenerFunc),this.ev_MTFlightDatas.removeAll(),this.eventHandler=this.eventHandler&&this.eventHandler.destroy();var e=this._scene.primitives.destroyPrimitives;return this._scene.primitives.destroyPrimitives=!1,this._scene.primitives.remove(this),this._scene.primitives.destroyPrimitives=e,this._ev_MTVisualizer.destroy(),Cesium.destroyObject(this)},rm.prototype.addDisplayFieldPara=function(e,t,i){i=Cesium.defaultValue(i,-1),this.labelFieldParas.push({chineseName:e,propertyName:t,decimalPrec:i})},rm.prototype.removeAllDisplayFieldParas=function(){this.labelFieldParas=[]},am.fromCartesian3=function(e,t){var i=e.x,n=e.y,r=e.z,a=i*i+n*n;return oe(t)||(t=new am),t.clock=Math.atan2(n,i),t.cone=Math.atan2(Math.sqrt(a),r),t.magnitude=Math.sqrt(a+r*r),t},am.clone=function(e,t){if(oe(e))return oe(t)?(t.clock=e.clock,t.cone=e.cone,t.magnitude=e.magnitude,t):new am(e.clock,e.cone,e.magnitude)},am.normalize=function(e,t){return oe(t)?(t.clock=e.clock,t.cone=e.cone,t.magnitude=1,t):new am(e.clock,e.cone,1)},am.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.clock===t.clock&&e.cone===t.cone&&e.magnitude===t.magnitude},am.equalsEpsilon=function(e,t,i){return i=z(i,0),e===t||oe(e)&&oe(t)&&Math.abs(e.clock-t.clock)<=i&&Math.abs(e.cone-t.cone)<=i&&Math.abs(e.magnitude-t.magnitude)<=i},am.prototype.equals=function(e){return am.equals(this,e)},am.prototype.clone=function(e){return am.clone(this,e)},am.prototype.equalsEpsilon=function(e,t){return am.equalsEpsilon(this,e,t)},am.prototype.toString=function(){return"("+this.clock+", "+this.cone+", "+this.magnitude+")"};var mm=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5}),dm=Object.freeze({UTC:0,TAI:1}),hm=new um,fm=[31,28,31,30,31,30,31,31,30,31,30,31];function pm(e,t){return Dm.compare(e.julianDate,t.julianDate)}var _m=new cm;function Cm(e){_m.julianDate=e;var t=Dm.leapSeconds,i=sm(t,_m,pm);i<0&&(i=~i),i>=t.length&&(i=t.length-1);var n=t[i].offset;0<i&&n<Dm.secondsDifference(t[i].julianDate,e)&&(n=t[--i].offset),Dm.addSeconds(e,n,e)}function gm(e,t){_m.julianDate=e;var i=Dm.leapSeconds,n=sm(i,_m,pm);if(n<0&&(n=~n),0===n)return Dm.addSeconds(e,-i[0].offset,t);if(n>=i.length)return Dm.addSeconds(e,-i[n-1].offset,t);var r=Dm.secondsDifference(i[n].julianDate,e);return 0===r?Dm.addSeconds(e,-i[n].offset,t):r<=1?void 0:Dm.addSeconds(e,-i[--n].offset,t)}function vm(e,t,i){var n=t/mm.SECONDS_PER_DAY|0;return e+=n,(t-=mm.SECONDS_PER_DAY*n)<0&&(e--,t+=mm.SECONDS_PER_DAY),i instanceof Dm||(i=new Dm),i.dayNumber=e,i.secondsOfDay=t,i}function ym(e,t,i,n,r,a,o){var s=(t-14)/12|0,u=e+4800+s,l=(1461*u/4|0)+(367*(t-2-12*s)/12|0)-(3*((u+100)/100|0)/4|0)+i-32075;(n-=12)<0&&(n+=24);var c=a+(n*mm.SECONDS_PER_HOUR+r*mm.SECONDS_PER_MINUTE+o*mm.SECONDS_PER_MILLISECOND);return 43200<=c&&--l,[l,c]}var Tm=/^(\d{4})$/,xm=/^(\d{4})-(\d{2})$/,wm=/^(\d{4})-?(\d{3})$/,Am=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,Em=/^(\d{4})-?(\d{2})-?(\d{2})$/,Sm=/([Z+\-])?(\d{2})?:?(\d{2})?$/,bm=/^(\d{2})(\.\d+)?/.source+Sm.source,Mm=/^(\d{2}):?(\d{2})(\.\d+)?/.source+Sm.source,Rm=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+Sm.source;function Dm(e,t,i){this.dayNumber=void 0,this.secondsOfDay=void 0,e=z(e,0),t=z(t,0),i=z(i,dm.UTC);var n=0|e;vm(n,t+=(e-n)*mm.SECONDS_PER_DAY,this),i===dm.UTC&&Cm(this)}Dm.fromGregorianDate=function(e,t){var i=ym(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return oe(t)?(vm(i[0],i[1],t),Cm(t),t):new Dm(i[0],i[1],dm.UTC)},Dm.fromDate=function(e,t){var i=ym(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return oe(t)?(vm(i[0],i[1],t),Cm(t),t):new Dm(i[0],i[1],dm.UTC)},Dm.fromIso8601=function(e,t){var i,n,r,a,o,s=(e=e.replace(",",".")).split("T"),u=1,l=1,c=0,m=0,d=0,h=0,f=s[0],p=s[1];if(null!==(s=f.match(Em))?(i=+s[1],u=+s[2],l=+s[3]):null!==(s=f.match(xm))?(i=+s[1],u=+s[2]):null!==(s=f.match(Tm))?i=+s[1]:(null!==(s=f.match(wm))?(i=+s[1],a=+s[2],r=lm(i)):null!==(s=f.match(Am))&&(i=+s[1],a=7*+s[2]+(+s[3]||0)-new Date(Date.UTC(i,0,4)).getUTCDay()-3),(n=new Date(Date.UTC(i,0,1))).setUTCDate(a),u=n.getUTCMonth()+1,l=n.getUTCDate()),r=lm(i),oe(p)){null!==(s=p.match(Rm))?(c=+s[1],m=+s[2],d=+s[3],h=1e3*(s[4]||0),o=5):null!==(s=p.match(Mm))?(c=+s[1],m=+s[2],d=60*(s[3]||0),o=4):null!==(s=p.match(bm))&&(c=+s[1],m=60*(s[2]||0),o=3);var _=s[o],C=+s[o+1],g=+(s[o+2]||0);switch(_){case"+":c-=C,m-=g;break;case"-":c+=C,m+=g;break;case"Z":break;default:m+=new Date(Date.UTC(i,u-1,l,c,m)).getTimezoneOffset()}}var v=60===d;for(v&&d--;60<=m;)m-=60,c++;for(;24<=c;)c-=24,l++;for(n=r&&2===u?29:fm[u-1];n<l;)l-=n,12<++u&&(u-=12,i++),n=r&&2===u?29:fm[u-1];for(;m<0;)m+=60,c--;for(;c<0;)c+=24,l--;for(;l<1;)--u<1&&(u+=12,i--),l+=n=r&&2===u?29:fm[u-1];var y=ym(i,u,l,c,m,d,h);return oe(t)?(vm(y[0],y[1],t),Cm(t)):t=new Dm(y[0],y[1],dm.UTC),v&&Dm.addSeconds(t,1,t),t},Dm.now=function(e){return Dm.fromDate(new Date,e)};var Pm=new Dm(0,0,dm.TAI);function Im(e){e=z(e,z.EMPTY_OBJECT),this.start=oe(e.start)?Dm.clone(e.start):new Dm,this.stop=oe(e.stop)?Dm.clone(e.stop):new Dm,this.data=e.data,this.isStartIncluded=z(e.isStartIncluded,!0),this.isStopIncluded=z(e.isStopIncluded,!0)}Dm.toGregorianDate=function(e,t){var i=!1,n=gm(e,Pm);oe(n)||(Dm.addSeconds(e,-1,Pm),n=gm(Pm,Pm),i=!0);var r=n.dayNumber,a=n.secondsOfDay;43200<=a&&(r+=1);var o=r+68569|0,s=4*o/146097|0,u=4e3*((o=o-((146097*s+3)/4|0)|0)+1)/1461001|0,l=80*(o=o-(1461*u/4|0)+31|0)/2447|0,c=o-(2447*l/80|0)|0,m=2+l-12*(o=l/11|0)|0,d=100*(s-49)+u+o|0,h=a/mm.SECONDS_PER_HOUR|0,f=a-h*mm.SECONDS_PER_HOUR,p=f/mm.SECONDS_PER_MINUTE|0,_=0|(f-=p*mm.SECONDS_PER_MINUTE),C=(f-_)/mm.SECONDS_PER_MILLISECOND;return 23<(h+=12)&&(h-=24),i&&(_+=1),oe(t)?(t.year=d,t.month=m,t.day=c,t.hour=h,t.minute=p,t.second=_,t.millisecond=C,t.isLeapSecond=i,t):new um(d,m,c,h,p,_,C,i)},Dm.toDate=function(e){var t=Dm.toGregorianDate(e,hm),i=t.second;return t.isLeapSecond&&--i,new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,i,t.millisecond))},Dm.toIso8601=function(e,t){var i=Dm.toGregorianDate(e,hm),n=i.year,r=i.month,a=i.day,o=i.hour,s=i.minute,u=i.second,l=i.millisecond;return 1e4===n&&1===r&&1===a&&0===o&&0===s&&0===u&&0===l&&(n=9999,r=12,a=31,o=24),oe(t)||0===l?oe(t)&&0!==t?om("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",n,r,a,o,s,u,(.01*l).toFixed(t).replace(".","").slice(0,t)):om("%04d-%02d-%02dT%02d:%02d:%02dZ",n,r,a,o,s,u):om("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",n,r,a,o,s,u,(.01*l).toString().replace(".",""))},Dm.clone=function(e,t){if(oe(e))return oe(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new Dm(e.dayNumber,e.secondsOfDay,dm.TAI)},Dm.compare=function(e,t){var i=e.dayNumber-t.dayNumber;return 0!=i?i:e.secondsOfDay-t.secondsOfDay},Dm.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay},Dm.equalsEpsilon=function(e,t,i){return e===t||oe(e)&&oe(t)&&Math.abs(Dm.secondsDifference(e,t))<=i},Dm.totalDays=function(e){return e.dayNumber+e.secondsOfDay/mm.SECONDS_PER_DAY},Dm.secondsDifference=function(e,t){return(e.dayNumber-t.dayNumber)*mm.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)},Dm.daysDifference=function(e,t){return e.dayNumber-t.dayNumber+(e.secondsOfDay-t.secondsOfDay)/mm.SECONDS_PER_DAY},Dm.computeTaiMinusUtc=function(e){_m.julianDate=e;var t=Dm.leapSeconds,i=sm(t,_m,pm);return i<0&&(i=~i,--i<0&&(i=0)),t[i].offset},Dm.addSeconds=function(e,t,i){return vm(e.dayNumber,e.secondsOfDay+t,i)},Dm.addMinutes=function(e,t,i){var n=e.secondsOfDay+t*mm.SECONDS_PER_MINUTE;return vm(e.dayNumber,n,i)},Dm.addHours=function(e,t,i){var n=e.secondsOfDay+t*mm.SECONDS_PER_HOUR;return vm(e.dayNumber,n,i)},Dm.addDays=function(e,t,i){return vm(e.dayNumber+t,e.secondsOfDay,i)},Dm.lessThan=function(e,t){return Dm.compare(e,t)<0},Dm.lessThanOrEquals=function(e,t){return Dm.compare(e,t)<=0},Dm.greaterThan=function(e,t){return 0<Dm.compare(e,t)},Dm.greaterThanOrEquals=function(e,t){return 0<=Dm.compare(e,t)},Dm.prototype.clone=function(e){return Dm.clone(this,e)},Dm.prototype.equals=function(e){return Dm.equals(this,e)},Dm.prototype.equalsEpsilon=function(e,t){return Dm.equalsEpsilon(this,e,t)},Dm.prototype.toString=function(){return Dm.toIso8601(this)},Dm.leapSeconds=[new cm(new Dm(2441317,43210,dm.TAI),10),new cm(new Dm(2441499,43211,dm.TAI),11),new cm(new Dm(2441683,43212,dm.TAI),12),new cm(new Dm(2442048,43213,dm.TAI),13),new cm(new Dm(2442413,43214,dm.TAI),14),new cm(new Dm(2442778,43215,dm.TAI),15),new cm(new Dm(2443144,43216,dm.TAI),16),new cm(new Dm(2443509,43217,dm.TAI),17),new cm(new Dm(2443874,43218,dm.TAI),18),new cm(new Dm(2444239,43219,dm.TAI),19),new cm(new Dm(2444786,43220,dm.TAI),20),new cm(new Dm(2445151,43221,dm.TAI),21),new cm(new Dm(2445516,43222,dm.TAI),22),new cm(new Dm(2446247,43223,dm.TAI),23),new cm(new Dm(2447161,43224,dm.TAI),24),new cm(new Dm(2447892,43225,dm.TAI),25),new cm(new Dm(2448257,43226,dm.TAI),26),new cm(new Dm(2448804,43227,dm.TAI),27),new cm(new Dm(2449169,43228,dm.TAI),28),new cm(new Dm(2449534,43229,dm.TAI),29),new cm(new Dm(2450083,43230,dm.TAI),30),new cm(new Dm(2450630,43231,dm.TAI),31),new cm(new Dm(2451179,43232,dm.TAI),32),new cm(new Dm(2453736,43233,dm.TAI),33),new cm(new Dm(2454832,43234,dm.TAI),34),new cm(new Dm(2456109,43235,dm.TAI),35),new cm(new Dm(2457204,43236,dm.TAI),36),new cm(new Dm(2457754,43237,dm.TAI),37)],Object.defineProperties(Im.prototype,{isEmpty:{get:function(){var e=Dm.compare(this.stop,this.start);return e<0||0===e&&(!this.isStartIncluded||!this.isStopIncluded)}}});var Om={start:void 0,stop:void 0,isStartIncluded:void 0,isStopIncluded:void 0,data:void 0};Im.fromIso8601=function(e,t){var i=e.iso8601.split("/");if(2!==i.length)throw new x("options.iso8601 is an invalid ISO 8601 interval.");var n=Dm.fromIso8601(i[0]),r=Dm.fromIso8601(i[1]),a=z(e.isStartIncluded,!0),o=z(e.isStopIncluded,!0),s=e.data;return oe(t)?(t.start=n,t.stop=r,t.isStartIncluded=a,t.isStopIncluded=o,t.data=s,t):(Om.start=n,Om.stop=r,Om.isStartIncluded=a,Om.isStopIncluded=o,Om.data=s,new Im(Om))},Im.toIso8601=function(e,t){return Dm.toIso8601(e.start,t)+"/"+Dm.toIso8601(e.stop,t)},Im.clone=function(e,t){if(oe(e))return oe(t)?(t.start=e.start,t.stop=e.stop,t.isStartIncluded=e.isStartIncluded,t.isStopIncluded=e.isStopIncluded,t.data=e.data,t):new Im(e)},Im.equals=function(e,t,i){return e===t||oe(e)&&oe(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&Dm.equals(e.start,t.start)&&Dm.equals(e.stop,t.stop)&&(e.data===t.data||oe(i)&&i(e.data,t.data)))},Im.equalsEpsilon=function(e,t,i,n){return e===t||oe(e)&&oe(t)&&(e.isEmpty&&t.isEmpty||e.isStartIncluded===t.isStartIncluded&&e.isStopIncluded===t.isStopIncluded&&Dm.equalsEpsilon(e.start,t.start,i)&&Dm.equalsEpsilon(e.stop,t.stop,i)&&(e.data===t.data||oe(n)&&n(e.data,t.data)))},Im.intersect=function(e,t,i,n){if(!oe(t))return Im.clone(Im.EMPTY,i);var r=e.start,a=e.stop,o=t.start,s=t.stop,u=Dm.greaterThanOrEquals(o,r)&&Dm.greaterThanOrEquals(a,o),l=!u&&Dm.lessThanOrEquals(o,r)&&Dm.lessThanOrEquals(r,s);if(!u&&!l)return Im.clone(Im.EMPTY,i);var c=e.isStartIncluded,m=e.isStopIncluded,d=t.isStartIncluded,h=t.isStopIncluded,f=Dm.lessThan(a,s);return i.start=u?o:r,i.isStartIncluded=c&&d||!Dm.equals(o,r)&&(u&&d||l&&c),i.stop=f?a:s,i.isStopIncluded=f?m:m&&h||!Dm.equals(s,a)&&h,i.data=oe(n)?n(e.data,t.data):e.data,i},Im.contains=function(e,t){if(e.isEmpty)return!1;var i=Dm.compare(e.start,t);if(0===i)return e.isStartIncluded;var n=Dm.compare(t,e.stop);return 0===n?e.isStopIncluded:i<0&&n<0},Im.prototype.clone=function(e){return Im.clone(this,e)},Im.prototype.equals=function(e,t){return Im.equals(this,e,t)},Im.prototype.equalsEpsilon=function(e,t,i){return Im.equalsEpsilon(this,e,t,i)},Im.prototype.toString=function(){return Im.toIso8601(this)},Im.EMPTY=Object.freeze(new Im({start:new Dm,stop:new Dm,isStartIncluded:!1,isStopIncluded:!1}));var Lm=ri.factorial;function Nm(e,t,i,n,r,a){var o,s,u,l=0;if(0<n){for(s=0;s<r;s++){for(o=!1,u=0;u<a.length&&!o;u++)s===a[u]&&(o=!0);o||(a.push(s),l+=Nm(e,t,i,n-1,r,a),a.splice(a.length-1,1))}return l}for(l=1,s=0;s<r;s++){for(o=!1,u=0;u<a.length&&!o;u++)s===a[u]&&(o=!0);o||(l*=e-i[t[s]])}return l}var Bm={type:"Hermite",getRequiredDataPoints:function(e,t){return t=z(t,0),Math.max(Math.floor((e+1)/(t+1)),2)},interpolateOrderZero:function(e,t,i,n,r){var a,o;oe(r)||(r=new Array(n));for(var s=t.length,u=new Array(n),l=0;l<n;l++){r[l]=0;var c=new Array(s);for(u[l]=c,p=0;p<s;p++)c[p]=[]}var m=s,d=new Array(m);for(l=0;l<m;l++)d[l]=l;var h=s-1;for(y=0;y<n;y++){for(p=0;p<m;p++)o=d[p]*n+y,u[y][0].push(i[o]);for(l=1;l<m;l++){for(var f=!1,p=0;p<m-l;p++){var _,C=t[d[p]],g=t[d[p+l]];g-C<=0?(_=i[o=d[p]*n+n*l+y],u[y][l].push(_/Lm(l))):(_=u[y][l-1][p+1]-u[y][l-1][p],u[y][l].push(_/(g-C))),f=f||0!==_}f||(h=l-1)}}for(a=0;a<=0;a++)for(l=a;l<=h;l++)for(var v=Nm(e,d,t,a,l,[]),y=0;y<n;y++){var T=u[y][l][0];r[y+a*n]+=T*v}return r}},zm=[];Bm.interpolate=function(e,t,i,n,r,a,o){var s=n*(a+1);oe(o)||(o=new Array(s));for(var u=0;u<s;u++)o[u]=0;for(var l=t.length,c=new Array(l*(r+1)),m=0;m<l;m++)for(var d=0;d<r+1;d++)c[m*(r+1)+d]=m;for(var h=c.length,f=zm,p=function(e,t,i,n,r,a){for(var o,s,u,l,c=-1,m=t.length,d=m*(m+1)/2,h=0;h<r;h++){var f=Math.floor(h*d);for(o=0;o<m;o++)s=t[o]*r*(a+1)+h,e[f+o]=n[s];for(var p=1;p<m;p++){var _=0,C=Math.floor(p*(1-p)/2)+m*p,g=!1;for(o=0;o<m-p;o++){var v,y=i[t[o]],T=i[t[o+p]];l=T-y<=0?(s=t[o]*r*(a+1)+r*p+h,(u=n[s])/ri.factorial(p)):(v=Math.floor((p-1)*(2-p)/2)+m*(p-1),(u=e[f+v+o+1]-e[f+v+o])/(T-y)),e[f+C+_]=l,_++,g=g||0!==u}g&&(c=Math.max(c,p))}}return c}(f,c,t,i,n,r),_=[],C=h*(h+1)/2,g=Math.min(p,a),v=0;v<=g;v++)for(m=v;m<=p;m++){_.length=0;for(var y=Nm(e,c,t,v,m,_),T=Math.floor(m*(1-m)/2)+h*m,x=0;x<n;x++){var w=f[Math.floor(x*C)+T];o[x+v*n]+=w*y}}return o};var Fm,Vm={type:"Lagrange",getRequiredDataPoints:function(e){return Math.max(e+1,2)},interpolateOrderZero:function(e,t,i,n,r){oe(r)||(r=new Array(n));for(var a=t.length,o=0;o<n;o++)r[o]=0;for(o=0;o<a;o++){for(var s,u=1,l=0;l<a;l++){l!==o&&(s=t[o]-t[l],u*=(e-t[l])/s)}for(l=0;l<n;l++)r[l]+=u*i[o*n+l]}return r}},Um={type:"Linear"};function Gm(){}function km(e,t){return"#"===t[0]&&(t=Fm+t),Cesium.ReferenceProperty.fromString(e,t)}function Hm(e,t,i){if(Cesium.defined(i.reference))return km(t,i.reference);if(Cesium.defined(i.velocityReference)){var n=km(t,i.velocityReference);switch(e){case Cesium.Cartesian3:case Gm:return new Cesium.VelocityVectorProperty(n,e===Gm);case Cesium.Quaternion:return new Cesium.VelocityOrientationProperty(n)}}throw new Cesium.RuntimeError(JSON.stringify(i)+" is not valid CZML.")}Um.getRequiredDataPoints=function(e){return 2},Um.interpolateOrderZero=function(e,t,i,n,r){var a,o;oe(r)||(r=new Array(n));for(var s=t[0],u=t[1],l=0;l<n;l++)a=i[l],o=i[l+n],r[l]=((o-a)*e+u*a-s*o)/(u-s);return r},Gm.packedLength=si.packedLength,Gm.unpack=si.unpack,Gm.pack=si.pack;var Wm=new si,qm=new am,jm=new dr,Ym=new Im,Xm=new xa;function Km(e,t){var i=Cesium.defaultValue(e.uri,e);return Cesium.defined(t)?t.getDerivedResource({url:i}):Cesium.Resource.createIfNeeded(i)}function Zm(e){var t=e.cartesian;if(Cesium.defined(t))return t;var i=e.cartesianVelocity;if(Cesium.defined(i))return i;var n=e.unitCartesian;if(Cesium.defined(n))return n;var r=e.unitSpherical;if(Cesium.defined(r))return function(e){var t=e.length;if(qm.magnitude=1,2===t)return qm.clock=e[0],qm.cone=e[1],Cesium.Cartesian3.fromSpherical(qm,Wm),[Wm.x,Wm.y,Wm.z];for(var i=new Array(t/3*4),n=0,r=0;n<t;n+=3,r+=4)i[r]=e[n],qm.clock=e[n+1],qm.cone=e[n+2],Cesium.Cartesian3.fromSpherical(qm,Wm),i[r+1]=Wm.x,i[r+2]=Wm.y,i[r+3]=Wm.z;return i}(r);var a=e.spherical;if(Cesium.defined(a))return function(e){var t=e.length;if(3===t)return qm.clock=e[0],qm.cone=e[1],qm.magnitude=e[2],Cesium.Cartesian3.fromSpherical(qm,Wm),[Wm.x,Wm.y,Wm.z];for(var i=new Array(t),n=0;n<t;n+=4)i[n]=e[n],qm.clock=e[n+1],qm.cone=e[n+2],qm.magnitude=e[n+3],Cesium.Cartesian3.fromSpherical(qm,Wm),i[n+1]=Wm.x,i[n+2]=Wm.y,i[n+3]=Wm.z;return i}(a);var o=e.cartographicRadians;if(Cesium.defined(o))return function(e){var t=e.length;if(3===t)return jm.longitude=e[0],jm.latitude=e[1],jm.height=e[2],Cesium.Ellipsoid.WGS84.cartographicToCartesian(jm,Wm),[Wm.x,Wm.y,Wm.z];for(var i=new Array(t),n=0;n<t;n+=4)i[n]=e[n],jm.longitude=e[n+1],jm.latitude=e[n+2],jm.height=e[n+3],Cesium.Ellipsoid.WGS84.cartographicToCartesian(jm,Wm),i[n+1]=Wm.x,i[n+2]=Wm.y,i[n+3]=Wm.z;return i}(o);var s=e.cartographicDegrees;if(Cesium.defined(s))return function(e){var t=e.length;if(3===t)return jm.longitude=Cesium.Math.toRadians(e[0]),jm.latitude=Cesium.Math.toRadians(e[1]),jm.height=e[2],Cesium.Ellipsoid.WGS84.cartographicToCartesian(jm,Wm),[Wm.x,Wm.y,Wm.z];for(var i=new Array(t),n=0;n<t;n+=4)i[n]=e[n],jm.longitude=Cesium.Math.toRadians(e[n+1]),jm.latitude=Cesium.Math.toRadians(e[n+2]),jm.height=e[n+3],Cesium.Ellipsoid.WGS84.cartographicToCartesian(jm,Wm),i[n+1]=Wm.x,i[n+2]=Wm.y,i[n+3]=Wm.z;return i}(s);throw new Cesium.RuntimeError(JSON.stringify(e)+" is not a valid CZML interval.")}function Jm(e,t){Cesium.Cartesian3.unpack(e,t,Wm),Cesium.Cartesian3.normalize(Wm,Wm),Cesium.Cartesian3.pack(Wm,e,t)}function Qm(e,t){Cesium.Quaternion.unpack(e,t,Xm),Cesium.Quaternion.normalize(Xm,Xm),Cesium.Quaternion.pack(Xm,e,t)}function $m(e){return"boolean"==typeof e?Boolean:"number"==typeof e?Number:"string"==typeof e?String:e.hasOwnProperty("array")?Array:e.hasOwnProperty("boolean")?Boolean:e.hasOwnProperty("boundingRectangle")?Cesium.BoundingRectangle:e.hasOwnProperty("cartesian2")?Cesium.Cartesian2:e.hasOwnProperty("cartesian")||e.hasOwnProperty("spherical")||e.hasOwnProperty("cartographicRadians")||e.hasOwnProperty("cartographicDegrees")?Cesium.Cartesian3:e.hasOwnProperty("unitCartesian")||e.hasOwnProperty("unitSpherical")?Gm:e.hasOwnProperty("rgba")||e.hasOwnProperty("rgbaf")?Cesium.Color:e.hasOwnProperty("arcType")?Cesium.ArcType:e.hasOwnProperty("classificationType")?Cesium.ClassificationType:e.hasOwnProperty("colorBlendMode")?Cesium.ColorBlendMode:e.hasOwnProperty("cornerType")?Cesium.CornerType:e.hasOwnProperty("heightReference")?Cesium.HeightReference:e.hasOwnProperty("horizontalOrigin")?Cesium.HorizontalOrigin:e.hasOwnProperty("date")?Cesium.JulianDate:e.hasOwnProperty("labelStyle")?Cesium.LabelStyle:e.hasOwnProperty("number")?Number:e.hasOwnProperty("nearFarScalar")?Cesium.NearFarScalar:e.hasOwnProperty("distanceDisplayCondition")?Cesium.DistanceDisplayCondition:e.hasOwnProperty("object")||e.hasOwnProperty("value")?Object:e.hasOwnProperty("unitQuaternion")?Cesium.Quaternion:e.hasOwnProperty("shadowMode")?Cesium.ShadowMode:e.hasOwnProperty("string")?String:e.hasOwnProperty("stripeOrientation")?Cesium.StripeOrientation:e.hasOwnProperty("wsen")||e.hasOwnProperty("wsenDegrees")?Cesium.Rectangle:e.hasOwnProperty("uri")?Cesium.Uri:e.hasOwnProperty("verticalOrigin")?Cesium.VerticalOrigin:Object}function ed(e,t,i){switch(e){case Cesium.ArcType:return Cesium.ArcType[Cesium.defaultValue(t.arcType,t)];case Array:return t.array;case Boolean:return Cesium.defaultValue(t.boolean,t);case Cesium.BoundingRectangle:return t.boundingRectangle;case Cesium.Cartesian2:return t.cartesian2;case Cesium.Cartesian3:return Zm(t);case Gm:return function(e){var t=Zm(e);if(3===t.length)return Jm(t,0),t;for(var i=1;i<t.length;i+=4)Jm(t,i);return t}(t);case Cesium.Color:return function(e){var t=e.rgbaf;if(Cesium.defined(t))return t;var i=e.rgba;if(Cesium.defined(i)){var n=i.length;if(n===Cesium.Color.packedLength)return[Cesium.Color.byteToFloat(i[0]),Cesium.Color.byteToFloat(i[1]),Cesium.Color.byteToFloat(i[2]),Cesium.Color.byteToFloat(i[3])];t=new Array(n);for(var r=0;r<n;r+=5)t[r]=i[r],t[r+1]=Cesium.Color.byteToFloat(i[r+1]),t[r+2]=Cesium.Color.byteToFloat(i[r+2]),t[r+3]=Cesium.Color.byteToFloat(i[r+3]),t[r+4]=Cesium.Color.byteToFloat(i[r+4]);return t}}(t);case Cesium.ClassificationType:return Cesium.ClassificationType[Cesium.defaultValue(t.classificationType,t)];case Cesium.ColorBlendMode:return Cesium.ColorBlendMode[Cesium.defaultValue(t.colorBlendMode,t)];case Cesium.CornerType:return Cesium.CornerType[Cesium.defaultValue(t.cornerType,t)];case Cesium.HeightReference:return Cesium.HeightReference[Cesium.defaultValue(t.heightReference,t)];case Cesium.HorizontalOrigin:return Cesium.HorizontalOrigin[Cesium.defaultValue(t.horizontalOrigin,t)];case Image:return Km(t,i);case Cesium.JulianDate:return Cesium.JulianDate.fromIso8601(Cesium.defaultValue(t.date,t));case Cesium.LabelStyle:return Cesium.LabelStyle[Cesium.defaultValue(t.labelStyle,t)];case Number:return Cesium.defaultValue(t.number,t);case Cesium.NearFarScalar:return t.nearFarScalar;case Cesium.DistanceDisplayCondition:return t.distanceDisplayCondition;case Object:return Cesium.defaultValue(Cesium.defaultValue(t.object,t.value),t);case Cesium.Quaternion:return function(e){var t=e.unitQuaternion;if(Cesium.defined(t)){if(4===t.length)return Qm(t,0),t;for(var i=1;i<t.length;i+=5)Qm(t,i)}return t}(t);case Cesium.Rotation:return Cesium.defaultValue(t.number,t);case Cesium.ShadowMode:return Cesium.ShadowMode[Cesium.defaultValue(Cesium.defaultValue(t.shadowMode,t.shadows),t)];case String:return Cesium.defaultValue(t.string,t);case Cesium.StripeOrientation:return Cesium.StripeOrientation[Cesium.defaultValue(t.stripeOrientation,t)];case Cesium.Rectangle:return function(e){var t=e.wsen;if(Cesium.defined(t))return t;var i=e.wsenDegrees;if(Cesium.defined(i)){var n=i.length;if(n===Cesium.Rectangle.packedLength)return[Cesium.Math.toRadians(i[0]),Cesium.Math.toRadians(i[1]),Cesium.Math.toRadians(i[2]),Cesium.Math.toRadians(i[3])];t=new Array(n);for(var r=0;r<n;r+=5)t[r]=i[r],t[r+1]=Cesium.Math.toRadians(i[r+1]),t[r+2]=Cesium.Math.toRadians(i[r+2]),t[r+3]=Cesium.Math.toRadians(i[r+3]),t[r+4]=Cesium.Math.toRadians(i[r+4]);return t}}(t);case Cesium.Uri:return Km(t,i);case Cesium.VerticalOrigin:return Cesium.VerticalOrigin[Cesium.defaultValue(t.verticalOrigin,t)];default:throw new Cesium.RuntimeError(e)}}var td={HERMITE:Bm,LAGRANGE:Vm,LINEAR:Um};function id(e,t){var i=e.interpolationAlgorithm,n=e.interpolationDegree;(Cesium.defined(i)||Cesium.defined(n))&&t.setInterpolationOptions({interpolationAlgorithm:td[i],interpolationDegree:n});var r=e.forwardExtrapolationType;Cesium.defined(r)&&(t.forwardExtrapolationType=Cesium.ExtrapolationType[r]);var a=e.forwardExtrapolationDuration;Cesium.defined(a)&&(t.forwardExtrapolationDuration=a);var o=e.backwardExtrapolationType;Cesium.defined(o)&&(t.backwardExtrapolationType=Cesium.ExtrapolationType[o]);var s=e.backwardExtrapolationDuration;Cesium.defined(s)&&(t.backwardExtrapolationDuration=s)}var nd={iso8601:void 0};function rd(e){if(Cesium.defined(e))return nd.iso8601=e,Cesium.TimeInterval.fromIso8601(nd)}function ad(e){var t=Cesium.Iso8601.MAXIMUM_INTERVAL.clone();return t.data=e,t}function od(e){var t=new Cesium.CompositeProperty;return t.intervals.addInterval(ad(e)),t}function sd(e){var t=new Cesium.CompositePositionProperty(e.referenceFrame);return t.intervals.addInterval(ad(e)),t}function ud(e,t,i,n,r,a,o){var s,u,l,c=rd(n.interval);Cesium.defined(r)&&(c=Cesium.defined(c)?Cesium.TimeInterval.intersect(c,r,Ym):r);var m=!Cesium.defined(n.reference)&&!Cesium.defined(n.velocityReference),d=Cesium.defined(c)&&!c.equals(Cesium.Iso8601.MAXIMUM_INTERVAL);if(!0===n.delete)return d?function e(t,i){{if(t instanceof Cesium.SampledProperty)return void t.removeSamples(i);if(t instanceof Cesium.TimeIntervalCollectionProperty)return void t.intervals.removeInterval(i);if(t instanceof Cesium.CompositeProperty){for(var n=t.intervals,r=0;r<n.length;++r){var a=Cesium.TimeInterval.intersect(n.get(r),i,Ym);a.isEmpty||e(a.data,i)}return void n.removeInterval(i)}}}(t[i],c):void(t[i]=void 0);var h=!1;if(m){if(u=ed(e,n,a),!Cesium.defined(u))return;s=Cesium.defaultValue(e.packedLength,1),l=Cesium.defaultValue(u.length,1),h=!Cesium.defined(n.array)&&"string"!=typeof u&&s<l&&e!==Object}var f="function"==typeof e.unpack&&e!==Cesium.Rotation;if(h||d){var p,_=t[i],C=n.epoch;if(Cesium.defined(C)&&(p=Cesium.JulianDate.fromIso8601(C)),h&&!d)return _ instanceof Cesium.SampledProperty||(t[i]=_=new Cesium.SampledProperty(e)),_.addSamplesPackedArray(u,p),void id(n,_);if(!h&&d)return(c=c.clone()).data=m?f?e.unpack(u,0):u:Hm(e,o,n),Cesium.defined(_)||(t[i]=_=m?new Cesium.TimeIntervalCollectionProperty:new Cesium.CompositeProperty),m&&_ instanceof Cesium.TimeIntervalCollectionProperty||(_ instanceof Cesium.CompositeProperty||(t[i]=_=od(_)),m&&(c.data=new Cesium.ConstantProperty(c.data))),void _.intervals.addInterval(c);Cesium.defined(_)||(t[i]=_=new Cesium.CompositeProperty),_ instanceof Cesium.CompositeProperty||(t[i]=_=od(_));var g=_.intervals,v=g.findInterval(c);Cesium.defined(v)&&v.data instanceof Cesium.SampledProperty||((v=c.clone()).data=new Cesium.SampledProperty(e),g.addInterval(v)),v.data.addSamplesPackedArray(u,p),id(n,v.data)}else t[i]=m?new Cesium.ConstantProperty(f?e.unpack(u,0):u):Hm(e,o,n)}function ld(e,t,i,n,r,a,o){if(Cesium.defined(n))if(Array.isArray(n))for(var s=0,u=n.length;s<u;++s)ud(e,t,i,n[s],r,a,o);else ud(e,t,i,n,r,a,o)}function cd(e,t,i,n,r,a){var o=rd(i.interval);Cesium.defined(n)&&(o=Cesium.defined(o)?Cesium.TimeInterval.intersect(o,n,Ym):n);var s,u,l=Cesium.defined(i.cartesianVelocity)?1:0,c=Cesium.Cartesian3.packedLength*(1+l),m=!Cesium.defined(i.reference),d=Cesium.defined(o)&&!o.equals(Cesium.Iso8601.MAXIMUM_INTERVAL);if(!0===i.delete)return d?function e(t,i){{if(t instanceof Cesium.SampledPositionProperty)return void t.removeSamples(i);if(t instanceof Cesium.TimeIntervalCollectionPositionProperty)return void t.intervals.removeInterval(i);if(t instanceof Cesium.CompositePositionProperty){for(var n=t.intervals,r=0;r<n.length;++r){var a=Cesium.TimeInterval.intersect(n.get(r),i,Ym);a.isEmpty||e(a.data,i)}return void n.removeInterval(i)}}}(e[t],o):void(e[t]=void 0);var h=!1;if(m&&(Cesium.defined(i.referenceFrame)&&(u=Cesium.ReferenceFrame[i.referenceFrame]),u=Cesium.defaultValue(u,Cesium.ReferenceFrame.FIXED),s=Zm(i),h=c<Cesium.defaultValue(s.length,1)),h||d){var f,p=e[t],_=i.epoch;if(Cesium.defined(_)&&(f=Cesium.JulianDate.fromIso8601(_)),h&&!d)return p instanceof Cesium.SampledPositionProperty&&(!Cesium.defined(u)||p.referenceFrame===u)||(e[t]=p=new Cesium.SampledPositionProperty(u,l)),p.addSamplesPackedArray(s,f),void id(i,p);if(!h&&d)return(o=o.clone()).data=m?Cesium.Cartesian3.unpack(s):km(a,i.reference),Cesium.defined(p)||(p=m?new Cesium.TimeIntervalCollectionPositionProperty(u):new Cesium.CompositePositionProperty(u),e[t]=p),m&&p instanceof Cesium.TimeIntervalCollectionPositionProperty&&Cesium.defined(u)&&p.referenceFrame===u||(p instanceof Cesium.CompositePositionProperty||(e[t]=p=sd(p)),m&&(o.data=new Cesium.ConstantPositionProperty(o.data,u))),void p.intervals.addInterval(o);Cesium.defined(p)?p instanceof Cesium.CompositePositionProperty||(e[t]=p=sd(p)):e[t]=p=new Cesium.CompositePositionProperty(u);var C=p.intervals,g=C.findInterval(o);Cesium.defined(g)&&g.data instanceof Cesium.SampledPositionProperty&&(!Cesium.defined(u)||g.data.referenceFrame===u)||((g=o.clone()).data=new Cesium.SampledPositionProperty(u,l),C.addInterval(g)),g.data.addSamplesPackedArray(s,f),id(i,g.data)}else e[t]=m?new Cesium.ConstantPositionProperty(Cesium.Cartesian3.unpack(s),u):km(a,i.reference)}function md(e,t,i,n,r,a){if(Cesium.defined(i))if(Array.isArray(i))for(var o=0,s=i.length;o<s;++o)cd(e,t,i[o],n,0,a);else cd(e,t,i,n,0,a)}function dd(e,t,i,n,r,a){var o=rd(i.interval);Cesium.defined(n)&&(o=Cesium.defined(o)?Cesium.TimeInterval.intersect(o,n,Ym):n);var s,u,l,c,m=e[t];Cesium.defined(o)?(m instanceof Cesium.CompositeMaterialProperty||(m=new Cesium.CompositeMaterialProperty,e[t]=m),l=(u=m.intervals).findInterval({start:o.start,stop:o.stop}),Cesium.defined(l)?s=l.data:(l=o.clone(),u.addInterval(l))):s=m,Cesium.defined(i.solidColor)?(s instanceof Cesium.ColorMaterialProperty||(s=new Cesium.ColorMaterialProperty),c=i.solidColor,ld(Cesium.Color,s,"color",c.color,void 0,void 0,a)):Cesium.defined(i.grid)?(s instanceof Cesium.GridMaterialProperty||(s=new Cesium.GridMaterialProperty),c=i.grid,ld(Cesium.Color,s,"color",c.color,void 0,r,a),ld(Number,s,"cellAlpha",c.cellAlpha,void 0,r,a),ld(Cesium.Cartesian2,s,"lineCount",c.lineCount,void 0,r,a),ld(Cesium.Cartesian2,s,"lineThickness",c.lineThickness,void 0,r,a),ld(Cesium.Cartesian2,s,"lineOffset",c.lineOffset,void 0,r,a)):Cesium.defined(i.image)?(s instanceof Cesium.ImageMaterialProperty||(s=new Cesium.ImageMaterialProperty),c=i.image,ld(Image,s,"image",c.image,void 0,r,a),ld(Cesium.Cartesian2,s,"repeat",c.repeat,void 0,r,a),ld(Cesium.Color,s,"color",c.color,void 0,r,a),ld(Boolean,s,"transparent",c.transparent,void 0,r,a)):Cesium.defined(i.stripe)?(s instanceof Cesium.StripeMaterialProperty||(s=new Cesium.StripeMaterialProperty),c=i.stripe,ld(Cesium.StripeOrientation,s,"orientation",c.orientation,void 0,r,a),ld(Cesium.Color,s,"evenColor",c.evenColor,void 0,r,a),ld(Cesium.Color,s,"oddColor",c.oddColor,void 0,r,a),ld(Number,s,"offset",c.offset,void 0,r,a),ld(Number,s,"repeat",c.repeat,void 0,r,a)):Cesium.defined(i.polylineOutline)?(s instanceof Cesium.PolylineOutlineMaterialProperty||(s=new Cesium.PolylineOutlineMaterialProperty),c=i.polylineOutline,ld(Cesium.Color,s,"color",c.color,void 0,r,a),ld(Cesium.Color,s,"outlineColor",c.outlineColor,void 0,r,a),ld(Number,s,"outlineWidth",c.outlineWidth,void 0,r,a)):Cesium.defined(i.polylineGlow)?(s instanceof Cesium.PolylineGlowMaterialProperty||(s=new Cesium.PolylineGlowMaterialProperty),c=i.polylineGlow,ld(Cesium.Color,s,"color",c.color,void 0,r,a),ld(Number,s,"glowPower",c.glowPower,void 0,r,a),ld(Number,s,"taperPower",c.taperPower,void 0,r,a)):Cesium.defined(i.polylineArrow)?(s instanceof Cesium.PolylineArrowMaterialProperty||(s=new Cesium.PolylineArrowMaterialProperty),c=i.polylineArrow,ld(Cesium.Color,s,"color",c.color,void 0,void 0,a)):Cesium.defined(i.polylineDash)?(s instanceof Cesium.PolylineDashMaterialProperty||(s=new Cesium.PolylineDashMaterialProperty),c=i.polylineDash,ld(Cesium.Color,s,"color",c.color,void 0,void 0,a),ld(Cesium.Color,s,"gapColor",c.gapColor,void 0,void 0,a),ld(Number,s,"dashLength",c.dashLength,void 0,r,a),ld(Number,s,"dashPattern",c.dashPattern,void 0,r,a)):Cesium.defined(i.checkerboard)&&(s instanceof Cesium.CheckerboardMaterialProperty||(s=new Cesium.CheckerboardMaterialProperty),c=i.checkerboard,ld(Cesium.Color,s,"evenColor",c.evenColor,void 0,r,a),ld(Cesium.Color,s,"oddColor",c.oddColor,void 0,r,a),ld(Cesium.Cartesian2,s,"repeat",c.repeat,void 0,r,a)),Cesium.defined(l)?l.data=s:e[t]=s}function hd(e,t,i,n,r,a){if(Cesium.defined(i))if(Array.isArray(i))for(var o=0,s=i.length;o<s;++o)dd(e,t,i[o],n,r,a);else dd(e,t,i,n,r,a)}function fd(e,t,i,n,r,a,o){var s,u,l=i.map(function(e){return km(r,e)});Cesium.defined(n)?(n=rd(n),(s=e[t])instanceof o||((u=new o).intervals.addInterval(ad(s)),e[t]=s=u),n.data=new a(l),s.intervals.addInterval(n)):e[t]=new a(l)}function pd(e,t,i,n){var r=i.references;Cesium.defined(r)?fd(e,t,r,i.interval,n,Cesium.PropertyArray,Cesium.CompositeProperty):ld(Array,e,t,i,void 0,void 0,n)}function _d(e,t,i,n){if(Cesium.defined(i))if(Array.isArray(i))for(var r=0,a=i.length;r<a;++r)pd(e,t,i[r],n);else pd(e,t,i,n)}function Cd(e,t,i,n){var r=i.references;Cesium.defined(r)?fd(e,t,r,i.interval,n,Cesium.PositionPropertyArray,Cesium.CompositePositionProperty):(Cesium.defined(i.cartesian)?i.array=Cesium.Cartesian3.unpackArray(i.cartesian):Cesium.defined(i.cartographicRadians)?i.array=Cesium.Cartesian3.fromRadiansArrayHeights(i.cartographicRadians):Cesium.defined(i.cartographicDegrees)&&(i.array=Cesium.Cartesian3.fromDegreesArrayHeights(i.cartographicDegrees)),Cesium.defined(i.array)&&ld(Array,e,t,i,void 0,void 0,n))}function gd(e,t,i,n){if(Cesium.defined(i))if(Array.isArray(i))for(var r=0,a=i.length;r<a;++r)Cd(e,t,i[r],n);else Cd(e,t,i,n)}function vd(e){return Cesium.Cartesian3.unpackArray(e)}function yd(e){return Cesium.Cartesian3.fromRadiansArrayHeights(e)}function Td(e){return Cesium.Cartesian3.fromDegreesArrayHeights(e)}function xd(e,t,i,n){var r,a=i.references;Cesium.defined(a)?(r=a.map(function(e){var t={};return fd(t,"positions",e,i.interval,n,Cesium.PositionPropertyArray,Cesium.CompositePositionProperty),t.positions}),e[t]=new Cesium.PositionPropertyArray(r)):(Cesium.defined(i.cartesian)?i.array=i.cartesian.map(vd):Cesium.defined(i.cartographicRadians)?i.array=i.cartographicRadians.map(yd):Cesium.defined(i.cartographicDegrees)&&(i.array=i.cartographicDegrees.map(Td)),Cesium.defined(i.array)&&ld(Array,e,t,i,void 0,void 0,n))}function wd(e,t,i,n,r){var a=rd(t.interval);Cesium.defined(i)&&(a=Cesium.defined(a)?Cesium.TimeInterval.intersect(a,i,Ym):i);for(var o=e.nodeTransformations,s=Object.keys(t),u=0,l=s.length;u<l;++u){var c,m,d=s[u];"interval"!==d&&(c=t[d],Cesium.defined(c)&&(Cesium.defined(o)||(e.nodeTransformations=o=new Cesium.PropertyBag),o.hasProperty(d)||o.addProperty(d),m=o[d],Cesium.defined(m)||(o[d]=m=new Cesium.NodeTransformationProperty),ld(Cesium.Cartesian3,m,"translation",c.translation,a,n,r),ld(Cesium.Quaternion,m,"rotation",c.rotation,a,n,r),ld(Cesium.Cartesian3,m,"scale",c.scale,a,n,r)))}}function Ad(e,t,i,n,r){var a=rd(t.interval);Cesium.defined(i)&&(a=Cesium.defined(a)?Cesium.TimeInterval.intersect(a,i,Ym):i);for(var o=e.articulations,s=Object.keys(t),u=0,l=s.length;u<l;++u){var c,m=s[u];"interval"!==m&&(c=t[m],Cesium.defined(c)&&(Cesium.defined(o)||(e.articulations=o=new Cesium.PropertyBag),o.hasProperty(m)||o.addProperty(m),ld(Number,o,m,c,a,n,r)))}}function Ed(e){this.polygon=e,this._definitionChanged=new Cesium.Event}function Sd(e){return e?Cesium.ArcType.GEODESIC:Cesium.ArcType.NONE}function bd(e,t,i,n,r,a,o){var s,u,l=i.id;if(Cesium.defined(l)||(l=Cesium.createGuid()),Fm=l,!Cesium.defined(o._version)&&"document"!==l)throw new Cesium.RuntimeError("The first CZML packet is required to be the document object.");if(!0===i.delete)n.removeById(l);else if("document"===l)!function(e,t){var i=e.version;if(Cesium.defined(i)&&"string"==typeof i){var n=i.split(".");if(2===n.length){if("1"!==n[0])throw new Cesium.RuntimeError("Cesium only supports CZML version 1.");t._version=i}}if(!Cesium.defined(t._version))throw new Cesium.RuntimeError("CZML version information invalid.  It is expected to be a property on the document object in the <Major>.<Minor> version format.");var r=t._documentPacket;Cesium.defined(e.name)&&(r.name=e.name);var a,o=e.clock;Cesium.defined(o)&&(a=r.clock,Cesium.defined(a)?(a.interval=Cesium.defaultValue(o.interval,a.interval),a.currentTime=Cesium.defaultValue(o.currentTime,a.currentTime),a.range=Cesium.defaultValue(o.range,a.range),a.step=Cesium.defaultValue(o.step,a.step),a.multiplier=Cesium.defaultValue(o.multiplier,a.multiplier)):r.clock={interval:o.interval,currentTime:o.currentTime,range:o.range,step:o.step,multiplier:o.multiplier})}(i,o);else{"CustomPrimitive"!=l?(s=n.getOrCreateEntity(l),u=i.parent,Cesium.defined(u)&&(s.parent=n.getOrCreateEntity(u))):(u=i.parent,i.viewer=e,Cesium.defined(u)&&(i.parentEntity=n.getOrCreateEntity(u)),i.movingTarget&&(i.receiveData=new Cesium.Event,i.addReceiveDataListener=function(e,t){switch(e){case Gt.NET_MSG_TSPI:return i.receiveData.addEventListener(t)}}));for(var c=r.length-1;-1<c;c--)r[c](s,i,n,a,t)}Fm=void 0}function Md(e){var t=e.split(","),i=Number(t[0].slice(t[0].indexOf("(")+1));0!=i&&(i/=255);var n=Number(t[1]);0!=n&&(n/=255);var r=Number(t[2]);0!=r&&(r/=255);var a=Number(t[3].slice(0,t[3].indexOf(")")))/255;return new Cesium.Color(i,n,r,a)}function Rd(t,e,i,n){var r=e,a=(i=Cesium.defaultValue(i,Cesium.defaultValue.EMPTY_OBJECT)).sourceUri,o=i.credit;if("string"==typeof o&&(o=new Cesium.CornerType(o)),t._credit=o,"string"==typeof e||e instanceof Cesium.Resource){r=(e=Cesium.Resource.createIfNeeded(e)).fetchJson(),a=Cesium.defaultValue(a,e.clone());var s=t._resourceCredits,u=e.credits;if(Cesium.defined(u))for(var l=u.length,c=0;c<l;c++)s.push(u[c])}return a=Cesium.Resource.createIfNeeded(a),Cesium.DataSource.setLoading(t,!0),Cesium.when(r,function(e){return function(e,t,i,n){Cesium.DataSource.setLoading(e,!0);var r=e._entityCollection;n&&(e._version=void 0,e._documentPacket=new Dd,r.removeAll());Pd._processCzml(t,r,i,void 0,e);var a=function(e){var t=e._documentPacket.clock;if(!Cesium.defined(t)){if(!Cesium.defined(e._clock)){var i=e._entityCollection.computeAvailability();if(!i.start.equals(Cesium.Iso8601.MINIMUM_VALUE)){var n,r=i.start,a=i.stop,o=Cesium.JulianDate.secondsDifference(a,r),s=Math.round(o/120);return(n=new Cesium.DataSourceClock).startTime=Cesium.JulianDate.clone(r),n.stopTime=Cesium.JulianDate.clone(a),n.clockRange=Cesium.ClockRange.LOOP_STOP,n.multiplier=s,n.currentTime=Cesium.JulianDate.clone(r),n.clockStep=Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER,e._clock=n,!0}}return!1}Cesium.defined(e._clock)?n=e._clock.clone():((n=new Cesium.DataSourceClock).startTime=Cesium.Iso8601.MINIMUM_VALUE.clone(),n.stopTime=Cesium.Iso8601.MAXIMUM_VALUE.clone(),n.currentTime=Cesium.Iso8601.MINIMUM_VALUE.clone(),n.clockRange=Cesium.ClockRange.LOOP_STOP,n.clockStep=Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER,n.multiplier=1);var u=rd(t.interval);return Cesium.defined(u)&&(n.startTime=u.start,n.stopTime=u.stop),Cesium.defined(t.currentTime)&&(n.currentTime=Cesium.JulianDate.fromIso8601(t.currentTime)),Cesium.defined(t.range)&&(n.clockRange=Cesium.defaultValue(Cesium.ClockRange[t.range],Cesium.ClockRange.LOOP_STOP)),Cesium.defined(t.step)&&(n.clockStep=Cesium.defaultValue(Cesium.ClockStep[t.step],Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER)),Cesium.defined(t.multiplier)&&(n.multiplier=t.multiplier),!n.equals(e._clock)&&(e._clock=n.clone(e._clock),!0)}(e),o=e._documentPacket;Cesium.defined(o.name)&&e._name!==o.name?(e._name=o.name,a=!0):!Cesium.defined(e._name)&&Cesium.defined(i)&&(e._name=Cesium.getFilenameFromUri(i.getUrlComponent()),a=!0);Cesium.DataSource.setLoading(e,!1),a&&e._changed.raiseEvent(e);return e}(t,e,a,n)}).otherwise(function(e){return Cesium.DataSource.setLoading(t,!1),t._error.raiseEvent(t,e),console.log(e),Cesium.when.reject(e)})}function Dd(){this.name=void 0,this.clock=void 0}function Pd(e){this._name=e,this._changed=new Cesium.Event,this._error=new Cesium.Event,this._isLoading=!1,this._loading=new Cesium.Event,this._clock=void 0,this._documentPacket=new Dd,this._version=void 0,this._entityCollection=new Cesium.EntityCollection(this),this._entityCluster=new Cesium.EntityCluster,this._credit=void 0,this._resourceCredits=[]}function Id(e){this.viewer=e.viewer,this.viewer.clock.shouldAnimate=!0,this.trainingClock=void 0,this.receiveData=new Cesium.Event,this.geometryArr=e.geometryArr,this.receiveMTFlightDatas=new Cesium.AssociativeArray}function Od(e,t){for(var i=Cesium.Transforms.headingPitchRollToFixedFrame(e,Cesium.HeadingPitchRoll.fromDegrees(0,0,0),Cesium.Ellipsoid.WGS84,Cesium.Transforms.eastNorthUpToFixedFrame),n=[],r=0;r<=360;r++){var a=Cesium.Math.toRadians(r);n.push(new Cesium.Cartesian3(t*Math.cos(a),t*Math.sin(a),0))}return n=n.map(function(e){return Cesium.Matrix4.multiplyByPoint(i,e,e)})}function Ld(e){var t=e.split(","),i=Number(t[0].slice(t[0].indexOf("(")+1));0!=i&&(i/=255);var n=Number(t[1]);0!=n&&(n/=255);var r=Number(t[2]);0!=r&&(r/=255);var a=Number(t[3].slice(0,t[3].indexOf(")")));return new Cesium.Color(i,n,r,a)}function Nd(e){this.position=Cesium.defaultValue(e.position,new Cesium.Cartesian3),this.name=Cesium.defaultValue(e.name,"EV_MTTrackedPoint"),this.viewer=Cesium.defaultValue(e.viewer)}function Bd(e,t){this._viewer=t.viewer,this._url=e,this._resource=new Cesium.Resource({url:e,headers:{"Content-Type":"application/x-www-form-urlencoded;"}})}function zd(e,t){for(var i in e){Fd(i,e[i],t)}}function Fd(e,t,i){if(Array.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];"object"==typeof r?zd(r,i.ele(e)):i.ele(e).text(r)}else"object"==typeof t?zd(t,i.ele(e)):i.ele(e).text(t)}Object.defineProperties(Ed.prototype,{isConstant:{get:function(){var e=this.polygon._positions,t=this.polygon._holes;return(!Cesium.defined(e)||e.isConstant)&&(!Cesium.defined(t)||t.isConstant)}},definitionChanged:{get:function(){return this._definitionChanged}}}),Ed.prototype.getValue=function(e,t){var i,n;return Cesium.defined(this.polygon._positions)&&(i=this.polygon._positions.getValue(e)),Cesium.defined(this.polygon._holes)&&(n=this.polygon._holes.getValue(e),Cesium.defined(n)&&(n=n.map(function(e){return new Cesium.PolygonHierarchy(e)}))),Cesium.defined(t)?(t.positions=i,t.holes=n,t):new Cesium.PolygonHierarchy(i,n)},Ed.prototype.equals=function(e){return this===e||e instanceof Ed&&Cesium.Property.equals(this.polygon._positions,e.polygon._positions)&&Cesium.Property.equals(this.polygon._holes,e.polygon._holes)},Pd.load=function(e,t){if(!Cesium.defined(t.viewer))throw new Cesium.DeveloperError("Viewer对象options.viewer不能为空。");return this.viewer=t.viewer,this.geometryArr=t.geometryArr,(new Pd).load(e,t)},Object.defineProperties(Pd.prototype,{name:{get:function(){return this._name}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(e){this._entityCollection.show=e}},clustering:{get:function(){return this._entityCluster},set:function(e){this._entityCluster=e}},credit:{get:function(){return this._credit}}}),Pd.updaters=[function(e,t,i,n){var r,a,o,s,u,l,c,m=t.billboard;Cesium.defined(m)&&(r=rd(m.interval),a=e.billboard,Cesium.defined(a)||(e.billboard=a=new Cesium.BillboardGraphics),ld(Boolean,a,"show",m.show,r,n,i),ld(Image,a,"image",m.image,r,n,i),ld(Number,a,"scale",m.scale,r,n,i),ld(Cesium.Cartesian2,a,"pixelOffset",m.pixelOffset,r,n,i),ld(Cesium.Cartesian3,a,"eyeOffset",m.eyeOffset,r,n,i),ld(Cesium.HorizontalOrigin,a,"horizontalOrigin",m.horizontalOrigin,r,n,i),ld(Cesium.VerticalOrigin,a,"verticalOrigin",m.verticalOrigin,r,n,i),ld(Cesium.HeightReference,a,"heightReference",m.heightReference,r,n,i),ld(Cesium.Color,a,"color",m.color,r,n,i),ld(Cesium.Rotation,a,"rotation",m.rotation,r,n,i),o=a,s=m.alignedAxis,u=r,l=n,c=i,Cesium.defined(s)&&ld(Gm,o,"alignedAxis",s,u,l,c),ld(Boolean,a,"sizeInMeters",m.sizeInMeters,r,n,i),ld(Number,a,"width",m.width,r,n,i),ld(Number,a,"height",m.height,r,n,i),ld(Cesium.NearFarScalar,a,"scaleByDistance",m.scaleByDistance,r,n,i),ld(Cesium.NearFarScalar,a,"translucencyByDistance",m.translucencyByDistance,r,n,i),ld(Cesium.NearFarScalar,a,"pixelOffsetScaleByDistance",m.pixelOffsetScaleByDistance,r,n,i),ld(Cesium.BoundingRectangle,a,"imageSubRegion",m.imageSubRegion,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",m.distanceDisplayCondition,r,n,i),ld(Number,a,"disableDepthTestDistance",m.disableDepthTestDistance,r,n,i))},function(e,t,i,n){var r,a,o=t.box;Cesium.defined(o)&&(r=rd(o.interval),a=e.box,Cesium.defined(a)||(e.box=a=new Cesium.BoxGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Cesium.Cartesian3,a,"dimensions",o.dimensions,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i))},function(e,t,i,n){var r,a,o=t.corridor;Cesium.defined(o)&&(r=rd(o.interval),a=e.corridor,Cesium.defined(a)||(e.corridor=a=new Cesium.CorridorGraphics),ld(Boolean,a,"show",o.show,r,n,i),gd(a,"positions",o.positions,i),ld(Number,a,"width",o.width,r,n,i),ld(Number,a,"height",o.height,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Number,a,"extrudedHeight",o.extrudedHeight,r,n,i),ld(Cesium.HeightReference,a,"extrudedHeightReference",o.extrudedHeightReference,r,n,i),ld(Cesium.CornerType,a,"cornerType",o.cornerType,r,n,i),ld(Number,a,"granularity",o.granularity,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i),ld(Cesium.ClassificationType,a,"classificationType",o.classificationType,r,n,i),ld(Number,a,"zIndex",o.zIndex,r,n,i))},function(e,t,i,n){var r,a,o=t.cylinder;Cesium.defined(o)&&(r=rd(o.interval),a=e.cylinder,Cesium.defined(a)||(e.cylinder=a=new Cesium.CylinderGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Number,a,"length",o.length,r,n,i),ld(Number,a,"topRadius",o.topRadius,r,n,i),ld(Number,a,"bottomRadius",o.bottomRadius,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Number,a,"numberOfVerticalLines",o.numberOfVerticalLines,r,n,i),ld(Number,a,"slices",o.slices,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i))},function(e,t,i,n){var r,a,o=t.ellipse;Cesium.defined(o)&&(r=rd(o.interval),a=e.ellipse,Cesium.defined(a)||(e.ellipse=a=new Cesium.EllipseGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Number,a,"semiMajorAxis",o.semiMajorAxis,r,n,i),ld(Number,a,"semiMinorAxis",o.semiMinorAxis,r,n,i),ld(Number,a,"height",o.height,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Number,a,"extrudedHeight",o.extrudedHeight,r,n,i),ld(Cesium.HeightReference,a,"extrudedHeightReference",o.extrudedHeightReference,r,n,i),ld(Cesium.Rotation,a,"rotation",o.rotation,r,n,i),ld(Cesium.Rotation,a,"stRotation",o.stRotation,r,n,i),ld(Number,a,"granularity",o.granularity,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Number,a,"numberOfVerticalLines",o.numberOfVerticalLines,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i),ld(Cesium.ClassificationType,a,"classificationType",o.classificationType,r,n,i),ld(Number,a,"zIndex",o.zIndex,r,n,i))},function(e,t,i,n){var r,a,o=t.ellipsoid;Cesium.defined(o)&&(r=rd(o.interval),a=e.ellipsoid,Cesium.defined(a)||(e.ellipsoid=a=new Cesium.EllipsoidGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Cesium.Cartesian3,a,"radii",o.radii,r,n,i),ld(Cesium.Cartesian3,a,"innerRadii",o.innerRadii,r,n,i),ld(Number,a,"minimumClock",o.minimumClock,r,n,i),ld(Number,a,"maximumClock",o.maximumClock,r,n,i),ld(Number,a,"minimumCone",o.minimumCone,r,n,i),ld(Number,a,"maximumCone",o.maximumCone,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Number,a,"stackPartitions",o.stackPartitions,r,n,i),ld(Number,a,"slicePartitions",o.slicePartitions,r,n,i),ld(Number,a,"subdivisions",o.subdivisions,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i))},function(e,t,i,n){var r,a,o=t.label;Cesium.defined(o)&&(r=rd(o.interval),a=e.label,Cesium.defined(a)||(e.label=a=new Cesium.LabelGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(String,a,"text",o.text,r,n,i),ld(String,a,"font",o.font,r,n,i),ld(Cesium.LabelStyle,a,"style",o.style,r,n,i),ld(Number,a,"scale",o.scale,r,n,i),ld(Boolean,a,"showBackground",o.showBackground,r,n,i),ld(Cesium.Color,a,"backgroundColor",o.backgroundColor,r,n,i),ld(Cesium.Cartesian2,a,"backgroundPadding",o.backgroundPadding,r,n,i),ld(Cesium.Cartesian2,a,"pixelOffset",o.pixelOffset,r,n,i),ld(Cesium.Cartesian3,a,"eyeOffset",o.eyeOffset,r,n,i),ld(Cesium.HorizontalOrigin,a,"horizontalOrigin",o.horizontalOrigin,r,n,i),ld(Cesium.VerticalOrigin,a,"verticalOrigin",o.verticalOrigin,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Cesium.Color,a,"fillColor",o.fillColor,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Cesium.NearFarScalar,a,"translucencyByDistance",o.translucencyByDistance,r,n,i),ld(Cesium.NearFarScalar,a,"pixelOffsetScaleByDistance",o.pixelOffsetScaleByDistance,r,n,i),ld(Cesium.NearFarScalar,a,"scaleByDistance",o.scaleByDistance,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i),ld(Number,a,"disableDepthTestDistance",o.disableDepthTestDistance,r,n,i))},function(e,t,i,n){var r=t.model;if(Cesium.defined(r)){var a,o,s=rd(r.interval),u=e.model;Cesium.defined(u)||(e.model=u=new Cesium.ModelGraphics),ld(Boolean,u,"show",r.show,s,n,i),ld(Cesium.Uri,u,"uri",r.gltf,s,n,i),ld(Number,u,"scale",r.scale,s,n,i),ld(Number,u,"minimumPixelSize",r.minimumPixelSize,s,n,i),ld(Number,u,"maximumScale",r.maximumScale,s,n,i),ld(Boolean,u,"incrementallyLoadTextures",r.incrementallyLoadTextures,s,n,i),ld(Boolean,u,"runAnimations",r.runAnimations,s,n,i),ld(Boolean,u,"clampAnimations",r.clampAnimations,s,n,i),ld(Cesium.ShadowMode,u,"shadows",r.shadows,s,n,i),ld(Cesium.HeightReference,u,"heightReference",r.heightReference,s,n,i),ld(Cesium.Color,u,"silhouetteColor",r.silhouetteColor,s,n,i),ld(Number,u,"silhouetteSize",r.silhouetteSize,s,n,i),ld(Cesium.Color,u,"color",r.color,s,n,i),ld(Cesium.ColorBlendMode,u,"colorBlendMode",r.colorBlendMode,s,n,i),ld(Number,u,"colorBlendAmount",r.colorBlendAmount,s,n,i),ld(Cesium.DistanceDisplayCondition,u,"distanceDisplayCondition",r.distanceDisplayCondition,s,n,i);var l=r.nodeTransformations;if(Cesium.defined(l))if(Array.isArray(l))for(a=0,o=l.length;a<o;++a)wd(u,l[a],s,n,i);else wd(u,l,s,n,i);var c=r.articulations;if(Cesium.defined(c))if(Array.isArray(c))for(a=0,o=c.length;a<o;++a)Ad(u,c[a],s,n,i);else Ad(u,c,s,n,i)}},function(e,t,i,n){var r=t.name;Cesium.defined(r)&&(e.name=t.name)},function(e,t,i,n){var r=t.description;Cesium.defined(r)&&ld(String,e,"description",r,void 0,n,i)},function(e,t,i,n){var r,a,o=t.path;Cesium.defined(o)&&(r=rd(o.interval),a=e.path,Cesium.defined(a)||(e.path=a=new Cesium.PathGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Number,a,"leadTime",o.leadTime,r,n,i),ld(Number,a,"trailTime",o.trailTime,r,n,i),ld(Number,a,"width",o.width,r,n,i),ld(Number,a,"resolution",o.resolution,r,n,i),hd(a,"material",o.material,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i))},function(e,t,i,n){var r,a,o=t.point;Cesium.defined(o)&&(r=rd(o.interval),a=e.point,Cesium.defined(a)||(e.point=a=new Cesium.PointGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Number,a,"pixelSize",o.pixelSize,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Cesium.Color,a,"color",o.color,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Cesium.NearFarScalar,a,"scaleByDistance",o.scaleByDistance,r,n,i),ld(Cesium.NearFarScalar,a,"translucencyByDistance",o.translucencyByDistance,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i),ld(Number,a,"disableDepthTestDistance",o.disableDepthTestDistance,r,n,i))},function(e,t,i,n){var r,a,o=t.polygon;Cesium.defined(o)&&(r=rd(o.interval),a=e.polygon,Cesium.defined(a)||(e.polygon=a=new Cesium.PolygonGraphics),ld(Boolean,a,"show",o.show,r,n,i),gd(a,"_positions",o.positions,i),function(e,t,i,n){if(Cesium.defined(i))if(Array.isArray(i))for(var r=0,a=i.length;r<a;++r)xd(e,t,i[r],n);else xd(e,t,i,n)}(a,"_holes",o.holes,i),(Cesium.defined(a._positions)||Cesium.defined(a._holes))&&(a.hierarchy=new Ed(a)),ld(Number,a,"height",o.height,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Number,a,"extrudedHeight",o.extrudedHeight,r,n,i),ld(Cesium.HeightReference,a,"extrudedHeightReference",o.extrudedHeightReference,r,n,i),ld(Cesium.Rotation,a,"stRotation",o.stRotation,r,n,i),ld(Number,a,"granularity",o.granularity,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Boolean,a,"perPositionHeight",o.perPositionHeight,r,n,i),ld(Boolean,a,"closeTop",o.closeTop,r,n,i),ld(Boolean,a,"closeBottom",o.closeBottom,r,n,i),ld(Cesium.ArcType,a,"arcType",o.arcType,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i),ld(Cesium.ClassificationType,a,"classificationType",o.classificationType,r,n,i),ld(Number,a,"zIndex",o.zIndex,r,n,i))},function(e,t,i,n){var r,a,o,s,u,l=t.polyline;Cesium.defined(l)&&(r=rd(l.interval),a=e.polyline,Cesium.defined(a)||(e.polyline=a=new Cesium.PolylineGraphics),ld(Boolean,a,"show",l.show,r,n,i),gd(a,"positions",l.positions,i),ld(Number,a,"width",l.width,r,n,i),ld(Number,a,"granularity",l.granularity,r,n,i),hd(a,"material",l.material,r,n,i),hd(a,"depthFailMaterial",l.depthFailMaterial,r,n,i),ld(Cesium.ArcType,a,"arcType",l.arcType,r,n,i),ld(Boolean,a,"clampToGround",l.clampToGround,r,n,i),ld(Cesium.ShadowMode,a,"shadows",l.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",l.distanceDisplayCondition,r,n,i),ld(Cesium.ClassificationType,a,"classificationType",l.classificationType,r,n,i),ld(Number,a,"zIndex",l.zIndex,r,n,i),Cesium.defined(l.followSurface)&&!Cesium.defined(l.arcType)&&(o={},ld(Boolean,o,"followSurface",l.followSurface,r,n,i),a.arcType=(s=o.followSurface,u=Sd,new Cesium.CallbackProperty(function(e,t){return u(s.getValue(e,t))},s.isConstant))))},function(e,t,i,n){var r=t.properties;if(Cesium.defined(r))for(var a in Cesium.defined(e.properties)||(e.properties=new Cesium.PropertyBag),r)if(r.hasOwnProperty(a)){e.properties.hasProperty(a)||e.properties.addProperty(a);var o=r[a];if(Array.isArray(o))for(var s=0,u=o.length;s<u;++s)ud($m(o[s]),e.properties,a,o[s],void 0,n,i);else ud($m(o),e.properties,a,o,void 0,n,i)}},function(e,t,i,n){var r,a,o=t.rectangle;Cesium.defined(o)&&(r=rd(o.interval),a=e.rectangle,Cesium.defined(a)||(e.rectangle=a=new Cesium.RectangleGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Ceium.Rectangle,a,"coordinates",o.coordinates,r,n,i),ld(Number,a,"height",o.height,r,n,i),ld(Cesium.HeightReference,a,"heightReference",o.heightReference,r,n,i),ld(Number,a,"extrudedHeight",o.extrudedHeight,r,n,i),ld(Cesium.HeightReference,a,"extrudedHeightReference",o.extrudedHeightReference,r,n,i),ld(Cesium.Rotation,a,"rotation",o.rotation,r,n,i),ld(Cesium.Rotation,a,"stRotation",o.stRotation,r,n,i),ld(Number,a,"granularity",o.granularity,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i),ld(Cesium.ClassificationType,a,"classificationType",o.classificationType,r,n,i),ld(Number,a,"zIndex",o.zIndex,r,n,i))},function(e,t,i,n){var r=t.position;Cesium.defined(r)&&md(e,"position",r,void 0,0,i)},function(e,t,i,n){var r,a,o=t.tileset;Cesium.defined(o)&&(r=rd(o.interval),a=e.tileset,Cesium.defined(a)||(e.tileset=a=new Cesium.Cesium3DTilesetGraphics),ld(Boolean,a,"show",o.show,r,n,i),ld(Cesium.Uri,a,"uri",o.uri,r,n,i),ld(Number,a,"maximumScreenSpaceError",o.maximumScreenSpaceError,r,n,i))},function(e,t,i,n){var r=t.viewFrom;Cesium.defined(r)&&ld(Cesium.Cartesian3,e,"viewFrom",r,void 0,n,i)},function(e,t,i,n){var r,a,o=t.wall;Cesium.defined(o)&&(r=rd(o.interval),a=e.wall,Cesium.defined(a)||(e.wall=a=new Cesium.WallGraphics),ld(Boolean,a,"show",o.show,r,n,i),gd(a,"positions",o.positions,i),_d(a,"minimumHeights",o.minimumHeights,i),_d(a,"maximumHeights",o.maximumHeights,i),ld(Number,a,"granularity",o.granularity,r,n,i),ld(Boolean,a,"fill",o.fill,r,n,i),hd(a,"material",o.material,r,n,i),ld(Boolean,a,"outline",o.outline,r,n,i),ld(Cesium.Color,a,"outlineColor",o.outlineColor,r,n,i),ld(Number,a,"outlineWidth",o.outlineWidth,r,n,i),ld(Cesium.ShadowMode,a,"shadows",o.shadows,r,n,i),ld(Cesium.DistanceDisplayCondition,a,"distanceDisplayCondition",o.distanceDisplayCondition,r,n,i))},function(e,t,i,n){var r=t.orientation;Cesium.defined(r)&&ld(Cesium.Quaternion,e,"orientation",r,void 0,n,i)},function(e,t,i,n){var r,a=t.availability;if(Cesium.defined(a)){if(Array.isArray(a))for(var o=0,s=a.length;o<s;++o)Cesium.defined(r)||(r=new Cesium.TimeIntervalCollection),r.addInterval(rd(a[o]));else(r=new Cesium.TimeIntervalCollection).addInterval(rd(a));e.availability=r}},function(e,t,i,n,r){var a,o,s,u,l,c=t.parseArrayRadar;Cesium.defined(c)&&(Cesium.defined(t.CustomOrientation)&&(a=t.CustomOrientation,o=ed(Cesium.Quaternion,a,n),(s=new Cesium.SampledProperty(Cesium.Quaternion)).addSamplesPackedArray(o,a.epoch),id(a,s)),u=Cesium.defined(c.color)?Md(c.color):void 0,l=new Pi({viewer:t.viewer,id:t.CustomName,position:t.parentEntity.position,radius:c.radius,showScan:c.showScan,showLines:c.showLines,showSurfaces:c.showSurfaces,color:u,show:c.show,lineColor:Cesium.defined(c.lineColor)?Md(c.lineColor):void 0,yawSpan:c.yawSpan,pitchSpan:c.pitchSpan,direction:c.direction}),r&&r.push(l))},function(e,t,i,n,r){var a,o,s,u=t.customizedPARadar;Cesium.defined(u)&&((a=u.yawRange)&&2==a.length&&(a=new Cesium.Cartesian2(a[0],a[1])),(o=u.pitchRange)&&2==o.length&&(o=new Cesium.Cartesian2(o[0],o[1])),s=new Dt({viewer:t.viewer,id:t.CustomName,show:u.show,position:t.parentEntity.position,showScan:u.showScan,renderStyle:u.renderStyle,outRadius:u.outRadius,inRadius:u.inRadius,color:Cesium.defined(u.color)?Md(u.color):void 0,lineColor:Cesium.defined(u.lineColor)?Md(u.lineColor):void 0,yawRange:a,pitchRange:o,circleDensity:u.circleDensity,ms:u.ms}),r&&r.push(s))},function(e,t,i,n,r){var a,o,s=t.mechanicalRadar;Cesium.defined(s)&&(a=s.position.cartesian,Cesium.defined(a)&&(o=new un({viewer:t.viewer,id:t.CustomName,show:s.show,position:new Cesium.Cartesian3(a[0],a[1],a[2]),showScan:s.showScan,startYaw:s.startYaw,endYaw:s.endYaw,angularRate:s.angularRate,envelopeColor:s.envelopeColor,sectorColor:s.sectorColor,radius:s.radius}),r&&r.push(o)))},function(e,t,i,n,r){var a,o,s,u,l=t.vehicleRadar;Cesium.defined(l)&&(a=l.position.cartesian,Cesium.defined(a)&&(o=Cesium.defined(l.color)?Md(l.color):void 0,s=Cesium.defined(l.scanPlaneColor)?Md(l.scanPlaneColor):void 0,u=new Si({viewer:t.viewer,id:t.id,show:l.show,position:new Cesium.Cartesian3(a[0],a[1],a[2]),radius:l.radius,color:o,showScanPlane:l.showScanPlane,scanPlaneColor:s,scanPlaneRate:l.scanPlaneRate}),r&&r.push(u)))},function(t,i,e,n,r){var a,o,s,u,l=i.customCylider;Cesium.defined(l)&&(ld(Boolean,i,"show",l.show,void 0,n,e),gd(i,"positions",l.positions,e),a=[Cesium.Cartesian3.ZERO,new Cesium.Cartesian3(1,1,1)],i.viewer.scene.preRender.addEventListener(function(){var e=i.viewer.scene.frameState.time;t&&t._cylinder._show.getValue(e)&&(a=i.positions.getValue(e))}),Cesium.defined(l.material)&&(o=Cesium.defaultValue(Md(l.material.color),Cesium.Color.YELLOW.withAlpha(1)),s=Cesium.defaultValue(l.material.duration,3e3),u=Cesium.defaultValue(Cesium.buildModuleUrl(l.material.trailImage),Cesium.buildModuleUrl("Assets/EMExtensions/downwave.png")),t=i.viewer.entities.add({id:i.CustomName,orientation:new Cesium.CallbackProperty(function(){var e=function(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=Cesium.Cesium.Cartesian3.subtract(t,e,new Cesium.Cesium.Cartesian3),r=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(i,new Cesium.Matrix4),n,new Cesium.Cesium.Cartesian3),a=Cesium.Cesium.Cartesian3.normalize(r,new Cesium.Cesium.Cartesian3),o=Math.atan2(a.y,a.x)-Cesium.Math.PI_OVER_TWO,s=Cesium.Math.TWO_PI-Cesium.Math.zeroToTwoPi(o),u=Cesium.Transforms.eastNorthUpToFixedFrame(e),r=Cesium.Cesium.Cartesian3.subtract(t,e,new Cesium.Cesium.Cartesian3),l=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(u,u),r,r);Cesium.Cesium.Cartesian3.normalize(l,l);var c=Cesium.Math.PI_OVER_TWO-Cesium.Math.acosClamped(l.z);return new Cesium.HeadingPitchRoll(s,c,0)}(a[0],a[1]);return e.pitch+=Cesium.Math.PI_OVER_TWO,e.heading-=Cesium.Math.PI_OVER_TWO,Cesium.Transforms.headingPitchRollQuaternion(a[1],e)},!1),position:new Cesium.CallbackProperty(function(){var e=Cesium.Cartesian3.subtract(a[0],a[1],new Cesium.Cartesian3),t=Cesium.Cartesian3.divideByScalar(e,2,new Cesium.Cartesian3);return Cesium.Cartesian3.add(t,a[1],new Cesium.Cartesian3)},!1),cylinder:{show:i.show,length:new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.distance(a[0],a[1])},!1),topRadius:1e3,bottomRadius:0,showBottom:!1,showTop:!1,changeStCoordinate:!0,material:new Cesium.PolylineTrailLinkMaterialProperty({color:o,duration:s,trailImage:u})}}),r&&r.push(t)))},function(e,t,i,n,r){var a,o,s,u=t.movingTarget;if(Cesium.defined(u)){s="Red"==u.color?(a=0,o=new Cesium.Color(1,0,0,1),new Cesium.Color(1,0,0,1)):(a=1,o=new Cesium.Color(0,0,1,1),new Cesium.Color(0,0,1,1));for(var l=rd(t.timeInterval),c=new $c({viewer:t.viewer,ev_dataMgr:t,retainOutdatedData:!0}),m=new jt({uId:t.CustomName,mtType:u.type,name:t.CustomName,modelType:u.type,modelUri:Cesium.buildModuleUrl(u.modelUri),modelIconUri:void 0,iconColor:void 0,modelIconDisplayDistance:void 0,scale:Number(u.scale),sectorRadarVisible:u.sectorRadarVisible,trace:{traceTimeDuration:u.traceTimeDuration,upOffset:u.upOffset},modelLabelVisible:u.modelLabelVisible,modelLabelPullWireColor:s,modelLabelTextColor:o}),d=u.position.cartesian,h=u.orientation.unitQuaternion,f=[],p=1;p<h.length;p+=5)f.push(h[p]),f.push(h[p+1]),f.push(h[p+2]),f.push(h[p+3]);for(var _=(_=Cesium.JulianDate.toDate(l.start)).getTime(),C=new Cesium.AssociativeArray,g=0;g<d.length;g+=4){var v=Cesium.Cartographic.fromCartesian(new Cesium.Cartesian3(d[g+1],d[g+2],d[g+3]),Cesium.Ellipsoid.WGS84),y=Cesium.Math.toDegrees(v.longitude),T=Cesium.Math.toDegrees(v.latitude),x=v.height;m.addTimeAttitude({realTime:_+1e3*d[g],fLon:y,fLat:T,fAlt:x,position:new Cesium.Cartesian3(d[g+1],d[g+2],d[g+3]),nRedOrBlue:a,headingPitchRoll:Cesium.HeadingPitchRoll.fromQuaternion(new Cesium.Quaternion(f[g+1],f[g+2],f[g+3],f[g]))})}C.set(m.uId,m),t.receiveData.raiseEvent(C,Kt.ADD);var w=new rm({showBackground:!0});w.addDisplayFieldPara("","name"),w.addDisplayFieldPara("经度:","fLon",2),w.addDisplayFieldPara("纬度:","fLat",2),w.addDisplayFieldPara("高度:","fAlt",2),c.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_TSPI,w),c.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_GTSPI,w),c.setTraceVisible(Qc.Ribbon,Gt.NET_MSG_MIN,!0),c.graduatedColors.set(0,{traceRibbonColor:new Cesium.Color(1,0,0,1)}),c.graduatedColors.set(1,{traceRibbonColor:new Cesium.Color(0,0,1,1)})}}],Pd.prototype.process=function(e,t){return Rd(this,e,t,!1)},Pd.prototype.load=function(e,t){return Rd(this,e,t,!0)},Pd.processPacketData=ld,Pd.processPositionPacketData=md,Pd.processMaterialPacketData=hd,Pd._processCzml=function(e,t,i,n,r){if(n=Cesium.defaultValue(n,Pd.updaters),Array.isArray(e))for(var a=0,o=e.length;a<o;++a)bd(this.viewer,this.geometryArr,e[a],t,n,i,r);else bd(this.viewer,this.geometryArr,e,t,n,i,r)},Id.prototype.loadCzml=function(e){var t=e.czml,i=this.viewer,n=(this.setViewId,this.viewer.dataSources.add(Pd.load(t,{viewer:this.viewer,geometryArr:this.geometryArr})));i.flyTo(n),n.then(function(e){console.log(e)}).otherwise(function(e){console.log(e)})},Id.prototype.loadJson=function(e){var S,t=e.json;Cesium.defined(t)&&(S=this,Cesium.Resource.fetchJson(t).then(function(e){if(Cesium.defined(e.modelList)&&0!=e.modelList.length&&Cesium.defined(e.offectLongitude)){console.log(e);var t=e.offectLongitude,i=e.offectLatitude,n=S.viewer.scene,r=e.modelList[0].timePositionObj.timePosition;n.camera.setView({destination:Cesium.Cartesian3.fromDegrees(r[1]+t,r[2]+i,5e4),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0}});var a=e.wallList;if(a&&0!=a.length)for(var o=0;o<a.length;o++){for(var s=Od(Cesium.Cartesian3.fromDegrees(a[o].position[0],a[o].position[1],a[o].position[2]),a[o].radius),u=[],l=[],c=0;c<s.length;c+=1)u.push(a[o].maximumHeight),l.push(a[o].minimumHeight);S.viewer.entities.add({id:a[o].id,wall:{positions:s,maximumHeights:u,minimumHeights:l,fill:a[o].fill,material:Ld(a[o].color[0])}})}var m=(C=e.modelList).filter(function(e){if(Cesium.defined(e.effectList))return e});console.log(m);for(c=0;c<m.length;c++)for(var d=m[c].effectList,h=0;h<d.length;h++)if("dynnamicLineEffect"==d[h].type){for(var f=d[h].positions,p=[],_=0;_<f.length;_++)p.push(Cesium.Cartesian3.fromDegrees(f[_][0],f[_][1],f[_][2]));new Cesium.EV_RepeatFlowLine({viewer:S.viewer,positions:p,width:d[h].width,height:f[0][2],granularity:10,image:Cesium.buildModuleUrl("Assets/EMExtensions/DataTransLine.png"),speed:100,alpha:d[h].alpha,reverse:!1})}else"scanRadar"==d[h].type&&console.log(m[c]);S.trainingClock=new Cesium.Clock({startTime:Cesium.JulianDate.fromDate(new Date(e.glbReferenceTime)),currentTime:Cesium.JulianDate.fromDate(new Date(e.glbReferenceTime)),stopTime:Cesium.JulianDate.fromDate(new Date(e.endTime)),clockStep:Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER,multiplier:e.multiplier,clockRange:Cesium.ClockRange.CLAMPED}),S.ev_mtMgr=new $c({viewer:S.viewer,ev_dataMgr:S,trainingClock:S.trainingClock,useInstancedColor:!0});for(var C=e.modelList,o=0;o<C.length;o++){var g,v,y=C[o];v="Red"==y.color?(g=0,new Cesium.Color(1,0,0,1)):(g=1,new Cesium.Color(0,0,1,1)),console.log(y.scale);for(var T=new jt({uId:y.id,mtType:y.type,name:y.name,modelType:y.type,modelUri:Cesium.buildModuleUrl(y.modelUri),modelIconUri:void 0,iconColor:void 0,modelIconDisplayDistance:void 0,scale:Number(y.scale),sectorRadarVisible:y.sectorRadarVisible,trace:{traceTimeDuration:2,upOffset:5},modelLabelVisible:y.modelLabelVisible,modelLabelTextColor:v}),x=y.timePositionObj.timePosition,w=y.timeOrientationObj.timeOrientation,A=0;A<x.length;A+=4)T.addTimeAttitude({realTime:x[A],fLon:t+x[A+1],fLat:i+x[A+2],fAlt:x[A+3],position:Cesium.Cartesian3.fromDegrees(t+x[A+1],i+x[A+2],x[A+3]),nRedOrBlue:g,headingPitchRoll:new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(w[A+1]),Cesium.Math.toRadians(w[A+2]),Cesium.Math.toRadians(w[A+3]))});S.receiveMTFlightDatas.set(T.uId,T)}S.trainingClock.shouldAnimate=!0,S.trainingClock.tick(),S.receiveData.raiseEvent(S.receiveMTFlightDatas,Kt.ADD);var E=new rm({showBackground:!0});E.addDisplayFieldPara("","name"),E.addDisplayFieldPara("经度:","fLon",2),E.addDisplayFieldPara("纬度:","fLat",2),E.addDisplayFieldPara("高度:","fAlt",2),S.ev_mtMgr.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_TSPI,E),S.ev_mtMgr.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_GTSPI,E),S.ev_mtMgr.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_WPN_TRAJ,E),S.ev_mtMgr.setTraceVisible(Qc.Ribbon,Gt.NET_MSG_MIN,!0),S.ev_mtMgr.graduatedColors.set(0,{modelColor:new Cesium.Color(1,0,0,1),modelLabelPullWireColor:new Cesium.Color(1,0,0,1),traceRibbonColor:new Cesium.Color(1,0,0,1)}),S.ev_mtMgr.graduatedColors.set(1,{modelColor:new Cesium.Color(0,0,1,1),modelLabelPullWireColor:new Cesium.Color(0,0,1,1),traceRibbonColor:new Cesium.Color(0,0,1,1)})}}).otherwise(function(e){throw new Cesium.DeveloperError("加载json失败")}))},Id.prototype.addReceiveDataListener=function(e,t){switch(e){case Gt.NET_MSG_TSPI:return this.receiveData.addEventListener(t)}},Nd.prototype.addLocking=function(){var e=this.viewer.entities.add({id:this.name,position:this.position,point:{color:new Cesium.Color(1,0,0,.1),pixelSize:6},show:!0,viewFrom:new Cesium.Cartesian3(1e4,0,1e4)});this.viewer.trackedEntity=e},Nd.prototype.removeLocking=function(){var e=this.viewer.entities.getById(this.name);this.viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),null!=e&&this.viewer.entities.remove(e)},Nd.prototype.updatePointLocking=function(){var e=this.viewer.entities.getById(this.name);null!=e&&(e.position=this.position)},Nd.prototype.updatePointListLocking=function(e){var t=Cesium.BoundingSphere.fromPoints(e),i=new Cesium.BoundingSphere(t.center,1.2*t.radius),n=new Cesium.HeadingPitchRange(this.viewer.camera.heading,this.viewer.camera.pitch,0);this.viewer.camera.viewBoundingSphere(i,n)},Object.defineProperties(Bd.prototype,{}),Bd.prototype.getSymbolMeshJson=function(e,i){var t=Cesium.XMLBuilder.create({"SOAP-ENV:Envelope":{"@xmlns:xsd":"http://www.w3.org/2001/XMLSchema","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xmlns:enc":"http://schemas.xmlsoap.org/soap/encoding/","@xmlns:SOAP-ENV":"http://schemas.xmlsoap.org/soap/envelope/","@xmlns:ev1":"http://gx.web.services.server.earthview/"}});zd(e,t.ele("SOAP-ENV:Body").ele("ev1:getSymbolMesh")),this._resource.clone().post(t.end(),{responseType:"document",overrideMimeType:"text/xml"}).then(function(e){var t=function(e){for(var t=e.all.length,i=0;i<t;i++){var n=e.all[i];if("symbolDataText"==n.localName)return n.textContent}}(e);Cesium.defined(i)&&i(t)}).otherwise(function(e){Cesium.defined(i)&&i("error")})};var Vd={BYTE:Qa.BYTE,UNSIGNED_BYTE:Qa.UNSIGNED_BYTE,SHORT:Qa.SHORT,UNSIGNED_SHORT:Qa.UNSIGNED_SHORT,INT:Qa.INT,UNSIGNED_INT:Qa.UNSIGNED_INT,FLOAT:Qa.FLOAT,DOUBLE:Qa.DOUBLE,getSizeInBytes:function(e){switch(e){case Vd.BYTE:return Int8Array.BYTES_PER_ELEMENT;case Vd.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Vd.SHORT:return Int16Array.BYTES_PER_ELEMENT;case Vd.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Vd.INT:return Int32Array.BYTES_PER_ELEMENT;case Vd.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Vd.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case Vd.DOUBLE:return Float64Array.BYTES_PER_ELEMENT}},fromTypedArray:function(e){return e instanceof Int8Array?Vd.BYTE:e instanceof Uint8Array?Vd.UNSIGNED_BYTE:e instanceof Int16Array?Vd.SHORT:e instanceof Uint16Array?Vd.UNSIGNED_SHORT:e instanceof Int32Array?Vd.INT:e instanceof Uint32Array?Vd.UNSIGNED_INT:e instanceof Float32Array?Vd.FLOAT:e instanceof Float64Array?Vd.DOUBLE:void 0},validate:function(e){return oe(e)&&(e===Vd.BYTE||e===Vd.UNSIGNED_BYTE||e===Vd.SHORT||e===Vd.UNSIGNED_SHORT||e===Vd.INT||e===Vd.UNSIGNED_INT||e===Vd.FLOAT||e===Vd.DOUBLE)},createTypedArray:function(e,t){switch(e){case Vd.BYTE:return new Int8Array(t);case Vd.UNSIGNED_BYTE:return new Uint8Array(t);case Vd.SHORT:return new Int16Array(t);case Vd.UNSIGNED_SHORT:return new Uint16Array(t);case Vd.INT:return new Int32Array(t);case Vd.UNSIGNED_INT:return new Uint32Array(t);case Vd.FLOAT:return new Float32Array(t);case Vd.DOUBLE:return new Float64Array(t)}},createArrayBufferView:function(e,t,i,n){switch(i=z(i,0),n=z(n,(t.byteLength-i)/Vd.getSizeInBytes(e)),e){case Vd.BYTE:return new Int8Array(t,i,n);case Vd.UNSIGNED_BYTE:return new Uint8Array(t,i,n);case Vd.SHORT:return new Int16Array(t,i,n);case Vd.UNSIGNED_SHORT:return new Uint16Array(t,i,n);case Vd.INT:return new Int32Array(t,i,n);case Vd.UNSIGNED_INT:return new Uint32Array(t,i,n);case Vd.FLOAT:return new Float32Array(t,i,n);case Vd.DOUBLE:return new Float64Array(t,i,n)}},fromName:function(e){switch(e){case"BYTE":return Vd.BYTE;case"UNSIGNED_BYTE":return Vd.UNSIGNED_BYTE;case"SHORT":return Vd.SHORT;case"UNSIGNED_SHORT":return Vd.UNSIGNED_SHORT;case"INT":return Vd.INT;case"UNSIGNED_INT":return Vd.UNSIGNED_INT;case"FLOAT":return Vd.FLOAT;case"DOUBLE":return Vd.DOUBLE}}},Ud=Object.freeze(Vd),Gd={UNSIGNED_BYTE:Qa.UNSIGNED_BYTE,UNSIGNED_SHORT:Qa.UNSIGNED_SHORT,UNSIGNED_INT:Qa.UNSIGNED_INT,getSizeInBytes:function(e){switch(e){case Gd.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Gd.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Gd.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}},fromSizeInBytes:function(e){switch(e){case 2:return Gd.UNSIGNED_SHORT;case 4:return Gd.UNSIGNED_INT;case 1:return Gd.UNSIGNED_BYTE}},validate:function(e){return oe(e)&&(e===Gd.UNSIGNED_BYTE||e===Gd.UNSIGNED_SHORT||e===Gd.UNSIGNED_INT)},createTypedArray:function(e,t){return new(e>=ri.SIXTY_FOUR_KILOBYTES?Uint32Array:Uint16Array)(t)},createTypedArrayFromArrayBuffer:function(e,t,i,n){return new(e>=ri.SIXTY_FOUR_KILOBYTES?Uint32Array:Uint16Array)(t,i,n)}},kd=Object.freeze(Gd),Hd={STREAM_DRAW:Qa.STREAM_DRAW,STATIC_DRAW:Qa.STATIC_DRAW,DYNAMIC_DRAW:Qa.DYNAMIC_DRAW,validate:function(e){return e===Hd.STREAM_DRAW||e===Hd.STATIC_DRAW||e===Hd.DYNAMIC_DRAW}},Wd=Object.freeze(Hd);function qd(e){var t=(e=z(e,z.EMPTY_OBJECT)).context._gl,i=e.bufferTarget,n=e.typedArray,r=e.sizeInBytes,a=e.usage,o=oe(n);o&&(r=n.byteLength);var s=t.createBuffer();t.bindBuffer(i,s),t.bufferData(i,o?n:r,a),t.bindBuffer(i,null),this._gl=t,this._webgl2=e.context._webgl2,this._bufferTarget=i,this._sizeInBytes=r,this._usage=a,this._buffer=s,this.vertexArrayDestroyable=!0}qd.createVertexBuffer=function(e){return new qd({context:e.context,bufferTarget:Qa.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})},qd.createIndexBuffer=function(e){var t=e.context,i=e.indexDatatype,n=kd.getSizeInBytes(i),r=new qd({context:t,bufferTarget:Qa.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage}),a=r.sizeInBytes/n;return Object.defineProperties(r,{indexDatatype:{get:function(){return i}},bytesPerIndex:{get:function(){return n}},numberOfIndices:{get:function(){return a}}}),r},Object.defineProperties(qd.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),qd.prototype._getBuffer=function(){return this._buffer},qd.prototype.copyFromArrayView=function(e,t){t=z(t,0);var i=this._gl,n=this._bufferTarget;i.bindBuffer(n,this._buffer),i.bufferSubData(n,t,e),i.bindBuffer(n,null)},qd.prototype.copyFromBuffer=function(e,t,i,n){var r=Qa.COPY_READ_BUFFER,a=Qa.COPY_WRITE_BUFFER,o=this._gl;o.bindBuffer(a,this._buffer),o.bindBuffer(r,e._buffer),o.copyBufferSubData(r,a,t,i,n),o.bindBuffer(a,null),o.bindBuffer(r,null)},qd.prototype.getBufferData=function(e,t,i,n){t=z(t,0),i=z(i,0);var r=this._gl,a=Qa.COPY_READ_BUFFER;r.bindBuffer(a,this._buffer),r.getBufferSubData(a,t,e,i,n),r.bindBuffer(a,null)},qd.prototype.isDestroyed=function(){return!1},qd.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),Wi(this)};var jd={POINTS:Qa.POINTS,LINES:Qa.LINES,LINE_LOOP:Qa.LINE_LOOP,LINE_STRIP:Qa.LINE_STRIP,TRIANGLES:Qa.TRIANGLES,TRIANGLE_STRIP:Qa.TRIANGLE_STRIP,TRIANGLE_FAN:Qa.TRIANGLE_FAN,validate:function(e){return e===jd.POINTS||e===jd.LINES||e===jd.LINE_LOOP||e===jd.LINE_STRIP||e===jd.TRIANGLES||e===jd.TRIANGLE_STRIP||e===jd.TRIANGLE_FAN}},Yd=Object.freeze(jd);function Xd(e){e=z(e,z.EMPTY_OBJECT),this._boundingVolume=e.boundingVolume,this._orientedBoundingBox=e.orientedBoundingBox,this._cull=z(e.cull,!0),this._occlude=z(e.occlude,!0),this._modelMatrix=e.modelMatrix,this._primitiveType=z(e.primitiveType,Yd.TRIANGLES),this._vertexArray=e.vertexArray,this._count=e.count,this._offset=z(e.offset,0),this._instanceCount=z(e.instanceCount,0),this._shaderProgram=e.shaderProgram,this._uniformMap=e.uniformMap,this._renderState=e.renderState,this._framebuffer=e.framebuffer,this._pass=e.pass,this._executeInClosestFrustum=z(e.executeInClosestFrustum,!1),this._owner=e.owner,this._debugShowBoundingVolume=z(e.debugShowBoundingVolume,!1),this._debugOverlappingFrustums=0,this._castShadows=z(e.castShadows,!1),this._receiveShadows=z(e.receiveShadows,!1),this._pickId=e.pickId,this._pickOnly=z(e.pickOnly,!1),this.dirty=!0,this.lastDirtyTime=0,this.derivedCommands={}}Object.defineProperties(Xd.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(e){this._boundingVolume!==e&&(this._boundingVolume=e,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(e){this._orientedBoundingBox!==e&&(this._orientedBoundingBox=e,this.dirty=!0)}},cull:{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this.dirty=!0)}},occlude:{get:function(){return this._occlude},set:function(e){this._occlude!==e&&(this._occlude=e,this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix!==e&&(this._modelMatrix=e,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(e){this._primitiveType!==e&&(this._primitiveType=e,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(e){this._vertexArray!==e&&(this._vertexArray=e,this.dirty=!0)}},count:{get:function(){return this._count},set:function(e){this._count!==e&&(this._count=e,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(e){this._offset!==e&&(this._offset=e,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(e){this._instanceCount!==e&&(this._instanceCount=e,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(e){this._shaderProgram!==e&&(this._shaderProgram=e,this.dirty=!0)}},castShadows:{get:function(){return this._castShadows},set:function(e){this._castShadows!==e&&(this._castShadows=e,this.dirty=!0)}},receiveShadows:{get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(this._receiveShadows=e,this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(e){this._uniformMap!==e&&(this._uniformMap=e,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(e){this._renderState!==e&&(this._renderState=e,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(e){this._framebuffer!==e&&(this._framebuffer=e,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(e){this._pass!==e&&(this._pass=e,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return this._executeInClosestFrustum},set:function(e){this._executeInClosestFrustum!==e&&(this._executeInClosestFrustum=e,this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(e){this._owner!==e&&(this._owner=e,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(e){this._debugShowBoundingVolume!==e&&(this._debugShowBoundingVolume=e,this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(e){this._debugOverlappingFrustums!==e&&(this._debugOverlappingFrustums=e,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(e){this._pickId!==e&&(this._pickId=e,this.dirty=!0)}},pickOnly:{get:function(){return this._pickOnly},set:function(e){this._pickOnly!==e&&(this._pickOnly=e,this.dirty=!0)}}}),Xd.shallowClone=function(e,t){if(oe(e))return oe(t)||(t=new Xd),t._boundingVolume=e._boundingVolume,t._orientedBoundingBox=e._orientedBoundingBox,t._cull=e._cull,t._occlude=e._occlude,t._modelMatrix=e._modelMatrix,t._primitiveType=e._primitiveType,t._vertexArray=e._vertexArray,t._count=e._count,t._offset=e._offset,t._instanceCount=e._instanceCount,t._shaderProgram=e._shaderProgram,t._uniformMap=e._uniformMap,t._renderState=e._renderState,t._framebuffer=e._framebuffer,t._pass=e._pass,t._executeInClosestFrustum=e._executeInClosestFrustum,t._owner=e._owner,t._debugShowBoundingVolume=e._debugShowBoundingVolume,t._debugOverlappingFrustums=e._debugOverlappingFrustums,t._castShadows=e._castShadows,t._receiveShadows=e._receiveShadows,t._pickId=e._pickId,t._pickOnly=e._pickOnly,t.dirty=!0,t.lastDirtyTime=0,t},Xd.prototype.execute=function(e,t){e.draw(this,t)};var Kd=Object.freeze({ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,OPAQUE:7,TRANSLUCENT:8,OVERLAY:9,NUMBER_OF_PASSES:10});function Zd(e,t,i,n){this.x=z(e,0),this.y=z(t,0),this.width=z(i,0),this.height=z(n,0)}Zd.packedLength=4,Zd.pack=function(e,t,i){return i=z(i,0),t[i++]=e.x,t[i++]=e.y,t[i++]=e.width,t[i]=e.height,t},Zd.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new Zd),i.x=e[t++],i.y=e[t++],i.width=e[t++],i.height=e[t],i},Zd.fromPoints=function(e,t){if(oe(t)||(t=new Zd),!oe(e)||0===e.length)return t.x=0,t.y=0,t.width=0,t.height=0,t;for(var i=e.length,n=e[0].x,r=e[0].y,a=e[0].x,o=e[0].y,s=1;s<i;s++)var u=e[s],l=u.x,c=u.y,n=Math.min(l,n),a=Math.max(l,a),r=Math.min(c,r),o=Math.max(c,o);return t.x=n,t.y=r,t.width=a-n,t.height=o-r,t};var Jd=new Ar,Qd=new dr,$d=new dr;Zd.fromRectangle=function(e,t,i){if(oe(i)||(i=new Zd),!oe(e))return i.x=0,i.y=0,i.width=0,i.height=0,i;var n=(t=z(t,Jd)).project(br.southwest(e,Qd)),r=t.project(br.northeast(e,$d));return ha.subtract(r,n,r),i.x=n.x,i.y=n.y,i.width=r.x,i.height=r.y,i},Zd.clone=function(e,t){if(oe(e))return oe(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new Zd(e.x,e.y,e.width,e.height)},Zd.union=function(e,t,i){oe(i)||(i=new Zd);var n=Math.min(e.x,t.x),r=Math.min(e.y,t.y),a=Math.max(e.x+e.width,t.x+t.width),o=Math.max(e.y+e.height,t.y+t.height);return i.x=n,i.y=r,i.width=a-n,i.height=o-r,i},Zd.expand=function(e,t,i){i=Zd.clone(e,i);var n=t.x-i.x,r=t.y-i.y;return n>i.width?i.width=n:n<0&&(i.width-=n,i.x=t.x),r>i.height?i.height=r:r<0&&(i.height-=r,i.y=t.y),i},Zd.intersect=function(e,t){var i=e.x,n=e.y,r=t.x,a=t.y;return i>r+t.width||i+e.width<r||n+e.height<a||n>a+t.height?Er.OUTSIDE:Er.INTERSECTING},Zd.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},Zd.prototype.clone=function(e){return Zd.clone(this,e)},Zd.prototype.intersect=function(e){return Zd.intersect(this,e)},Zd.prototype.equals=function(e){return Zd.equals(this,e)};var eh={CLOCKWISE:Qa.CW,COUNTER_CLOCKWISE:Qa.CCW,validate:function(e){return e===eh.CLOCKWISE||e===eh.COUNTER_CLOCKWISE}},th=Object.freeze(eh);function ih(e){var t=z(e,z.EMPTY_OBJECT),i=z(t.cull,z.EMPTY_OBJECT),n=z(t.polygonOffset,z.EMPTY_OBJECT),r=z(t.scissorTest,z.EMPTY_OBJECT),a=z(r.rectangle,z.EMPTY_OBJECT),o=z(t.depthRange,z.EMPTY_OBJECT),s=z(t.depthTest,z.EMPTY_OBJECT),u=z(t.colorMask,z.EMPTY_OBJECT),l=z(t.blending,z.EMPTY_OBJECT),c=z(l.color,z.EMPTY_OBJECT),m=z(t.stencilTest,z.EMPTY_OBJECT),d=z(m.frontOperation,z.EMPTY_OBJECT),h=z(m.backOperation,z.EMPTY_OBJECT),f=z(t.sampleCoverage,z.EMPTY_OBJECT),p=t.viewport;this.frontFace=z(t.frontFace,th.COUNTER_CLOCKWISE),this.cull={enabled:z(i.enabled,!1),face:z(i.face,Qa.BACK)},this.lineWidth=z(t.lineWidth,1),this.polygonOffset={enabled:z(n.enabled,!1),factor:z(n.factor,0),units:z(n.units,0)},this.scissorTest={enabled:z(r.enabled,!1),rectangle:Zd.clone(a)},this.depthRange={near:z(o.near,0),far:z(o.far,1)},this.depthTest={enabled:z(s.enabled,!1),func:z(s.func,Qa.LESS)},this.colorMask={red:z(u.red,!0),green:z(u.green,!0),blue:z(u.blue,!0),alpha:z(u.alpha,!0)},this.depthMask=z(t.depthMask,!0),this.stencilMask=z(t.stencilMask,-1),this.blending={enabled:z(l.enabled,!1),color:new as(z(c.red,0),z(c.green,0),z(c.blue,0),z(c.alpha,0)),equationRgb:z(l.equationRgb,Qa.FUNC_ADD),equationAlpha:z(l.equationAlpha,Qa.FUNC_ADD),functionSourceRgb:z(l.functionSourceRgb,Qa.ONE),functionSourceAlpha:z(l.functionSourceAlpha,Qa.ONE),functionDestinationRgb:z(l.functionDestinationRgb,Qa.ZERO),functionDestinationAlpha:z(l.functionDestinationAlpha,Qa.ZERO)},this.stencilTest={enabled:z(m.enabled,!1),frontFunction:z(m.frontFunction,Qa.ALWAYS),backFunction:z(m.backFunction,Qa.ALWAYS),reference:z(m.reference,0),mask:z(m.mask,-1),frontOperation:{fail:z(d.fail,Qa.KEEP),zFail:z(d.zFail,Qa.KEEP),zPass:z(d.zPass,Qa.KEEP)},backOperation:{fail:z(h.fail,Qa.KEEP),zFail:z(h.zFail,Qa.KEEP),zPass:z(h.zPass,Qa.KEEP)}},this.sampleCoverage={enabled:z(f.enabled,!1),value:z(f.value,1),invert:z(f.invert,!1)},this.viewport=oe(p)?new Zd(p.x,p.y,p.width,p.height):void 0,this.id=0,this._applyFunctions=[]}var nh=0,rh={};function ah(e,t,i){i?e.enable(t):e.disable(t)}function oh(e,t){e.frontFace(t.frontFace)}function sh(e,t){var i=t.cull,n=i.enabled;ah(e,e.CULL_FACE,n),n&&e.cullFace(i.face)}function uh(e,t){e.lineWidth(t.lineWidth)}function lh(e,t){var i=t.polygonOffset,n=i.enabled;ah(e,e.POLYGON_OFFSET_FILL,n),n&&e.polygonOffset(i.factor,i.units)}function ch(e,t,i){var n,r=t.scissorTest,a=oe(i.scissorTest)?i.scissorTest.enabled:r.enabled;ah(e,e.SCISSOR_TEST,a),a&&(n=oe(i.scissorTest)?i.scissorTest.rectangle:r.rectangle,e.scissor(n.x,n.y,n.width,n.height))}function mh(e,t){var i=t.depthRange;e.depthRange(i.near,i.far)}function dh(e,t){var i=t.depthTest,n=i.enabled;ah(e,e.DEPTH_TEST,n),n&&e.depthFunc(i.func)}function hh(e,t){var i=t.colorMask;e.colorMask(i.red,i.green,i.blue,i.alpha)}function fh(e,t){e.depthMask(t.depthMask)}function ph(e,t){e.stencilMask(t.stencilMask)}function _h(e,t,i){var n,r,a=t.blending,o=oe(i.blendingEnabled)?i.blendingEnabled:a.enabled;ah(e,e.BLEND,o),o&&(n=e,r=a.color,n.blendColor(r.red,r.green,r.blue,r.alpha),e.blendEquationSeparate(a.equationRgb,a.equationAlpha),e.blendFuncSeparate(a.functionSourceRgb,a.functionDestinationRgb,a.functionSourceAlpha,a.functionDestinationAlpha))}function Ch(e,t){var i,n,r,a,o,s,u,l,c,m,d,h,f=t.stencilTest,p=f.enabled;ah(e,e.STENCIL_TEST,p),p&&(i=f.frontFunction,n=f.backFunction,r=f.reference,a=f.mask,e.stencilFunc(i,r,a),e.stencilFuncSeparate(e.BACK,n,r,a),e.stencilFuncSeparate(e.FRONT,i,r,a),s=(o=f.frontOperation).fail,u=o.zFail,l=o.zPass,e.stencilOpSeparate(e.FRONT,s,u,l),m=(c=f.backOperation).fail,d=c.zFail,h=c.zPass,e.stencilOpSeparate(e.BACK,m,d,h))}function gh(e,t){var i=t.sampleCoverage,n=i.enabled;ah(e,e.SAMPLE_COVERAGE,n),n&&e.sampleCoverage(i.value,i.invert)}ih.fromCache=function(e){var t=JSON.stringify(e),i=rh[t];if(oe(i))return++i.referenceCount,i.state;var n=new ih(e),r=JSON.stringify(n);return oe(i=rh[r])||(n.id=nh++,i={referenceCount:0,state:n},rh[r]=i),++i.referenceCount,rh[t]={referenceCount:1,state:i.state},i.state},ih.removeFromCache=function(e){var t=new ih(e),i=JSON.stringify(t),n=rh[i],r=JSON.stringify(e),a=rh[r];oe(a)&&(--a.referenceCount,0===a.referenceCount&&(delete rh[r],oe(n)&&--n.referenceCount)),oe(n)&&0===n.referenceCount&&delete rh[i]},ih.getCache=function(){return rh},ih.clearCache=function(){rh={}};var vh=new Zd;function yh(e,t,i){var n=z(t.viewport,i.viewport);oe(n)||((n=vh).width=i.context.drawingBufferWidth,n.height=i.context.drawingBufferHeight),i.context.uniformState.viewport=n,e.viewport(n.x,n.y,n.width,n.height)}function Th(e,t,i,n){switch(t.type){case e.FLOAT:return new xh(e,0,i,n);case e.FLOAT_VEC2:return new wh(e,0,i,n);case e.FLOAT_VEC3:return new Ah(e,0,i,n);case e.FLOAT_VEC4:return new Eh(e,0,i,n);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new Sh(e,0,i,n);case e.INT:case e.BOOL:return new bh(e,0,i,n);case e.INT_VEC2:case e.BOOL_VEC2:return new Mh(e,0,i,n);case e.INT_VEC3:case e.BOOL_VEC3:return new Rh(e,0,i,n);case e.INT_VEC4:case e.BOOL_VEC4:return new Dh(e,0,i,n);case e.FLOAT_MAT2:return new Ih(e,0,i,n);case e.FLOAT_MAT3:return new Lh(e,0,i,n);case e.FLOAT_MAT4:return new Bh(e,0,i,n);default:throw new ue("Unrecognized uniform type: "+t.type+' for uniform "'+i+'".')}}function xh(e,t,i,n){this.name=i,this.value=void 0,this._value=0,this._gl=e,this._location=n}function wh(e,t,i,n){this.name=i,this.value=void 0,this._value=new ha,this._gl=e,this._location=n}function Ah(e,t,i,n){this.name=i,this.value=void 0,this._value=void 0,this._gl=e,this._location=n}function Eh(e,t,i,n){this.name=i,this.value=void 0,this._value=void 0,this._gl=e,this._location=n}function Sh(e,t,i,n){this.name=i,this.value=void 0,this._gl=e,this._location=n,this.textureUnitIndex=void 0}function bh(e,t,i,n){this.name=i,this.value=void 0,this._value=0,this._gl=e,this._location=n}function Mh(e,t,i,n){this.name=i,this.value=void 0,this._value=new ha,this._gl=e,this._location=n}function Rh(e,t,i,n){this.name=i,this.value=void 0,this._value=new si,this._gl=e,this._location=n}function Dh(e,t,i,n){this.name=i,this.value=void 0,this._value=new An,this._gl=e,this._location=n}ih.apply=function(e,t,i){oh(e,t),sh(e,t),uh(e,t),lh(e,t),mh(e,t),dh(e,t),hh(e,t),fh(e,t),ph(e,t),Ch(e,t),gh(e,t),ch(e,t,i),_h(e,t,i),yh(e,t,i)},ih.partialApply=function(e,t,i,n,r,a){if(t!==i){var o=i._applyFunctions[t.id];oe(o)||(c=i,m=[],(l=t).frontFace!==c.frontFace&&m.push(oh),l.cull.enabled===c.cull.enabled&&l.cull.face===c.cull.face||m.push(sh),l.lineWidth!==c.lineWidth&&m.push(uh),l.polygonOffset.enabled===c.polygonOffset.enabled&&l.polygonOffset.factor===c.polygonOffset.factor&&l.polygonOffset.units===c.polygonOffset.units||m.push(lh),l.depthRange.near===c.depthRange.near&&l.depthRange.far===c.depthRange.far||m.push(mh),l.depthTest.enabled===c.depthTest.enabled&&l.depthTest.func===c.depthTest.func||m.push(dh),l.colorMask.red===c.colorMask.red&&l.colorMask.green===c.colorMask.green&&l.colorMask.blue===c.colorMask.blue&&l.colorMask.alpha===c.colorMask.alpha||m.push(hh),l.depthMask!==c.depthMask&&m.push(fh),l.stencilMask!==c.stencilMask&&m.push(ph),l.stencilTest.enabled===c.stencilTest.enabled&&l.stencilTest.frontFunction===c.stencilTest.frontFunction&&l.stencilTest.backFunction===c.stencilTest.backFunction&&l.stencilTest.reference===c.stencilTest.reference&&l.stencilTest.mask===c.stencilTest.mask&&l.stencilTest.frontOperation.fail===c.stencilTest.frontOperation.fail&&l.stencilTest.frontOperation.zFail===c.stencilTest.frontOperation.zFail&&l.stencilTest.backOperation.fail===c.stencilTest.backOperation.fail&&l.stencilTest.backOperation.zFail===c.stencilTest.backOperation.zFail&&l.stencilTest.backOperation.zPass===c.stencilTest.backOperation.zPass||m.push(Ch),l.sampleCoverage.enabled===c.sampleCoverage.enabled&&l.sampleCoverage.value===c.sampleCoverage.value&&l.sampleCoverage.invert===c.sampleCoverage.invert||m.push(gh),o=m,i._applyFunctions[t.id]=o);for(var s=o.length,u=0;u<s;++u)o[u](e,i)}var l,c,m;(oe(n.scissorTest)?n.scissorTest:t.scissorTest)===(oe(r.scissorTest)?r.scissorTest:i.scissorTest)&&!a||ch(e,i,r);var d=oe(n.blendingEnabled)?n.blendingEnabled:t.blending.enabled,h=oe(r.blendingEnabled)?r.blendingEnabled:i.blending.enabled;(d!==h||h&&t.blending!==i.blending)&&_h(e,i,r),t===i&&n===r&&n.context===r.context||yh(e,i,r)},ih.getState=function(e){return{frontFace:e.frontFace,cull:{enabled:e.cull.enabled,face:e.cull.face},lineWidth:e.lineWidth,polygonOffset:{enabled:e.polygonOffset.enabled,factor:e.polygonOffset.factor,units:e.polygonOffset.units},scissorTest:{enabled:e.scissorTest.enabled,rectangle:Zd.clone(e.scissorTest.rectangle)},depthRange:{near:e.depthRange.near,far:e.depthRange.far},depthTest:{enabled:e.depthTest.enabled,func:e.depthTest.func},colorMask:{red:e.colorMask.red,green:e.colorMask.green,blue:e.colorMask.blue,alpha:e.colorMask.alpha},depthMask:e.depthMask,stencilMask:e.stencilMask,blending:{enabled:e.blending.enabled,color:as.clone(e.blending.color),equationRgb:e.blending.equationRgb,equationAlpha:e.blending.equationAlpha,functionSourceRgb:e.blending.functionSourceRgb,functionSourceAlpha:e.blending.functionSourceAlpha,functionDestinationRgb:e.blending.functionDestinationRgb,functionDestinationAlpha:e.blending.functionDestinationAlpha},stencilTest:{enabled:e.stencilTest.enabled,frontFunction:e.stencilTest.frontFunction,backFunction:e.stencilTest.backFunction,reference:e.stencilTest.reference,mask:e.stencilTest.mask,frontOperation:{fail:e.stencilTest.frontOperation.fail,zFail:e.stencilTest.frontOperation.zFail,zPass:e.stencilTest.frontOperation.zPass},backOperation:{fail:e.stencilTest.backOperation.fail,zFail:e.stencilTest.backOperation.zFail,zPass:e.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:e.sampleCoverage.enabled,value:e.sampleCoverage.value,invert:e.sampleCoverage.invert},viewport:oe(e.viewport)?Zd.clone(e.viewport):void 0}},xh.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))},wh.prototype.set=function(){var e=this.value;ha.equals(e,this._value)||(ha.clone(e,this._value),this._gl.uniform2f(this._location,e.x,e.y))},Ah.prototype.set=function(){var e=this.value;oe(e.red)?as.equals(e,this._value)||(this._value=as.clone(e,this._value),this._gl.uniform3f(this._location,e.red,e.green,e.blue)):oe(e.x)&&(si.equals(e,this._value)||(this._value=si.clone(e,this._value),this._gl.uniform3f(this._location,e.x,e.y,e.z)))},Eh.prototype.set=function(){var e=this.value;oe(e.red)?as.equals(e,this._value)||(this._value=as.clone(e,this._value),this._gl.uniform4f(this._location,e.red,e.green,e.blue,e.alpha)):oe(e.x)&&(An.equals(e,this._value)||(this._value=An.clone(e,this._value),this._gl.uniform4f(this._location,e.x,e.y,e.z,e.w)))},Sh.prototype.set=function(){var e=this._gl;e.activeTexture(e.TEXTURE0+this.textureUnitIndex);var t=this.value;e.bindTexture(t._target,t._texture)},Sh.prototype._setSampler=function(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1},bh.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))},Mh.prototype.set=function(){var e=this.value;ha.equals(e,this._value)||(ha.clone(e,this._value),this._gl.uniform2i(this._location,e.x,e.y))},Rh.prototype.set=function(){var e=this.value;si.equals(e,this._value)||(si.clone(e,this._value),this._gl.uniform3i(this._location,e.x,e.y,e.z))},Dh.prototype.set=function(){var e=this.value;An.equals(e,this._value)||(An.clone(e,this._value),this._gl.uniform4i(this._location,e.x,e.y,e.z,e.w))};var Ph=new Float32Array(4);function Ih(e,t,i,n){this.name=i,this.value=void 0,this._value=new va,this._gl=e,this._location=n}Ih.prototype.set=function(){var e;va.equalsArray(this.value,this._value,0)||(va.clone(this.value,this._value),e=va.toArray(this.value,Ph),this._gl.uniformMatrix2fv(this._location,!1,e))};var Oh=new Float32Array(9);function Lh(e,t,i,n){this.name=i,this.value=void 0,this._value=new pi,this._gl=e,this._location=n}Lh.prototype.set=function(){var e;pi.equalsArray(this.value,this._value,0)||(pi.clone(this.value,this._value),e=pi.toArray(this.value,Oh),this._gl.uniformMatrix3fv(this._location,!1,e))};var Nh=new Float32Array(16);function Bh(e,t,i,n){this.name=i,this.value=void 0,this._value=new Rn,this._gl=e,this._location=n}function zh(e,t,i,n){switch(t.type){case e.FLOAT:return new Fh(e,0,i,n);case e.FLOAT_VEC2:return new Vh(e,0,i,n);case e.FLOAT_VEC3:return new Uh(e,0,i,n);case e.FLOAT_VEC4:return new Gh(e,0,i,n);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new kh(e,0,i,n);case e.INT:case e.BOOL:return new Hh(e,0,i,n);case e.INT_VEC2:case e.BOOL_VEC2:return new Wh(e,0,i,n);case e.INT_VEC3:case e.BOOL_VEC3:return new qh(e,0,i,n);case e.INT_VEC4:case e.BOOL_VEC4:return new jh(e,0,i,n);case e.FLOAT_MAT2:return new Yh(e,0,i,n);case e.FLOAT_MAT3:return new Xh(e,0,i,n);case e.FLOAT_MAT4:return new Kh(e,0,i,n);default:throw new ue("Unrecognized uniform type: "+t.type+' for uniform "'+i+'".')}}function Fh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._location=n[0]}function Vh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(2*r),this._gl=e,this._location=n[0]}function Uh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(3*r),this._gl=e,this._location=n[0]}function Gh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(4*r),this._gl=e,this._location=n[0]}function kh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._locations=n,this.textureUnitIndex=void 0}function Hh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(r),this._gl=e,this._location=n[0]}function Wh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(2*r),this._gl=e,this._location=n[0]}function qh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(3*r),this._gl=e,this._location=n[0]}function jh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(4*r),this._gl=e,this._location=n[0]}function Yh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(4*r),this._gl=e,this._location=n[0]}function Xh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(9*r),this._gl=e,this._location=n[0]}function Kh(e,t,i,n){var r=n.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(16*r),this._gl=e,this._location=n[0]}Bh.prototype.set=function(){var e;Rn.equalsArray(this.value,this._value,0)||(Rn.clone(this.value,this._value),e=Rn.toArray(this.value,Nh),this._gl.uniformMatrix4fv(this._location,!1,e))},Fh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0;r<t;++r){var a=e[r];a!==i[r]&&(i[r]=a,n=!0)}n&&this._gl.uniform1fv(this._location,i)},Vh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];ha.equalsArray(o,i,r)||(ha.pack(o,i,r),n=!0),r+=2}n&&this._gl.uniform2fv(this._location,i)},Uh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];oe(o.red)?o.red===i[r]&&o.green===i[r+1]&&o.blue===i[r+2]||(i[r]=o.red,i[r+1]=o.green,i[r+2]=o.blue,n=!0):oe(o.x)&&(si.equalsArray(o,i,r)||(si.pack(o,i,r),n=!0)),r+=3}n&&this._gl.uniform3fv(this._location,i)},Gh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];oe(o.red)?as.equalsArray(o,i,r)||(as.pack(o,i,r),n=!0):oe(o.x)&&(An.equalsArray(o,i,r)||(An.pack(o,i,r),n=!0)),r+=4}n&&this._gl.uniform4fv(this._location,i)},kh.prototype.set=function(){for(var e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,i=this.value,n=i.length,r=0;r<n;++r){var a=i[r];e.activeTexture(t+r),e.bindTexture(a._target,a._texture)}},kh.prototype._setSampler=function(e){this.textureUnitIndex=e;for(var t=this._locations,i=t.length,n=0;n<i;++n){var r=e+n;this._gl.uniform1i(t[n],r)}return e+i},Hh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0;r<t;++r){var a=e[r];a!==i[r]&&(i[r]=a,n=!0)}n&&this._gl.uniform1iv(this._location,i)},Wh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];ha.equalsArray(o,i,r)||(ha.pack(o,i,r),n=!0),r+=2}n&&this._gl.uniform2iv(this._location,i)},qh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];si.equalsArray(o,i,r)||(si.pack(o,i,r),n=!0),r+=3}n&&this._gl.uniform3iv(this._location,i)},jh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];An.equalsArray(o,i,r)||(An.pack(o,i,r),n=!0),r+=4}n&&this._gl.uniform4iv(this._location,i)},Yh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];va.equalsArray(o,i,r)||(va.pack(o,i,r),n=!0),r+=4}n&&this._gl.uniformMatrix2fv(this._location,!1,i)},Xh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];pi.equalsArray(o,i,r)||(pi.pack(o,i,r),n=!0),r+=9}n&&this._gl.uniformMatrix3fv(this._location,!1,i)},Kh.prototype.set=function(){for(var e=this.value,t=e.length,i=this._value,n=!1,r=0,a=0;a<t;++a){var o=e[a];Rn.equalsArray(o,i,r)||(Rn.pack(o,i,r),n=!0),r+=16}n&&this._gl.uniformMatrix4fv(this._location,!1,i)};var Zh=0;function Jh(e){var t=e.vertexShaderText,i=e.fragmentShaderText;"undefined"!=typeof spector&&(t=t.replace(/^#line/gm,"//#line"),i=i.replace(/^#line/gm,"//#line"));var n=function(e,t){var i,n,r,a,o={};if(!gs.highpFloatSupported||!gs.highpIntSupported){var s,u=Qh(e),l=Qh(t),c=u.length,m=l.length;for(i=0;i<c;i++)for(n=0;n<m;n++){u[i]===l[n]&&(r=u[i],a="czm_mediump_"+r,s=new RegExp(r+"\\b","g"),t=t.replace(s,a),o[a]=r)}}return{fragmentShaderText:t,duplicateUniformNames:o}}(t,i);this._gl=e.gl,this._logShaderCompilation=e.logShaderCompilation,this._debugShaders=e.debugShaders,this._attributeLocations=e.attributeLocations,this._program=void 0,this._numberOfVertexAttributes=void 0,this._vertexAttributes=void 0,this._uniformsByName=void 0,this._uniforms=void 0,this._automaticUniforms=void 0,this._manualUniforms=void 0,this._duplicateUniformNames=n.duplicateUniformNames,this._cachedShader=void 0,this.maximumTextureUnitIndex=void 0,this._vertexShaderSource=e.vertexShaderSource,this._vertexShaderText=e.vertexShaderText,this._fragmentShaderSource=e.fragmentShaderSource,this._fragmentShaderText=n.fragmentShaderText,this.id=Zh++}function Qh(e){var t=[],i=e.match(/uniform.*?(?![^{]*})(?=[=\[;])/g);if(oe(i))for(var n=i.length,r=0;r<n;r++){var a=i[r].trim(),o=a.slice(a.lastIndexOf(" ")+1);t.push(o)}return t}Jh.fromCache=function(e){return(e=z(e,z.EMPTY_OBJECT)).context.shaderCache.getShaderProgram(e)},Jh.replaceCache=function(e){return(e=z(e,z.EMPTY_OBJECT)).context.shaderCache.replaceShaderProgram(e)},Object.defineProperties(Jh.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){return of(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return of(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return of(this),this._uniformsByName}}});var $h="[Cesium WebGL] ";function ef(e,t){var i,n=t._vertexShaderText,r=t._fragmentShaderText;"ActiveXObject"in window&&0<=r.indexOf("texture2DLodEXT")&&(r=r.replace("texture2DLodEXT( s, coord.xy, coord.w )","texture2D( s, coord.xy, -3.0 )")),0<=r.indexOf("#extension")&&((i=r.match(/#extension.*/g)).forEach(function(e){r=r.replace(e,"")}),i=i.join("\n"),r=i+"\n"+r);var a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,n),e.compileShader(a);var o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(o,r),e.compileShader(o);var s=e.createProgram();e.attachShader(s,a),e.attachShader(s,o),e.deleteShader(a),e.deleteShader(o);var u=t._attributeLocations;if(oe(u))for(var l in u)u.hasOwnProperty(l)&&e.bindAttribLocation(s,u[l],l);if(e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){var c,m=t._debugShaders;if(!e.getShaderParameter(o,e.COMPILE_STATUS)){var d,h=e.getShaderInfoLog(o);throw console.error($h+"Fragment shader compile log: "+h),oe(m)&&(""!==(d=m.getTranslatedShaderSource(o))?console.error($h+"Translated fragment shader source:\n"+d):console.error($h+"Fragment shader translation failed.")),e.deleteProgram(s),new ue("Fragment shader failed to compile.  Compile log: "+h)}if(!e.getShaderParameter(a,e.COMPILE_STATUS))throw h=e.getShaderInfoLog(a),console.error($h+"Vertex shader compile log: "+h),oe(m)&&(""!==(c=m.getTranslatedShaderSource(a))?console.error($h+"Translated vertex shader source:\n"+c):console.error($h+"Vertex shader translation failed.")),e.deleteProgram(s),new ue("Vertex shader failed to compile.  Compile log: "+h);throw h=e.getProgramInfoLog(s),console.error($h+"Shader program link log: "+h),oe(m)&&(console.error($h+"Translated vertex shader source:\n"+m.getTranslatedShaderSource(a)),console.error($h+"Translated fragment shader source:\n"+m.getTranslatedShaderSource(o))),e.deleteProgram(s),new ue("Program failed to link.  Link log: "+h)}var f=t._logShaderCompilation;return f&&oe(h=e.getShaderInfoLog(a))&&0<h.length&&console.log($h+"Vertex shader compile log: "+h),f&&oe(h=e.getShaderInfoLog(o))&&0<h.length&&console.log($h+"Fragment shader compile log: "+h),f&&oe(h=e.getProgramInfoLog(s))&&0<h.length&&console.log($h+"Shader program link log: "+h),s}function tf(e,t,i){for(var n={},r=0;r<i;++r){var a=e.getActiveAttrib(t,r),o=e.getAttribLocation(t,a.name);n[a.name]={name:a.name,type:a.type,index:o}}return n}function nf(e,t){for(var i={},n=[],r=[],a=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;o<a;++o){var s=e.getActiveUniform(t,o),u=-1!==s.name.indexOf("[0]",s.name.length-"[0]".length)?s.name.slice(0,s.name.length-3):s.name;if(0!==u.indexOf("gl_"))if(s.name.indexOf("[")<0){var l,c=e.getUniformLocation(t,u);null!==c&&(l=Th(e,s,u,c),i[u]=l,n.push(l),l._setSampler&&r.push(l))}else{var m,d,h,f,p=u.indexOf("[");if(0<=p){if(!oe(m=i[u.slice(0,p)]))continue;(d=m._locations).length<=1&&(h=m.value,null!==(f=e.getUniformLocation(t,u))&&(d.push(f),h.push(e.getUniform(t,f))))}else{d=[];for(var _=0;_<s.size;++_)null!==(f=e.getUniformLocation(t,u+"["+_+"]"))&&d.push(f);m=zh(e,s,u,d),i[u]=m,n.push(m),m._setSampler&&r.push(m)}}}return{uniformsByName:i,uniforms:n,samplerUniforms:r}}function rf(e,t){var i,n,r,a,o=[],s=[];for(var u in t){t.hasOwnProperty(u)&&(i=t[u],n=u,oe(r=e._duplicateUniformNames[n])&&(n=i.name=r),oe(a=uo[n])?o.push({uniform:i,automaticUniform:a}):s.push(i))}return{automaticUniforms:o,manualUniforms:s}}function af(e,t,i){e.useProgram(t);for(var n=0,r=i.length,a=0;a<r;++a)n=i[a]._setSampler(n);return e.useProgram(null),n}function of(e){oe(e._program)||!function l(c){var e=c._program;var t=c._gl;var i=ef(t,c,c._debugShaders);var n=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);var r=nf(t,i);var a=rf(c,r.uniformsByName);c._program=i;c._numberOfVertexAttributes=n;c._vertexAttributes=tf(t,i,n);c._uniformsByName=r.uniformsByName;c._uniforms=r.uniforms;c._automaticUniforms=a.automaticUniforms;c._manualUniforms=a.manualUniforms;c.maximumTextureUnitIndex=af(t,i,r.samplerUniforms);e&&c._gl.deleteProgram(e);"undefined"!=typeof spector&&(c._program.__SPECTOR_rebuildProgram=function(e,t,i,n){var r=c._vertexShaderText,a=c._fragmentShaderText,o=/ ! = /g;c._vertexShaderText=e.replace(o," != "),c._fragmentShaderText=t.replace(o," != ");try{l(c),i(c._program)}catch(e){c._vertexShaderText=r,c._fragmentShaderText=a;var s=/(?:Compile|Link) error: ([^]*)/,u=s.exec(e.message);n(u?u[1]:e.message)}})}(e)}Jh.prototype._bind=function(){of(this),this._gl.useProgram(this._program)},Jh.prototype._setUniforms=function(e,t,i){if(oe(e))for(var n=this._manualUniforms,r=n.length,a=0;a<r;++a){var o=n[a];o.value=e[o.name]()}var s=this._automaticUniforms;for(r=s.length,a=0;a<r;++a){var u=s[a];u.uniform.value=u.automaticUniform.getValue(t)}var l,c,m=this._uniforms;for(r=m.length,a=0;a<r;++a)m[a].set();i&&(l=this._gl,c=this._program,l.validateProgram(c))},Jh.prototype.isDestroyed=function(){return!1},Jh.prototype.destroy=function(){this._cachedShader.cache.releaseShaderProgram(this)},Jh.prototype.finalDestroy=function(){return this._gl.deleteProgram(this._program),Wi(this)};var sf=Object.freeze({NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3});function uf(e,t,i,n,r){this.xPoleWander=e,this.yPoleWander=t,this.xPoleOffset=i,this.yPoleOffset=n,this.ut1MinusUtc=r}function lf(e){var t,i;e=z(e,z.EMPTY_OBJECT),this._dates=void 0,this._samples=void 0,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=void 0,this._dataError=void 0,this._addNewLeapSeconds=z(e.addNewLeapSeconds,!0),oe(e.data)?mf(this,e.data):oe(e.url)?(t=nt.createIfNeeded(e.url),(i=this)._downloadPromise=t.fetchJson().then(function(e){mf(i,e)}).otherwise(function(){i._dataError="An error occurred while retrieving the EOP data from the URL "+t.url+"."})):mf(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}function cf(e,t){return Dm.compare(e.julianDate,t)}function mf(e,t){if(oe(t.columnNames))if(oe(t.samples)){var i=t.columnNames.indexOf("modifiedJulianDateUtc"),n=t.columnNames.indexOf("xPoleWanderRadians"),r=t.columnNames.indexOf("yPoleWanderRadians"),a=t.columnNames.indexOf("ut1MinusUtcSeconds"),o=t.columnNames.indexOf("xCelestialPoleOffsetRadians"),s=t.columnNames.indexOf("yCelestialPoleOffsetRadians"),u=t.columnNames.indexOf("taiMinusUtcSeconds");if(i<0||n<0||r<0||a<0||o<0||s<0||u<0)e._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns";else{var l,c=e._samples=t.samples,m=e._dates=[];e._dateColumn=i,e._xPoleWanderRadiansColumn=n,e._yPoleWanderRadiansColumn=r,e._ut1MinusUtcSecondsColumn=a,e._xCelestialPoleOffsetRadiansColumn=o,e._yCelestialPoleOffsetRadiansColumn=s,e._taiMinusUtcSecondsColumn=u,e._columnCount=t.columnNames.length,e._lastIndex=void 0;for(var d=e._addNewLeapSeconds,h=0,f=c.length;h<f;h+=e._columnCount){var p,_,C,g=c[h+i],v=c[h+u],y=new Dm(g+mm.MODIFIED_JULIAN_DATE_DIFFERENCE,v,dm.TAI);m.push(y),d&&(v===l||!oe(l)||(_=sm(p=Dm.leapSeconds,y,cf))<0&&(C=new cm(y,v),p.splice(~_,0,C)),l=v)}}}else e._dataError="Error in loaded EOP data: The samples property is required.";else e._dataError="Error in loaded EOP data: The columnNames property is required."}function df(e,t,i,n,r){var a=i*n;r.xPoleWander=t[a+e._xPoleWanderRadiansColumn],r.yPoleWander=t[a+e._yPoleWanderRadiansColumn],r.xPoleOffset=t[a+e._xCelestialPoleOffsetRadiansColumn],r.yPoleOffset=t[a+e._yCelestialPoleOffsetRadiansColumn],r.ut1MinusUtc=t[a+e._ut1MinusUtcSecondsColumn]}function hf(e,t,i){return t+e*(i-t)}function ff(e,t,i,n,r,a,o){var s=e._columnCount;if(a>t.length-1)return o.xPoleWander=0,o.yPoleWander=0,o.xPoleOffset=0,o.yPoleOffset=0,o.ut1MinusUtc=0,o;var u=t[r],l=t[a];if(u.equals(l)||n.equals(u))return df(e,i,r,s,o),o;if(n.equals(l))return df(e,i,a,s,o),o;var c,m,d=Dm.secondsDifference(n,u)/Dm.secondsDifference(l,u),h=r*s,f=a*s,p=i[h+e._ut1MinusUtcSecondsColumn],_=i[f+e._ut1MinusUtcSecondsColumn],C=_-p;return!(.5<C||C<-.5)||(c=i[h+e._taiMinusUtcSecondsColumn])!==(m=i[f+e._taiMinusUtcSecondsColumn])&&(l.equals(n)?p=_:_-=m-c),o.xPoleWander=hf(d,i[h+e._xPoleWanderRadiansColumn],i[f+e._xPoleWanderRadiansColumn]),o.yPoleWander=hf(d,i[h+e._yPoleWanderRadiansColumn],i[f+e._yPoleWanderRadiansColumn]),o.xPoleOffset=hf(d,i[h+e._xCelestialPoleOffsetRadiansColumn],i[f+e._xCelestialPoleOffsetRadiansColumn]),o.yPoleOffset=hf(d,i[h+e._yCelestialPoleOffsetRadiansColumn],i[f+e._yCelestialPoleOffsetRadiansColumn]),o.ut1MinusUtc=hf(d,p,_),o}function pf(e,t,i){this.heading=z(e,0),this.pitch=z(t,0),this.roll=z(i,0)}function _f(e,t,i){this.x=e,this.y=t,this.s=i}function Cf(e){e=z(e,z.EMPTY_OBJECT),this._xysFileUrlTemplate=nt.createIfNeeded(e.xysFileUrlTemplate),this._interpolationOrder=z(e.interpolationOrder,9),this._sampleZeroJulianEphemerisDate=z(e.sampleZeroJulianEphemerisDate,2442396.5),this._sampleZeroDateTT=new Dm(this._sampleZeroJulianEphemerisDate,0,dm.TAI),this._stepSizeDays=z(e.stepSizeDays,1),this._samplesPerXysFile=z(e.samplesPerXysFile,1e3),this._totalSamples=z(e.totalSamples,27426),this._samples=new Array(3*this._totalSamples),this._chunkDownloadsInProgress=[];for(var t=this._interpolationOrder,i=this._denominators=new Array(t+1),n=this._xTable=new Array(t+1),r=Math.pow(this._stepSizeDays,t),a=0;a<=t;++a){i[a]=r,n[a]=a*this._stepSizeDays;for(var o=0;o<=t;++o)o!==a&&(i[a]*=a-o);i[a]=1/i[a]}this._work=new Array(t+1),this._coef=new Array(t+1)}lf.NONE=Object.freeze({getPromiseToLoad:function(){return C.resolve()},compute:function(e,t){return oe(t)?(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0):t=new uf(0,0,0,0,0),t}}),lf.prototype.getPromiseToLoad=function(){return C(this._downloadPromise)},lf.prototype.compute=function(e,t){if(oe(this._samples)){if(oe(t)||(t=new uf(0,0,0,0,0)),0===this._samples.length)return t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0,t;var i=this._dates,n=this._lastIndex,r=0,a=0;if(oe(n)){var o=i[n],s=i[n+1],u=Dm.lessThanOrEquals(o,e),l=!oe(s),c=l||Dm.greaterThanOrEquals(s,e);if(u&&c)return r=n,!l&&s.equals(e)&&++r,a=r+1,ff(this,i,this._samples,e,r,a,t),t}var m=sm(i,e,Dm.compare,this._dateColumn);return 0<=m?(m<i.length-1&&i[m+1].equals(e)&&++m,a=r=m):(r=(a=~m)-1)<0&&(r=0),this._lastIndex=r,ff(this,i,this._samples,e,r,a,t),t}if(oe(this._dataError))throw new ue(this._dataError)},pf.fromQuaternion=function(e,t){oe(t)||(t=new pf);var i=2*(e.w*e.y-e.z*e.x),n=1-2*(e.x*e.x+e.y*e.y),r=2*(e.w*e.x+e.y*e.z),a=1-2*(e.y*e.y+e.z*e.z),o=2*(e.w*e.z+e.x*e.y);return t.heading=-Math.atan2(o,a),t.roll=Math.atan2(r,n),t.pitch=-ri.asinClamped(i),t},pf.fromDegrees=function(e,t,i,n){return oe(n)||(n=new pf),n.heading=e*ri.RADIANS_PER_DEGREE,n.pitch=t*ri.RADIANS_PER_DEGREE,n.roll=i*ri.RADIANS_PER_DEGREE,n},pf.clone=function(e,t){if(oe(e))return oe(t)?(t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t):new pf(e.heading,e.pitch,e.roll)},pf.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll},pf.equalsEpsilon=function(e,t,i,n){return e===t||oe(e)&&oe(t)&&ri.equalsEpsilon(e.heading,t.heading,i,n)&&ri.equalsEpsilon(e.pitch,t.pitch,i,n)&&ri.equalsEpsilon(e.roll,t.roll,i,n)},pf.prototype.clone=function(e){return pf.clone(this,e)},pf.prototype.equals=function(e){return pf.equals(this,e)},pf.prototype.equalsEpsilon=function(e,t,i){return pf.equalsEpsilon(this,e,t,i)},pf.prototype.toString=function(){return"("+this.heading+", "+this.pitch+", "+this.roll+")"};var gf=new Dm(0,0,dm.TAI);function vf(e,t,i){var n=gf;return n.dayNumber=t,n.secondsOfDay=i,Dm.daysDifference(n,e._sampleZeroDateTT)}function yf(o,s){if(o._chunkDownloadsInProgress[s])return o._chunkDownloadsInProgress[s];var u=C.defer();o._chunkDownloadsInProgress[s]=u;var e=o._xysFileUrlTemplate;return C((oe(e)?e.getDerivedResource({templateValues:{0:s}}):new nt({url:yt("Assets/IAU2006_XYS/IAU2006_XYS_"+s+".js")})).fetchJson(),function(e){o._chunkDownloadsInProgress[s]=!1;for(var t=o._samples,i=e.samples,n=s*o._samplesPerXysFile*3,r=0,a=i.length;r<a;++r)t[n+r]=i[r];u.resolve()}),u.promise}Cf.prototype.preload=function(e,t,i,n){var r=vf(this,e,t),a=vf(this,i,n),o=r/this._stepSizeDays-this._interpolationOrder/2|0;o<0&&(o=0);var s=a/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;s>=this._totalSamples&&(s=this._totalSamples-1);for(var u=o/this._samplesPerXysFile|0,l=s/this._samplesPerXysFile|0,c=[],m=u;m<=l;++m)c.push(yf(this,m));return C.all(c)},Cf.prototype.computeXysRadians=function(e,t,i){var n=vf(this,e,t);if(!(n<0)){var r=n/this._stepSizeDays|0;if(!(r>=this._totalSamples)){var a=this._interpolationOrder,o=r-(a/2|0);o<0&&(o=0);var s=o+a;s>=this._totalSamples&&(o=(s=this._totalSamples-1)-a)<0&&(o=0);var u=!1,l=this._samples;if(oe(l[3*o])||(yf(this,o/this._samplesPerXysFile|0),u=!0),oe(l[3*s])||(yf(this,s/this._samplesPerXysFile|0),u=!0),!u){oe(i)?(i.x=0,i.y=0,i.s=0):i=new _f(0,0,0);for(var c,m=n-o*this._stepSizeDays,d=this._work,h=this._denominators,f=this._coef,p=this._xTable,_=0;_<=a;++_)d[_]=m-p[_];for(_=0;_<=a;++_){for(f[_]=1,c=0;c<=a;++c)c!==_&&(f[_]*=d[c]);f[_]*=h[_];var C=3*(o+_);i.x+=f[_]*l[C++],i.y+=f[_]*l[C++],i.s+=f[_]*l[C]}return i}}}};var Tf={},xf={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},wf={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Af={},Ef={east:new si,north:new si,up:new si,west:new si,south:new si,down:new si},Sf=new si,bf=new si,Mf=new si;Tf.localFrameToFixedFrameGenerator=function(o,s){if(!xf.hasOwnProperty(o)||!xf[o].hasOwnProperty(s))throw new x("firstAxis and secondAxis must be east, north, up, west, south or down.");var e,u=xf[o][s],t=o+s;return oe(Af[t])?e=Af[t]:(e=function(e,t,i){var n,r,a;return oe(i)||(i=new Rn),si.equalsEpsilon(e,si.ZERO,ri.EPSILON14)?(si.unpack(wf[o],0,Sf),si.unpack(wf[s],0,bf),si.unpack(wf[u],0,Mf)):ri.equalsEpsilon(e.x,0,ri.EPSILON14)&&ri.equalsEpsilon(e.y,0,ri.EPSILON14)?(n=ri.sign(e.z),si.unpack(wf[o],0,Sf),"east"!==o&&"west"!==o&&si.multiplyByScalar(Sf,n,Sf),si.unpack(wf[s],0,bf),"east"!==s&&"west"!==s&&si.multiplyByScalar(bf,n,bf),si.unpack(wf[u],0,Mf),"east"!==u&&"west"!==u&&si.multiplyByScalar(Mf,n,Mf)):((t=z(t,gr.WGS84)).geodeticSurfaceNormal(e,Ef.up),r=Ef.up,(a=Ef.east).x=-e.y,a.y=e.x,a.z=0,si.normalize(a,Ef.east),si.cross(r,a,Ef.north),si.multiplyByScalar(Ef.up,-1,Ef.down),si.multiplyByScalar(Ef.east,-1,Ef.west),si.multiplyByScalar(Ef.north,-1,Ef.south),Sf=Ef[o],bf=Ef[s],Mf=Ef[u]),i[0]=Sf.x,i[1]=Sf.y,i[2]=Sf.z,i[3]=0,i[4]=bf.x,i[5]=bf.y,i[6]=bf.z,i[7]=0,i[8]=Mf.x,i[9]=Mf.y,i[10]=Mf.z,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,i},Af[t]=e),e},Tf.eastNorthUpToFixedFrame=Tf.localFrameToFixedFrameGenerator("east","north"),Tf.northEastDownToFixedFrame=Tf.localFrameToFixedFrameGenerator("north","east"),Tf.northUpEastToFixedFrame=Tf.localFrameToFixedFrameGenerator("north","up"),Tf.northWestUpToFixedFrame=Tf.localFrameToFixedFrameGenerator("north","west");var Rf=new xa,Df=new si(1,1,1),Pf=new Rn;Tf.headingPitchRollToFixedFrame=function(e,t,i,n,r){n=z(n,Tf.eastNorthUpToFixedFrame);var a=xa.fromHeadingPitchRoll(t,Rf),o=Rn.fromTranslationQuaternionRotationScale(si.ZERO,a,Df,Pf);return r=n(e,i,r),Rn.multiply(r,o,r)};var If=new Rn,Of=new pi;Tf.headingPitchRollQuaternion=function(e,t,i,n,r){var a=Tf.headingPitchRollToFixedFrame(e,t,i,n,If),o=Rn.getMatrix3(a,Of);return xa.fromRotationMatrix(o,r)};var Lf=new si(1,1,1),Nf=new si,Bf=new Rn,zf=new Rn,Ff=new pi,Vf=new xa;Tf.fixedFrameToHeadingPitchRoll=function(e,t,i,n){t=z(t,gr.WGS84),i=z(i,Tf.eastNorthUpToFixedFrame),oe(n)||(n=new pf);var r=Rn.getTranslation(e,Nf);if(si.equals(r,si.ZERO))return n.heading=0,n.pitch=0,n.roll=0,n;var a=Rn.inverseTransformation(i(r,t,Bf),Bf),o=Rn.setScale(e,Lf,zf),o=Rn.setTranslation(o,si.ZERO,o),a=Rn.multiply(a,o,a),s=xa.fromRotationMatrix(Rn.getMatrix3(a,Ff),Vf),s=xa.normalize(s,s);return pf.fromQuaternion(s,n)};var Uf=ri.TWO_PI/86400,Gf=new Dm;Tf.computeTemeToPseudoFixedMatrix=function(e,t){var i=(Gf=Dm.addSeconds(e,-Dm.computeTaiMinusUtc(e),Gf)).dayNumber,n=Gf.secondsOfDay,r=i-2451545,a=43200<=n?(.5+r)/mm.DAYS_PER_JULIAN_CENTURY:(r-.5)/mm.DAYS_PER_JULIAN_CENTURY,o=(24110.54841+a*(8640184.812866+a*(.093104+-62e-7*a)))*Uf%ri.TWO_PI+(72921158553e-15+11772758384668e-32*(i-2451545.5))*((n+.5*mm.SECONDS_PER_DAY)%mm.SECONDS_PER_DAY),s=Math.cos(o),u=Math.sin(o);return oe(t)?(t[0]=s,t[1]=-u,t[2]=0,t[3]=u,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new pi(s,u,0,-u,s,0,0,0,1)},Tf.iau2006XysData=new Cf,Tf.earthOrientationParameters=lf.NONE;var kf=32.184;Tf.preloadIcrfFixed=function(e){var t=e.start.dayNumber,i=e.start.secondsOfDay+kf,n=e.stop.dayNumber,r=e.stop.secondsOfDay+kf,a=Tf.iau2006XysData.preload(t,i,n,r),o=Tf.earthOrientationParameters.getPromiseToLoad();return C.all([a,o])},Tf.computeIcrfToFixedMatrix=function(e,t){oe(t)||(t=new pi);var i=Tf.computeFixedToIcrfMatrix(e,t);if(oe(i))return pi.transpose(i,t)};var Hf=new _f(0,0,0),Wf=new uf(0,0,0,0,0),qf=new pi,jf=new pi;Tf.computeFixedToIcrfMatrix=function(e,t){oe(t)||(t=new pi);var i=Tf.earthOrientationParameters.compute(e,Wf);if(oe(i)){var n=e.dayNumber,r=e.secondsOfDay+kf,a=Tf.iau2006XysData.computeXysRadians(n,r,Hf);if(oe(a)){var o=a.x+i.xPoleOffset,s=a.y+i.yPoleOffset,u=1/(1+Math.sqrt(1-o*o-s*s)),l=qf;l[0]=1-u*o*o,l[3]=-u*o*s,l[6]=o,l[1]=-u*o*s,l[4]=1-u*s*s,l[7]=s,l[2]=-o,l[5]=-s,l[8]=1-u*(o*o+s*s);var c=pi.fromRotationZ(-a.s,jf),m=pi.multiply(l,c,qf),d=e.dayNumber-2451545,h=(e.secondsOfDay-Dm.computeTaiMinusUtc(e)+i.ut1MinusUtc)/mm.SECONDS_PER_DAY,f=(f=.779057273264+h+.00273781191135448*(d+h))%1*ri.TWO_PI,p=pi.fromRotationZ(f,jf),_=pi.multiply(m,p,qf),C=Math.cos(i.xPoleWander),g=Math.cos(i.yPoleWander),v=Math.sin(i.xPoleWander),y=Math.sin(i.yPoleWander),T=n-2451545+r/mm.SECONDS_PER_DAY,x=-47e-6*(T/=36525)*ri.RADIANS_PER_DEGREE/3600,w=Math.cos(x),A=Math.sin(x),E=jf;return E[0]=C*w,E[1]=C*A,E[2]=v,E[3]=-g*A+y*v*w,E[4]=g*w+y*v*A,E[5]=-y*C,E[6]=-y*A-g*v*w,E[7]=y*w-g*v*A,E[8]=g*C,pi.multiply(_,E,t)}}};var Yf=new An;Tf.pointToWindowCoordinates=function(e,t,i,n){return(n=Tf.pointToGLWindowCoordinates(e,t,i,n)).y=2*t[5]-n.y,n},Tf.pointToGLWindowCoordinates=function(e,t,i,n){oe(n)||(n=new ha);var r=Yf;return Rn.multiplyByVector(e,An.fromElements(i.x,i.y,i.z,1,r),r),An.multiplyByScalar(r,1/r.w,r),Rn.multiplyByVector(t,r,r),ha.fromCartesian4(r,n)};var Xf=new si,Kf=new si,Zf=new si;Tf.rotationMatrixFromPositionVelocity=function(e,t,i,n){var r=z(i,gr.WGS84).geodeticSurfaceNormal(e,Xf),a=si.cross(t,r,Kf);si.equalsEpsilon(a,si.ZERO,ri.EPSILON6)&&(a=si.clone(si.UNIT_X,a));var o=si.cross(a,t,Zf);return si.normalize(o,o),si.cross(t,o,a),si.negate(a,a),si.normalize(a,a),oe(n)||(n=new pi),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=a.x,n[4]=a.y,n[5]=a.z,n[6]=o.x,n[7]=o.y,n[8]=o.z,n};var Jf=new Rn(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),Qf=new dr,$f=new si,ep=new si,tp=new pi,ip=new Rn,np=new Rn;function rp(e){e=z(e,z.EMPTY_OBJECT),this.attributes=e.attributes,this.indices=e.indices,this.primitiveType=z(e.primitiveType,Yd.TRIANGLES),this.boundingSphere=e.boundingSphere,this.geometryType=z(e.geometryType,sf.NONE),this.boundingSphereCV=e.boundingSphereCV,this.offsetAttribute=e.offsetAttribute}Tf.basisTo2D=function(e,t,i){var n=Rn.getTranslation(t,ep),r=e.ellipsoid,a=r.cartesianToCartographic(n,Qf),o=e.project(a,$f);si.fromElements(o.z,o.x,o.y,o);var s=Tf.eastNorthUpToFixedFrame(n,r,ip),u=Rn.inverseTransformation(s,np),l=Rn.getMatrix3(t,tp),c=Rn.multiplyByMatrix3(u,l,i);return Rn.multiply(Jf,c,i),Rn.setTranslation(i,o,i),i},Tf.wgs84To2DModelMatrix=function(e,t,i){var n=e.ellipsoid,r=Tf.eastNorthUpToFixedFrame(t,n,ip),a=Rn.inverseTransformation(r,np),o=n.cartesianToCartographic(t,Qf),s=e.project(o,$f);si.fromElements(s.z,s.x,s.y,s);var u=Rn.fromTranslation(s,ip);return Rn.multiply(Jf,a,i),Rn.multiply(u,i,i),i},rp.computeNumberOfVertices=function(e){var t,i=-1;for(var n in e.attributes){e.attributes.hasOwnProperty(n)&&oe(e.attributes[n])&&oe(e.attributes[n].values)&&(i=(t=e.attributes[n]).values.length/t.componentsPerAttribute)}return i};var ap=new dr,op=new si,sp=new Rn,up=[new dr,new dr,new dr],lp=[new ha,new ha,new ha],cp=[new ha,new ha,new ha],mp=new si,dp=new xa,hp=new Rn,fp=new va;function pp(e,t,i,n){var r=oe(t.vertexBuffer),a=oe(t.value),o=t.value?t.value.length:t.componentsPerAttribute,s={index:z(t.index,i),enabled:z(t.enabled,!0),vertexBuffer:t.vertexBuffer,value:a?t.value.slice(0):void 0,componentsPerAttribute:o,componentDatatype:z(t.componentDatatype,Ud.FLOAT),normalize:z(t.normalize,!1),offsetInBytes:z(t.offsetInBytes,0),strideInBytes:z(t.strideInBytes,0),instanceDivisor:z(t.instanceDivisor,0)};if(r)s.vertexAttrib=function(e){var t=this.index;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),e.vertexAttribPointer(t,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),e.enableVertexAttribArray(t),0<this.instanceDivisor&&(n.glVertexAttribDivisor(t,this.instanceDivisor),n._vertexAttribDivisors[t]=this.instanceDivisor,n._previousDrawInstanced=!0)},s.disableVertexAttribArray=function(e){e.disableVertexAttribArray(this.index),0<this.instanceDivisor&&n.glVertexAttribDivisor(i,0)};else{switch(s.componentsPerAttribute){case 1:s.vertexAttrib=function(e){e.vertexAttrib1fv(this.index,this.value)};break;case 2:s.vertexAttrib=function(e){e.vertexAttrib2fv(this.index,this.value)};break;case 3:s.vertexAttrib=function(e){e.vertexAttrib3fv(this.index,this.value)};break;case 4:s.vertexAttrib=function(e){e.vertexAttrib4fv(this.index,this.value)}}s.disableVertexAttribArray=function(e){}}e.push(s)}function _p(e,t,i){for(var n=0;n<t.length;++n){var r=t[n];r.enabled&&r.vertexAttrib(e)}oe(i)&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i._getBuffer())}function Cp(e){for(var t,i=(e=z(e,z.EMPTY_OBJECT)).context,n=i._gl,r=e.attributes,a=e.indexBuffer,o=[],s=1,u=!1,l=!1,c=r.length,m=0;m<c;++m)pp(o,r[m],m,i);for(c=o.length,m=0;m<c;++m){var d=o[m];if(oe(d.vertexBuffer)&&0===d.instanceDivisor){var h=d.strideInBytes||d.componentsPerAttribute*Ud.getSizeInBytes(d.componentDatatype),s=d.vertexBuffer.sizeInBytes/h;break}}for(m=0;m<c;++m)0<o[m].instanceDivisor&&(u=!0),oe(o[m].value)&&(l=!0);i.vertexArrayObject&&(t=i.glCreateVertexArray(),i.glBindVertexArray(t),_p(n,o,a),i.glBindVertexArray(null)),this._numberOfVertices=s,this._hasInstancedAttributes=u,this._hasConstantAttributes=l,this._context=i,this._gl=n,this._vao=t,this._attributes=o,this._indexBuffer=a}function gp(e){return e.values.length/e.componentsPerAttribute}function vp(e,t,i,n){var r=vp._verifyAttributes(t);i=z(i,0);for(var a,o,s,u,l=[],c={},m=r.length,d=0;d<m;++d){var h=r[d];h.vertexBuffer?l.push(h):(oe(a=c[o=h.usage])||(a=c[o]=[]),a.push(h))}function f(e,t){return Ud.getSizeInBytes(t.componentDatatype)-Ud.getSizeInBytes(e.componentDatatype)}for(o in this._allBuffers=[],c){c.hasOwnProperty(o)&&((a=c[o]).sort(f),u={vertexSizeInBytes:s=vp._vertexSizeInBytes(a),vertexBuffer:void 0,usage:a[0].usage,needsCommit:!1,arrayBuffer:void 0,arrayViews:vp._createArrayViews(a,s)},this._allBuffers.push(u))}this._size=0,this._instanced=z(n,!1),this._precreated=l,this._context=e,this.writers=void 0,this.va=void 0,this.resize(i)}rp._textureCoordinateRotationPoints=function(e,t,i,n){var r=br.center(n,ap),a=dr.toCartesian(r,i,op),o=Tf.eastNorthUpToFixedFrame(a,i,sp),s=Rn.inverse(o,sp),u=lp,l=up;l[0].longitude=n.west,l[0].latitude=n.south,l[1].longitude=n.west,l[1].latitude=n.north,l[2].longitude=n.east,l[2].latitude=n.south;for(var c=mp,m=0;m<3;m++)dr.toCartesian(l[m],i,c),c=Rn.multiplyByPointAsVector(s,c,c),u[m].x=c.x,u[m].y=c.y;var d=xa.fromAxisAngle(si.UNIT_Z,-t,dp),h=pi.fromQuaternion(d,hp),f=e.length,p=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,g=Number.NEGATIVE_INFINITY;for(m=0;m<f;m++)c=Rn.multiplyByPointAsVector(s,e[m],c),c=pi.multiplyByVector(h,c,c),p=Math.min(p,c.x),_=Math.min(_,c.y),C=Math.max(C,c.x),g=Math.max(g,c.y);var v=va.fromRotation(t,fp),y=cp;y[0].x=p,y[0].y=_,y[1].x=p,y[1].y=g,y[2].x=C,y[2].y=_;var T=u[0],x=u[2].x-T.x,w=u[1].y-T.y;for(m=0;m<3;m++){var A=y[m];va.multiplyByVector(v,A,A),A.x=(A.x-T.x)/x,A.y=(A.y-T.y)/w}var E=y[0],S=y[1],b=y[2],M=new Array(6);return ha.pack(E,M),ha.pack(S,M,2),ha.pack(b,M,4),M},Cp.fromGeometry=function(e){var t,i,n,r,a,o=(e=z(e,z.EMPTY_OBJECT)).context,s=z(e.geometry,z.EMPTY_OBJECT),u=z(e.bufferUsage,Wd.DYNAMIC_DRAW),l=z(e.attributeLocations,z.EMPTY_OBJECT),c=z(e.interleave,!1),m=e.vertexArrayAttributes,d=oe(m)?m:[],h=s.attributes;if(c){var f=function(i){var e,t,n,r=[];for(e in i)i.hasOwnProperty(e)&&oe(i[e])&&oe(i[e].values)&&(r.push(e),i[e].componentDatatype===Ud.DOUBLE&&(i[e].componentDatatype=Ud.FLOAT,i[e].values=Ud.createTypedArray(Ud.FLOAT,i[e].values)));var a=r.length;if(0<a)for(n=gp(i[r[0]]),f=1;f<a;++f){var o=gp(i[r[f]]);if(o!==n)throw new ue("Each attribute list must have the same number of vertices.  Attribute "+r[f]+" has a different number of vertices ("+o.toString()+") than attribute "+r[0]+" ("+n.toString()+").")}r.sort(function(e,t){return Ud.getSizeInBytes(i[t].componentDatatype)-Ud.getSizeInBytes(i[e].componentDatatype)});var s,u=0,l={};for(f=0;f<a;++f)e=r[f],t=i[e],l[e]=u,u+=(s=t,Ud.getSizeInBytes(s.componentDatatype)*s.componentsPerAttribute);if(0<u){var c=Ud.getSizeInBytes(i[r[0]].componentDatatype),m=u%c;0!=m&&(u+=c-m);for(var d=new ArrayBuffer(n*u),h={},f=0;f<a;++f){e=r[f];var p=Ud.getSizeInBytes(i[e].componentDatatype);h[e]={pointer:Ud.createTypedArray(i[e].componentDatatype,d),index:l[e]/p,strideInComponentType:u/p}}for(f=0;f<n;++f)for(var _=0;_<a;++_){e=r[_];for(var C=(t=i[e]).values,g=h[e],v=g.pointer,y=t.componentsPerAttribute,T=0;T<y;++T)v[g.index+T]=C[f*y+T];g.index+=g.strideInComponentType}return{buffer:d,offsetsInBytes:l,vertexSizeInBytes:u}}}(h);if(oe(f)){n=qd.createVertexBuffer({context:o,typedArray:f.buffer,usage:u});var p=f.offsetsInBytes,_=f.vertexSizeInBytes;for(t in h)h.hasOwnProperty(t)&&oe(h[t])&&(oe((i=h[t]).values)?d.push({index:l[t],vertexBuffer:n,componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,offsetInBytes:p[t],strideInBytes:_}):d.push({index:l[t],value:i.value,componentDatatype:i.componentDatatype,normalize:i.normalize}))}}else for(t in h){h.hasOwnProperty(t)&&oe(h[t])&&((r=(i=h[t]).componentDatatype)===Ud.DOUBLE&&(r=Ud.FLOAT),n=void 0,oe(i.values)&&(n=qd.createVertexBuffer({context:o,typedArray:Ud.createTypedArray(r,i.values),usage:u})),d.push({index:l[t],vertexBuffer:n,value:i.value,componentDatatype:r,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize}))}var C=s.indices;return oe(C)&&(a=rp.computeNumberOfVertices(s)>=ri.SIXTY_FOUR_KILOBYTES&&o.elementIndexUint?qd.createIndexBuffer({context:o,typedArray:new Uint32Array(C),usage:u,indexDatatype:kd.UNSIGNED_INT}):qd.createIndexBuffer({context:o,typedArray:new Uint16Array(C),usage:u,indexDatatype:kd.UNSIGNED_SHORT})),new Cp({context:o,attributes:d,indexBuffer:a})},Object.defineProperties(Cp.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}}),Cp.prototype.getAttribute=function(e){return this._attributes[e]},Cp.prototype._bind=function(){oe(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&function(e){var t=e._context,i=e._hasInstancedAttributes;if(i||t._previousDrawInstanced){t._previousDrawInstanced=i;var n=t._vertexAttribDivisors,r=e._attributes,a=gs.maximumVertexAttributes;if(i)for(var o=r.length,s=0;s<o;++s){var u,l,c=r[s];!c.enabled||(u=c.instanceDivisor)!==n[l=c.index]&&(t.glVertexAttribDivisor(l,u),n[l]=u)}else for(s=0;s<a;++s)0<n[s]&&(t.glVertexAttribDivisor(s,0),n[s]=0)}}(this),this._hasConstantAttributes&&function(e,t){for(var i=e._attributes,n=i.length,r=0;r<n;++r){var a=i[r];a.enabled&&oe(a.value)&&a.vertexAttrib(t)}}(this,this._gl)):_p(this._gl,this._attributes,this._indexBuffer)},Cp.prototype._unBind=function(){if(oe(this._vao))this._context.glBindVertexArray(null);else{for(var e=this._attributes,t=this._gl,i=0;i<e.length;++i){var n=e[i];n.enabled&&n.disableVertexAttribArray(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}},Cp.prototype.isDestroyed=function(){return!1},Cp.prototype.destroy=function(){for(var e=this._attributes,t=0;t<e.length;++t){var i=e[t].vertexBuffer;oe(i)&&!i.isDestroyed()&&i.vertexArrayDestroyable&&i.destroy()}var n=this._indexBuffer;return oe(n)&&!n.isDestroyed()&&n.vertexArrayDestroyable&&n.destroy(),oe(this._vao)&&this._context.glDeleteVertexArray(this._vao),Wi(this)},vp._verifyAttributes=function(e){for(var t=[],i=0;i<e.length;++i){var n=e[i],r={index:z(n.index,i),enabled:z(n.enabled,!0),componentsPerAttribute:n.componentsPerAttribute,componentDatatype:z(n.componentDatatype,Ud.FLOAT),normalize:z(n.normalize,!1),vertexBuffer:n.vertexBuffer,usage:z(n.usage,Wd.STATIC_DRAW)};t.push(r)}for(var a=new Array(t.length),o=0;o<t.length;++o){a[t[o].index]=!0}return t},vp._vertexSizeInBytes=function(e){for(var t=0,i=e.length,n=0;n<i;++n){var r=e[n];t+=r.componentsPerAttribute*Ud.getSizeInBytes(r.componentDatatype)}var a=0<i?Ud.getSizeInBytes(e[0].componentDatatype):0,o=0<a?t%a:0;return t+=0==o?0:a-o},vp._createArrayViews=function(e,t){for(var i=[],n=0,r=e.length,a=0;a<r;++a){var o=e[a],s=o.componentDatatype;i.push({index:o.index,enabled:o.enabled,componentsPerAttribute:o.componentsPerAttribute,componentDatatype:s,normalize:o.normalize,offsetInBytes:n,vertexSizeInComponentType:t/Ud.getSizeInBytes(s),view:void 0}),n+=o.componentsPerAttribute*Ud.getSizeInBytes(s)}return i},vp.prototype.resize=function(e){this._size=e;var t=this._allBuffers;this.writers=[];for(var i=0,n=t.length;i<n;++i){var r=t[i];vp._resize(r,this._size),vp._appendWriters(this.writers,r)}wp(this)},vp._resize=function(e,t){if(0<e.vertexSizeInBytes){var i=new ArrayBuffer(t*e.vertexSizeInBytes);if(oe(e.arrayBuffer))for(var n=new Uint8Array(i),r=new Uint8Array(e.arrayBuffer),a=r.length,o=0;o<a;++o)n[o]=r[o];for(var s=e.arrayViews,u=s.length,l=0;l<u;++l){var c=s[l];c.view=Ud.createArrayBufferView(c.componentDatatype,i,c.offsetInBytes)}e.arrayBuffer=i}};var yp=[function(i,n,r){return function(e,t){n[e*r]=t,i.needsCommit=!0}},function(r,a,o){return function(e,t,i){var n=e*o;a[n]=t,a[1+n]=i,r.needsCommit=!0}},function(a,o,s){return function(e,t,i,n){var r=e*s;o[r]=t,o[1+r]=i,o[2+r]=n,a.needsCommit=!0}},function(o,s,u){return function(e,t,i,n,r){var a=e*u;s[a]=t,s[1+a]=i,s[2+a]=n,s[3+a]=r,o.needsCommit=!0}}];function Tp(e,t){if(t.needsCommit&&0<t.vertexSizeInBytes){t.needsCommit=!1;var i=t.vertexBuffer,n=e._size*t.vertexSizeInBytes,r=oe(i);if(!r||i.sizeInBytes<n)return r&&i.destroy(),t.vertexBuffer=qd.createVertexBuffer({context:e._context,typedArray:t.arrayBuffer,usage:t.usage}),!(t.vertexBuffer.vertexArrayDestroyable=!1);t.vertexBuffer.copyFromArrayView(t.arrayBuffer)}return!1}function xp(e,t,i){var n,r;e.needsCommit&&0<e.vertexSizeInBytes&&(n=e.vertexSizeInBytes*t,r=e.vertexSizeInBytes*i,e.vertexBuffer.copyFromArrayView(new Uint8Array(e.arrayBuffer,n,r),n))}function wp(e){var t=e.va;if(oe(t)){for(var i=t.length,n=0;n<i;++n)t[n].va.destroy();e.va=void 0}}vp._appendWriters=function(e,t){for(var i=t.arrayViews,n=i.length,r=0;r<n;++r){var a=i[r];e[a.index]=yp[a.componentsPerAttribute-1](t,a.view,a.vertexSizeInComponentType)}},vp.prototype.commit=function(e){var t,i=!1,n=this._allBuffers;for(l=0,c=n.length;l<c;++l)i=Tp(this,t=n[l])||i;if(i||!oe(this.va)){wp(this);for(var r=this.va=[],a=ri.SIXTY_FOUR_KILOBYTES-4,o=oe(e)&&!this._instanced?Math.ceil(this._size/a):1,s=0;s<o;++s){for(var u=[],l=0,c=n.length;l<c;++l){var m=s*((t=n[l]).vertexSizeInBytes*a);vp._appendAttributes(u,t,m,this._instanced)}u=u.concat(this._precreated),r.push({va:new Cp({context:this._context,attributes:u,indexBuffer:e}),indicesCount:1.5*(s!==o-1?a:this._size%a)})}}},vp._appendAttributes=function(e,t,i,n){for(var r=t.arrayViews,a=r.length,o=0;o<a;++o){var s=r[o];e.push({index:s.index,enabled:s.enabled,componentsPerAttribute:s.componentsPerAttribute,componentDatatype:s.componentDatatype,normalize:s.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:i+s.offsetInBytes,strideInBytes:t.vertexSizeInBytes,instanceDivisor:n?1:0})}},vp.prototype.subCommit=function(e,t){for(var i=this._allBuffers,n=0,r=i.length;n<r;++n)xp(i[n],e,t)},vp.prototype.endSubCommits=function(){for(var e=this._allBuffers,t=0,i=e.length;t<i;++t)e[t].needsCommit=!1},vp.prototype.isDestroyed=function(){return!1},vp.prototype.destroy=function(){for(var e=this._allBuffers,t=0,i=e.length;t<i;++t){var n=e[t];n.vertexBuffer=n.vertexBuffer&&n.vertexBuffer.destroy()}return wp(this),Wi(this)};function Ap(e,t){e=z(e,0),this._near=e,t=z(t,Number.MAX_VALUE),this._far=t}function Ep(e,t,i,n){this.near=z(e,0),this.nearValue=z(t,0),this.far=z(i,1),this.farValue=z(n,0)}Object.defineProperties(Ap.prototype,{near:{get:function(){return this._near},set:function(e){this._near=e}},far:{get:function(){return this._far},set:function(e){this._far=e}}}),Ap.packedLength=2,Ap.pack=function(e,t,i){return i=z(i,0),t[i++]=e.near,t[i]=e.far,t},Ap.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new Ap),i.near=e[t++],i.far=e[t],i},Ap.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.near===t.near&&e.far===t.far},Ap.clone=function(e,t){if(oe(e))return oe(t)||(t=new Ap),t.near=e.near,t.far=e.far,t},Ap.prototype.clone=function(e){return Ap.clone(this,e)},Ap.prototype.equals=function(e){return Ap.equals(this,e)},Ep.clone=function(e,t){if(oe(e))return oe(t)?(t.near=e.near,t.nearValue=e.nearValue,t.far=e.far,t.farValue=e.farValue,t):new Ep(e.near,e.nearValue,e.far,e.farValue)},Ep.packedLength=4,Ep.pack=function(e,t,i){return i=z(i,0),t[i++]=e.near,t[i++]=e.nearValue,t[i++]=e.far,t[i]=e.farValue,t},Ep.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new Ep),i.near=e[t++],i.nearValue=e[t++],i.far=e[t++],i.farValue=e[t],i},Ep.equals=function(e,t){return e===t||oe(e)&&oe(t)&&e.near===t.near&&e.nearValue===t.nearValue&&e.far===t.far&&e.farValue===t.farValue},Ep.prototype.clone=function(e){return Ep.clone(this,e)},Ep.prototype.equals=function(e){return Ep.equals(this,e)};var Sp=Object.freeze({NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2}),bp=Object.freeze({CENTER:0,LEFT:1,RIGHT:-1}),Mp={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(e){return e===Mp.SCENE3D?1:e!==Mp.MORPHING?0:void 0}},Rp=Object.freeze(Mp);function Dp(e){this.planes=z(e,[])}var Pp=[new si,new si,new si];si.clone(si.UNIT_X,Pp[0]),si.clone(si.UNIT_Y,Pp[1]),si.clone(si.UNIT_Z,Pp[2]);var Ip=new si,Op=new si,Lp=new fs(new si(1,0,0),0);function Np(e){e=z(e,z.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=z(e.near,1),this._near=this.near,this.far=z(e.far,5e8),this._far=this.far,this._cullingVolume=new Dp,this._orthographicMatrix=new Rn}function Bp(e){e.top===e._top&&e.bottom===e._bottom&&e.left===e._left&&e.right===e._right&&e.near===e._near&&e.far===e._far||(e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=Rn.computeOrthographicOffCenter(e.left,e.right,e.bottom,e.top,e.near,e.far,e._orthographicMatrix))}Dp.fromBoundingSphere=function(e,t){oe(t)||(t=new Dp);var i=Pp.length,n=t.planes;n.length=2*i;for(var r=e.center,a=e.radius,o=0,s=0;s<i;++s){var u=Pp[s],l=n[o],c=n[o+1];oe(l)||(l=n[o]=new An),oe(c)||(c=n[o+1]=new An),si.multiplyByScalar(u,-a,Ip),si.add(r,Ip,Ip),l.x=u.x,l.y=u.y,l.z=u.z,l.w=-si.dot(u,Ip),si.multiplyByScalar(u,a,Ip),si.add(r,Ip,Ip),c.x=-u.x,c.y=-u.y,c.z=-u.z,c.w=-si.dot(si.negate(u,Op),Ip),o+=2}return t},Dp.prototype.computeVisibility=function(e){for(var t=this.planes,i=!1,n=0,r=t.length;n<r;++n){var a=e.intersectPlane(fs.fromCartesian4(t[n],Lp));if(a===Er.OUTSIDE)return Er.OUTSIDE;a===Er.INTERSECTING&&(i=!0)}return i?Er.INTERSECTING:Er.INSIDE},Dp.prototype.computeVisibilityWithPlaneMask=function(e,t){if(t===Dp.MASK_OUTSIDE||t===Dp.MASK_INSIDE)return t;for(var i=Dp.MASK_INSIDE,n=this.planes,r=0,a=n.length;r<a;++r){var o=r<31?1<<r:0;if(!(r<31&&0==(t&o))){var s=e.intersectPlane(fs.fromCartesian4(n[r],Lp));if(s===Er.OUTSIDE)return Dp.MASK_OUTSIDE;s===Er.INTERSECTING&&(i|=o)}}return i},Dp.MASK_OUTSIDE=4294967295,Dp.MASK_INSIDE=0,Dp.MASK_INDETERMINATE=2147483647,Object.defineProperties(Np.prototype,{projectionMatrix:{get:function(){return Bp(this),this._orthographicMatrix}}});var zp=new si,Fp=new si,Vp=new si,Up=new si;function Gp(e){e=z(e,z.EMPTY_OBJECT),this._offCenterFrustum=new Np,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=z(e.near,1),this._near=this.near,this.far=z(e.far,5e8),this._far=this.far}function kp(e){var t,i=e._offCenterFrustum;e.width===e._width&&e.aspectRatio===e._aspectRatio&&e.near===e._near&&e.far===e._far||(e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far,t=1/e.aspectRatio,i.right=.5*e.width,i.left=-i.right,i.top=t*i.right,i.bottom=-i.top,i.near=e.near,i.far=e.far)}Np.prototype.computeCullingVolume=function(e,t,i){var n=this._cullingVolume.planes,r=this.top,a=this.bottom,o=this.right,s=this.left,u=this.near,l=this.far,c=si.cross(t,i,zp);si.normalize(c,c);var m=Fp;si.multiplyByScalar(t,u,m),si.add(e,m,m);var d=Vp;si.multiplyByScalar(c,s,d),si.add(m,d,d);var h=n[0];return oe(h)||(h=n[0]=new An),h.x=c.x,h.y=c.y,h.z=c.z,h.w=-si.dot(c,d),si.multiplyByScalar(c,o,d),si.add(m,d,d),oe(h=n[1])||(h=n[1]=new An),h.x=-c.x,h.y=-c.y,h.z=-c.z,h.w=-si.dot(si.negate(c,Up),d),si.multiplyByScalar(i,a,d),si.add(m,d,d),oe(h=n[2])||(h=n[2]=new An),h.x=i.x,h.y=i.y,h.z=i.z,h.w=-si.dot(i,d),si.multiplyByScalar(i,r,d),si.add(m,d,d),oe(h=n[3])||(h=n[3]=new An),h.x=-i.x,h.y=-i.y,h.z=-i.z,h.w=-si.dot(si.negate(i,Up),d),oe(h=n[4])||(h=n[4]=new An),h.x=t.x,h.y=t.y,h.z=t.z,h.w=-si.dot(t,m),si.multiplyByScalar(t,l,d),si.add(e,d,d),oe(h=n[5])||(h=n[5]=new An),h.x=-t.x,h.y=-t.y,h.z=-t.z,h.w=-si.dot(si.negate(t,Up),d),this._cullingVolume},Np.prototype.getPixelDimensions=function(e,t,i,n,r){Bp(this);var a=n*(this.right-this.left)/e,o=n*(this.top-this.bottom)/t;return r.x=a,r.y=o,r},Np.prototype.clone=function(e){return oe(e)||(e=new Np),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e},Np.prototype.equals=function(e){return oe(e)&&e instanceof Np&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far},Np.prototype.equalsEpsilon=function(e,t,i){return e===this||oe(e)&&e instanceof Np&&ri.equalsEpsilon(this.right,e.right,t,i)&&ri.equalsEpsilon(this.left,e.left,t,i)&&ri.equalsEpsilon(this.top,e.top,t,i)&&ri.equalsEpsilon(this.bottom,e.bottom,t,i)&&ri.equalsEpsilon(this.near,e.near,t,i)&&ri.equalsEpsilon(this.far,e.far,t,i)},Gp.packedLength=4,Gp.pack=function(e,t,i){return i=z(i,0),t[i++]=e.width,t[i++]=e.aspectRatio,t[i++]=e.near,t[i]=e.far,t},Gp.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new Gp),i.width=e[t++],i.aspectRatio=e[t++],i.near=e[t++],i.far=e[t],i},Object.defineProperties(Gp.prototype,{projectionMatrix:{get:function(){return kp(this),this._offCenterFrustum.projectionMatrix}}}),Gp.prototype.computeCullingVolume=function(e,t,i){return kp(this),this._offCenterFrustum.computeCullingVolume(e,t,i)},Gp.prototype.getPixelDimensions=function(e,t,i,n,r){return kp(this),this._offCenterFrustum.getPixelDimensions(e,t,i,n,r)},Gp.prototype.clone=function(e){return oe(e)||(e=new Gp),e.aspectRatio=this.aspectRatio,e.width=this.width,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._width=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e},Gp.prototype.equals=function(e){return!!(oe(e)&&e instanceof Gp)&&(kp(this),kp(e),this.width===e.width&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))},Gp.prototype.equalsEpsilon=function(e,t,i){return!!(oe(e)&&e instanceof Gp)&&(kp(this),kp(e),ri.equalsEpsilon(this.width,e.width,t,i)&&ri.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,i)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,i))};var Hp={},Wp=new An(0,0,0,1),qp=new An,jp=new Zd,Yp=new ha,Xp=new ha;Hp.wgs84ToWindowCoordinates=function(e,t,i){return Hp.wgs84WithEyeOffsetToWindowCoordinates(e,t,si.ZERO,i)};var Kp=new An,Zp=new si;function Jp(e,t,i,n){var r=i.viewMatrix,a=Rn.multiplyByVector(r,An.fromElements(e.x,e.y,e.z,1,Kp),Kp),o=si.multiplyComponents(t,si.normalize(a,Zp),Zp);return a.x+=t.x+o.x,a.y+=t.y+o.y,a.z+=o.z,Rn.multiplyByVector(i.frustum.projectionMatrix,a,n)}var Qp=new dr(Math.PI,ri.PI_OVER_TWO),$p=new si,e_=new si;Hp.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,i,n){var r=e.frameState,a=Hp.computeActualWgs84Position(r,t,Wp);if(oe(a)){var o=e.canvas,s=jp;s.x=0,s.y=0,s.width=o.clientWidth,s.height=o.clientHeight;var u,l,c,m,d,h,f,p,_,C,g=e.camera,v=!1;if(r.mode===Rp.SCENE2D&&(u=e.mapProjection.project(Qp,$p),l=si.clone(g.position,e_),c=g.frustum.clone(),m=Rn.computeViewportTransformation(s,0,1,new Rn),d=g.frustum.projectionMatrix,h=g.positionWC.y,f=si.fromElements(ri.sign(h)*u.x-h,0,-g.positionWC.x),p=Tf.pointToGLWindowCoordinates(d,m,f),0===h||p.x<=0||p.x>=o.clientWidth?v=!0:(qp=(p.x>.5*o.clientWidth?(s.width=p.x,g.frustum.right=u.x-h,qp=Jp(a,i,g,qp),Hp.clipToGLWindowCoordinates(s,qp,Yp),s.x+=p.x,g.position.x=-g.position.x,_=g.frustum.right,g.frustum.right=-g.frustum.left,g.frustum.left=-_):(s.x+=p.x,s.width-=p.x,g.frustum.left=-u.x-h,qp=Jp(a,i,g,qp),Hp.clipToGLWindowCoordinates(s,qp,Yp),s.x=s.x-s.width,g.position.x=-g.position.x,C=g.frustum.left,g.frustum.left=-g.frustum.right,g.frustum.right=-C),Jp(a,i,g,qp)),Hp.clipToGLWindowCoordinates(s,qp,Xp),si.clone(l,g.position),g.frustum=c.clone(),((n=ha.clone(Yp,n)).x<0||n.x>o.clientWidth)&&(n.x=Xp.x))),r.mode!==Rp.SCENE2D||v){if((qp=Jp(a,i,g,qp)).z<0&&!(g.frustum instanceof Gp)&&!(g.frustum instanceof Np))return;n=Hp.clipToGLWindowCoordinates(s,qp,n)}return n.y=o.clientHeight-n.y,n}},Hp.wgs84ToDrawingBufferCoordinates=function(e,t,i){if(oe(i=Hp.wgs84ToWindowCoordinates(e,t,i)))return Hp.transformWindowToDrawingBuffer(e,i,i)};var t_=new si,i_=new dr;Hp.computeActualWgs84Position=function(e,t,i){var n=e.mode;if(n===Rp.SCENE3D)return si.clone(t,i);var r=e.mapProjection,a=r.ellipsoid.cartesianToCartographic(t,i_);if(oe(a)){if(r.project(a,t_),n===Rp.COLUMBUS_VIEW)return si.fromElements(t_.z,t_.x,t_.y,i);if(n===Rp.SCENE2D)return si.fromElements(0,t_.x,t_.y,i);var o=e.morphTime;return si.fromElements(ri.lerp(t_.z,t.x,o),ri.lerp(t_.x,t.y,o),ri.lerp(t_.y,t.z,o),i)}};var n_=new si,r_=new si,a_=new Rn;Hp.clipToGLWindowCoordinates=function(e,t,i){return si.divideByScalar(t,t.w,n_),Rn.computeViewportTransformation(e,0,1,a_),Rn.multiplyByPoint(a_,n_,r_),ha.fromCartesian3(r_,i)},Hp.transformWindowToDrawingBuffer=function(e,t,i){var n=e.canvas,r=e.drawingBufferWidth/n.clientWidth,a=e.drawingBufferHeight/n.clientHeight;return ha.fromElements(t.x*r,t.y*a,i)};var o_=new An,s_=new An;Hp.drawingBufferToWgs84Coordinates=function(e,t,i,n){var r,a=e.context.uniformState,o=a.currentFrustum,s=o.x,u=o.y;e.frameState.useLogDepth&&(r=i*a.log2FarDepthFromNearPlusOne,i=u*(1-s/(Math.pow(2,r)-1+s))/(u-s));var l,c=e.view.passState.viewport,m=An.clone(An.UNIT_W,o_);m.x=(t.x-c.x)/c.width*2-1,m.y=(t.y-c.y)/c.height*2-1,m.z=2*i-1,m.w=1;var d,h=e.camera.frustum;return oe(h.fovy)?(d=1/(l=Rn.multiplyByVector(a.inverseViewProjection,m,s_)).w,si.multiplyByScalar(l,d,l)):(oe(h._offCenterFrustum)&&(h=h._offCenterFrustum),(l=s_).x=.5*(m.x*(h.right-h.left)+h.left+h.right),l.y=.5*(m.y*(h.top-h.bottom)+h.bottom+h.top),l.z=.5*(m.z*(s-u)-s-u),l.w=1,l=Rn.multiplyByVector(a.inverseView,l,l)),si.fromCartesian4(l,n)};var u_=Object.freeze({CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1});function l_(e,t){var i=(e=z(e,z.EMPTY_OBJECT)).translucencyByDistance,n=e.pixelOffsetScaleByDistance,r=e.scaleByDistance,a=e.distanceDisplayCondition;oe(i)&&(i=Ep.clone(i)),oe(n)&&(n=Ep.clone(n)),oe(r)&&(r=Ep.clone(r)),oe(a)&&(a=Ap.clone(a)),this._dynamicUpdateHeight=z(e.dynamicUpdateHeight,!1),this._show=z(e.show,!0),this._position=si.clone(z(e.position,si.ZERO)),this._actualPosition=si.clone(this._position),this._pixelOffset=ha.clone(z(e.pixelOffset,ha.ZERO)),this._translate=new ha(0,0),this._eyeOffset=si.clone(z(e.eyeOffset,si.ZERO)),this._heightReference=z(e.heightReference,Sp.NONE),this._verticalOrigin=z(e.verticalOrigin,u_.CENTER),this._horizontalOrigin=z(e.horizontalOrigin,bp.CENTER),this._scale=z(e.scale,1),this._color=as.clone(z(e.color,as.WHITE)),this._rotation=z(e.rotation,0),this._alignedAxis=si.clone(z(e.alignedAxis,si.ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=r,this._translucencyByDistance=i,this._pixelOffsetScaleByDistance=n,this._sizeInMeters=z(e.sizeInMeters,!1),this._distanceDisplayCondition=a,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=z(e.collection,t),this._pickId=void 0,this._pickPrimitive=z(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;var o=e.image,s=e.imageId;oe(o)&&(oe(s)||(s="string"==typeof o?o:oe(o.src)?o.src:Ss()),this._imageId=s,this._image=o),oe(e.imageSubRegion)&&(this._imageId=s,this._imageSubRegion=e.imageSubRegion),oe(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=Rp.SCENE3D,this._clusterShow=!0,this._outlineColor=as.clone(z(e.outlineColor,as.BLACK)),this._outlineWidth=z(e.outlineWidth,0),this._animation=z(e.animation,!1),this._updateClamping()}var c_=l_.SHOW_INDEX=0,m_=l_.POSITION_INDEX=1,d_=l_.PIXEL_OFFSET_INDEX=2,h_=l_.EYE_OFFSET_INDEX=3,f_=l_.HORIZONTAL_ORIGIN_INDEX=4,p_=l_.VERTICAL_ORIGIN_INDEX=5,__=l_.SCALE_INDEX=6,C_=l_.IMAGE_INDEX_INDEX=7,g_=l_.COLOR_INDEX=8,v_=l_.ROTATION_INDEX=9,y_=l_.ALIGNED_AXIS_INDEX=10,T_=l_.SCALE_BY_DISTANCE_INDEX=11,x_=l_.TRANSLUCENCY_BY_DISTANCE_INDEX=12,w_=l_.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,A_=l_.DISTANCE_DISPLAY_CONDITION=14,E_=l_.DISABLE_DEPTH_DISTANCE=15;l_.TEXTURE_COORDINATE_BOUNDS=16;var S_=l_.SDF_INDEX=17;function b_(e,t){var i=e._billboardCollection;oe(i)&&(i._updateBillboard(e,t),e._dirty=!0)}l_.NUMBER_OF_PROPERTIES=18,Object.defineProperties(l_.prototype,{show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,b_(this,c_))}},position:{get:function(){return this._position},set:function(e){var t=this._position;si.equals(t,e)||(si.clone(e,t),si.clone(e,this._actualPosition),this._updateClamping(),b_(this,m_))}},heightReference:{get:function(){return this._heightReference},set:function(e){e!==this._heightReference&&(this._heightReference=e,this._updateClamping(),b_(this,m_))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){var t=this._pixelOffset;ha.equals(t,e)||(ha.clone(e,t),b_(this,d_))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){var t=this._scaleByDistance;Ep.equals(t,e)||(this._scaleByDistance=Ep.clone(e,t),b_(this,T_))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){var t=this._translucencyByDistance;Ep.equals(t,e)||(this._translucencyByDistance=Ep.clone(e,t),b_(this,x_))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){var t=this._pixelOffsetScaleByDistance;Ep.equals(t,e)||(this._pixelOffsetScaleByDistance=Ep.clone(e,t),b_(this,w_))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){var t=this._eyeOffset;si.equals(t,e)||(si.clone(e,t),b_(this,h_))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin!==e&&(this._horizontalOrigin=e,b_(this,f_))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin!==e&&(this._verticalOrigin=e,b_(this,p_))}},scale:{get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e,b_(this,__))}},color:{get:function(){return this._color},set:function(e){var t=this._color;as.equals(t,e)||(as.clone(e,t),b_(this,g_))}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,b_(this,v_))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){var t=this._alignedAxis;si.equals(t,e)||(si.clone(e,t),b_(this,y_))}},width:{get:function(){return z(this._width,this._imageWidth)},set:function(e){this._width!==e&&(this._width=e,b_(this,C_))}},height:{get:function(){return z(this._height,this._imageHeight)},set:function(e){this._height!==e&&(this._height=e,b_(this,C_))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){this._sizeInMeters!==e&&(this._sizeInMeters=e,b_(this,g_))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){Ap.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=Ap.clone(e,this._distanceDisplayCondition),b_(this,A_))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,b_(this,E_))}},id:{get:function(){return this._id},set:function(e){this._id=e,oe(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,oe(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){oe(e)?"string"==typeof e?this.setImage(e,e):e instanceof nt?this.setImage(e.url,e):oe(e.src)?this.setImage(e.src,e):this.setImage(Ss(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,b_(this,C_))}},ready:{get:function(){return-1!==this._imageIndex}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=si.clone(e,this._actualClampedPosition),b_(this,m_)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,b_(this,c_))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){var t=this._outlineColor;as.equals(t,e)||(as.clone(e,t),b_(this,S_))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,b_(this,S_))}},animation:{get:function(){return this._animation},set:function(e){this._animation!==e&&(this._animation=e)}}}),l_.prototype.getPickId=function(e){return oe(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId},l_.prototype._updateClamping=function(){l_._updateClamping(this._billboardCollection,this)};var M_=new dr,R_=new si;l_._updateClamping=function(e,i){var t,n,r,a,o,s,u,l=e._scene;function c(e){var t;i._heightReference===Sp.RELATIVE_TO_GROUND&&(i._mode===Rp.SCENE3D?((t=n.cartesianToCartographic(e,M_)).height+=s.height,n.cartographicToCartesian(t,e)):e.x+=s.height),i._clampedPosition=si.clone(e,i._clampedPosition)}oe(l)&&oe(l.globe)&&(t=l.globe,n=t.ellipsoid,r=t._surface,o=(a=l.frameState.mode)!==i._mode,i._mode=a,(i._heightReference===Sp.NONE||o)&&oe(i._removeCallbackFunc)&&(i._removeCallbackFunc(),i._removeCallbackFunc=void 0,i._clampedPosition=void 0),i._heightReference!==Sp.NONE&&oe(i._position)&&(oe(s=n.cartesianToCartographic(i._position))?(oe(i._removeCallbackFunc)&&i._removeCallbackFunc(),i._removeCallbackFunc=r.updateHeight(s,c),dr.clone(s,M_),i._dynamicUpdateHeight||oe(u=t.fastGetHeight(s))&&(M_.height=u),n.cartographicToCartesian(M_,R_),c(R_)):i._actualClampedPosition=void 0))},l_.prototype._loadImage=function(){var e,i,n=this._billboardCollection._textureAtlas,r=this._imageId,a=this._image,o=this._imageSubRegion;oe(a)&&(e=n.addImage(r,a)),oe(o)&&(e=n.addSubRegion(r,o)),oe(this._imageIndexPromise=e)&&(i=this,e.then(function(e){var t;i._imageId===r&&i._image===a&&Zd.equals(i._imageSubRegion,o)&&(t=n.textureCoordinates[e],i._imageWidth=n.texture.width*t.width,i._imageHeight=n.texture.height*t.height,i._imageIndex=e,i._ready=!0,i._imageIndexPromise=void 0,b_(i,C_))}).otherwise(function(e){console.error("Error loading image for billboard: "+e),i._imageIndexPromise=void 0}))},l_.prototype._updateImage=function(){this._billboardCollection._textureAtlas.updateImage(this._imageIndex,this._image)},l_.prototype.setImage=function(e,t){this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,oe(this._billboardCollection._textureAtlas)&&this._loadImage())},l_.prototype.setImageSubRegion=function(e,t){this._imageId===e&&Zd.equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=Zd.clone(t),oe(this._billboardCollection._textureAtlas)&&this._loadImage())},l_.prototype._setTranslate=function(e){var t=this._translate;ha.equals(t,e)||(ha.clone(e,t),b_(this,d_))},l_.prototype._getActualPosition=function(){return oe(this._clampedPosition)?this._clampedPosition:this._actualPosition},l_.prototype._setActualPosition=function(e){oe(this._clampedPosition)||si.clone(e,this._actualPosition),b_(this,m_)};var D_=new An;l_._computeActualPosition=function(e,t,i,n){return oe(e._clampedPosition)?(i.mode!==e._mode&&e._updateClamping(),e._clampedPosition):i.mode===Rp.SCENE3D?t:(Rn.multiplyByPoint(n,t,D_),Hp.computeActualWgs84Position(i,D_))};var P_=new si;l_._computeScreenSpacePosition=function(e,t,i,n,r,a){var o=Rn.multiplyByPoint(e,t,P_),s=Hp.wgs84WithEyeOffsetToWindowCoordinates(r,o,i,a);if(oe(s))return ha.add(s,n,s),s};var I_=new ha(0,0);l_.prototype.computeScreenSpacePosition=function(e,t){var i=this._billboardCollection;oe(t)||(t=new ha),ha.clone(this._pixelOffset,I_),ha.add(I_,this._translate,I_);var n,r,a,o=i.modelMatrix,s=this._position;return oe(this._clampedPosition)&&(s=this._clampedPosition,e.mode!==Rp.SCENE3D&&(r=(n=e.mapProjection).ellipsoid,a=n.unproject(s,M_),s=r.cartographicToCartesian(a,P_),o=Rn.IDENTITY)),l_._computeScreenSpacePosition(o,s,this._eyeOffset,I_,e,t)},l_.getScreenSpaceBoundingBox=function(e,t,i){var n=e.width,r=e.height,a=e.scale;n*=a,r*=a;var o=t.x;e.horizontalOrigin===bp.RIGHT?o-=n:e.horizontalOrigin===bp.CENTER&&(o-=.5*n);var s=t.y;return e.verticalOrigin===u_.BOTTOM||e.verticalOrigin===u_.BASELINE?s-=r:e.verticalOrigin===u_.CENTER&&(s-=.5*r),oe(i)||(i=new Zd),i.x=o,i.y=s,i.width=n,i.height=r,i},l_.prototype.equals=function(e){return this===e||oe(e)&&this._id===e._id&&si.equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&Zd.equals(this._imageSubRegion,e._imageSubRegion)&&as.equals(this._color,e._color)&&ha.equals(this._pixelOffset,e._pixelOffset)&&ha.equals(this._translate,e._translate)&&si.equals(this._eyeOffset,e._eyeOffset)&&Ep.equals(this._scaleByDistance,e._scaleByDistance)&&Ep.equals(this._translucencyByDistance,e._translucencyByDistance)&&Ep.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&Ap.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance},l_.prototype._destroy=function(){oe(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),oe(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0};var O_={ADD:Qa.FUNC_ADD,SUBTRACT:Qa.FUNC_SUBTRACT,REVERSE_SUBTRACT:Qa.FUNC_REVERSE_SUBTRACT,MIN:Qa.MIN,MAX:Qa.MAX},L_=Object.freeze(O_),N_={ZERO:Qa.ZERO,ONE:Qa.ONE,SOURCE_COLOR:Qa.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:Qa.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:Qa.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:Qa.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:Qa.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:Qa.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:Qa.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:Qa.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:Qa.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:Qa.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:Qa.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:Qa.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:Qa.SRC_ALPHA_SATURATE},B_=Object.freeze(N_),z_={DISABLED:Object.freeze({enabled:!1}),ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:L_.ADD,equationAlpha:L_.ADD,functionSourceRgb:B_.SOURCE_ALPHA,functionSourceAlpha:B_.ONE,functionDestinationRgb:B_.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:B_.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:Object.freeze({enabled:!0,equationRgb:L_.ADD,equationAlpha:L_.ADD,functionSourceRgb:B_.ONE,functionSourceAlpha:B_.ONE,functionDestinationRgb:B_.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:B_.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:Object.freeze({enabled:!0,equationRgb:L_.ADD,equationAlpha:L_.ADD,functionSourceRgb:B_.SOURCE_ALPHA,functionSourceAlpha:B_.ONE,functionDestinationRgb:B_.ONE,functionDestinationAlpha:B_.ONE})},F_=Object.freeze(z_),V_=Object.freeze({OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2}),U_=Object.freeze({FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25});function G_(e,t,i){var n=e._gl;n.framebufferTexture2D(n.FRAMEBUFFER,t,i._target,i._texture,0)}function k_(e,t,i){var n=e._gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,t,n.RENDERBUFFER,i._getRenderbuffer())}function H_(e){var t=(e=z(e,z.EMPTY_OBJECT)).context._gl;this._gl=t,this._framebuffer=t.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=void 0,this._depthRenderbuffer=void 0,this._stencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this.destroyAttachments=z(e.destroyAttachments,!0);var i,n,r;oe(e.depthTexture)||oe(e.depthRenderbuffer),oe(e.depthStencilTexture)||oe(e.depthStencilRenderbuffer);if(this._bind(),oe(e.colorTextures))for(var a=e.colorTextures,o=this._colorTextures.length=this._activeColorAttachments.length=a.length,s=0;s<o;++s)i=a[s],G_(this,r=this._gl.COLOR_ATTACHMENT0+s,i),this._activeColorAttachments[s]=r,this._colorTextures[s]=i;if(oe(e.colorRenderbuffers)){var u=e.colorRenderbuffers;for(o=this._colorRenderbuffers.length=this._activeColorAttachments.length=u.length,s=0;s<o;++s)n=u[s],k_(this,r=this._gl.COLOR_ATTACHMENT0+s,n),this._activeColorAttachments[s]=r,this._colorRenderbuffers[s]=n}oe(e.depthTexture)&&(i=e.depthTexture,G_(this,this._gl.DEPTH_ATTACHMENT,i),this._depthTexture=i),oe(e.depthRenderbuffer)&&(n=e.depthRenderbuffer,k_(this,this._gl.DEPTH_ATTACHMENT,n),this._depthRenderbuffer=n),oe(e.stencilRenderbuffer)&&(n=e.stencilRenderbuffer,k_(this,this._gl.STENCIL_ATTACHMENT,n),this._stencilRenderbuffer=n),oe(e.depthStencilTexture)&&(i=e.depthStencilTexture,G_(this,this._gl.DEPTH_STENCIL_ATTACHMENT,i),this._depthStencilTexture=i),oe(e.depthStencilRenderbuffer)&&(n=e.depthStencilRenderbuffer,k_(this,this._gl.DEPTH_STENCIL_ATTACHMENT,n),this._depthStencilRenderbuffer=n),this._unBind()}function W_(e,t,i,n,r){this.bottomLeft=z(e,ha.ZERO),this.topRight=z(t,ha.ZERO),this.childNode1=i,this.childNode2=n,this.imageIndex=r}Object.defineProperties(H_.prototype,{status:{get:function(){this._bind();var e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}}),H_.prototype._bind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer)},H_.prototype._unBind=function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,null)},H_.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments},H_.prototype.getColorTexture=function(e){return this._colorTextures[e]},H_.prototype.getColorRenderbuffer=function(e){return this._colorRenderbuffers[e]},H_.prototype.isDestroyed=function(){return!1},H_.prototype.destroy=function(){if(this.destroyAttachments){for(var e=0,t=this._colorTextures,i=t.length;e<i;++e){var n=t[e];oe(n)&&n.destroy()}for(var r=this._colorRenderbuffers,i=r.length,e=0;e<i;++e){var a=r[e];oe(a)&&a.destroy()}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),Wi(this)};var q_=new ha(16,16);function j_(e){e=z(e,z.EMPTY_OBJECT);var t=z(e.borderWidthInPixels,1),i=z(e.initialSize,q_);this._context=e.context,this._pixelFormat=z(e.pixelFormat,hs.RGBA),this._borderWidthInPixels=t,this._textureCoordinates=[],this._guid=Ss(),this._idHash={},this._initialSize=i,this._root=void 0}function Y_(e,t,i){var n,r,a,o,s,u,l,c,m=function e(t,i,n){if(oe(i)){if(oe(i.childNode1)||oe(i.childNode2))return e(t,i.childNode1,n)||e(t,i.childNode2,n);if(oe(i.imageIndex))return;var r,a,o=i.topRight.x-i.bottomLeft.x,s=i.topRight.y-i.bottomLeft.y,u=o-n.width,l=s-n.height;if(u<0||l<0)return;return 0==u&&0==l?i:(l<u?(i.childNode1=new W_(new ha(i.bottomLeft.x,i.bottomLeft.y),new ha(i.bottomLeft.x+n.width,i.topRight.y)),(r=i.bottomLeft.x+n.width+t._borderWidthInPixels)<i.topRight.x&&(i.childNode2=new W_(new ha(r,i.bottomLeft.y),new ha(i.topRight.x,i.topRight.y)))):(i.childNode1=new W_(new ha(i.bottomLeft.x,i.bottomLeft.y),new ha(i.topRight.x,i.bottomLeft.y+n.height)),(a=i.bottomLeft.y+n.height+t._borderWidthInPixels)<i.topRight.y&&(i.childNode2=new W_(new ha(i.bottomLeft.x,a),new ha(i.topRight.x,i.topRight.y)))),e(t,i.childNode1,n))}}(e,e._root,t);oe(m)?(m.imageIndex=i,n=e._texture.width,r=e._texture.height,a=m.topRight.x-m.bottomLeft.x,o=m.topRight.y-m.bottomLeft.y,s=m.bottomLeft.x/n,u=m.bottomLeft.y/r,l=a/n,c=o/r,e._textureCoordinates[i]=new Zd(s,u,l,c),e._texture.copyFrom(t,m.bottomLeft.x,m.bottomLeft.y)):(function(e,t){var i=e._context,n=e.numberOfImages,r=e._borderWidthInPixels;if(0<n){for(var a=e._texture.width,o=e._texture.height,s=2*(a+t.width+r),u=2*(o+t.height+r),l=a/s,c=o/u,m=new W_(new ha(a+r,r),new ha(s,o)),d=new W_(new ha,new ha(s,o),e._root,m),h=new W_(new ha(r,o+r),new ha(s,u)),f=new W_(new ha,new ha(s,u),d,h),p=0;p<e._textureCoordinates.length;p++){var _=e._textureCoordinates[p];oe(_)&&(_.x*=l,_.y*=c,_.width*=l,_.height*=c)}var C=new Rs({context:e._context,width:s,height:u,pixelFormat:e._pixelFormat}),g=new H_({context:i,colorTextures:[e._texture],destroyAttachments:!1});g._bind(),C.copyFromFramebuffer(0,0,0,0,s,u),g._unBind(),g.destroy(),e._texture=e._texture&&e._texture.destroy(),e._texture=C,e._root=f}else{var v=2*(t.width+2*r),y=2*(t.height+2*r);v<e._initialSize.x&&(v=e._initialSize.x),y<e._initialSize.y&&(y=e._initialSize.y),e._texture=e._texture&&e._texture.destroy(),e._texture=new Rs({context:e._context,width:v,height:y,pixelFormat:e._pixelFormat}),e._root=new W_(new ha(r,r),new ha(v,y))}}(e,t),Y_(e,t,i)),e._guid=Ss()}Object.defineProperties(j_.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return oe(this._texture)||(this._texture=new Rs({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}}),j_.prototype.addImage=function(e,t){if(oe(n=this._idHash[e]))return n;"function"==typeof t?t=t(e):("string"==typeof t||t instanceof nt)&&(t=nt.createIfNeeded(t).fetchImage());var i=this,n=C(t,function(e){if(i.isDestroyed())return-1;var t=i.numberOfImages;return Y_(i,e,t),t});return this._idHash[e]=n},j_.prototype.updateImage=function(e,t){var i=this._textureCoordinates[e],n=this._texture,r=Math.round(i.x*n.width),a=Math.round(i.y*n.height);n.copyFrom(t,r,a)},j_.prototype.addSubRegion=function(e,l){var t=this._idHash[e];if(!oe(t))throw new ue('image with id "'+e+'" not found in the atlas.');var c=this;return C(t,function(e){if(-1===e)return-1;var t=c._texture.width,i=c._texture.height,n=c.numberOfImages,r=c._textureCoordinates[e],a=r.x+l.x/t,o=r.y+l.y/i,s=l.width/t,u=l.height/i;return c._textureCoordinates.push(new Zd(a,o,s,u)),c._guid=Ss(),n})},j_.prototype.isDestroyed=function(){return!1},j_.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Wi(this)};var X_,K_,Z_=l_.SHOW_INDEX,J_=l_.POSITION_INDEX,Q_=l_.PIXEL_OFFSET_INDEX,$_=l_.EYE_OFFSET_INDEX,eC=l_.HORIZONTAL_ORIGIN_INDEX,tC=l_.VERTICAL_ORIGIN_INDEX,iC=l_.SCALE_INDEX,nC=l_.IMAGE_INDEX_INDEX,rC=l_.COLOR_INDEX,aC=l_.ROTATION_INDEX,oC=l_.ALIGNED_AXIS_INDEX,sC=l_.SCALE_BY_DISTANCE_INDEX,uC=l_.TRANSLUCENCY_BY_DISTANCE_INDEX,lC=l_.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,cC=l_.DISTANCE_DISPLAY_CONDITION,mC=l_.DISABLE_DEPTH_DISTANCE,dC=l_.TEXTURE_COORDINATE_BOUNDS,hC=l_.SDF_INDEX,fC=l_.NUMBER_OF_PROPERTIES,pC={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10,sdf:11},_C={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11,sdf:12};function CC(e){e=z(e,z.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(fC),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._baseVolume=new Rr,this._baseVolumeWC=new Rr,this._baseVolume2D=new Rr,this._boundingVolume=new Rr,this._boundingVolumeDirty=!1,this._colorCommands=[],this.modelMatrix=Rn.clone(z(e.modelMatrix,Rn.IDENTITY)),this._modelMatrix=Rn.clone(Rn.IDENTITY),this.debugShowBoundingVolume=z(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=z(e.debugShowTextureAtlas,!1),this.blendOption=z(e.blendOption,V_.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=Rp.SCENE3D,this._buffersUsage=[Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW,Wd.STATIC_DRAW],this._highlightColor=as.clone(as.WHITE);var t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};var i=this._scene;oe(i)&&oe(i.terrainProviderChanged)&&(this._removeCallbackFunc=i.terrainProviderChanged.addEventListener(function(){for(var e=this._billboards,t=e.length,i=0;i<t;++i)oe(e[i])&&e[i]._updateClamping()},this))}function gC(e){for(var t=e.length,i=0;i<t;++i)e[i]&&e[i]._destroy()}function vC(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;for(var t=[],i=e._billboards,n=i.length,r=0,a=0;r<n;++r){var o=i[r];o&&(o._index=a++,t.push(o))}e._billboards=t}}function yC(e){var t=e.cache.billboardCollection_indexBufferBatched;if(oe(t))return t;for(var i=new Uint16Array(98298),n=0,r=0;n<98298;n+=6,r+=4)i[n]=r,i[n+1]=r+1,i[n+2]=r+2,i[n+3]=r+0,i[n+4]=r+2,i[n+5]=r+3;return(t=qd.createIndexBuffer({context:e,typedArray:i,usage:Wd.STATIC_DRAW,indexDatatype:kd.UNSIGNED_SHORT})).vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=t}function TC(e){var t=e.cache.billboardCollection_indexBufferInstanced;return oe(t)?t:((t=qd.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:Wd.STATIC_DRAW,indexDatatype:kd.UNSIGNED_SHORT})).vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t)}function xC(e,t,i,n,r,a){var o,s,u=[{index:X_.positionHighAndScale,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[J_]},{index:X_.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[J_]},{index:X_.compressedAttribute0,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[Q_]},{index:X_.compressedAttribute1,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[uC]},{index:X_.compressedAttribute2,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[rC]},{index:X_.eyeOffset,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[$_]},{index:X_.scaleByDistance,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[sC]},{index:X_.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[lC]},{index:X_.compressedAttribute3,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[cC]},{index:X_.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:Ud.FLOAT,usage:i[dC]}];return n&&u.push({index:X_.direction,componentsPerAttribute:2,componentDatatype:Ud.FLOAT,vertexBuffer:oe(s=(o=e).cache.billboardCollection_vertexBufferInstanced)?s:((s=qd.createVertexBuffer({context:o,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:Wd.STATIC_DRAW})).vertexArrayDestroyable=!1,o.cache.billboardCollection_vertexBufferInstanced=s)}),oe(r)&&u.push({index:X_.a_batchId,componentsPerAttribute:1,componentDatatyps:Ud.FLOAT,bufferUsage:Wd.STATIC_DRAW}),a&&u.push({index:X_.sdf,componentsPerAttribute:2,componentDatatype:Ud.FLOAT,usage:i[hC]}),new vp(e,u,n?t:4*t,n)}Object.defineProperties(CC.prototype,{length:{get:function(){return vC(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}}),CC.prototype.add=function(e){var t=new l_(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t},CC.prototype.remove=function(e){return!!this.contains(e)&&(this._billboards[e._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0)},CC.prototype.resize=function(e){return this.removeAll(),this._billboards=e,this._billboardsRemoved=!0,this._createVertexArray=!0},CC.prototype.removeAll=function(){gC(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0},CC.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]},CC.prototype.contains=function(e){return oe(e)&&e._billboardCollection===this},CC.prototype.get=function(e){return vC(this),this._billboards[e]},CC.prototype.computeNewBuffersUsage=function(){for(var e=this._buffersUsage,t=!1,i=this._propertiesChanged,n=0;n<fC;++n){var r=0===i[n]?Wd.STATIC_DRAW:Wd.STREAM_DRAW,t=t||e[n]!==r;e[n]=r}return t};var wC=new Xn;function AC(e,t,i,n,r){var a,o=n[X_.positionHighAndScale],s=n[X_.positionLowAndRotation],u=r._getActualPosition();e._mode===Rp.SCENE3D&&(Rr.expand(e._baseVolume,u,e._baseVolume),e._boundingVolumeDirty=!0),Xn.fromCartesian(u,wC);var l=r.scale,c=r.rotation;0!==c&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,l);var m=wC.high,d=wC.low;e._instanced?(o(a=r._index,m.x,m.y,m.z,l),s(a,d.x,d.y,d.z,c)):(o((a=4*r._index)+0,m.x,m.y,m.z,l),o(a+1,m.x,m.y,m.z,l),o(a+2,m.x,m.y,m.z,l),o(a+3,m.x,m.y,m.z,l),s(a+0,d.x,d.y,d.z,c),s(a+1,d.x,d.y,d.z,c),s(a+2,d.x,d.y,d.z,c),s(a+3,d.x,d.y,d.z,c))}var EC=new ha,SC=32768,bC=65536,MC=4096,RC=256,DC=128,PC=32,IC=8,OC=4,LC=1/256,NC=0,BC=2,zC=3,FC=1;function VC(e,t,i,n,r){var a,o=n[X_.compressedAttribute0],s=r.pixelOffset,u=s.x,l=s.y,c=r._translate,m=c.x,d=c.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(u+m),Math.abs(-l+d));var h=r.horizontalOrigin,f=r._verticalOrigin,p=r.show&&r.clusterShow;0===r.color.alpha&&(p=!1),f===u_.BASELINE&&(f=u_.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&h===bp.CENTER,e._allVerticalCenter=e._allVerticalCenter&&f===u_.CENTER;var _,C=0,g=0,v=0,y=0,T=r._imageIndex;-1!==T&&(C=(_=i[T]).x,g=_.y,v=_.width,y=_.height);var x=C+v,w=g+y,A=Math.floor(ri.clamp(u,-SC,SC)+SC)*DC;A+=(h+1)*PC,A+=(f+1)*IC,A+=(p?1:0)*OC;var E=Math.floor(ri.clamp(l,-SC,SC)+SC)*RC,S=Math.floor(ri.clamp(m,-SC,SC)+SC)*RC,b=(ri.clamp(d,-SC,SC)+SC)*LC,M=Math.floor(b);E+=M,S+=Math.floor((b-M)*RC),EC.x=C,EC.y=g;var R=Xo.compressTextureCoordinates(EC);EC.x=x;var D=Xo.compressTextureCoordinates(EC);EC.y=w;var P=Xo.compressTextureCoordinates(EC);EC.x=C;var I=Xo.compressTextureCoordinates(EC);e._instanced?o(a=r._index,A,E,S,R):(o((a=4*r._index)+0,A+NC,E,S,R),o(a+1,A+BC,E,S,D),o(a+2,A+zC,E,S,P),o(a+3,A+FC,E,S,I))}function UC(e,t,i,n,r){var a,o=n[X_.compressedAttribute1],s=r.alignedAxis;si.equals(s,si.ZERO)||(e._shaderAlignedAxis=!0);var u=0,l=1,c=1,m=1,d=r.translucencyByDistance;oe(d)&&(u=d.near,l=d.nearValue,c=d.far,m=d.farValue,1===l&&1===m||(e._shaderTranslucencyByDistance=!0));var h=0,f=r._imageIndex;-1!==f&&(h=i[f].width);var p=e._textureAtlas.texture.width,_=Math.round(z(r.width,p*h));e._maxSize=Math.max(e._maxSize,_);var C=ri.clamp(_,0,bC),g=0;Math.abs(si.magnitudeSquared(s)-1)<ri.EPSILON6&&(g=Xo.octEncodeFloat(s)),l=ri.clamp(l,0,1),C=C*RC+(l=1===l?255:255*l|0),m=ri.clamp(m,0,1),g=g*RC+(m=1===m?255:255*m|0),e._instanced?o(a=r._index,C,g,u,c):(o((a=4*r._index)+0,C,g,u,c),o(a+1,C,g,u,c),o(a+2,C,g,u,c),o(a+3,C,g,u,c))}function GC(e,t,i,n,r){var a,o=n[X_.compressedAttribute2],s=r.color,u=oe(e._batchTable)?as.WHITE:r.getPickId(t).color,l=r.sizeInMeters?1:0,c=Math.abs(si.magnitudeSquared(r.alignedAxis)-1)<ri.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&1==l;var m=0,d=r._imageIndex;-1!==d&&(m=i[d].height);var h=e._textureAtlas.texture.dimensions,f=Math.round(z(r.height,h.y*m));e._maxSize=Math.max(e._maxSize,f);var p=z(r._labelHorizontalOrigin,-2),_=f*OC+(p+=2),C=as.floatToByte(s.red),g=as.floatToByte(s.green),v=as.floatToByte(s.blue),y=C*bC+g*RC+v,C=as.floatToByte(u.red),g=as.floatToByte(u.green),v=as.floatToByte(u.blue),T=C*bC+g*RC+v,x=as.floatToByte(s.alpha)*bC+as.floatToByte(u.alpha)*RC;x+=2*l+c,e._instanced?o(a=r._index,y,T,x,_):(o((a=4*r._index)+0,y,T,x,_),o(a+1,y,T,x,_),o(a+2,y,T,x,_),o(a+3,y,T,x,_))}function kC(e,t,i,n,r){var a,o,s,u,l,c,m=n[X_.eyeOffset],d=r.eyeOffset,h=d.z;r._heightReference!==Sp.NONE&&(h*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(d.x),Math.abs(d.y),Math.abs(h)),e._instanced?(u=s=0,-1!==(a=r._imageIndex)&&(s=(o=i[a]).width,u=o.height),EC.x=s,EC.y=u,l=Xo.compressTextureCoordinates(EC),m(c=r._index,d.x,d.y,h,l)):(m((c=4*r._index)+0,d.x,d.y,h,0),m(c+1,d.x,d.y,h,0),m(c+2,d.x,d.y,h,0),m(c+3,d.x,d.y,h,0))}function HC(e,t,i,n,r){var a,o=n[X_.scaleByDistance],s=0,u=1,l=1,c=1,m=r.scaleByDistance;oe(m)&&(s=m.near,u=m.nearValue,l=m.far,c=m.farValue,1===u&&1===c||(e._shaderScaleByDistance=!0)),e._instanced?o(a=r._index,s,u,l,c):(o((a=4*r._index)+0,s,u,l,c),o(a+1,s,u,l,c),o(a+2,s,u,l,c),o(a+3,s,u,l,c))}function WC(e,t,i,n,r){var a,o=n[X_.pixelOffsetScaleByDistance],s=0,u=1,l=1,c=1,m=r.pixelOffsetScaleByDistance;oe(m)&&(s=m.near,u=m.nearValue,l=m.far,c=m.farValue,1===u&&1===c||(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?o(a=r._index,s,u,l,c):(o((a=4*r._index)+0,s,u,l,c),o(a+1,s,u,l,c),o(a+2,s,u,l,c),o(a+3,s,u,l,c))}function qC(e,t,i,n,r){var a,o=n[X_.compressedAttribute3],s=0,u=Number.MAX_VALUE,l=r.distanceDisplayCondition;oe(l)&&(s=l.near,u=l.far,s*=s,u*=u,e._shaderDistanceDisplayCondition=!0);var c,m,d,h,f,p,_,C=r.disableDepthTestDistance,g=r.heightReference===Sp.CLAMP_TO_GROUND&&e._scene.context.depthTexture;oe(C)||(C=g?5e3:0),C*=C,(g||0<C)&&(e._shaderDisableDepthDistance=!0,C===Number.POSITIVE_INFINITY&&(C=-1)),oe(r._labelDimensions)?(_=r._labelDimensions.x,c=r._labelDimensions.y):(f=h=0,-1!==(m=r._imageIndex)&&(h=(d=i[m]).height,f=d.width),c=Math.round(z(r.height,e._textureAtlas.texture.dimensions.y*h)),p=e._textureAtlas.texture.width,_=Math.round(z(r.width,p*f)));var v=Math.floor(ri.clamp(_,0,MC)),y=Math.floor(ri.clamp(c,0,MC)),T=v*MC+y;e._instanced?o(a=r._index,s,u,C,T):(o((a=4*r._index)+0,s,u,C,T),o(a+1,s,u,C,T),o(a+2,s,u,C,T),o(a+3,s,u,C,T))}function jC(e,t,i,n,r){var a;r.heightReference===Sp.CLAMP_TO_GROUND&&(e._shaderClampToGround=e._scene.context.depthTexture);var o=n[X_.textureCoordinateBoundsOrLabelTranslate];if(0<gs.maximumVertexTextureImageUnits){var s=0,u=0;return oe(r._labelTranslate)&&(s=r._labelTranslate.x,u=r._labelTranslate.y),void(e._instanced?o(a=r._index,s,u,0,0):(o((a=4*r._index)+0,s,u,0,0),o(a+1,s,u,0,0),o(a+2,s,u,0,0),o(a+3,s,u,0,0)))}var l,c=0,m=0,d=0,h=0,f=r._imageIndex;-1!==f&&(c=(l=i[f]).x,m=l.y,d=l.width,h=l.height);var p=c+d,_=m+h;e._instanced?o(a=r._index,c,m,p,_):(o((a=4*r._index)+0,c,m,p,_),o(a+1,c,m,p,_),o(a+2,c,m,p,_),o(a+3,c,m,p,_))}function YC(e,t,i,n,r){var a,o,s,u,l,c,m,d,h,f;e._sdf&&(o=n[X_.sdf],s=r.outlineColor,u=r.outlineWidth,l=as.floatToByte(s.red),c=as.floatToByte(s.green),m=as.floatToByte(s.blue),d=l*bC+c*RC+m,h=u/U_.RADIUS,f=as.floatToByte(s.alpha)*bC+as.floatToByte(h)*RC,e._instanced?o(a=r._index,d,f):(o((a=4*r._index)+0,d+NC,f),o(a+1,d+BC,f),o(a+2,d+zC,f),o(a+3,d+FC,f)))}function XC(e,t,i,n,r){var a,o,s,u,l,c;AC(e,0,0,n,r),VC(e,0,i,n,r),UC(e,0,i,n,r),GC(e,t,i,n,r),kC(e,0,i,n,r),HC(e,0,0,n,r),WC(e,0,0,n,r),qC(e,0,i,n,r),jC(e,0,i,n,r),o=n,s=r,oe((a=e)._batchTable)&&(u=o[X_.a_batchId],l=s._batchIndex,a._instanced?u(c=s._index,l):(u((c=4*s._index)+0,l),u(c+1,l),u(c+2,l),u(c+3,l))),YC(e,0,0,n,r)}function KC(e,t,i,n,r,a){var o;n.mode===Rp.SCENE3D?(o=e._baseVolume,e._boundingVolumeDirty=!0):o=e._baseVolume2D;for(var s=[],u=0;u<i;++u){var l=t[u],c=l.position,m=l_._computeActualPosition(l,c,n,r);oe(m)&&(l._setActualPosition(m),a?s.push(m):Rr.expand(o,m,o))}a&&Rr.fromPoints(s,o)}var ZC=[];CC.prototype.update=function(e){vC(this);var t=this._billboards,i=t.length,n=e.context;this._instanced=n.instancedArrays,X_=this._instanced?_C:pC,K_=this._instanced?TC:yC;var r=this._textureAtlas;if(oe(r))for(a=0;a<i;++a){(T=t[a]).animation&&T.ready&&T._updateImage()}else{r=this._textureAtlas=new j_({context:n});for(var a=0;a<i;++a)t[a]._loadImage()}var o,s,u,l,c,m,d=r.textureCoordinates;if(0!==d.length){o=this,u=(s=e).mode,l=o._billboards,c=o._billboardsToUpdate,m=o._modelMatrix,o._createVertexArray||o._mode!==u||u!==Rp.SCENE3D&&!Rn.equals(m,o.modelMatrix)?(o._mode=u,Rn.clone(o.modelMatrix,m),o._createVertexArray=!0,u!==Rp.SCENE3D&&u!==Rp.SCENE2D&&u!==Rp.COLUMBUS_VIEW||KC(o,l,l.length,s,m,!0)):u===Rp.MORPHING?KC(o,l,l.length,s,m,!0):u!==Rp.SCENE2D&&u!==Rp.COLUMBUS_VIEW||KC(o,c,o._billboardsToUpdateIndex,s,m,!1),i=(t=this._billboards).length;var h=this._billboardsToUpdate,f=this._billboardsToUpdateIndex,p=this._propertiesChanged,_=r.guid,C=this._createVertexArray||this._textureAtlasGUID!==_;this._textureAtlasGUID=_;var g=e.passes,v=g.pick;if(C||!v&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(var y=0;y<fC;++y)p[y]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),0<i){this._vaf=xC(n,i,this._buffersUsage,this._instanced,this._batchTable,this._sdf),E=this._vaf.writers;for(var T,x=0;x<i;++x){(T=this._billboards[x])._dirty=!1,XC(this,n,d,E,T)}this._vaf.commit(K_(n))}this._billboardsToUpdateIndex=0}else if(0<f){var w=ZC;w.length=0,(p[J_]||p[aC]||p[iC])&&w.push(AC),(p[nC]||p[Q_]||p[eC]||p[tC]||p[Z_])&&(w.push(VC),this._instanced&&w.push(kC)),(p[nC]||p[oC]||p[uC])&&(w.push(UC),w.push(GC)),(p[nC]||p[rC])&&w.push(GC),p[$_]&&w.push(kC),p[sC]&&w.push(HC),p[lC]&&w.push(WC),(p[cC]||p[mC]||p[nC]||p[J_])&&w.push(qC),(p[nC]||p[J_])&&w.push(jC),p[hC]&&w.push(YC);var A=w.length,E=this._vaf.writers;if(.1<f/i){for(var S=0;S<f;++S){var b=h[S];b._dirty=!1;for(var M=0;M<A;++M)w[M](this,n,d,E,b)}this._vaf.commit(K_(n))}else{for(var R=0;R<f;++R){var D=h[R];D._dirty=!1;for(var P=0;P<A;++P)w[P](this,n,d,E,D);this._instanced?this._vaf.subCommit(D._index,1):this._vaf.subCommit(4*D._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(1.5*i<f&&(h.length=i),oe(this._vaf)&&oe(this._vaf.va)){this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,Rr.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));var I,O=Rn.IDENTITY;(function(e,t,i){var n=1;e._allSizedInMeters&&0===e._maxPixelOffset||(n=t.camera.getPixelSize(i,t.context.drawingBufferWidth,t.context.drawingBufferHeight));var r=n*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(r*=.5);var a=n*e._maxPixelOffset+e._maxEyeOffset;i.radius+=r+a})(this,e,I=e.mode===Rp.SCENE3D?(O=this.modelMatrix,Rr.clone(this._baseVolumeWC,this._boundingVolume)):Rr.clone(this._baseVolume2D,this._boundingVolume));var L,N,B,z,F,V,U=this._blendOption!==this.blendOption;this._blendOption=this.blendOption,U&&(this._blendOption===V_.OPAQUE||this._blendOption===V_.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=ih.fromCache({depthTest:{enabled:!0,func:Qa.LESS},depthMask:!0}):this._rsOpaque=void 0,L=this._blendOption===V_.TRANSLUCENT,this._blendOption===V_.TRANSLUCENT||this._blendOption===V_.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=ih.fromCache({depthTest:{enabled:!0,func:L?Qa.LEQUAL:Qa.LESS},depthMask:L,blending:F_.ALPHA_BLEND}):this._rsTranslucent=void 0),this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==e.minimumDisableDepthTestDistance;var G,k,H=0<gs.maximumVertexTextureImageUnits;!U&&this._shaderRotation===this._compiledShaderRotation&&this._shaderAlignedAxis===this._compiledShaderAlignedAxis&&this._shaderScaleByDistance===this._compiledShaderScaleByDistance&&this._shaderTranslucencyByDistance===this._compiledShaderTranslucencyByDistance&&this._shaderPixelOffsetScaleByDistance===this._compiledShaderPixelOffsetScaleByDistance&&this._shaderDistanceDisplayCondition===this._compiledShaderDistanceDisplayCondition&&this._shaderDisableDepthDistance===this._compiledShaderDisableDepthDistance&&this._shaderClampToGround===this._compiledShaderClampToGround&&this._sdf===this._compiledSDF||(N="#ifdef INSTANCED\nattribute vec2 direction;\n#endif\nattribute vec4 positionHighAndScale;\nattribute vec4 positionLowAndRotation;\nattribute vec4 compressedAttribute0;\nattribute vec4 compressedAttribute1;\nattribute vec4 compressedAttribute2;\nattribute vec4 eyeOffset;\nattribute vec4 scaleByDistance;\nattribute vec4 pixelOffsetScaleByDistance;\nattribute vec4 compressedAttribute3;\nattribute vec2 sdf;\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\nattribute vec4 textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef VECTOR_TILE\nattribute float a_batchId;\n#endif\nvarying vec2 v_textureCoordinates;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\n#endif\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\nconst float UPPER_BOUND = 32768.0;\nconst float SHIFT_LEFT16 = 65536.0;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT8 = 256.0;\nconst float SHIFT_LEFT7 = 128.0;\nconst float SHIFT_LEFT5 = 32.0;\nconst float SHIFT_LEFT3 = 8.0;\nconst float SHIFT_LEFT2 = 4.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT8 = 1.0 / 256.0;\nconst float SHIFT_RIGHT7 = 1.0 / 128.0;\nconst float SHIFT_RIGHT5 = 1.0 / 32.0;\nconst float SHIFT_RIGHT3 = 1.0 / 8.0;\nconst float SHIFT_RIGHT2 = 1.0 / 4.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nvec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)\n{\nvec2 halfSize = imageSize * scale * 0.5;\nhalfSize *= ((direction * 2.0) - 1.0);\nvec2 originTranslate = origin * abs(halfSize);\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nif (validAlignedAxis || rotation != 0.0)\n{\nfloat angle = rotation;\nif (validAlignedAxis)\n{\nvec4 projectedAlignedAxis = czm_modelViewProjection * vec4(alignedAxis, 0.0);\nangle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /\n(projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));\n}\nfloat cosTheta = cos(angle);\nfloat sinTheta = sin(angle);\nrotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);\nhalfSize = rotationMatrix * halfSize;\n}\nelse\n{\nrotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n}\n#endif\nmpp = czm_metersPerPixel(positionEC);\npositionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);\npositionEC.xy += (translate + pixelOffset) * mpp;\nreturn positionEC;\n}\n#ifdef VERTEX_DEPTH_CHECK\nfloat getGlobeDepth(vec4 positionEC)\n{\nvec4 posWC = czm_eyeToWindowCoordinates(positionEC);\nfloat globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));\nif (globeDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(posWC.xy, globeDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\nvec3 positionHigh = positionHighAndScale.xyz;\nvec3 positionLow = positionLowAndRotation.xyz;\nfloat scale = positionHighAndScale.w;\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nfloat rotation = positionLowAndRotation.w;\n#else\nfloat rotation = 0.0;\n#endif\nfloat compressed = compressedAttribute0.x;\nvec2 pixelOffset;\npixelOffset.x = floor(compressed * SHIFT_RIGHT7);\ncompressed -= pixelOffset.x * SHIFT_LEFT7;\npixelOffset.x -= UPPER_BOUND;\nvec2 origin;\norigin.x = floor(compressed * SHIFT_RIGHT5);\ncompressed -= origin.x * SHIFT_LEFT5;\norigin.y = floor(compressed * SHIFT_RIGHT3);\ncompressed -= origin.y * SHIFT_LEFT3;\n#ifdef FRAGMENT_DEPTH_CHECK\nvec2 depthOrigin = origin.xy;\n#endif\norigin -= vec2(1.0);\nfloat show = floor(compressed * SHIFT_RIGHT2);\ncompressed -= show * SHIFT_LEFT2;\n#ifdef INSTANCED\nvec2 textureCoordinatesBottomLeft = czm_decompressTextureCoordinates(compressedAttribute0.w);\nvec2 textureCoordinatesRange = czm_decompressTextureCoordinates(eyeOffset.w);\nvec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;\n#else\nvec2 direction;\ndirection.x = floor(compressed * SHIFT_RIGHT1);\ndirection.y = compressed - direction.x * SHIFT_LEFT1;\nvec2 textureCoordinates = czm_decompressTextureCoordinates(compressedAttribute0.w);\n#endif\nfloat temp = compressedAttribute0.y  * SHIFT_RIGHT8;\npixelOffset.y = -(floor(temp) - UPPER_BOUND);\nvec2 translate;\ntranslate.y = (temp - floor(temp)) * SHIFT_LEFT16;\ntemp = compressedAttribute0.z * SHIFT_RIGHT8;\ntranslate.x = floor(temp) - UPPER_BOUND;\ntranslate.y += (temp - floor(temp)) * SHIFT_LEFT8;\ntranslate.y -= UPPER_BOUND;\ntemp = compressedAttribute1.x * SHIFT_RIGHT8;\nfloat temp2 = floor(compressedAttribute2.w * SHIFT_RIGHT2);\nvec2 imageSize = vec2(floor(temp), temp2);\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat labelHorizontalOrigin = floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));\nfloat applyTranslate = 0.0;\nif (labelHorizontalOrigin != 0.0)\n{\napplyTranslate = 1.0;\nlabelHorizontalOrigin -= 2.0;\ndepthOrigin.x = labelHorizontalOrigin + 1.0;\n}\ndepthOrigin = vec2(1.0) - (depthOrigin * 0.5);\n#endif\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;\ntranslucencyByDistance.x = compressedAttribute1.z;\ntranslucencyByDistance.z = compressedAttribute1.w;\ntranslucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\ntemp = compressedAttribute1.y * SHIFT_RIGHT8;\ntranslucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\ntemp = compressedAttribute3.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\n#endif\n#ifdef ALIGNED_AXIS\nvec3 alignedAxis = czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));\ntemp = compressedAttribute2.z * SHIFT_RIGHT5;\nbool validAlignedAxis = (temp - floor(temp)) * SHIFT_LEFT1 > 0.0;\n#else\nvec3 alignedAxis = vec3(0.0);\nbool validAlignedAxis = false;\n#endif\nvec4 pickColor;\nvec4 color;\ntemp = compressedAttribute2.y;\ntemp = temp * SHIFT_RIGHT8;\npickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor.r = floor(temp);\ntemp = compressedAttribute2.x;\ntemp = temp * SHIFT_RIGHT8;\ncolor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\ncolor.g = (temp - floor(temp)) * SHIFT_LEFT8;\ncolor.r = floor(temp);\ntemp = compressedAttribute2.z * SHIFT_RIGHT8;\nbool sizeInMeters = floor((temp - floor(temp)) * SHIFT_LEFT7) > 0.0;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor /= 255.0;\ncolor.a = floor(temp);\ncolor /= 255.0;\nvec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\nvec4 positionEC = czm_modelViewRelativeToEye * p;\n#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)\nfloat eyeDepth = positionEC.z;\n#endif\npositionEC = czm_eyeOffset(positionEC, eyeOffset.xyz);\npositionEC.xyz *= show;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq = dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef EYE_DISTANCE_SCALING\nfloat distanceScale = czm_nearFarScalar(scaleByDistance, lengthSq);\nscale *= distanceScale;\ntranslate *= distanceScale;\nif (scale == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nfloat translucency = 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency = czm_nearFarScalar(translucencyByDistance, lengthSq);\nif (translucency == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\n#ifdef EYE_DISTANCE_PIXEL_OFFSET\nfloat pixelOffsetScale = czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);\npixelOffset *= pixelOffsetScale;\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq = compressedAttribute3.x;\nfloat farSq = compressedAttribute3.y;\nif (lengthSq < nearSq || lengthSq > farSq)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nmat2 rotationMatrix;\nfloat mpp;\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance = compressedAttribute3.z;\n#endif\n#ifdef VERTEX_DEPTH_CHECK\nif (lengthSq < disableDepthTestDistance) {\nfloat depthsilon = 10.0;\nvec2 labelTranslate = textureCoordinateBoundsOrLabelTranslate.xy;\nvec4 pEC1 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth1 = getGlobeDepth(pEC1);\nif (globeDepth1 != 0.0 && pEC1.z + depthsilon < globeDepth1)\n{\nvec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth2 = getGlobeDepth(pEC2);\nif (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2)\n{\nvec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth3 = getGlobeDepth(pEC3);\nif (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3)\n{\npositionEC.xyz = vec3(0.0);\n}\n}\n}\n}\n#endif\npositionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\ngl_Position = czm_projection * positionEC;\nv_textureCoordinates = textureCoordinates;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth();\n#endif\n#ifdef DISABLE_DEPTH_DISTANCE\nif (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)\n{\ndisableDepthTestDistance = czm_minimumDisableDepthTestDistance;\n}\nif (disableDepthTestDistance != 0.0)\n{\nfloat zclip = gl_Position.z / gl_Position.w;\nbool clipped = (zclip < -1.0 || zclip > 1.0);\nif (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))\n{\ngl_Position.z = -gl_Position.w;\n#ifdef LOG_DEPTH\nv_depthFromNearPlusOne = 1.0;\n#endif\n}\n}\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nif (sizeInMeters) {\ntranslate /= mpp;\ndimensions /= mpp;\nimageSize /= mpp;\n}\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nv_rotationMatrix = rotationMatrix;\n#else\nv_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n#endif\nfloat enableDepthCheck = 0.0;\nif (lengthSq < disableDepthTestDistance)\n{\nenableDepthCheck = 1.0;\n}\nfloat dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));\nfloat dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));\nfloat iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));\nfloat ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));\nv_compressed.x = eyeDepth;\nv_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck;\nv_compressed.z = dw * SHIFT_LEFT12 + dh;\nv_compressed.w = iw * SHIFT_LEFT12 + ih;\nv_originTextureCoordinateAndTranslate.xy = depthOrigin;\nv_originTextureCoordinateAndTranslate.zw = translate;\nv_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef SDF\nvec4 outlineColor;\nfloat outlineWidth;\ntemp = sdf.x;\ntemp = temp * SHIFT_RIGHT8;\noutlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.r = floor(temp);\ntemp = sdf.y;\ntemp = temp * SHIFT_RIGHT8;\nfloat temp3 = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineWidth = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.a = floor(temp);\noutlineColor /= 255.0;\nv_outlineWidth = outlineWidth / 255.0;\nv_outlineColor = outlineColor;\n#endif\nv_pickColor = pickColor;\nv_color = color;\nv_color.a *= translucency;\n}\n",B="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform sampler2D u_atlas;\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_textureCoordinates;\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef SDF\nvarying vec4 v_outlineColor;\nvarying float v_outlineWidth;\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nfloat getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)\n{\nvec2 lookupVector = imageSize * (depthLookupST - adjustedST);\nlookupVector = v_rotationMatrix * lookupVector;\nvec2 labelOffset = (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y));\nvec2 translation = v_originTextureCoordinateAndTranslate.zw;\nif (applyTranslate)\n{\ntranslation += (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));\n}\nvec2 st = ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;\nfloat logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st));\nif (logDepthOrDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\n#ifdef SDF\nfloat getDistance(vec2 position)\n{\nreturn texture2D(u_atlas, position).r;\n}\nvec4 getSDFColor(vec2 position, float outlineWidth, vec4 outlineColor, float smoothing)\n{\nfloat distance = getDistance(position);\nif (outlineWidth > 0.0)\n{\nfloat outlineEdge = clamp(SDF_EDGE - outlineWidth, 0.0, SDF_EDGE);\nfloat outlineFactor = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\nvec4 sdfColor = mix(outlineColor, v_color, outlineFactor);\nfloat alpha = smoothstep(outlineEdge - smoothing, outlineEdge + smoothing, distance);\nreturn vec4(sdfColor.rgb, sdfColor.a * alpha);\n}\nelse\n{\nfloat alpha = smoothstep(SDF_EDGE - smoothing, SDF_EDGE + smoothing, distance);\nreturn vec4(v_color.rgb, v_color.a * alpha);\n}\n}\n#endif\nvoid main()\n{\nvec4 color = texture2D(u_atlas, v_textureCoordinates);\n#ifdef SDF\nfloat outlineWidth = v_outlineWidth;\nvec4 outlineColor = v_outlineColor;\nfloat distance = getDistance(v_textureCoordinates);\n#ifdef GL_OES_standard_derivatives\nfloat smoothing = fwidth(distance);\nvec2 sampleOffset = 0.354 * vec2(dFdx(v_textureCoordinates) + dFdy(v_textureCoordinates));\nvec4 center = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\nvec4 color1 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color2 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color3 = getSDFColor(v_textureCoordinates + vec2(-sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\nvec4 color4 = getSDFColor(v_textureCoordinates + vec2(sampleOffset.x, -sampleOffset.y), outlineWidth, outlineColor, smoothing);\ncolor = (center + color1 + color2 + color3 + color4)/5.0;\n#else\nfloat smoothing = 1.0/32.0;\ncolor = getSDFColor(v_textureCoordinates, outlineWidth, outlineColor, smoothing);\n#endif\ncolor = czm_gammaCorrect(color);\n#else\ncolor = czm_gammaCorrect(color);\ncolor *= czm_gammaCorrect(v_color);\n#endif\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\nif (color.a < 0.005)\n{\ndiscard;\n}\n#else\n#ifdef OPAQUE\ndiscard;\n#endif\n#endif\n#ifdef VECTOR_TILE\ncolor *= u_highlightColor;\n#endif\ngl_FragColor = color;\n#ifdef LOG_DEPTH\nczm_writeLogDepth();\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat temp = v_compressed.y;\ntemp = temp * SHIFT_RIGHT1;\nfloat temp2 = (temp - floor(temp)) * SHIFT_LEFT1;\nbool enableDepthTest = temp2 != 0.0;\nbool applyTranslate = floor(temp) != 0.0;\nif (enableDepthTest) {\ntemp = v_compressed.z;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\ntemp = v_compressed.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 imageSize;\nimageSize.y = (temp - floor(temp)) * SHIFT_LEFT12;\nimageSize.x = floor(temp);\nvec2 adjustedST = v_textureCoordinates - v_textureCoordinateBounds.xy;\nadjustedST = adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);\nfloat epsilonEyeDepth = v_compressed.x + czm_epsilon1;\nfloat globeDepth1 = getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);\nif (globeDepth1 != 0.0 && globeDepth1 > epsilonEyeDepth)\n{\nfloat globeDepth2 = getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth2 != 0.0 && globeDepth2 > epsilonEyeDepth)\n{\nfloat globeDepth3 = getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth3 != 0.0 && globeDepth3 > epsilonEyeDepth)\n{\ndiscard;\n}\n}\n}\n}\n#endif\n}\n",V=[],oe(this._batchTable)&&(V.push("VECTOR_TILE"),N=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(N),B=this._batchTable.getFragmentShaderCallback(!1,void 0)(B)),z=new fo({defines:V,sources:[N]}),this._instanced&&z.defines.push("INSTANCED"),this._shaderRotation&&z.defines.push("ROTATION"),this._shaderAlignedAxis&&z.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&z.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&z.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&z.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&z.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&z.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(H?z.defines.push("VERTEX_DEPTH_CHECK"):z.defines.push("FRAGMENT_DEPTH_CHECK")),G=1-U_.CUTOFF,this._sdf&&z.defines.push("SDF"),k=oe(this._batchTable)?"VECTOR_TILE":"",this._blendOption===V_.OPAQUE_AND_TRANSLUCENT&&(F=new fo({defines:["OPAQUE",k],sources:[B]}),this._shaderClampToGround&&(H?F.defines.push("VERTEX_DEPTH_CHECK"):F.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(F.defines.push("SDF"),F.defines.push("SDF_EDGE "+G)),this._sp=Jh.replaceCache({context:n,shaderProgram:this._sp,vertexShaderSource:z,fragmentShaderSource:F,attributeLocations:X_}),F=new fo({defines:["TRANSLUCENT",k],sources:[B]}),this._shaderClampToGround&&(H?F.defines.push("VERTEX_DEPTH_CHECK"):F.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(F.defines.push("SDF"),F.defines.push("SDF_EDGE "+G)),this._spTranslucent=Jh.replaceCache({context:n,shaderProgram:this._spTranslucent,vertexShaderSource:z,fragmentShaderSource:F,attributeLocations:X_})),this._blendOption===V_.OPAQUE&&(F=new fo({defines:[k],sources:[B]}),this._shaderClampToGround&&(H?F.defines.push("VERTEX_DEPTH_CHECK"):F.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(F.defines.push("SDF"),F.defines.push("SDF_EDGE "+G)),this._sp=Jh.replaceCache({context:n,shaderProgram:this._sp,vertexShaderSource:z,fragmentShaderSource:F,attributeLocations:X_})),this._blendOption===V_.TRANSLUCENT&&(F=new fo({defines:[k],sources:[B]}),this._shaderClampToGround&&(H?F.defines.push("VERTEX_DEPTH_CHECK"):F.defines.push("FRAGMENT_DEPTH_CHECK")),this._sdf&&(F.defines.push("SDF"),F.defines.push("SDF_EDGE "+G)),this._spTranslucent=Jh.replaceCache({context:n,shaderProgram:this._spTranslucent,vertexShaderSource:z,fragmentShaderSource:F,attributeLocations:X_})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf);var W,q,j,Y=e.commandList;if(g.render||g.pick){var X=this._colorCommands,K=this._blendOption===V_.OPAQUE,Z=this._blendOption===V_.OPAQUE_AND_TRANSLUCENT,J=this._vaf.va,Q=J.length,$=this._uniforms,ee=oe(this._batchTable)?($=this._batchTable.getUniformMapCallback()($),this._batchTable.getPickId()):"v_pickColor";X.length=Q;for(var te=Z?2*Q:Q,ie=0;ie<te;++ie){var ne=X[ie];oe(ne)||(ne=X[ie]=new Xd({}));var re=K||Z&&ie%2==0;ne.pass=re||!Z?Kd.OPAQUE:Kd.TRANSLUCENT,ne.owner=this;var ae=Z?Math.floor(ie/2):ie;ne.boundingVolume=I,ne.modelMatrix=O,ne.count=J[ae].indicesCount,ne.shaderProgram=re?this._sp:this._spTranslucent,ne.uniformMap=$,ne.vertexArray=J[ae].va,ne.renderState=re?this._rsOpaque:this._rsTranslucent,ne.debugShowBoundingVolume=this.debugShowBoundingVolume,ne.pickId=ee,this._instanced&&(ne.count=6,ne.instanceCount=i),Y.push(ne)}this.debugShowTextureAtlas&&(oe(this.debugCommand)||(this.debugCommand=(W=this,q=e.context,(j=q.createViewportQuadCommand("uniform sampler2D billboard_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    gl_FragColor = texture2D(billboard_texture, v_textureCoordinates); \n} \n",{uniformMap:{billboard_texture:function(){return W._textureAtlas.texture}}})).pass=Kd.OVERLAY,j)),Y.push(this.debugCommand))}}}},CC.prototype.isDestroyed=function(){return!1},CC.prototype.destroy=function(){return oe(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),gC(this._billboards),Wi(this)};var JC=Object.freeze({LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19}),QC="undefined"!=typeof performance&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()},$C=QC,eg=Object.freeze({SHIFT:0,CTRL:1,ALT:2});function tg(e,t,i){var n=e._element;if(n===document)return i.x=t.clientX,i.y=t.clientY,i;var r=n.getBoundingClientRect();return i.x=t.clientX-r.left,i.y=t.clientY-r.top,i}function ig(e,t){var i=e;return oe(t)&&(i+="+"+t),i}function ng(e){return e.shiftKey?eg.SHIFT:e.ctrlKey?eg.CTRL:e.altKey?eg.ALT:void 0}var rg={LEFT:0,MIDDLE:1,RIGHT:2};function ag(t,e,i,n){function r(e){n(t,e)}He.isInternetExplorer()?i.addEventListener(e,r,!1):i.addEventListener(e,r,{capture:!1,passive:!1}),t._removalFunctions.push(function(){i.removeEventListener(e,r,!1)})}var og={position:new ha};function sg(e){e._lastSeenTouchEvent=$C()}function ug(e){return $C()-e._lastSeenTouchEvent>Ng.mouseEmulationIgnoreMilliseconds}function lg(e,t,i){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)<i}function cg(e,t){if(ug(e)){var i,n=t.button;if(e._buttonDown[n]=!0,n===rg.LEFT)i=JC.LEFT_DOWN;else if(n===rg.MIDDLE)i=JC.MIDDLE_DOWN;else{if(n!==rg.RIGHT)return;i=JC.RIGHT_DOWN}var r=tg(e,t,e._primaryPosition);ha.clone(r,e._primaryStartPosition),ha.clone(r,e._primaryPreviousPosition);var a=ng(t),o=e.getInputAction(i,a);oe(o)&&(ha.clone(r,og.position),o(og),t.preventDefault())}}var mg={position:new ha},dg={position:new ha};function hg(e,t,i,n){var r,a=ng(n),o=e.getInputAction(t,a),s=e.getInputAction(i,a);(oe(o)||oe(s))&&(r=tg(e,n,e._primaryPosition),oe(o)&&(ha.clone(r,mg.position),o(mg)),oe(s)&&lg(e._primaryStartPosition,r,e._clickPixelTolerance)&&(ha.clone(r,dg.position),s(dg)))}function fg(e,t){var i,n;ug(e)&&((i=t.button)!==rg.LEFT&&i!==rg.MIDDLE&&i!==rg.RIGHT||(e._buttonDown[rg.LEFT]&&(hg(e,JC.LEFT_UP,JC.LEFT_CLICK,t),e._buttonDown[rg.LEFT]=!1),e._buttonDown[rg.MIDDLE]&&((n=document.getElementById("focalPointCanvas"))&&document.body.removeChild(n),hg(e,JC.MIDDLE_UP,JC.MIDDLE_CLICK,t),e._buttonDown[rg.MIDDLE]=!1),e._buttonDown[rg.RIGHT]&&((n=document.getElementById("focalPointCanvas"))&&document.body.removeChild(n),hg(e,JC.RIGHT_UP,JC.RIGHT_CLICK,t),e._buttonDown[rg.RIGHT]=!1)))}var pg={startPosition:new ha,endPosition:new ha};function _g(e,t){var i,n,r,a;ug(e)&&(i=ng(t),n=tg(e,t,e._primaryPosition),r=e._primaryPreviousPosition,oe(a=e.getInputAction(JC.MOUSE_MOVE,i))&&(ha.clone(r,pg.startPosition),ha.clone(n,pg.endPosition),a(pg)),ha.clone(n,r),(e._buttonDown[rg.LEFT]||e._buttonDown[rg.MIDDLE]||e._buttonDown[rg.RIGHT])&&t.preventDefault())}var Cg={position:new ha};function gg(e,t){var i,n,r;t.button===rg.LEFT&&(i=JC.LEFT_DOUBLE_CLICK,n=ng(t),oe(r=e.getInputAction(i,n))&&(tg(e,t,Cg.position),r(Cg)))}function vg(e,t){var i,n,r,a;n=oe(t.deltaY)?(i=t.deltaMode)===t.DOM_DELTA_PIXEL?-t.deltaY:i===t.DOM_DELTA_LINE?40*-t.deltaY:120*-t.deltaY:0<t.detail?-120*t.detail:t.wheelDelta,oe(n)&&(r=ng(t),oe(a=e.getInputAction(JC.WHEEL,r))&&(a(n),t.preventDefault()))}function yg(e,t){sg(e);for(var i,n,r=t.changedTouches,a=r.length,o=e._positions,s=0;s<a;++s)n=(i=r[s]).identifier,o.set(n,tg(e,i,new ha));bg(e,t);var u=e._previousPositions;for(s=0;s<a;++s)n=(i=r[s]).identifier,u.set(n,ha.clone(o.get(n)))}function Tg(e,t){sg(e);for(var i,n=t.changedTouches,r=n.length,a=e._positions,o=0;o<r;++o)i=n[o].identifier,a.remove(i);bg(e,t);var s=e._previousPositions;for(o=0;o<r;++o)i=n[o].identifier,s.remove(i)}var xg={position:new ha},wg={position1:new ha,position2:new ha},Ag={position:new ha},Eg={position:new ha},Sg={position:new ha};function bg(e,t){var i,n,r,a=ng(t),o=e._positions,s=o.length,u=e._isPinching;1!==s&&e._buttonDown[rg.LEFT]&&(e._buttonDown[rg.LEFT]=!1,oe(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),oe(i=e.getInputAction(JC.LEFT_UP,a))&&(ha.clone(e._primaryPosition,Ag.position),i(Ag)),0!==s||e._isTouchHolding||oe(n=e.getInputAction(JC.LEFT_CLICK,a))&&lg(e._primaryStartPosition,e._previousPositions.values[0],e._clickPixelTolerance)&&(ha.clone(e._primaryPosition,Eg.position),n(Eg)),e._isTouchHolding=!1),0===s&&u&&(e._isPinching=!1,oe(i=e.getInputAction(JC.PINCH_END,a))&&i()),1!==s||u||(r=o.values[0],ha.clone(r,e._primaryPosition),ha.clone(r,e._primaryStartPosition),ha.clone(r,e._primaryPreviousPosition),e._buttonDown[rg.LEFT]=!0,oe(i=e.getInputAction(JC.LEFT_DOWN,a))&&(ha.clone(r,xg.position),i(xg)),e._touchHoldTimer=setTimeout(function(){e.isDestroyed()||(e._touchHoldTimer=void 0,e._isTouchHolding=!0,oe(n=e.getInputAction(JC.RIGHT_CLICK,a))&&lg(e._primaryStartPosition,e._previousPositions.values[0],e._holdPixelTolerance)&&(ha.clone(e._primaryPosition,Sg.position),n(Sg)))},Ng.touchHoldDelayMilliseconds),t.preventDefault()),2!==s||u||(e._isPinching=!0,oe(i=e.getInputAction(JC.PINCH_START,a))&&(ha.clone(o.values[0],wg.position1),ha.clone(o.values[1],wg.position2),i(wg),t.preventDefault()))}function Mg(e,t){sg(e);for(var i,n,r=t.changedTouches,a=r.length,o=e._positions,s=0;s<a;++s){n=(i=r[s]).identifier;var u=o.get(n);oe(u)&&tg(e,i,u)}Pg(e,t);var l=e._previousPositions;for(s=0;s<a;++s)n=(i=r[s]).identifier,ha.clone(o.get(n),l.get(n))}var Rg={startPosition:new ha,endPosition:new ha},Dg={distance:{startPosition:new ha,endPosition:new ha},angleAndHeight:{startPosition:new ha,endPosition:new ha}};function Pg(e,t){var i,n,r,a,o,s,u,l,c,m,d,h,f,p,_,C,g,v=ng(t),y=e._positions,T=e._previousPositions,x=y.length;1===x&&e._buttonDown[rg.LEFT]?(i=y.values[0],ha.clone(i,e._primaryPosition),n=e._primaryPreviousPosition,oe(r=e.getInputAction(JC.MOUSE_MOVE,v))&&(ha.clone(n,Rg.startPosition),ha.clone(i,Rg.endPosition),r(Rg)),ha.clone(i,n),t.preventDefault()):2===x&&e._isPinching&&oe(r=e.getInputAction(JC.PINCH_MOVE,v))&&(a=y.values[0],o=y.values[1],s=T.values[0],u=T.values[1],l=o.x-a.x,c=o.y-a.y,m=.25*Math.sqrt(l*l+c*c),d=u.x-s.x,h=u.y-s.y,f=.25*Math.sqrt(d*d+h*h),p=.125*(o.y+a.y),_=.125*(u.y+s.y),C=Math.atan2(c,l),g=Math.atan2(h,d),ha.fromElements(0,f,Dg.distance.startPosition),ha.fromElements(0,m,Dg.distance.endPosition),ha.fromElements(g,_,Dg.angleAndHeight.startPosition),ha.fromElements(C,p,Dg.angleAndHeight.endPosition),r(Dg))}function Ig(e,t){var i,n;t.target.setPointerCapture(t.pointerId),"touch"===t.pointerType?(i=e._positions,n=t.pointerId,i.set(n,tg(e,t,new ha)),bg(e,t),e._previousPositions.set(n,ha.clone(i.get(n)))):cg(e,t)}function Og(e,t){var i,n;"touch"===t.pointerType?(i=e._positions,n=t.pointerId,i.remove(n),bg(e,t),e._previousPositions.remove(n)):fg(e,t)}function Lg(e,t){if("touch"===t.pointerType){var i=e._positions,n=t.pointerId,r=i.get(n);if(!oe(r))return;tg(e,t,r),Pg(e,t);var a=e._previousPositions;ha.clone(i.get(n),a.get(n))}else _g(e,t)}function Ng(e){var t,i,n;this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-Ng.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new ha,this._primaryPosition=new ha,this._primaryPreviousPosition=new ha,this._positions=new Wo,this._previousPositions=new Wo,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=z(e,document),i=(t=this)._element,n=oe(i.disableRootEvents)?i:document,He.supportsPointerEvents()?(ag(t,"pointerdown",i,Ig),ag(t,"pointerup",i,Og),ag(t,"pointermove",i,Lg),ag(t,"pointercancel",i,Og)):(ag(t,"mousedown",i,cg),ag(t,"mouseup",n,fg),ag(t,"mousemove",n,_g),ag(t,"touchstart",i,yg),ag(t,"touchend",n,Tg),ag(t,"touchmove",n,Mg),ag(t,"touchcancel",n,Tg)),ag(t,"dblclick",i,gg),ag(t,"onwheel"in i?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",i,vg)}Ng.prototype.setInputAction=function(e,t,i){var n=ig(t,i);this._inputEvents[n]=e},Ng.prototype.getInputAction=function(e,t){var i=ig(e,t);return this._inputEvents[i]},Ng.prototype.removeInputAction=function(e,t){var i=ig(e,t);delete this._inputEvents[i]},Ng.prototype.isDestroyed=function(){return!1},Ng.prototype.destroy=function(){return function(e){for(var t=e._removalFunctions,i=0;i<t.length;++i)t[i]()}(this),Wi(this)},Ng.mouseEmulationIgnoreMilliseconds=800,Ng.touchHoldDelayMilliseconds=1500;function Bg(e,t,i,n,r,a,o){var s=Cesium.defaultValue(t,{});if(!Cesium.defined(e))throw new DeveloperError("scene of options  must be defined");this._scene=e,this._billboards=new Cesium.BillboardCollection,this._primitives=i||this._scene.primitives,this._primitives.add(this._billboards),this._orderedBillboards=[],this.ellipsoid=e.globe.ellipsoid,this.scale=s.scale,Cesium.defined(n)&&Cesium.defined(r)&&Cesium.defined(a)&&Cesium.defined(o)&&(this.PrimitiveDistance=n,this.PrimitiveScale=r,this.PrimitiveFloatHeight3D=a,this.drawMode=o)}function zg(e,t,i){e[t]=i}function Fg(e,t){for(var i=e._orderedBillboards.length,n=0;n<i&&e._orderedBillboards[n]!=t;++n);return n}function Vg(e,t,i){if(this.libraryID=t,this.symbolID=i,this.evPlottingService=e.evPlottingService,!Cesium.defined(this.evPlottingService))throw new DeveloperError("options.evPlottingService  undefined!");this.appearance=new Cesium.PolylineColorAppearance,this.frameAppearance=new Cesium.PerInstanceColorAppearance,this.geodesic=!0,this._createPrimitive=!1,this._varyAlpha=1,this.ellipsoid=Cesium.defaultValue(e.ellipsoid,Cesium.Ellipsoid.WGS84),this.textureRotationAngle=Cesium.defaultValue(e.textureRotationAngle,0),this.asynchronous=Cesium.defaultValue(e.asynchronous,!1),this.show=Cesium.defaultValue(e.show,!0),this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this.color=Cesium.defaultValue(e.color,"rgba(253, 128, 69, 0.6)"),this.rotation=Cesium.defaultValue(e.rotation,0),this._ellipsoid=void 0,this._granularity=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!1,this._primitive=void 0,this._outlinePolygon=void 0,this._appendPrimitive=void 0,this._positions=void 0,this._changeState=void 0}function Ug(e){return new Uint8Array([255*e.red,255*e.green,255*e.blue,Math.round(255*e.alpha)])}function Gg(e){var r;e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.viewer=e.viewer,Cesium.defined(this.viewer)&&(this.activeGroup="",this.activeLayer="",this.addNodeListFun=void 0,this.primitives=new Cesium.PrimitiveCollection,this.layerGroupMap=new Hg,this.actionGroups=null,(r=this).geometryGroup=new Proxy({size:0},{set:function(e,t,i){if("size"==t)return e.size=i,!0;var n=r.addNodeListFun(i,r.activeLayer);return r.layerGroupMap.get(r.activeGroup).get(r.activeLayer).primitives.push(n),e[n]=i,e.size=e.size+1,!0}}))}function kg(e,t,i){for(var n=t.primitives,r=null,a=null,o=0;o<n.length;o++){var s=n[o],r=e.geometryGroup[s],u=i.Symbol[i.Symbol.length]={},l=r.name;if("EV_PointMilStd"===r.getType()&&(l=l.split("_"),u._Guid=l[1],u._Name=l[0],u._Visible=r.show,u._Code=r.libraryID+","+r.symbolID,u._CanSelected="TRUE",u._IsSetGenAttr="FALSE",u._OperType="EDIT",u._DisplayType="STAND_NOPIXEL",a=bt(r.position),u.GeoAttr={POINTS:{_Count:1,Point:[{_X:a.lon,_Y:a.lat,_Z:a.height}]},GeoAttribute:{_HeightType:"0",_Scale:r.scale,_FloatHeight3D:r.floatHeight3D,_Thickness3D:r.mainLineHeight,_WallTransparent:"100",_Rotate:r.rotation/10,_ISVisibleDragLine:"FALSE"}},r.drawMode,r.scaleMode,u.StyleAttr={_DisplayType:"3",_LineType:"1",MainLine:{_IsExternalSetLine:"FALSE",_Color:Mt.toInt(r.mainLineColor),_Width:r.mainLineWidth},SurroundLine:{_Type:r.isShowAuxiliaryLine,_Color:Mt.toInt(r.auxiliaryLineColor),_Width:r._auxiliaryLineWidth},Fill:{_IsExternalSetFill:r.isFill,_Mode:"0",_Color:Mt.toInt(r.fillColor)},Mirroring:{_Horizontal:"FALSE",_Vertical:"FALSE"}},u.AnnoTextAttr={_Text:"",_Visible:"TRUE",AnnoFont:{_Family:"微软雅黑",_Width:"20",_Height:"100"},AnnoFontEffect:{_Italic:"FALSE",_Bold:"FALSE"},AnnoColor:{_Back:"0",_Text:"255"},AnnoPosType:{_PosType:"1"},AnnoTextRotate:{_IsRorate:"1"}},u.DotDragLine={_DragLineVisble:"FALSE",DotDragLinePoint:{_X:"96.337753",_Y:"34.408583",_Z:"4623.950492"}},u.RangAttr={ShowRang:{_Min:"-1.000000",_Max:"-1.000000"},HalfPixelRang:{_Min:"20000000.000000",_Max:"20000000.000000"}}),"EV_LineMilStd"===r.getType()){l=l.split("_"),u._Guid=l[1],u._CanSelected="TRUE",u._Name=l[0],u._Code=r.libraryID+","+r.symbolID,u.OperType="EDIT",u._Visible="TRUE",u._IsSetGenAttr="FALSE",u.GeoAttr={POINTS:{_Count:r.positions.length,Point:[]},GeoAttribute:{_WallTransparent:r.wallTransparent,_FloatHeight3D:r.height,_Scale:r.scale,_HeightType:"0",_Rotate:r.rotation/10,_ISVisibleDragLine:"FALSE",_Thickness3D:r.mainLineHeight},GeoScaleValues:{GeoScaleValue:{_Value:"0.100000",_Index:"0"}}};for(var c=0,m=r.positions.length;c<m;c++)a=bt(r.positions[c]),u.GeoAttr.POINTS.Point[c]={_X:a.lon,_Y:a.lat,_Z:a.height};u.StyleAttr={_DisplayType:"3",_LineType:"1",MainLine:{_Width:r.mainLineWidth,_Color:Mt.toInt(r.mainLineColor),_IsExternalSetLine:"FALSE"},SurroundLine:{_Width:r._auxiliaryLineWidth,_Type:r.isShowAuxiliaryLine,_Color:Mt.toInt(r.auxiliaryLineColor)},Fill:{_Mode:"0",_Color:Mt.toInt(r.fillColor),_IsExternalSetFill:r.isFill},Mirroring:{_Horizontal:"FALSE",_Vertical:"FALSE"}},u.AnnoTextAttr={_Text:"",_Visible:"TRUE",AnnoFont:{_Family:"微软雅黑",_Width:"20",_Height:"200"},AnnoFontEffect:{_Italic:"FALSE",_Bold:"FALSE"},AnnoColor:{_Back:"0",_Text:"255"},AnnoPosType:{_PosType:"1"}},u.AvoidPoints={_Count:"0"},u.RangAttr={ShowRang:{_Min:"-1.000000",_Max:"-1.000000"},HalfPixelRang:{_Min:"20000000.000000",_Max:"20000000.000000"}}}}}function Hg(){this._c=new Map,this.size=0}function Wg(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.viewer=e.viewer,!Cesium.defined(this.viewer))throw new DeveloperError("viewer of options  must be defined");if(this.ev_milStdLayerManager=e.ev_milStdLayerManager,!Cesium.defined(this.ev_milStdLayerManager))throw new DeveloperError("ev_milStdLayerManager of options  must be defined");this.geometryData=[],this.primitives=new Cesium.PrimitiveCollection,this.primitiveGroup={},this.preRenderListener=void 0,this.geometries=void 0,this.camera=void 0,this.deduceTime=-1/0,this.suspendTime=void 0,this.startTime=void 0,this.tweens=new TweenCollection,this.stopDeduceCallBack=void 0,this.deduceState=!0}function qg(e,t,i,n,r,a,o,s){this.tweens.add({startObject:{value:e},stopObject:{value:t},delay:1e3*i,duration:1e3*n,easingFunction:Cesium.EasingFunction.LINEAR,update:r,complete:a,cancel:o,_repeat:s})}function jg(e){var t=0,i=0,n=e[1][0]-e[0][0],r=e[1][1]-e[0][1];return 0==n&&0==r||(i=0<=r?180*-(t=Math.asin(n/Math.sqrt(n*n+r*r)))/Math.PI:0!=n?180*(t=Math.asin(n/Math.sqrt(n*n+r*r)))/Math.PI-180:180*(t=Math.acos(r/Math.sqrt(n*n+r*r)))/Math.PI+90*t/Math.abs(t)),i}Bg.prototype.createBillboard=function(e,u){var r,l,c=this._billboards.add({show:!0,position:e,eyeOffset:new Cesium.Cartesian3(0,0,-2e3),horizontalOrigin:0,verticalOrigin:0,scale:this.scale,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKHAksBNXfIvIAAADGSURBVBjTlZC9DsFgFIafWsQgDE0vwGBjNVjNdYl1BYYmbkDim0yMEotFooNEW+Wjr6GfpCQG73J+nmc5B/6I924kNYEh0APawAXYAxvP827URUlTSZGkg6S7q5HbN+vySNJM0lOfebr9CKABUBRFH5i851oawMTxCuZ53gGCH3cFjldymqYZcPohnxyv5CzLdsASKL/EElg6XsnW2rUxZgHMgSPwcHVujFlYa9cff47juJUkyRgYAF3gDGx931+FYXjl37wANeOE+Ghv1/sAAAAASUVORK5CYII=",color:new Cesium.Color(1,1,0,1)});return u&&(r=(l=this)._scene.screenSpaceCameraController,u.dragHandlers&&(l=this,zg(c,"leftDown",function(t){function i(e){n.destroy(),r.enableRotate=!0,r.enableTranslate=!0,u.dragHandlers.onDragEnd&&u.dragHandlers.onDragEnd(Fg(l,c),e)}var n=new Cesium.ScreenSpaceEventHandler(l._scene.canvas);n.setInputAction(function(e){i(l._scene.pickPosition(t))},Cesium.ScreenSpaceEventType.LEFT_UP),n.setInputAction(function(e){var t=l._scene.pickPosition(e.endPosition);(t?function(e){if(Cesium.defined(l.drawMode)){if(0==!l.drawMode){var t=Cesium.Cartographic.fromCartesian(e),i=Cesium.Math.toDegrees(t.longitude),n=Cesium.Math.toDegrees(t.latitude),r=t.height.toFixed(2),a=10*l.PrimitiveDistance*l.PrimitiveScale+1e3*l.PrimitiveFloatHeight3D;c.position=Cesium.Cartesian3.fromDegrees(i,n,+r+a);for(var o=l._orderedBillboards.length,s=0;s<o&&l._orderedBillboards[s]!=c;++s);u.dragHandlers.onDrag&&u.dragHandlers.onDrag(Fg(l,c),e)}else{t=Cesium.Cartographic.fromCartesian(e),i=Cesium.Math.toDegrees(t.longitude),n=Cesium.Math.toDegrees(t.latitude),r=t.height.toFixed(2),a=1e3*l.PrimitiveFloatHeight3D;c.position=Cesium.Cartesian3.fromDegrees(i,n,+r+a);for(o=l._orderedBillboards.length,s=0;s<o&&l._orderedBillboards[s]!=c;++s);u.dragHandlers.onDrag&&u.dragHandlers.onDrag(Fg(l,c),e)}for(o=l._orderedBillboards.length,s=0;s<o&&l._orderedBillboards[s]!=c;++s);u.dragHandlers.onDrag&&u.dragHandlers.onDrag(Fg(l,c),e)}else{c.position=e;for(o=l._orderedBillboards.length,s=0;s<o&&l._orderedBillboards[s]!=c;++s);u.dragHandlers.onDrag&&u.dragHandlers.onDrag(Fg(l,c),e)}}:i)(t)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),n._buttonDown[0]=!0,r.enableRotate=!1,r.enableTranslate=!1,u.dragHandlers.onDragStart&&u.dragHandlers.onDragStart(Fg(l,c),l._scene.pickPosition(t))})),u.onDoubleClick&&zg(c,"leftDoubleClick",function(e){u.onDoubleClick(Fg(l,c))}),u.onClick&&zg(c,"leftClick",function(e){u.onClick(Fg(l,c))})),c},Bg.prototype.insertBillboard=function(e,t,i){this._orderedBillboards.splice(e,0,this.createBillboard(t,i))},Bg.prototype.addBillboard=function(e,t){var i=this.createBillboard(e,t);return this._orderedBillboards.push(i),i},Bg.prototype.addBillboards=function(e,t){for(var i=0;i<e.length;i++)this.addBillboard(e[i],t)},Bg.prototype.updateBillboardsPositions=function(e){for(var t=0;t<e.length;t++)this.getBillboard(t).position=e[t]},Bg.prototype.countBillboards=function(){return this._orderedBillboards.length},Bg.prototype.getBillboard=function(e){return this._orderedBillboards[e]},Bg.prototype.removeBillboard=function(e){this._billboards.remove(this.getBillboard(e)),this._orderedBillboards.splice(e,1)},Bg.prototype.remove=function(){this._billboards.removeAll(),this._primitives.remove(this._billboards)},Bg.prototype.setOnTop=function(){this._primitives.raiseToTop(this._billboards)},Bg.prototype.destroy=function(){this._billboards.destroy()},Object.defineProperties(Vg.prototype,{positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._createPrimitive=!0}},changeState:{get:function(){return this._changeState},set:function(e){this._changeState=e,this._createPrimitive=!0}},varyAlpha:{get:function(){return this._varyAlpha},set:function(e){var t,i;if(this._varyAlpha=e,this._primitive.appearance.translucent=1!==e,this.mainLineColors)for(var n=0;n<this._primitive._instanceIds.length;++n)1===(t=Cesium.Color.fromCssColorString(this.mainLineColors[n])).alpha?(t.alpha=t.alpha*e,this._primitive.getGeometryInstanceAttributes(this._primitive._instanceIds[n]).color=Ug(t)):(t.alpha=t.alpha*e,this._framePrimitive.getGeometryInstanceAttributes(this._primitive._instanceIds[n]).color=Ug(t));else if(1===(t=Cesium.Color.fromCssColorString(this.mainLineColor)).alpha){t.alpha=t.alpha*e,i=Ug(t);for(n=0;n<this._primitive._instanceIds.length;++n)this._primitive.getGeometryInstanceAttributes(this._primitive._instanceIds[n]).color=i}else{t.alpha=t.alpha*e,i=Ug(t);for(n=0;n<this._primitive._instanceIds.length;++n)this._framePrimitive.getGeometryInstanceAttributes(this._primitive._instanceIds[n]).color=i}this.isFill&&(1===(t=Cesium.defined(this.fillColors)?Cesium.Color.fromCssColorString(this.fillColors[0]):Cesium.Color.fromCssColorString(this.fillColor)).alpha?(t.alpha=t.alpha*e,this._primitive.getGeometryInstanceAttributes("fill").color=Ug(t)):(t.alpha=t.alpha*e,this._framePrimitive.getGeometryInstanceAttributes("fill").color=Ug(t)))}}}),Vg.prototype.update=function(e){if(this.show&&(this._createPrimitive||Cesium.defined(this._primitive))){if(this._createPrimitive||Cesium.defined(this.drawMode)&&360===this.drawMode||Cesium.defined(this.scaleMode)&&"0"===this.scaleMode){var t=this.getGeometryInstances();if(!t)return;this._createPrimitive=!1,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new Cesium.Primitive({geometryInstances:t,appearance:this.appearance,asynchronous:this.asynchronous}),this._framePrimitive=this._framePrimitive&&this._framePrimitive.destroy(),this.getFramePrimitive&&(this._framePrimitive=new Cesium.Primitive({geometryInstances:this.getFramePrimitive(),appearance:this.frameAppearance,asynchronous:this.asynchronous}))}this._primitive.update(e),this._framePrimitive&&this._framePrimitive.update(e)}},Vg.prototype.isDestroyed=function(){return!1},Vg.prototype.destroy=function(){return this.setEditMode&&this.setEditMode(!1),this.labels=this.labels&&this._primitives.remove(this.labels),this.billboards=this.billboards&&this._primitives.remove(this.billboards),this._primitive=this._primitive&&this._primitives.remove(this._primitive),this._framePrimitive=this._framePrimitive&&this._primitives.remove(this._framePrimitive),this._primitives=this._primitives&&this._primitives.remove(this),Cesium.destroyObject(this)},Vg.prototype.createGeometryInstance=function(e,t,i){return new Cesium.GeometryInstance({geometry:e,id:i,pickPrimitive:this,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString(t))}})},Vg.prototype.getType=function(){return"EV_MainLinePrimitive"},Vg.prototype.getDrawPositions=function(e,t,i,n){var r=e||this;if(Cesium.defined(this.positions)&&!(this.positions.length<2)){var a="{",o=void 0;Cesium.defined(t)&&(a+='"MainLineColor" : "'+Mt.toInt(t)+'",'),Cesium.defined(i)&&(a+='"FillColor" : "'+Mt.toInt(i)+'",'),Cesium.defined(n)&&(a+='"FillMode" : "'+n+'",'),a+='"Positions":"';for(var s=0;s<this.positions.length;++s)a+=(o=bt(this.positions[s])).lon+","+o.lat+",0.0;";a+='"}';var u,l=Cesium.when.defer();return Cesium.defined(this.evPlottingService)&&(u={libraryID:this.libraryID,symbolID:this.symbolID,symbolSpecialInfo:a},this.evPlottingService.getSymbolMeshJson(u,function(e){var t=JSON.parse(e);t.MainData.forEach(function(e){Cesium.Cartographic.fromCartesian(r.positions[0]);e.MainVertex=function(e,t){for(var i=[],n=0;n<e.length;n+=2)n+2<e.length?i.push(e.slice(n,n+2)):i.push(e.slice(n));return i.forEach(function(e){return 2===e.length?e.push(t):e}),[].concat.apply([],i)}(e.MainVertex,0)}),r.maxPoints=t.MaxPointCount;var i=function(e,t,i){var n=[],r=[],a=[],o=[],s=[],u=[];if(t){for(l=0;l<e.MainData.length;++l)n[n.length]=Cesium.Cartesian3.fromDegreesArrayHeights(e.MainData[l].MainVertex),a[a.length]=Cesium.Cartesian3.fromDegreesArrayHeights(e.MainData[l].MainVertex),r[r.length]=i.mainLineColor,o[o.length]=i.wallColor;if(e.FillData)for(l=0;l<e.FillData.length;++l)s[s.length]=Cesium.Cartesian3.fromDegreesArray(e.FillData[l].FillVertex),u[u.length]=i.fillColor}else{for(var l=0;l<e.MainData.length;++l){n[n.length]=Cesium.Cartesian3.fromDegreesArrayHeights(e.MainData[l].MainVertex),a[a.length]=Cesium.Cartesian3.fromDegreesArrayHeights(e.MainData[l].MainVertex);var c=e.MainData[l].MainColor.slice(0,3);r[r.length]="rgba("+c.toString()+","+e.MainData[l].MainColor[3]/255+")",o[o.length]="rgba("+c.toString()+","+e.MainData[l].MainColor[3]/255+")"}if(e.FillData)for(var l=0;l<e.FillData.length;++l)s[s.length]=Cesium.Cartesian3.fromDegreesArray(e.FillData[l].FillVertex),u[u.length]="rgba("+e.FillData[l].FillColor.slice(0,3).toString()+","+e.FillData[l].FillColor[3]/255+")"}return{mainLinePositions:n,mainLineColor:r,wallPositions:a,wallColor:o,fillPositions:s,fillColor:u}}(t,r.changeState,r);!function(e,t){e.mainLinePositions=t.mainLinePositions,e.wallPositions=t.wallPositions,e._changeState||(e.mainLineColor=t.mainLineColor[0],e.mainLineColors=t.mainLineColor,e.wallColor=t.wallColor[0],e.wallColors=t.wallColor);0<t.fillPositions.length&&(e.isFill=!0,e.fillPositions=t.fillPositions,e._changeState||(e.fillColor=t.fillColor[0],e.fillColors=t.fillColor));e._createPrimitive=!0}(r,i),l.resolve()})),l.promise}},Vg.prototype.getGeometryInstances=function(){if(Cesium.defined(this.mainLinePositions)){var e=[],t=void 0;if(Cesium.defined(this.mainLineColors))for(var i=0;i<this.mainLinePositions.length;++i)t=new Cesium.PolylineGeometry({positions:this.mainLinePositions[i],height:0,width:3,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid}),e[i]=this.createGeometryInstance(t,this.mainLineColors[i],"mainLine"+i);else for(i=0;i<this.mainLinePositions.length;++i)t=new Cesium.PolylineGeometry({positions:this.mainLinePositions[i],height:0,width:3,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid}),e[i]=this.createGeometryInstance(t,this.mainLineColor,"mainLine"+i);return t=void 0,e}},Vg.prototype.getFramePrimitive=function(){if(Cesium.defined(this.isFill)){var e=[],t=void 0;if(Cesium.defined(this.fillColors))for(var i=0;i<this.fillPositions.length;++i)t=Cesium.PolygonGeometry.fromPositions({positions:this.fillPositions[i],height:0,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[i]=this.createGeometryInstance(t,this.fillColors[i],"fill");else for(i=0;i<this.fillPositions.length;++i)t=Cesium.PolygonGeometry.fromPositions({positions:this.fillPositions[i],height:0,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[i]=this.createGeometryInstance(t,this.fillColor,"fill");return t=void 0,e}},Gg.prototype.deleteAllLayerGroup=function(){for(var e=this.layerGroupMap.keyArray(),t=0;t<this.layerGroupMap.size;t++)for(var i=this.layerGroupMap.get(e[t]),n=i.keyArray(),r=0;r<n.length;r++)this.removeLayerGeometry(i.get(n[r]));this.activeGroup="",this.activeLayer="",this.primitives._primitiveMap={},this.layerGroupMap=new Hg,this.actionGroups=null},Gg.prototype.addLayerGroup=function(e,t){var i=new Hg;this.layerGroupMap.set(e,i),this.layerGroupMap.get(e).name=t},Gg.prototype.deleteLayerGroup=function(e){for(var t=this.layerGroupMap.get(e),i=t.keyArray(),n=0;n<i.length;n++)this.removeLayerGeometry(t.get(i[n]));this.layerGroupMap.delete(e)},Gg.prototype.clearLayerGroup=function(e){for(var t=this.layerGroupMap.get(e),i=t.keyArray(),n=0;n<i.length;n++)this.removeLayerGeometry(t.get(i[n])),t.get(i[n]).primitives=[]},Gg.prototype.addLayer=function(e,t,i){var n={name:i,primitives:[]};this.layerGroupMap.get(e).set(t,n)},Gg.prototype.deleteLayer=function(e,t){var i=this.layerGroupMap.get(e).get(t);this.removeLayerGeometry(i),this.layerGroupMap.get(e).delete(t)},Gg.prototype.clearLayer=function(e,t){var i=this.layerGroupMap.get(e).get(t);this.removeLayerGeometry(i),i.primitives=[]},Gg.prototype.setActiveLayer=function(e,t){this.activeGroup=e,this.activeLayer=t},Gg.prototype.getActiveLayer=function(e){(e=e||this.viewer.scene).primitives.contains(this.primitives)||e.primitives.add(this.primitives);var t=this.layerGroupMap.get(this.activeGroup);if(t&&t.get(this.activeLayer))return this.primitives},Gg.prototype.addGeometry=function(e){this.geometryGroup.geometry=e},Gg.prototype.removeGeometry=function(e,t,i){if(!t||!i)throw new Error("缺少图层信息");this.geometryGroup[e].destroy(),delete this.geometryGroup[e],this.geometryGroup.size=this.geometryGroup.size-1;var n=this.layerGroupMap.get(i).get(t).primitives,r=n.indexOf(e);-1<r&&n.splice(r,1)},Gg.prototype.showGeometry=function(e){this.geometryGroup[e].show=!this.geometryGroup[e].show},Gg.prototype.addNodeList=function(e){this.addNodeListFun=e},Gg.prototype.showAllGeometry=function(e){if(e)for(var t in this.geometryGroup)"size"!==t&&(this.geometryGroup[t].show=-1!==e.indexOf(t));else for(var t in this.geometryGroup)"size"!==t&&(this.geometryGroup[t].show=!0)},Gg.prototype.disableAllGeometry=function(e){if(e)for(var t in this.geometryGroup)"size"!==t&&(this.geometryGroup[t].show=!(-1!==e.indexOf(t)));else for(var t in this.geometryGroup)"size"!==t&&(this.geometryGroup[t].show=!1)},Gg.prototype.getAllGeometry=function(){return this.geometryGroup},Gg.prototype.getPrimitive=function(e){return GeometryGroup[e]},Gg.prototype.saveAllMilStdSML=function(){for(var e={SITSYMBOLFILE:{LAYGROUPS:{_Count:this.layerGroupMap.size,LayerGroup:[]}}},t=this.layerGroupMap.keyArray(),i=e.SITSYMBOLFILE.LAYGROUPS,n=0;n<this.layerGroupMap.size;n++){var r=this.layerGroupMap.get(t[n]),a=i.LayerGroup[i.LayerGroup.length]={};a._Name=r.name,a._Visible="TRUE",a._Describe="",a.LAYERS=[];var o=a.LAYERS[a.LAYERS.length]={},s=r.keyArray();o._Count=s.length,o.Layer=[];for(var u=0;u<s.length;u++){var l=r.get(s[u]),c=o.Layer[o.Layer.length]={};c._Name=l.name,c._Visible="TRUE",c._Describe="",c._IsLayerActive=this.activeLayer===s[u],c.SYMBOLS=[];var m=c.SYMBOLS[c.SYMBOLS.length]={};m._Count=l.primitives.length,m.Symbol=[],c._Count=l.primitives.length,kg(this,l,m)}}return this.actionGroups&&(e.SITSYMBOLFILE.ACTIONGROUPS=this.actionGroups),e},Gg.prototype.exportLayerGroupData=function(e){var t={SITSYMBOLFILE:{LAYGROUPS:{_Count:1,LayerGroup:[]}}},i=t.SITSYMBOLFILE.LAYGROUPS,n=this.layerGroupMap.get(e),r=n.keyArray(),a=i.LayerGroup[i.LayerGroup.length]={};a._Name=n.name,a._Visible="TRUE",a._Describe="",a.LAYERS=[];var o=a.LAYERS[a.LAYERS.length]={};o._Count=r.length,o.Layer=[];for(var s=0;s<r.length;s++){var u=n.get(r[s]),l=o.Layer[o.Layer.length]={};l._Name=u.name,l._Visible="TRUE",l._Describe="",l._IsLayerActive=this.activeLayer===r[s],l.SYMBOLS=[];var c=l.SYMBOLS[l.SYMBOLS.length]={};c._Count=u.primitives.length,c.Symbol=[],l._Count=u.primitives.length,kg(this,u,c)}return this.actionGroups&&(t.SITSYMBOLFILE.ACTIONGROUPS=this.actionGroups),t},Gg.prototype.exportLayerData=function(e,t){var i={SITSYMBOLFILE:{LAYGROUPS:{_Count:1,LayerGroup:[]}}},n=this.layerGroupMap.get(e),r=i.SITSYMBOLFILE.LAYGROUPS,a=r.LayerGroup[r.LayerGroup.length]={};a._Name=n.name,a._Visible="TRUE",a._Describe="",a.LAYERS=[];var o=a.LAYERS[a.LAYERS.length]={},s=n.get(t);o._Count=1,o.Layer=[];var u=o.Layer[o.Layer.length]={};u._Name=s.name,u._Visible="TRUE",u._Describe="",u._IsLayerActive=this.activeLayer===t,u.SYMBOLS=[];var l=u.SYMBOLS[u.SYMBOLS.length]={};return l._Count=s.primitives.length,l.Symbol=[],u._Count=s.primitives.length,kg(this,s,l),this.actionGroups&&(i.SITSYMBOLFILE.ACTIONGROUPS=this.actionGroups),i},Gg.prototype.getAllGeometryInfo=function(){var e={};for(var t in this.geometryGroup)"size"!==t&&(e[t]={positions:this.geometryGroup[t].positions,id:this.geometryGroup[t].code.split(",")[0],code:this.geometryGroup[t].code.split(",")[1]});return e},Gg.prototype.getPrimitives=function(){return this.primitives},Gg.prototype.getPrimitive=function(e){return this.geometryGroup[e]},Gg.prototype.getActiveGroups=function(){return actionGroups},Gg.prototype.createGuid=Ss,Gg.prototype.removeLayerGeometry=function(e){var t=e.primitives.length;if(0<this.geometryGroup.size)for(var i=0;i<t;i++)this.geometryGroup[e.primitives[i]].destroy(),delete this.geometryGroup[e.primitives[i]],this.geometryGroup.size=this.geometryGroup.size-1},Hg.prototype.set=function(e,t){try{null!=e&&""!=e&&(this._c.has(e)||this.size++),this._c.set(e,t)}catch(e){return e}},Hg.prototype.get=function(e){try{return this._c.get(e)}catch(e){return e}},Hg.prototype.has=function(e){try{return!!a._c.has(e)}catch(e){return e}},Hg.prototype.delete=function(e){try{this._c.delete(e),this.size--}catch(e){return e}},Hg.prototype.clear=function(){try{this._c.clear(),this.size=0}catch(e){return e}},Hg.prototype.keyArray=function(){var i=new Array;return this.forEach(function(e,t){i.push(t)}),i},Hg.prototype.size=function(){return this.keyArray().length},Hg.prototype.forEach=function(e,t,i){this._c.forEach(e,t,i)},Gg.prototype.openProgramme=function(e,t){console.log(e);var i=[],n=e.SITSYMBOLFILE.LAYGROUPS;console.log(n);var r=[];this.actionGroups=null;for(var a=0;a<n._Count;++a){var o=this.createGuid(),s=n.LayerGroup[a]||n.LayerGroup,u=s._Name;ev_DrawHelper.ev_milStdLayerManager.addLayerGroup(o,u);for(var l={id:o,label:u+"_导入",type:"milStdLayerGroup",children:[]},c=0;c<s.LAYERS._Count;++c){var m=this.createGuid(),d=s.LAYERS.Layer[c]||s.LAYERS.Layer,h=d._Name;ev_DrawHelper.ev_milStdLayerManager.addLayer(o,m,h);var f={id:m,label:h+"_导入",type:"milStdLayer",children:[]};l.children.push(f),d.IsLayerActive;for(var p=0;p<d.SYMBOLS._Count;p++){var _=this.createGuid(),C=d.SYMBOLS.Symbol[p]||d.SYMBOLS.Symbol;C.groupId=o,C.layerId=m,C.id=_,r.push(C)}}i.push(l)}t(i,r)},Gg.prototype.mergeDefaulData=function(e,t){for(var i=0;i<t.length;i++){var n=e.children.map(function(e){return e.label}).indexOf(t[i].label);if(-1==n)e.children.push(t[i]);else for(var r=0;r<t[i].children.length;r++){-1==e.children[n].children.map(function(e){return e.label}).indexOf(t[i].children[r].label)||(t[i].children[r].label=t[i].children[r].label+"_导入"),e.children[n].children.push(t[i].children[r])}}return e},Wg.prototype.updatePrimitive=function(e){for(var t in e){var i=this.primitiveGroup[t];if(!i)return;i.show=!0;for(var n=[],r=[],a=0;a<e[t].length;++a)0===e[t][a].type?n.push(i.createGeometryInstance(e[t][a].geometry,i.mainLineColor,"mainLine"+a)):i.isFill&&r.push(i.createGeometryInstance(e[t][a].geometry,i.fillColor,"fill"));i._primitive&&i._primitive.destroy(),i._primitive=new Cesium.Primitive({geometryInstances:n,appearance:i.appearance,asynchronous:!1}),0<r.length&&(i._framePrimitive&&i._framePrimitive.destroy(),i._framePrimitive=new Cesium.Primitive({geometryInstances:r,appearance:i.frameAppearance,asynchronous:!1}))}},Wg.prototype.actionHandle=function(i){var e=void 0,t=void 0;switch(i.Type){case 1:t=this.primitiveGroup[i.SymbolGuid]||this.geometries[i.SymbolGuid],qg(0,i.BlinkInterval*i.DurationTime,i.StartTime,i.DurationTime,function(e){e&&(this.geometries[i.SymbolGuid].show=Boolean(Math.round(e.value%1)))});break;case 2:qg(0,360,i.StartTime,i.DurationTime,function(e){e&&(this.geometries[i.SymbolGuid].varyRotation=e.value)});break;case 3:qg(0,1,i.StartTime,i.DurationTime,function(e){e&&(this.geometries[i.SymbolGuid].varyScale=e.value)});break;case 4:qg(1,0,i.StartTime,i.DurationTime,function(e){e&&(this.geometries[i.SymbolGuid].varyScale=e.value)});break;case 5:this.primitiveGroup[i.SymbolGuid]=new Vg,this.primitiveGroup[i.SymbolGuid].mainLineColor=this.geometries[i.SymbolGuid].mainLineColor,this.primitiveGroup[i.SymbolGuid].fillColor=this.geometries[i.SymbolGuid].fillColor,this.primitiveGroup[i.SymbolGuid].isFill=this.geometries[i.SymbolGuid].isFill,this.primitiveGroup[i.SymbolGuid]._primitives=this.primitives,this.primitives.add(this.primitiveGroup[i.SymbolGuid]),this.primitiveGroup[i.SymbolGuid].show=!1,e=i;break;case 6:t=this.primitiveGroup[i.SymbolGuid]||this.geometries[i.SymbolGuid],qg(0,1,i.StartTime,i.DurationTime,function(e){e&&(t.varyAlpha=e.value)});break;case 7:t=this.primitiveGroup[i.SymbolGuid]||this.geometries[i.SymbolGuid],qg(1,0,i.StartTime,i.DurationTime,function(e){e&&(t.varyAlpha=e.value)});break;case 8:!function(t,i,e,n,r,a){if(this.geometries[i].mainLinePositions[0]){this.geometries[i].show=Boolean(a);for(var o=this.geometries[i].mainLinePositions[0].map(bt),s=0,u=1;u<o.length;++u)s+=Math.pow(Math.pow(o[u].lon-o[u-1].lon,2)+Math.pow(o[u].lat-o[u-1].lat,2),.5);for(var l=1;l<o.length;++l){var c=Math.pow(Math.pow(o[l].lon-o[l-1].lon,2)+Math.pow(o[l].lat-o[l-1].lat,2),.5)/s*n,m=jg([[o[l-1].lat,o[l-1].lon],[o[l].lat,o[l].lon]])+r-this.geometries[t].rotation+90;this.tweens.add({startObject:{lon:o[l-1].lon,lat:o[l-1].lat},stopObject:{lon:o[l].lon,lat:o[l].lat},delay:1e3*e,duration:1e3*c,easingFunction:Cesium.EasingFunction.LINEAR,update:function(e){this.geometries[t]._actionRotation=m,this.geometries[t].varyPosition=Cesium.Cartesian3.fromDegrees(e.lon,e.lat,this.geometries[i].distanceLegend*this.geometries[i].height)}}),e+=c}}}(i.SymbolGuid,i.RouteBindGuid,i.StartTime,i.DurationTime,i.RotateCorrect,i.IsVisibleRoute);break;case 9:qg(0,0,i.StartTime,.001,function(e){var t=i.Altitude/(Math.cos(i.Tilt/180*Math.PI)*Math.cos(i.Heading/180*Math.PI));this.camera.lookAt(Cesium.Cartesian3.fromDegrees(i.Longitude,i.Latitude,i.ModitifAltitude),new Cesium.HeadingPitchRange(i.Heading/180*Math.PI,(i.Tilt-90)/180*Math.PI,t))});break;case 10:t=this.primitiveGroup[i.SymbolGuid]||this.geometries[i.SymbolGuid],qg(!0,!0,i.StartTime,.001,function(e){e&&(this.geometries[i.SymbolGuid].show=e.value)});break;case 11:t=this.primitiveGroup[i.SymbolGuid]||this.geometries[i.SymbolGuid],qg(!1,!1,i.StartTime,.001,function(e){e&&(this.geometries[i.SymbolGuid].show=e.value)})}return e},Wg.prototype.startDeduce=function(t,e){if(Cesium.defined(this.startTime))return this.startTime+=(new Date).getTime()-this.suspendTime,void(this.deduceState=!0);Cesium.defined(t)||(t=this.viewer.scene),this.camera=t.camera,this.stopDeduceCallBack=e;var i=this.ev_milStdLayerManager.getActiveGroups();if(!i)return"none";var n=Cesium.when.defer(),r=[];this.deduceTime=-1/0;var a=this.ev_milStdLayerManager.getAllGeometryInfo();this.geometries=this.ev_milStdLayerManager.getAllGeometry(),t.primitives.contains(this.primitives)||t.primitives.add(this.primitives),this.primitives.removeAll();for(var o=0;o<i.length;++o)for(var s=i[o].Group,u=0;u<s.length;++u){var l=actionHandle(s[u]);l&&r.push(l),this.deduceTime=Math.max(this.deduceTime,1e3*(s[u].StartTime+s[u].DurationTime))}return 0<r.length?(Worker.postMessage({url:localStorage.get("apiUrl").deduce,content:r,geometryInfo:a}),Worker.onmessage=function(e){"END"===e.data?(n.resolve("start"),start(t)):this.geometryData.push(e.data)}):(setTimeout(function(){n.resolve("start")},0),start(t)),n.promise},Wg.prototype.start=function(e){var t;this.ev_milStdLayerManager.showAllGeometry([]),this.startTime=(new Date).getTime(),this.preRenderListener=e.preRender.addEventListener(function(){var e;this.deduceState&&((t=(new Date).getTime())-this.startTime>this.deduceTime+200?stopDeduce():((e=Math.round((t-this.startTime)/100))<this.geometryData.length&&this.geometryData[e]&&this.geometryData[e]&&updatePrimitive(this.geometryData[e]),this.tweens.update(t-this.startTime)))})},Wg.prototype.suspendDeduce=function(){this.deduceState=!1,this.suspendTime=(new Date).getTime()},Wg.prototype.stopDeduce=function(){for(var e in this.preRenderListener&&this.preRenderListener(),this.primitiveGroup)this.primitiveGroup[e].destroy();for(var e in this.primitiveGroup={},this.geometries)Cesium.defined(this.geometries[e]._varyScale)&&(this.geometries[e].varyScale=1),Cesium.defined(this.geometries[e]._varyRotation)&&(this.geometries[e].varyRotation=0),Cesium.defined(this.geometries[e]._varyPosition)&&(this.geometries[e].varyPosition=null),Cesium.defined(this.geometries[e]._varyAlpha)&&(this.geometries[e].varyAlpha=1),Cesium.defined(this.geometries[e]._actionRotation)&&(this.geometries[e]._actionRotation=0);this.geometryData=[],this.ev_milStdLayerManager.showAllGeometry(),this.tweens.removeAll(),this.suspendTime=0,this.startTime=0,this.deduceState=!0,this.camera&&this.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this.stopDeduceCallBack&&(this.stopDeduceCallBack(),this.stopDeduceCallBack=null)};var Yg=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2,EV_ARC:3});function Xg(e,t,i){i=i||2;var n,r,a,o,s,u,l,c=t&&t.length,m=c?t[0]*i:e.length,d=Kg(e,0,m,i,!0),h=[];if(!d||d.next===d.prev)return h;if(c&&(d=function(e,t,i,n){var r,a,o,s,u,l=[];for(r=0,a=t.length;r<a;r++)o=t[r]*n,s=r<a-1?t[r+1]*n:e.length,(u=Kg(e,o,s,n,!1))===u.next&&(u.steiner=!0),l.push(av(u));for(l.sort(iv),r=0;r<l.length;r++)nv(l[r],i),i=Zg(i,i.next);return i}(e,t,d,i)),e.length>80*i){n=a=e[0],r=o=e[1];for(var f=i;f<m;f+=i)(s=e[f])<n&&(n=s),(u=e[f+1])<r&&(r=u),a<s&&(a=s),o<u&&(o=u);l=0!==(l=Math.max(a-n,o-r))?1/l:0}return Jg(d,h,i,n,r,l),h}function Kg(e,t,i,n,r){var a,o;if(r===0<Cv(e,t,i,n))for(a=t;a<i;a+=n)o=fv(a,e[a],e[a+1],o);else for(a=i-n;t<=a;a-=n)o=fv(a,e[a],e[a+1],o);return o&&uv(o,o.next)&&(pv(o),o=o.next),o}function Zg(e,t){if(!e)return e;t=t||e;var i,n=e;do{if(i=!1,n.steiner||!uv(n,n.next)&&0!==sv(n.prev,n,n.next))n=n.next;else{if(pv(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function Jg(e,t,i,n,r,a,o){if(e){!o&&a&&function(e,t,i,n){var r=e;for(;null===r.z&&(r.z=rv(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==e;);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,a,o,s,u,l=1;do{for(i=e,a=e=null,o=0;i;){for(o++,n=i,t=s=0;t<l&&(s++,n=n.nextZ);t++);for(u=l;0<s||0<u&&n;)0!==s&&(0===u||!n||i.z<=n.z)?(i=(r=i).nextZ,s--):(n=(r=n).nextZ,u--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=n}a.nextZ=null,l*=2}while(1<o)}(r)}(e,n,r,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?$g(e,n,r,a):Qg(e))t.push(s.i/i),t.push(e.i/i),t.push(u.i/i),pv(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?Jg(e=ev(Zg(e),t,i),t,i,n,r,a,2):2===o&&tv(e,t,i,n,r,a):Jg(Zg(e),t,i,n,r,a,1);break}}}function Qg(e){var t=e.prev,i=e,n=e.next;if(!(0<=sv(t,i,n))){for(var r=e.next.next;r!==e.prev;){if(ov(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=sv(r.prev,r,r.next))return;r=r.next}return 1}}function $g(e,t,i,n){var r=e.prev,a=e,o=e.next;if(!(0<=sv(r,a,o))){for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,u=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,m=rv(s,u,t,i,n),d=rv(l,c,t,i,n),h=e.prevZ,f=e.nextZ;h&&h.z>=m&&f&&f.z<=d;){if(h!==e.prev&&h!==e.next&&ov(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&0<=sv(h.prev,h,h.next))return;if(h=h.prevZ,f!==e.prev&&f!==e.next&&ov(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=sv(f.prev,f,f.next))return;f=f.nextZ}for(;h&&h.z>=m;){if(h!==e.prev&&h!==e.next&&ov(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&0<=sv(h.prev,h,h.next))return;h=h.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&ov(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&0<=sv(f.prev,f,f.next))return;f=f.nextZ}return 1}}function ev(e,t,i){var n=e;do{var r=n.prev,a=n.next.next;!uv(r,a)&&lv(r,n,n.next,a)&&dv(r,a)&&dv(a,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(a.i/i),pv(n),pv(n.next),n=e=a),n=n.next}while(n!==e);return Zg(n)}function tv(e,t,i,n,r,a){var o,s,u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&(s=l,(o=u).next.i!==s.i&&o.prev.i!==s.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&lv(i,i.next,e,t))return 1;i=i.next}while(i!==e);return}(o,s)&&(dv(o,s)&&dv(s,o)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;for(;i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==e;);return n}(o,s)&&(sv(o.prev,o,s.prev)||sv(o,s.prev,s))||uv(o,s)&&0<sv(o.prev,o,o.next)&&0<sv(s.prev,s,s.next)))){var c=hv(u,l),u=Zg(u,u.next),c=Zg(c,c.next);return Jg(u,t,i,n,r,a),void Jg(c,t,i,n,r,a)}l=l.next}u=u.next}while(u!==e)}function iv(e,t){return e.x-t.x}function nv(e,t){var i;(t=function(e,t){var i,n=t,r=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&o<s){if((o=s)===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===o)return i;var u,l=i,c=i.x,m=i.y,d=1/0;n=i;for(;r>=n.x&&n.x>=c&&r!==n.x&&ov(a<m?r:o,a,c,m,a<m?o:r,a,n.x,n.y)&&(u=Math.abs(a-n.y)/(r-n.x),dv(n,e)&&(u<d||u===d&&(n.x>i.x||n.x===i.x&&(f=n,sv((h=i).prev,h,f.prev)<0&&sv(f.next,h,h.next)<0)))&&(i=n,d=u)),n=n.next,n!==l;);var h,f;return i}(e,t))&&Zg(i=hv(t,e),i.next)}function rv(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function av(e){for(var t=e,i=e;(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),(t=t.next)!==e;);return i}function ov(e,t,i,n,r,a,o,s){return 0<=(r-o)*(t-s)-(e-o)*(a-s)&&0<=(e-o)*(n-s)-(i-o)*(t-s)&&0<=(i-o)*(a-s)-(r-o)*(n-s)}function sv(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function uv(e,t){return e.x===t.x&&e.y===t.y}function lv(e,t,i,n){var r=mv(sv(e,t,i)),a=mv(sv(e,t,n)),o=mv(sv(i,n,e)),s=mv(sv(i,n,t));return r!==a&&o!==s||(0===r&&cv(e,i,t)||(0===a&&cv(e,n,t)||(0===o&&cv(i,e,n)||!(0!==s||!cv(i,t,n)))))}function cv(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function mv(e){return 0<e?1:e<0?-1:0}function dv(e,t){return sv(e.prev,e,e.next)<0?0<=sv(e,t,e.next)&&0<=sv(e,e.prev,t):sv(e,t,e.prev)<0||sv(e,e.next,t)<0}function hv(e,t){var i=new _v(e.i,e.x,e.y),n=new _v(t.i,t.x,t.y),r=e.next,a=t.prev;return(e.next=t).prev=e,(i.next=r).prev=i,(n.next=i).prev=n,(a.next=n).prev=a,n}function fv(e,t,i,n){var r=new _v(e,t,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r}function pv(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _v(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Cv(e,t,i,n){for(var r=0,a=t,o=i-n;a<i;a+=n)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}function gv(e,t,i){if(0===e)return t*i;var n=e*e,r=n*n,a=r*n,o=a*n,s=o*n,u=s*n,l=i;return t*((1-n/4-3*r/64-5*a/256-175*o/16384-441*s/65536-4851*u/1048576)*l-(3*n/8+3*r/32+45*a/1024+105*o/4096+2205*s/131072+6237*u/524288)*Math.sin(2*l)+(15*r/256+45*a/1024+525*o/16384+1575*s/65536+155925*u/8388608)*Math.sin(4*l)-(35*a/3072+175*o/12288+3675*s/262144+13475*u/1048576)*Math.sin(6*l)+(315*o/131072+2205*s/524288+43659*u/8388608)*Math.sin(8*l)-(693*s/1310720+6237*u/5242880)*Math.sin(10*l)+1001*u/8388608*Math.sin(12*l))}function vv(e,t){if(0===e)return Math.log(Math.tan(.5*(ri.PI_OVER_TWO+t)));var i=e*Math.sin(t);return Math.log(Math.tan(.5*(ri.PI_OVER_TWO+t)))-e/2*Math.log((1+i)/(1-i))}Xg.deviation=function(e,t,i,n){var r=t&&t.length,a=r?t[0]*i:e.length,o=Math.abs(Cv(e,0,a,i));if(r)for(var s=0,u=t.length;s<u;s++){var l=t[s]*i,c=s<u-1?t[s+1]*i:e.length;o-=Math.abs(Cv(e,l,c,i))}for(var m=0,s=0;s<n.length;s+=3){var d=n[s]*i,h=n[s+1]*i,f=n[s+2]*i;m+=Math.abs((e[d]-e[f])*(e[1+h]-e[1+d])-(e[d]-e[h])*(e[1+f]-e[1+d]))}return 0===o&&0===m?0:Math.abs((m-o)/o)},Xg.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var o=0;o<t;o++)i.vertices.push(e[r][a][o]);0<r&&(n+=e[r-1].length,i.holes.push(n))}return i};var yv=new si,Tv=new si;function xv(e,t,i,n){si.normalize(n.cartographicToCartesian(t,Tv),yv),si.normalize(n.cartographicToCartesian(i,Tv),Tv);var r,a,o,s,u,l,c,m,d,h,f,p,_,C,g,v,y,T,x,w=n.maximumRadius,A=n.minimumRadius,E=w*w,S=A*A;e._ellipticitySquared=(E-S)/E,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=dr.clone(t,e._start),e._start.height=0,e._end=dr.clone(i,e._end),e._end.height=0,e._heading=(r=e,a=t.longitude,o=t.latitude,s=i.longitude,u=i.latitude,l=vv(r._ellipticity,o),c=vv(r._ellipticity,u),Math.atan2(ri.negativePiToPi(s-a),c-l)),e._distance=(m=e,d=n.maximumRadius,h=n.minimumRadius,f=t.longitude,p=t.latitude,_=i.longitude,C=i.latitude,y=m._heading,T=_-f,x=0,x=ri.equalsEpsilon(Math.abs(y),ri.PI_OVER_TWO,ri.EPSILON8)?d===h?d*Math.cos(p)*ri.negativePiToPi(T):(g=Math.sin(p),d*Math.cos(p)*ri.negativePiToPi(T)/Math.sqrt(1-m._ellipticitySquared*g*g)):(v=gv(m._ellipticity,d,p),(gv(m._ellipticity,d,C)-v)/Math.cos(y)),Math.abs(x))}function wv(e,t,i,n,r,a){var o,s,u,l,c,m,d=r*r;return c=Math.abs(ri.PI_OVER_TWO-Math.abs(t))>ri.EPSILON8?(o=function(e,t,i){var n=e/i;if(0===t)return n;var r=n*n,a=r*n,o=a*n,s=t*t,u=s*s,l=u*s,c=l*s,m=c*s,d=m*s,h=Math.sin(2*n),f=Math.cos(2*n),p=Math.sin(4*n),_=Math.cos(4*n),C=Math.sin(6*n),g=Math.cos(6*n),v=Math.sin(8*n),y=Math.cos(8*n),T=Math.sin(10*n);return n+n*s/4+7*n*u/64+15*n*l/256+579*n*c/16384+1515*n*m/65536+16837*n*d/1048576+(3*n*u/16+45*n*l/256-n*(32*r-561)*c/4096-n*(232*r-1677)*m/16384+n*(399985-90560*r+512*o)*d/5242880)*f+(21*n*l/256+483*n*c/4096-n*(224*r-1969)*m/16384-n*(33152*r-112599)*d/1048576)*_+(151*n*c/4096+4681*n*m/65536+1479*n*d/16384-453*a*d/32768)*g+(1097*n*m/65536+42783*n*d/1048576)*y+8011*n*d/1048576*Math.cos(10*n)+(3*s/8+3*u/16+213*l/2048-3*r*l/64+255*c/4096-33*r*c/512+20861*m/524288-33*r*m/512+o*m/1024+28273*d/1048576-471*r*d/8192+9*o*d/4096)*h+(21*u/256+21*l/256+533*c/8192-21*r*c/512+197*m/4096-315*r*m/4096+584039*d/16777216-12517*r*d/131072+7*o*d/2048)*p+(151*l/6144+151*c/4096+5019*m/131072-453*r*m/16384+26965*d/786432-8607*r*d/131072)*C+(1097*c/131072+1097*m/65536+225797*d/10485760-1097*r*d/65536)*v+(8011*m/2621440+8011*d/1048576)*T+293393*d/251658240*Math.sin(12*n)}(gv(r,n,e.latitude)+i*Math.cos(t),r,n),s=vv(r,e.latitude),u=vv(r,o),l=Math.tan(t)*(u-s),ri.negativePiToPi(e.longitude+l)):(o=e.latitude,l=i/(0===r?n*Math.cos(e.latitude):(m=Math.sin(e.latitude),n*Math.cos(e.latitude)/Math.sqrt(1-d*m*m))),0<t?ri.negativePiToPi(e.longitude+l):ri.negativePiToPi(e.longitude-l)),oe(a)?(a.longitude=c,a.latitude=o,a.height=0,a):new dr(c,o,0)}function Av(e,t,i){var n=z(i,gr.WGS84);this._ellipsoid=n,this._start=new dr,this._end=new dr,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,oe(e)&&oe(t)&&xv(this,e,t,n)}function Ev(e){e=z(e,z.EMPTY_OBJECT),this.componentDatatype=e.componentDatatype,this.componentsPerAttribute=e.componentsPerAttribute,this.normalize=z(e.normalize,!1),this.values=e.values}Object.defineProperties(Av.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){return this._heading}}}),Av.fromStartHeadingDistance=function(e,t,i,n,r){var a=z(n,gr.WGS84),o=a.maximumRadius,s=a.minimumRadius,u=o*o,l=s*s,c=Math.sqrt((u-l)/u),m=wv(e,t=ri.negativePiToPi(t),i,a.maximumRadius,c);return!oe(r)||oe(n)&&!n.equals(r.ellipsoid)?new Av(e,m,a):(r.setEndPoints(e,m),r)},Av.prototype.setEndPoints=function(e,t){xv(this,e,t,this._ellipsoid)},Av.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)},Av.prototype.interpolateUsingSurfaceDistance=function(e,t){return wv(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)},Av.prototype.findIntersectionWithLongitude=function(e,t){var i=this._ellipticity,n=this._heading,r=Math.abs(n),a=this._start;if(e=ri.negativePiToPi(e),ri.equalsEpsilon(Math.abs(e),Math.PI,ri.EPSILON14)&&(e=ri.sign(a.longitude)*Math.PI),oe(t)||(t=new dr),Math.abs(ri.PI_OVER_TWO-r)<=ri.EPSILON8)return t.longitude=e,t.latitude=a.latitude,t.height=0,t;if(ri.equalsEpsilon(Math.abs(ri.PI_OVER_TWO-r),ri.PI_OVER_TWO,ri.EPSILON8)){if(ri.equalsEpsilon(e,a.longitude,ri.EPSILON12))return;return t.longitude=e,t.latitude=ri.PI_OVER_TWO*ri.sign(ri.PI_OVER_TWO-n),t.height=0,t}var o,s=a.latitude,u=i*Math.sin(s),l=Math.tan(.5*(ri.PI_OVER_TWO+s))*Math.exp((e-a.longitude)/Math.tan(n)),c=(1+u)/(1-u),m=a.latitude;do{o=m;var d=i*Math.sin(o),h=(1+d)/(1-d),m=2*Math.atan(l*Math.pow(h/c,i/2))-ri.PI_OVER_TWO}while(!ri.equalsEpsilon(m,o,ri.EPSILON12));return t.longitude=e,t.latitude=m,t.height=0,t},Av.prototype.findIntersectionWithLatitude=function(e,t){var i=this._ellipticity,n=this._heading,r=this._start;if(!ri.equalsEpsilon(Math.abs(n),ri.PI_OVER_TWO,ri.EPSILON8)){var a=vv(i,r.latitude),o=vv(i,e),s=Math.tan(n)*(o-a),u=ri.negativePiToPi(r.longitude+s);return oe(t)?(t.longitude=u,t.latitude=e,t.height=0,t):new dr(u,e,0)}};var Sv=new si,bv=new si,Mv={computeArea2D:function(e){for(var t=e.length,i=0,n=t-1,r=0;r<t;n=r++){var a=e[n],o=e[r];i+=a.x*o.y-o.x*a.y}return.5*i},computeWindingOrder2D:function(e){return 0<Mv.computeArea2D(e)?th.COUNTER_CLOCKWISE:th.CLOCKWISE},triangulate:function(e,t){return Xg(ha.packArray(e),t,2)}},Rv=new si,Dv=new si,Pv=new si,Iv=new si,Ov=new si,Lv=new si,Nv=new si;Mv.computeSubdivision=function(e,t,i,n){n=z(n,ri.RADIANS_PER_DEGREE);for(var r=i.slice(0),a=t.length,o=new Array(3*a),s=0,u=0;u<a;u++){var l=t[u];o[s++]=l.x,o[s++]=l.y,o[s++]=l.z}for(var c=[],m={},d=e.maximumRadius,h=ri.chordLength(n,d),f=h*h;0<r.length;){var p,_,C=r.pop(),g=r.pop(),v=r.pop(),y=si.fromArray(o,3*v,Rv),T=si.fromArray(o,3*g,Dv),x=si.fromArray(o,3*C,Pv),w=si.multiplyByScalar(si.normalize(y,Iv),d,Iv),A=si.multiplyByScalar(si.normalize(T,Ov),d,Ov),E=si.multiplyByScalar(si.normalize(x,Lv),d,Lv),S=si.magnitudeSquared(si.subtract(w,A,Nv)),b=si.magnitudeSquared(si.subtract(A,E,Nv)),M=si.magnitudeSquared(si.subtract(E,w,Nv)),R=Math.max(S,b,M);f<R?S===R?(oe(u=m[p=Math.min(v,g)+" "+Math.max(v,g)])||(_=si.add(y,T,Nv),si.multiplyByScalar(_,.5,_),o.push(_.x,_.y,_.z),u=o.length/3-1,m[p]=u),r.push(v,u,C),r.push(u,g,C)):b===R?(oe(u=m[p=Math.min(g,C)+" "+Math.max(g,C)])||(_=si.add(T,x,Nv),si.multiplyByScalar(_,.5,_),o.push(_.x,_.y,_.z),u=o.length/3-1,m[p]=u),r.push(g,u,v),r.push(u,C,v)):M===R&&(oe(u=m[p=Math.min(C,v)+" "+Math.max(C,v)])||(_=si.add(x,y,Nv),si.multiplyByScalar(_,.5,_),o.push(_.x,_.y,_.z),u=o.length/3-1,m[p]=u),r.push(C,u,g),r.push(u,v,g)):(c.push(v),c.push(g),c.push(C))}return new rp({attributes:{position:new Ev({componentDatatype:Ud.DOUBLE,componentsPerAttribute:3,values:o})},indices:c,primitiveType:Yd.TRIANGLES})};var Bv=new dr,zv=new dr,Fv=new dr,Vv=new dr;function Uv(e){e=z(e,z.EMPTY_OBJECT),this.position=e.position,this.normal=e.normal,this.st=e.st,this.bitangent=e.bitangent,this.tangent=e.tangent,this.color=e.color}Mv.computeRhumbLineSubdivision=function(e,t,i,n){n=z(n,ri.RADIANS_PER_DEGREE);for(var r=i.slice(0),a=t.length,o=new Array(3*a),s=0,u=0;u<a;u++){var l=t[u];o[s++]=l.x,o[s++]=l.y,o[s++]=l.z}for(var c=[],m={},d=e.maximumRadius,h=ri.chordLength(n,d),f=new Av(void 0,void 0,e),p=new Av(void 0,void 0,e),_=new Av(void 0,void 0,e);0<r.length;){var C=r.pop(),g=r.pop(),v=r.pop(),y=si.fromArray(o,3*v,Rv),T=si.fromArray(o,3*g,Dv),x=si.fromArray(o,3*C,Pv),w=e.cartesianToCartographic(y,Bv),A=e.cartesianToCartographic(T,zv),E=e.cartesianToCartographic(x,Fv);f.setEndPoints(w,A);var S=f.surfaceDistance;p.setEndPoints(A,E);var b=p.surfaceDistance;_.setEndPoints(E,w);var M,R,D,P,I=_.surfaceDistance,O=Math.max(S,b,I);h<O?S===O?(oe(u=m[M=Math.min(v,g)+" "+Math.max(v,g)])||(R=f.interpolateUsingFraction(.5,Vv),D=.5*(w.height+A.height),P=si.fromRadians(R.longitude,R.latitude,D,e,Nv),o.push(P.x,P.y,P.z),u=o.length/3-1,m[M]=u),r.push(v,u,C),r.push(u,g,C)):b===O?(oe(u=m[M=Math.min(g,C)+" "+Math.max(g,C)])||(R=p.interpolateUsingFraction(.5,Vv),D=.5*(A.height+E.height),P=si.fromRadians(R.longitude,R.latitude,D,e,Nv),o.push(P.x,P.y,P.z),u=o.length/3-1,m[M]=u),r.push(g,u,v),r.push(u,C,v)):I===O&&(oe(u=m[M=Math.min(C,v)+" "+Math.max(C,v)])||(R=_.interpolateUsingFraction(.5,Vv),D=.5*(E.height+w.height),P=si.fromRadians(R.longitude,R.latitude,D,e,Nv),o.push(P.x,P.y,P.z),u=o.length/3-1,m[M]=u),r.push(C,u,g),r.push(u,v,g)):(c.push(v),c.push(g),c.push(C))}return new rp({attributes:{position:new Ev({componentDatatype:Ud.DOUBLE,componentsPerAttribute:3,values:o})},indices:c,primitiveType:Yd.TRIANGLES})},Mv.scaleToGeodeticHeight=function(e,t,i,n){i=z(i,gr.WGS84);var r=Sv,a=bv;if(t=z(t,0),n=z(n,!0),oe(e))for(var o=e.length,s=0;s<o;s+=3)si.fromArray(e,s,a),n&&(a=i.scaleToGeodeticSurface(a,a)),0!==t&&(r=i.geodeticSurfaceNormal(a,r),si.multiplyByScalar(r,t,r),si.add(a,r,a)),e[s]=a.x,e[s+1]=a.y,e[s+2]=a.z;return e};var Gv=new si,kv=new si,Hv=new si;var Wv={};function qv(e,t,i){var n=e+t;return ri.sign(e)!==ri.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}Wv.computeDiscriminant=function(e,t,i){return t*t-4*e*i},Wv.computeRealRoots=function(e,t,i){var n;if(0===e)return 0===t?[]:[-i/t];if(0===t){if(0===i)return[0,0];var r=Math.abs(i),a=Math.abs(e);if(r<a&&r/a<ri.EPSILON14)return[0,0];if(a<r&&a/r<ri.EPSILON14)return[];if((n=-i/e)<0)return[];var o=Math.sqrt(n);return[-o,o]}if(0===i)return(n=-t/e)<0?[n,0]:[0,n];var s=qv(t*t,-(4*e*i),ri.EPSILON14);if(s<0)return[];var u=-.5*qv(t,ri.sign(t)*Math.sqrt(s),ri.EPSILON14);return 0<t?[u/e,i/u]:[i/u,u/e]};var jv={};function Yv(e,t,i,n){var r=e,a=t/3,o=i/3,s=n,u=r*o,l=a*s,c=a*a,m=o*o,d=r*o-c,h=r*s-a*o,f=a*s-m,p=4*d*f-h*h;if(p<0){var _,C,g,v=u*m<=c*l?-2*a*(C=d)+(_=r)*h:-(_=s)*h+2*o*(C=f),y=-(v<0?-1:1)*Math.abs(_)*Math.sqrt(-p),T=(g=y-v)/2,x=T<0?-Math.pow(-T,1/3):Math.pow(T,1/3),w=g===y?-x:-C/x,A=C<=0?x+w:-v/(x*x+w*w+C);return u*m<=c*l?[(A-a)/r]:[-s/(A+o)]}var E=d,S=-2*a*d+r*h,b=f,M=-s*h+2*o*f,R=Math.sqrt(p),D=Math.sqrt(3)/2,P=Math.abs(Math.atan2(r*R,-S)/3);A=2*Math.sqrt(-E);var I=Math.cos(P);g=A*I;var O=A*(-I/2-D*Math.sin(P)),L=2*a<g+O?g-a:O-a,N=r,B=L/N,P=Math.abs(Math.atan2(s*R,-M)/3),z=-s,F=(g=(A=2*Math.sqrt(-b))*(I=Math.cos(P)))+(O=A*(-I/2-D*Math.sin(P)))<2*o?g+o:O+o,V=z/F,U=-L*F-N*z,G=(o*U-a*(L*z))/(-a*U+o*(N*F));return B<=G?B<=V?G<=V?[B,G,V]:[B,V,G]:[V,B,G]:B<=V?[G,B,V]:G<=V?[G,V,B]:[V,G,B]}jv.computeDiscriminant=function(e,t,i,n){var r=t*t,a=i*i;return 18*e*t*i*n+r*a-27*(e*e)*(n*n)-4*(e*a*i+r*t*n)},jv.computeRealRoots=function(e,t,i,n){var r,a;if(0===e)return Wv.computeRealRoots(t,i,n);if(0!==t)return 0===i?0===n?(a=-t/e)<0?[a,0,0]:[0,0,a]:Yv(e,t,0,n):0===n?0===(r=Wv.computeRealRoots(e,t,i)).length?[0]:r[1]<=0?[r[0],r[1],0]:0<=r[0]?[0,r[0],r[1]]:[r[0],0,r[1]]:Yv(e,t,i,n);if(0!==i)return 0===n?0===(r=Wv.computeRealRoots(e,0,i)).Length?[0]:[r[0],0,r[1]]:Yv(e,0,i,n);if(0===n)return[0,0,0];var o=(a=-n/e)<0?-Math.pow(-a,1/3):Math.pow(a,1/3);return[o,o,o]};var Xv={};function Kv(e,t,i,n){var r=e*e,a=t-3*r/8,o=i-t*e/2+r*e/8,s=n-i*e/4+t*r/16-3*r*r/256,u=jv.computeRealRoots(1,2*a,a*a-4*s,-o*o);if(0<u.length){var l=-e/4,c=u[u.length-1];if(Math.abs(c)<ri.EPSILON14){var m=Wv.computeRealRoots(1,a,s);if(2===m.length){var d,h=m[0],f=m[1];if(0<=h&&0<=f){var p=Math.sqrt(h),_=Math.sqrt(f);return[l-_,l-p,l+p,l+_]}if(0<=h&&f<0)return[l-(d=Math.sqrt(h)),l+d];if(h<0&&0<=f)return[l-(d=Math.sqrt(f)),l+d]}return[]}if(0<c){var C=Math.sqrt(c),g=(a+c-o/C)/2,v=(a+c+o/C)/2,y=Wv.computeRealRoots(1,C,g),T=Wv.computeRealRoots(1,-C,v);return 0!==y.length?(y[0]+=l,y[1]+=l,0!==T.length?(T[0]+=l,T[1]+=l,y[1]<=T[0]?[y[0],y[1],T[0],T[1]]:T[1]<=y[0]?[T[0],T[1],y[0],y[1]]:y[0]>=T[0]&&y[1]<=T[1]?[T[0],y[0],y[1],T[1]]:T[0]>=y[0]&&T[1]<=y[1]?[y[0],T[0],T[1],y[1]]:y[0]>T[0]&&y[0]<T[1]?[T[0],y[0],T[1],y[1]]:[y[0],T[0],y[1],T[1]]):y):0!==T.length?(T[0]+=l,T[1]+=l,T):[]}}return[]}function Zv(e,t,i,n){var r=e*e,a=-2*t,o=i*e+t*t-4*n,s=r*n-i*t*e+i*i,u=jv.computeRealRoots(1,a,o,s);if(0<u.length){var l,c,m,d,h,f,p,_,C=u[0],g=t-C,v=g*g,y=e/2,T=g/2,x=v-4*n,w=v+4*Math.abs(n),A=r-4*C,E=r+4*Math.abs(C);m=C<0||x*E<A*w?(c=(l=Math.sqrt(A))/2,0===l?0:(e*T-i)/l):(c=0===(d=Math.sqrt(x))?0:(e*T-i)/d,d/2),0==y&&0===c?f=h=0:ri.sign(y)===ri.sign(c)?f=C/(h=y+c):h=C/(f=y-c),0==T&&0===m?_=p=0:ri.sign(T)===ri.sign(m)?_=n/(p=T+m):p=n/(_=T-m);var S=Wv.computeRealRoots(1,h,p),b=Wv.computeRealRoots(1,f,_);if(0!==S.length)return 0!==b.length?S[1]<=b[0]?[S[0],S[1],b[0],b[1]]:b[1]<=S[0]?[b[0],b[1],S[0],S[1]]:S[0]>=b[0]&&S[1]<=b[1]?[b[0],S[0],S[1],b[1]]:b[0]>=S[0]&&b[1]<=S[1]?[S[0],b[0],b[1],S[1]]:S[0]>b[0]&&S[0]<b[1]?[b[0],S[0],b[1],S[1]]:[S[0],b[0],S[1],b[1]]:S;if(0!==b.length)return b}return[]}function Jv(e,t){t=si.clone(z(t,si.ZERO)),si.equals(t,si.ZERO)||si.normalize(t,t),this.origin=si.clone(z(e,si.ZERO)),this.direction=t}Xv.computeDiscriminant=function(e,t,i,n,r){var a=e*e,o=t*t,s=o*t,u=i*i,l=u*i,c=n*n,m=c*n,d=r*r;return o*u*c-4*s*m-4*e*l*c+18*e*t*i*m-27*a*c*c+256*(a*e)*(d*r)+r*(18*s*i*n-4*o*l+16*e*u*u-80*e*t*u*n-6*e*o*c+144*a*i*c)+d*(144*e*o*i-27*o*o-128*a*u-192*a*t*n)},Xv.computeRealRoots=function(e,t,i,n,r){if(Math.abs(e)<ri.EPSILON15)return jv.computeRealRoots(t,i,n,r);var a=t/e,o=i/e,s=n/e,u=r/e,l=a<0?1:0;switch(l+=o<0?l+1:l,l+=s<0?l+1:l,l+=u<0?l+1:l){case 0:return Kv(a,o,s,u);case 1:case 2:return Zv(a,o,s,u);case 3:case 4:return Kv(a,o,s,u);case 5:return Zv(a,o,s,u);case 6:case 7:return Kv(a,o,s,u);case 8:return Zv(a,o,s,u);case 9:case 10:return Kv(a,o,s,u);case 11:return Zv(a,o,s,u);case 12:case 13:case 14:case 15:return Kv(a,o,s,u);default:return}},Jv.clone=function(e,t){if(oe(e))return oe(t)?(t.origin=si.clone(e.origin),t.direction=si.clone(e.direction),t):new Jv(e.origin,e.direction)},Jv.getPoint=function(e,t,i){return oe(i)||(i=new si),i=si.multiplyByScalar(e.direction,t,i),si.add(e.origin,i,i)};var Qv={rayPlane:function(e,t,i){oe(i)||(i=new si);var n=e.origin,r=e.direction,a=t.normal,o=si.dot(a,r);if(!(Math.abs(o)<ri.EPSILON15)){var s=(-t.distance-si.dot(a,n))/o;if(!(s<0))return i=si.multiplyByScalar(r,s,i),si.add(n,i,i)}}},$v=new si,ey=new si,ty=new si,iy=new si,ny=new si;Qv.rayTriangleParametric=function(e,t,i,n,r){r=z(r,!1);var a,o,s,u=e.origin,l=e.direction,c=si.subtract(i,t,$v),m=si.subtract(n,t,ey),d=si.cross(l,m,ty),h=si.dot(c,d);if(r){if(h<ri.EPSILON6)return;if(_=si.subtract(u,t,iy),(f=si.dot(_,d))<0||h<f)return;if(a=si.cross(_,c,ny),(o=si.dot(l,a))<0||h<f+o)return;s=si.dot(m,a)/h}else{if(Math.abs(h)<ri.EPSILON6)return;var f,p=1/h,_=si.subtract(u,t,iy);if((f=si.dot(_,d)*p)<0||1<f)return;if(a=si.cross(_,c,ny),(o=si.dot(l,a)*p)<0||1<f+o)return;s=si.dot(m,a)*p}return s},Qv.rayTriangle=function(e,t,i,n,r,a){var o=Qv.rayTriangleParametric(e,t,i,n,r);if(oe(o)&&!(o<0))return oe(a)||(a=new si),si.multiplyByScalar(e.direction,o,a),si.add(e.origin,a,a)};var ry=new Jv;Qv.lineSegmentTriangle=function(e,t,i,n,r,a,o){var s=ry;si.clone(e,s.origin),si.subtract(t,e,s.direction),si.normalize(s.direction,s.direction);var u=Qv.rayTriangleParametric(s,i,n,r,a);if(!(!oe(u)||u<0||u>si.distance(e,t)))return oe(o)||(o=new si),si.multiplyByScalar(s.direction,u,o),si.add(s.origin,o,o)};var ay={root0:0,root1:0};function oy(e,t,i){oe(i)||(i=new Sr);var n=e.origin,r=e.direction,a=t.center,o=t.radius*t.radius,s=si.subtract(n,a,ty),u=function(e,t,i,n){var r=t*t-4*e*i;if(!(r<0)){if(0<r){var a=1/(2*e),o=Math.sqrt(r),s=(-t+o)*a,u=(-t-o)*a;return s<u?(n.root0=s,n.root1=u):(n.root0=u,n.root1=s),n}var l=-t/(2*e);if(0!=l)return n.root0=n.root1=l,n}}(si.dot(r,r),2*si.dot(r,s),si.magnitudeSquared(s)-o,ay);if(oe(u))return i.start=u.root0,i.stop=u.root1,i}Qv.raySphere=function(e,t,i){if(oe(i=oy(e,t,i))&&!(i.stop<0))return i.start=Math.max(i.start,0),i};var sy=new Jv;Qv.lineSegmentSphere=function(e,t,i,n){var r=sy;si.clone(e,r.origin);var a=si.subtract(t,e,r.direction),o=si.magnitude(a);if(si.normalize(a,a),!(!oe(n=oy(r,i,n))||n.stop<0||n.start>o))return n.start=Math.max(n.start,0),n.stop=Math.min(n.stop,o),n};var uy=new si,ly=new si;function cy(e,t,i){var n=e+t;return ri.sign(e)!==ri.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}Qv.rayEllipsoid=function(e,t){var i,n,r=t.oneOverRadii,a=si.multiplyComponents(r,e.origin,uy),o=si.multiplyComponents(r,e.direction,ly),s=si.magnitudeSquared(a),u=si.dot(a,o);if(1<s){if(0<=u)return;var l,c,m=u*u,d=s-1;if(m<(c=(l=si.magnitudeSquared(o))*d))return;if(c<m){i=u*u-c;var h=(n=-u+Math.sqrt(i))/l,f=d/n;return h<f?new Sr(h,f):{start:f,stop:h}}var p=Math.sqrt(d/l);return new Sr(p,p)}return s<1?(d=s-1,i=u*u-(c=(l=si.magnitudeSquared(o))*d),new Sr(0,(n=-u+Math.sqrt(i))/l)):u<0?new Sr(0,-u/(l=si.magnitudeSquared(o))):void 0};var my=new si,dy=new si,hy=new si,fy=new si,py=new si,_y=new pi,Cy=new pi,gy=new pi,vy=new pi,yy=new pi,Ty=new pi,xy=new pi,wy=new si,Ay=new si,Ey=new dr;Qv.grazingAltitudeLocation=function(e,t){var i=e.origin,n=e.direction;if(!si.equals(i,si.ZERO)){var r=t.geodeticSurfaceNormal(i,my);if(0<=si.dot(n,r))return i}var a=oe(this.rayEllipsoid(e,t)),o=t.transformPositionToScaledSpace(n,my),s=si.normalize(o,o),u=si.mostOrthogonalAxis(o,fy),l=si.normalize(si.cross(u,s,dy),dy),c=si.normalize(si.cross(s,l,hy),hy),m=_y;m[0]=s.x,m[1]=s.y,m[2]=s.z,m[3]=l.x,m[4]=l.y,m[5]=l.z,m[6]=c.x,m[7]=c.y,m[8]=c.z;var d=pi.transpose(m,Cy),h=pi.fromScale(t.radii,gy),f=pi.fromScale(t.oneOverRadii,vy),p=yy;p[0]=0,p[1]=-n.z,p[2]=n.y,p[3]=n.z,p[4]=0,p[5]=-n.x,p[6]=-n.y,p[7]=n.x,p[8]=0;var _,C=pi.multiply(pi.multiply(d,f,Ty),p,Ty),g=pi.multiply(pi.multiply(C,h,xy),m,xy),v=pi.multiplyByVector(C,i,py),y=function(e,t,i,n,r){var a,o=n*n,s=r*r,u=(e[pi.COLUMN1ROW1]-e[pi.COLUMN2ROW2])*s,l=r*(n*cy(e[pi.COLUMN1ROW0],e[pi.COLUMN0ROW1],ri.EPSILON15)+t.y),c=e[pi.COLUMN0ROW0]*o+e[pi.COLUMN2ROW2]*s+n*t.x+i,m=s*cy(e[pi.COLUMN2ROW1],e[pi.COLUMN1ROW2],ri.EPSILON15),d=r*(n*cy(e[pi.COLUMN2ROW0],e[pi.COLUMN0ROW2])+t.z),h=[];if(0==d&&0==m){if(0===(a=Wv.computeRealRoots(u,l,c)).length)return h;var f,p,_=a[0],C=Math.sqrt(Math.max(1-_*_,0));return h.push(new si(n,r*_,r*-C)),h.push(new si(n,r*_,r*C)),2===a.length&&(f=a[1],p=Math.sqrt(Math.max(1-f*f,0)),h.push(new si(n,r*f,r*-p)),h.push(new si(n,r*f,r*p))),h}var g=d*d,v=m*m,y=d*m,T=u*u+v,x=2*(l*u+y),w=2*c*u+l*l-v+g,A=2*(c*l-y),E=c*c-g;if(0==T&&0==x&&0==w&&0==A)return h;var S=(a=Xv.computeRealRoots(T,x,w,A,E)).length;if(0===S)return h;for(var b=0;b<S;++b){var M=a[b],R=M*M,D=Math.max(1-R,0),P=Math.sqrt(D),I=ri.sign(u)===ri.sign(c)?cy(u*R+c,l*M,ri.EPSILON12):ri.sign(c)===ri.sign(l*M)?cy(u*R,l*M+c,ri.EPSILON12):cy(u*R+l*M,c,ri.EPSILON12),O=I*cy(m*M,d,ri.EPSILON15);O<0?h.push(new si(n,r*M,r*P)):0<O?h.push(new si(n,r*M,r*-P)):0!==P?(h.push(new si(n,r*M,r*-P)),h.push(new si(n,r*M,r*P)),++b):h.push(new si(n,r*M,r*P))}return h}(g,si.negate(v,my),0,0,1),T=y.length;if(0<T){for(var x=si.clone(si.ZERO,Ay),w=Number.NEGATIVE_INFINITY,A=0;A<T;++A){_=pi.multiplyByVector(h,pi.multiplyByVector(m,y[A],wy),wy);var E=si.normalize(si.subtract(_,i,fy),fy),S=si.dot(E,n);w<S&&(w=S,x=si.clone(_,x))}var b=t.cartesianToCartographic(x,Ey),w=ri.clamp(w,0,1),M=si.magnitude(si.subtract(x,i,fy))*Math.sqrt(1-w*w);return M=a?-M:M,b.height=M,t.cartographicToCartesian(b,new si)}};var Sy=new si;Qv.lineSegmentPlane=function(e,t,i,n){oe(n)||(n=new si);var r=si.subtract(t,e,Sy),a=i.normal,o=si.dot(a,r);if(!(Math.abs(o)<ri.EPSILON6)){var s=si.dot(a,e),u=-(i.distance+s)/o;if(!(u<0||1<u))return si.multiplyByScalar(r,u,n),si.add(e,n,n),n}},Qv.trianglePlaneIntersection=function(e,t,i,n){var r,a,o=n.normal,s=n.distance,u=si.dot(o,e)+s<0,l=si.dot(o,t)+s<0,c=si.dot(o,i)+s<0,m=0;if(m+=u?1:0,m+=l?1:0,1!=(m+=c?1:0)&&2!=m||(r=new si,a=new si),1==m){if(u)return Qv.lineSegmentPlane(e,t,n,r),Qv.lineSegmentPlane(e,i,n,a),{positions:[e,t,i,r,a],indices:[0,3,4,1,2,4,1,4,3]};if(l)return Qv.lineSegmentPlane(t,i,n,r),Qv.lineSegmentPlane(t,e,n,a),{positions:[e,t,i,r,a],indices:[1,3,4,2,0,4,2,4,3]};if(c)return Qv.lineSegmentPlane(i,e,n,r),Qv.lineSegmentPlane(i,t,n,a),{positions:[e,t,i,r,a],indices:[2,3,4,0,1,4,0,4,3]}}else if(2==m){if(!u)return Qv.lineSegmentPlane(t,e,n,r),Qv.lineSegmentPlane(i,e,n,a),{positions:[e,t,i,r,a],indices:[1,2,4,1,4,3,0,3,4]};if(!l)return Qv.lineSegmentPlane(i,t,n,r),Qv.lineSegmentPlane(e,t,n,a),{positions:[e,t,i,r,a],indices:[2,0,4,2,4,3,1,3,4]};if(!c)return Qv.lineSegmentPlane(e,i,n,r),Qv.lineSegmentPlane(t,i,n,a),{positions:[e,t,i,r,a],indices:[0,1,4,0,4,3,2,3,4]}}};var by={calculateACMR:function(e){var t=(e=z(e,z.EMPTY_OBJECT)).indices,i=e.maximumIndex,n=z(e.cacheSize,24),r=t.length;if(!oe(i))for(var a=i=0,o=t[a];a<r;)i<o&&(i=o),o=t[++a];for(var s=[],u=0;u<i+1;u++)s[u]=0;for(var l=n+1,c=0;c<r;++c)l-s[t[c]]>n&&(s[t[c]]=l,++l);return(l-n+1)/(r/3)}};by.tipsify=function(e){var t=(e=z(e,z.EMPTY_OBJECT)).indices,i=e.maximumIndex,n=z(e.cacheSize,24);function r(e,t,i,n,r,a,o){for(var s,u=-1,l=-1,c=0;c<i.length;){var m=i[c];n[m].numLiveTriangles&&(s=0,r-n[m].timeStamp+2*n[m].numLiveTriangles<=t&&(s=r-n[m].timeStamp),(l<s||-1===l)&&(l=s,u=m)),++c}return-1===u?function(e,t,i){for(;1<=t.length;){var n=t[t.length-1];if(t.splice(t.length-1,1),0<e[n].numLiveTriangles)return n}for(;v<i;){if(0<e[v].numLiveTriangles)return++v-1;++v}return-1}(n,a,o):u}var a=t.length,o=0,s=0,u=t[s],l=a;if(oe(i))o=i+1;else{for(;s<l;)o<u&&(o=u),u=t[++s];if(-1===o)return 0;++o}for(var c=[],m=0;m<o;m++)c[m]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var d=s=0;s<l;)c[t[s]].vertexTriangles.push(d),++c[t[s]].numLiveTriangles,c[t[s+1]].vertexTriangles.push(d),++c[t[s+1]].numLiveTriangles,c[t[s+2]].vertexTriangles.push(d),++c[t[s+2]].numLiveTriangles,++d,s+=3;var h,f,p,_,C=0,g=n+1,v=1,y=[],T=[],x=0,w=[],A=a/3,E=[];for(m=0;m<A;m++)E[m]=!1;for(;-1!==C;){y=[],_=(f=c[C]).vertexTriangles.length;for(var S=0;S<_;++S)if(!E[d=f.vertexTriangles[S]]){E[d]=!0,s=d+d+d;for(var b=0;b<3;++b)p=t[s],y.push(p),T.push(p),w[x]=p,++x,--(h=c[p]).numLiveTriangles,g-h.timeStamp>n&&(h.timeStamp=g,++g),++s}C=r(0,n,y,c,g,T,o)}return w};var My={};function Ry(e,t,i,n,r){e[t++]=i,e[t++]=n,e[t++]=n,e[t++]=r,e[t++]=r,e[t]=i}function Dy(e){var t,i={};for(var n in e){e.hasOwnProperty(n)&&oe(e[n])&&oe(e[n].values)&&(t=e[n],i[n]=new Ev({componentDatatype:t.componentDatatype,componentsPerAttribute:t.componentsPerAttribute,normalize:t.normalize,values:[]}))}return i}function Py(e,t,i){for(var n in t)if(t.hasOwnProperty(n)&&oe(t[n])&&oe(t[n].values))for(var r=t[n],a=0;a<r.componentsPerAttribute;++a)e[n].values.push(r.values[i*r.componentsPerAttribute+a])}My.toWireframe=function(e){var t=e.indices;if(oe(t)){switch(e.primitiveType){case Yd.TRIANGLES:e.indices=function(e){for(var t=e.length,i=t/3*6,n=kd.createTypedArray(t,i),r=0,a=0;a<t;a+=3,r+=6)Ry(n,r,e[a],e[a+1],e[a+2]);return n}(t);break;case Yd.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(3<=t){var i=6*(t-2),n=kd.createTypedArray(t,i);Ry(n,0,e[0],e[1],e[2]);for(var r=6,a=3;a<t;++a,r+=6)Ry(n,r,e[a-1],e[a],e[a-2]);return n}return new Uint16Array}(t);break;case Yd.TRIANGLE_FAN:e.indices=function(e){if(0<e.length){for(var t=e.length-1,i=6*(t-1),n=kd.createTypedArray(t,i),r=e[0],a=0,o=1;o<t;++o,a+=6)Ry(n,a,r,e[o],e[o+1]);return n}return new Uint16Array}(t)}e.primitiveType=Yd.LINES}return e},My.createLineSegmentsForVectors=function(e,t,i){t=z(t,"normal"),i=z(i,1e4);for(var n,r=e.attributes.position.values,a=e.attributes[t].values,o=r.length,s=new Float64Array(2*o),u=0,l=0;l<o;l+=3)s[u++]=r[l],s[u++]=r[l+1],s[u++]=r[l+2],s[u++]=r[l]+a[l]*i,s[u++]=r[l+1]+a[l+1]*i,s[u++]=r[l+2]+a[l+2]*i;var c=e.boundingSphere;return oe(c)&&(n=new Rr(c.center,c.radius+i)),new rp({attributes:{position:new Ev({componentDatatype:Ud.DOUBLE,componentsPerAttribute:3,values:s})},primitiveType:Yd.LINES,boundingSphere:n})},My.createAttributeLocations=function(e){for(var t=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],i=e.attributes,n={},r=0,a=t.length,o=0;o<a;++o){var s=t[o];oe(i[s])&&(n[s]=r++)}for(var u in i)i.hasOwnProperty(u)&&!oe(n[u])&&(n[u]=r++);return n},My.reorderForPreVertexCache=function(e){var t=rp.computeNumberOfVertices(e),i=e.indices;if(oe(i)){for(var n=new Int32Array(t),r=0;r<t;r++)n[r]=-1;for(var a,o=i,s=o.length,u=kd.createTypedArray(t,s),l=0,c=0,m=0;l<s;)-1!==(a=n[o[l]])?u[c]=a:(n[a=o[l]]=m,u[c]=m,++m),++l,++c;e.indices=u;var d=e.attributes;for(var h in d)if(d.hasOwnProperty(h)&&oe(d[h])&&oe(d[h].values)){for(var f=d[h],p=f.values,_=0,C=f.componentsPerAttribute,g=Ud.createTypedArray(f.componentDatatype,m*C);_<t;){var v=n[_];if(-1!==v)for(var y=0;y<C;y++)g[C*v+y]=p[C*_+y];++_}f.values=g}}return e},My.reorderForPostVertexCache=function(e,t){var i=e.indices;if(e.primitiveType===Yd.TRIANGLES&&oe(i)){for(var n=i.length,r=0,a=0;a<n;a++)i[a]>r&&(r=i[a]);e.indices=by.tipsify({indices:i,maximumIndex:r,cacheSize:t})}return e},My.fitToUnsignedShortIndices=function(e){var t=[],i=rp.computeNumberOfVertices(e);if(oe(e.indices)&&i>=ri.SIXTY_FOUR_KILOBYTES){var n,r=[],a=[],o=0,s=Dy(e.attributes),u=e.indices,l=u.length;e.primitiveType===Yd.TRIANGLES?n=3:e.primitiveType===Yd.LINES?n=2:e.primitiveType===Yd.POINTS&&(n=1);for(var c=0;c<l;c+=n){for(var m=0;m<n;++m){var d=u[c+m],h=r[d];oe(h)||(h=o++,r[d]=h,Py(s,e.attributes,d)),a.push(h)}o+n>=ri.SIXTY_FOUR_KILOBYTES&&(t.push(new rp({attributes:s,indices:a,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),r=[],a=[],o=0,s=Dy(e.attributes))}0!==a.length&&t.push(new rp({attributes:s,indices:a,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var Iy=new si,Oy=new dr;My.projectTo2D=function(e,t,i,n,r){for(var a=e.attributes[t],o=(r=oe(r)?r:new Ar).ellipsoid,s=a.values,u=new Float64Array(s.length),l=0,c=0;c<s.length;c+=3){var m=si.fromArray(s,c,Iy),d=o.cartesianToCartographic(m,Oy),h=r.project(d,Iy);u[l++]=h.x,u[l++]=h.y,u[l++]=h.z}return e.attributes[i]=a,e.attributes[n]=new Ev({componentDatatype:Ud.DOUBLE,componentsPerAttribute:3,values:u}),delete e.attributes[t],e};var Ly={high:0,low:0};My.encodeAttribute=function(e,t,i,n){for(var r=e.attributes[t],a=r.values,o=a.length,s=new Float32Array(o),u=new Float32Array(o),l=0;l<o;++l)Xn.encode(a[l],Ly),s[l]=Ly.high,u[l]=Ly.low;var c=r.componentsPerAttribute;return e.attributes[i]=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:c,values:s}),e.attributes[n]=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:c,values:u}),delete e.attributes[t],e};var Ny=new si;function By(e,t){if(oe(t))for(var i=t.values,n=i.length,r=0;r<n;r+=3)si.unpack(i,r,Ny),Rn.multiplyByPoint(e,Ny,Ny),si.pack(Ny,i,r)}function zy(e,t){if(oe(t))for(var i=t.values,n=i.length,r=0;r<n;r+=3)si.unpack(i,r,Ny),pi.multiplyByVector(e,Ny,Ny),Ny=si.normalize(Ny,Ny),si.pack(Ny,i,r)}var Fy=new Rn,Vy=new pi;My.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(Rn.equals(t,Rn.IDENTITY))return e;var i=e.geometry.attributes;By(t,i.position),By(t,i.prevPosition),By(t,i.nextPosition),(oe(i.normal)||oe(i.tangent)||oe(i.bitangent))&&(Rn.inverse(t,Fy),Rn.transpose(Fy,Fy),Rn.getMatrix3(Fy,Vy),zy(Vy,i.normal),zy(Vy,i.tangent),zy(Vy,i.bitangent));var n=e.geometry.boundingSphere;return oe(n)&&(e.geometry.boundingSphere=Rr.transform(n,t,n)),e.modelMatrix=Rn.clone(Rn.IDENTITY),e};var Uy=new si;function Gy(e,t){var i,n,r,a,o,s,u=e.length,l=(e[0].modelMatrix,oe(e[0][t].indices)),c=e[0][t].primitiveType,m=function(e,t){var i,n=e.length,r={},a=e[0][t].attributes;for(i in a)if(a.hasOwnProperty(i)&&oe(a[i])&&oe(a[i].values)){for(var o=a[i],s=o.values.length,u=!0,l=1;l<n;++l){var c=e[l][t].attributes[i];if(!oe(c)||o.componentDatatype!==c.componentDatatype||o.componentsPerAttribute!==c.componentsPerAttribute||o.normalize!==c.normalize){u=!1;break}s+=c.values.length}u&&(r[i]=new Ev({componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize,values:Ud.createTypedArray(o.componentDatatype,s)}))}return r}(e,t);for(i in m)if(m.hasOwnProperty(i))for(r=m[i].values,h=y=0;h<u;++h)for(o=(a=e[h][t].attributes[i].values).length,n=0;n<o;++n)r[y++]=a[n];if(l){for(var d=0,h=0;h<u;++h)d+=e[h][t].indices.length;var f=rp.computeNumberOfVertices(new rp({attributes:m,primitiveType:Yd.POINTS})),p=kd.createTypedArray(f,d),_=0,C=0;for(h=0;h<u;++h){for(var g=e[h][t].indices,v=g.length,y=0;y<v;++y)p[_++]=C+g[y];C+=rp.computeNumberOfVertices(e[h][t])}s=p}var T,x=new si,w=0;for(h=0;h<u;++h){if(!oe(T=e[h][t].boundingSphere)){x=void 0;break}si.add(T.center,x,x)}if(oe(x))for(si.divideByScalar(x,u,x),h=0;h<u;++h){T=e[h][t].boundingSphere;var A=si.magnitude(si.subtract(T.center,x,Uy))+T.radius;w<A&&(w=A)}return new rp({attributes:m,indices:s,primitiveType:c,boundingSphere:oe(x)?new Rr(x,w):void 0})}My.combineInstances=function(e){for(var t=[],i=[],n=e.length,r=0;r<n;++r){var a=e[r];oe(a.geometry)?t.push(a):oe(a.westHemisphereGeometry)&&oe(a.eastHemisphereGeometry)&&i.push(a)}var o=[];return 0<t.length&&o.push(Gy(t,"geometry")),0<i.length&&(o.push(Gy(i,"westHemisphereGeometry")),o.push(Gy(i,"eastHemisphereGeometry"))),o};var ky=new si,Hy=new si,Wy=new si,qy=new si;My.computeNormal=function(e){for(var t=e.indices,i=e.attributes,n=i.position.values,r=i.position.values.length/3,a=t.length,o=new Array(r),s=new Array(a/3),u=new Array(a),l=0;l<r;l++)o[l]={indexOffset:0,count:0,currentCount:0};var c=0;for(l=0;l<a;l+=3){var m=t[l],d=t[l+1],h=t[l+2],f=3*m,p=3*d,_=3*h;Hy.x=n[f],Hy.y=n[1+f],Hy.z=n[2+f],Wy.x=n[p],Wy.y=n[1+p],Wy.z=n[2+p],qy.x=n[_],qy.y=n[1+_],qy.z=n[2+_],o[m].count++,o[d].count++,o[h].count++,si.subtract(Wy,Hy,Wy),si.subtract(qy,Hy,qy),s[c]=si.cross(Wy,qy,new si),c++}var C=0;for(l=0;l<r;l++)o[l].indexOffset+=C,C+=o[l].count;for(l=c=0;l<a;l+=3){var g=(T=o[t[l]]).indexOffset+T.currentCount;u[g]=c,T.currentCount++,u[g=(T=o[t[l+1]]).indexOffset+T.currentCount]=c,T.currentCount++,u[g=(T=o[t[l+2]]).indexOffset+T.currentCount]=c,T.currentCount++,c++}var v=new Float32Array(3*r);for(l=0;l<r;l++){var y=3*l,T=o[l];if(si.clone(si.ZERO,ky),0<T.count){for(c=0;c<T.count;c++)si.add(ky,s[u[T.indexOffset+c]],ky);si.equalsEpsilon(si.ZERO,ky,ri.EPSILON10)&&si.clone(s[u[T.indexOffset]],ky)}si.equalsEpsilon(si.ZERO,ky,ri.EPSILON10)&&(ky.z=1),si.normalize(ky,ky),v[y]=ky.x,v[1+y]=ky.y,v[2+y]=ky.z}return e.attributes.normal=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:3,values:v}),e};var jy=new si,Yy=new si,Xy=new si;My.computeTangentAndBitangent=function(e){e.attributes;for(var t=e.indices,i=e.attributes.position.values,n=e.attributes.normal.values,r=e.attributes.st.values,a=e.attributes.position.values.length/3,o=t.length,s=new Array(3*a),u=0;u<s.length;u++)s[u]=0;for(u=0;u<o;u+=3){var l,c=t[u],m=t[u+1],d=t[u+2],h=3*m,f=3*d,p=2*c,_=2*m,C=2*d,g=i[l=3*c],v=i[l+1],y=i[l+2],T=r[p],x=r[1+p],w=r[1+_]-x,A=r[1+C]-x,E=1/((r[_]-T)*A-(r[C]-T)*w),S=(A*(i[h]-g)-w*(i[f]-g))*E,b=(A*(i[h+1]-v)-w*(i[f+1]-v))*E,M=(A*(i[h+2]-y)-w*(i[f+2]-y))*E;s[l]+=S,s[l+1]+=b,s[l+2]+=M,s[h]+=S,s[h+1]+=b,s[h+2]+=M,s[f]+=S,s[f+1]+=b,s[f+2]+=M}var R=new Float32Array(3*a),D=new Float32Array(3*a);for(u=0;u<a;u++){h=(l=3*u)+1,f=l+2;var P=si.fromArray(n,l,jy),I=si.fromArray(s,l,Xy),O=si.dot(P,I);si.multiplyByScalar(P,O,Yy),si.normalize(si.subtract(I,Yy,I),I),R[l]=I.x,R[h]=I.y,R[f]=I.z,si.normalize(si.cross(P,I,I),I),D[l]=I.x,D[h]=I.y,D[f]=I.z}return e.attributes.tangent=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:3,values:R}),e.attributes.bitangent=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:3,values:D}),e};var Ky=new ha,Zy=new si,Jy=new si,Qy=new si,$y=new ha;function eT(e){switch(e.primitiveType){case Yd.TRIANGLE_FAN:return function(e){var t=rp.computeNumberOfVertices(e),i=kd.createTypedArray(t,3*(t-2));i[0]=1,i[1]=0,i[2]=2;for(var n=3,r=3;r<t;++r)i[n++]=r-1,i[n++]=0,i[n++]=r;return e.indices=i,e.primitiveType=Yd.TRIANGLES,e}(e);case Yd.TRIANGLE_STRIP:return function(e){var t=rp.computeNumberOfVertices(e),i=kd.createTypedArray(t,3*(t-2));i[0]=0,i[1]=1,i[2]=2,3<t&&(i[3]=0,i[4]=2,i[5]=3);for(var n=6,r=3;r<t-1;r+=2)i[n++]=r,i[n++]=r-1,i[n++]=r+1,r+2<t&&(i[n++]=r,i[n++]=r+1,i[n++]=r+2);return e.indices=i,e.primitiveType=Yd.TRIANGLES,e}(e);case Yd.TRIANGLES:return function(e){if(oe(e.indices))return e;for(var t=rp.computeNumberOfVertices(e),i=kd.createTypedArray(t,t),n=0;n<t;++n)i[n]=n;return e.indices=i,e}(e);case Yd.LINE_STRIP:return function(e){var t=rp.computeNumberOfVertices(e),i=kd.createTypedArray(t,2*(t-1));i[0]=0,i[1]=1;for(var n=2,r=2;r<t;++r)i[n++]=r-1,i[n++]=r;return e.indices=i,e.primitiveType=Yd.LINES,e}(e);case Yd.LINE_LOOP:return function(e){var t=rp.computeNumberOfVertices(e),i=kd.createTypedArray(t,2*t);i[0]=0,i[1]=1;for(var n=2,r=2;r<t;++r)i[n++]=r-1,i[n++]=r;return i[n++]=t-1,i[n]=0,e.indices=i,e.primitiveType=Yd.LINES,e}(e);case Yd.LINES:return function(e){if(oe(e.indices))return e;for(var t=rp.computeNumberOfVertices(e),i=kd.createTypedArray(t,t),n=0;n<t;++n)i[n]=n;return e.indices=i,e}(e)}return e}function tT(e,t){Math.abs(e.y)<ri.EPSILON6&&(e.y=t?-ri.EPSILON6:ri.EPSILON6)}My.compressVertices=function(e){var t=e.attributes.extrudeDirection;if(oe(t)){for(var i=t.values,n=i.length/3,r=new Float32Array(2*n),a=0,o=0;o<n;++o)si.fromArray(i,3*o,Zy),si.equals(Zy,si.ZERO)?a+=2:($y=Xo.octEncodeInRange(Zy,65535,$y),r[a++]=$y.x,r[a++]=$y.y);return e.attributes.compressedAttributes=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:2,values:r}),delete e.attributes.extrudeDirection,e}var s=e.attributes.normal,u=e.attributes.st,l=oe(s),c=oe(u);if(!l&&!c)return e;var m,d,h,f,p=e.attributes.tangent,_=e.attributes.bitangent,C=oe(p),g=oe(_);l&&(m=s.values),c&&(d=u.values),C&&(h=p.values),g&&(f=_.values);var v=n=(l?m.length:d.length)/(l?3:2),y=c&&l?2:1;v*=y+=C||g?1:0;var T=new Float32Array(v),x=0;for(o=0;o<n;++o){c&&(ha.fromArray(d,2*o,Ky),T[x++]=Xo.compressTextureCoordinates(Ky));var w=3*o;l&&oe(h)&&oe(f)?(si.fromArray(m,w,Zy),si.fromArray(h,w,Jy),si.fromArray(f,w,Qy),Xo.octPack(Zy,Jy,Qy,Ky),T[x++]=Ky.x,T[x++]=Ky.y):(l&&(si.fromArray(m,w,Zy),T[x++]=Xo.octEncodeFloat(Zy)),C&&(si.fromArray(h,w,Zy),T[x++]=Xo.octEncodeFloat(Zy)),g&&(si.fromArray(f,w,Zy),T[x++]=Xo.octEncodeFloat(Zy)))}return e.attributes.compressedAttributes=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:y,values:T}),l&&delete e.attributes.normal,c&&delete e.attributes.st,g&&delete e.attributes.bitangent,C&&delete e.attributes.tangent,e};var iT=new si;function nT(e,t,i,n){si.add(e,si.multiplyByScalar(si.subtract(t,e,iT),e.y/(e.y-t.y),iT),i),si.clone(i,n),tT(i,!0),tT(n,!1)}var rT=new si,aT=new si,oT=new si,sT=new si,uT={positions:new Array(7),indices:new Array(9)};function lT(e,t,i){if(!(0<=e.x||0<=t.x||0<=i.x)){!function(e,t,i){if(0!==e.y&&0!==t.y&&0!==i.y)return tT(e,e.y<0),tT(t,t.y<0),tT(i,i.y<0);var n=Math.abs(e.y),r=Math.abs(t.y),a=Math.abs(i.y),o=r<n?a<n?ri.sign(e.y):ri.sign(i.y):a<r?ri.sign(t.y):ri.sign(i.y),s=o<0;tT(e,s),tT(t,s),tT(i,s)}(e,t,i);var n=e.y<0,r=t.y<0,a=i.y<0,o=0;o+=n?1:0,o+=r?1:0,o+=a?1:0;var s=uT.indices;1==o?(s[1]=3,s[2]=4,s[5]=6,s[7]=6,s[8]=5,n?(nT(e,t,rT,oT),nT(e,i,aT,sT),s[0]=0,s[3]=1,s[4]=2,s[6]=1):r?(nT(t,i,rT,oT),nT(t,e,aT,sT),s[0]=1,s[3]=2,s[4]=0,s[6]=2):a&&(nT(i,e,rT,oT),nT(i,t,aT,sT),s[0]=2,s[3]=0,s[4]=1,s[6]=0)):2==o&&(s[2]=4,s[4]=4,s[5]=3,s[7]=5,s[8]=6,n?r?a||(nT(i,e,rT,oT),nT(i,t,aT,sT),s[0]=0,s[1]=1,s[3]=0,s[6]=2):(nT(t,i,rT,oT),nT(t,e,aT,sT),s[0]=2,s[1]=0,s[3]=2,s[6]=1):(nT(e,t,rT,oT),nT(e,i,aT,sT),s[0]=1,s[1]=2,s[3]=1,s[6]=0));var u=uT.positions;return u[0]=e,u[1]=t,u[2]=i,u.length=3,1!=o&&2!=o||(u[3]=rT,u[4]=aT,u[5]=oT,u[6]=sT,u.length=7),uT}}function cT(e,t){var i,n=e.attributes;if(0!==n.position.values.length){for(var r in n){n.hasOwnProperty(r)&&oe(n[r])&&oe(n[r].values)&&((i=n[r]).values=Ud.createTypedArray(i.componentDatatype,i.values))}var a=rp.computeNumberOfVertices(e);return e.indices=kd.createTypedArray(a,e.indices),t&&(e.boundingSphere=Rr.fromVertices(n.position.values)),e}}function mT(e){var t,i=e.attributes,n={};for(var r in i){i.hasOwnProperty(r)&&oe(i[r])&&oe(i[r].values)&&(t=i[r],n[r]=new Ev({componentDatatype:t.componentDatatype,componentsPerAttribute:t.componentsPerAttribute,normalize:t.normalize,values:[]}))}return new rp({attributes:n,indices:[],primitiveType:e.primitiveType})}function dT(e,t,i){var n=oe(e.geometry.boundingSphere);t=cT(t,n),oe(i=cT(i,n))&&!oe(t)?e.geometry=i:!oe(i)&&oe(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=i,e.geometry=void 0)}function hT(d,h){var f=new d,p=new d,_=new d;return function(e,t,i,n,r,a,o,s){var u=d.fromArray(r,e*h,f),l=d.fromArray(r,t*h,p),c=d.fromArray(r,i*h,_);d.multiplyByScalar(u,n.x,u),d.multiplyByScalar(l,n.y,l),d.multiplyByScalar(c,n.z,c);var m=d.add(u,l,u);d.add(m,c,m),s&&d.normalize(m,m),d.pack(m,a,o*h)}}var fT=hT(An,4),pT=hT(si,3),_T=hT(ha,2),CT=function(e,t,i,n,r,a,o){var s=r[e]*n.x,u=r[t]*n.y,l=r[i]*n.z;a[o]=s+u+l>ri.EPSILON6?1:0},gT=new si,vT=new si,yT=new si,TT=new si;function xT(e,t,i,n,r,a,o,s,u,l,c,m,d,h,f,p){if(oe(a)||oe(o)||oe(s)||oe(u)||oe(l)||0!==h){var _,C,g,v,y=function(e,t,i,n,r){var a,o,s,u,l,c,m,d;if(oe(r)||(r=new si),oe(t.z)){if(si.equalsEpsilon(e,t,ri.EPSILON14))return si.clone(si.UNIT_X,r);if(si.equalsEpsilon(e,i,ri.EPSILON14))return si.clone(si.UNIT_Y,r);if(si.equalsEpsilon(e,n,ri.EPSILON14))return si.clone(si.UNIT_Z,r);a=si.subtract(i,t,Gv),o=si.subtract(n,t,kv),s=si.subtract(e,t,Hv),u=si.dot(a,a),l=si.dot(a,o),c=si.dot(a,s),m=si.dot(o,o),d=si.dot(o,s)}else{if(ha.equalsEpsilon(e,t,ri.EPSILON14))return si.clone(si.UNIT_X,r);if(ha.equalsEpsilon(e,i,ri.EPSILON14))return si.clone(si.UNIT_Y,r);if(ha.equalsEpsilon(e,n,ri.EPSILON14))return si.clone(si.UNIT_Z,r);a=ha.subtract(i,t,Gv),o=ha.subtract(n,t,kv),s=ha.subtract(e,t,Hv),u=ha.dot(a,a),l=ha.dot(a,o),c=ha.dot(a,s),m=ha.dot(o,o),d=ha.dot(o,s)}r.y=m*c-l*d,r.z=u*d-l*c;var h=u*m-l*l;return 0!==r.y&&(r.y/=h),0!==r.z&&(r.z/=h),r.x=1-r.y-r.z,r}(n,si.fromArray(r,3*e,gT),si.fromArray(r,3*t,vT),si.fromArray(r,3*i,yT),TT);if(oe(a)&&pT(e,t,i,y,a,m.normal.values,p,!0),oe(l)&&(_=si.fromArray(l,3*e,gT),C=si.fromArray(l,3*t,vT),g=si.fromArray(l,3*i,yT),si.multiplyByScalar(_,y.x,_),si.multiplyByScalar(C,y.y,C),si.multiplyByScalar(g,y.z,g),si.equals(_,si.ZERO)&&si.equals(C,si.ZERO)&&si.equals(g,si.ZERO)?((v=gT).x=0,v.y=0,v.z=0):(v=si.add(_,C,_),si.add(v,g,v),si.normalize(v,v)),si.pack(v,m.extrudeDirection.values,3*p)),oe(c)&&CT(e,t,i,y,c,m.applyOffset.values,p),oe(o)&&pT(e,t,i,y,o,m.tangent.values,p,!0),oe(s)&&pT(e,t,i,y,s,m.bitangent.values,p,!0),oe(u)&&_T(e,t,i,y,u,m.st.values,p),0<h)for(var T=0;T<h;T++){var x=d[T];wT(e,t,i,y,p,f[x],m[x])}}}function wT(e,t,i,n,r,a,o){var s=a.componentsPerAttribute,u=a.values,l=o.values;switch(s){case 4:fT(e,t,i,n,u,l,r,!1);break;case 3:pT(e,t,i,n,u,l,r,!1);break;case 2:_T(e,t,i,n,u,l,r,!1);break;default:l[r]=u[e]*n.x+u[t]*n.y+u[i]*n.z}}function AT(e,t,i,n,r,a){var o=e.position.values.length/3;if(-1===r)return e.position.values.push(a.x,a.y,a.z),t.push(o),o;var s=n[r],u=i[s];return-1===u?(i[s]=o,e.position.values.push(a.x,a.y,a.z),t.push(o),o):(t.push(u),u)}var ET={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function ST(e){var t=e.geometry,i=t.attributes,n=i.position.values,r=oe(i.normal)?i.normal.values:void 0,a=oe(i.bitangent)?i.bitangent.values:void 0,o=oe(i.tangent)?i.tangent.values:void 0,s=oe(i.st)?i.st.values:void 0,u=oe(i.extrudeDirection)?i.extrudeDirection.values:void 0,l=oe(i.applyOffset)?i.applyOffset.values:void 0,c=t.indices,m=[];for(var d in i)i.hasOwnProperty(d)&&!ET[d]&&oe(i[d])&&m.push(d);var h,f,p=m.length,_=mT(t),C=mT(t),g=[];g.length=n.length/3;var v=[];for(v.length=n.length/3,T=0;T<g.length;++T)g[T]=-1,v[T]=-1;for(var y=c.length,T=0;T<y;T+=3){var x=c[T],w=c[T+1],A=c[T+2],E=si.fromArray(n,3*x),S=si.fromArray(n,3*w),b=si.fromArray(n,3*A),M=lT(E,S,b);if(oe(M)&&3<M.positions.length)for(var R=M.positions,D=M.indices,P=D.length,I=0;I<P;++I){var O=D[I],L=R[O],N=L.y<0?(h=C.attributes,f=C.indices,g):(h=_.attributes,f=_.indices,v);xT(x,w,A,L,n,r,o,a,s,u,l,h,m,p,i,AT(h,f,N,c,O<3?T+O:-1,L))}else oe(M)&&(E=M.positions[0],S=M.positions[1],b=M.positions[2]),N=E.y<0?(h=C.attributes,f=C.indices,g):(h=_.attributes,f=_.indices,v),xT(x,w,A,E,n,r,o,a,s,u,l,h,m,p,i,AT(h,f,N,c,T,E)),xT(x,w,A,S,n,r,o,a,s,u,l,h,m,p,i,AT(h,f,N,c,T+1,S)),xT(x,w,A,b,n,r,o,a,s,u,l,h,m,p,i,AT(h,f,N,c,T+2,b))}dT(e,C,_)}var bT=fs.fromPointNormal(si.ZERO,si.UNIT_Y),MT=new si,RT=new si;function DT(e,t,i,n,r,a,o){var s;oe(o)&&(s=si.fromArray(n,3*e,gT),si.equalsEpsilon(s,i,ri.EPSILON10)?a.applyOffset.values[r]=o[e]:a.applyOffset.values[r]=o[t])}function PT(e){var t,i=e.geometry,n=i.attributes,r=n.position.values,a=oe(n.applyOffset)?n.applyOffset.values:void 0,o=i.indices,s=mT(i),u=mT(i),l=o.length,c=[];c.length=r.length/3;var m=[];for(m.length=r.length/3,t=0;t<c.length;++t)c[t]=-1,m[t]=-1;for(t=0;t<l;t+=2){var d=o[t],h=o[t+1],f=si.fromArray(r,3*d,gT),p=si.fromArray(r,3*h,vT);Math.abs(f.y)<ri.EPSILON6&&(f.y<0?f.y=-ri.EPSILON6:f.y=ri.EPSILON6),Math.abs(p.y)<ri.EPSILON6&&(p.y<0?p.y=-ri.EPSILON6:p.y=ri.EPSILON6);var _,C,g,v,y,T=s.attributes,x=s.indices,w=m,A=u.attributes,E=u.indices,S=c,b=Qv.lineSegmentPlane(f,p,bT,yT);oe(b)?(_=si.multiplyByScalar(si.UNIT_Y,5*ri.EPSILON9,MT),f.y<0&&(si.negate(_,_),T=u.attributes,x=u.indices,w=c,A=s.attributes,E=s.indices,S=m),C=si.add(b,_,RT),DT(d,h,f,r,AT(T,x,w,o,t,f),T,a),DT(d,h,C,r,AT(T,x,w,o,-1,C),T,a),si.negate(_,_),si.add(b,_,C),DT(d,h,C,r,AT(A,E,S,o,-1,C),A,a),DT(d,h,p,r,AT(A,E,S,o,t+1,p),A,a)):(y=f.y<0?(g=u.attributes,v=u.indices,c):(g=s.attributes,v=s.indices,m),DT(d,h,f,r,AT(g,v,y,o,t,f),g,a),DT(d,h,p,r,AT(g,v,y,o,t+1,p),g,a))}dT(e,u,s)}var IT=new ha,OT=new ha,LT=new si,NT=new si,BT=new si,zT=new si,FT=new si,VT=new si,UT=new An;function GT(e){for(var t=e.attributes,i=t.position.values,n=t.prevPosition.values,r=t.nextPosition.values,a=i.length,o=0;o<a;o+=3){var s,u,l=si.unpack(i,o,LT);0<l.x||(s=si.unpack(n,o,NT),(l.y<0&&0<s.y||0<l.y&&s.y<0)&&(0<o-3?(n[o]=i[o-3],n[o+1]=i[o-2],n[o+2]=i[o-1]):si.pack(l,n,o)),u=si.unpack(r,o,BT),(l.y<0&&0<u.y||0<l.y&&u.y<0)&&(o+3<a?(r[o]=i[o+3],r[o+1]=i[o+4],r[o+2]=i[o+5]):si.pack(l,r,o)))}}var kT=5*ri.EPSILON9,HT=ri.EPSILON6;My.splitLongitude=function(e){var t=e.geometry,i=t.boundingSphere;if(oe(i)&&(0<i.center.x-i.radius||Rr.intersectPlane(i,fs.ORIGIN_ZX_PLANE)!==Er.INTERSECTING))return e;if(t.geometryType!==sf.NONE)switch(t.geometryType){case sf.POLYLINES:!function(e){for(var t,i=e.geometry,n=i.attributes,r=n.position.values,a=n.prevPosition.values,o=n.nextPosition.values,s=n.expandAndWidth.values,u=oe(n.st)?n.st.values:void 0,l=oe(n.color)?n.color.values:void 0,c=mT(i),m=mT(i),d=!1,h=r.length/3,f=0;f<h;f+=4){var p=f,_=f+2,C=si.fromArray(r,3*p,LT),g=si.fromArray(r,3*_,NT);if(Math.abs(C.y)<HT)for(C.y=HT*(g.y<0?-1:1),r[3*f+1]=C.y,r[3*(f+1)+1]=C.y,N=3*p;N<3*p+12;N+=3)a[N]=r[3*f],a[N+1]=r[3*f+1],a[N+2]=r[3*f+2];if(Math.abs(g.y)<HT)for(g.y=HT*(C.y<0?-1:1),r[3*(f+2)+1]=g.y,r[3*(f+3)+1]=g.y,N=3*p;N<3*p+12;N+=3)o[N]=r[3*(f+2)],o[N+1]=r[3*(f+2)+1],o[N+2]=r[3*(f+2)+2];var v=c.attributes,y=c.indices,T=m.attributes,x=m.indices,w=Qv.lineSegmentPlane(C,g,bT,zT);if(oe(w)){d=!0;var A=si.multiplyByScalar(si.UNIT_Y,kT,FT);C.y<0&&(si.negate(A,A),v=m.attributes,y=m.indices,T=c.attributes,x=c.indices);var E=si.add(w,A,VT);v.position.values.push(C.x,C.y,C.z,C.x,C.y,C.z),v.position.values.push(E.x,E.y,E.z),v.position.values.push(E.x,E.y,E.z),v.prevPosition.values.push(a[3*p],a[3*p+1],a[3*p+2]),v.prevPosition.values.push(a[3*p+3],a[3*p+4],a[3*p+5]),v.prevPosition.values.push(C.x,C.y,C.z,C.x,C.y,C.z),v.nextPosition.values.push(E.x,E.y,E.z),v.nextPosition.values.push(E.x,E.y,E.z),v.nextPosition.values.push(E.x,E.y,E.z),v.nextPosition.values.push(E.x,E.y,E.z),si.negate(A,A),si.add(w,A,E),T.position.values.push(E.x,E.y,E.z),T.position.values.push(E.x,E.y,E.z),T.position.values.push(g.x,g.y,g.z,g.x,g.y,g.z),T.prevPosition.values.push(E.x,E.y,E.z),T.prevPosition.values.push(E.x,E.y,E.z),T.prevPosition.values.push(E.x,E.y,E.z),T.prevPosition.values.push(E.x,E.y,E.z),T.nextPosition.values.push(g.x,g.y,g.z,g.x,g.y,g.z),T.nextPosition.values.push(o[3*_],o[3*_+1],o[3*_+2]),T.nextPosition.values.push(o[3*_+3],o[3*_+4],o[3*_+5]);var S=ha.fromArray(s,2*p,IT),b=Math.abs(S.y);v.expandAndWidth.values.push(-1,b,1,b),v.expandAndWidth.values.push(-1,-b,1,-b),T.expandAndWidth.values.push(-1,b,1,b),T.expandAndWidth.values.push(-1,-b,1,-b);var M=si.magnitudeSquared(si.subtract(w,C,BT));if(M/=si.magnitudeSquared(si.subtract(g,C,BT)),oe(l)){for(var R=An.fromArray(l,4*p,UT),D=An.fromArray(l,4*_,UT),P=ri.lerp(R.x,D.x,M),I=ri.lerp(R.y,D.y,M),O=ri.lerp(R.z,D.z,M),L=ri.lerp(R.w,D.w,M),N=4*p;N<4*p+8;++N)v.color.values.push(l[N]);for(v.color.values.push(P,I,O,L),v.color.values.push(P,I,O,L),T.color.values.push(P,I,O,L),T.color.values.push(P,I,O,L),N=4*_;N<4*_+8;++N)T.color.values.push(l[N])}if(oe(u)){var B=ha.fromArray(u,2*p,IT),z=ha.fromArray(u,2*(f+3),OT),F=ri.lerp(B.x,z.x,M);for(N=2*p;N<2*p+4;++N)v.st.values.push(u[N]);for(v.st.values.push(F,B.y),v.st.values.push(F,z.y),T.st.values.push(F,B.y),T.st.values.push(F,z.y),N=2*_;N<2*_+4;++N)T.st.values.push(u[N])}t=v.position.values.length/3-4,y.push(t,t+2,t+1),y.push(t+1,t+2,t+3),t=T.position.values.length/3-4,x.push(t,t+2,t+1),x.push(t+1,t+2,t+3)}else{var V,U=C.y<0?(V=m.attributes,m.indices):(V=c.attributes,c.indices);for(V.position.values.push(C.x,C.y,C.z),V.position.values.push(C.x,C.y,C.z),V.position.values.push(g.x,g.y,g.z),V.position.values.push(g.x,g.y,g.z),N=3*f;N<3*f+12;++N)V.prevPosition.values.push(a[N]),V.nextPosition.values.push(o[N]);for(N=2*f;N<2*f+8;++N)V.expandAndWidth.values.push(s[N]),oe(u)&&V.st.values.push(u[N]);if(oe(l))for(N=4*f;N<4*f+16;++N)V.color.values.push(l[N]);t=V.position.values.length/3-4,U.push(t,t+2,t+1),U.push(t+1,t+2,t+3)}}d&&(GT(m),GT(c)),dT(e,m,c)}(e);break;case sf.TRIANGLES:ST(e);break;case sf.LINES:PT(e)}else eT(t),t.primitiveType===Yd.TRIANGLES?ST(e):t.primitiveType===Yd.LINES&&PT(e);return e};var WT=ri.EPSILON10;function qT(e,t,i){if(oe(e)){i=z(i,!1);var n,r,a,o=e.length;if(o<2)return e;for(n=1;n<o&&!t(r=e[n-1],a=e[n],WT);++n);if(n===o)return i&&t(e[0],e[e.length-1],WT)?e.slice(1):e;for(var s=e.slice(0,n);n<o;++n)t(r,a=e[n],WT)||(s.push(a),r=a);return i&&1<s.length&&t(s[0],s[s.length-1],WT)&&s.shift(),s}}function jT(e,t,i){this.minimum=si.clone(z(e,si.ZERO)),this.maximum=si.clone(z(t,si.ZERO)),i=oe(i)?si.clone(i):si.midpoint(this.minimum,this.maximum,new si),this.center=i}jT.fromPoints=function(e,t){if(oe(t)||(t=new jT),!oe(e)||0===e.length)return t.minimum=si.clone(si.ZERO,t.minimum),t.maximum=si.clone(si.ZERO,t.maximum),t.center=si.clone(si.ZERO,t.center),t;for(var i=e[0].x,n=e[0].y,r=e[0].z,a=e[0].x,o=e[0].y,s=e[0].z,u=e.length,l=1;l<u;l++)var c=e[l],m=c.x,d=c.y,h=c.z,i=Math.min(m,i),a=Math.max(m,a),n=Math.min(d,n),o=Math.max(d,o),r=Math.min(h,r),s=Math.max(h,s);var f=t.minimum;f.x=i,f.y=n,f.z=r;var p=t.maximum;return p.x=a,p.y=o,p.z=s,t.center=si.midpoint(f,p,t.center),t},jT.clone=function(e,t){if(oe(e))return oe(t)?(t.minimum=si.clone(e.minimum,t.minimum),t.maximum=si.clone(e.maximum,t.maximum),t.center=si.clone(e.center,t.center),t):new jT(e.minimum,e.maximum,e.center)},jT.equals=function(e,t){return e===t||oe(e)&&oe(t)&&si.equals(e.center,t.center)&&si.equals(e.minimum,t.minimum)&&si.equals(e.maximum,t.maximum)};var YT=new si;jT.intersectPlane=function(e,t){YT=si.subtract(e.maximum,e.minimum,YT);var i=si.multiplyByScalar(YT,.5,YT),n=t.normal,r=i.x*Math.abs(n.x)+i.y*Math.abs(n.y)+i.z*Math.abs(n.z),a=si.dot(e.center,n)+t.distance;return 0<a-r?Er.INSIDE:a+r<0?Er.OUTSIDE:Er.INTERSECTING},jT.prototype.clone=function(e){return jT.clone(this,e)},jT.prototype.intersectPlane=function(e){return jT.intersectPlane(this,e)},jT.prototype.equals=function(e){return jT.equals(this,e)};var XT=new An;function KT(e,t){e=(t=z(t,gr.WGS84)).scaleToGeodeticSurface(e);var i=Tf.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=si.fromCartesian4(Rn.getColumn(i,0,XT)),this._yAxis=si.fromCartesian4(Rn.getColumn(i,1,XT));var n=si.fromCartesian4(Rn.getColumn(i,2,XT));this._plane=fs.fromPointNormal(e,n)}Object.defineProperties(KT.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var ZT=new jT;KT.fromPoints=function(e,t){return new KT(jT.fromPoints(e,ZT).center,t)};var JT=new Jv,QT=new si;KT.prototype.projectPointOntoPlane=function(e,t){var i=JT;i.origin=e,si.normalize(e,i.direction);var n=Qv.rayPlane(i,this._plane,QT);if(oe(n)||(si.negate(i.direction,i.direction),n=Qv.rayPlane(i,this._plane,QT)),oe(n)){var r=si.subtract(n,this._origin,n),a=si.dot(this._xAxis,r),o=si.dot(this._yAxis,r);return oe(t)?(t.x=a,t.y=o,t):new ha(a,o)}},KT.prototype.projectPointsOntoPlane=function(e,t){oe(t)||(t=[]);for(var i=0,n=e.length,r=0;r<n;r++){var a=this.projectPointOntoPlane(e[r],t[i]);oe(a)&&(t[i]=a,i++)}return t.length=i,t},KT.prototype.projectPointToNearestOnPlane=function(e,t){oe(t)||(t=new ha);var i=JT;i.origin=e,si.clone(this._plane.normal,i.direction);var n=Qv.rayPlane(i,this._plane,QT);oe(n)||(si.negate(i.direction,i.direction),n=Qv.rayPlane(i,this._plane,QT));var r=si.subtract(n,this._origin,n),a=si.dot(this._xAxis,r),o=si.dot(this._yAxis,r);return t.x=a,t.y=o,t},KT.prototype.projectPointsToNearestOnPlane=function(e,t){oe(t)||(t=[]);var i=e.length;t.length=i;for(var n=0;n<i;n++)t[n]=this.projectPointToNearestOnPlane(e[n],t[n]);return t};var $T=new si;function ex(e,t,i,n,r,a,o){var s,u,l=(s=e)*(u=i)*(4+s*(4-3*u))/16;return(1-l)*e*t*(n+l*r*(o+l*a*(2*o*o-1)))}KT.prototype.projectPointOntoEllipsoid=function(e,t){oe(t)||(t=new si);var i=this._ellipsoid,n=this._origin,r=this._xAxis,a=this._yAxis,o=$T;return si.multiplyByScalar(r,e.x,o),t=si.add(n,o,t),si.multiplyByScalar(a,e.y,o),si.add(t,o,t),i.scaleToGeocentricSurface(t,t),t},KT.prototype.projectPointsOntoEllipsoid=function(e,t){var i=e.length;oe(t)?t.length=i:t=new Array(i);for(var n=0;n<i;++n)t[n]=this.projectPointOntoEllipsoid(e[n],t[n]);return t};var tx=new si,ix=new si;function nx(e,t,i,n){var r,a,o,s,u,l,c,m,d,h,f,p,_,C,g,v,y,T,x,w,A,E,S,b,M;si.normalize(n.cartographicToCartesian(t,ix),tx),si.normalize(n.cartographicToCartesian(i,ix),ix);!function(e,t,i,n,r,a,o){var s=(t-i)/t,u=a-n,l=Math.atan((1-s)*Math.tan(r)),c=Math.atan((1-s)*Math.tan(o)),m=Math.cos(l),d=Math.sin(l),h=Math.cos(c),f=Math.sin(c),p=m*h,_=m*f,C=d*f,g=d*h,v=u,y=ri.TWO_PI,T=Math.cos(v),x=Math.sin(v);do{T=Math.cos(v),x=Math.sin(v);var w,A,E=_-g*T,S=Math.sqrt(h*h*x*x+E*E),b=C+p*T,M=Math.atan2(S,b),y=v,R=b-2*C/(A=0===S?(w=0,1):1-(w=p*x/S)*w);isNaN(R)&&(R=0),v=u+ex(s,w,A,M,S,b,R)}while(Math.abs(v-y)>ri.EPSILON12);var D=A*(t*t-i*i)/(i*i),P=D*(256+D*(D*(74-47*D)-128))/1024,I=R*R,O=i*(1+D*(4096+D*(D*(320-175*D)-768))/16384)*(M-P*S*(R+P*(b*(2*I-1)-P*R*(4*S*S-3)*(4*I-3)/6)/4)),L=Math.atan2(h*x,_-g*T),N=Math.atan2(m*x,_*T-g);e._distance=O,e._startHeading=L,e._endHeading=N,e._uSquared=D}(e,n.maximumRadius,n.minimumRadius,t.longitude,t.latitude,i.longitude,i.latitude),e._start=dr.clone(t,e._start),e._end=dr.clone(i,e._end),e._start.height=0,e._end.height=0,a=(r=e)._uSquared,o=r._ellipsoid.maximumRadius,s=r._ellipsoid.minimumRadius,u=(o-s)/o,l=Math.cos(r._startHeading),c=Math.sin(r._startHeading),m=(1-u)*Math.tan(r._start.latitude),d=1/Math.sqrt(1+m*m),h=d*m,f=Math.atan2(m,l),C=1-(_=(p=d*c)*p),g=Math.sqrt(C),E=1-3*(v=a/4)+35*(y=v*v)/4,S=1-5*v,b=(w=1+v-3*y/4+5*(T=y*v)/4-175*(x=y*y)/64)*f-(A=1-v+15*y/8-35*T/8)*Math.sin(2*f)*v/2-E*Math.sin(4*f)*y/16-S*Math.sin(6*f)*T/48-5*Math.sin(8*f)*x/512,(M=r._constants).a=o,M.b=s,M.f=u,M.cosineHeading=l,M.sineHeading=c,M.tanU=m,M.cosineU=d,M.sineU=h,M.sigma=f,M.sineAlpha=p,M.sineSquaredAlpha=_,M.cosineSquaredAlpha=C,M.cosineAlpha=g,M.u2Over4=v,M.u4Over16=y,M.u6Over64=T,M.u8Over256=x,M.a0=w,M.a1=A,M.a2=E,M.a3=S,M.distanceRatio=b}function rx(e,t,i){var n=z(i,gr.WGS84);this._ellipsoid=n,this._start=new dr,this._end=new dr,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0,oe(e)&&oe(t)&&nx(this,e,t,n)}Object.defineProperties(rx.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){return this._startHeading}},endHeading:{get:function(){return this._endHeading}}}),rx.prototype.setEndPoints=function(e,t){nx(this,e,t,this._ellipsoid)},rx.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)},rx.prototype.interpolateUsingSurfaceDistance=function(e,t){var i=this._constants,n=i.distanceRatio+e/i.b,r=Math.cos(2*n),a=Math.cos(4*n),o=Math.cos(6*n),s=Math.sin(2*n),u=Math.sin(4*n),l=Math.sin(6*n),c=Math.sin(8*n),m=n*n,d=n*m,h=i.u8Over256,f=i.u2Over4,p=i.u6Over64,_=i.u4Over16,C=2*d*h*r/3+n*(1-f+7*_/4-15*p/4+579*h/64-(_-15*p/4+187*h/16)*r-(5*p/4-115*h/16)*a-29*h*o/16)+(f/2-_+71*p/32-85*h/16)*s+(5*_/16-5*p/4+383*h/96)*u-m*((p-11*h/2)*s+5*h*u/2)+(29*p/96-29*h/16)*l+539*h*c/1536,g=Math.asin(Math.sin(C)*i.cosineAlpha),v=Math.atan(i.a/i.b*Math.tan(g));C-=i.sigma;var y=Math.cos(2*i.sigma+C),T=Math.sin(C),x=Math.cos(C),w=i.cosineU*x,A=i.sineU*T,E=Math.atan2(T*i.sineHeading,w-A*i.cosineHeading)-ex(i.f,i.sineAlpha,i.cosineSquaredAlpha,C,T,x,y);return oe(t)?(t.longitude=this._start.longitude+E,t.latitude=v,t.height=0,t):new dr(this._start.longitude+E,v,0)};var ax={numberOfPoints:function(e,t,i){var n=si.distance(e,t);return Math.ceil(n/i)},numberOfPointsRhumbLine:function(e,t,i){var n=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.ceil(Math.sqrt(n/(i*i)))}},ox=new dr;ax.extractHeights=function(e,t){for(var i=e.length,n=new Array(i),r=0;r<i;r++){var a=e[r];n[r]=t.cartesianToCartographic(a,ox).height}return n};var sx=new Rn,ux=new si,lx=new si,cx=new fs(si.UNIT_X,0),mx=new si,dx=new fs(si.UNIT_X,0),hx=new si,fx=new si,px=[];function _x(e,t,i){var n=px;if(n.length=e,t===i){for(a=0;a<e;a++)n[a]=t;return n}for(var r=(i-t)/e,a=0;a<e;a++){var o=t+a*r;n[a]=o}return n}var Cx=new dr,gx=new dr,vx=new si,yx=new si,Tx=new si,xx=new rx,wx=new Av;function Ax(e,t,i,n,r,a,o,s){var u=n.scaleToGeodeticSurface(e,yx),l=n.scaleToGeodeticSurface(t,Tx),c=ax.numberOfPoints(e,t,i),m=n.cartesianToCartographic(u,Cx),d=n.cartesianToCartographic(l,gx),h=_x(c,r,a);xx.setEndPoints(m,d);var f=xx.surfaceDistance/c,p=s;m.height=r;var _=n.cartographicToCartesian(m,vx);si.pack(_,o,p),p+=3;for(var C=1;C<c;C++){var g=xx.interpolateUsingSurfaceDistance(C*f,gx);g.height=h[C],_=n.cartographicToCartesian(g,vx),si.pack(_,o,p),p+=3}return p}function Ex(e,t,i,n,r,a,o,s){var u=n.scaleToGeodeticSurface(e,yx),l=n.scaleToGeodeticSurface(t,Tx),c=n.cartesianToCartographic(u,Cx),m=n.cartesianToCartographic(l,gx),d=ax.numberOfPointsRhumbLine(c,m,i),h=_x(d,r,a);wx.ellipsoid.equals(n)||(wx=new Av(void 0,void 0,n)),wx.setEndPoints(c,m);var f=wx.surfaceDistance/d,p=s;c.height=r;var _=n.cartographicToCartesian(c,vx);si.pack(_,o,p),p+=3;for(var C=1;C<d;C++){var g=wx.interpolateUsingSurfaceDistance(C*f,gx);g.height=h[C],_=n.cartographicToCartesian(g,vx),si.pack(_,o,p),p+=3}return p}ax.wrapLongitude=function(e,t){var i=[],n=[];if(oe(e)&&0<e.length){t=z(t,Rn.IDENTITY);var r=Rn.inverseTransformation(t,sx),a=Rn.multiplyByPoint(r,si.ZERO,ux),o=si.normalize(Rn.multiplyByPointAsVector(r,si.UNIT_Y,lx),lx),s=fs.fromPointNormal(a,o,cx),u=si.normalize(Rn.multiplyByPointAsVector(r,si.UNIT_X,mx),mx),l=fs.fromPointNormal(a,u,dx),c=1;i.push(si.clone(e[0]));for(var m=i[0],d=e.length,h=1;h<d;++h){var f,p,_=e[h];!(fs.getPointDistance(l,m)<0||fs.getPointDistance(l,_)<0)||oe(f=Qv.lineSegmentPlane(m,_,s,hx))&&(p=si.multiplyByScalar(o,5e-9,fx),fs.getPointDistance(s,m)<0&&si.negate(p,p),i.push(si.add(f,p,new si)),n.push(c+1),si.negate(p,p),i.push(si.add(f,p,new si)),c=1),i.push(si.clone(e[h])),c++,m=_}n.push(c)}return{positions:i,lengths:n}},ax.generateArc=function(e){oe(e)||(e={});var t=e.positions,i=t.length,n=z(e.ellipsoid,gr.WGS84),r=z(e.height,0),a=Array.isArray(r),o=z(e.ignoreEndPosition,!1);if(i<1)return[];if(1===i){var s,u=n.scaleToGeodeticSurface(t[0],yx);return 0!==(r=a?r[0]:r)&&(s=n.geodeticSurfaceNormal(u,vx),si.multiplyByScalar(s,r,s),si.add(u,s,u)),[u.x,u.y,u.z]}var l,c=e.minDistance;oe(c)||(l=z(e.granularity,ri.RADIANS_PER_DEGREE),c=ri.chordLength(l,n.maximumRadius));for(var m,d=0,h=0;h<i-1;h++)d+=ax.numberOfPoints(t[h],t[h+1],c);m=o?3*d:3*(d+1);var f,p,_,C=new Array(m),g=0;for(h=0;h<i-1;h++)g=Ax(t[h],t[h+1],c,n,a?r[h]:r,a?r[h+1]:r,C,g);return px.length=0,o||(f=t[i-1],(p=n.cartesianToCartographic(f,Cx)).height=a?r[i-1]:r,_=n.cartographicToCartesian(p,vx),si.pack(_,C,m-3)),C};var Sx=new dr,bx=new dr;ax.generateRhumbArc=function(e){oe(e)||(e={});var t=e.positions,i=t.length,n=z(e.ellipsoid,gr.WGS84),r=z(e.height,0),a=Array.isArray(r);if(i<1)return[];if(1===i){var o,s=n.scaleToGeodeticSurface(t[0],yx);return 0!==(r=a?r[0]:r)&&(o=n.geodeticSurfaceNormal(s,vx),si.multiplyByScalar(o,r,o),si.add(s,o,s)),[s.x,s.y,s.z]}for(var u,l=z(e.granularity,ri.RADIANS_PER_DEGREE),c=0,m=n.cartesianToCartographic(t[0],Sx),d=0;d<i-1;d++)u=n.cartesianToCartographic(t[d+1],bx),c+=ax.numberOfPointsRhumbLine(m,u,l),m=dr.clone(u,Sx);var h=3*(c+1),f=new Array(h),p=0;for(d=0;d<i-1;d++)p=Ex(t[d],t[d+1],l,n,a?r[d]:r,a?r[d+1]:r,f,p);px.length=0;var _=t[i-1],C=n.cartesianToCartographic(_,Cx);C.height=a?r[i-1]:r;var g=n.cartographicToCartesian(C,vx);return si.pack(g,f,h-3),f},ax.generateCartesianArc=function(e){for(var t=ax.generateArc(e),i=t.length/3,n=new Array(i),r=0;r<i;r++)n[r]=si.unpack(t,3*r);return n},ax.generateCartesianRhumbArc=function(e){for(var t=ax.generateRhumbArc(e),i=t.length/3,n=new Array(i),r=0;r<i;r++)n[r]=si.unpack(t,3*r);return n};var Mx=[new si,new si],Rx=new si,Dx=new si,Px=new si,Ix=new si,Ox=new si,Lx=new si,Nx=new si,Bx=new si,zx=new si,Fx=new si,Vx=new si,Ux={},Gx=new dr;function kx(e,t,i,n){var r=e[0],a=e[1],o=si.angleBetween(r,a),s=Math.ceil(o/n),u=new Array(s);if(t===i){for(c=0;c<s;c++)u[c]=t;return u.push(i),u}for(var l=(i-t)/s,c=1;c<s;c++){var m=t+c*l;u[c]=m}return u[0]=t,u.push(i),u}var Hx=new si,Wx=new si;var qx=new si(-1,0,0),jx=new Rn,Yx=new Rn,Xx=new pi,Kx=pi.IDENTITY.clone(),Zx=new si,Jx=new An,Qx=new si;function $x(e,t,i,n,r,a,o,s){var u=Zx,l=Jx;jx=Tf.eastNorthUpToFixedFrame(e,r,jx),u=Rn.multiplyByPointAsVector(jx,qx,u),u=si.normalize(u,u);var c,m,d,h,f,p,_,C=(c=u,m=t,h=new KT(d=e,r),f=h.projectPointOntoPlane(si.add(d,c,Hx),Hx),p=h.projectPointOntoPlane(si.add(d,m,Wx),Wx),_=ha.angleBetween(f,p),0<=p.x*f.y-p.y*f.x?-_:_);Xx=pi.fromRotationZ(C,Xx),Qx.z=a,jx=Rn.multiplyTransformation(jx,Rn.fromRotationTranslation(Xx,Qx,Yx),jx);var g=Kx;g[0]=o;for(var v=0;v<s;v++)for(var y=0;y<i.length;y+=3)l=si.fromArray(i,y,l),l=pi.multiplyByVector(g,l,l),l=Rn.multiplyByPoint(jx,l,l),n.push(l.x,l.y,l.z);return n}var ew=new si;function tw(e,t,i,n,r,a,o){for(var s=0;s<e.length;s+=3){n=$x(si.fromArray(e,s,ew),t,i,n,r,a[s/3],o,1)}return n}function iw(e,t){for(var i=e.length,n=new Array(3*i),r=0,a=t.x+t.width/2,o=t.y+t.height/2,s=0;s<i;s++)n[r++]=e[s].x-a,n[r++]=0,n[r++]=e[s].y-o;return n}var nw=new xa,rw=new si,aw=new pi;function ow(e,t,i,n,r,a,o,s,u,l){var c,m=si.angleBetween(si.subtract(t,e,Fx),si.subtract(i,e,Vx)),d=n===Yg.BEVELED?0:Math.ceil(m/ri.toRadians(5)),h=pi.fromQuaternion(xa.fromAxisAngle(r?si.negate(e,Fx):e,m/(d+1),nw),aw);if(t=si.clone(t,rw),0<d)for(var f=l?2:1,p=0;p<d;p++)t=pi.multiplyByVector(h,t,t),c=si.subtract(t,e,Fx),c=si.normalize(c,c),r||(c=si.negate(c,c)),o=$x(a.scaleToGeodeticSurface(t,Vx),c,s,o,a,u,1,f);else c=si.subtract(t,e,Fx),c=si.normalize(c,c),r||(c=si.negate(c,c)),o=$x(a.scaleToGeodeticSurface(t,Vx),c,s,o,a,u,1,1),i=si.clone(i,rw),c=si.subtract(i,e,Fx),c=si.normalize(c,c),r||(c=si.negate(c,c)),o=$x(a.scaleToGeodeticSurface(i,Vx),c,s,o,a,u,1,1);return o}Ux.removeDuplicatesFromShape=function(e){for(var t=e.length,i=[],n=t-1,r=0;r<t;n=r++){var a=e[n],o=e[r];ha.equals(a,o)||i.push(o)}return i},Ux.angleIsGreaterThanPi=function(e,t,i,n){var r=new KT(i,n),a=r.projectPointOntoPlane(si.add(i,e,Hx),Hx),o=r.projectPointOntoPlane(si.add(i,t,Wx),Wx);return 0<=o.x*a.y-o.y*a.x};var sw=new si,uw=new si;function lw(e){e=z(e,z.EMPTY_OBJECT),this.position=z(e.position,!1),this.normal=z(e.normal,!1),this.st=z(e.st,!1),this.bitangent=z(e.bitangent,!1),this.tangent=z(e.tangent,!1),this.color=z(e.color,!1)}function cw(e){var t=(e=z(e,z.EMPTY_OBJECT)).polylinePositions,i=e.shapePositions;this._positions=t,this._shape=i,this._ellipsoid=gr.clone(z(e.ellipsoid,gr.WGS84)),this._cornerType=z(e.cornerType,Yg.ROUNDED),this._vertexFormat=lw.clone(z(e.vertexFormat,lw.DEFAULT)),this._granularity=z(e.granularity,ri.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry",this.isOffset=z(e.isOffset,!1),this.isMultiImage=z(e.isMultiImage,!1);var n=1+t.length*si.packedLength;n+=1+i.length*ha.packedLength,this.packedLength=n+gr.packedLength+lw.packedLength+2+1+1}Ux.computePositions=function(e,t,i,n,r,a){var o=n._ellipsoid,s=function(e,t){for(var i=new Array(e.length),n=0;n<e.length;n++){var r=e[n];Gx=t.cartesianToCartographic(r,Gx),i[n]=Gx.height,e[n]=t.scaleToGeodeticSurface(r,r)}return i}(e,o),u=n._granularity,l=n._cornerType,c=(r?function(e,t){var i=e.length,n=new Array(6*i),r=0,a=t.x+t.width/2,o=t.y+t.height/2,s=e[0];n[r++]=s.x-a,n[r++]=0,n[r++]=s.y-o;for(var u=1;u<i;u++){var l=(s=e[u]).x-a,c=s.y-o;n[r++]=l,n[r++]=0,n[r++]=c,n[r++]=l,n[r++]=0,n[r++]=c}return s=e[0],n[r++]=s.x-a,n[r++]=0,n[r++]=s.y-o,n}:iw)(t,i),m=r?iw(t,i):void 0,d=i.height/2;a&&(d=0);var h=i.width/2,f=e.length,p=[],_=r?[]:void 0,C=Rx,g=Dx,v=Px,y=Ix,T=Ox,x=Lx,w=Nx,A=Bx,E=zx,S=e[0],b=e[1],y=o.geodeticSurfaceNormal(S,y);C=si.subtract(b,S,C),C=si.normalize(C,C),A=si.cross(y,C,A),A=si.normalize(A,A);var M,R=s[0],D=s[1];r&&(_=$x(S,A,m,_,o,R+d,1,1)),E=si.clone(S,E),S=b,g=si.negate(C,g);for(var P=1;P<f-1;P++){var I=r?2:1,b=e[P+1],C=si.subtract(b,S,C);C=si.normalize(C,C),v=si.add(C,g,v),v=si.normalize(v,v),y=o.geodeticSurfaceNormal(S,y);var O=si.multiplyByScalar(y,si.dot(C,y),sw);si.subtract(C,O,O),si.normalize(O,O);var L,N,B=si.multiplyByScalar(y,si.dot(g,y),uw);si.subtract(g,B,B),si.normalize(B,B),!ri.equalsEpsilon(Math.abs(si.dot(O,B)),1,ri.EPSILON7)?(v=si.cross(v,y,v),v=si.cross(y,v,v),v=si.normalize(v,v),L=1/Math.max(.25,si.magnitude(si.cross(v,g,Fx))),(N=Ux.angleIsGreaterThanPi(C,g,S,o))?(T=si.add(S,si.multiplyByScalar(v,L*h,v),T),x=si.add(T,si.multiplyByScalar(A,h,x),x),Mx[0]=si.clone(E,Mx[0]),Mx[1]=si.clone(x,Mx[1]),M=kx(Mx,R+d,D+d,u),p=tw(ax.generateArc({positions:Mx,granularity:u,ellipsoid:o}),A,c,p,o,M,1),A=si.cross(y,C,A),A=si.normalize(A,A),w=si.add(T,si.multiplyByScalar(A,h,w),w),l===Yg.ROUNDED||l===Yg.BEVELED?ow(T,x,w,l,N,o,p,c,D+d,r):p=$x(S,v=si.negate(v,v),c,p,o,D+d,L,I)):(T=si.add(S,si.multiplyByScalar(v,L*h,v),T),x=si.add(T,si.multiplyByScalar(A,-h,x),x),Mx[0]=si.clone(E,Mx[0]),Mx[1]=si.clone(x,Mx[1]),M=kx(Mx,R+d,D+d,u),p=tw(ax.generateArc({positions:Mx,granularity:u,ellipsoid:o}),A,c,p,o,M,1),A=si.cross(y,C,A),A=si.normalize(A,A),w=si.add(T,si.multiplyByScalar(A,-h,w),w),l===Yg.ROUNDED||l===Yg.BEVELED?ow(T,x,w,l,N,o,p,c,D+d,r):p=$x(S,v,c,p,o,D+d,L,I)),E=si.clone(w,E),g=si.negate(C,g)):(p=$x(E,A,c,p,o,R+d,1,1),E=S),R=D,D=s[P+1],S=b}Mx[0]=si.clone(E,Mx[0]),Mx[1]=si.clone(S,Mx[1]),M=kx(Mx,R+d,D+d,u),p=tw(ax.generateArc({positions:Mx,granularity:u,ellipsoid:o}),A,c,p,o,M,1),r&&(_=$x(S,A,m,_,o,D+d,1,1)),f=p.length;var z=r?f+_.length:f,F=new Float64Array(z);return F.set(p),r&&F.set(_,f),F},lw.POSITION_ONLY=Object.freeze(new lw({position:!0})),lw.POSITION_AND_NORMAL=Object.freeze(new lw({position:!0,normal:!0})),lw.POSITION_NORMAL_AND_ST=Object.freeze(new lw({position:!0,normal:!0,st:!0})),lw.POSITION_AND_ST=Object.freeze(new lw({position:!0,st:!0})),lw.POSITION_AND_COLOR=Object.freeze(new lw({position:!0,color:!0})),lw.ALL=Object.freeze(new lw({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0})),lw.DEFAULT=lw.POSITION_NORMAL_AND_ST,lw.packedLength=6,lw.pack=function(e,t,i){return i=z(i,0),t[i++]=e.position?1:0,t[i++]=e.normal?1:0,t[i++]=e.st?1:0,t[i++]=e.tangent?1:0,t[i++]=e.bitangent?1:0,t[i]=e.color?1:0,t},lw.unpack=function(e,t,i){return t=z(t,0),oe(i)||(i=new lw),i.position=1===e[t++],i.normal=1===e[t++],i.st=1===e[t++],i.tangent=1===e[t++],i.bitangent=1===e[t++],i.color=1===e[t],i},lw.clone=function(e,t){if(oe(e))return oe(t)||(t=new lw),t.position=e.position,t.normal=e.normal,t.st=e.st,t.tangent=e.tangent,t.bitangent=e.bitangent,t.color=e.color,t},cw.pack=function(e,t,i){var n;i=z(i,0);var r=e._positions,a=r.length;for(t[i++]=a,n=0;n<a;++n,i+=si.packedLength)si.pack(r[n],t,i);var o=e._shape,a=o.length;for(t[i++]=a,n=0;n<a;++n,i+=ha.packedLength)ha.pack(o[n],t,i);return gr.pack(e._ellipsoid,t,i),i+=gr.packedLength,lw.pack(e._vertexFormat,t,i),i+=lw.packedLength,t[i++]=e._cornerType,t[i++]=e._granularity,t[i++]=e.isOffset?1:0,t[i]=e.isMultiImage?1:0,t};var mw=gr.clone(gr.UNIT_SPHERE),dw=new lw,hw={polylinePositions:void 0,shapePositions:void 0,ellipsoid:mw,vertexFormat:dw,cornerType:void 0,granularity:void 0,isOffset:void 0,isMultiImage:void 0};cw.unpack=function(e,t,i){t=z(t,0);for(var n=e[t++],r=new Array(n),a=0;a<n;++a,t+=si.packedLength)r[a]=si.unpack(e,t);n=e[t++];var o=new Array(n);for(a=0;a<n;++a,t+=ha.packedLength)o[a]=ha.unpack(e,t);var s=gr.unpack(e,t,mw),u=lw.unpack(e,t+=gr.packedLength,dw);t+=lw.packedLength;var l=e[t++],c=e[t],m=e[++t],d=e[++t];return oe(i)?(i._positions=r,i._shape=o,i._ellipsoid=gr.clone(s,i._ellipsoid),i._vertexFormat=lw.clone(u,i._vertexFormat),i._cornerType=l,i._granularity=c,i.isOffset=m,i.isMultiImage=d,i):(hw.polylinePositions=r,hw.shapePositions=o,hw.cornerType=l,hw.granularity=c,hw.isOffset=m,hw.isMultiImage=d,new cw(hw))};var fw=new Zd;cw.createGeometry=function(e){var t=qT(e._positions,si.equalsEpsilon),i=e._shape,i=Ux.removeDuplicatesFromShape(i);if(!(t.length<2||i.length<3)){Mv.computeWindingOrder2D(i)===th.CLOCKWISE&&i.reverse();var n=Zd.fromPoints(i,fw);return function(e,t,i,n,r){var a=new Uv;n.position&&(a.position=new Ev({componentDatatype:Ud.DOUBLE,componentsPerAttribute:3,values:e}));for(var o,s,u,l,c,m=t.length,d=e.length/3,h=(d-2*m)/(2*m),f=Mv.triangulate(t),p=(h-1)*m*6+2*f.length,_=kd.createTypedArray(d,p),C=2*m,g=0,v=0;v<h-1;v++){for(o=0;o<m-1;o++)c=(s=2*o+v*m*2)+C,l=(u=s+1)+C,_[g++]=u,_[g++]=s,_[g++]=l,_[g++]=l,_[g++]=s,_[g++]=c;l=(u=(s=2*m-2+v*m*2)+1)+C,c=s+C,_[g++]=u,_[g++]=s,_[g++]=l,_[g++]=l,_[g++]=s,_[g++]=c}if(n.st||n.tangent||n.bitangent){var y,T,x=new Float32Array(2*d),w=1/(h-1),A=1/i.height,E=i.height/2,S=0;if(r)for(v=0;v<h;v++){for(y=v*w,T=A*(t[0].y+E),x[S++]=y+10,x[S++]=.99,o=1;o<m;o++)x[S++]=y+10*(o+1),x[S++]=.01,x[S++]=y+10*(o+1),x[S++]=.99;T=A*(t[0].y+E),x[S++]=y+10*o,x[S++]=.01}else for(v=0;v<h;v++){for(y=v*w,T=A*(t[0].y+E),x[S++]=y,x[S++]=T,o=1;o<m;o++)T=A*(t[o].y+E),x[S++]=y,x[S++]=T,x[S++]=y,x[S++]=T;T=A*(t[0].y+E),x[S++]=y,x[S++]=T}for(o=0;o<m;o++)y=0,T=A*(t[o].y+E),x[S++]=y,x[S++]=T;for(o=0;o<m;o++)y=(h-1)*w,T=A*(t[o].y+E),x[S++]=y,x[S++]=T;a.st=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:2,values:new Float32Array(x)})}var b=d-2*m;for(v=0;v<f.length;v+=3){var M=f[v]+b,R=f[v+1]+b,D=f[v+2]+b;_[g++]=M,_[g++]=R,_[g++]=D,_[g++]=D+m,_[g++]=R+m,_[g++]=M+m}var P=new rp({attributes:a,indices:_,boundingSphere:Rr.fromVertices(e),primitiveType:Yd.TRIANGLES});if(n.normal&&(P=My.computeNormal(P)),n.tangent||n.bitangent){try{P=My.computeTangentAndBitangent(P)}catch(e){lc("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}n.tangent||(P.attributes.tangent=void 0),n.bitangent||(P.attributes.bitangent=void 0),n.st||(P.attributes.st=void 0)}return P}(Ux.computePositions(t,i,n,e,!0,e.isOffset),i,n,e._vertexFormat,e.isMultiImage)}};var pw=[new si,new si],_w=new si,Cw=new si,gw=new si,vw=new si,yw=new si,Tw=new si,xw=new si,ww=new si,Aw=new si,Ew=new si,Sw=new si;function bw(){}var Mw=new dr;function Rw(e,t,i,n){var r=e[0],a=e[1],o=si.angleBetween(r,a),s=Math.ceil(o/n),u=new Array(s);if(t===i){for(c=0;c<s;c++)u[c]=t;return u.push(i),u}for(var l=(i-t)/s,c=1;c<s;c++){var m=t+c*l;u[c]=m}return u[0]=t,u.push(i),u}var Dw=new si,Pw=new si;var Iw=new si(-1,0,0),Ow=new Rn,Lw=new Rn,Nw=new pi,Bw=pi.IDENTITY.clone(),zw=new si,Fw=new An,Vw=new si;function Uw(e,t,i,n,r,a,o,s){var u=zw,l=Fw;Ow=Tf.eastNorthUpToFixedFrame(e,r,Ow),u=Rn.multiplyByPointAsVector(Ow,Iw,u),u=si.normalize(u,u);var c,m,d,h,f,p,_,C=(c=u,m=t,h=new KT(d=e,r),f=h.projectPointOntoPlane(si.add(d,c,Dw),Dw),p=h.projectPointOntoPlane(si.add(d,m,Pw),Pw),_=ha.angleBetween(f,p),0<=p.x*f.y-p.y*f.x?-_:_);Nw=pi.fromRotationZ(C,Nw),Vw.z=a,Ow=Rn.multiplyTransformation(Ow,Rn.fromRotationTranslation(Nw,Vw,Lw),Ow);var g=Bw;g[0]=o;for(var v=0;v<s;v++)for(var y=0;y<i.length;y+=3)l=si.fromArray(i,y,l),l=pi.multiplyByVector(g,l,l),l=Rn.multiplyByPoint(Ow,l,l),n.push(l.x,l.y,l.z);return n}var Gw=new si;function kw(e,t,i,n,r,a,o){for(var s=0;s<e.length;s+=3){n=Uw(si.fromArray(e,s,Gw),t,i,n,r,a[s/3],o,1)}return n}function Hw(e){for(var t=e.length,i=new Array(3*t),n=0,r=0;r<t;r++)i[n++]=+e[r].x,i[n++]=0,i[n++]=+e[r].y;return i}var Ww=new xa,qw=new si,jw=new pi;function Yw(e,t,i,n,r,a,o,s,u,l){var c,m=si.angleBetween(si.subtract(t,e,Ew),si.subtract(i,e,Sw)),d=n===Yg.BEVELED?0:Math.ceil(m/ri.toRadians(5)),h=pi.fromQuaternion(xa.fromAxisAngle(r?si.negate(e,Ew):e,m/(d+1),Ww),jw);if(t=si.clone(t,qw),0<d)for(var f=l?2:1,p=0;p<d;p++)t=pi.multiplyByVector(h,t,t),c=si.subtract(t,e,Ew),c=si.normalize(c,c),r||(c=si.negate(c,c)),o=Uw(a.scaleToGeodeticSurface(t,Sw),c,s,o,a,u,1,f);else c=si.subtract(t,e,Ew),c=si.normalize(c,c),r||(c=si.negate(c,c)),o=Uw(a.scaleToGeodeticSurface(t,Sw),c,s,o,a,u,1,1),i=si.clone(i,qw),c=si.subtract(i,e,Ew),c=si.normalize(c,c),r||(c=si.negate(c,c)),o=Uw(a.scaleToGeodeticSurface(i,Sw),c,s,o,a,u,1,1);return o}bw.removeDuplicatesFromShape=function(e){for(var t=e.length,i=[],n=t-1,r=0;r<t;n=r++){var a=e[n],o=e[r];ha.equals(a,o)||i.push(o)}return i},bw.angleIsGreaterThanPi=function(e,t,i,n){var r=new KT(i,n),a=r.projectPointOntoPlane(si.add(i,e,Dw),Dw),o=r.projectPointOntoPlane(si.add(i,t,Pw),Pw);return 0<=o.x*a.y-o.y*a.x};var Xw=new si,Kw=new si;function Zw(e){var t=(e=z(e,z.EMPTY_OBJECT)).polylinePositions,i=e.shapePositions;this._positions=t,this._shape=i,this._ellipsoid=gr.clone(z(e.ellipsoid,gr.WGS84)),this._cornerType=z(e.cornerType,Yg.ROUNDED),this._vertexFormat=lw.clone(z(e.vertexFormat,lw.DEFAULT)),this._granularity=z(e.granularity,Cesium.Math.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry",this.isOffset=z(e.isOffset,!1),this.isMultiImage=z(e.isMultiImage,!1);var n=1+t.length*si.packedLength;n+=1+i.length*Cesium.Cartesian2.packedLength,this.packedLength=n+gr.packedLength+lw.packedLength+2+1+1}bw.computePositions=function(e,t,i,n,r){var a=n._ellipsoid,o=function(e,t){for(var i=new Array(e.length),n=0;n<e.length;n++){var r=e[n];Mw=t.cartesianToCartographic(r,Mw),i[n]=Mw.height,e[n]=t.scaleToGeodeticSurface(r,r)}return i}(e,a),s=n._granularity,u=n._cornerType,l=(r?function(e){var t=e.length,i=new Array(6*t),n=0,r=e[0];i[n++]=+r.x,i[n++]=0,i[n++]=+r.y;for(var a=1;a<t;a++){var o=+(r=e[a]).x,s=+r.y;i[n++]=o,i[n++]=0,i[n++]=s,i[n++]=o,i[n++]=0,i[n++]=s}return r=e[0],i[n++]=+r.x,i[n++]=0,i[n++]=+r.y,i}:Hw)(t),c=r?Hw(t):void 0,m=i.height/2,d=i.width/2,h=e.length,f=[],p=r?[]:void 0,_=_w,C=Cw,g=gw,v=vw,y=yw,T=Tw,x=xw,w=ww,A=Aw,E=e[0],S=e[1],v=a.geodeticSurfaceNormal(E,v);_=si.subtract(S,E,_),_=si.normalize(_,_),w=si.cross(v,_,w),w=si.normalize(w,w);var b,M=o[0],R=o[1];r&&(p=Uw(E,w,c,p,a,M+m,1,1)),A=si.clone(E,A),E=S,C=si.negate(_,C);for(var D=1;D<h-1;D++){var P=r?2:1,S=e[D+1],_=si.subtract(S,E,_);_=si.normalize(_,_),g=si.add(_,C,g),g=si.normalize(g,g),v=a.geodeticSurfaceNormal(E,v);var I=si.multiplyByScalar(v,si.dot(_,v),Xw);si.subtract(_,I,I),si.normalize(I,I);var O,L,N=si.multiplyByScalar(v,si.dot(C,v),Kw);si.subtract(C,N,N),si.normalize(N,N),!ri.equalsEpsilon(Math.abs(si.dot(I,N)),1,ri.EPSILON7)?(g=si.cross(g,v,g),g=si.cross(v,g,g),g=si.normalize(g,g),O=1/Math.max(.25,si.magnitude(si.cross(g,C,Ew))),(L=bw.angleIsGreaterThanPi(_,C,E,a))?(y=si.add(E,si.multiplyByScalar(g,O*d,g),y),T=si.add(y,si.multiplyByScalar(w,d,T),T),pw[0]=si.clone(A,pw[0]),pw[1]=si.clone(T,pw[1]),b=Rw(pw,M+m,R+m,s),f=kw(ax.generateArc({positions:pw,granularity:s,ellipsoid:a}),w,l,f,a,b,1),w=si.cross(v,_,w),w=si.normalize(w,w),x=si.add(y,si.multiplyByScalar(w,d,x),x),u===Yg.ROUNDED||u===Yg.BEVELED?Yw(y,T,x,u,L,a,f,l,R+m,r):f=Uw(E,g=si.negate(g,g),l,f,a,R+m,O,P)):(y=si.add(E,si.multiplyByScalar(g,O*d,g),y),T=si.add(y,si.multiplyByScalar(w,-d,T),T),pw[0]=si.clone(A,pw[0]),pw[1]=si.clone(T,pw[1]),b=Rw(pw,M+m,R+m,s),f=kw(ax.generateArc({positions:pw,granularity:s,ellipsoid:a}),w,l,f,a,b,1),w=si.cross(v,_,w),w=si.normalize(w,w),x=si.add(y,si.multiplyByScalar(w,-d,x),x),u===Yg.ROUNDED||u===Yg.BEVELED?Yw(y,T,x,u,L,a,f,l,R+m,r):f=Uw(E,g,l,f,a,R+m,O,P)),A=si.clone(x,A),C=si.negate(_,C)):(f=Uw(A,w,l,f,a,M+m,1,1),A=E),M=R,R=o[D+1],E=S}pw[0]=si.clone(A,pw[0]),pw[1]=si.clone(E,pw[1]),b=Rw(pw,M+m,R+m,s),f=kw(ax.generateArc({positions:pw,granularity:s,ellipsoid:a}),w,l,f,a,b,1),r&&(p=Uw(E,w,c,p,a,R+m,1,1)),h=f.length;var B=r?h+p.length:h,z=new Float64Array(B);return z.set(f),r&&z.set(p,h),z},Zw.pack=function(e,t,i){var n;i=z(i,0);var r=e._positions,a=r.length;for(t[i++]=a,n=0;n<a;++n,i+=si.packedLength)si.pack(r[n],t,i);var o=e._shape,a=o.length;for(t[i++]=a,n=0;n<a;++n,i+=Cesium.Cartesian2.packedLength)Cesium.Cartesian2.pack(o[n],t,i);return gr.pack(e._ellipsoid,t,i),i+=gr.packedLength,lw.pack(e._vertexFormat,t,i),i+=lw.packedLength,t[i++]=e._cornerType,t[i++]=e._granularity,t[i++]=e.isOffset?1:0,t[i]=e.isMultiImage?1:0,t};var Jw=gr.clone(gr.UNIT_SPHERE),Qw=new lw,$w={polylinePositions:void 0,shapePositions:void 0,ellipsoid:Jw,vertexFormat:Qw,cornerType:void 0,granularity:void 0,isOffset:void 0,isMultiImage:void 0};function eA(e,t,i){var n=(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT)).viewer;if(!Cesium.defined(n))throw new Cesium.DeveloperError("options.viewer  undefined!");var r=e.ev_DrawHelper;if(!Cesium.defined(r))throw new Cesium.DeveloperError("options.ev_DrawHelper  undefined!");this.ellipsoid=Cesium.defaultValue(e.ellipsoid,Cesium.GeometryInstance.WGS84),this.textureRotationAngle=Cesium.defaultValue(e.textureRotationAngle,0),this.asynchronous=Cesium.defaultValue(e.asynchronous,!1),this.show=Cesium.defaultValue(e.show,!0),this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this.color=Cesium.defaultValue(e.color,"rgba(253, 128, 69, 0.6)"),this.appearance=Cesium.defaultValue(e.appearance,new Cesium.PerInstanceColorAppearance({translucent:!0})),this.rotation=Cesium.defaultValue(e.rotation,0),this.libraryID=t,this.symbolID=i,this.id=e.id,this._ellipsoid=void 0,this._granularity=void 0,this._textureRotationAngle=void 0,this._createPrimitive=!1,this._primitive=void 0,this._outlinePolygon=void 0,this._appendPrimitive=void 0,this._changeState=void 0;var a=r.ev_milStdDefaultLineConfig;this._wallColor=a.wallColor;this.wallColorA=this.wallColor.match(/(\d{1,3})+(?:\.\d+)?/g)[3],this._mainLineColor=a.mainLineColor,this._mainLineWidth=a.mainLineWidth,this._mainLineHeight=a.mainLineHeight,this._isShowAuxiliaryLine=a.isShowAuxiliaryLine,this._up=a.height,this._down=a.down,this._auxiliaryLineWidth=a.auxiliaryLineWidth,this._auxiliaryLineColor=a.auxiliaryLineColor,this._isFill=a.isFill,this._fillColor=a.fillColor,this._wallTransparent=a.wallTransparent,this._threeMapType=a.threeMapType,this._distanceLegend=a.distanceLegend,this._positions=e.positions,this._varyAlpha=1,this._editMode=!1;var o=0,s=0;Cesium.defined(e.positions[0]._Z)?e.positions.forEach(function(e){e._Z>o?o=+(+e._Z).toFixed(0):s=+(+e._Z).toFixed(0)}):e.positions.forEach(function(e,t){var i=Cesium.Cartographic.fromCartesian(e).height.toFixed(0);o<i?o=+i:s=+i}),this.down=(o-s)/1e3,this.basicBtnHei=o/1e3,this.topLineHeight=this.basicBtnHei+this.up,this.bottomLineHeight=this.basicBtnHei-this.down}function tA(e){return 1==Cesium.Color.fromCssColorString(e).alpha}function iA(e){return new Uint8Array([255*e.red,255*e.green,255*e.blue,Math.round(255*e.alpha)])}function nA(e,t,i,n){var r=(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT)).viewer;if(this.name=e.name,this.evPlottingService=e.evPlottingService,!Cesium.defined(r))throw new DeveloperError("options.viewer  undefined!");var a=e.ev_DrawHelper;if(this.startEdited=a.startEdited,!Cesium.defined(a))throw new DeveloperError("options.ev_DrawHelper  undefined!");this.libraryID=i,this.symbolID=n,this.url=e.url,this.id=e.id,this.attri=t,this.appearance=new Cesium.PerInstanceColorAppearance({translucent:!1});var o=a.ev_milStdDefaultPointConfig;this._mainLineColor=o.mainLineColor,this._mainLineWidth=o.mainLineWidth,this._mainLineHeight=o.mainLineHeight,this._isShowAuxiliaryLine=o.isShowAuxiliaryLine,this._floatHeight3D=o.height,this._auxiliaryLineWidth=o.auxiliaryLineWidth,this._auxiliaryLineColor=o.auxiliaryLineColor,this._isFill=o.isFill,this._fillColor=o.fillColor,this._scale=o.scale,this._rotation=o.rotation,this._drawMode=o.drawMode,this._scaleMode=o.scaleMode,this._text=e.text||o.text,this._font=o.font,this._fontPlace=o.fontPlace,this._fontScale=o.fontScale,this._fontColor=o.fontColor,this._inText=o.inText,this._inFontColor=o.inFontColor,this._inFontScale=o.inFontScale,this._inFont=o.inFont,this._distanceLegend=o.distanceLegend,this._horizontal=o.horizontal,this._vertical=o.vertical,this._dragLineVisble=o.dragLineVisble,this._zzfw=o.zzfw,this._XVertexindex=o.XVertexindex,this._XattributeRelation=o.XattributeRelation,this.viewPosition=new Cesium.Cartesian3(0,0,0),this.fixedScale=1,this._fixedScale=1,this.modelMatrix=Cesium.Matrix4.IDENTITY.clone(),this._position=void 0,this._actionRotation=0,this._varyScale=1,this._varyRotation=0,this._varyPosition=void 0,this._varyAlpha=1,this.ellipsoid=Cesium.defaultValue(e.ellipsoid,Cesium.Ellipsoid.WGS84),this.textureRotationAngle=Cesium.defaultValue(e.textureRotationAngle,0),this.asynchronous=Cesium.defaultValue(e.asynchronous,!1),this.show=Cesium.defaultValue(e.show,!0),this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this.color=Cesium.defaultValue(e.color,"rgba(253, 128, 69, 0.6)"),this._ellipsoid=void 0,this._granularity=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!1,this._primitive=void 0,this._outlinePolygon=void 0,this._appendPrimitive=void 0,this._positions=void 0,this._geometryPos=void 0,this._changeState=void 0,this._basicPosition={x:void 0,y:void 0},this._Visible=this.show}function rA(e,t,i,n){return new Cesium.Geometry({attributes:new Cesium.GeometryAttributes({position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e}),color:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:n,normalize:!0}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:i})}),indices:t,primitiveType:4,boundingSphere:Cesium.BoundingSphere.fromVertices(e)})}function aA(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.viewer=e.viewer,!Cesium.defined(this.viewer))throw new Cesium.DeveloperError("options.viewer is undefined");if(this.evPlottingService=e.evPlottingService,!Cesium.defined(this.evPlottingService))throw new Cesium.DeveloperError("options.evPlottingService  undefined!");if(this.scene=this.viewer.scene,!Cesium.defined(this.viewer.scene))throw new Cesium.DeveloperError("请传入绘制场景");function t(e,t){if(!a._handlersMuted)for(var i=r.drillPick(t),n=0;n<i.length;n++)i[n]&&i[n].primitive&&i[n].primitive[e]&&i[n].primitive[e](t)}var i,r,a,n;this.ev_milStdLayerManager=new Gg({viewer:this.viewer}),this.ev_milStdDefaultPointConfig={},this.ev_milStdDefaultLineConfig={},this._editedPrimitive=void 0,r=(i=this).scene,a=i,(n=new Cesium.ScreenSpaceEventHandler(r.canvas)).setInputAction(function(e){t("leftClick",e.position)},Cesium.ScreenSpaceEventType.LEFT_CLICK),n.setInputAction(function(e){t("leftDown",e.position)},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.enhancePrimitives()}function oA(e,t,i){e[t]=i}function sA(e){var t,i;switch(e){case 1:t=360,i=1;break;case 2:t=0,i=1;break;case 3:t=90,i=1;break;case 4:t=360,i=1;break;case 5:t=0,i=1;break;case 6:t=90,i=1;break;case 7:t=360,i=0;break;case 8:i=t=0;break;case 9:t=360,i=0;break;case 10:t=90,i=1;break;default:throw new Cesium.DeveloperError("朝向类型有问题")}return[t,i]}Zw.unpack=function(e,t,i){t=z(t,0);for(var n=e[t++],r=new Array(n),a=0;a<n;++a,t+=si.packedLength)r[a]=si.unpack(e,t);n=e[t++];var o=new Array(n);for(a=0;a<n;++a,t+=Cesium.Cartesian2.packedLength)o[a]=Cesium.Cartesian2.unpack(e,t);var s=gr.unpack(e,t,Jw),u=lw.unpack(e,t+=gr.packedLength,Qw);t+=lw.packedLength;var l=e[t++],c=e[t],m=e[++t],d=e[++t];return Cesium.defined(i)?(i._positions=r,i._shape=o,i._ellipsoid=gr.clone(s,i._ellipsoid),i._vertexFormat=lw.clone(u,i._vertexFormat),i._cornerType=l,i._granularity=c,i.isOffset=m,i.isMultiImage=d,i):($w.polylinePositions=r,$w.shapePositions=o,$w.cornerType=l,$w.granularity=c,$w.isOffset=m,$w.isMultiImage=d,new cw($w))},Zw.createGeometry=function(e){var t=qT(e._positions,si.equalsEpsilon),i=e._shape,i=bw.removeDuplicatesFromShape(i);if(!(t.length<2||i.length<3)){Mv.computeWindingOrder2D(i)===th.CLOCKWISE&&i.reverse();var n=Zd.fromPoints(i,new Zd);return function(e,t,i,n){var r=new Uv;n.position&&(r.position=new Ev({componentDatatype:Ud.DOUBLE,componentsPerAttribute:3,values:e}));var a,o,s,u,l,c=t.length,m=e.length/3,d=(m-2*c)/(2*c),h=Mv.triangulate(t),f=(d-1)*c*6+2*h.length,p=kd.createTypedArray(m,f),_=2*c,C=0;for(E=0;E<d-1;E++){for(a=0;a<c-1;a++)l=(o=2*a+E*c*2)+_,u=(s=o+1)+_,p[C++]=s,p[C++]=o,p[C++]=u,p[C++]=u,p[C++]=o,p[C++]=l;u=(s=(o=2*c-2+E*c*2)+1)+_,l=o+_,p[C++]=s,p[C++]=o,p[C++]=u,p[C++]=u,p[C++]=o,p[C++]=l}if(n.st||n.tangent||n.bitangent){for(var g,v,y=new Float32Array(2*m),T=1/(d-1),x=1/i.height,w=i.height/2,A=0,E=0;E<d;E++){for(g=E*T,v=x*(t[0].y+w),y[A++]=g,y[A++]=v,a=1;a<c;a++)v=x*(t[a].y+w),y[A++]=g,y[A++]=v,y[A++]=g,y[A++]=v;v=x*(t[0].y+w),y[A++]=g,y[A++]=v}for(a=0;a<c;a++)g=0,v=x*(t[a].y+w),y[A++]=g,y[A++]=v;for(a=0;a<c;a++)g=(d-1)*T,v=x*(t[a].y+w),y[A++]=g,y[A++]=v;r.st=new Ev({componentDatatype:Ud.FLOAT,componentsPerAttribute:2,values:new Float32Array(y)})}var S=m-2*c;for(E=0;E<h.length;E+=3){var b=h[E]+S,M=h[E+1]+S,R=h[E+2]+S;p[C++]=b,p[C++]=M,p[C++]=R,p[C++]=R+c,p[C++]=M+c,p[C++]=b+c}var D=new rp({attributes:r,indices:p,boundingSphere:Rr.fromVertices(e),primitiveType:Yd.TRIANGLES});if(n.normal&&(D=My.computeNormal(D)),n.tangent||n.bitangent){try{D=My.computeTangentAndBitangent(D)}catch(e){lc("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}n.tangent||(D.attributes.tangent=void 0),n.bitangent||(D.attributes.bitangent=void 0),n.st||(D.attributes.st=void 0)}return D}(bw.computePositions(t,i,n,e,!0),i,n,e._vertexFormat)}},Object.defineProperties(eA.prototype,{mainLineColor:{get:function(){return this._mainLineColor},set:function(e){this.mainLineColor!==e&&(this._mainLineColor=e,this.wallColor=e,this._createPrimitive=!0,this.mainLineColors=void 0)}},mainLineWidth:{get:function(){return this._mainLineWidth},set:function(e){this.mainLineWidth!==e&&(this._mainLineWidth=e,this._createPrimitive=!0)}},mainLineHeight:{get:function(){return this._mainLineHeight},set:function(e){this.mainLineHeight!==e&&(this._mainLineHeight=e,this._createPrimitive=!0)}},isShowAuxiliaryLine:{get:function(){return this._isShowAuxiliaryLine},set:function(e){this.isShowAuxiliaryLine!==e&&(this._isShowAuxiliaryLine=e,this._createPrimitive=!0)}},lowPosition:{get:function(){return this._lowPosition},set:function(e){this._lowPosition=e,this._createPrimitive=!0}},up:{get:function(){return this._up},set:function(e){this.up!==e&&(this._up=e,this.topLineHeight=this.basicBtnHei+ +e,this._createPrimitive=!0)}},down:{get:function(){return this._down},set:function(e){this.down!==e&&(this._down=+e,this.bottomLineHeight=this.basicBtnHei-this._down,this._createPrimitive=!0)}},auxiliaryLineWidth:{get:function(){return this._auxiliaryLineWidth},set:function(e){this.auxiliaryLineWidth!==e&&(this._auxiliaryLineWidth=e,this._createPrimitive=!0)}},auxiliaryLineColor:{get:function(){return this._auxiliaryLineColor},set:function(e){this.auxiliaryLineColor!==e&&(this._auxiliaryLineColor=e,this._createPrimitive=!0)}},isFill:{get:function(){return this._isFill},set:function(e){this.isFill!==e&&(this._isFill=e,this._createPrimitive=!0)}},fillColor:{get:function(){return this._fillColor},set:function(e){this.fillColor!==e&&(this._fillColor=e,this._createPrimitive=!0,this.fillColors=void 0)}},wallColor:{get:function(){return this._wallColor},set:function(e){var t=/(\d{1,3})+(?:\.\d+)?/g,i=this.wallColor.match(t),n=i[0]+i[1]+i[2],r=e.match(t);n!==r[0]+r[1]+r[2]&&(this._wallColor="rgba("+r[0]+","+r[1]+","+r[2]+","+i[3]+")",this._createPrimitive=!0,this._wallColors=void 0)}},wallTransparent:{get:function(){return this._wallTransparent},set:function(e){var t;this.wallTransparent!==+e&&(this._wallTransparent=+e,(t=this.wallColor.match(/(\d{1,3})+(?:\.\d+)?/g))[3]=this.wallColorA*e/100,this._wallColor="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")",this._createPrimitive=!0)}},threeMapType:{get:function(){return this._threeMapType},set:function(e){this.threeMapType!==e&&(this._threeMapType=e,this._createPrimitive=!0)}},distanceLegend:{get:function(){return this._distanceLegend},set:function(e){this.distanceLegend!==e&&(this._distanceLegend=e,this._createPrimitive=!0)}},varyAlpha:{get:function(){return this._varyAlpha},set:function(e){var t,i;if(this._varyAlpha=e,this._primitive.appearance.translucent=1!==e,this.mainLineColors)for(var n=0;n<this.mainLinePositions.length;++n)1===(t=Cesium.Color.fromCssColorString(this.mainLineColors[n])).alpha?(t.alpha=t.alpha*e,this._primitive.getGeometryInstanceAttributes("mainLine"+n).color=iA(t)):(t.alpha=t.alpha*e,this._framePrimitive.getGeometryInstanceAttributes("mainLine"+n).color=iA(t));else if(1===(t=Cesium.Color.fromCssColorString(this.mainLineColor)).alpha){t.alpha=t.alpha*e,i=iA(t);for(n=0;n<this.mainLinePositions.length;++n)this._primitive.getGeometryInstanceAttributes("mainLine"+n).color=i}else{t.alpha=t.alpha*e,i=iA(t);for(n=0;n<this.mainLinePositions.length;++n)this._framePrimitive.getGeometryInstanceAttributes("mainLine"+n).color=i}if(this.wallColors)for(n=0;n<this.mainLinePositions.length;++n)1===(t=Cesium.Color.fromCssColorString(this.wallColors[n])).alpha?(t.alpha=t.alpha*e,this._primitive.getGeometryInstanceAttributes("wall"+n).color=iA(t)):(t.alpha=t.alpha*e,this._framePrimitive.getGeometryInstanceAttributes("wall"+n).color=iA(t));else if(1===(t=Cesium.Color.fromCssColorString(this.wallColor)).alpha){t.alpha=t.alpha*e,i=iA(t);for(n=0;n<this.mainLinePositions.length;++n)this._primitive.getGeometryInstanceAttributes("wall"+n).color=i}else{t.alpha=t.alpha*e,i=iA(t);for(n=0;n<this.mainLinePositions.length;++n)this._framePrimitive.getGeometryInstanceAttributes("wall"+n).color=i}if(this.isShowAuxiliaryLine)if((t=Cesium.Color.fromCssColorString(this.auxiliaryLineColor)).alpha=t.alpha*e,i=iA(t),1===t.alpha)for(n=0;n<this.mainLinePositions.length;++n)this._primitive.getGeometryInstanceAttributes("auxiliaryLine"+n).color=i;else for(n=0;n<this.mainLinePositions.length;++n)this._framePrimitive.getGeometryInstanceAttributes("auxiliaryLine"+n).color=i;this.isFill&&(1===(t=Cesium.defined(this.fillColors)?Cesium.Color.fromCssColorString(this.fillColors[0]):Cesium.Color.fromCssColorString(this.fillColor)).alpha?(t.alpha=t.alpha*e,this._primitive.getGeometryInstanceAttributes("fill").color=iA(t)):(t.alpha=t.alpha*e,this._framePrimitive.getGeometryInstanceAttributes("fill").color=iA(t)))}}}),eA.prototype.getType=function(){return"EV_LineMilStd"},eA.prototype.update=function(e){if(this.show&&(this._createPrimitive||Cesium.defined(this._primitive))){if(this._createPrimitive||Cesium.defined(this.drawMode)&&360===this.drawMode||Cesium.defined(this.scaleMode)&&"0"===this.scaleMode){var t=this.getGeometryInstances();if(!t)return;this._createPrimitive=!1,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new Cesium.Primitive({geometryInstances:t,appearance:this.appearance,asynchronous:this.asynchronous})}this._primitive.update(e)}},eA.prototype.isDestroyed=function(){return!1},eA.prototype.destroy=function(){return this.setEditMode&&this.setEditMode(!1),this.labels=this.labels&&this._primitives.remove(this.labels),this.billboards=this.billboards&&this._primitives.remove(this.billboards),this._primitive=this._primitive&&this._primitives.remove(this._primitive),this._framePrimitive=this._framePrimitive&&this._primitives.remove(this._framePrimitive),this._primitives=this._primitives&&this._primitives.remove(this),Cesium.destroyObject(this)},eA.prototype.createGeometryInstance=function(e,t,i){return new Cesium.GeometryInstance({geometry:e,id:i,pickPrimitive:this,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString(t))}})},eA.prototype.getMainLineShape=function(){return Cesium.Cartesian2.unpackArray([-this.distanceLegend*this.mainLineWidth,this.distanceLegend*(this.topLineHeight-this.mainLineHeight),this.distanceLegend*this.mainLineWidth,this.distanceLegend*(this.topLineHeight-this.mainLineHeight),this.distanceLegend*this.mainLineWidth,this.distanceLegend*this.topLineHeight,-this.distanceLegend*this.mainLineWidth,this.distanceLegend*this.topLineHeight])},eA.prototype.getAuxiliaryLineShape=function(){return Cesium.Cartesian2.unpackArray([-this.distanceLegend*(this.mainLineWidth+this.auxiliaryLineWidth),this.distanceLegend*(this.topLineHeight-.95*this.mainLineHeight),this.distanceLegend*(this.mainLineWidth+this.auxiliaryLineWidth),this.distanceLegend*(this.topLineHeight-.95*this.mainLineHeight),this.distanceLegend*(this.mainLineWidth+this.auxiliaryLineWidth),this.distanceLegend*(this.topLineHeight-.02*this.mainLineHeight),-this.distanceLegend*(this.mainLineWidth+this.auxiliaryLineWidth),this.distanceLegend*(this.topLineHeight-.02*this.mainLineHeight)])},eA.prototype.getGeometryInstances=function(){if(Cesium.defined(this.mainLinePositions)){for(var e=[],t=void 0,i=0;i<this.mainLinePositions.length;++i){var n=Cesium.Cartesian3.unpackArray(this.mainLinePositions[i].toString().replace(/(\(|\))/g,"").split(",").map(function(e){return Number(e)}));!Cesium.defined(this.mainLineColors)&&tA(this.mainLineColor)?(t=new Zw({polylinePositions:n,shapePositions:this.getMainLineShape(),vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid,cornerType:Cesium.CornerType.MITERED}),e[e.length]=this.createGeometryInstance(t,this.mainLineColor,"mainLine"+i)):Cesium.defined(this.mainLineColors)&&tA(this.mainLineColors[i])&&(t=new Zw({polylinePositions:n,shapePositions:this.getMainLineShape(),vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid,cornerType:Cesium.CornerType.MITERED}),e[e.length]=this.createGeometryInstance(t,this.mainLineColors[i],"mainLine"+i)),this.isShowAuxiliaryLine&&tA(this.auxiliaryLineColor)&&(t=new Zw({polylinePositions:Cesium.Cartesian3.unpackArray(this.mainLinePositions[i].toString().replace(/(\(|\))/g,"").split(",").map(function(e){return Number(e)})),shapePositions:this.getAuxiliaryLineShape(),vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,cornerType:Cesium.CornerType.MITERED,ellipsoid:this.ellipsoid}),e[e.length]=this.createGeometryInstance(t,this.auxiliaryLineColor,"auxiliaryLine"+i)),Cesium.defined(this.wallColors)&&!Cesium.defined(this.wallColors)||(t=Cesium.WallGeometry.fromConstantHeights({positions:this.wallPositions[i],minimumHeight:this.distanceLegend*this.bottomLineHeight,maximumHeight:this.distanceLegend*this.topLineHeight,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL}),e[e.length]=this.createGeometryInstance(t,this.wallColor,"wall"+i))}if(this.isFill)if(Cesium.defined(this.fillColors))for(i=0;i<this.fillPositions.length;++i)t=Cesium.PolygonGeometry.fromPositions({positions:this.fillPositions[i],height:this.distanceLegend*this.topLineHeight,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[e.length]=this.createGeometryInstance(t,this.fillColor,"fill");else Cesium.defined(this.fillColors)||(t=Cesium.PolygonGeometry.fromPositions({positions:this.fillPositions[0],height:this.distanceLegend*this.topLineHeight,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[e.length]=this.createGeometryInstance(t,this.fillColor,"fill"));return t=void 0,e}},eA.prototype.getFramePrimitive=function(){if(Cesium.defined(this.mainLinePositions)){for(var e=[],t=null,i=0;i<this.mainLinePositions.length;++i){var n=Cesium.Cartesian3.unpackArray(this.mainLinePositions[i].toString().replace(/(\(|\))/g,"").split(",").map(function(e){return Number(e)}));Cesium.defined(this.mainLineColors)||tA(this.mainLineColor)?Cesium.defined(this.mainLineColors)&&!tA(this.mainLineColors[i])&&(t=new Zw({polylinePositions:n,shapePositions:this.getMainLineShape(),vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid,cornerType:Cesium.CornerType.MITERED}),e[e.length]=this.createGeometryInstance(t,this.mainLineColors[i],"mainLine"+i)):(t=new Zw({polylinePositions:n,shapePositions:this.getMainLineShape(),vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid,cornerType:Cesium.CornerType.MITERED}),e[e.length]=this.createGeometryInstance(t,this.mainLineColor,"mainLine"+i)),this.isShowAuxiliaryLine&&!tA(this.auxiliaryLineColor)&&(t=new Zw({polylinePositions:Cesium.Cartesian3.unpackArray(this.mainLinePositions[i].toString().replace(/(\(|\))/g,"").split(",").map(function(e){return Number(e)})),shapePositions:this.getAuxiliaryLineShape(),vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,cornerType:Cesium.CornerType.MITERED,ellipsoid:this.ellipsoid}),e[e.length]=this.createGeometryInstance(t,this.auxiliaryLineColor,"auxiliaryLine"+i)),Cesium.defined(this.wallColors)||tA(this.wallColor)?Cesium.defined(this.wallColors)&&!tA(this.wallColors[i])&&(t=Cesium.WallGeometry.fromConstantHeights({positions:this.wallPositions[i],minimumHeight:0,maximumHeight:this.distanceLegend*this.up,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL}),e[e.length]=this.createGeometryInstance(t,this.wallColors[i],"wall"+i)):(t=Cesium.WallGeometry.fromConstantHeights({positions:this.wallPositions[i],minimumHeight:0,maximumHeight:this.distanceLegend*this.up,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL}),e[e.length]=this.createGeometryInstance(t,this.wallColor,"wall"+i))}if(this.isFill)if(Cesium.defined(this.fillColors)&&!tA(this.fillColors[0]))for(i=0;i<this.fillPositions.length;++i)t=Cesium.PolygonGeometry.fromPositions({positions:this.fillPositions[i],height:this.distanceLegend*topLineHeight,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[i]=this.createGeometryInstance(t,this.fillColors[i],"fill");else Cesium.defined(this.fillColors)||tA(this.fillColor)||!this.fillPositions[0]||(t=Cesium.PolygonGeometry.fromPositions({positions:this.fillPositions[0],height:this.distanceLegend*topLineHeight,vertexFormat:Cesium.VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[e.length]=this.createGeometryInstance(t,this.fillColor,"fill"));return t=null,e}},eA.prototype.setEditMode=function(e,t){if(this._editMode!=e)if(e){t.startEdited(this),this.auxiliaryPrimitive=new Vg({evPlottingService:t.evPlottingService},this.libraryID,this.symbolID),this.auxiliaryPrimitive.positions=this.positions,this.auxiliaryPrimitive.url=this.url,this.auxiliaryPrimitive.mainLinePositions=this.mainLinePositions,this.auxiliaryPrimitive.mainLineColor=this.mainLineColor,this.auxiliaryPrimitive.mainLineColors=this.mainLineColors,this.auxiliaryPrimitive.wallPositions=this.wallPositions,this.auxiliaryPrimitive.wallColor=this.wallColor,this.auxiliaryPrimitive.wallColors=this.wallColors,this.auxiliaryPrimitive.isFill=this.isFill,this.auxiliaryPrimitive.fillPositions=this.fillPositions,this.auxiliaryPrimitive.fillColor=this.fillColor,this.auxiliaryPrimitive.fillColors=this.fillColors,this.auxiliaryPrimitive._primitives=this._primitives,this.auxiliaryPrimitive._changeState=!0,this.auxiliaryPrimitive.show=!1,this._primitives.add(this.auxiliaryPrimitive);var i=viewer.scene,n=this;for(var r in this.allAttr={name:"",mainLineColor:"",fillColor:"",isFill:"",up:"",down:"",mainLineHeight:"",wallTransparent:""},this.allAttr)Cesium.defined(n[r])?this.allAttr[r]=n[r]:delete this.allAttr[r];this.allAttr.isPoint=!1;var a,o;new Proxy(this.allAttr,{set:function(e,t,i){return e[t]=i,n.setAttribute(t,i),!0}});null==n._markers&&(o={dragHandlers:{onDrag:function(e,t){n.positions[e]=t,n.show=!1,n.auxiliaryPrimitive.positions=n.positions,n.auxiliaryPrimitive.getDrawPositions(),n.auxiliaryPrimitive.show=!0},onDragEnd:function(e,t){n.auxiliaryPrimitive.show=!1,n.mainLinePositions=n.auxiliaryPrimitive.mainLinePositions,n.wallPositions=n.auxiliaryPrimitive.wallPositions,n.fillPositions=n.auxiliaryPrimitive.fillPositions,n._createPrimitive=!0,n.show=!0,n.executeListeners({name:"onEdited",positions:n.positions})}}},(a=new Bg(i,void 0,n._primitives)).addBillboards(n.positions,o),this._markers=a,this._globeClickhandler=new Cesium.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(e){var t=i.pick(e.position);t&&t.primitive||n.setEditMode(!1)},Cesium.ScreenSpaceEventType.LEFT_CLICK),a.setOnTop()),this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this.auxiliaryPrimitive.destroy(),this.auxiliaryPrimitive=null,this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},Object.defineProperties(nA.prototype,{positions:{get:function(){return this._positions},set:function(e){this._positions=e,this._createPrimitive=!0}},changeState:{get:function(){return this._changeState},set:function(e){this._changeState=e,this._createPrimitive=!0}},varyAlpha:{get:function(){return this._varyAlpha},set:function(e){if(this.show=!0,this._primitive.appearance.translucent=1!==e,this.mainLineColors)for(var t=0;t<this.mainLinePositions.length;++t)color=as.fromCssColorString(this.mainLineColors[t]),1===color.alpha?(color.alpha=color.alpha*e,this._primitive.getGeometryInstanceAttributes("mainLine"+t).color=ColorToUint8(color)):(color.alpha=color.alpha*e,this._framePrimitive.getGeometryInstanceAttributes("mainLine"+t).color=ColorToUint8(color));else if(color=as.fromCssColorString(this.mainLineColor),1===color.alpha){color.alpha=color.alpha*e,uint8Color=ColorToUint8(color);for(t=0;t<this.mainLinePositions.length;++t)this._primitive.getGeometryInstanceAttributes("mainLine"+t).color=uint8Color}else{color.alpha=color.alpha*e,uint8Color=ColorToUint8(color);for(t=0;t<this.mainLinePositions.length;++t)this._framePrimitive.getGeometryInstanceAttributes("mainLine"+t).color=uint8Color}if(this.wallColors)for(t=0;t<this.mainLinePositions.length;++t)color=as.fromCssColorString(this.wallColors[t]),1===color.alpha?(color.alpha=color.alpha*e,this._primitive.getGeometryInstanceAttributes("wall"+t).color=ColorToUint8(color)):(color.alpha=color.alpha*e,this._framePrimitive.getGeometryInstanceAttributes("wall"+t).color=ColorToUint8(color));else if(color=as.fromCssColorString(this.wallColor),1===color.alpha){color.alpha=color.alpha*e,uint8Color=ColorToUint8(color);for(t=0;t<this.mainLinePositions.length;++t)this._primitive.getGeometryInstanceAttributes("wall"+t).color=uint8Color}else{color.alpha=color.alpha*e,uint8Color=ColorToUint8(color);for(t=0;t<this.mainLinePositions.length;++t)this._framePrimitive.getGeometryInstanceAttributes("wall"+t).color=uint8Color}if(this.isShowAuxiliaryLine)if(color=as.fromCssColorString(this.auxiliaryLineColor),color.alpha=color.alpha*e,uint8Color=ColorToUint8(color),1===color.alpha)for(t=0;t<this.mainLinePositions.length;++t)this._primitive.getGeometryInstanceAttributes("auxiliaryLine"+t).color=uint8Color;else for(t=0;t<this.mainLinePositions.length;++t)this._framePrimitive.getGeometryInstanceAttributes("auxiliaryLine"+t).color=uint8Color;this.isFill&&(color=Cesium.defined(this.fillColors)?as.fromCssColorString(this.fillColors[0]):as.fromCssColorString(this.fillColor),1===color.alpha?(color.alpha=color.alpha*e,this._primitive.getGeometryInstanceAttributes("fill").color=ColorToUint8(color)):(color.alpha=color.alpha*e,this._framePrimitive.getGeometryInstanceAttributes("fill").color=ColorToUint8(color)))}},varyRotation:{get:function(){return this._varyRotation},set:function(e){this.show=!0,this._varyRotation=e,this._createPrimitive=!0}},varyPosition:{get:function(){return this._varyPosition},set:function(e){this.show=!0,this._varyPosition=e,this._createPrimitive=!0}},varyScale:{get:function(){return this._varyScale},set:function(e){this.show=!0,this._varyScale=e,this._createPrimitive=!0}},scaleMode:{get:function(){return this._scaleMode},set:function(e){this.scaleMode!==e&&("0"===e&&(this.viewPosition=Cesium.Cartesian3.clone(viewer.camera.position),this._fixedScale=Cesium.Cartesian3.distance(this.viewPosition,this.position)/this.fixedScale),this._createPrimitive=!0)}},mainLineColor:{get:function(){return this._mainLineColor},set:function(i){if(this.mainLineColor!==i){if(!i||-1==i.indexOf("rgba(")||!this.attri.MainData||!this.attri.MainData.MainColor)return;this._mainLineColor=i,this.attri.MainData.MainColor=this.attri.MainData.MainColor.map(function(e,t){return Number(i.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(",")[t%4])}),this._createPrimitive=!0}}},mainLineWidth:{get:function(){return this._mainLineWidth},set:function(e){this.mainLineWidth!==e&&(this._mainLineWidth=e,this._createPrimitive=!0)}},mainLineHeight:{get:function(){return this._mainLineHeight},set:function(e){this.mainLineHeight!==e&&(this._mainLineHeight=e,this._createPrimitive=!0)}},isShowAuxiliaryLine:{get:function(){return this._isShowAuxiliaryLine},set:function(e){this._isShowAuxiliaryLine=e,this._createPrimitive=!0}},auxiliaryLineWidth:{get:function(){return this._auxiliaryLineWidth},set:function(e){this._auxiliaryLineWidth=e,this._createPrimitive=!0}},auxiliaryLineColor:{get:function(){return this._auxiliaryLineColor},set:function(e){this._auxiliaryLineColor=e,this._createPrimitive=!0}},isFill:{get:function(){return this._isFill},set:function(e){this.isFill!==e&&(this._isFill=e,this._createPrimitive=!0)}},fillColor:{get:function(){return this._fillColor},set:function(i){if(this.fillColor!==i){if(!i||-1==i.indexOf("rgba(")||!this.attri.FillData||!this.attri.FillData.FillColor)return;this._fillColor=i,this.attri.FillData.FillColor=this.attri.FillData.FillColor.map(function(e,t){return Number(i.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(",")[t%4])}),this._createPrimitive=!0}}},floatHeight3D:{get:function(){return this._floatHeight3D},set:function(e){this.floatHeight3D!==e&&(this._floatHeight3D=e,this.position=null,this._createPrimitive=!0)}},scale:{get:function(){return this._scale},set:function(e){this.scale!==e&&(this._scale=e,this.position=null,this._createPrimitive=!0)}},rotation:{get:function(){return this._rotation},set:function(e){this.rotation!==e&&(this._rotation=e,this._createPrimitive=!0)}},drawMode:{get:function(){return this._drawMode},set:function(e){this.drawMode!==e&&(this._drawMode=e,this.position=null,Cesium.defined(this._markers)&&Cesium.defined(this._markers.drawMode)&&(this._markers.drawMode=e),this._createPrimitive=!0)}},text:{get:function(){return this._text},set:function(e){this.text!==e&&(this._text=e,this.getAttributeData(e,this.callback))}},font:{get:function(){return this._font},set:function(e){this._font=e,this._createPrimitive=!0}},fontPlace:{get:function(){return this._fontPlace},set:function(e){this._fontPlace=e,this._createPrimitive=!0}},fontScale:{get:function(){return this._fontScale},set:function(e){this._fontScale=e,this._createPrimitive=!0}},fontColor:{get:function(){return this._fontColor},set:function(i){i&&-1!=i.indexOf("rgba(")&&this.attri.MainData&&this.attri.TextData.TextColor&&(this._fontColor=i,this.attri.TextData.TextColor=this.attri.TextData.TextColor.map(function(e,t){return Number(i.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(",")[t%4])}),this._createPrimitive=!0)}},inFontColor:{get:function(){return this._inFontColor},set:function(i){i&&-1!=i.indexOf("rgba(")&&this.attri.MainData&&this.attri.MainData.MainColor&&(this._inFontColor=i,this.attri.MainData.MainColor=this.attri.MainData.MainColor.map(function(e,t){return Number(i.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(",")[t%4])}),this._createPrimitive=!0)}},inFontScale:{get:function(){return this._inFontScale},set:function(e){this._inFontScale=e,this._createPrimitive=!0}},inFont:{get:function(){return this._inFont},set:function(e){this._inFont=e,this._createPrimitive=!0}},position:{get:function(){return this._position},set:function(e){e&&(this._basicPosition=e);var t,i,n,r=Cesium.Cartographic.fromCartesian(this._basicPosition),a=+Cesium.Math.toDegrees(r.longitude).toFixed(3),o=+Cesium.Math.toDegrees(r.latitude).toFixed(3),s=+r.height.toFixed(3);this.geometryPos={lonDegree:a,latDegree:o,height:s},t=0==this.drawMode?1e3*this.floatHeight3D:10*this.attri.distance*this.scale+1e3*this.floatHeight3D,this._position=Cesium.Cartesian3.fromDegrees(a,o,s+t),e||Cesium.defined(this._markers)&&(n={dragHandlers:{onDrag:function(e,t){i.position=t,i.updateModelMatrix()},onDragEnd:function(){i.executeListeners({name:"onEdited",positions:i.position}),i.updateModelMatrix()}}},(i=this)._markers._orderedBillboards[0]._destroy(),this._markers._orderedBillboards.shift(),this._markers.addBillboard(this.position,n)),this._createPrimitive=!0}},distanceLegend:{get:function(){return this._distanceLegend},set:function(e){this._distanceLegend=e,this._createPrimitive=!0}},horizontal:{get:function(){return this._horizontal},set:function(e){this._horizontal=e,this._createPrimitive=!0}},vertical:{get:function(){return this._vertical},set:function(e){this._vertical=e,this._createPrimitive=!0}},dragLineVisble:{get:function(){return this._dragLineVisble},set:function(e){this._dragLineVisble=e,this._createPrimitive=!0}},zzfw:{get:function(){return this._zzfw},set:function(e){this._zzfw=e,this._createPrimitive=!0}},XVertexindex:{get:function(){return this._XVertexindex},set:function(e){this._XVertexindex=e,this._createPrimitive=!0}},XattributeRelation:{get:function(){return this._XattributeRelation},set:function(e){this._XattributeRelation=e,this._createPrimitive=!0}}}),nA.prototype.update=function(e){if(this.show&&(this._createPrimitive||Cesium.defined(this._primitive))){if(this._createPrimitive||Cesium.defined(this.drawMode)&&360===this.drawMode||Cesium.defined(this.scaleMode)&&"0"===this.scaleMode){var t=this.getGeometryInstances();if(!t)return;this._createPrimitive=!1,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new Cesium.Primitive({geometryInstances:t,appearance:this.appearance,asynchronous:this.asynchronous})}this._primitive.update(e)}},nA.prototype.isDestroyed=function(){return!1},nA.prototype.destroy=function(){return this.setEditMode&&this.setEditMode(!1),this.labels=this.labels&&this._primitives.remove(this.labels),this.billboards=this.billboards&&this._primitives.remove(this.billboards),this._primitive=this._primitive&&this._primitives.remove(this._primitive),this._framePrimitive=this._framePrimitive&&this._primitives.remove(this._framePrimitive),this._primitives=this._primitives&&this._primitives.remove(this),Cesium.destroyObject(this)},nA.prototype.getType=function(){return"EV_PointMilStd"},nA.prototype.getAttributeData=function(e,i){var t,n=this;Cesium.defined(this.evPlottingService)&&(t={libraryID:this.libraryID,symbolID:this.symbolID,symbolSpecialInfo:'{"InnerText":"'+e+'","Positions":"0.0,0.0,10.0"}'},this.evPlottingService.getSymbolMeshJson(t,function(e){var t=JSON.parse(e);i(n,t)}))},nA.prototype.checkPrimitive=function(){Cesium.defined(this.attri)&&(Cesium.defined(this.attri.MainData.MainVertex)&&0!==this.attri.MainData.MainVertex.length||Cesium.defined(this.attri.FillData.FillVertex)&&0!==this.attri.FillData.FillVertex.length||Cesium.defined(this.attri.TextData.TextVertex)&&0!==this.attri.TextData.TextVertex.length)||this.destroy()},nA.prototype.updateModelMatrix=function(){var e,t,i,n;this.position&&(e=this._varyPosition||this.position,i=null,Cesium.defined(viewer.camera.heading)&&Cesium.defined(viewer.camera.pitch)||(this.drawMode=0),i=360===this.drawMode?(t=Cesium.Transforms.headingPitchRollToFixedFrame(e,new Cesium.HeadingPitchRoll(viewer.camera.heading,0,viewer.camera.pitch+.5*Math.PI)),Cesium.Matrix4.multiplyByMatrix3(t,Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(this.rotation+this._actionRotation+this._varyRotation),new Cesium.Matrix3),new Cesium.Matrix4)):Cesium.Transforms.headingPitchRollToFixedFrame(e,Cesium.HeadingPitchRoll.fromDegrees(this.rotation+this._actionRotation+this._varyRotation,0,this.drawMode)),Cesium.defined(this.scaleMode)&&"0"===this.scaleMode&&(this.viewPosition.x===viewer.camera.position.x&&this.viewPosition.y===viewer.camera.position.y&&this.viewPosition.z===viewer.camera.position.z||(this.fixedScale=Cesium.Cartesian3.distance(viewer.camera.position,this.position)/this._fixedScale)),n=this._varyScale*Number(this.scale)*Number(this.distanceLegend)*this.fixedScale/1e5,this.modelMatrix=Cesium.Matrix4.multiplyByUniformScale(i,n,new Cesium.Matrix4))},nA.prototype.getGeometryInstances=function(){if(Cesium.defined(this.position)&&Cesium.defined(this.attri)){var e=[],t=this.attri,i=null;if(t.MainData.MainVertex){for(var n=0;n<t.MainData.MainVertex.length;n+=3)Cesium.defined(t.MainData)&&Cesium.defined(t.MainData.MainNormal)&&Cesium.defined(t.MainData.MainNormal[n])&&t.MainData.MainNormal[n+2]&&0===t.MainData.MainNormal[n]&&0===t.MainData.MainNormal[n+1]&&0===t.MainData.MainNormal[n+2]&&(t.MainData.MainNormal[n+2]=1);if(this._varyAlpha<1){a=t.MainData.MainColor.concat();for(n=3;n<a.length;n+=4)a[n]=Math.round(a[n]*this._varyAlpha)}i=rA(t.MainData.MainVertex,t.MainData.MainIndex,t.MainData.MainNormal,a||t.MainData.MainColor),e[e.length]=this.createGeometryInstance(i)}if(t.FillData.FillVertex&&0!==t.FillData.FillColor[3]){for(var r=[],n=0;n<t.FillData.FillVertex.length;n+=3)r[n]=0,r[n+1]=0,r[n+2]=1;if(this._varyAlpha<1){a=t.FillData.FillColor.concat();for(n=3;n<a.length;n+=4)a[n]=Math.round(a[n]*this._varyAlpha)}i=rA(t.FillData.FillVertex,t.FillData.FillIndex,r,a||t.FillData.FillColor),e[e.length]=this.createGeometryInstance(i)}if(t.TextData.TextVertex){for(var a,r=[],n=0;n<t.TextData.TextVertex.length;n+=3)r[n]=0,r[n+1]=0,r[n+2]=1;if(this._varyAlpha<1){a=t.TextData.TextColor.concat();for(n=3;n<a.length;n+=4)a[n]=Math.round(a[n]*this._varyAlpha)}i=rA(t.TextData.TextVertex,t.TextData.TextIndex,r,a||t.TextData.TextColor),e[e.length]=this.createGeometryInstance(i)}return e}},nA.prototype.getFramePrimitive=function(){if(Cesium.defined(this.mainLinePositions)){for(var e=[],t=null,i=0;i<this.mainLinePositions.length;++i){var n,r=Cesium.Cartesian3.unpackArray(this.mainLinePositions[i].toString().replace(/(\(|\))/g,"").split(",").map(function(e){return Number(e)}));Cesium.defined(this.mainLineColors)||checkAlpha(this.mainLineColor)?Cesium.defined(this.mainLineColors)&&!checkAlpha(this.mainLineColors[i])&&(t=new EV_PolylineVolumeGeometry({polylinePositions:r,shapePositions:this.getMainLineShape(),vertexFormat:VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid,cornerType:CornerType.MITERED}),e[e.length]=this.createGeometryInstance(t,this.mainLineColors[i],"mainLine"+i)):(t=new EV_PolylineVolumeGeometry({polylinePositions:r,shapePositions:this.getMainLineShape(),vertexFormat:VertexFormat.POSITION_AND_NORMAL,ellipsoid:this.ellipsoid,cornerType:CornerType.MITERED}),e[e.length]=this.createGeometryInstance(t,this.mainLineColor,"mainLine"+i)),this.isShowAuxiliaryLine&&!checkAlpha(this.auxiliaryLineColor)&&(n=Cesium.Cartesian3.unpackArray(this.mainLinePositions[i].toString().replace(/(\(|\))/g,"").split(",").map(function(e){return Number(e)})),t=new EV_PolylineVolumeGeometry({polylinePositions:n,shapePositions:this.getAuxiliaryLineShape(),vertexFormat:VertexFormat.POSITION_AND_NORMAL,cornerType:CornerType.MITERED,ellipsoid:this.ellipsoid}),e[e.length]=this.createGeometryInstance(t,this.auxiliaryLineColor,"auxiliaryLine"+i)),Cesium.defined(this.wallColors)||checkAlpha(this.wallColor)?Cesium.defined(this.wallColors)&&!checkAlpha(this.wallColors[i])&&(t=WallGeometry.fromConstantHeights({positions:this.wallPositions[i],minimumHeight:0,maximumHeight:this.distanceLegend*this.height,vertexFormat:VertexFormat.POSITION_AND_NORMAL}),e[e.length]=this.createGeometryInstance(t,this.wallColors[i],"wall"+i)):(t=WallGeometry.fromConstantHeights({positions:this.wallPositions[i],minimumHeight:0,maximumHeight:this.distanceLegend*this.height,vertexFormat:VertexFormat.POSITION_AND_NORMAL}),e[e.length]=this.createGeometryInstance(t,this.wallColor,"wall"+i))}if(this.isFill)if(Cesium.defined(this.fillColors)&&!checkAlpha(this.fillColors[0]))for(i=0;i<this.fillPositions.length;++i)t=PolygonGeometry.fromPositions({positions:this.fillPositions[i],height:this.distanceLegend*this.height,vertexFormat:VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[i]=this.createGeometryInstance(t,this.fillColors[i],"fill");else Cesium.defined(this.fillColors)||checkAlpha(this.fillColor)||!this.fillPositions[0]||(t=PolygonGeometry.fromPositions({positions:this.fillPositions[0],height:this.distanceLegend*this.height,vertexFormat:VertexFormat.POSITION_AND_NORMAL,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid}),e[e.length]=this.createGeometryInstance(t,this.fillColor,"fill"));return t=null,e}},nA.prototype.setEditMode=function(e,t){if(this._editMode!==e)if(e){t.startEdited(this);var i=viewer.scene,n=this;for(var r in this.allAttr={name:"",scale:"",rotation:0,mainLineColor:90,textFlag:!1,fillColor:"",drawMode:"",floatHeight3D:"",geometryPos:{},text:""},this.allAttr)Cesium.defined(n[r])?this.allAttr[r]=n[r]:delete this.allAttr[r];this.allAttr.isPoint=!0;var a,o;new Proxy(this.allAttr,{set:function(e,t,i){return e[t]=i,n.setAttribute(t,i),!0}});null==this._markers&&(o={dragHandlers:{onDrag:function(e,t){n.position=t,n.updateModelMatrix()},onDragEnd:function(){n.executeListeners({name:"onEdited",positions:n.position}),n.updateModelMatrix()}}},(a=new Bg(i,{scale:1.5},this._primitives,this.attri.distance,this.scale,this.floatHeight3D,this.drawMode)).addBillboard(n.position,o),this._markers=a,this._globeClickhandler=new Ng(i.canvas),this._globeClickhandler.setInputAction(function(e){var t=i.pick(e.position);t&&t.primitive||n.setEditMode(!1)},2),a.setOnTop()),this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},nA.prototype.createGeometryInstance=function(e){return this.updateModelMatrix(),new Cesium.GeometryInstance({geometry:e,modelMatrix:this.modelMatrix,pickPrimitive:this,attributes:{show:new Cesium.ShowGeometryInstanceAttribute(!0)}})},nA.prototype.callback=function(e,t){e.attri=t,e._createPrimitive=!0},aA.prototype.muteHandlers=function(e){this._handlersMuted=e},aA.prototype.registerEditablePrimitive=function(e){var t=this;oA(e,"leftClick",function(){t._handlersMuted||e.setEditMode(!0,t)})},aA.prototype.startDrawing=function(e){this.disableAllEditMode(),this.endDrawedCallbackFunc&&this.endDrawedCallbackFunc(),this.endDrawedCallbackFunc=e,this.muteHandlers(!0)},aA.prototype.stopDrawing=function(){this.endDrawedCallbackFunc&&(this.endDrawedCallbackFunc(),this.endDrawedCallbackFunc=void 0),this.muteHandlers(!1)},aA.prototype.disableAllEditMode=function(){this.startEdited(void 0)},aA.prototype.startEdited=function(e){this._editedPrimitive&&!this._editedPrimitive.isDestroyed()&&this._editedPrimitive.setEditMode(!1),this._editedPrimitive=e},aA.prototype.startDrawingSymbol=function(e,t,i,n,r){switch(i=i+"_"+(new Date).getTime(),n){case 0:this.startDrawingMarkerSymbol(e,t,i,r);break;case 1:this.startDrawingLineSymbol(e,t,i,r);break;default:throw new Cesium.DeveloperError("军标类型未定义")}},aA.prototype.startDrawingMarkerSymbol=function(a,o,s,u){this.startDrawing(function(){e.destroy()});var l=this,t=this.scene,c=l.ev_milStdLayerManager.getActiveLayer(t),e=new Cesium.ScreenSpaceEventHandler(t.canvas);if(!Cesium.defined(c))throw this.endDrawedCallbackFunc=void 0,console.error("需要定义一个活动图层"),new Cesium.DeveloperError("需要定义一个活动图层");e.setInputAction(function(e){var n,r;!Cesium.defined(e.position)||(n=t.pickPosition(e.position))&&(l.stopDrawing(),Cesium.defined(l.evPlottingService)&&(r={libraryID:a,symbolID:o,symbolSpecialInfo:'{"InnerText":"","Positions":"0.0,0.0,10.0"}'},l.evPlottingService.getSymbolMeshJson(r,function(e){var t=JSON.parse(e),i=new nA({viewer:l.viewer,ev_DrawHelper:l,evPlottingService:l.evPlottingService,name:s,id:l.ev_milStdLayerManager.createGuid(),url:r},t,a,o);i.position=n,32==a&&3==o&&(i._text="请输入文字"),i._createPrimitive=!0,l.registerEditablePrimitive(i),l.enhanceWithListeners(i),(i._primitives=c).add(i),i.checkPrimitive(),i.isDestroyed()||l.ev_milStdLayerManager.addGeometry(i),u(i)})))},Cesium.ScreenSpaceEventType.LEFT_CLICK)},aA.prototype.startDrawingLineSymbol=function(e,t,n,i){this.startDrawing(function(){Cesium.defined(l)&&l.destroy(),Cesium.defined(c)&&c.remove(),o.destroy()});var r=this,a=this.scene,o=new Cesium.ScreenSpaceEventHandler(a.canvas),s=r.ev_milStdLayerManager.getActiveLayer(a);if(!Cesium.defined(s))throw this.endDrawedCallbackFunc=void 0,console.error("需要定义一个活动图层"),new Cesium.DeveloperError("EV_DrawHelper需要定义一个活动图层");var u=[],l=new Vg({evPlottingService:this.evPlottingService},e,t);l.positions=u,l.asynchronous=!1,(l._primitives=s).add(l);var c=new Bg(a,void 0,s);function m(e,t){u.pop();var i=new eA({viewer:r.viewer,ev_DrawHelper:r,id:r.ev_milStdLayerManager.createGuid(),positions:u});i.positions=u,i.libraryID=l.libraryID,i.symbolID=l.symbolID,i.mainLinePositions=e.mainLinePositions,i.mainLineColors=e.mainLineColors,i.wallPositions=e.wallPositions,i.wallColors=e.wallColors,i.isFill=e.isFill,i.fillPositions=e.fillPositions,i.fillColors=e.fillColors,r.stopDrawing(),i.name=n,i._createPrimitive=!0,r.registerEditablePrimitive(i),r.enhanceWithListeners(i),(i._primitives=s).add(i),r.ev_milStdLayerManager.addGeometry(i),t(i)}o.setInputAction(function(e){var t;!Cesium.defined(e.position)||(t=a.pickPosition(e.position))&&(0===u.length&&(u.push(t.clone()),c.addBillboard(u[0])),1<u.length&&(l.positions=u,l.getDrawPositions()),t.y+=1+Math.random(),u.push(t),c.addBillboard(t),Cesium.defined(l.maxPoints)&&u.length>l.maxPoints&&m(l))},Cesium.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(e){var t,i=e.endPosition;!Cesium.defined(i)||0===u.length||(t=a.pickPosition(i))&&(u.pop(),t.y+=1+Math.random(),u.push(t),l.positions=u,l.getDrawPositions(),c.getBillboard(u.length-1).position=t)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(e){var t;!Cesium.defined(e.position)||(t=a.pickPosition(e.position))&&u.push(t),m(l,i)},Cesium.ScreenSpaceEventType.RIGHT_CLICK)},aA.prototype.enhanceWithListeners=function(e){e._listeners={},e.addListener=function(e,t){return this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),this._listeners[e].length},e.executeListeners=function(e,t){if(this._listeners[e.name]&&0<this._listeners[e.name].length)for(var i=0;i<this._listeners[e.name].length;i++)this._listeners[e.name][i](e);else t&&t(e)}},aA.prototype.enhancePrimitives=function(){var o=this;function e(){var r,a;function i(e){o.scene.screenSpaceCameraController.enableRotate=e}this._editable||(this._editable=!0,a=r=this,oA(r,"leftDown",function(e){function n(e){t.destroy(),i(!0),a.executeListeners({name:"dragEnd",positions:e})}var t=new Cesium.ScreenSpaceEventHandler(o.scene.canvas);t.setInputAction(function(e){var t,i=o.scene.pickPosition(e.endPositionz);i?(t=i,r.position=t,a.executeListeners({name:"drag",positions:t})):n(i)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(function(e){n(o.scene.pickPosition(e.position))},Cesium.ScreenSpaceEventType.LEFT_UP),i(!1)}),this.enhanceWithListeners(r))}Cesium.Cartesian3.prototype.setEditable=e,Cesium.Label.prototype.setEditable=e},aA.prototype.startDrawingSymbolByPosition=function(e){var r=this;!function i(e,t){if(0<=t){if(!e[t].GeoAttr.POINTS._Count)throw new Cesium.DeveloperError("识别不出要标类型");1==e[t].GeoAttr.POINTS._Count?r.startDrawingMarkerSymbolByPosition(e,t,n):r.startDrawingLineSymbolByPosition(e,t,n)}function n(e,t){i(e,t)}}(e,e.length-1)},aA.prototype.startDrawingMarkerSymbolByPosition=function(a,o,s){var e=a[o].GeoAttr.POINTS.Point||{};if(!e._X||!e._Y)throw new Cesium.DeveloperError("需要定义position");this.ev_milStdLayerManager.setActiveLayer(a[o].groupId,a[o].layerId);var u,l=this.ev_milStdLayerManager.getActiveLayer();if(!Cesium.defined(l))throw this.endDrawedCallbackFunc=void 0,new Cesium.DeveloperError("需要定义一个活动图层");if(Cesium.defined(a[o].DedicatedText))u=a[o].DedicatedText._Text;else if(Cesium.defined(a[o].InnerTextAttr))u=Cesium.defined(a[o].InnerTextAttr[0])?a[o].InnerTextAttr[0].InnerText._Text:a[o].InnerTextAttr.InnerText._Text;else{if(!Cesium.defined(a[o].AnnoTextAttr))throw new Cesium.DeveloperError("文字处有问题");u=a[o].AnnoTextAttr._Text}var t,c,m=Cesium.Cartesian3.fromDegrees(+e._X,+e._Y,+e._Z||0),d=a[o]._Code;d=[+(d=d.split(","))[0],+d[1]],Cesium.defined(this.evPlottingService)&&(t={libraryID:d[0],symbolID:d[1],symbolSpecialInfo:'{"InnerText":"'+u+'","Positions":"0.0,0.0,10.0"}'},(c=this).evPlottingService.getSymbolMeshJson(t,function(e){var t,i,n=JSON.parse(e),r=new nA({ev_DrawHelper:c,viewer:c.viewer,name:a[o]._Name+a[o]._Guid,id:a[o].id,text:u,evPlottingService:c.evPlottingService},n,d[0],d[1]);if(r.position=m,r.show=a[o]._Visible,r.mainLineWidth=a[o].StyleAttr.MainLine._Width,r.mainLineHeight=a[o].GeoAttr.GeoAttribute_Thickness3D,r.isShowAuxiliaryLine=a[o].StyleAttr.SurroundLine._Type,r.floatHeight3D=a[o].GeoAttr.GeoAttribute._FloatHeight3D,r.auxiliaryLineWidth=a[o].StyleAttr.SurroundLine._Width,r.auxiliaryLineColor=Mt.fromInt(a[o].StyleAttr.SurroundLine._Color),r.isFill=a[o].StyleAttr.Fill._Mode,Cesium.defined(n.FillData.FillColor)&&(t=n.FillData.FillColor,r.fillColor="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]/255+")"),r.scale=+a[o].GeoAttr.GeoAttribute._Scale,r.rotation=a[o].GeoAttr.GeoAttribute._Rotate,!a[o]._DisplayType&&!a[o].StyleAttr._DisplayType)throw new Cesium.DeveloperError("朝向类型有问题");+a[o]._DisplayType==a[o]._DisplayType&&(i=+a[o]._DisplayType),+a[o].StyleAttr._DisplayType==a[o].StyleAttr._DisplayType&&(i=+a[o].StyleAttr._DisplayType),r.drawMode=sA(i)[0],r.scaleMode=sA(i)[1],r.font=a[o].AnnoTextAttr.AnnoFont._Family,r.fontPlace=a[o].AnnoTextAttr.AnnoPosType._PosType,r.fontScale=a[o].AnnoTextAttr.AnnoFont._Height,Cesium.defined(a[o].StyleAttr.Mirroring)?(r.horizontal=a[o].StyleAttr.Mirroring._Horizontal,r.vertical=a[o].StyleAttr.Mirroring._Vertical):(r.horizontal=void 0,r.vertical=void 0),r.dragLineVisble=a[o].GeoAttr.GeoAttribute._ISVisibleDragLine,r._createPrimitive=!0,c.registerEditablePrimitive(r),c.enhanceWithListeners(r),(r._primitives=l).add(r),r.checkPrimitive(),r.isDestroyed()||c.ev_milStdLayerManager.addGeometry(r),s(a,--o)}))},aA.prototype.startDrawingLineSymbolByPosition=function(s,u,l){this.startDrawing(function(){Cesium.defined(p)&&p.destroy(),Cesium.defined(r)&&r.remove()});var c=this,e=this.scene,m=s[u].GeoAttr.POINTS.Point||{},d=s[u]._Code;d=[+(d=d.split(","))[0],+d[1]],c.ev_milStdLayerManager.setActiveLayer(s[u].groupId,s[u].layerId);var h=c.ev_milStdLayerManager.getActiveLayer();if(!Cesium.defined(h))throw c.endDrawedCallbackFunc=void 0,console.error("需要定义一个活动图层"),new Cesium.DeveloperError("需要定义一个活动图层");var f=[],p=new Vg({evPlottingService:c.evPlottingService},d[0],d[1]);p.positions=f,p.asynchronous=!1,(p._primitives=h).add(p);var t,r=new Bg(e,void 0,h);Cesium.defined(this.evPlottingService)&&(t={libraryID:d[0],symbolID:d[1],symbolSpecialInfo:'{"Positions":"0,0, 0.0, 0.0, 0.0"}'},this.evPlottingService.getSymbolMeshJson(t,function(e){var n=JSON.parse(e).MaxPointCount;m.map(function(e,t){var i;Cesium.defined(n)&&f.length>=n||(i=Cesium.Cartesian3.fromDegrees(+e._X,+e._Y,+e._Z),f.push(i),r.addBillboard(i))}),p.positions=f,p.getDrawPositions().then(function(e){var t,i,n,r,a,o;t=p,i=s,n=u,r=d,a=l,(o=new eA({viewer:c.viewer,ev_DrawHelper:c,id:i[n].id,positions:m})).positions=f,o.libraryID=r[0],o.symbolID=r[1],o.url=t.url,o.mainLinePositions=t.mainLinePositions,o.mainLineColor=t.mainLineColor,o.mainLineColors=t.mainLineColors,o.wallPositions=t.wallPositions,o.wallColor=t.wallColor,o.wallColors=t.wallColors,o.isFill=t.isFill,o.code=t.code,o.fillPositions=t.fillPositions,o.fillColor=t.fillColor,o.fillColors=t.fillColors,o.show=i[n]._Visible,o.mainLineWidth=i[n].StyleAttr.MainLine._Width,o.auxiliaryLineWidth=i[n].StyleAttr.SurroundLine._Width,o.up=i[n].GeoAttr.GeoAttribute._FloatHeight3D,o.wallTransparent=i[n].GeoAttr.GeoAttribute._WallTransparent,o.mainLineHeight=i[n].GeoAttr.GeoAttribute._Thickness3D,o.name=i[n]._Name+i[n]._Guid,c.stopDrawing(),o._createPrimitive=!0,c.registerEditablePrimitive(o),c.enhanceWithListeners(o),(o._primitives=h).add(o),c.ev_milStdLayerManager.addGeometry(o),n--,"function"==typeof a&&a(i,n)})}))};var uA=Object.freeze({Model_J10C:"Model_J10C",Model_J11D:"Model_J11D",Model_J16:"Model_J16"});function lA(e,t){this.viewer=e,this.dataMgr=t.dataMgr,this.mtMgr=t.mtMgr,this.trainingClock=t.trainingClock,this.dataMgr.addReceiveDataListener("addDrop",function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i={info:e[t],status:!0};h.push(i)}});var d,h=[],f=this,p=0;setInterval(function(){var e=f.trainingClock.tick(),t=Cesium.JulianDate.toDate(e).getTime(),i=2.5-f.trainingClock.multiplier;if(i<.5&&(i=.5),t-p!=1e3&&function(e,t){if(0!==e.length)for(var i=0;i<e.length;i++){var n=e[i];n.info.header.datTime>t&&(n.status=!0)}}(h,t),0!==h.length)for(var n=0;n<h.length;n++){var l,c,r,a,o,s,u=h[n].info;!0===h[n].status&&u.header.datTime<=t-1e3&&(l=f.mtMgr.ev_MTFlightDatas.get(u.header.sID),c=f.viewer.scene,void 0!==l&&void 0!==l.curTimeAttitude&&void 0!==l.curTimeAttitude.position&&(r=new Cesium.Transforms.eastNorthUpToFixedFrame(l.curTimeAttitude.position),a=new Cesium.Cartesian3(0,0,0),o=new Cesium.Cartesian2(1,1),s=new Cesium.Matrix4,m([new Cesium.ParticleBurst({time:i,minimum:25,maximum:25},{time:50,minimum:25,maximum:25})],s,r,a,o)),h[n].status=!1)}function m(e,t,i,n,r){var a=Cesium.Matrix3.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(-l.curTimeAttitude.headingPitchRoll.roll),Math.PI/2+Cesium.Math.toRadians(l.curTimeAttitude.headingPitchRoll.heading),Math.PI/2+Cesium.Math.toRadians(-l.curTimeAttitude.headingPitchRoll.pitch))),o=Cesium.Matrix4.fromRotationTranslation(a,n,t);var s,u=new Cesium.ParticleSystem({image:(Cesium.defined(d)||((d=document.createElement("canvas")).width=20,d.height=20,(s=d.getContext("2d")).beginPath(),s.arc(8,8,8,0,Cesium.Math.TWO_PI,!0),s.closePath(),s.fillStyle="rgb(255,174,3)",s.fill()),d),startScale:10,endColor:Cesium.Color.WHITE.withAlpha(0),particleLife:5,speed:900,imageSize:r,emissionRate:0,emitter:new Cesium.ConeEmitter(Cesium.Math.toRadians(30)),bursts:e,lifetime:5,sizeInMeters:!1,updateCallback:function(e,t){var i=e.position,n=Cesium.Cartesian3.normalize(i,new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(n,t,n),e.velocity=Cesium.Cartesian3.add(e.velocity,n,e.velocity)},modelMatrix:i,emitterModelMatrix:o});c.primitives.add(u),setTimeout(function(){c.primitives.remove(u)},5e3)}p=t},1e3)}function cA(e,t){var i={msgType:-1,sID:0,planeType:0,datTime:0,satTime:0,msgLen:0},n=z(t,0);return i.msgType=e.getUint16(n,!0),i.sID=e.getUint16(n+2,!0),i.planeType=e.getUint32(n+4,!0),i.datTime=mA(e,n+8),i.satTime=mA(e,n+16),i.msgLen=e.getUint16(n+24,!0),i}function mA(e,t){var i=e.getUint32(t,!0),n=e.getUint32(t+4,!0),r=i+Math.pow(2,32)*n;return Number.isSafeInteger(r)||console.warn(r,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),r}function dA(e,t){this.viewer=e,this.dis=1e3,this.transformFunc=Cesium.Transforms.localFrameToFixedFrameGenerator("north","west"),this.mtMgr=t.mtMgr}function hA(e,t){var i=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),n=Cesium.Cartesian3.normalize(i,new Cesium.Cartesian3),r=Cesium.Transforms.rotationMatrixFromPositionVelocity(e,n,Cesium.Ellipsoid.WGS84),a=Cesium.Quaternion.fromRotationMatrix(r),o=Cesium.Matrix4.fromRotationTranslation(r,e);Cesium.HeadingPitchRoll.fromQuaternion(a);return o}function fA(e){return Cesium.Transforms.fixedFrameToHeadingPitchRoll(e)}function pA(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._scale=Cesium.defaultValue(e.scale,3),this._color=Cesium.defaultValue(e.color,new Cesium.Color(1,1,1,1)),this._fieldAngle=Cesium.defaultValue(e.fieldAngle,60),this.aspectRatio=7,this.lastResetScaleTime=(new Date).getTime(),this.scaleMatrix3=[];for(var t=0;t<8;t++)this.scaleMatrix3.push(new Cesium.Matrix3);this.instances=[],this.boundingSphere=new Cesium.BoundingSphere(new Cesium.Cartesian3,1e4),this._center=new Cesium.Cartesian3,this._dynamic=Cesium.defaultValue(e.dynamic,!1),this.lightningTexture=void 0,this.lightningImage=void 0;var i=this;this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.TRIANGLES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:Cesium.defaultValue(e.depthTestState,!0),func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1}),uniformMap:{u_lightningImage:function(){return i.lightningTexture},u_lightningColor:function(){return i._color}}}),Cesium.Resource.createIfNeeded(Cesium.buildModuleUrl("Assets/EMExtensions/PolitTraningApp/images/Lightnings.png")).fetchImage().then(function(e){i.lightningImage=e})}dA.prototype.RadarBeam=function(e){var t=this.dis,i={geometry:new Cesium.CylinderGeometry({length:t,topRadius:t/30,bottomRadius:1e-4,showTop:!1})},n=new Cesium.GeometryInstance({geometry:i.geometry}),r=new Cesium.MaterialAppearance({flat:!0,translucent:!0,material:new Cesium.Material({fabric:{type:"Color",uniforms:{color:new Cesium.Color(1,1,0,.5)}}})});this.viewer.scene.primitives.add(new Cesium.Primitive({releaseGeometryInstances:!1,geometryInstances:n,appearance:r,modelMatrix:Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(99.7892,40.4014,4500)),new Cesium.Cartesian3(0,0,800),new Cesium.Matrix4),name:e,show:!1}),0)},dA.prototype.lidarRadar=function(e,n,r){var a=this;a.viewer.entities.add({id:e,polyline:{positions:new Cesium.CallbackProperty(function(){var e=a.mtMgr.ev_MTFlightDatas.get(n),t=function(e,t){var i=Cesium.Transforms.localFrameToFixedFrameGenerator("north","west"),n=e.curTimeAttitude.position,r=t.fDistance,a=e.curTimeAttitude.headingPitchRoll,o=new Cesium.HeadingPitchRoll(a.heading,a.pitch,a.roll),s=i(n,void 0,new Cesium.Matrix4),u=Cesium.Quaternion.fromHeadingPitchRoll(o,new Cesium.Quaternion),l=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),u,new Cesium.Cartesian3(1,1,1)),c=Cesium.Matrix4.multiply(s,l,new Cesium.Matrix4),m=Cesium.Quaternion.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(t.irmslAzimuth),Cesium.Math.toRadians(t.irmslPitch),0),new Cesium.Quaternion),d=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),m,new Cesium.Cartesian3(1,1,1));c=Cesium.Matrix4.multiply(c,d,new Cesium.Matrix4);var h=new Cesium.Cartesian3(r,0,0);return Cesium.Matrix4.multiplyByPoint(c,h,h),h}(e,r);if(void 0!==e&&void 0!==e.curTimeAttitude.fLat){var i=[];return i.push(e.curTimeAttitude.position),i.push(t),i}},!1),width:1,material:Cesium.Color.YELLOW,clampToGround:!1}})},dA.prototype.getPrimitive=function(e){for(var t=this.viewer.scene.primitives.length,i=0;i<t;++i){var n=this.viewer.scene.primitives.get(i);if(n.name===e)return n}},dA.prototype.sendModelMatrix=function(e,t,i){var n=i.position,r=t.tgtDis,a=i.headingPitchRoll,o=new Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(90)),s=new Cesium.HeadingPitchRoll(a.heading,a.pitch,a.roll),u=this.transformFunc(n,void 0,new Cesium.Matrix4),l=Cesium.Quaternion.fromHeadingPitchRoll(s,new Cesium.Quaternion),c=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),l,new Cesium.Cartesian3(1,1,1)),m=Cesium.Matrix4.multiply(u,c,new Cesium.Matrix4),d=Cesium.Quaternion.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(t.tgtAzimuth),Cesium.Math.toRadians(t.tgtPitch),0),new Cesium.Quaternion),h=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),d,new Cesium.Cartesian3(1,1,1)),m=Cesium.Matrix4.multiply(m,h,new Cesium.Matrix4),f=new Cesium.Cartesian3(r,0,0);Cesium.Matrix4.multiplyByPoint(m,f,f),t.targetPos=f;var p=r/1e3,_=Cesium.Matrix4.fromRotationTranslation(o);Cesium.Matrix4.multiply(m,_,m);var C=Cesium.Matrix4.fromScale(new Cesium.Cartesian3(p,p,p));Cesium.Matrix4.multiply(m,C,m);var g=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,this.dis/2));return Cesium.Matrix4.multiply(m,g,m),m},dA.prototype.getEntity=function(e){return this.viewer.entities.getById(e)},dA.prototype.MisToPlane=function(e,t){return function(e,t){var i=new Cesium.Cartesian3.fromDegrees(99.7892,40.4114,2e3),n=new Cesium.Cartesian3.fromDegrees(99.7892,40.4014,2e3),r=Cesium.Cartesian3.midpoint(n,i,new Cesium.Cartesian3),a=Cesium.Cartesian3.distance(i,n),o=fA(hA(i,n));o.pitch=o.pitch+Math.PI/2*3;var s=Cesium.Transforms.headingPitchRollToFixedFrame(r,o,Cesium.Ellipsoid.WGS84,Cesium.Transforms.eastNorthUpToFixedFrame,new Cesium.Matrix4),u={geometry:new Cesium.CylinderGeometry({length:a,topRadius:a/40,bottomRadius:0,showTop:!1}),id:t},l=new Cesium.Material({fabric:{uniforms:{color:new Cesium.Color(0,1,0,1),repeat:30,offset:0,thickness:.15},source:"uniform vec4 color;\nuniform float repeat;\nuniform float offset;\nuniform float thickness;\nczm_material czm_getMaterial(czm_materialInput materialInput){\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat sp = 1.0/repeat;\nvec2 st = materialInput.st;\nfloat dis = distance(st, vec2(0.5));\nfloat m = mod(dis + offset, sp);\nfloat a = step(sp*(1.0-thickness), m);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = a * color.a;\nreturn material;}"},translucent:!0}),c=new Cesium.MaterialAppearance({material:l,faceForward:!1,closed:!1}),m=e.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance(u),appearance:c,releaseGeometryInstances:!1,modelMatrix:s,name:t+"_radar"})),d={sid:t};return e.scene.preUpdate.addEventListener(function(){var e=m.appearance.material.uniforms.offset;1<(e-=.001)&&(e=0),m.appearance.material.uniforms.offset=e},d),m}(this.viewer,e)},dA.prototype.MisModelMatrix=function(e,t){var i=Cesium.Cartesian3.distance(e,t)/1110.7735888652096,n=Cesium.Cartesian3.midpoint(t,e,new Cesium.Cartesian3),r=new Cesium.Matrix4.fromScale(new Cesium.Cartesian3(i,i,i)),a=fA(hA(e,t));a.pitch=a.pitch+Math.PI/2*3;var o=Cesium.Transforms.headingPitchRollToFixedFrame(n,a,Cesium.Ellipsoid.WGS84,Cesium.Transforms.eastNorthUpToFixedFrame,new Cesium.Matrix4);return Cesium.Matrix4.multiply(o,r,o),o},dA.prototype.MisModelMatrixCaptureState=function(e,t,i){var n=t%90,r=parseInt(t/90),a=i.curTimeAttitude.headingPitchRoll,o=this.transformFunc(e,void 0,new Cesium.Matrix4),s=Cesium.Quaternion.fromHeadingPitchRoll(a,new Cesium.Quaternion),u=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),s,new Cesium.Cartesian3(1,1,1)),l=Cesium.Matrix4.multiply(o,u,new Cesium.Matrix4),c=Cesium.Quaternion.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(n-45),0,0),new Cesium.Quaternion);r%2!=0&&(c=Cesium.Quaternion.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(45-n),0,0),new Cesium.Quaternion));var m=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),c,new Cesium.Cartesian3(1,1,1)),l=Cesium.Matrix4.multiply(l,m,new Cesium.Matrix4),d=new Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(90)),h=Cesium.Matrix4.fromRotationTranslation(d);Cesium.Matrix4.multiply(l,h,l);var f=new Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,555.3867944326048));return Cesium.Matrix4.multiply(l,f,l),l},Object.defineProperties(pA.prototype,{color:{get:function(){return this._color},set:function(e){this._color=e}},scale:{get:function(){return this._scale},set:function(e){this._scale=e}},fieldAngle:{get:function(){return this._fieldAngle},set:function(e){this._fieldAngle=e}}}),pA.prototype.resetInstances=function(e){this.instances=e,this.blUpdateVAO=!0},pA.prototype.update=function(e){var t=e.context,i=this._command;Cesium.defined(this.lightningImage)&&!Cesium.defined(this.lightningTexture)&&(this.lightningTexture=new Cesium.Texture({context:t,source:this.lightningImage,sampler:new Cesium.Sampler({wrapS:Cesium.TextureWrap.CLAMP_TO_EDGE,wrapT:Cesium.TextureWrap.CLAMP_TO_EDGE,minificationFilter:Cesium.TextureMinificationFilter.LINEAR,magnificationFilter:Cesium.TextureMagnificationFilter.LINEAR})})),Cesium.defined(this.lightningTexture)&&(Cesium.defined(i.shaderProgram)||(i.shaderProgram=Cesium.ShaderProgram.fromCache({context:t,vertexShaderSource:"attribute vec3 position;\nattribute vec2 st;\nattribute float dirType; \nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nattribute float a_jamDir; \nvarying vec2   v_textureCoordinates;\nvarying float  v_dirType;\nvarying float  v_discard;\nvoid main()\n{\n    v_textureCoordinates = st; \n    v_dirType = dirType; \n    float Dir_RightBack = 0.0;\n    float Dir_LeftBack = 0.0;\n    float Dir_RightFront = 0.0;\n    float Dir_LeftFront = 0.0;\n    float tempValue = a_jamDir;\n    Dir_RightBack = mod(tempValue, 2.0) >0.0 ? 1.0 : 0.0;  \n    tempValue = floor(tempValue*0.5);\n    Dir_LeftBack = mod(tempValue, 2.0) >0.0 ? 1.0 : 0.0;  \n    tempValue =  floor(tempValue*0.5);\n    Dir_RightFront = mod(tempValue, 2.0) >0.0 ? 1.0 : 0.0;  \n    tempValue =   floor(tempValue*0.5);\n    Dir_LeftFront = tempValue >0.0 ? 1.0 : 0.0;  \n    v_discard = 1.0;\n    float absDirType = abs(dirType);\n    if(absDirType > 0.0 && absDirType<2.0 && Dir_RightBack > 0.0){\n       v_discard = 0.0;\n    }else if(absDirType > 1.0 && absDirType<3.0 && Dir_LeftBack > 0.0){\n       v_discard = 0.0;\n    }else if(absDirType > 3.0 && absDirType<5.0 && Dir_RightFront > 0.0){\n       v_discard = 0.0;\n    }else if(absDirType > 7.0 && absDirType<9.0 && Dir_LeftFront > 0.0){\n       v_discard = 0.0;\n    }\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_modelViewProjection * czm_instanced_model* vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec2  v_textureCoordinates;\nvarying float  v_dirType;\nvarying float  v_discard;\nuniform sampler2D  u_lightningImage;\nuniform vec4  u_lightningColor;\nvoid main()\n{\n    vec4 colour = texture2D(u_lightningImage, v_textureCoordinates); \n    if(v_discard > 0.0 ){;\n       discard;  \n    };\n    if(v_dirType < 0.0 ){;\n       colour.a *= 0.3;  \n    };\n    if(colour.a >= 0.0001 ){\n      colour.rgb = u_lightningColor.rgb; \n    }\n    gl_FragColor = colour;\n}\n"})),Cesium.defined(i.vertexArray)&&!i.vertexArray.isDestroyed()&&i.vertexArray.destroy(),this.blUpdateVAO&&0<this.instances.length&&(i.vertexArray=function(e,t){for(var i=function(e){var t=e.instances,i=t.length,n=e._center,r=e._vertexBufferTypedArray;Cesium.defined(r)||(r=new Float32Array(12*i));e._dynamic&&(e._vertexBufferTypedArray=r);for(var a=[],o=0;o<i;++o){var s=t[o].modelMatrix;a.push(new Cesium.Cartesian3(s[12],s[13],s[14]))}e.boundingSphere=Cesium.BoundingSphere.fromPoints(a);for(o=0;o<i;++o){var s=t[o].modelMatrix,u=Cesium.Matrix4.clone(s,_A);u[12]=u[12]-e.boundingSphere.center.x-n.x,u[13]=u[13]-e.boundingSphere.center.y-n.y,u[14]=u[14]-e.boundingSphere.center.z-n.z;var l=12*o;r[0+l]=u[0],r[1+l]=u[4],r[2+l]=u[8],r[3+l]=u[12],r[4+l]=u[1],r[5+l]=u[5],r[6+l]=u[9],r[7+l]=u[13],r[8+l]=u[2],r[9+l]=u[6],r[10+l]=u[10],r[11+l]=u[14]}return r}(t),n=Cesium.Buffer.createVertexBuffer({context:e,typedArray:i,usage:t._dynamic?Cesium.BufferUsage.STREAM_DRAW:Cesium.BufferUsage.STATIC_DRAW}),r=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),a={czm_modelMatrixRow0:{index:0,vertexBuffer:n,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*r,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:n,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*r,strideInBytes:12*r,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:n,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*r,strideInBytes:12*r,instanceDivisor:1}},o=t.instances.length,s=new Uint8Array(o),u=0;u<o;++u)s[u]=t.instances[u].jamDir;a.a_jamDir={index:0,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:e,typedArray:s,usage:Cesium.BufferUsage.STATIC_DRAW}),componentsPerAttribute:1,componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1},function(e){var t=e.scale,i=(new Date).getTime();{var n,r,a,o,s;200<i-e.lastResetScaleTime&&(n=100*Math.random(),r=n%t*2/3+t/3,a=(n=100*Math.random())%t*2/3+t/3,o=(n=100*Math.random())%t*2/3+t/3,s=(n=100*Math.random())%t*2/3+t/3,8==e.scaleMatrix3.length&&(Cesium.Matrix3.fromScale(new Cesium.Cartesian3(r,r,r),e.scaleMatrix3[0]),Cesium.Matrix3.fromScale(new Cesium.Cartesian3(-o,o,o),e.scaleMatrix3[1]),Cesium.Matrix3.fromScale(new Cesium.Cartesian3(a,-a,a),e.scaleMatrix3[2]),Cesium.Matrix3.fromScale(new Cesium.Cartesian3(-s,-s,s),e.scaleMatrix3[3]),Cesium.Matrix3.fromScale(new Cesium.Cartesian3(a,a,a),e.scaleMatrix3[4]),Cesium.Matrix3.fromScale(new Cesium.Cartesian3(-s,s,s),e.scaleMatrix3[5]),Cesium.Matrix3.fromScale(new Cesium.Cartesian3(r,-r,r),e.scaleMatrix3[6]),Cesium.Matrix3.fromScale(new Cesium.Cartesian3(-o,-o,o),e.scaleMatrix3[7])),e.lastResetScaleTime=i)}}(t);var l=function(e){e.color;var t=e.fieldAngle,i=e.aspectRatio,n=new Float32Array(96),r=new Float32Array(64),a=new Float32Array(32),o=Math.sin(Cesium.Math.toRadians(.5*t)),s=Math.cos(Cesium.Math.toRadians(.5*t)),u=Math.sin(Cesium.Math.toRadians(0)),l=new Array(4);l[0]=new Cesium.Cartesian3(0,o,0),l[1]=new Cesium.Cartesian3(i*s,s+i*o,(s+i*o)*u),l[2]=new Cesium.Cartesian3(o+i*s,i*o,i*o*u),l[3]=new Cesium.Cartesian3(o,0,0);var c=new Array(4);c[0]=new Cesium.Cartesian3(10,0,0),c[1]=new Cesium.Cartesian3(-6,0,0),c[2]=new Cesium.Cartesian3(10,0,0),c[3]=new Cesium.Cartesian3(-6,0,0);var m=0,d=0,h=0;CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[0],l[0],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=8,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[0],l[1],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=8,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[0],l[2],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=8,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[0],l[3],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=8,r[h++]=1,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[1],l[0],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=2,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[1],l[1],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=2,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[1],l[2],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=2,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[1],l[3],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=2,r[h++]=1,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[2],l[0],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=4,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[2],l[1],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=4,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[2],l[2],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=4,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[2],l[3],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=4,r[h++]=1,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[3],l[0],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=1,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[3],l[1],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=1,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[3],l[2],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=1,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[3],l[3],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=1,r[h++]=1,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[4],l[0],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-8,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[4],l[1],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-8,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[4],l[2],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-8,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[4],l[3],CA),Cesium.Cartesian3.add(CA,c[0],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-8,r[h++]=1,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[5],l[0],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-2,r[h++]=1,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[5],l[1],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-2,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[5],l[2],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-2,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[5],l[3],CA),Cesium.Cartesian3.add(CA,c[1],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-2,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[6],l[0],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-4,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[6],l[1],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-4,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[6],l[2],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-4,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[6],l[3],CA),Cesium.Cartesian3.add(CA,c[2],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-4,r[h++]=1,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[7],l[0],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-1,r[h++]=0,r[h++]=0,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[7],l[1],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-1,r[h++]=0,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[7],l[2],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-1,r[h++]=1,r[h++]=1,CA=Cesium.Matrix3.multiplyByVector(e.scaleMatrix3[7],l[3],CA),Cesium.Cartesian3.add(CA,c[3],CA),n[m++]=CA.x,n[m++]=CA.y,n[m++]=CA.z,a[d++]=-1,r[h++]=1,r[h++]=0;for(var f=Cesium.IndexDatatype.createTypedArray(32,48),p=0;p<8;p++)f[6*p]=4*p+0,f[6*p+1]=4*p+1,f[6*p+2]=4*p+2,f[6*p+3]=4*p+0,f[6*p+4]=4*p+2,f[6*p+5]=4*p+3;return{position:n,st:r,dirType:a,indices:f}}(t),c=0,m=[];return m.push({index:c++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:e,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,l.position),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),m.push({index:c++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:e,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,l.st),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1}),m.push({index:c++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:e,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,l.dirType),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:1,normalize:!1}),a.czm_modelMatrixRow0.index=c++,m.push(a.czm_modelMatrixRow0),a.czm_modelMatrixRow1.index=c++,m.push(a.czm_modelMatrixRow1),a.czm_modelMatrixRow2.index=c++,m.push(a.czm_modelMatrixRow2),a.a_jamDir.index=c++,m.push(a.a_jamDir),new Cesium.VertexArray({context:e,attributes:m,indexBuffer:Cesium.Buffer.createIndexBuffer({context:e,typedArray:l.indices,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})})}(t,this),i.instanceCount=this.instances.length,i.cull=!0,this.boundingSphere.radius=this.boundingSphere.radius<1e4?6378137:this.boundingSphere.radius,i.boundingVolume=this.boundingSphere,i.modelMatrix=Cesium.Matrix4.fromTranslation(i.boundingVolume.center)),Cesium.defined(i.vertexArray)&&e.commandList.push(i),this.blUpdateVAO=!1)};var _A=new Rn;var CA=new si;function gA(e,t){var r;this.options=t,this.viewer=e,Cesium.defined(this.viewer)&&(this.scene=this.viewer.scene,this.trainingClock=Cesium.defaultValue(t.trainingClock,void 0),this.dataMgr=Cesium.defaultValue(t.dataMgr,void 0),this.mtMgr=Cesium.defaultValue(t.mtMgr,void 0),Cesium.defined(this.scene)&&Cesium.defined(this.mtMgr)&&(this.transformFunc=Cesium.Transforms.localFrameToFixedFrameGenerator("north","west"),this.ev_radarJamDirCollection=new pA,this.ev_paRadarBeam=new dA(this.viewer,this.options),this.ev_mtRadarTargetDatas=new Cesium.AssociativeArray,this.ev_mtRadarWMDatas=new Cesium.AssociativeArray,this.ev_mtRadarJamDirDatas=new Cesium.AssociativeArray,this.ev_mtIrstWMDatas=new Cesium.AssociativeArray,this.ev_mtMisRadar=new Cesium.AssociativeArray,this.ev_mtSdrStateRadar=new Cesium.AssociativeArray,this._planeSectorRadarColor=new Cesium.Color(58/255,213/255,252/255,60/255),this._undergroundSectorRadarColor=new Cesium.Color(0,85/255,1,60/255),this._planePARadarColor=new Cesium.Color(.18,.75,.49,.6),this._undergroundPARadarColor=new Cesium.Color(.4,0,0,.6),this.ev_simpleConeRadars=new kn(this.options),this.conePARadarTypes=[],(r=this).receiveRadarTargetsListenerFunc=function(e){if(Array.isArray(e)){for(var t=0;t<e.length-1;t++)Math.abs(e[t].header.datTime-e[t+1].header.datTime)<500&&(e.splice(t,1),t--);for(t=0;t<e.length;t++){var i=e[t],n=r.ev_mtRadarTargetDatas.get(i.header.sID);n?n.push(i):r.ev_mtRadarTargetDatas.set(i.header.sID,[i])}}},r.dataMgr.addReceiveDataListener(Gt.NET_MSG_TARGET,r.receiveRadarTargetsListenerFunc),r.receiveRadarWMListenerFunc=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t],n=r.ev_mtRadarWMDatas.get(i.header.sID);n?n.push(i):r.ev_mtRadarWMDatas.set(i.header.sID,[i])}},r.dataMgr.addReceiveDataListener(Gt.NET_MSG_RDR_STATE,r.receiveRadarWMListenerFunc),r.receiveRadarJamDirListenerFunc=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t],n=r.ev_mtRadarJamDirDatas.get(i.header.sID);n?n.push(i):r.ev_mtRadarJamDirDatas.set(i.header.sID,[i])}},r.dataMgr.addReceiveDataListener(Gt.NET_MSG_EWS_STA,r.receiveRadarJamDirListenerFunc),r.receiveIRSTWMListenerFunc=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t],n=r.ev_mtIrstWMDatas.get(i.header.sID);n?n.push(i):r.ev_mtIrstWMDatas.set(i.header.sID,[i])}},r.dataMgr.addReceiveDataListener(Gt.NET_MSG_IRMSL_STATE,r.receiveIRSTWMListenerFunc),r.receiveSdrStateRadarListenerFunc=function(e){if(Array.isArray(e)){for(var t=0;t<e.length-1;t++)Math.abs(e[t].header.datTime-e[t+1].header.datTime)<500&&(e.splice(t,1),t--);for(t=0;t<e.length;t++){var i=e[t],n=r.ev_mtSdrStateRadar.get(i.header.sID);n?n.push(i):r.ev_mtSdrStateRadar.set(i.header.sID,[i])}}},r.dataMgr.addReceiveDataListener(Gt.NET_MSG_RAD_STATE,r.receiveSdrStateRadarListenerFunc),r.scene.primitives.add(r)))}Object.defineProperties(gA.prototype,{planePARadarColor:{get:function(){return this._planePARadarColor},set:function(e){this._planePARadarColor=e}},undergroundPARadarColor:{get:function(){return this._undergroundPARadarColor},set:function(e){this._undergroundPARadarColor=e}},planeSectorRadarColor:{get:function(){return this._planeSectorRadarColor},set:function(e){this._planeSectorRadarColor=e}},undergroundSectorRadarColor:{get:function(){return this._undergroundSectorRadarColor},set:function(e){this._undergroundSectorRadarColor=e}}});var vA=new Rn,yA=[],TA=[],xA=[];function wA(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),!Cesium.defined(e.ev_dataMgr))throw new Cesium.DeveloperError("ev_dataMgr is empty!.");this.ev_dataMgr=e.ev_dataMgr,this.ev_MTUpdateProperties=new Cesium.AssociativeArray;var o=this;o.updatePropertiesFunc=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t],n=o.ev_MTUpdateProperties.get(i.uId);if(Cesium.defined(n)){var r=AA(i.realTime,n);if(r)for(var a in r)"SIZE"!=a&&"header"!=a&&(i.specialAttributes[a]=r[a])}}},o.receiveDataListenerFunc=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++){var i=e[t],n=o.ev_MTUpdateProperties.get(i.header.sID);n?n.push(i):o.ev_MTUpdateProperties.set(i.header.sID,[i])}},o.ev_dataMgr.addReceiveDataListener(Gt.NET_MSG_FIGHTER,o.receiveDataListenerFunc)}function AA(e,t){if(1<t.length){e>t[t.length-1].header.datTime&&t.splice(0,t.length-1);for(var i=t[0],n=i,r=1;r<t.length;r++){if(n=t[r],e>=i.header.datTime&&e<=n.header.datTime)return 2<t.length&&0<r-2&&t.splice(0,r-2),i;i=t[r]}}}function EA(e){var o=e.viewer,s=e.xmlObj;this.viewer=o,this.timeId=void 0,this.sliderWidth=0,this.wsUrl=e.wsUrl,this.callback=e.callback,this.trajStart=new Cesium.AssociativeArray,this.realDistance=new Cesium.AssociativeArray,this._maxTaskConcurrency=Cesium.defaultValue(5,e._maxTaskConcurrency);var u=this,t=e.workName;this.worker=new Cesium.TaskProcessor(t,this._maxTaskConcurrency),this.datSource=e.datSource,this.promise=this.worker.scheduleTask({url:u.wsUrl,datSource:u.datSource}),this.worker._worker.onmessage=function(e){var t,i,n,r,a=e.data;Cesium.defined(a.id)||0==a.length||(t=Number(a[0]),i=Number(a[1]),n={startTime:new Date(t),endTime:new Date(i)},u.trainingClock=new Cesium.Clock({startTime:Cesium.JulianDate.fromDate(n.startTime),currentTime:Cesium.JulianDate.fromDate(n.startTime),stopTime:Cesium.JulianDate.fromDate(n.endTime),clockStep:Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER,clockRange:Cesium.ClockRange.CLAMPED}),u.ev_dataMgr=new Zt({worker:u.worker,xmlUrl:s,datSource:u.datSource,trainingClock:u.trainingClock}),u.ev_mtMgr=new $c({viewer:o,ev_dataMgr:u.ev_dataMgr,trainingClock:u.trainingClock,useInstancedColor:!0}),u.ev_mtMgr.graduatedColors.set(0,{modelColor:new Cesium.Color(1,0,0,1),modelIconColor:new Cesium.Color(1,0,0,1),modelLabelTextColor:new Cesium.Color(1,0,0,1),modelLabelPullWireColor:new Cesium.Color(1,0,0,1),traceRibbonColor:new Cesium.Color(1,0,0,.8),traceLineColor:new Cesium.Color(1,0,0,.8),traceBarColor:new Cesium.Color(1,0,0,.8)}),u.ev_mtMgr.graduatedColors.set(1,{modelColor:new Cesium.Color(0,0,1,1),modelIconColor:new Cesium.Color(0,0,1,1),modelLabelTextColor:new Cesium.Color(0,0,1,1),modelLabelPullWireColor:new Cesium.Color(0,0,1,1),traceRibbonColor:new Cesium.Color(0,0,1,.8),traceLineColor:new Cesium.Color(0,0,1,.8),traceBarColor:new Cesium.Color(0,0,1,.8)}),u.ev_mtMgr.graduatedColors.set(2,{modelColor:new Cesium.Color(0,1,1,1),modelIconColor:new Cesium.Color(0,1,1,1),modelLabelTextColor:new Cesium.Color(0,1,1,1),modelLabelPullWireColor:new Cesium.Color(0,1,1,1),traceRibbonColor:new Cesium.Color(0,1,1,1),traceLineColor:new Cesium.Color(0,1,1,1),traceBarColor:new Cesium.Color(0,1,1,1)}),(r=new rm({})).addDisplayFieldPara("","name"),r.addDisplayFieldPara("ID:","uId"),r.addDisplayFieldPara("经度:","fLon",2),r.addDisplayFieldPara("纬度:","fLat",2),r.addDisplayFieldPara("海拔:","fAlt",2),r.addDisplayFieldPara("机型:","modelType"),u.ev_mtMgr.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_TSPI,r),(r=new rm({showBackground:!1})).addDisplayFieldPara("经度:","fLon",2),r.addDisplayFieldPara("纬度:","fLat",2),r.addDisplayFieldPara("海拔:","fAlt",2),r.addDisplayFieldPara("机型:","modelType"),u.ev_mtMgr.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_WPN_TRAJ,r),(r=new rm({showBackground:!1})).addDisplayFieldPara("假阵地编号:","fakeCampID"),r.addDisplayFieldPara("营地类型:","campType"),r.addDisplayFieldPara("装备类型:","equipmentType"),r.addDisplayFieldPara("装备编号ID:","equipmentID"),u.ev_mtMgr.ev_MTLabelConfigurationTables.set(Gt.NET_MSG_GTSPI,r),u.ev_mtMgr.ev_MTZoomFactors.set(Gt.NET_MSG_GTSPI,{minimumPixelSize:30}),u.ev_mtMgr.ev_MTZoomFactors.set(Gt.NET_MSG_TSPI,{minimumPixelSize:30}),u.ev_mtMgr.ev_MTZoomFactors.set(Gt.NET_MSG_WPN_TRAJ,{minimumPixelSize:10}),u.ev_mtUpdateProperties=new wA({ev_dataMgr:u.ev_dataMgr}),u.ev_mtMgr.preUpdateRenderMovingTargetFunc=u.ev_mtUpdateProperties.updatePropertiesFunc,u.ev_special=new lA(o,{dataMgr:u.ev_dataMgr,mtMgr:u.ev_mtMgr,trainingClock:u.trainingClock}),u.ev_mtSensorMgr=new gA(o,{dataMgr:u.ev_dataMgr,mtMgr:u.ev_mtMgr,trainingClock:u.trainingClock}),u.ev_DrawConnectionLines=new Qt(o,{mtMgr:u.ev_mtMgr}),u.callback())}}function SA(e){if(!Cesium.defined(e))throw new DeveloperError("参数options不能为空。");if(!Cesium.defined(e.viewer))throw new DeveloperError("Viewer对象options.viewer不能为空。");if(!Cesium.defined(e.startPoint))throw new DeveloperError("管道开始坐标不能为空。");if(!Cesium.defined(e.endPoint))throw new DeveloperError("管道结束坐标不能为空。");if(Cesium.defined(e.geos)&&Cesium.defined(e.radiusArray)&&e.geos.length!=e.radiusArray.length)throw new DeveloperError("管道点的数量和半径数量不一致。");this._viewer=e.viewer,this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0,1)),this.show=Cesium.defaultValue(e.show,!0),this._center=new Cesium.Cartesian3,this.startPoint=e.startPoint,this.endPoint=e.endPoint,this.minH=Cesium.defaultValue(e.minH,0),this.maxH=Cesium.defaultValue(e.maxH,2e3),this.countRdii=Cesium.defaultValue(e.countRdii,1),this.lineCount=Cesium.defaultValue(e.lineCount,36),this.radius=Cesium.defaultValue(e.radius,500),this.radiusArray=Cesium.defaultValue(e.radiusArray,[]),this.radii=Cesium.defaultValue(e.radii,1),this.keyPts=[],this.geos=Cesium.defaultValue(e.geos,[]),0==this.geos.length&&function(e,t,i,n,r,a){if(r<2)return;var o,s=Cesium.Cartographic.fromCartesian(e,Cesium.Ellipsoid.WGS84),u=Cesium.Math.toDegrees(s.longitude),l=Cesium.Math.toDegrees(s.latitude),c=Cesium.Cartographic.fromCartesian(t,Cesium.Ellipsoid.WGS84),m=Cesium.Math.toDegrees(c.longitude),d=Cesium.Math.toDegrees(c.latitude),h=bA(l,u,d,m,.5),f=MA(l,u,h.latitude,h.longitude);0<f&&(o=(i-n)/(f*f));for(var p=0;p<r;p++){var _=bA(l,u,d,m,p/(r-1));f=MA(_.latitude,_.longitude,h.latitude,h.longitude);var C=o*f*f+n,g=Cesium.Cartesian3.fromDegrees(_.longitude,_.latitude,C);a.push(g)}}(this.startPoint,this.endPoint,this.minH,this.maxH,200,this.geos);for(var t=0;t<this.geos.length;++t){var i={};i.geo=this.geos[t],0==this.radiusArray.length?i.R=this.radius:i.R=this.radiusArray[t],i.r=i.R*this.radii,this.keyPts.push(i)}this.center=Cesium.Cartesian3.ZERO,0<this.keyPts.length&&(this.center=this.keyPts[0].geo),this._command=new Cesium.DrawCommand({owner:this,pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},depthMask:!1})}),this._viewer.scene.primitives.add(this)}function bA(e,t,i,n,r){if(Math.abs(r)<1e-6)return{latitude:e,longitude:t};var a=Cesium.Cartesian3.fromDegrees(t,e),a=Cesium.Cartesian3.normalize(a),o=Cesium.Cartesian3.fromDegrees(n,i),o=Cesium.Cartesian3.normalize(o),s=Math.acos(Cesium.Cartesian3.dot(a,o));if(isNaN(s))return{latitude:e,longitude:t};var u=Cesium.Cartesian3.cross(a,o,new Cesium.Cartesian3);if(isNaN(u.x)||isNaN(u.y)||isNaN(u.z))return{latitude:e,longitude:t};u=Cesium.Cartesian3.normalize(u,new Cesium.Cartesian3);var l=Cesium.Quaternion.fromAxisAngle(u,s*r),c=Cesium.Matrix3.fromQuaternion(l,new Cesium.Matrix3),m=Cesium.Matrix3.multiplyByVector(c,a,new Cesium.Cartesian3),m=Cesium.Cartesian3.normalize(m),d=Cesium.Cartographic.fromCartesian(m,Cesium.Ellipsoid.WGS84);return{latitude:Cesium.Math.toDegrees(d.latitude),longitude:Cesium.Math.toDegrees(d.longitude)}}function MA(e,t,i,n){var r=Cesium.Math.toRadians(e),a=Cesium.Math.toRadians(t),o=Cesium.Math.toRadians(i),s=Cesium.Math.toRadians(n);return Math.acos(Math.cos(r)*Math.cos(o)*Math.cos(a-s)+Math.sin(r)*Math.sin(o))}function RA(e,t,i){if(e instanceof Cesium.Cartesian3&&e instanceof Cesium.Cartesian3){Cesium.defined(i)||(i=new Cesium.Quaternion(Cesium.Quaternion.IDENTITY));var n,r,a,o,s=e.clone(),u=t.clone(),s=Cesium.Cartesian3.normalize(s,s),u=Cesium.Cartesian3.normalize(u,u),l=Cesium.Cartesian3.dot(s,u,l);return 1<=l?i:i=l<1e-6-1?(n=new Cesium.Cartesian3,n=Cesium.Cartesian3.cross(Cesium.Cartesian3.UNIT_X,e,n),Cesium.Cartesian3.magnitudeSquared(n)<1e-12&&(n=Cesium.Cartesian3.cross(Cesium.Cartesian3.UNIT_Y,e,n)),n=Cesium.Cartesian3.normalize(n,n),Cesium.Quaternion.fromAxisAngle(n,Math.toRadians(Math.PI),i)):(a=1/(r=Math.sqrt(2*(1+l))),o=new Cesium.Cartesian3,o=Cesium.Cartesian3.cross(s,u,o),i.x=o.x*a,i.y=o.y*a,i.z=o.z*a,i.w=.5*r,Cesium.Quaternion.normalize(i,i))}}function DA(e){this.geometry=void 0,this.blUpdateVAO=!1,this.originColor=new Cesium.Color(0,1,0,1),this.outdatedColor=new Cesium.Color(1,0,0,1),this._curMillisecTime=9466848e5,this.boundingSphere=void 0,this._mode=void 0;var i=this;this._command=new Cesium.DrawCommand({pass:Cesium.Pass.OPAQUE,primitiveType:Cesium.PrimitiveType.LINES,modelMatrix:Cesium.Matrix4.IDENTITY,owner:this,renderState:Cesium.RenderState.fromCache({blending:Cesium.BlendingState.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL}}),uniformMap:{u_originColor:function(){return i.originColor},u_outdatedColor:function(){return i.outdatedColor},u_curMillisecTime:function(){var e=Math.floor(i._curMillisecTime/1e6),t=i._curMillisecTime%1e6;return new Cesium.Cartesian2(e,t)}}})}gA.prototype.prePassesUpdate=function(e){if(e.mode==Cesium.SceneMode.SCENE3D){var t,i=(new Date).getTime();Cesium.defined(this.trainingClock)&&(t=this.trainingClock.tick(),i=Cesium.JulianDate.toDate(t).getTime(),i=this.mtMgr.lastTrainingTimeMsec);var n=function(e,t){var i=new Cesium.AssociativeArray;for(var n in e.ev_mtRadarJamDirDatas._hash){var r=e.ev_mtRadarJamDirDatas.get(n);if(1<r.length){if(r[r.length-1].header.datTime<t){r.splice(0,r.length-1);continue}if(r[0].header.datTime>=t)continue;for(var a=r[0].header,o=a,s=1;s<r.length;s++){if(o=r[s].header,t>=a.datTime&&t<=o.datTime){i.set(n,r[s-1]),0<s-2&&r.splice(0,s-1);break}a=o}}}return i}(this,i),r=function(e,t){var i=new Cesium.AssociativeArray;for(var n in e.ev_mtIrstWMDatas._hash){var r=e.ev_mtIrstWMDatas.get(n);if(1<r.length){if(r[r.length-1].header.datTime<t){r.splice(0,r.length-1);continue}if(r[0].header.datTime>=t)continue;for(var a=r[0].header,o=a,s=1;s<r.length;s++){if(o=r[s].header,t>=a.datTime&&t<=o.datTime){i.set(n,r[s-1]),0<s-2&&r.splice(0,s-1);break}a=o}}}return i}(this,i),a=function(e,t){var i=new Cesium.AssociativeArray;for(var n in e.mtMgr.ev_MTFlightDatas._hash){var r,a=e.mtMgr.ev_MTFlightDatas.get(n);null!=a.curTimeAttitude.position&&32==a.mtType&&(r=e.dataMgr.splitTwo(t,a),i.set(n,r))}return i}(this,i),o=function(e,t){var i=new Cesium.AssociativeArray;for(var n in e.ev_mtSdrStateRadar._hash){var r=e.ev_mtSdrStateRadar.get(n);if(1<r.length){if(r[r.length-1].header.datTime<t){r.splice(0,r.length-1);continue}if(r[0].header.datTime>=t)continue;for(var a=r[0].header,o=a,s=1;s<r.length;s++){if(o=r[s].header,t>=a.datTime&&t<=o.datTime){i.set(n,r[s-1]),0<s-2&&r.splice(0,s-1);break}a=o}}}return i}(this,i),s=function(e,t){var i=new Cesium.AssociativeArray;for(var n in e.ev_mtRadarWMDatas._hash){var r=e.ev_mtRadarWMDatas.get(n);if(1<r.length){if(r[r.length-1].header.datTime<t){r.splice(0,r.length-1);continue}if(r[0].header.datTime>=t)continue;for(var a=r[0].header,o=a,s=1;s<r.length;s++){if(o=r[s].header,t>=a.datTime&&t<=o.datTime){i.set(n,r[s-1]),0<s-2&&r.splice(0,s-1);break}a=o}}}return i}(this,i),u=function(e,t){var i=new Cesium.AssociativeArray;for(var n in e.ev_mtRadarTargetDatas._hash){var r=e.ev_mtRadarTargetDatas.get(n);if(1<r.length){if(r[r.length-1].header.datTime<t){r.splice(0,r.length-1);continue}if(r[0].header.datTime>=t)continue;for(var a in e.mtMgr.ev_dataMgr.idchUnderRaderList._hash)if(n==a.split("_")[0]&&"2"===a.split("_")[2]){n=a;break}var o=e.mtMgr.ev_MTFlightDatas.get(n);if(o)for(var s=r[0].header,u=s,l=1;l<r.length;l++){if(u=r[l].header,t>=s.datTime&&t<=u.datTime){2e3<=u.datTime-s.datTime?r[l-1].showSector=!0:u.datTime-s.datTime<2e3&&0<u.datTime-s.datTime&&(r[l-1].showSector=!1,(!Cesium.defined(r[l-1].nearestTimeAttitude)||Math.abs(r[l-1].header.datTime-r[l-1].nearestTimeAttitude.realTime)>=Math.abs(r[l-1].header.datTime-t))&&(r[l-1].nearestTimeAttitude=o.curTimeAttitude),(!Cesium.defined(r[l].nearestTimeAttitude)||Math.abs(r[l].header.datTime-r[l].nearestTimeAttitude.realTime)>=Math.abs(r[l].header.datTime-t))&&(r[l].nearestTimeAttitude=o.curTimeAttitude)),i.set(n,r[l-1]),0<l-2&&r.splice(0,l-1);break}s=u}}}return i}(this,i);for(var l in TA=[],this.conePARadarTypes=[],s._hash){var c=s.get(l),m=u.get(l);if(R=this.mtMgr.ev_MTFlightDatas.get(c.header.sID))if(R.sectorRadarVisible=!1,1==c.openState&&1==c.radiaState){var d=!1,h=!1;if(!Cesium.defined(m)||Cesium.defined(m.showSector)&&m.showSector)d=!0;else for(var f=m.tgtInfo,p=0;p<f.length&&p<m.tgtNum;p++){(0==(H=f[p]).tgtSensor||2==H.tgtSensor)&&(70<=H.tgtPitch||H.tgtPitch<=-70||70<=H.tgtAzimuth||H.tgtAzimuth<=-70)||0===H.tgtAzimuth||0===H.tgtPitch?d=!0:h=!0}if(!h&&d)R.sectorRadarVisible=!0,R.sectorRadarColor=this._planeSectorRadarColor;else if(h){(W=m.nearestTimeAttitude).position=R.curTimeAttitude.position;m.header.datTime;for(f=m.tgtInfo,p=0;p<f.length&&p<m.tgtNum;p++){0!=(H=f[p]).tgtSensor&&2!=H.tgtSensor||(q=l+"_"+p,this.conePARadarTypes.push({name:q,show:!0,color:this.planePARadarColor,modelMatrix:this.calcPARadarModelMatrix(H,W,this.ev_simpleConeRadars.cylinderLength)}))}}}else if(0==c.openState||0==c.radiaState){if(void 0!==m)for(f=m.tgtInfo,p=0;p<f.length&&p<m.tgtNum;p++){(0==(H=f[p]).tgtSensor||2==H.tgtSensor)&&(70<=H.tgtPitch||H.tgtPitch<=-70||70<=H.tgtAzimuth||H.tgtAzimuth<=-70)||0===H.tgtAzimuth||H.tgtPitch}}else if(1==c.openState&&1==c.interceptState&&null!=m)for(f=m.tgtInfo,p=0;p<f.length&&p<m.tgtNum;p++){(H=f[p]).tgtSensor}}var _=[];for(var l in n._hash){var C,g,v,y,T,x,w=n.get(l);(R=this.mtMgr.ev_MTFlightDatas.get(w.header.sID))&&(C=R.curTimeAttitude.position,g=Cesium.defined(R.curTimeAttitude.scale)?R.curTimeAttitude.scale:1,!!Cesium.defined(R.curTimeAttitude.visible)&&R.curTimeAttitude.visible&&0<w.ewsDir&&(v=new Cesium.HeadingPitchRoll(R.curTimeAttitude.headingPitchRoll.heading,R.curTimeAttitude.headingPitchRoll.pitch,R.curTimeAttitude.headingPitchRoll.roll),x=this.transformFunc(C,void 0,vA),y=Cesium.Quaternion.fromHeadingPitchRoll(v,new Cesium.Quaternion),T=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),y,new Cesium.Cartesian3(g,g,g)),x=Cesium.Matrix4.multiply(x,T,new Cesium.Matrix4),_.push({modelMatrix:x,jamDir:w.ewsDir})))}for(var l in this.ev_radarJamDirCollection&&this.ev_radarJamDirCollection.resetInstances(_),r._hash){var A,E=r.get(l);(R=this.mtMgr.ev_MTFlightDatas.get(E.header.sID))&&(A=R.curTimeAttitude.specialAttributes,q=l+"_liderRadar",Cesium.defined(A.decoyDrop)&&1==A.decoyDrop?-1===yA.indexOf(q)?(yA.push(q),this.ev_paRadarBeam.lidarRadar(q,l,E)):(null!=(Y=this.ev_paRadarBeam.getEntity(q))&&(Y.show=!0),TA.push(q)):Cesium.defined(A.decoyDrop)&&0==A.decoyDrop&&null!=(Y=this.ev_paRadarBeam.getEntity(q))&&(Y.show=!1))}for(var l in a._hash){var S=a.get(l),b=l;if(S.header.datTime-i<-1e3)null!=(j=this.ev_paRadarBeam.getPrimitive(b+"_radar"))&&(j.show=!1);else if(0!=S.captureState){if(null==(j=this.ev_paRadarBeam.getPrimitive(b+"_radar"))){(j=this.ev_paRadarBeam.MisToPlane(b)).show=!0,yA.push(b+"_radar");var M={sid:b,count:0};xA.push(M)}else if(null!=j){TA.push(b+"_radar");for(p=0;p<xA.length;p++){(H=xA[p]).sid==b&&H.count++}if(null!=this.mtMgr.ev_MTFlightDatas.get(b)&&null!=this.mtMgr.ev_MTFlightDatas.get(S.targetID)){for(var R,D=void 0,P=b.split("_")[0],I=0;I<this.mtMgr.ev_MTFlightDatas.length;I++){if("string"==typeof(R=this.mtMgr.ev_MTFlightDatas.values[I]).uId){var O=R.uId.split("_");if(3==O.length&&O[0]===P&&"5"===O[2]){D=this.mtMgr.ev_MTFlightDatas.values[I].curTimeAttitude;break}}}if(Cesium.defined(D)){var L=this.mtMgr.ev_MTFlightDatas.get(b).curTimeAttitude.position,N=this.mtMgr.ev_MTFlightDatas.get(S.targetID).curTimeAttitude.position,B=D.nRedOrBlue;if(null!=N&&null!=L){var z=this.ev_paRadarBeam.MisModelMatrix(L,N);if(2==S.captureState){for(var F=0,p=0;p<xA.length;p++){(H=xA[p]).sid==b&&(F=H.count)}z=this.ev_paRadarBeam.MisModelMatrixCaptureState(L,F,this.mtMgr.ev_MTFlightDatas.get(b)),j.modelMatrix=z,j.show=!0,0==B?j.appearance.material.uniforms.color=new Cesium.Color(1,0,0,1):1==B&&(j.appearance.material.uniforms.color=new Cesium.Color(0,0,1,1))}else 1==S.captureState&&(j.modelMatrix=z,0==B?j.appearance.material.uniforms.color=new Cesium.Color(1,0,0,1):1==B&&(j.appearance.material.uniforms.color=new Cesium.Color(0,0,1,1)),j.show=!0)}}}}}else 0==S.captureState&&(null!=(j=this.ev_paRadarBeam.getPrimitive(b+"_radar"))?j.show=!1:null==j&&((j=this.ev_paRadarBeam.MisToPlane(b)).show=!1,yA.push(b+"_radar"),M={sid:b,count:0},xA.push(M)))}for(var l in o._hash){var V=!1,U=!1,G=o.get(l);if(null==(m=u.get(l)))for(var k in u._hash)if(l==k.split("_")[0]){m=u.get(k);break}if(null!=m){f=m.tgtInfo;if(1==G.openState)for(p=0;p<f.length&&p<m.tgtNum;p++)U=(0==(H=f[p]).tgtSensor||2==H.tgtSensor)&&(70<=H.tgtPitch||H.tgtPitch<=-70||70<=H.tgtAzimuth||H.tgtAzimuth<=-70)||0===H.tgtAzimuth||0===H.tgtPitch?!(V=!1):!(V=!0);else 0==G.openState&&(V=U=!1)}if(!U&&V){var H,W=m.nearestTimeAttitude,f=(m.header.datTime,m.tgtInfo);if(null!=W&&null!=W.fAlt)for(var q,p=0;p<f.length&&p<m.tgtNum;p++){0!=(H=f[p]).tgtSensor&&2!=H.tgtSensor||(q=l+"_"+p,this.conePARadarTypes.push({name:q,show:!0,color:this.undergroundPARadarColor,modelMatrix:this.calcPARadarModelMatrix(H,W,this.ev_simpleConeRadars.cylinderLength,new Cesium.Cartesian3(1,.6,.6))}))}}}this.ev_simpleConeRadars.recreateVertexArrays(this.conePARadarTypes,e);for(var j,Y,p=0;p<yA.length;p++){-1===TA.indexOf(yA[p])&&(null!=(j=this.ev_paRadarBeam.getPrimitive(yA[p]))&&(j.show=!1),null!=(Y=this.ev_paRadarBeam.getEntity(yA[p]))&&(Y.show=!1))}}},gA.prototype.update=function(e){e.mode==Cesium.SceneMode.SCENE3D&&(this.ev_radarJamDirCollection&&this.ev_radarJamDirCollection.update(e),this.ev_simpleConeRadars&&this.ev_simpleConeRadars.update(e))},gA.prototype.removeAllRadarDatas=function(){this.ev_mtRadarTargetDatas.removeAll(),this.ev_mtRadarWMDatas.removeAll(),this.ev_mtRadarJamDirDatas.removeAll(),this.ev_mtMisRadar.removeAll()},gA.prototype.addRadarWMDatas=function(e,t,i){i=Cesium.defaultValue(i,Kt.ADD);var n=this.ev_mtRadarTargetDatas.get(e);Cesium.defined(n)||(this.ev_mtRadarTargetDatas.set(e,[]),n=this.ev_mtRadarTargetDatas.get(e)),i==Kt.ADD?this.ev_mtRadarTargetDatas._hash[e]=n.concat(t):i==Kt.REPLACE&&(n=[],this.ev_mtRadarTargetDatas._hash[e]=n.concat(t))},gA.prototype.addRadarWMDatas=function(e,t,i){i=Cesium.defaultValue(i,Kt.ADD);var n=this.ev_mtRadarWMDatas.get(e);Cesium.defined(n)||(this.ev_mtRadarWMDatas.set(e,[]),n=this.ev_mtRadarWMDatas.get(e)),i==Kt.ADD?this.ev_mtRadarWMDatas._hash[e]=n.concat(t):i==Kt.REPLACE&&(n=[],this.ev_mtRadarWMDatas._hash[e]=n.concat(t))},gA.prototype.addRadarJamDirDatas=function(e,t,i){i=Cesium.defaultValue(i,Kt.ADD);var n=this.ev_mtRadarJamDirDatas.get(e);Cesium.defined(n)||(this.ev_mtRadarJamDirDatas.set(e,[]),n=this.ev_mtRadarJamDirDatas.get(e)),i==Kt.ADD?this.ev_mtRadarJamDirDatas._hash[e]=n.concat(t):i==Kt.REPLACE&&(n=[],this.ev_mtRadarJamDirDatas._hash[e]=n.concat(t))},$c.prototype.addev_mtMisRadar=function(e,t,i){},gA.prototype.calcPARadarModelMatrix=function(e,t,i,n){var r=t.position,a=e.tgtDis,o=t.headingPitchRoll,s=Cesium.defaultValue(n,new Cesium.Cartesian3(1,1,1)),u=new Cesium.Matrix3.fromRotationY(Cesium.Math.toRadians(90)),l=new Cesium.HeadingPitchRoll(o.heading,o.pitch,o.roll),c=this.transformFunc(r,void 0,new Cesium.Matrix4),m=Cesium.Quaternion.fromHeadingPitchRoll(l,new Cesium.Quaternion),d=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),m,new Cesium.Cartesian3(1,1,1)),h=Cesium.Matrix4.multiply(c,d,new Cesium.Matrix4),f=Cesium.Quaternion.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(e.tgtAzimuth),Cesium.Math.toRadians(e.tgtPitch),0),new Cesium.Quaternion),p=Cesium.Matrix4.fromTranslationQuaternionRotationScale(new Cesium.Cartesian3(0,0,0),f,s),h=Cesium.Matrix4.multiply(h,p,new Cesium.Matrix4),_=new Cesium.Cartesian3(a,0,0);Cesium.Matrix4.multiplyByPoint(h,_,_),e.targetPos=_;var C=a/1e3,g=Cesium.Matrix4.fromRotationTranslation(u);Cesium.Matrix4.multiply(h,g,h);s=Cesium.Matrix4.fromScale(new Cesium.Cartesian3(C,C,C));Cesium.Matrix4.multiply(h,s,h);var v=Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(0,0,i/2));return Cesium.Matrix4.multiply(h,v,h),h},gA.prototype.isDestroyed=function(){return!1},gA.prototype.destroy=function(){this.ev_mtRadarTargetDatas.removeAll(),this.ev_mtRadarWMDatas.removeAll(),this.ev_mtRadarJamDirDatas.removeAll();var e=this._scene.primitives.destroyPrimitives;return this._scene.primitives.destroyPrimitives=!1,this._scene.primitives.remove(this),this._scene.primitives.destroyPrimitives=e,Cesium.defined(this.ev_radarJamDirCollection)&&this.ev_radarJamDirCollection.destroy(),Cesium.defined(this.ev_simpleConeRadars)&&this.ev_simpleConeRadars.destroy(),Cesium.destroyObject(this)},Object.defineProperties(EA.prototype,{}),EA.prototype.startPlay=function(){this.trainingClock.shouldAnimate||(this.trainingClock.shouldAnimate=!0,this.trainingClock.tick(),Cesium.JulianDate.toDate(this.trainingClock.currentTime),this.ev_dataMgr.startSend())},EA.prototype.pausePlay=function(){this.trainingClock.shouldAnimate&&(this.trainingClock.shouldAnimate=!1,this.trainingClock.tick())},EA.prototype.stopPlay=function(){},EA.prototype.resetTimeLine=function(e,t){this.trainingClock.startTime=e,this.trainingClock.startTime=t,this.trainingClock.clockStep=Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER,this.trainingClock.clockRange=Cesium.ClockRange.CLAMPED,this.trainingClock.tick()},EA.prototype.resetCurrentTime=function(e){this.trainingClock.currentTime=e,this.trainingClock.tick()},EA.prototype.resetTimeRate=function(e){e=Number(e);this.trainingClock.multiplier=e},EA.prototype.playBack=function(t){for(var e in this.ev_dataMgr.sendArr._hash){var i=this.ev_dataMgr.sendArr._hash[e].findIndex(function(e){return e.header.datTime>=t-100});this.ev_dataMgr.index.set(e,i)}for(var e in this.ev_dataMgr.trajData._hash){var n=this.ev_dataMgr.trajData._hash[e].findIndex(function(e){return e.header.datTime>=t-100});this.ev_dataMgr.trajIndex.set(e,n)}for(var e in this.ev_dataMgr.gtspiIndex=this.ev_dataMgr.gtspiData.findIndex(function(e){return e.header.datTime>=t}),this.ev_dataMgr.radarTargetMap._hash){var r=this.ev_dataMgr.radarTargetMap._hash[e].findIndex(function(e){return e.header.datTime>=t-100});this.ev_dataMgr.radarIndex.set(e,r)}for(var e in this.ev_dataMgr.sdrState._hash){var a=this.ev_dataMgr.sdrState._hash[e].findIndex(function(e){return e.header.datTime>=t-100});this.ev_dataMgr.sdrIndex.set(e,a)}for(var e in this.ev_dataMgr.ewsData._hash){var o=this.ev_dataMgr.ewsData._hash[e].findIndex(function(e){return e.header.datTime>=t});this.ev_dataMgr.ewsIndex.set(e,o)}this.ev_dataMgr.irsmIndex=this.ev_dataMgr.irsmData.findIndex(function(e){return e.header.datTime>=t}),this.ev_mtSensorMgr.removeAllRadarDatas(),this.ev_dataMgr.sendRadarMV=!0,this.ev_dataMgr.preTime=t,t=new Date(Number(t)),this.trainingClock.tick(),this.trainingClock.currentTime=Cesium.JulianDate.fromDate(t),this.ev_dataMgr.dataOperated=Kt.REPLACE,this.ev_dataMgr.trajOperated=Kt.REPLACE,this.ev_mtMgr.dataOperated=Kt.REPLACE},EA.prototype.forward=function(t){for(var e in this.ev_dataMgr.sendArr._hash){var i=this.ev_dataMgr.sendArr._hash[e].findIndex(function(e){return e.header.datTime>=t-1200});-1!=i?this.ev_dataMgr.index.set(e,i):this.ev_dataMgr.index.set(e,this.ev_dataMgr.sendArr._hash[e].length)}for(var e in this.ev_dataMgr.trajData._hash){var n=this.ev_dataMgr.trajData._hash[e].findIndex(function(e){return e.header.datTime>=t});this.ev_dataMgr.trajIndex.set(e,n)}for(var e in this.ev_dataMgr.gtspiIndex=this.ev_dataMgr.gtspiData.findIndex(function(e){return e.header.datTime>=t}),this.ev_dataMgr.radarTargetMap._hash){var r=this.ev_dataMgr.radarTargetMap._hash[e].findIndex(function(e){return e.header.datTime>=t-100});this.ev_dataMgr.radarIndex.set(e,r)}for(var e in this.ev_dataMgr.sdrState._hash){var a=this.ev_dataMgr.sdrState._hash[e].findIndex(function(e){return e.header.datTime>=t-100});this.ev_dataMgr.sdrIndex.set(e,a)}for(var e in this.ev_dataMgr.ewsData._hash){var o=this.ev_dataMgr.ewsData._hash[e].findIndex(function(e){return e.header.datTime>=t});this.ev_dataMgr.ewsIndex.set(e,o)}this.ev_dataMgr.irsmIndex=this.ev_dataMgr.irsmData.findIndex(function(e){return e.header.datTime>=t}),this.ev_mtSensorMgr.removeAllRadarDatas(),this.ev_dataMgr.sendRadarMV=!0,this.ev_dataMgr.preTime=t,t=new Date(Number(t)),this.trainingClock.tick(),this.trainingClock.currentTime=Cesium.JulianDate.fromDate(t),this.ev_dataMgr.dataOperated=Kt.REPLACE,this.ev_dataMgr.trajOperated=Kt.REPLACE,this.ev_mtMgr.dataOperated=Kt.REPLACE},EA.prototype.reset=function(e){this.trainingClock.shouldAnimate&&(this.trainingClock.shouldAnimate=!1,this.trainingClock.tick()),this.trainingClock.tick(),this.trainingClock.currentTime=Cesium.JulianDate.fromDate(e),this.ev_mtMgr.removeAllMovingTargets()},EA.prototype.playLineRun=function(){},SA.prototype.update=function(e){var t,i,n,r,a,o,s,u,l,c,m=e.mode,d=e.context;this.show&&m===Cesium.SceneMode.SCENE3D&&(this._boundingSphere=new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,this.radius),Cesium.defined(this._modelMatrix)||(this._modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(this.startPoint)),Cesium.defined(this._command.shaderProgram)||(this._command.shaderProgram=Cesium.ShaderProgram.fromCache({context:d,vertexShaderSource:"attribute vec3 position;\nattribute vec4 color; \nattribute vec4 czm_modelMatrixRow0; \nattribute vec4 czm_modelMatrixRow1; \nattribute vec4 czm_modelMatrixRow2; \nvarying vec4  v_colour;\nvoid main()\n{\n    v_colour = vec4(color.r, color.g, color.b, color.a); \n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0,\n                            czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, \n                            czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, \n                            czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0); \n    gl_Position = czm_viewProjection * czm_instanced_model*  vec4(position.xyz, 1.0);   \n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"})),Cesium.defined(this._command.vertexArray)||(t=function(e){for(var t=e.lineCount,i=360/t,n=[],r=[],a=0;a<e.keyPts.length;a++){var o=e.keyPts[a].geo;n.push(o)}for(var s=0;s<e.keyPts.length;s++){var u,l,c,m=e.keyPts[s].R,d=e.keyPts[s].r,h=Cesium.Transforms.eastNorthUpToFixedFrame(n[s]),f=new Cesium.Quaternion;f=(c=(l=0==s?(u=Cesium.Matrix4.multiplyByPoint(Cesium.Matrix4.inverse(h,new Cesium.Matrix4),n[1],new Cesium.Cartesian3),Cesium.Matrix4.multiplyByPoint(Cesium.Matrix4.inverse(h,new Cesium.Matrix4),n[0],new Cesium.Cartesian3)):(u=Cesium.Matrix4.multiplyByPoint(Cesium.Matrix4.inverse(h,new Cesium.Matrix4),n[s],new Cesium.Cartesian3),Cesium.Matrix4.multiplyByPoint(Cesium.Matrix4.inverse(h,new Cesium.Matrix4),n[s-1],new Cesium.Cartesian3)),Cesium.Cartesian3.subtract(u,l)),RA(Cesium.Cartesian3.UNIT_Y,c,new Cesium.Quaternion));for(var p=Cesium.Matrix3.fromQuaternion(f,new Cesium.Matrix3),_=[],C=0;C<t+1;C++){var g=Cesium.Math.toRadians(C*i),v=new Cesium.Cartesian3(d*Math.cos(g),0,m*Math.sin(g)),y=Cesium.Matrix3.multiplyByVector(p,v,new Cesium.Cartesian3),T=Cesium.Matrix4.multiplyByPoint(h,y,new Cesium.Cartesian3);_.push(T)}var x=new Cesium.Cartesian3(0,0,0);x=Cesium.Matrix3.multiplyByVector(p,x,new Cesium.Cartesian3),x=Cesium.Matrix4.multiplyByPoint(h,x,new Cesium.Cartesian3),_.push(x),r.push(_)}var w=e.color,A=r.length*(t+1),E=r.length*t*4,S=Cesium.IndexDatatype.createTypedArray(A,E),b=new Float64Array(3*A),M=new Uint8Array(4*A),R=0,D=0,P=0;{var I;C=0==e.countRdii?r.length:(I=(r.length-1)/(r.length*e.countRdii-1),0)}for(var O=0;O<r.length;O++){for(var L=0;L<t+1;L++){var N=Cesium.Cartesian3.subtract(r[O][L],e.center);b[R++]=N.x,b[R++]=N.y,b[R++]=N.z,M[D++]=Cesium.Color.floatToByte(w.red),M[D++]=Cesium.Color.floatToByte(w.green),M[D++]=Cesium.Color.floatToByte(w.blue),M[D++]=Cesium.Color.floatToByte(w.alpha),L<t&&((C<=O||O==r.length-1&&0!=e.countRdii)&&(S[P++]=O*(t+1)+L,S[P++]=O*(t+1)+L+1),O<r.length-1&&(S[P++]=O*(t+1)+L,S[P++]=O*(t+1)+L+(t+1)))}C<=O&&(C+=I)}return{position:b,color:M,indices:S}}(this),this._command.vertexArray=(i=d,n=t,r=function(e){new Cesium.Matrix4;var t=e._center,i=e._vertexBufferTypedArray;Cesium.defined(i)||(i=new Float32Array(12));var n=e._modelMatrix,r=Cesium.Matrix4.fromTranslation(Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3));return r[12]-=t.x,r[13]-=t.y,r[14]-=t.z,[].push(new Cesium.Cartesian3(r[12],r[13],r[14])),i[0]=r[0],i[1]=r[4],i[2]=r[8],i[3]=r[12],i[4]=r[1],i[5]=r[5],i[6]=r[9],i[7]=r[13],i[8]=r[2],i[9]=r[6],i[10]=r[10],i[11]=r[14],i}(this),a=Cesium.Buffer.createVertexBuffer({context:i,typedArray:r,usage:Cesium.BufferUsage.STATIC_DRAW}),o=Cesium.ComponentDatatype.getSizeInBytes(Cesium.ComponentDatatype.FLOAT),s={czm_modelMatrixRow0:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*o,strideInBytes:12*o,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:a,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*o,strideInBytes:12*o,instanceDivisor:1}},u=0,(l=[]).push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:i,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,new Float64Array(n.position.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),l.push({index:u++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:i,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.UNSIGNED_BYTE,new Uint8Array(n.color.buffer)),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),s.czm_modelMatrixRow0.index=u++,l.push(s.czm_modelMatrixRow0),s.czm_modelMatrixRow1.index=u++,l.push(s.czm_modelMatrixRow1),s.czm_modelMatrixRow2.index=u++,l.push(s.czm_modelMatrixRow2),new Cesium.VertexArray({context:i,attributes:l,indexBuffer:Cesium.Buffer.createIndexBuffer({context:i,typedArray:new Uint16Array(n.indices.buffer),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})}))),c=e.commandList,e.passes.render&&c.push(this._command))},SA.prototype.remove=function(){var e,t=this._command;return t.vertexArray=t.vertexArray&&t.vertexArray.destroy(),t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy(),!this._viewer.scene.primitives.contains(this)||-1!==(e=this._viewer.scene.primitives._primitives.indexOf(this))&&(this._viewer.scene.primitives._primitives.splice(e,1),delete this._external._composites[this._viewer.scene.primitives._guid]),Cesium.destroyObject(this)},Object.defineProperties(DA.prototype,{curMillisecTime:{get:function(){return this._curMillisecTime},set:function(e){this._curMillisecTime=e}}});var PA=new dr,IA=new Xn;function OA(e,t){this.SIZE=96,this.header=cA(e,t);var i=26+z(t,0);this.delayFlag=e.getUint8(i,!0),i+=1;for(var n=[],r=0;r<7;r++)n.push(e.getInt8(i,!0)),i+=1;var a=String.fromCharCode(n[0],n[1]),o=new Int8Array(n.splice(2,5));a=(a=a+""+rr.decodeWithTextDecoder(o)).replace(/\u0000/g,""),this.chFlyUser=a;for(var s="",r=0;r<10;r++)s+=String.fromCharCode(e.getInt8(i,!0)),i+=1;s=s.replace(/\u0000/g,""),this.chFighterName=s,this.nRedOrBlue=e.getUint8(i,!0),i+=1,this.fLon=e.getFloat64(i,!0),i+=8,this.fLat=e.getFloat64(i,!0),i+=8,this.fAlt=e.getFloat32(i,!0),i+=4,this.fRoll=e.getFloat32(i,!0),i+=4,this.fPitch=e.getFloat32(i,!0),i+=4,this.fHeading=e.getFloat32(i,!0),i+=4,this.decoyDrop=e.getUint8(i,!0),i+=1,this.enginePower=e.getUint8(i,!0),i+=1,this.trainPro=e.getUint8(i,!0),i+=1,this.height=e.getFloat32(i,!0),i+=4,this.vel_east=e.getFloat32(i,!0),i+=4,this.vel_north=e.getFloat32(i,!0),i+=4,this.vel_up=e.getFloat32(i,!0)}function LA(e,t){this.SIZE=35,this.header=cA(e,t);var i=26+z(t,0);this.nMissileID=e.getUint32(i,!0),i+=4,this.chWeaponType=e.getInt32(i,!0),i+=4,this.dropMslNum=e.getUint8(i,!0)}function NA(e,t){this.SIZE=50,this.header=cA(e,t);var i=26+z(t,0);this.nMissileID=e.getUint32(i,!0),i+=4,this.chWeaponType=e.getInt32(i,!0),i+=4,this.fDistance=e.getFloat32(i,!0),i+=4,this.nTgtID=e.getUint16(i,!0),i+=2,this.nResult=e.getUint8(i,!0),i+=1,this.stopReason=e.getUint8(i,!0);for(var n=[],r=0;r<4;r++)n.push(e.getInt8(i,!0)),i+=1;this.gTgtType=n,n=[];for(r=0;r<4;r++)n.push(e.getInt8(i,!0)),i+=1;this.gTgtID=n}function BA(e,t){this.SIZE=77,this.header=cA(e,t);var i=26+z(t,0);this.targetID=e.getUint16(i,!0),i+=2,this.weaponID=e.getUint32(i,!0),i+=4,this.weaponType=e.getInt32(i,!0),i+=4,this.engineState=e.getUint8(i,!0),i+=1,this.captureState=e.getUint8(i,!0),i+=1,this.mslLongitude=e.getFloat64(i,!0),i+=8,this.mslLatitude=e.getFloat64(i,!0),i+=8,this.mslAltitude=e.getFloat32(i,!0),i+=4,this.mslCourse=e.getFloat32(i,!0),i+=4,this.mslPitch=e.getFloat32(i,!0),i+=4,this.vel=e.getFloat32(i,!0),i+=4,this.mslDistance=e.getFloat32(i,!0),i+=4,this.targetTspiValid=e.getUint8(i,!0),i+=1,this.ipk=e.getUint8(i,!0),i+=1,this.noKkkReason=e.getUint8(i,!0)}function zA(e,t){this.SIZE=58,this.header=cA(e,t);var i=26+z(t,0);this.fakeCampID=e.getUint8(i,!0),i+=1,this.campType=e.getInt32(i,!0),i+=4,this.equipmentType=e.getInt8(i,!0),i+=1,this.equipmentID=e.getInt8(i,!0),i+=1,this.gTspiState=e.getInt8(i,!0),i+=1,this.northAngle=e.getFloat32(i,!0),i+=4,this.gTspiAlt=e.getFloat32(i,!0),i+=4,this.gTspiLon=e.getFloat64(i,!0),i+=8,this.gTspiLat=e.getFloat64(i,!0)}function FA(e,t){this.SIZE=39,this.header=cA(e,t);for(var i=26+z(t,0),n=[],r=0;r<7;r++)n.push(e.getInt8(i,!0)),i+=1;var a=String.fromCharCode(n[0],n[1]),o=new Int8Array(n.splice(2,5));a=(a=a+""+rr.decodeWithTextDecoder(o)).replace(/\u0000/g,""),this.chFlyUser=a,n="";for(r=0;r<10;r++)n+=String.fromCharCode(e.getInt8(i,!0)),i+=1;this.chFighterName=n,this.nRedOrBlue=e.getUint8(i,!0),i+=1,this.remainMslNum=e.getUint8(i,!0),i+=1,this.remainChannelNum=e.getUint8(i,!0),i+=1,this.selfReliveFlag=e.getUint8(i,!0),i+=1,this.resetMslCountFlag=e.getUint8(i,!0),i+=1,this.trainMode=e.getUint8(i,!0)}function VA(e,t){this.SIZE=95,this.header=cA(e,t);for(var i=26+z(t,0),n=[],r=0;r<7;r++)n.push(e.getInt8(i,!0)),i+=1;var a=String.fromCharCode(n[0],n[1]),o=new Int8Array(n.splice(2,5));a=(a=a+""+rr.decodeWithTextDecoder(o)).replace(/\u0000/g,""),this.chFlyUser=a;for(var s="",r=0;r<10;r++)s+=String.fromCharCode(e.getInt8(i,!0)),i+=1;this.chFighterName=s,this.nRedOrBlue=e.getUint8(i,!0),i+=1,this.fLon=e.getFloat64(i,!0),i+=8,this.fLat=e.getFloat64(i,!0),i+=8,this.fAlt=e.getFloat32(i,!0),i+=4,this.fRoll=e.getFloat32(i,!0),i+=4,this.fPitch=e.getFloat32(i,!0),i+=4,this.fHeading=e.getFloat32(i,!0),i+=4,this.decoyDrop=e.getUint8(i,!0),i+=1,this.enginePower=e.getUint8(i,!0),i+=1,this.trainPro=e.getUint8(i,!0),i+=1,this.height=e.getFloat32(i,!0),i+=4,this.vel_east=e.getFloat32(i,!0),i+=4,this.vel_north=e.getFloat32(i,!0),i+=4,this.vel_up=e.getFloat32(i,!0)}function UA(e,t){this.SIZE=38,this.header=cA(e,t);var i=26+z(t,0);this.irmslAzimuth=e.getFloat32(i,!0),i+=4,this.irmslPitch=e.getFloat32(i,!0),i+=4,this.fDistance=e.getFloat32(i,!0)}function GA(e,t){this.SIZE=139,this.header=new cA(e,t);var i=26+z(t,0);this.tgtNum=e.getUint8(i,!0),i+=1,this.tgtInfo=[];for(var n=0;n<8;n++)this.tgtInfo.push({tgtNTS:0,tgtSensor:0,tgtAzimuth:0,tgtPitch:0,tgtDis:0});for(var r=0;r<8;r++)this.tgtInfo[r].tgtNTS=e.getUint8(i,!0),i+=1,this.tgtInfo[r].tgtSensor=e.getUint8(i,!0),i+=1,this.tgtInfo[r].tgtAzimuth=e.getFloat32(i,!0),i+=4,this.tgtInfo[r].tgtPitch=e.getFloat32(i,!0),i+=4,this.tgtInfo[r].tgtDis=e.getFloat32(i,!0),r<7&&(i+=4)}function kA(e,t){this.SIZE=29,this.header=new cA(e,t);var i=26+z(t,0);this.workMode=e.getInt8(i,!0),i+=1,this.openState=e.getInt8(i,!0),i+=1,this.radiaState=e.getInt8(i,!0)}function HA(e,t){this.SIZE=57,this.header=cA(e,t);var i=26+z(t,0);this.true_AOA=e.getFloat32(i,!0),i+=4,this.mach=e.getFloat32(i,!0),i+=4,this.normalAccel=e.getFloat32(i,!0),i+=4,this.trainMode=e.getUint8(i,!0),i+=1,this.cal_air_speed=e.getFloat32(i,!0),i+=4,this.baro_ref_alt=e.getFloat32(i,!0),i+=4,this.wireless_alt=e.getFloat32(i,!0),i+=4,this.remain_oil_amount=e.getFloat32(i,!0),i+=4,this.s2=e.getUint8(i,!0),i+=1,this.s3=e.getUint8(i,!0)}function WA(e,t){this.SIZE=38,this.header=cA(e,t);var i=26+z(t,0);this.mslType=e.getInt32(i,!0),i+=4,this.fHalfAngle=e.getFloat32(i,!0),i+=4,this.fMaxDistance=e.getFloat32(i,!0)}function qA(e,t){this.SIZE=29,this.header=cA(e,t);var i=26+z(t,0);this.workMode=e.getInt8(i,!0),i+=1,this.openState=e.getInt8(i,!0),i+=1,this.interceptState=e.getInt8(i,!0)}function jA(e,t){this.SIZE=27,this.header=cA(e,t);var i=26+z(t,0);this.ewsDir=e.getUint8(i,!0)}function YA(e,t){this.SIZE=27,I3_NET_COMMAND.header=cA(e,t);var i=26+z(t,0);I3_NET_COMMAND.state=e.getUint8(i,!0)}function XA(e,t){this.SIZE=35,this.header=cA(e,t);var i=26+z(t,0);this.campType=e.getInt32(i,!0),i+=4,this.equipmentType=e.getUint8(i,!0),i+=1,this.equipmentID=e.getUint8(i,!0),i+=1,this.openState=e.getUint8(i,!0),i+=1,this.antennaDirection=e.getUint16(i,!0)}function KA(e,t){this.SIZE=10,this.header=cA(e,t);var i=26+z(t,0);this.uiAlarmType=e.getUint16(i,!0),this.uiPlaneID=new Array(3),this.ucMeetType=new Array(3),this.uiMeetTimeLinear=new Array(3),this.uiMeetTimeSprial=new Array(3);for(var n=0;n<3;n++)this.uiPlaneID[n]=e.getUint16(i,!0),i+=2,this.ucMeetType[n]=e.getUint8(i,!0),i+=1,this.uiMeetTimeLinear[n]=e.getUint32(i,!0),i+=4,this.uiMeetTimeSprial[n]=e.getUint32(i,!0)}function ZA(e,t){this.SIZE=72,this.header=cA(e,t);for(var i=26+z(t,0),n=[],r=0;r<7;r++)n.push(e.getInt8(i,!0)),i+=1;this.chFlyUser=n,n=[];for(r=0;r<10;r++)n.push(e.getInt8(i,!0)),i+=1;this.chFighterName=n,this.nRedOrBlue=e.getUint8(i,!0),i+=1,this.fLon=e.getFloat64(i,!0),i+=8,this.fLat=e.getFloat64(i,!0),i+=8,this.fAlt=e.getFloat32(i,!0),i+=4,this.fHeading=e.getFloat32(i,!0),i+=4,this.fVel=e.getFloat32(i,!0)}function JA(e,t){if(!oe(e))throw new x("wsserver undefined!");this.url=e,this.startPlay=0,this.callbackFunc=t,this.websocket=new WebSocket(e),this.websocket.onopen=this.onOpen.bind(this),this.websocket.onclose=this.onClose.bind(this),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onerror=this.onError.bind(this)}function QA(e,t,i){if(!oe(e))throw new x("wsserver undefined!");this.url=e,this.datSource=t,this.startPlay=0,this.callbackFunc=i,this.websocket=new WebSocket(e),this.websocket.onopen=this.onOpen.bind(this),this.websocket.onclose=this.onClose.bind(this),this.websocket.onmessage=this.onMessage.bind(this),this.websocket.onerror=this.onError.bind(this)}DA.prototype.recreateVertexArrays=function(e,t){this._mode=t.mode;var i=t.mapProjection,n=(i.ellipsoid.maximumRadius,Cesium.Math.PI,e.length),r=0,a=0,o=[];if(e instanceof Array&&0<n){for(var s=0;s<n;s++)Cesium.defined(e[s])&&1<e[s].length&&(r+=2*(e[s].length-1),a+=e[s].length,o.push(e[s]));for(var u=Cesium.IndexDatatype.createTypedArray(a,r),l=new Float32Array(3*a),c=new Float32Array(3*a),m=new Float32Array(2*a),d=void 0,h=0,f=0,p=0;p<o.length;p++){for(var _=0;_<o[p].length;_++){var C=o[p][_],d=Cesium.defined(d)?Cesium.BoundingSphere.expand(d,C.position):new Cesium.BoundingSphere(C.position,200),g=void 0;_<o[p].length-1&&(u[h++]=f+_,u[h++]=f+_+1,g=o[p][_+1]);var v,y=C.position;this._mode==Cesium.SceneMode.SCENE2D&&((y=i.project(i.ellipsoid.cartesianToCartographic(C.position,PA))).z=0,Cesium.defined(g)&&(v=i.project(i.ellipsoid.cartesianToCartographic(g.position,PA)),(0<y.x&&v.x<0||y.x<0&&0<v.x)&&(u[h-1]=f+_))),Cesium.EncodedCartesian3.fromCartesian(y,IA);var T=IA.high,x=IA.low;l[3*(f+_)]=T.x,l[3*(f+_)+1]=T.y,l[3*(f+_)+2]=T.z,c[3*(f+_)]=x.x,c[3*(f+_)+1]=x.y,c[3*(f+_)+2]=x.z,m[2*(f+_)]=Math.floor(C.millisecTime/1e6),m[2*(f+_)+1]=C.millisecTime%1e6}f+=o[p].length}this.traceMesh={position3DHigh:l,position3DLow:c,st:m,indices:u},Cesium.defined(d)&&(this.boundingSphere=d.clone()),this.blUpdateVAO=!0}else this.traceMesh=void 0,this.blUpdateVAO=!0},DA.prototype.update=function(e){var t,i,n=e.context,r=this._command;Cesium.defined(r.vertexArray)&&!r.vertexArray.isDestroyed()&&this.blUpdateVAO&&r.vertexArray.destroy(),this.blUpdateVAO&&Cesium.defined(this.traceMesh)&&(t=0,(i=[]).push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.traceMesh.position3DHigh),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.traceMesh.position3DLow),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),i.push({index:t++,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:n,typedArray:Cesium.ComponentDatatype.createTypedArray(Cesium.ComponentDatatype.FLOAT,this.traceMesh.st),usage:Cesium.BufferUsage.STATIC_DRAW}),componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1}),r.vertexArray=new Cesium.VertexArray({context:n,attributes:i,indexBuffer:Cesium.Buffer.createIndexBuffer({context:n,typedArray:this.traceMesh.indices,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})}),r._boundingVolume=this.boundingSphere,Cesium.defined(r.shaderProgram)||(r.shaderProgram=Cesium.ShaderProgram.fromCache({context:n,vertexShaderSource:"attribute vec3 positionHigh;\nattribute vec3 positionLow;\nattribute vec2 st;\nuniform vec4 u_originColor; \nuniform vec4 u_outdatedColor; \nuniform vec2 u_curMillisecTime; \nvarying vec4  v_colour;\nconst float SHIFT_LEFT16 = 65536.0;\nvoid main()\n{\n    v_colour = u_originColor; \n    if(st.x < u_curMillisecTime.x ||(st.x <= u_curMillisecTime.x && st.y <= u_curMillisecTime.y)){\n       v_colour = u_outdatedColor; \n    }\nvec4 p;\nif(czm_morphTime == 1.0){\n  p = czm_translateRelativeToEye(positionHigh.xyz, positionLow.xyz);\n}else if(czm_morphTime == 0.0){\n  p = czm_translateRelativeToEye(positionHigh.zxy, positionLow.zxy);\n}else{\n  p = czm_columbusViewMorph(\n  czm_translateRelativeToEye(positionHigh.zxy, positionLow.zxy),\n  czm_translateRelativeToEye(positionHigh.xyz, positionLow.xyz),\n  czm_morphTime);\n}\n  vec4 positionEC = czm_modelViewRelativeToEye * p;\n  vec4 positionWindow = czm_eyeToWindowCoordinates(positionEC); \n  vec4 positionWC = vec4(positionWindow.xy, -positionWindow.z, 1.0) * (czm_projection * positionEC).w;;\n  gl_Position = czm_viewportOrthographic * positionWC;\n    #ifdef LOG_DEPTH \n    czm_vertexLogDepth();\n    #endif\n}\n",fragmentShaderSource:"varying vec4  v_colour;\nvoid main()\n{\n    gl_FragColor = v_colour;\n}\n"}))),Cesium.defined(r.vertexArray)&&!r.vertexArray.isDestroyed()&&e.commandList.push(r),this.blUpdateVAO=!1},DA.prototype.isDestroyed=function(){return!1},DA.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),Cesium.destroyObject(this)},JA.prototype.onOpen=function(e){this.websocket.binaryType="arraybuffer",console.log("Connection open ..."),this.doSend(e)},JA.prototype.doSend=function(e){this.websocket.send(e)},JA.prototype.onMessage=function(e){var t,i,n,r=0,a=this,o=e.data;if(a.dataI3NSArr=[],a.dataRTSN=[],a.dataRTKN=[],a.dataTRAJ=[],a.dataGTSPI=[],a.dataIrsm=[],a.radarTarget=[],a.RadarWM=[],a.IRSTworkMode=[],a.dataEWS=[],a.LargePlane=[],a.SafetyAlarm=[],a.CombatPower=[],a.StaticTarget=[],a.flightState=[],a.SDRState=[],e.data instanceof ArrayBuffer){for(;r<o.byteLength;){var s=(t=e.data,i=r,n=void 0,{time:(n=new DataView(t)).getBigInt64(i,!0),nLen:n.getUint8(i+8,!0)});r+=10;var u,l=s.nLen,c=new DataView(o,r,l);switch(new cA(c,0).msgType){case Gt.NET_MSG_TSPI:95==l?u=new VA(c):96==l&&(u=new OA(c)),a.dataI3NSArr.push(u);break;case Gt.NET_MSG_FIGHTER:var m=new HA(c);a.flightState.push(m);break;case Gt.NET_MSG_RTSN:var d=new LA(c);a.dataRTSN.push(d);break;case Gt.NET_MSG_MISSILEPARAM:var h=new WA(c);break;case Gt.NET_MSG_RTKN:h=new NA(c);a.dataRTKN.push(h);break;case Gt.NET_MSG_WPN_TRAJ:h=new BA(c);a.dataTRAJ.push(h);break;case Gt.NET_MSG_RDR_STATE:h=new kA(c);a.RadarWM.push(h);break;case Gt.NET_MSG_TARGET:h=new GA(c);a.radarTarget.push(h);break;case Gt.NET_MSG_IRST:h=new qA(c);a.IRSTworkMode.push(h);break;case Gt.NET_MSG_IRMSL_STATE:h=new UA(c);a.dataIrsm.push(h);break;case Gt.NET_MSG_EWS_STA:h=new jA(c);a.dataEWS.push(h);break;case Gt.NET_MSG_START_STOP:h=new YA(c);console.log(h);break;case Gt.NET_MSG_GTSPI:h=new zA(c);a.dataGTSPI.push(h);break;case Gt.NET_MSG_RAD_STATE:h=new XA(c);a.SDRState.push(h);break;case Gt.NET_MSG_COMBATPOWER:h=new FA(c);a.CombatPower.push(h);break;case Gt.NET_MSG_SAFETYALARM:h=new KA(c);a.SafetyAlarm.push(h);break;case Gt.NET_MSG_LARGE_PLANE:h=new ZA(c);a.LargePlane.push(h)}r+=l}0!=a.dataI3NSArr.length&&a.callbackFunc(a.dataI3NSArr),0!=a.dataRTKN.length&&a.callbackFunc(a.dataRTKN),0!=a.dataRTSN.length&&a.callbackFunc(a.dataRTSN),0!=a.dataGTSPI.length&&a.callbackFunc(a.dataGTSPI),0!=a.dataTRAJ.length&&a.callbackFunc(a.dataTRAJ),0!=a.dataIrsm.length&&a.callbackFunc(a.dataIrsm),0!=a.radarTarget.length&&a.callbackFunc(a.radarTarget),0!=a.RadarWM.length&&a.callbackFunc(a.RadarWM),0!=a.IRSTworkMode.length&&a.callbackFunc(a.IRSTworkMode),0!=a.dataEWS.length&&a.callbackFunc(a.dataEWS),0!=a.LargePlane.length&&a.callbackFunc(a.LargePlane),0!=a.SafetyAlarm.length&&a.callbackFunc(a.SafetyAlarm),0!=a.CombatPower.length&&a.callbackFunc(a.CombatPower),0!=a.StaticTarget.length&&a.callbackFunc(a.StaticTarget),0!=a.flightState.length&&a.callbackFunc(a.flightState),0!=a.SDRState.length&&a.callbackFunc(a.SDRState)}else a.callbackFunc(e.data)},JA.prototype.onClose=function(){console.log("DISCONNECTED")},JA.prototype.onError=function(e){console.log("websocket error")},QA.prototype.onOpen=function(e){this.websocket.binaryType="arraybuffer",console.log("Connection open ...");var t=JSON.stringify({type:0,fileName:this.datSource});this.doSend(t)},QA.prototype.doSend=function(e){this.websocket.send(e)},QA.prototype.onMessage=function(e){var t,i=this,n=JSON.parse(e.data);if(i.dataI3NSArr=[],i.dataRTSN=[],i.dataRTKN=[],i.dataTRAJ=[],i.dataGTSPI=[],i.dataIrsm=[],i.radarTarget=[],i.RadarWM=[],i.IRSTworkMode=[],i.dataEWS=[],i.LargePlane=[],i.SafetyAlarm=[],i.CombatPower=[],i.StaticTarget=[],i.flightState=[],i.SDRState=[],n.uint8Array instanceof Array){for(var r=n.uint8Array,a=0;a<r.length;a++){var o,s=new Uint8Array(r[a]).buffer,u=(t=void 0,{time:(t=new DataView(s)).getBigInt64(0,!0),nLen:t.getUint8(8,!0)}).nLen,l=new DataView(s);switch(new cA(l,10).msgType){case Gt.NET_MSG_TSPI:95==u?o=new VA(l,10):96==u&&(o=new OA(l,10)),i.dataI3NSArr.push(o);break;case Gt.NET_MSG_FIGHTER:var c=new HA(l,10);i.flightState.push(c);break;case Gt.NET_MSG_RTSN:var m=new LA(l,10);i.dataRTSN.push(m);break;case Gt.NET_MSG_MISSILEPARAM:var d=new WA(l,10);break;case Gt.NET_MSG_RTKN:d=new NA(l,10);i.dataRTKN.push(d);break;case Gt.NET_MSG_WPN_TRAJ:d=new BA(l,10);i.dataTRAJ.push(d);break;case Gt.NET_MSG_RDR_STATE:d=new kA(l,10);i.RadarWM.push(d);break;case Gt.NET_MSG_TARGET:d=new GA(l,10);i.radarTarget.push(d);break;case Gt.NET_MSG_IRST:d=new qA(l,10);i.IRSTworkMode.push(d);break;case Gt.NET_MSG_IRMSL_STATE:d=new UA(l,10);i.dataIrsm.push(d);break;case Gt.NET_MSG_EWS_STA:d=new jA(l,10);i.dataEWS.push(d);break;case Gt.NET_MSG_START_STOP:d=new YA(l,10);console.log(d);break;case Gt.NET_MSG_GTSPI:d=new zA(l,10);i.dataGTSPI.push(d);break;case Gt.NET_MSG_RAD_STATE:d=new XA(l,10);i.SDRState.push(d);break;case Gt.NET_MSG_COMBATPOWER:d=new FA(l,10);i.CombatPower.push(d);break;case Gt.NET_MSG_SAFETYALARM:d=new KA(l,10);i.SafetyAlarm.push(d);break;case Gt.NET_MSG_LARGE_PLANE:d=new ZA(l,10);i.LargePlane.push(d)}}0!=i.dataI3NSArr.length&&i.callbackFunc(i.dataI3NSArr),0!=i.dataRTKN.length&&i.callbackFunc(i.dataRTKN),0!=i.dataRTSN.length&&i.callbackFunc(i.dataRTSN),0!=i.dataGTSPI.length&&i.callbackFunc(i.dataGTSPI),0!=i.dataTRAJ.length&&i.callbackFunc(i.dataTRAJ),0!=i.dataIrsm.length&&i.callbackFunc(i.dataIrsm),0!=i.radarTarget.length&&i.callbackFunc(i.radarTarget),0!=i.RadarWM.length&&i.callbackFunc(i.RadarWM),0!=i.IRSTworkMode.length&&i.callbackFunc(i.IRSTworkMode),0!=i.dataEWS.length&&i.callbackFunc(i.dataEWS),0!=i.LargePlane.length&&i.callbackFunc(i.LargePlane),0!=i.SafetyAlarm.length&&i.callbackFunc(i.SafetyAlarm),0!=i.CombatPower.length&&i.callbackFunc(i.CombatPower),0!=i.StaticTarget.length&&i.callbackFunc(i.StaticTarget),0!=i.flightState.length&&i.callbackFunc(i.flightState),0!=i.SDRState.length&&i.callbackFunc(i.SDRState)}else i.callbackFunc(n)},QA.prototype.onClose=function(){console.log("DISCONNECTED")},QA.prototype.onError=function(e){console.log("websocket error")};e.EV_AirSpace=Tt,e.EV_AnnulusPrimitive=xt,e.EV_CarToDegrees=bt,e.EV_ColorHandle=Mt,e.EV_Curve=Rt,e.EV_CustomizedPARadar=Dt,e.EV_DataOperated=Kt,e.EV_DatagramManager=Zt,e.EV_DrawConnectionLines=Qt,e.EV_DrawMilGeometry=fn,e.EV_DrawPrimitives=pn,e.EV_FanRing=Ni,e.EV_Instanced3DCylinder=kn,e.EV_Instanced3DSector=Wn,e.EV_LabelPullWireCollection=Jn,e.EV_LineInstance=Vi,e.EV_LoadMTData=Id,e.EV_Locking=Nd,e.EV_MTCesium3DTileBatchTable=dc,e.EV_MTInstanced3DModelContent=Fc,e.EV_MTLabelConfigurationTable=rm,e.EV_MTLightningCollection=pA,e.EV_MTModel=fu,e.EV_MTModelInstanceCollection=jl,e.EV_MechanicalRadar=un,e.EV_MilStdAnchorCollection=Bg,e.EV_MilStdDeduce=Wg,e.EV_MilStdDrawHelper=aA,e.EV_MilStdLayerManager=Gg,e.EV_MilStdMainLinePrimitive=Vg,e.EV_MilStdMarkerPrimitive=nA,e.EV_MilStdPrimitive=eA,e.EV_MilitaryPlottingService=Bd,e.EV_MovingTarget=kt,e.EV_MovingTargetAttributeType=uA,e.EV_MovingTargetBoundingBoxCollection=kc,e.EV_MovingTargetFlightControl=EA,e.EV_MovingTargetFlightData=jt,e.EV_MovingTargetManager=$c,e.EV_MovingTargetRibbonCollection=$i,e.EV_MovingTargetSensorManager=gA,e.EV_MovingTargetTrace=Wt,e.EV_MovingTargetTraceBarCollection=Gc,e.EV_MovingTargetTraceLineCollection=qc,e.EV_MovingTargetTraceWallCollection=Vc,e.EV_MovingTargetUpdateProperties=wA,e.EV_MovingTargetVisualizer=Kc,e.EV_PARadarBeam=dA,e.EV_ParseArrayRadar=Pi,e.EV_PipeObject=SA,e.EV_PolylineVolumeGeometry=Zw,e.EV_PolylineVolumeGeometryLibrary=bw,e.EV_PureColor=function(e,t){!1===t.stats?(0!==e.globe.imageryLayers.length?e.globe.imageryLayers.get(0).alpha=1:e.globe.imageryLayers.addImageryProvider(new Cesium.SingleTileImageryProvider({url:t.url})),null!=t.color&&(e.globe.baseColor=t.color)):(!0===t.stats?e.globe.imageryLayers.removeAll():e.globe.imageryLayers.get(0).alpha=0,e.globe.baseColor=t.color)},e.EV_Receive=Ft,e.EV_SatelliteTraceLineCollection=DA,e.EV_Special=lA,e.EV_TargetRing=Ui,e.EV_TerrainShade=rn,e.EV_TraceType=Qc,e.EV_VehicleRadar=Si,e.EV_WSGetMessage=JA,e.EV_WSGetMessageJava=QA,e.MT_CzmlDataSource=Pd,e.VERSION="1.69",Object.defineProperty(e,"__esModule",{value:!0})});
